#!/usr/bin/env node

/**
 * Google Maps API Setup Script for YATRIK ERP
 * This script helps you configure Google Maps API for bus tracking functionality
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

console.log(`
üöå YATRIK ERP - Google Maps API Setup
=====================================

This script will help you configure Google Maps API for the bus tracking feature.

üìã Prerequisites:
1. A Google Cloud Platform account
2. A project in Google Cloud Console
3. Billing enabled on your project

üîó Steps to get your API key:
1. Go to: https://console.cloud.google.com/
2. Select your project (or create a new one)
3. Enable the following APIs:
   - Maps JavaScript API
   - Directions API
   - Places API
4. Go to "Credentials" ‚Üí "Create Credentials" ‚Üí "API Key"
5. Copy your API key

‚ö†Ô∏è  Security Note:
- Restrict your API key to your domain in production
- Monitor usage in Google Cloud Console
- Never commit API keys to version control

`);

function askQuestion(question) {
  return new Promise((resolve) => {
    rl.question(question, (answer) => {
      resolve(answer);
    });
  });
}

async function setupGoogleMaps() {
  try {
    const apiKey = await askQuestion('Enter your Google Maps API key: ');
    
    if (!apiKey || apiKey.trim() === '') {
      console.log('‚ùå API key is required. Exiting...');
      rl.close();
      return;
    }

    // Validate API key format (basic check)
    if (!apiKey.startsWith('AIza') || apiKey.length < 30) {
      console.log('‚ö†Ô∏è  Warning: This doesn\'t look like a valid Google Maps API key.');
      const continueAnyway = await askQuestion('Continue anyway? (y/N): ');
      if (continueAnyway.toLowerCase() !== 'y') {
        console.log('‚ùå Setup cancelled.');
        rl.close();
        return;
      }
    }

    // Create .env file for frontend
    const frontendEnvPath = path.join(__dirname, 'frontend', '.env');
    const frontendEnvContent = `# YATRIK ERP Frontend Environment Configuration
# Generated by setup-google-maps.js

# Google Maps API Configuration (Vite)
VITE_GOOGLE_MAPS_API_KEY=${apiKey}

# Development Configuration
PORT=5173
`;

    // Create .env file for backend
    const backendEnvPath = path.join(__dirname, 'backend', '.env');
    const backendEnvContent = `# YATRIK ERP Backend Environment Configuration
# Generated by setup-google-maps.js

# Database Configuration
MONGODB_URI=mongodb://localhost:27017/yatrik_erp

# JWT Configuration
JWT_SECRET=your_jwt_secret_here_change_in_production
JWT_EXPIRE=7d

# Frontend Configuration
FRONTEND_URL=http://localhost:5173
BACKEND_URL=http://localhost:5000

# Google OAuth Configuration (Optional)
GOOGLE_CLIENT_ID=your_google_client_id_here
GOOGLE_CLIENT_SECRET=your_google_client_secret_here
GOOGLE_CALLBACK_URL=http://localhost:5000/api/auth/google/callback
`;

    // Write frontend .env file
    fs.writeFileSync(frontendEnvPath, frontendEnvContent);
    console.log('‚úÖ Frontend .env file created/updated');

    // Write backend .env file
    fs.writeFileSync(backendEnvPath, backendEnvContent);
    console.log('‚úÖ Backend .env file created/updated');

    console.log(`
üéâ Google Maps API setup completed!

üìÅ Files created/updated:
- frontend/.env
- backend/.env

üöÄ Next steps:
1. Start the backend server: cd backend && npm run dev
2. Start the frontend server: cd frontend && npm run dev
3. Open http://localhost:5173
4. Click "Track Bus" on the landing page to test the integration

üîß Testing the integration:
- The "Track Bus" button should now show a real Google Maps interface
- You'll see bus locations with custom markers
- Route paths will be displayed between start and end points

‚ö†Ô∏è  Important:
- Keep your API key secure and never commit it to version control
- Monitor your API usage in Google Cloud Console
- Consider setting up API key restrictions for production

üìö Documentation:
- Google Maps JavaScript API: https://developers.google.com/maps/documentation/javascript
- Directions API: https://developers.google.com/maps/documentation/directions
- Places API: https://developers.google.com/maps/documentation/places

`);

  } catch (error) {
    console.error('‚ùå Error during setup:', error.message);
  } finally {
    rl.close();
  }
}

// Run the setup
setupGoogleMaps();