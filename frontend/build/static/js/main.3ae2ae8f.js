/*! For license information please see main.3ae2ae8f.js.LICENSE.txt */
(()=>{var e={67:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(4410),r=n(3666),s=n(8355);function a(e,t){(0,r.A)(2,arguments);var n=(0,s.A)(t);return(0,i.A)(e,-n)}},129:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var i=n(8355),r=n(4410),s=n(3666),a=6e4;function o(e,t){(0,s.A)(2,arguments);var n=(0,i.A)(t);return(0,r.A)(e,n*a)}},234:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6819),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,i.A)(t);return(0,r.default)(e,12*n)}},238:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var i=n(6260),r=n(8355),s=n(3666),a=n(2239);function o(e,t){var n,o,l,c,d,u,h,p;(0,s.A)(1,arguments);var m=(0,a.q)(),f=(0,r.A)(null!==(n=null!==(o=null!==(l=null!==(c=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==c?c:null===t||void 0===t||null===(d=t.locale)||void 0===d||null===(u=d.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==l?l:m.weekStartsOn)&&void 0!==o?o:null===(h=m.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.weekStartsOn)&&void 0!==n?n:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,i.default)(e),x=g.getDay(),y=(x<f?7:0)+x-f;return g.setDate(g.getDate()-y),g.setHours(0,0,0,0),g}},407:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(5780),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getTime()===s.getTime()}},579:(e,t,n)=>{"use strict";e.exports=n(1153)},775:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(2284),r=n(6260),s=n(3666);function a(e){var t,n;if((0,s.A)(1,arguments),e&&"function"===typeof e.forEach)t=e;else{if("object"!==(0,i.A)(e)||null===e)return new Date(NaN);t=Array.prototype.slice.call(e)}return t.forEach(function(e){var t=(0,r.default)(e);(void 0===n||n>t||isNaN(t.getDate()))&&(n=t)}),n||new Date(NaN)}},779:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var i=n(2284),r=n(6260),s=n(3778),a=n(8355),o=n(3666);function l(e,t){if((0,o.A)(2,arguments),"object"!==(0,i.A)(t)||null===t)throw new RangeError("values parameter must be an object");var n=(0,r.default)(e);return isNaN(n.getTime())?new Date(NaN):(null!=t.year&&n.setFullYear(t.year),null!=t.month&&(n=(0,s.default)(n,t.month)),null!=t.date&&n.setDate((0,a.A)(t.date)),null!=t.hours&&n.setHours((0,a.A)(t.hours)),null!=t.minutes&&n.setMinutes((0,a.A)(t.minutes)),null!=t.seconds&&n.setSeconds((0,a.A)(t.seconds)),null!=t.milliseconds&&n.setMilliseconds((0,a.A)(t.milliseconds)),n)}},812:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),a=(0,i.A)(t);return n.setMinutes(a),n}},816:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(2284);function r(e){var t=function(e,t){if("object"!=(0,i.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=(0,i.A)(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,i.A)(t)?t:t+""}},879:function(e,t,n){var i=n(1847).default;const r=["data"],s=["data"];e.exports=function(){"use strict";var e,t,n;function a(i,r){if(e)if(t){var s="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",a={};e(a),n=r(a),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([s],{type:"text/javascript"})))}else t=r;else e=r}return a(["exports"],function(e){var t=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;function i(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n*s-r*i;return a?(e[0]=s*(a=1/a),e[1]=-i*a,e[2]=-r*a,e[3]=n*a,e):null}function r(){var e=new n(9);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function s(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],d=t[8];return e[0]=a*d-o*c,e[1]=r*c-i*d,e[2]=i*o-r*a,e[3]=o*l-s*d,e[4]=n*d-r*l,e[5]=r*s-n*o,e[6]=s*c-a*l,e[7]=i*l-n*c,e[8]=n*a-i*s,e}function a(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=n[0],p=n[1],m=n[2],f=n[3],g=n[4],x=n[5],y=n[6],v=n[7],_=n[8];return e[0]=h*i+p*a+m*c,e[1]=h*r+p*o+m*d,e[2]=h*s+p*l+m*u,e[3]=f*i+g*a+x*c,e[4]=f*r+g*o+x*d,e[5]=f*s+g*l+x*u,e[6]=y*i+v*a+_*c,e[7]=y*r+v*o+_*d,e[8]=y*s+v*l+_*u,e}function o(){var e=new n(16);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],d=t[8],u=t[9],h=t[10],p=t[11],m=t[12],f=t[13],g=t[14],x=t[15],y=n*o-i*a,v=n*l-r*a,_=n*c-s*a,b=i*l-r*o,w=i*c-s*o,j=r*c-s*l,N=d*f-u*m,S=d*g-h*m,k=d*x-p*m,T=u*g-h*f,C=u*x-p*f,E=h*x-p*g,A=y*E-v*C+_*T+b*k-w*S+j*N;return A?(e[0]=(o*E-l*C+c*T)*(A=1/A),e[1]=(r*C-i*E-s*T)*A,e[2]=(f*j-g*w+x*b)*A,e[3]=(h*w-u*j-p*b)*A,e[4]=(l*k-a*E-c*S)*A,e[5]=(n*E-r*k+s*S)*A,e[6]=(g*_-m*j-x*v)*A,e[7]=(d*j-h*_+p*v)*A,e[8]=(a*C-o*k+c*N)*A,e[9]=(i*k-n*C-s*N)*A,e[10]=(m*w-f*_+x*y)*A,e[11]=(u*_-d*w-p*y)*A,e[12]=(o*S-a*T-l*N)*A,e[13]=(n*T-i*S+r*N)*A,e[14]=(f*v-m*b-g*y)*A,e[15]=(d*b-u*v+h*y)*A,e):null}function d(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=t[9],p=t[10],m=t[11],f=t[12],g=t[13],x=t[14],y=t[15],v=n[0],_=n[1],b=n[2],w=n[3];return e[0]=v*i+_*o+b*u+w*f,e[1]=v*r+_*l+b*h+w*g,e[2]=v*s+_*c+b*p+w*x,e[3]=v*a+_*d+b*m+w*y,e[4]=(v=n[4])*i+(_=n[5])*o+(b=n[6])*u+(w=n[7])*f,e[5]=v*r+_*l+b*h+w*g,e[6]=v*s+_*c+b*p+w*x,e[7]=v*a+_*d+b*m+w*y,e[8]=(v=n[8])*i+(_=n[9])*o+(b=n[10])*u+(w=n[11])*f,e[9]=v*r+_*l+b*h+w*g,e[10]=v*s+_*c+b*p+w*x,e[11]=v*a+_*d+b*m+w*y,e[12]=(v=n[12])*i+(_=n[13])*o+(b=n[14])*u+(w=n[15])*f,e[13]=v*r+_*l+b*h+w*g,e[14]=v*s+_*c+b*p+w*x,e[15]=v*a+_*d+b*m+w*y,e}function u(e,t,n){var i,r,s,a,o,l,c,d,u,h,p,m,f=n[0],g=n[1],x=n[2];return t===e?(e[12]=t[0]*f+t[4]*g+t[8]*x+t[12],e[13]=t[1]*f+t[5]*g+t[9]*x+t[13],e[14]=t[2]*f+t[6]*g+t[10]*x+t[14],e[15]=t[3]*f+t[7]*g+t[11]*x+t[15]):(r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=t[9],p=t[10],m=t[11],e[0]=i=t[0],e[1]=r,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=c,e[7]=d,e[8]=u,e[9]=h,e[10]=p,e[11]=m,e[12]=i*f+o*g+u*x+t[12],e[13]=r*f+l*g+h*x+t[13],e[14]=s*f+c*g+p*x+t[14],e[15]=a*f+d*g+m*x+t[15]),e}function h(e,t,n){var i=n[0],r=n[1],s=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],d=t[9],u=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+c*i,e[5]=a*r+d*i,e[6]=o*r+u*i,e[7]=l*r+h*i,e[8]=c*r-s*i,e[9]=d*r-a*i,e[10]=u*r-o*i,e[11]=h*r-l*i,e}function m(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],a=t[1],o=t[2],l=t[3],c=t[8],d=t[9],u=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-c*i,e[1]=a*r-d*i,e[2]=o*r-u*i,e[3]=l*r-h*i,e[8]=s*i+c*r,e[9]=a*i+d*r,e[10]=o*i+u*r,e[11]=l*i+h*r,e}function f(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],a=t[1],o=t[2],l=t[3],c=t[4],d=t[5],u=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+c*i,e[1]=a*r+d*i,e[2]=o*r+u*i,e[3]=l*r+h*i,e[4]=c*r-s*i,e[5]=d*r-a*i,e[6]=u*r-o*i,e[7]=h*r-l*i,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,n,i){var r,s,a,o=i[0],l=i[1],c=i[2],d=Math.hypot(o,l,c);return d<t?null:(o*=d=1/d,l*=d,c*=d,r=Math.sin(n),s=Math.cos(n),e[0]=o*o*(a=1-s)+s,e[1]=l*o*a+c*r,e[2]=c*o*a-l*r,e[3]=0,e[4]=o*l*a-c*r,e[5]=l*l*a+s,e[6]=c*l*a+o*r,e[7]=0,e[8]=o*c*a+l*r,e[9]=l*c*a-o*r,e[10]=c*c*a+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function y(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n+n,o=i+i,l=r+r,c=n*a,d=i*a,u=i*o,h=r*a,p=r*o,m=r*l,f=s*a,g=s*o,x=s*l;return e[0]=1-u-m,e[1]=d+x,e[2]=h-g,e[3]=0,e[4]=d-x,e[5]=1-c-m,e[6]=p+f,e[7]=0,e[8]=h+g,e[9]=p-f,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var v=d;function _(){var e=new n(3);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function w(e){return Math.hypot(e[0],e[1],e[2])}function j(e,t,i){var r=new n(3);return r[0]=e,r[1]=t,r[2]=i,r}function N(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function S(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function k(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function T(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function C(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function E(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function A(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function M(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function D(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function I(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function P(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function R(e,t){var n=t[0],i=t[1],r=t[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function L(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function z(e,t,n){var i=t[0],r=t[1],s=t[2],a=n[0],o=n[1],l=n[2];return e[0]=r*l-s*o,e[1]=s*a-i*l,e[2]=i*o-r*a,e}function O(e,t,n,i){var r=t[0],s=t[1],a=t[2];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=a+i*(n[2]-a),e}function F(e,t,n){var i=t[0],r=t[1],s=t[2],a=n[3]*i+n[7]*r+n[11]*s+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/(a=a||1),e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/a,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/a,e}function B(e,t,n){var i=t[0],r=t[1],s=t[2];return e[0]=i*n[0]+r*n[3]+s*n[6],e[1]=i*n[1]+r*n[4]+s*n[7],e[2]=i*n[2]+r*n[5]+s*n[8],e}function V(e,t,n){var i=n[0],r=n[1],s=n[2],a=t[0],o=t[1],l=t[2],c=r*l-s*o,d=s*a-i*l,u=i*o-r*a,h=r*u-s*d,p=s*c-i*u,m=i*d-r*c,f=2*n[3];return d*=f,u*=f,p*=2,m*=2,e[0]=a+(c*=f)+(h*=2),e[1]=o+d+p,e[2]=l+u+m,e}function U(e){return e[0]=0,e[1]=0,e[2]=0,e}function H(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var q=k,W=T,G=w;function Y(){var e=new n(4);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Z(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function X(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n*n+i*i+r*r+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=i*a,e[2]=r*a,e[3]=s*a,e}function K(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*a,e[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*a,e[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*a,e[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*a,e}function Q(){var e=new n(4);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function J(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function $(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+a*o,e[1]=r*l+s*o,e[2]=s*l-r*o,e[3]=a*l-i*o,e}function ee(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l-s*o,e[1]=r*l+a*o,e[2]=s*l+i*o,e[3]=a*l-r*o,e}_(),Y();var te,ne,ie,re=X,se=(te=_(),ne=j(1,0,0),ie=j(0,1,0),function(e,t,n){var i=L(t,n);return i<-.999999?(z(te,ne,t),G(te)<1e-6&&z(te,ie,t),R(te,te),function(e,t,n){n*=.5;var i=Math.sin(n);e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n)}(e,te,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(z(te,t,n),e[0]=te[0],e[1]=te[1],e[2]=te[2],e[3]=1+i,re(e,e))});function ae(){var e=new n(2);return n!=Float32Array&&(e[0]=0,e[1]=0),e}function oe(e,t){var i=new n(2);return i[0]=e,i[1]=t,i}function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ce(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function de(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function ue(e){return Math.hypot(e[0],e[1])}function he(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e}function pe(e,t){return e[0]*t[0]+e[1]*t[1]}Q(),Q(),r();var me,fe,ge=ce;function xe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}ae();var ye=function(){if(fe)return me;function e(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}return fe=1,me=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=r/s}var a=0,o=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?a=n:o=n,n=.5*(o-a)+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},me}(),ve=xe(ye);function _e(e,t){this.x=e,this.y=t}function be(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!be(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!be(e[n],t[n]))return!1;return!0}return e===t}_e.prototype={clone(){return new _e(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround(e,t){const n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:_e},_e.convert=function(e){if(e instanceof _e)return e;if(Array.isArray(e))return new _e(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new _e(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};const we=Math.PI/180,je=180/Math.PI;function Ne(e){return e*we}function Se(e){return e*je}const ke=[[0,0],[1,0],[1,1],[0,1]];function Te(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Ce(e,t,n,i){const r=new ve(e,t,n,i);return function(e){return r.solve(e)}}const Ee=Ce(.25,.1,.25,1);function Ae(e,t,n){return Math.min(n,Math.max(t,e))}function Me(e,t,n){return(n=Ae((n-e)/(t-e),0,1))*n*(3-2*n)}function De(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function Ie(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const r=new Array(e.length);let s=null;e.forEach((e,a)=>{t(e,(e,t)=>{e&&(s=e),r[a]=t,0==--i&&n(s,r)})})}function Pe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}let Re=1;function Le(){return Re++}function ze(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Oe(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function Fe(e,t,n){const i={};for(const r in e)i[r]=t.call(this,e[r],r,e);return i}function Be(e,t,n){const i={};for(const r in e)t.call(this,e[r],r,e)&&(i[r]=e[r]);return i}function Ve(e){return Array.isArray(e)?e.map(Ve):"object"==typeof e&&e?Fe(e,Ve):e}function Ue(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}const He={};function qe(e){He[e]||("undefined"!=typeof console&&console.warn(e),He[e]=!0)}function We(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Ge(e){let t=0;for(let n,i,r=0,s=e.length,a=s-1;r<s;a=r++)n=e[r],i=e[a],t+=(i.x-n.x)*(n.y+i.y);return t}function Ye(e){let[t,n,i]=e;const r=Ne(n+90),s=Ne(i);return{x:t*Math.cos(r)*Math.sin(s),y:t*Math.sin(r)*Math.sin(s),z:t*Math.cos(s),azimuthal:n,polar:i}}function Ze(e){return("undefined"!=typeof self||void 0!==e)&&"undefined"!=typeof WorkerGlobalScope&&(void 0!==e?e:self)instanceof WorkerGlobalScope}function Xe(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,n,i,r)=>{const s=i||r;return t[n]=!s||s.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let Ke=null;function Qe(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Je(e,t,n,i){for(;t<n;){const r=t+n>>1;e[r]<i?t=r+1:n=r}return t}function $e(e,t,n,i){for(;t<n;){const r=t+n>>1;e[r]<=i?t=r+1:n=r}return t}function et(e){return e>0?1/(1.001-e):1+e}function tt(e){return e>0?1-1/(1.001-e):-e}function nt(e,t,n){return(e-t.min)*(n.max-n.min)/(t.max-t.min)+n.min}const it={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!it.API_URL)return null;try{const e=new URL(it.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function rt(e){return it.API_URL_REGEX.test(e)}function st(e){return it.API_SPRITE_REGEX.test(e)}let at,ot,lt,ct,dt,ut;function ht(){return null==at&&(at=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),at}const pt={now:()=>void 0!==ct?ct:performance.now(),setNow(e){ct=e},restoreNow(){ct=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:n,height:i}=e;dt||(dt=document.createElement("canvas"));const r=dt.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(n>dt.width||i>dt.height)&&(dt.width=n,dt.height=i),r.clearRect(-t,-t,n+2*t,i+2*t),r.drawImage(e,0,0,n,i),r.getImageData(-t,-t,n+2*t,i+2*t)},resolveURL:e=>(ot||(ot=document.createElement("a")),ot.href=e,ot.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==lt&&(lt=window.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)},hasCanvasFingerprintNoise(){if(void 0!==ut)return ut;if(!ht())return ut=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let n=0;for(let r=0;r<e.width;++r)t.fillStyle="rgba(".concat(n++,",").concat(n++,",").concat(n++,", 255)"),t.fillRect(r,0,1,1);const i=t.getImageData(0,0,e.width,e.height);n=0;for(let r=0;r<i.data.length;++r)if(r%4!=3&&n++!==i.data[r])return ut=!0,!0;return ut=!1,!1}};function mt(e,t){const n=e.indexOf("?");if(n<0)return"".concat(e,"?").concat(new URLSearchParams(t).toString());const i=new URLSearchParams(e.slice(n));for(const r in t)i.set(r,t[r]);return"".concat(e.slice(0,n),"?").concat(i.toString())}function ft(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const n=e.indexOf("?");if(n<0)return e;const i=new URLSearchParams,r=new URLSearchParams(e.slice(n));for(const a of t.persistentParams){const e=r.get(a);e&&i.set(a,e)}const s=i.toString();return"".concat(e.slice(0,n)).concat(s.length>0?"?".concat(s):"")}const gt="mapbox-tiles";let xt=500,yt=50;const vt=["language","worldview","jobid"];let _t,bt;function wt(){try{return caches}catch(e){}}function jt(){const e=wt();e&&null==_t&&(_t=e.open(gt))}let Nt=1/0;const St={supported:!1,testSupport:function(e){!Ct&&Tt&&(Et?Mt(e):kt=e)}};let kt,Tt,Ct=!1,Et=!1;const At="undefined"!=typeof self?self:{};function Mt(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Tt),e.isContextLost())return;St.supported=!0}catch(e){}e.deleteTexture(t),Ct=!0}At.document&&(Tt=At.document.createElement("img"),Tt.onload=function(){kt&&Mt(kt),kt=null,Et=!0},Tt.onerror=function(){Ct=!0,kt=null},Tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Dt);class It extends Error{constructor(e,t,n){401===t&&rt(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const Pt=Ze()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Rt=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Pt())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new AbortController,i=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Pt(),referrerPolicy:e.referrerPolicy,signal:n.signal});let r=!1,s=!1;const a=(o=i.url).indexOf("sku=")>0&&rt(o);var o;"json"===e.type&&i.headers.set("Accept","application/json");const l=(n,r,o)=>{if(s)return;if(n&&"SecurityError"!==n.message&&qe(n.toString()),r&&o)return c(r);const l=Date.now();fetch(i).then(n=>{if(n.ok){const e=a?n.clone():null;return c(n,e,l)}return t(new It(n.statusText,n.status,e.url))}).catch(n=>{"AbortError"!==n.name&&t(new Error("".concat(n.message," ").concat(e.url)))})},c=(n,a,o)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then(e=>{s||(a&&o&&function(e,t,n){if(jt(),null==_t)return;const i=Xe(t.headers.get("Cache-Control")||"");if(i["no-store"])return;const r={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach((e,t)=>r.headers.set(t,e)),i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString());const s=r.headers.get("Expires");if(!s)return;if(new Date(s).getTime()-n<42e4)return;let a=ft(e.url,{persistentParams:vt});if(206===t.status){const t=e.headers.get("Range");if(!t)return;r.status=200,a=mt(a,{range:t})}!function(e,t){if(void 0===bt)try{new Response(new ReadableStream),bt=!0}catch(e){bt=!1}bt?t(e.body):e.blob().then(t).catch(e=>qe(e.message))}(t,e=>{const n=new Response(200!==(i=t.status)&&404!==i&&[101,103,204,205,304].includes(i)?null:e,r);var i;jt(),null!=_t&&_t.then(e=>e.put(a,n)).catch(e=>qe(e.message))})}(i,a,o),r=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))}).catch(e=>{s||t(new Error(e.message))})};return a?function(e,t){if(jt(),null==_t)return t(null);_t.then(n=>{let i=ft(e.url,{persistentParams:vt});const r=e.headers.get("Range");r&&(i=mt(i,{range:r})),n.match(i).then(e=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=Xe(e.headers.get("Cache-Control")||"");return Number(t)>Date.now()&&!n["no-cache"]}(e);n.delete(i).catch(t),r&&n.put(i,e.clone()).catch(t),t(null,e,r)}).catch(t)}).catch(t)}(i,l):l(null,null),{cancel:()=>{s=!0,r||n.abort()}}}(e,t);if(Ze(self)&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){const n=new XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const i in e.headers)n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new It(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},Lt=function(e,t){return Rt(Pe(e,{type:"arrayBuffer"}),t)};function zt(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const Ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ft,Bt;Ft=[],Bt=0;const Vt=function(e,t){if(St.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Bt>=it.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Ft.push(n),n}Bt++;let n=!1;const i=()=>{if(!n)for(n=!0,Bt--;Ft.length&&Bt<it.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Ft.shift(),{requestParameters:t,callback:n,cancelled:i}=e;i||(e.cancel=Vt(t,n).cancel)}},r=Lt(e,(e,n,r,s)=>{i(),e?t(e):n&&(self.createImageBitmap?function(e,t){const n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then(e=>{t(null,e)}).catch(e=>{t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}(n,(e,n)=>t(e,n,r,s)):function(e,t){const n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,requestAnimationFrame(()=>{n.src=Ot})},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?URL.createObjectURL(i):Ot}(n,(e,n)=>t(e,n,r,s)))});return{cancel:()=>{r.cancel(),i()}}};var Ut,Ht,qt,Wt={exports:{}},Gt={exports:{}},Yt={exports:{}},Zt=function(){if(qt)return Wt.exports;qt=1;var e=(Ut||(Ut=1,Gt.exports=function(e,t){var n,i,r,s,a,o,l,c;for(i=e.length-(n=3&e.length),r=t,a=3432918353,o=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(s=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}),Gt.exports),t=(Ht||(Ht=1,Yt.exports=function(e,t){for(var n,i=e.length,r=t^i,s=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(s)|(255&e.charCodeAt(++s))<<8|(255&e.charCodeAt(++s))<<16|(255&e.charCodeAt(++s))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++s;switch(i){case 3:r^=(255&e.charCodeAt(s+2))<<16;case 2:r^=(255&e.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}),Yt.exports);return Wt.exports=e,Wt.exports.murmur3=e,Wt.exports.murmur2=t,Wt.exports}(),Xt=xe(Zt);class Kt{constructor(e){Pe(this,(arguments.length<=1?void 0:arguments[1])||{}),this.type=e}}class Qt extends Kt{constructor(e){super("error",Pe({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}function Jt(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function $t(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class en{on(e,t){return this._listeners=this._listeners||{},Jt(e,t,this._listeners),this}off(e,t){return $t(e,t,this._listeners),$t(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(e,t,this._oneTimeListeners),this):new Promise(t=>{this.once(e,t)})}fire(e,t){const n="string"==typeof e?new Kt(e,t):e,i=n.type;if(this.listens(i)){n.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,n);const t=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const s of t)$t(i,s,this._oneTimeListeners),s.call(this,n);const r=this._eventedParent;r&&(Pe(n,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(n))}else n instanceof Qt&&console.error(n.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}class tn{constructor(e){"string"==typeof e?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new tn(e)}static toString(e){return e.iconsetId?"".concat(e.name,"\x1f").concat(e.iconsetId):e.name}static parse(e){const[t,n]=e.split("\x1f");return new tn({name:t,iconsetId:n})}static isEqual(e,t){return e.name===t.name&&e.iconsetId===t.iconsetId}toString(){return tn.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var nn,rn={},sn=function(){if(nn)return rn;nn=1;var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return t("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function i(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function r(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{rn.parseCSSColor=function(s){var a,o=s.replace(/ /g,"").toLowerCase();if(o in e)return e[o].slice();if("#"===o[0])return 4===o.length?(a=parseInt(o.substr(1),16))>=0&&a<=4095?[(3840&a)>>4|(3840&a)>>8,240&a|(240&a)>>4,15&a|(15&a)<<4,1]:null:7===o.length&&(a=parseInt(o.substr(1),16))>=0&&a<=16777215?[(16711680&a)>>16,(65280&a)>>8,255&a,1]:null;var l=o.indexOf("("),c=o.indexOf(")");if(-1!==l&&c+1===o.length){var d=o.substr(0,l),u=o.substr(l+1,c-(l+1)).split(","),h=1;switch(d){case"rgba":if(4!==u.length)return null;h=i(u.pop());case"rgb":return 3!==u.length?null:[n(u[0]),n(u[1]),n(u[2]),h];case"hsla":if(4!==u.length)return null;h=i(u.pop());case"hsl":if(3!==u.length)return null;var p=(parseFloat(u[0])%360+360)%360/360,m=i(u[1]),f=i(u[2]),g=f<=.5?f*(m+1):f+m-f*m,x=2*f-g;return[t(255*r(x,g,p+1/3)),t(255*r(x,g,p)),t(255*r(x,g,p-1/3)),h];default:return null}}return null}}catch(e){}return rn}();class an{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof an)return e;if("string"!=typeof e)return;const t=sn.parseCSSColor(e);return t?new an(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}toString(){const[e,t,n,i]=[this.r,this.g,this.b,this.a];return"rgba(".concat(Math.round(255*e),",").concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(i,")")}toNonPremultipliedRenderColor(e){const{r:t,g:n,b:i,a:r}=this;return new ln(e,t,n,i,r)}toPremultipliedRenderColor(e){const{r:t,g:n,b:i,a:r}=this;return new cn(e,t*r,n*r,i*r,r)}clone(){return new an(this.r,this.g,this.b,this.a)}}class on{constructor(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.premultiplied=!1,this.premultiplied=s,e){const s=e.image.height,a=s*s;this.premultiplied?(t=0===r?0:t/r*(s-1),n=0===r?0:n/r*(s-1),i=0===r?0:i/r*(s-1)):(t*=s-1,n*=s-1,i*=s-1);const o=Math.floor(t),l=Math.floor(n),c=Math.floor(i),d=Math.ceil(t),u=Math.ceil(n),h=Math.ceil(i),p=t-o,m=n-l,f=i-c,g=e.image.data,x=4*(o+l*a+c*s),y=4*(o+l*a+h*s),v=4*(o+u*a+c*s),_=4*(o+u*a+h*s),b=4*(d+l*a+c*s),w=4*(d+l*a+h*s),j=4*(d+u*a+c*s),N=4*(d+u*a+h*s);if(x<0||N>=g.length)throw new Error("out of range");this.r=dn(dn(dn(g[x],g[y],f),dn(g[v],g[_],f),m),dn(dn(g[b],g[w],f),dn(g[j],g[N],f),m),p)/255*(this.premultiplied?r:1),this.g=dn(dn(dn(g[x+1],g[y+1],f),dn(g[v+1],g[_+1],f),m),dn(dn(g[b+1],g[w+1],f),dn(g[j+1],g[N+1],f),m),p)/255*(this.premultiplied?r:1),this.b=dn(dn(dn(g[x+2],g[y+2],f),dn(g[v+2],g[_+2],f),m),dn(dn(g[b+2],g[w+2],f),dn(g[j+2],g[N+2],f),m),p)/255*(this.premultiplied?r:1),this.a=r}else this.r=t,this.g=n,this.b=i,this.a=r}toArray(){const{r:e,g:t,b:n,a:i}=this;return[255*e,255*t,255*n,i]}toHslaArray(){let{r:e,g:t,b:n,a:i}=this;if(this.premultiplied){if(0===i)return[0,0,0,0];e/=i,t/=i,n/=i}const r=Math.min(Math.max(e,0),1),s=Math.min(Math.max(t,0),1),a=Math.min(Math.max(n,0),1),o=Math.min(r,s,a),l=Math.max(r,s,a),c=(o+l)/2;if(o===l)return[0,0,100*c,i];const d=l-o,u=c>.5?d/(2-l-o):d/(l+o);let h=0;return l===r?h=(s-a)/d+(s<a?6:0):l===s?h=(a-r)/d+2:l===a&&(h=(r-s)/d+4),h*=60,[Math.min(Math.max(h,0),360),Math.min(Math.max(100*u,0),100),Math.min(Math.max(100*c,0),100),i]}toArray01(){const{r:e,g:t,b:n,a:i}=this;return[e,t,n,i]}toArray01Scaled(e){const{r:t,g:n,b:i}=this;return[t*e,n*e,i*e]}toArray01Linear(){const{r:e,g:t,b:n,a:i}=this;return[Math.pow(e,2.2),Math.pow(t,2.2),Math.pow(n,2.2),i]}}class ln extends on{constructor(e,t,n,i,r){super(e,t,n,i,r,!1)}}class cn extends on{constructor(e,t,n,i,r){super(e,t,n,i,r,!0)}}function dn(e,t,n){return e*(1-n)+t*n}function un(e,t,n){return e.map((e,i)=>dn(e,t[i],n))}an.black=new an(0,0,0,1),an.white=new an(1,1,1,1),an.transparent=new an(0,0,0,0),an.red=new an(1,0,0,1),an.blue=new an(0,0,1,1);var hn=Object.freeze({__proto__:null,array:un,color:function(e,t,n){return new an(dn(e.r,t.r,n),dn(e.g,t.g,n),dn(e.b,t.b,n),dn(e.a,t.a,n))},number:dn});function pn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}class mn extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class fn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new fn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gn={kind:"null"},xn={kind:"number"},yn={kind:"string"},vn={kind:"boolean"},_n={kind:"color"},bn={kind:"object"},wn={kind:"value"},jn={kind:"collator"},Nn={kind:"formatted"},Sn={kind:"resolvedImage"};function kn(e,t){return{kind:"array",itemType:e,N:t}}function Tn(e){if("array"===e.kind){const t=Tn(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const Cn=[gn,xn,yn,vn,_n,Nn,bn,kn(wn),Sn];function En(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!En(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Cn)if(!En(e,t))return null}return"Expected ".concat(Tn(e)," but found ").concat(Tn(t)," instead.")}function An(e,t){return t.some(t=>t.kind===e.kind)}function Mn(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function Dn(e,t){return"array"===e.kind&&"array"===t.kind?e.N===t.N&&Dn(e.itemType,t.itemType):e.kind===t.kind}class In{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pn{constructor(e,t,n,i,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class Rn{constructor(e){this.sections=e}static fromString(e){return new Rn([new Pn(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Rn?e:Rn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){const n=t.image.getPrimary().id.toString();e.push(["image",n]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(n)}return e}}class Ln{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.id=tn.from(e),this.options=Object.assign({},t),t.transform){const{a:e,b:n,c:i,d:r,e:s,f:a}=t.transform;this.options.transform=new DOMMatrix([e,n,i,r,s,a])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:t,c:n,d:i,e:r,f:s}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:t,c:n,d:i,e:r,f:s}})}static parse(e){let t,n,i,r;try{({name:t,iconsetId:n,params:i,transform:r}=JSON.parse(e)||{})}catch(e){return null}if(!t)return null;const{a:s,b:a,c:o,d:l,e:c,f:d}=r||{};return new Ln({name:t,iconsetId:n},{params:i,transform:new DOMMatrix([s,a,o,l,c,d])})}scaleSelf(e,t){return this.options.transform.scaleSelf(e,t),this}}class zn{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.primaryId=tn.from(e),this.primaryOptions=t,n&&(this.secondaryId=tn.from(n)),this.secondaryOptions=i,this.available=r}toString(){return this.primaryId&&this.secondaryId?"[".concat(this.primaryId.name,",").concat(this.secondaryId.name,"]"):this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ln(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ln(this.secondaryId,this.secondaryOptions):null}static from(e){return"string"==typeof e?zn.build({name:e}):e}static build(e,t,n,i){return!e||"object"==typeof e&&!("name"in e)?null:new zn(e,n,t,i)}}function On(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Fn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof an)return!0;if(e instanceof In)return!0;if(e instanceof Rn)return!0;if(e instanceof zn)return!0;if(Array.isArray(e)){for(const t of e)if(!Fn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Fn(e[t]))return!1;return!0}return!1}function Bn(e){if(null===e)return gn;if("string"==typeof e)return yn;if("boolean"==typeof e)return vn;if("number"==typeof e)return xn;if(e instanceof an)return _n;if(e instanceof In)return jn;if(e instanceof Rn)return Nn;if(e instanceof zn)return Sn;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const e=Bn(i);if(n){if(n===e)continue;n=wn;break}n=e}return kn(n||wn,t)}return bn}function Vn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Rn||e instanceof zn||e instanceof an?e.toString():JSON.stringify(e)}class Un{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!Fn(e[1]))return t.error("invalid value");const n=e[1];let i=Bn(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new Un(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof an?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Rn?this.value.serialize():this.value}}class Hn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const qn={string:yn,number:xn,boolean:vn,object:bn};class Wn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,s;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in qn)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=qn[n],i++}else r=wn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);s=e[2],i++}n=kn(r,s)}else n=qn[r];const s=[];for(;i<e.length;i++){const n=t.parse(e[i],i,wn);if(!n)return null;s.push(n)}return new Wn(n,s)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!En(this.type,Bn(n)))return n;if(t===this.args.length-1)throw new Hn("The expression ".concat(JSON.stringify(this.args[t].serialize())," evaluated to ").concat(Tn(Bn(n))," but was expected to be of type ").concat(Tn(this.type),"."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map(e=>e.serialize()))}}class Gn{constructor(e){this.type=Nn,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let s=1;s<=e.length-1;++s){const n=e[s];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let e=null;if(n["font-scale"]&&(e=t.parseObjectValue(n["font-scale"],s,"font-scale",xn),!e))return null;let a=null;if(n["text-font"]&&(a=t.parseObjectValue(n["text-font"],s,"text-font",kn(yn)),!a))return null;let o=null;if(n["text-color"]&&(o=t.parseObjectValue(n["text-color"],s,"text-color",_n),!o))return null;const l=i[i.length-1];l.scale=e,l.font=a,l.textColor=o}else{const n=t.parse(e[s],s,wn);if(!n)return null;const a=n.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new Gn(i)}evaluate(e){return new Rn(this.sections.map(t=>{const n=t.content.evaluate(e);return Dn(Bn(n),Sn)?new Pn("",n,null,null,null):new Pn(Vn(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Yn{constructor(e,t,n,i){this._imageWarnHistory={},this.type=Sn,this.namePrimary=e,this.nameSecondary=t,n&&(this.paramsPrimary=n.params,this.iconsetIdPrimary=n.iconset?n.iconset.id:void 0),i&&(this.paramsSecondary=i.params,this.iconsetIdSecondary=i.iconset?i.iconset.id:void 0)}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");let n=1;const i=[];function r(){if(n<e.length){const r=t.parse(e[n],n++,yn);return r?(i.push({image:r,options:{}}),!0):(t.error(i.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function s(){if(n<e.length){const s=e[n];if(null===(r=s)||"object"!=typeof r||Array.isArray(r))return!0;const a=s.params,o=s.iconset,l=t.concat(n);if(!a&&!o)return n++,!0;if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "params" should be an object'),!1;const e={},t=l.concat(void 0,"params");for(const n in a){if(!n)return t.error("Image parameter name should be non-empty"),!1;const i=t.concat(void 0,n).parse(a[n],void 0,_n,void 0,{typeAnnotation:"coerce"});if(!i)return!1;e[n]=i}i[i.length-1].options.params=e}if(o){if("object"!=typeof o||o.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!o.id)return l.error('Image options "iconset" should have an "id" property'),!1;i[i.length-1].options.iconset=o}return n++,!0}var r;return!0}for(let a=0;a<2;a++)if(!r()||!s())return;return new Yn(i[0].image,i[1]?i[1].image:void 0,i[0].options,i[1]?i[1].options:void 0)}evaluateParams(e,t){const n={};if(t){for(const i in t)if(t[i])try{n[i]=t[i].evaluate(e)}catch(e){continue}if(0!==Object.keys(n).length)return{params:n}}}evaluate(e){const t={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},n=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,i=zn.build(t,n,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(i&&e.availableImages){const t=i.getPrimary().id;if(i.available=e.availableImages.some(e=>tn.isEqual(e,t)),i.available){const t=i.getSecondary()?i.getSecondary().id:null;t&&(i.available=e.availableImages.some(e=>tn.isEqual(e,t)))}}return i}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const t in this.paramsPrimary)this.paramsPrimary[t]&&e(this.paramsPrimary[t]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const t in this.paramsSecondary)this.paramsSecondary[t]&&e(this.paramsSecondary[t])}outputDefined(){return!1}serializeOptions(e,t){const n={};if(t&&(n.iconset={id:t}),e){n.params={};for(const t in e)e[t]&&(n.params[t]=e[t].serialize())}return Object.keys(n).length>0?n:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const t=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);t&&e.push(t)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const t=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);t&&e.push(t)}return e}}function Zn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Xn={"to-boolean":vn,"to-color":_n,"to-number":xn,"to-string":yn};class Kn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0],i=[];let r=gn;if("to-array"===n){if(!Array.isArray(e[1]))return null;const n=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));r=kn(t.expectedType.itemType,n)}else{if(!(n>0&&Fn(e[1][0])))return null;r=kn(Bn(e[1][0]),n)}for(let s=0;s<n;s++){const n=e[1][s];let a;if("array"===Zn(n))a=t.parse(n,void 0,r.itemType);else{const e=Zn(n);if(e!==r.itemType.kind)return t.error("Expected ".concat(r.itemType.kind," but found ").concat(e,"."));a=t.registry.literal.parse(["literal",void 0===n?null:n],t)}if(!a)return null;i.push(a)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");r=Xn[n];for(let n=1;n<e.length;n++){const r=t.parse(e[n],n,wn);if(!r)return null;i.push(r)}}return new Kn(r,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof an)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):On(t[0],t[1],t[2],t[3]),!n))return new an(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Hn(n||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Hn("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?Rn.fromString(Vn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?zn.build(Vn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(t=>t.evaluate(e)):Vn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Gn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Yn(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Qn=["Unknown","Point","LineString","Polygon"];class Jn{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Qn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=an.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class $n{constructor(e,t,n,i,r){this.name=e,this.type=t,this._evaluate=n,this.args=i,this._overloadIndex=r}evaluate(e){if(!this._evaluate){const e=$n.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],i=$n.definitions[n];if(!i)return t.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,s=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=[];let o=null,l=-1;for(const[c,d]of s){if(Array.isArray(c)&&c.length!==e.length-1)continue;a.push(c),l++,o=new _r(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const i=[];let s=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(c)?c[t-1]:c.type,a=o.parse(n,1+i.length,r);if(!a){s=!0;break}i.push(a)}if(!s)if(Array.isArray(c)&&c.length!==i.length)o.error("Expected ".concat(c.length," arguments, but found ").concat(i.length," instead."));else{for(let e=0;e<i.length;e++){const t=Array.isArray(c)?c[e]:c.type,n=i[e];o.concat(e+1).checkSubtype(t,n.type)}if(0===o.errors.length)return new $n(n,r,d,i,l)}}if(1===a.length)t.errors.push(...o.errors);else{const n=(a.length?a:s.map(e=>{let[t]=e;return t})).map(ei).join(" | "),i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],1+i.length);if(!n)return null;i.push(Tn(n.type))}t.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(e,t){$n.definitions=t;for(const n in t)e[n]=$n}}function ei(e){return Array.isArray(e)?"(".concat(e.map(Tn).join(", "),")"):"(".concat(Tn(e.type),"...)")}class ti{constructor(e,t,n){this.type=jn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=void 0===n["case-sensitive"]?t.parse(!1,1,vn):t.parseObjectValue(n["case-sensitive"],1,"case-sensitive",vn);if(!i)return null;const r=void 0===n["diacritic-sensitive"]?t.parse(!1,1,vn):t.parseObjectValue(n["diacritic-sensitive"],1,"diacritic-sensitive",vn);if(!r)return null;let s=null;return n.locale&&(s=t.parseObjectValue(n.locale,1,"locale",yn),!s)?null:new ti(i,r,s)}evaluate(e){return new In(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ni(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ri;for(;i>n;){if(i-n>600){const s=i-n+1,a=t-n+1,o=Math.log(s),l=.5*Math.exp(2*o/3),c=.5*Math.sqrt(o*l*(s-l)/s)*(a-s/2<0?-1:1);ni(e,t,Math.max(n,Math.floor(t-a*l/s+c)),Math.min(i,Math.floor(t+(s-a)*l/s+c)),r)}const s=e[t];let a=n,o=i;for(ii(e,n,t),r(e[i],s)>0&&ii(e,n,i);a<o;){for(ii(e,a,o),a++,o--;r(e[a],s)<0;)a++;for(;r(e[o],s)>0;)o--}0===r(e[n],s)?ii(e,n,o):(o++,ii(e,o,i)),o<=t&&(n=o+1),t<=o&&(i=o-1)}}function ii(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function ri(e,t){return e<t?-1:e>t?1:0}function si(e){let t=0;for(let n,i,r=0,s=e.length,a=s-1;r<s;a=r++)n=e[r],i=e[a],t+=(i.x-n.x)*(n.y+i.y);return t}function ai(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function oi(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function li(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],s=e[0]-n[0],a=e[1]-n[1];return i*a-s*r==0&&i*s<=0&&r*a<=0}function ci(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(let o=0,l=t.length;o<l;o++){const l=t[o];for(let t=0,o=l.length,c=o-1;t<o;c=t++){const o=l[c],d=l[t];if(li(e,o,d))return n;(s=o)[1]>(r=e)[1]!=(a=d)[1]>r[1]&&r[0]<(a[0]-s[0])*(r[1]-s[1])/(a[1]-s[1])+s[0]&&(i=!i)}}var r,s,a;return i}function di(e,t,n,i){const r=i[0]-n[0],s=i[1]-n[1],a=(e[0]-n[0])*s-r*(e[1]-n[1]),o=(t[0]-n[0])*s-r*(t[1]-n[1]);return a>0&&o<0||a<0&&o>0}function ui(e,t,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(s=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*s[0]&&!(!di(e,t,n,i)||!di(n,i,e,t));var r,s}function hi(e){const t=new _e(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new _e(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const i of e[0])t.x>i.x&&(t.x=i.x),t.y>i.y&&(t.y=i.y),n.x<i.x&&(n.x=i.x),n.y<i.y&&(n.y=i.y);return{min:t,max:n}}const pi=8192;function mi(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*pi),Math.round(i*r*pi)]}function fi(e,t){for(let n=0;n<t.length;n++)if(ci(e,t[n]))return!0;return!1}function gi(e,t,n){for(const i of n)for(let n=0,r=i.length,s=r-1;n<r;s=n++)if(ui(e,t,i[s],i[n]))return!0;return!1}function xi(e,t){for(let n=0;n<e.length;++n)if(!ci(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(gi(e[n],e[n+1],t))return!1;return!0}function yi(e,t){for(let n=0;n<t.length;n++)if(xi(e,t[n]))return!0;return!1}function vi(e,t,n){const i=[];for(let r=0;r<e.length;r++){const s=[];for(let i=0;i<e[r].length;i++){const a=mi(e[r][i],n);ai(t,a),s.push(a)}i.push(s)}return i}function _i(e,t,n){const i=[];for(let r=0;r<e.length;r++){const s=vi(e[r],t,n);i.push(s)}return i}function bi(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}ai(t,e)}function wi(e,t,n,i){const r=Math.pow(2,i.z)*pi,s=[i.x*pi,i.y*pi],a=[];if(!e)return a;for(const o of e)for(const e of o){const i=[e.x+s[0],e.y+s[1]];bi(i,t,n,r),a.push(i)}return a}function ji(e,t,n,i){const r=Math.pow(2,i.z)*pi,s=[i.x*pi,i.y*pi],a=[];if(!e)return a;for(const l of e){const e=[];for(const n of l){const i=[n.x+s[0],n.y+s[1]];ai(t,i),e.push(i)}a.push(e)}if(t[2]-t[0]<=r/2){(o=t)[0]=o[1]=1/0,o[2]=o[3]=-1/0;for(const e of a)for(const i of e)bi(i,t,n,r)}var o;return a}class Ni{constructor(e,t){this.type=vn,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(Fn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Ni(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Ni(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Ni(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const s=vi(t.coordinates,i,r),a=wi(e.geometry(),n,i,r);if(!oi(n,i))return!1;for(const e of a)if(!ci(e,s))return!1}if("MultiPolygon"===t.type){const s=_i(t.coordinates,i,r),a=wi(e.geometry(),n,i,r);if(!oi(n,i))return!1;for(const e of a)if(!fi(e,s))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const s=vi(t.coordinates,i,r),a=ji(e.geometry(),n,i,r);if(!oi(n,i))return!1;for(const e of a)if(!xi(e,s))return!1}if("MultiPolygon"===t.type){const s=_i(t.coordinates,i,r),a=ji(e.geometry(),n,i,r);if(!oi(n,i))return!1;for(const e of a)if(!yi(e,s))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Si={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ki=1/298.257223563,Ti=ki*(2-ki),Ci=Math.PI/180;class Ei{static fromTile(e,t,n){const i=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),r=Math.atan(.5*(Math.exp(i)-Math.exp(-i)))/Ci;return new Ei(r,n)}static get units(){return Si}constructor(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!Si[t])throw new Error("Unknown unit ".concat(t,". Use one of: ").concat(Object.keys(Si).join(", ")));const n=6378.137*Ci*(t?Si[t]:1),i=Math.cos(e*Ci),r=1/(1-Ti*(1-i*i)),s=Math.sqrt(r);this.kx=n*s*i,this.ky=n*s*r*(1-Ti)}distance(e,t){const n=Di(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}bearing(e,t){const n=Di(t[0]-e[0])*this.kx;return Math.atan2(n,(t[1]-e[1])*this.ky)/Ci}destination(e,t,n){const i=n*Ci;return this.offset(e,Math.sin(i)*t,Math.cos(i)*t)}offset(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]}lineDistance(e){let t=0;for(let n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t}area(e){let t=0;for(let n=0;n<e.length;n++){const i=e[n];for(let e=0,r=i.length,s=r-1;e<r;s=e++)t+=Di(i[e][0]-i[s][0])*(i[e][1]+i[s][1])*(n?-1:1)}return Math.abs(t)/2*this.kx*this.ky}along(e,t){let n=0;if(t<=0)return e[0];for(let i=0;i<e.length-1;i++){const r=e[i],s=e[i+1],a=this.distance(r,s);if(n+=a,n>t)return Mi(r,s,(t-(n-a))/a)}return e[e.length-1]}pointToSegmentDistance(e,t,n){let[i,r]=t,s=Di(n[0]-i)*this.kx,a=(n[1]-r)*this.ky;if(0!==s||0!==a){const t=(Di(e[0]-i)*this.kx*s+(e[1]-r)*this.ky*a)/(s*s+a*a);t>1?(i=n[0],r=n[1]):t>0&&(i+=s/this.kx*t,r+=a/this.ky*t)}return s=Di(e[0]-i)*this.kx,a=(e[1]-r)*this.ky,Math.sqrt(s*s+a*a)}pointOnLine(e,t){let n=1/0,i=e[0][0],r=e[0][1],s=0,a=0;for(let o=0;o<e.length-1;o++){let l=e[o][0],c=e[o][1],d=Di(e[o+1][0]-l)*this.kx,u=(e[o+1][1]-c)*this.ky,h=0;0===d&&0===u||(h=(Di(t[0]-l)*this.kx*d+(t[1]-c)*this.ky*u)/(d*d+u*u),h>1?(l=e[o+1][0],c=e[o+1][1]):h>0&&(l+=d/this.kx*h,c+=u/this.ky*h)),d=Di(t[0]-l)*this.kx,u=(t[1]-c)*this.ky;const p=d*d+u*u;p<n&&(n=p,i=l,r=c,s=o,a=h)}return{point:[i,r],index:s,t:Math.max(0,Math.min(1,a))}}lineSlice(e,t,n){let i=this.pointOnLine(n,e),r=this.pointOnLine(n,t);if(i.index>r.index||i.index===r.index&&i.t>r.t){const e=i;i=r,r=e}const s=[i.point],a=i.index+1,o=r.index;!Ai(n[a],s[0])&&a<=o&&s.push(n[a]);for(let l=a+1;l<=o;l++)s.push(n[l]);return Ai(n[o],r.point)||s.push(r.point),s}lineSliceAlong(e,t,n){let i=0;const r=[];for(let s=0;s<n.length-1;s++){const a=n[s],o=n[s+1],l=this.distance(a,o);if(i+=l,i>e&&0===r.length&&r.push(Mi(a,o,(e-(i-l))/l)),i>=t)return r.push(Mi(a,o,(t-(i-l))/l)),r;i>e&&r.push(o)}return r}bufferPoint(e,t){const n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[0]+i,e[1]+n]}bufferBBox(e,t){const n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[2]+i,e[3]+n]}insideBBox(e,t){return Di(e[0]-t[0])>=0&&Di(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]}}function Ai(e,t){return e[0]===t[0]&&e[1]===t[1]}function Mi(e,t,n){const i=Di(t[0]-e[0]);return[e[0]+i*n,e[1]+(t[1]-e[1])*n]}function Di(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class Ii{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,s=t[r];if(n(i,s)>=0)break;t[e]=s,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1);const s=i+1;if(s<this.length&&n(t[s],t[i])<0&&(i=s),n(t[i],r)>=0)break;t[e]=t[i],e=i}t[e]=r}}var Pi=8192;function Ri(e,t){return t.dist-e.dist}const Li=100,zi=50;function Oi(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Fi(e){return e[1]-e[0]+1}function Bi(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function Vi(e,t){if(e[0]>e[1])return[null,null];const n=Fi(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===n)return[e,null];const t=Math.floor(n/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function Ui(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!Bi(t,e.length))return n;for(let i=t[0];i<=t[1];++i)ai(n,e[i]);return n}function Hi(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)ai(t,e[n][i]);return t}function qi(e,t,n){if(Oi(e)||Oi(t))return NaN;let i=0,r=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),n.distance([0,0],[i,r])}function Wi(e){return 360*e-180}function Gi(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Yi(e,t){const n=Math.pow(2,t.z),i=(e.y/Pi+t.y)/n;return[Wi((e.x/Pi+t.x)/n),Gi(i)]}function Zi(e,t){const n=[];for(let i=0;i<e.length;++i)n.push(Yi(e[i],t));return n}function Xi(e,t,n){const i=n.pointOnLine(t,e).point;return n.distance(e,i)}function Ki(e,t,n,i,r){const s=n.slice(i[0],i[1]+1);let a=1/0;for(let o=t[0];o<=t[1];++o)if(0===(a=Math.min(a,Xi(e[o],s,r))))return 0;return a}function Qi(e,t,n,i,r){const s=Math.min(r.pointToSegmentDistance(e,n,i),r.pointToSegmentDistance(t,n,i)),a=Math.min(r.pointToSegmentDistance(n,e,t),r.pointToSegmentDistance(i,e,t));return Math.min(s,a)}function Ji(e,t,n,i,r){if(!Bi(t,e.length)||!Bi(i,n.length))return NaN;let s=1/0;for(let a=t[0];a<t[1];++a)for(let t=i[0];t<i[1];++t){if(ui(e[a],e[a+1],n[t],n[t+1]))return 0;s=Math.min(s,Qi(e[a],e[a+1],n[t],n[t+1],r))}return s}function $i(e,t,n,i,r){if(!Bi(t,e.length)||!Bi(i,n.length))return NaN;let s=1/0;for(let a=t[0];a<=t[1];++a)for(let t=i[0];t<=i[1];++t)if(0===(s=Math.min(s,r.distance(e[a],n[t]))))return s;return s}function er(e,t,n){if(ci(e,t,!0))return 0;let i=1/0;for(const r of t){const t=r.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[t-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(e,r[t-1],r[0]))))return i;if(0===(i=Math.min(i,Xi(e,r,n))))return i}return i}function tr(e,t,n,i){if(!Bi(t,e.length))return NaN;for(let s=t[0];s<=t[1];++s)if(ci(e[s],n,!0))return 0;let r=1/0;for(let s=t[0];s<t[1];++s)for(const t of n)for(let n=0,a=t.length,o=a-1;n<a;o=n++){if(ui(e[s],e[s+1],t[o],t[n]))return 0;r=Math.min(r,Qi(e[s],e[s+1],t[o],t[n],i))}return r}function nr(e,t){for(const n of e)for(let e=0;e<=n.length-1;++e)if(ci(n[e],t,!0))return!0;return!1}function ir(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=Hi(e),s=Hi(t);if(i!==1/0&&qi(r,s,n)>=i)return i;if(oi(r,s)){if(nr(e,t))return 0}else if(nr(t,e))return 0;let a=i;for(const o of e)for(let e=0,i=o.length,r=i-1;e<i;r=e++)for(const s of t)for(let t=0,i=s.length,l=i-1;t<i;l=t++){if(ui(o[r],o[e],s[l],s[t]))return 0;a=Math.min(a,Qi(o[r],o[e],s[l],s[t],n))}return a}function rr(e,t,n,i,r,s,a){if(null===s||null===a)return;const o=qi(Ui(i,s),Ui(r,a),n);o<t&&e.push({dist:o,range1:s,range2:a})}function sr(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,s=Math.min(i.distance(e[0],n[0][0]),r);if(0===s)return s;const a=new Ii([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Ri),o=t?zi:Li,l=Hi(n);for(;a.length;){const r=a.pop();if(r.dist>=s)continue;const c=r.range1;if(Fi(c)<=o){if(!Bi(c,e.length))return NaN;if(t){const t=tr(e,c,n,i);if(0===(s=Math.min(s,t)))return s}else for(let t=c[0];t<=c[1];++t){const r=er(e[t],n,i);if(0===(s=Math.min(s,r)))return s}}else{const n=Vi(c,t);if(null!==n[0]){const t=qi(Ui(e,n[0]),l,i);t<s&&a.push({dist:t,range1:n[0],range2:[0,0]})}if(null!==n[1]){const t=qi(Ui(e,n[1]),l,i);t<s&&a.push({dist:t,range1:n[1],range2:[0,0]})}}}return s}function ar(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=Math.min(s,r.distance(e[0],n[0]));if(0===a)return a;const o=new Ii([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],Ri),l=t?zi:Li,c=i?zi:Li;for(;o.length;){const s=o.pop();if(s.dist>=a)continue;const d=s.range1,u=s.range2;if(Fi(d)<=l&&Fi(u)<=c){if(!Bi(d,e.length)||!Bi(u,n.length))return NaN;if(t&&i?a=Math.min(a,Ji(e,d,n,u,r)):t||i?t&&!i?a=Math.min(a,Ki(n,u,e,d,r)):!t&&i&&(a=Math.min(a,Ki(e,d,n,u,r))):a=Math.min(a,$i(e,d,n,u,r)),0===a)return a}else{const s=Vi(d,t),l=Vi(u,i);rr(o,a,r,e,n,s[0],l[0]),rr(o,a,r,e,n,s[0],l[1]),rr(o,a,r,e,n,s[1],l[0]),rr(o,a,r,e,n,s[1],l[1])}}return a}function or(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const s=Ui(e,[0,e.length-1]);for(const a of n)if(!(r!==1/0&&qi(s,Ui(a,[0,a.length-1]),i)>=r)&&(r=Math.min(r,ar(e,t,a,!0,i,r)),0===r))return r;return r}function lr(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const s=Ui(e,[0,e.length-1]);for(const a of n){if(r!==1/0&&qi(s,Hi(a),i)>=r)continue;const n=sr(e,t,a,i,r);if(isNaN(n))return n;if(0===(r=Math.min(r,n)))return r}return r}function cr(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class dr{constructor(e,t){this.type=xn,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(Fn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(cr(t.features[e].geometry.type))return new dr(t,t.features[e].geometry)}else if("Feature"===t.type){if(cr(t.geometry.type))return new dr(t,t.geometry)}else if(cr(t.type))return new dr(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),n=e.canonicalID();if(null!=t&&null!=n){if("Point"===e.geometryType())return function(e,t,n){const i=[];for(const s of e)for(const e of s)i.push(Yi(e,t));const r=new Ei(i[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?ar(i,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r):"MultiLineString"===n.type?or(i,!1,n.coordinates,r):"Polygon"===n.type||"MultiPolygon"===n.type?lr(i,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,r):null}(t,n,this.geometries);if("LineString"===e.geometryType())return function(e,t,n){const i=[];for(const s of e){const e=[];for(const n of s)e.push(Yi(n,t));i.push(e)}const r=new Ei(i[0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return or("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const s=or(n.coordinates[t],!0,i,r,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}if("Polygon"===n.type||"MultiPolygon"===n.type){let e=1/0;for(let t=0;t<i.length;t++){const s=lr(i[t],!0,"Polygon"===n.type?[n.coordinates]:n.coordinates,r,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}return null}(t,n,this.geometries);if("Polygon"===e.geometryType())return function(e,t,n){const i=[];for(const s of function(e){const t=e.length;if(t<=1)return[e];const n=[];let i,r;for(let s=0;s<t;s++){const t=si(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[e[s]]):i.push(e[s]))}return i&&n.push(i),n}(e)){const e=[];for(let n=0;n<s.length;++n)e.push(Zi(s[n],t));i.push(e)}const r=new Ei(i[0][0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return lr("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const s=lr(n.coordinates[t],!0,i,r,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}return"Polygon"===n.type||"MultiPolygon"===n.type?function(e,t,n){let i=1/0;for(const r of e)for(const e of t){const t=ir(r,e,n,i);if(isNaN(t))return t;if(0===(i=Math.min(i,t)))return i}return i}("Polygon"===n.type?[n.coordinates]:n.coordinates,i,r):null}(t,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ur(e){if(e instanceof $n){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Ni)return!1;if(e instanceof dr)return!1;if(e instanceof yr)return e.featureConstant;let t=!0;return e.eachChild(e=>{t&&!ur(e)&&(t=!1)}),t}function hr(e){if(e instanceof $n&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!hr(e)&&(t=!1)}),t}function pr(e){if(e instanceof yr)return new Set([e.key]);let t=new Set;return e.eachChild(e=>{t=new Set([...t,...pr(e)])}),t}function mr(e,t){if(e instanceof $n&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(e=>{n&&!mr(e,t)&&(n=!1)}),n}function fr(e,t,n){return[e,t,n].filter(Boolean).join("\x1f")}function gr(e,t){switch(e){case"string":return Vn(t);case"number":return+t;case"boolean":return!!t;case"color":return an.parse(t);case"formatted":return Rn.fromString(Vn(t));case"resolvedImage":return zn.build(Vn(t))}return t}function xr(e,t,n,i){return void 0!==i&&(e=i*Math.round(e/i)),void 0!==t&&e<t&&(e=t),void 0!==n&&e>n&&(e=n),e}class yr{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.type=e,this.key=t,this.scope=n,this.featureConstant=i}static parse(e,t){let n=t.expectedType;if(null==n&&(n=wn),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const i=t.parse(e[1],1);if(!(i instanceof Un))return t.error("Key name of 'config' expression must be a string literal.");let r,s=!0;const a=Vn(i.value);if(e.length>=3){const n=t.parse(e[2],2);if(!(n instanceof Un))return t.error("Scope of 'config' expression must be a string literal.");r=Vn(n.value)}if(t.options){const e=fr(a,r,t._scope),n=t.options.get(e);n&&(s=ur(n.value||n.default))}return new yr(n,a,r,s)}evaluate(e){const t=fr(this.key,this.scope,e.scope),n=e.getConfig(t);if(!n)return null;const{type:i,value:r,values:s,minValue:a,maxValue:o,stepValue:l}=n,c=n.default.evaluate(e);let d=c;if(r){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),d=r.evaluate(e),e.scope=t}return i&&(d=gr(i,d)),void 0===d||void 0===a&&void 0===o&&void 0===l||("number"==typeof d?d=xr(d,a,o,l):Array.isArray(d)&&(d=d.map(e=>"number"==typeof e?xr(e,a,o,l):e))),void 0!==r&&void 0!==d&&s&&!s.includes(d)&&(d=c,i&&(d=gr(i,d))),(i&&i!==this.type||void 0!==d&&!Dn(Bn(d),this.type))&&(d=gr(this.type.kind,d)),d}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class vr{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new vr(n,t.scope.get(n)):t.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class _r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new fn,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;this.registry=e,this.path=t,this.key=t.map(e=>"string"==typeof e?"['".concat(e,"']"):"[".concat(e,"]")).join(""),this.scope=i,this.errors=r,this.expectedType=n,this._scope=s,this.options=a}parse(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||n?this.concat(t,null,n,i)._parse(e,r):this._parse(e,r)}parseObjectValue(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.concat(t,n,i,r)._parse(e,s)}_parse(e,t){function n(e,t,n){return"assert"===n?new Wn(t,[e]):"coerce"===n?new Kn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i="string"==typeof e[0]?this.registry[e[0]]:void 0;if(i){let r=i.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,i=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else r=n(r,e,t.typeAnnotation||"coerce");else r=n(r,e,t.typeAnnotation||"assert")}if(!(r instanceof Un)&&"resolvedImage"!==r.type.kind&&br(r)){const t=new Jn(this._scope,this.options);try{r=new Un(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return Kn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,n,i){let r="number"==typeof e?this.path.concat(e):this.path;r="string"==typeof t?r.concat(t):r;const s=i?this.scope.concat(i):this.scope;return new _r(this.registry,r,n||null,s,this.errors,this._scope,this.options)}error(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map(e=>"[".concat(e,"]")).join(""));this.errors.push(new mn(r,e))}checkSubtype(e,t){const n=En(e,t);return n&&this.error(n),n}}function br(e){if(e instanceof vr)return br(e.boundExpression);if(e instanceof $n&&"error"===e.name)return!1;if(e instanceof ti)return!1;if(e instanceof Ni)return!1;if(e instanceof dr)return!1;if(e instanceof yr)return!1;const t=e instanceof Kn||e instanceof Wn;let n=!0;return e.eachChild(e=>{n=t?n&&br(e):n&&e instanceof Un}),!!n&&ur(e)&&mr(e,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wr(e,t){const n=e.length-1;let i,r,s=0,a=n,o=0;for(;s<=a;)if(o=Math.floor((s+a)/2),i=e[o],r=e[o+1],i<=t){if(o===n||t<r)return o;s=o+1}else{if(!(i>t))throw new Hn("Input is not a number.");a=o-1}return 0}class jr{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,xn);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let s=1;s<e.length;s+=2){const n=1===s?-1/0:e[s],a=e[s+1],o=s,l=s+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(i.length&&i[i.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);const c=t.parse(a,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new jr(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[wr(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Nr=.95047,Sr=1.08883,kr=4/29,Tr=6/29,Cr=3*Tr*Tr,Er=Tr*Tr*Tr,Ar=Math.PI/180,Mr=180/Math.PI;function Dr(e){return e>Er?Math.pow(e,1/3):e/Cr+kr}function Ir(e){return e>Tr?e*e*e:Cr*(e-kr)}function Pr(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Rr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Lr(e){const t=Rr(e.r),n=Rr(e.g),i=Rr(e.b),r=Dr((.4124564*t+.3575761*n+.1804375*i)/Nr),s=Dr((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*s-16,a:500*(r-s),b:200*(s-Dr((.0193339*t+.119192*n+.9503041*i)/Sr)),alpha:e.a}}function zr(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*Ir(t),n=Nr*Ir(n),i=Sr*Ir(i),new an(Pr(3.2404542*n-1.5371385*t-.4985314*i),Pr(-.969266*n+1.8760108*t+.041556*i),Pr(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function Or(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Fr={forward:Lr,reverse:zr,interpolate:function(e,t,n){return{l:dn(e.l,t.l,n),a:dn(e.a,t.a,n),b:dn(e.b,t.b,n),alpha:dn(e.alpha,t.alpha,n)}}},Br={forward:function(e){const{l:t,a:n,b:i}=Lr(e),r=Math.atan2(i,n)*Mr;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Ar,n=e.c;return zr({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:Or(e.h,t.h,n),c:dn(e.c,t.c,n),l:dn(e.l,t.l,n),alpha:dn(e.alpha,t.alpha,n)}}};var Vr=Object.freeze({__proto__:null,hcl:Br,lab:Fr});class Ur{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[s,a]of r)this.labels.push(s),this.outputs.push(a)}static interpolationFactor(e,t,n,i){let r=0;if("exponential"===e.name)r=Hr(t,e.base,n,i);else if("linear"===e.name)r=Hr(t,1,n,i);else if("cubic-bezier"===e.name){const s=e.controlPoints;r=new ve(s[0],s[1],s[2],s[3]).solve(Hr(t,1,n,i))}return r}static parse(e,t){let[n,i,r,...s]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const e=i.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length-1>3&&(e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,xn),!r)return null;const a=[];let o=null;"interpolate-hcl"===n||"interpolate-lab"===n?o=_n:t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType);for(let l=0;l<s.length;l+=2){const e=s[l],n=s[l+1],i=l+3,r=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(a.length&&a[a.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,r,o);if(!c)return null;o=o||c.type,a.push([e,c])}return"number"===o.kind||"color"===o.kind||"array"===o.kind&&"number"===o.itemType.kind&&"number"==typeof o.N?new Ur(o,n,i,r,a):t.error("Type ".concat(Tn(o)," is not interpolatable."))}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const s=wr(t,i),a=Ur.interpolationFactor(this.interpolation,i,t[s],t[s+1]),o=n[s].evaluate(e),l=n[s+1].evaluate(e);return"interpolate"===this.operator?hn[this.type.kind.toLowerCase()](o,l,a):"interpolate-hcl"===this.operator?Br.reverse(Br.interpolate(Br.forward(o),Br.forward(l),a)):Fr.reverse(Fr.interpolate(Fr.forward(o),Fr.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function Hr(e,t,n,i){const r=i-n,s=e-n;return 0===r?0:1===t?s/r:(Math.pow(t,s)-1)/(Math.pow(t,r)-1)}class qr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const a of e.slice(1)){const e=t.parse(a,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}const s=i&&r.some(e=>En(i,e.type));return new qr(s?wn:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args){if(i++,n=r.evaluate(e),n&&n instanceof zn&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class Wr{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const n=[];for(let r=1;r<e.length-1;r+=2){const i=e[r];if("string"!=typeof i)return t.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const s=t.parse(e[r+1],r+1);if(!s)return null;n.push([i,s])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Wr(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}class Gr{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,xn),i=t.parse(e[2],2,kn(t.expectedType||wn));return n&&i?new Gr(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Hn("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new Hn("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new Hn("Array index must be an integer, but found ".concat(t," instead. Use at-interpolated to retrieve interpolated result with a fractional index."));return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Yr{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,xn),i=t.parse(e[2],2,kn(t.expectedType||wn));return n&&i?new Yr(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Hn("Array index out of bounds: ".concat(t," < 0."));if(t>n.length-1)throw new Hn("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t===Math.floor(t))return n[t];const i=Math.floor(t),r=Math.ceil(t),s=n[i],a=n[r];if("number"!=typeof s||"number"!=typeof a)throw new Hn("Cannot interpolate between non-number values at index ".concat(t,"."));const o=t-i;return s*(1-o)+a*o}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Zr{constructor(e,t){this.type=vn,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,wn),i=t.parse(e[2],2,wn);return n&&i?An(n.type,[vn,yn,xn,gn,wn])?new Zr(n,i):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tn(n.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!Mn(t,["boolean","string","number","null"]))throw new Hn("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tn(Bn(t))," instead."));if(!Mn(n,["string","array"]))throw new Hn("Expected second argument to be of type array or string, but found ".concat(Tn(Bn(n))," instead."));return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Xr{constructor(e,t,n){this.type=xn,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,wn),i=t.parse(e[2],2,wn);if(!n||!i)return null;if(!An(n.type,[vn,yn,xn,gn,wn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tn(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,xn);return r?new Xr(n,i,r):null}return new Xr(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Mn(t,["boolean","string","number","null"]))throw new Hn("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tn(Bn(t))," instead."));if(!Mn(n,["string","array"]))throw new Hn("Expected second argument to be of type array or string, but found ".concat(Tn(Bn(n))," instead."));if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Kr{constructor(e,t,n,i,r,s){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=s}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},s=[];for(let l=2;l<e.length-1;l+=2){let a=e[l];const o=e[l+1];Array.isArray(a)||(a=[a]);const c=t.concat(l);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Bn(e)))return null}else n=Bn(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=s.length}const d=t.parse(o,l,i);if(!d)return null;i=i||d.type,s.push(d)}const a=t.parse(e[1],1,wn);if(!a)return null;const o=t.parse(e[e.length-1],e.length-1,i);return o?"value"!==a.type.kind&&t.concat(1).checkSubtype(n,a.type)?null:new Kr(n,i,a,r,s,o):null}evaluate(e){const t=this.input.evaluate(e);return(Dn(Bn(t),this.inputType)&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const s of t){const e=i[this.cases[s]];void 0===e?(i[this.cases[s]]=n.length,n.push([this.cases[s],[s]])):n[e][1].push(s)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[s,a]of n)e.push(1===a.length?r(a[0]):a.map(r)),e.push(this.outputs[s].serialize());return e.push(this.otherwise.serialize()),e}}class Qr{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let s=1;s<e.length-1;s+=2){const r=t.parse(e[s],s,vn);if(!r)return null;const a=t.parse(e[s+1],s+1,n);if(!a)return null;i.push([r,a]),n=n||a.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new Qr(n,i,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(e=>{let[t,n]=e;return n.outputDefined()})&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class Jr{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,wn),i=t.parse(e[2],2,xn);if(!n||!i)return null;if(!An(n.type,[kn(wn),yn,wn]))return t.error("Expected first argument to be of type array or string, but found ".concat(Tn(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,xn);return r?new Jr(n.type,n,i,r):null}return new Jr(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Mn(t,["string","array"]))throw new Hn("Expected first argument to be of type array or string, but found ".concat(Tn(Bn(t))," instead."));if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class $r{constructor(e,t){this.type=kn(yn),this.str=e,this.delimiter=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,yn),i=t.parse(e[2],2,yn);return n&&i?new $r(n,i):void 0}evaluate(e){const t=this.str.evaluate(e),n=this.delimiter.evaluate(e);return t.split(n)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function es(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ts(e,t,n,i){return 0===i.compare(t,n)}function ns(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=vn,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let s=t.parse(e[1],1,wn);if(!s)return null;if(!es(n,s.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Tn(s.type),"'."));let a=t.parse(e[2],2,wn);if(!a)return null;if(!es(n,a.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Tn(a.type),"'."));if(s.type.kind!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return t.error("Cannot compare types '".concat(Tn(s.type),"' and '").concat(Tn(a.type),"'."));i&&("value"===s.type.kind&&"value"!==a.type.kind?s=new Wn(a.type,[s]):"value"!==s.type.kind&&"value"===a.type.kind&&(a=new Wn(s.type,[a])));let o=null;if(4===e.length){if("string"!==s.type.kind&&"string"!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(o=t.parse(e[3],3,jn),!o)return null}return new r(s,a,o)}evaluate(r){const s=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=Bn(s),n=Bn(a);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new Hn('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const e=Bn(s),n=Bn(a);if("string"!==e.kind||"string"!==n.kind)return t(r,s,a)}return this.collator?n(r,s,a,this.collator.evaluate(r)):t(r,s,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild(e=>{t.push(e.serialize())}),t}}}const is=ns("==",function(e,t,n){return t===n},ts),rs=ns("!=",function(e,t,n){return t!==n},function(e,t,n,i){return!ts(0,t,n,i)}),ss=ns("<",function(e,t,n){return t<n},function(e,t,n,i){return i.compare(t,n)<0}),as=ns(">",function(e,t,n){return t>n},function(e,t,n,i){return i.compare(t,n)>0}),os=ns("<=",function(e,t,n){return t<=n},function(e,t,n,i){return i.compare(t,n)<=0}),ls=ns(">=",function(e,t,n){return t>=n},function(e,t,n,i){return i.compare(t,n)>=0});class cs{constructor(e,t,n,i,r,s){this.type=yn,this.number=e,this.locale=t,this.currency=n,this.unit=i,this.minFractionDigits=r,this.maxFractionDigits=s}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,xn);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parseObjectValue(i.locale,2,"locale",yn),!r))return null;let s=null;if(i.currency&&(s=t.parseObjectValue(i.currency,2,"currency",yn),!s))return null;let a=null;if(i.unit&&(a=t.parseObjectValue(i.unit,2,"unit",yn),!a))return null;let o=null;if(i["min-fraction-digits"]&&(o=t.parseObjectValue(i["min-fraction-digits"],2,"min-fraction-digits",xn),!o))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parseObjectValue(i["max-fraction-digits"],2,"max-fraction-digits",xn),!l)?null:new cs(n,r,s,a,o,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ds{constructor(e){this.type=xn,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error("Expected argument of type string or array, but found ".concat(Tn(n.type)," instead.")):new ds(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Hn("Expected value to be of type string or array, but found ".concat(Tn(Bn(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}function us(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const hs={"==":is,"!=":rs,">":as,"<":ss,">=":ls,"<=":os,array:Wn,at:Gr,"at-interpolated":Yr,boolean:Wn,case:Qr,coalesce:qr,collator:ti,format:Gn,image:Yn,in:Zr,"index-of":Xr,interpolate:Ur,"interpolate-hcl":Ur,"interpolate-lab":Ur,length:ds,let:Wr,literal:Un,match:Kr,number:Wn,"number-format":cs,object:Wn,slice:Jr,step:jr,string:Wn,"to-boolean":Kn,"to-color":Kn,"to-number":Kn,"to-string":Kn,var:vr,within:Ni,distance:dr,config:yr,split:$r};function ps(e,t){let[n,i,r,s]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const a=s?s.evaluate(e):1,o=On(n,i,r,a);if(o)throw new Hn(o);return new an(n/255,i/255,r/255,a)}function ms(e,t){let[n,i,r,s]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const a=s?s.evaluate(e):1,o=function(e,t,n,i){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof n&&n>=0&&n<=100?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid hsla value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'h' must be between 0 and 360.")}(n,i,r,a);if(o)throw new Hn(o);const l="hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(a,")"),c=an.parse(l);if(!c)throw new Hn("Failed to parse HSLA color: ".concat(l));return c}function fs(e,t){return e in t}function gs(e,t){const n=t[e];return void 0===n?null:n}function xs(e){return{type:e}}function ys(e){return{result:"success",value:e}}function vs(e){return{result:"error",value:e}}function _s(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function bs(e){return"data-driven"===e["property-type"]}function ws(e){return _s(e.expression,"measure-light")}function js(e){return _s(e.expression,"zoom")}function Ns(e){return!!e.expression&&e.expression.interpolated}function Ss(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function ks(e){return e}function Ts(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),s=e.type||(Ns(t)?"exponential":"interval");if(n&&((e=pn({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],an.parse(e[1])])),e.default=an.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Vr[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let a,o,l;if("exponential"===s)a=Ms;else if("interval"===s)a=As;else if("categorical"===s){a=Es,o=Object.create(null);for(const t of e.stops)o[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error('Unknown function type "'.concat(s,'"'));a=Ds}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],s=r[0].zoom;void 0===n[s]&&(n[s]={zoom:s,type:e.type,property:e.property,default:e.default,stops:[]},i.push(s)),n[s].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,Ts(n[e],t)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:Ur.interpolationFactor.bind(void 0,s),zoomStops:r.map(e=>e[0]),evaluate:(n,i)=>{let{zoom:s}=n;return Ms({stops:r,base:e.base},t,s).evaluate(s,i)}}}if(r){const n="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:Ur.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map(e=>e[0]),evaluate:n=>{let{zoom:i}=n;return a(e,t,i,o,l)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?Cs(e.default,t.default):a(e,t,r,o,l)}}}function Cs(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Es(e,t,n,i,r){return Cs(typeof n===r?i[n]:void 0,e.default,t.default)}function As(e,t,n){if("number"!==Zn(n))return Cs(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=wr(e.stops.map(e=>e[0]),n);return e.stops[r][1]}function Ms(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==Zn(n))return Cs(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const s=wr(e.stops.map(e=>e[0]),n),a=function(e,t,n,i){const r=i-n,s=e-n;return 0===r?0:1===t?s/r:(Math.pow(t,s)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[s][0],e.stops[s+1][0]),o=e.stops[s][1],l=e.stops[s+1][1];let c=hn[t.type]||ks;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Vr[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),a))}return"function"==typeof o.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=o.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return c(i,r,a)}}:c(o,l,a)}function Ds(e,t,n){return"color"===t.type?n=an.parse(n):"formatted"===t.type?n=Rn.fromString(n.toString()):"resolvedImage"===t.type?n=zn.build(n.toString()):Zn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),Cs(n,e.default,t.default)}$n.register(hs,{error:[{kind:"error"},[yn],(e,t)=>{let[n]=t;throw new Hn(n.evaluate(e))}],typeof:[yn,[wn],(e,t)=>{let[n]=t;return Tn(Bn(n.evaluate(e)))}],"to-rgba":[kn(xn,4),[_n],(e,t)=>{let[n]=t;return n.evaluate(e).toNonPremultipliedRenderColor(null).toArray()}],"to-hsla":[kn(xn,4),[_n],(e,t)=>{let[n]=t;return n.evaluate(e).toNonPremultipliedRenderColor(null).toHslaArray()}],rgb:[_n,[xn,xn,xn],ps],rgba:[_n,[xn,xn,xn,xn],ps],hsl:[_n,[xn,xn,xn],ms],hsla:[_n,[xn,xn,xn,xn],ms],has:{type:vn,overloads:[[[yn],(e,t)=>{let[n]=t;return fs(n.evaluate(e),e.properties())}],[[yn,bn],(e,t)=>{let[n,i]=t;return fs(n.evaluate(e),i.evaluate(e))}]]},get:{type:wn,overloads:[[[yn],(e,t)=>{let[n]=t;return gs(n.evaluate(e),e.properties())}],[[yn,bn],(e,t)=>{let[n,i]=t;return gs(n.evaluate(e),i.evaluate(e))}]]},"feature-state":[wn,[yn],(e,t)=>{let[n]=t;return gs(n.evaluate(e),e.featureState||{})}],properties:[bn,[],e=>e.properties()],"geometry-type":[yn,[],e=>e.geometryType()],worldview:[yn,[],e=>e.globals.worldview||""],id:[wn,[],e=>e.id()],zoom:[xn,[],e=>e.globals.zoom],pitch:[xn,[],e=>e.globals.pitch||0],"distance-from-center":[xn,[],e=>e.distanceFromCenter()],"measure-light":[xn,[yn],(e,t)=>{let[n]=t;return e.measureLight(n.evaluate(e))}],"heatmap-density":[xn,[],e=>e.globals.heatmapDensity||0],"line-progress":[xn,[],e=>e.globals.lineProgress||0],"raster-value":[xn,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[xn,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[xn,[],e=>e.globals.skyRadialProgress||0],accumulated:[wn,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[xn,xs(xn),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[xn,xs(xn),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:xn,overloads:[[[xn,xn],(e,t)=>{let[n,i]=t;return n.evaluate(e)-i.evaluate(e)}],[[xn],(e,t)=>{let[n]=t;return-n.evaluate(e)}]]},"/":[xn,[xn,xn],(e,t)=>{let[n,i]=t;return n.evaluate(e)/i.evaluate(e)}],"%":[xn,[xn,xn],(e,t)=>{let[n,i]=t;return n.evaluate(e)%i.evaluate(e)}],ln2:[xn,[],()=>Math.LN2],pi:[xn,[],()=>Math.PI],e:[xn,[],()=>Math.E],"^":[xn,[xn,xn],(e,t)=>{let[n,i]=t;return Math.pow(n.evaluate(e),i.evaluate(e))}],sqrt:[xn,[xn],(e,t)=>{let[n]=t;return Math.sqrt(n.evaluate(e))}],log10:[xn,[xn],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN10}],ln:[xn,[xn],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))}],log2:[xn,[xn],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN2}],sin:[xn,[xn],(e,t)=>{let[n]=t;return Math.sin(n.evaluate(e))}],cos:[xn,[xn],(e,t)=>{let[n]=t;return Math.cos(n.evaluate(e))}],tan:[xn,[xn],(e,t)=>{let[n]=t;return Math.tan(n.evaluate(e))}],asin:[xn,[xn],(e,t)=>{let[n]=t;return Math.asin(n.evaluate(e))}],acos:[xn,[xn],(e,t)=>{let[n]=t;return Math.acos(n.evaluate(e))}],atan:[xn,[xn],(e,t)=>{let[n]=t;return Math.atan(n.evaluate(e))}],min:[xn,xs(xn),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[xn,xs(xn),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[xn,[xn],(e,t)=>{let[n]=t;return Math.abs(n.evaluate(e))}],round:[xn,[xn],(e,t)=>{let[n]=t;const i=n.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[xn,[xn],(e,t)=>{let[n]=t;return Math.floor(n.evaluate(e))}],ceil:[xn,[xn],(e,t)=>{let[n]=t;return Math.ceil(n.evaluate(e))}],"filter-==":[vn,[yn,wn],(e,t)=>{let[n,i]=t;return e.properties()[n.value]===i.value}],"filter-id-==":[vn,[wn],(e,t)=>{let[n]=t;return e.id()===n.value}],"filter-type-==":[vn,[yn],(e,t)=>{let[n]=t;return e.geometryType()===n.value}],"filter-<":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],s=i.value;return typeof r==typeof s&&r<s}],"filter-id-<":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],s=i.value;return typeof r==typeof s&&r>s}],"filter-id->":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],s=i.value;return typeof r==typeof s&&r<=s}],"filter-id-<=":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],s=i.value;return typeof r==typeof s&&r>=s}],"filter-id->=":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[vn,[wn],(e,t)=>{let[n]=t;return n.value in e.properties()}],"filter-has-id":[vn,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[vn,[kn(yn)],(e,t)=>{let[n]=t;return n.value.indexOf(e.geometryType())>=0}],"filter-id-in":[vn,[kn(wn)],(e,t)=>{let[n]=t;return n.value.indexOf(e.id())>=0}],"filter-in-small":[vn,[yn,kn(wn)],(e,t)=>{let[n,i]=t;return i.value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[vn,[yn,kn(wn)],(e,t)=>{let[n,i]=t;return function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:vn,overloads:[[[vn,vn],(e,t)=>{let[n,i]=t;return n.evaluate(e)&&i.evaluate(e)}],[xs(vn),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:vn,overloads:[[[vn,vn],(e,t)=>{let[n,i]=t;return n.evaluate(e)||i.evaluate(e)}],[xs(vn),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[vn,[vn],(e,t)=>{let[n]=t;return!n.evaluate(e)}],"is-supported-script":[vn,[yn],(e,t)=>{let[n]=t;const i=e.globals&&e.globals.isSupportedScript;return!i||i(n.evaluate(e))}],upcase:[yn,[yn],(e,t)=>{let[n]=t;return n.evaluate(e).toUpperCase()}],downcase:[yn,[yn],(e,t)=>{let[n]=t;return n.evaluate(e).toLowerCase()}],concat:[yn,xs(wn),(e,t)=>t.map(t=>Vn(t.evaluate(e))).join("")],"resolved-locale":[yn,[jn],(e,t)=>{let[n]=t;return n.evaluate(e).resolvedLocale()}],random:[xn,[xn,xn,wn],(e,t)=>{const[n,i,r]=t.map(t=>t.evaluate(e));if(n>i)return n;if(n===i)return n;let s;if("string"==typeof r)s=function(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(r);else{if("number"!=typeof r)throw new Hn("Invalid seed input: ".concat(r));s=r}return n+us(s)()*(i-n)}]});class Is{constructor(e,t,n,i){this.expression=e,this._warningHistory={},this._evaluator=new Jn(n,i),this._defaultValue=t?function(e){return"color"===e.type&&(Ss(e.default)||Array.isArray(e.default))?new an(0,0,0,0):"color"===e.type?an.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this.configDependencies=pr(e)}evaluateWithoutErrorHandling(e,t,n,i,r,s,a,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=o||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,s,a,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Hn("Expected value to be one of ".concat(Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn('Failed to evaluate expression "'.concat(JSON.stringify(this.expression.serialize()),'". ').concat(e.message))),this._defaultValue}}}function Ps(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in hs}function Rs(e,t,n,i){const r=new _r(hs,[],t?function(e){const t={color:_n,string:yn,number:xn,enum:yn,boolean:vn,formatted:Nn,resolvedImage:Sn};return"array"===e.type?kn(t[e.value]||wn,e.length):t[e.type]}(t):void 0,void 0,void 0,n,i),s=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return s?ys(new Is(s,t,n,i)):vs(r.errors)}class Ls{constructor(e,t,n,i){this.kind=e,this._styleExpression=t,this.isLightConstant=n,this.isLineProgressConstant=i,this.isStateDependent="constant"!==e&&!hr(t.expression),this.configDependencies=pr(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,s)}evaluate(e,t,n,i,r,s){return this._styleExpression.evaluate(e,t,n,i,r,s)}}class zs{constructor(e,t,n,i,r,s){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!hr(t.expression),this.isLightConstant=r,this.isLineProgressConstant=s,this.configDependencies=pr(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,s)}evaluate(e,t,n,i,r,s){return this._styleExpression.evaluate(e,t,n,i,r,s)}interpolationFactor(e,t,n){return this.interpolationType?Ur.interpolationFactor(this.interpolationType,e,t,n):0}}function Os(e,t,n,i){if("error"===(e=Rs(e,t,n,i)).result)return e;const r=e.value.expression,s=ur(r);if(!s&&!bs(t))return vs([new mn("","data expressions not supported")]);const a=mr(r,["zoom","pitch","distance-from-center"]);if(!a&&!js(t))return vs([new mn("","zoom expressions not supported")]);const o=mr(r,["measure-light"]);if(!o&&!ws(t))return vs([new mn("","measure-light expression not supported")]);const l=mr(r,["line-progress"]);if(!l&&!function(e){return _s(e.expression,"line-progress")}(t))return vs([new mn("","line-progress expression not supported")]);const c=t.expression&&t.expression.relaxZoomRestriction,d=Bs(r);return d||a||c?d instanceof mn?vs([d]):d instanceof Ur&&!Ns(t)?vs([new mn("",'"interpolate" expressions cannot be used with this property')]):ys(d?new zs(s&&l?"camera":"composite",e.value,d.labels,d instanceof Ur?d.interpolation:void 0,o,l):new Ls(s&&l?"constant":"source",e.value,o,l)):vs([new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Fs{constructor(e,t){this._parameters=e,this._specification=t,pn(this,Ts(this._parameters,this._specification))}static deserialize(e){return new Fs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bs(e){let t=null;if(e instanceof Wr)t=Bs(e.result);else if(e instanceof qr){for(const n of e.args)if(t=Bs(n),t)break}else(e instanceof jr||e instanceof Ur)&&e.input instanceof $n&&"zoom"===e.input.name&&(t=e);return t instanceof mn||e.eachChild(e=>{const n=Bs(e);n instanceof mn?t=n:t&&n&&t!==n&&(t=new mn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Vs,Us,Hs=function(){if(Us)return Vs;Us=1,Vs=t;var e=3;function t(t,n,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(n=s[1])+2*(i=s[2]);for(var a=0;a<this.d*this.d;a++){var o=s[e+a],l=s[e+a+1];r.push(o===l?null:s.subarray(o,l))}var c=s[e+r.length+1];this.keys=s.subarray(s[e+r.length],c),this.bboxes=s.subarray(c),this.insert=this._insertReadonly}else{this.d=n+2*i;for(var d=0;d<this.d*this.d;d++)r.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=i,this.scale=n/t,this.uid=0;var u=i/n*t;this.min=-u,this.max=t+u}return t.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(e,t,n,i,r,s){this.cells[r].push(s)},t.prototype.query=function(e,t,n,i,r){var s=this.min,a=this.max;if(e<=s&&t<=s&&a<=n&&a<=i&&!r)return Array.prototype.slice.call(this.keys);var o=[];return this._forEachCell(e,t,n,i,this._queryCell,o,{},r),o},t.prototype._queryCell=function(e,t,n,i,r,s,a,o){var l=this.cells[r];if(null!==l)for(var c=this.keys,d=this.bboxes,u=0;u<l.length;u++){var h=l[u];if(void 0===a[h]){var p=4*h;(o?o(d[p+0],d[p+1],d[p+2],d[p+3]):e<=d[p+2]&&t<=d[p+3]&&n>=d[p+0]&&i>=d[p+1])?(a[h]=!0,s.push(c[h])):a[h]=!1}}},t.prototype._forEachCell=function(e,t,n,i,r,s,a,o){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),d=this._convertToCellCoord(n),u=this._convertToCellCoord(i),h=l;h<=d;h++)for(var p=c;p<=u;p++){var m=this.d*p+h;if((!o||o(this._convertFromCellCoord(h),this._convertFromCellCoord(p),this._convertFromCellCoord(h+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,n,i,m,s,a,o))return}},t.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},t.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,n=e+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var s=new Int32Array(n+i+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var a=n,o=0;o<t.length;o++){var l=t[o];s[e+o]=a,s.set(l,a),a+=l.length}return s[e+t.length]=a,s.set(this.keys,a),s[e+t.length+1]=a+=this.keys.length,s.set(this.bboxes,a),a+=this.bboxes.length,s.buffer},Vs}(),qs=xe(Hs);const Ws={};function Gs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writable:!1}),Ws[t]={klass:e,omit:n.omit||[]}}Gs(Object,"Object"),qs.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},qs.deserialize=function(e){return new qs(e.buffer)},Object.defineProperty(qs,"name",{value:"Grid"}),Gs(qs,"Grid"),delete _e.prototype.constructor,"undefined"!=typeof DOMMatrix&&Gs(DOMMatrix,"DOMMatrix"),Gs(an,"Color"),Gs(Error,"Error"),Gs(Rn,"Formatted"),Gs(Pn,"FormattedSection"),Gs(It,"AJAXError"),Gs(zn,"ResolvedImage"),Gs(Fs,"StylePropertyFunction"),Gs(Is,"StyleExpression",{omit:["_evaluator"]}),Gs(tn,"ImageId"),Gs(Ln,"ImageVariant"),Gs(zs,"ZoomDependentExpression"),Gs(Ls,"ZoomConstantExpression"),Gs($n,"CompoundExpression",{omit:["_evaluate"]});for(const _b in hs)Ws[hs[_b]._classRegistryKey]||Gs(hs[_b],"Expression".concat(_b));function Ys(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Zs(e){return self.ImageBitmap&&e instanceof ImageBitmap}function Xs(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Ys(e)||Zs(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e))return t&&t.add(e.buffer),e;if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push(Xs(i,t));return n}if(e instanceof Map){const n={$name:"Map",entries:[]};for(const[i,r]of e.entries())n.entries.push(Xs(i),Xs(r,t));return n}if(e instanceof Set){const t={$name:"Set"};let n=0;for(const i of e.values())t[++n]=Xs(i);return t}if(e instanceof DOMMatrix){const t={$name:"DOMMatrix"},n=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const i of n)t[i]=e[i];return t}if("bigint"==typeof e)return{$name:"BigInt",value:e.toString()};if("object"==typeof e){const n=e.constructor,i=n._classRegistryKey;if(!i)throw new Error("Can't serialize object of unregistered class \"".concat(n.name,'".'));const r=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const n in e)e.hasOwnProperty(n)&&(Ws[i].omit.indexOf(n)>=0||(r[n]=Xs(e[n],t)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function Ks(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Ys(e)||Zs(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(Ks);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=e.entries||[],n=new Map;for(let e=0;e<t.length;e+=2)n.set(Ks(t[e]),Ks(t[e+1]));return n}if("Set"===t){const t=new Set;for(const n of Object.keys(e))"$name"!==n&&t.add(Ks(e[n]));return t}if("DOMMatrix"===t){let t;return t=e.is2D?[e.a,e.b,e.c,e.d,e.e,e.f]:[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44],new DOMMatrix(t)}if("BigInt"===t)return BigInt(e.value);const{klass:n}=Ws[t];if(!n)throw new Error("Can't deserialize unregistered class \"".concat(t,'".'));if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const r of Object.keys(e))"$name"!==r&&(i[r]=Ks(e[r]));return i}throw new Error("can't deserialize object of type "+typeof e)}const Qs={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,Osage:e=>e>=66736&&e<=66815,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function Js(e){for(const t of e)if(ta(t.charCodeAt(0)))return!0;return!1}function $s(e){for(const t of e)if(!ea(t.charCodeAt(0)))return!1;return!0}function ea(e){return!(Qs.Arabic(e)||Qs["Arabic Supplement"](e)||Qs["Arabic Extended-A"](e)||Qs["Arabic Presentation Forms-A"](e)||Qs["Arabic Presentation Forms-B"](e))}function ta(e){return!(746!==e&&747!==e&&(e<4352||!(Qs["Bopomofo Extended"](e)||Qs.Bopomofo(e)||Qs["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Qs["CJK Compatibility Ideographs"](e)||Qs["CJK Compatibility"](e)||Qs["CJK Radicals Supplement"](e)||Qs["CJK Strokes"](e)||!(!Qs["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Qs["CJK Unified Ideographs Extension A"](e)||Qs["CJK Unified Ideographs"](e)||Qs["Enclosed CJK Letters and Months"](e)||Qs["Hangul Compatibility Jamo"](e)||Qs["Hangul Jamo Extended-A"](e)||Qs["Hangul Jamo Extended-B"](e)||Qs["Hangul Jamo"](e)||Qs["Hangul Syllables"](e)||Qs.Hiragana(e)||Qs["Ideographic Description Characters"](e)||Qs.Kanbun(e)||Qs["Kangxi Radicals"](e)||Qs["Katakana Phonetic Extensions"](e)||Qs.Katakana(e)&&12540!==e||!(!Qs["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Qs["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Qs["Unified Canadian Aboriginal Syllabics"](e)||Qs["Unified Canadian Aboriginal Syllabics Extended"](e)||Qs["Vertical Forms"](e)||Qs["Yijing Hexagram Symbols"](e)||Qs["Yi Syllables"](e)||Qs["Yi Radicals"](e))))}function na(e){return!(ta(e)||function(e){return!!(Qs["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Qs["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Qs["Letterlike Symbols"](e)||Qs["Number Forms"](e)||Qs["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qs["Control Pictures"](e)&&9251!==e||Qs["Optical Character Recognition"](e)||Qs["Enclosed Alphanumerics"](e)||Qs["Geometric Shapes"](e)||Qs["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qs["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qs["CJK Symbols and Punctuation"](e)||Qs.Katakana(e)||Qs["Private Use Area"](e)||Qs["CJK Compatibility Forms"](e)||Qs["Small Form Variants"](e)||Qs["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function ia(e){return Qs.Arabic(e)||Qs["Arabic Supplement"](e)||Qs["Arabic Extended-A"](e)||Qs["Arabic Presentation Forms-A"](e)||Qs["Arabic Presentation Forms-B"](e)}function ra(e){return e>=1424&&e<=2303||Qs["Arabic Presentation Forms-A"](e)||Qs["Arabic Presentation Forms-B"](e)}function sa(e,t){return!(!t&&ra(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Qs.Khmer(e))}function aa(e){for(const t of e)if(ra(t.charCodeAt(0)))return!0;return!1}const oa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let la=null,ca=oa.unavailable,da=null;const ua=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(ca=oa.error),la&&la(e)};function ha(){pa.fire(new Kt("pluginStateChange",{pluginStatus:ca,pluginURL:da}))}const pa=new en,ma=function(){return ca},fa=function(){if(ca!==oa.deferred||!da)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ca=oa.loading,ha(),da&&Lt({url:da},e=>{e?ua(e):(ca=oa.loaded,ha())})},ga={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ca===oa.loaded||null!=ga.applyArabicShaping,isLoading:()=>ca===oa.loading,setState(e){ca=e.pluginStatus,da=e.pluginURL},isParsing:()=>ca===oa.parsing,isParsed:()=>ca===oa.parsed,getPluginURL:()=>da};class xa{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness,this.worldview=t.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(!sa(n.charCodeAt(0),t))return!1;return!0}(e,ga.isLoaded())}}class ya{constructor(e,t,n,i){this.property=e,this.value=t,this.expression=function(e,t,n,i){if(Ss(e))return new Fs(e,t);if(Ps(e)||Array.isArray(e)&&e.length>0){const r=Os(e,t,n,i);if("error"===r.result)throw new Error(r.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));return r.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=an.parse(e)),{kind:"constant",configDependencies:new Set,evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class va{constructor(e,t,n){this.property=e,this.value=new ya(e,void 0,t,n)}transitioned(e,t){return new ba(this.property,this.value,t,Pe({},e.transition,this.transition),e.now)}untransitioned(){return new ba(this.property,this.value,null,{},0)}}class _a{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=n,this.configDependencies=new Set}getValue(e){return Ve(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new va(this._values[e].property,this._scope,this._options)),this._values[e].value=new ya(this._values[e].property,null===t?void 0:Ve(t),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,t){t&&(this._options=t);const n=this._properties.properties;if(e)for(const i in e){const t=e[i];if(i.endsWith("-transition")){const e=i.slice(0,-11);n[e]&&this.setTransition(e,t)}else n.hasOwnProperty(i)&&this.setValue(i,t)}}getTransition(e){return Ve(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new va(this._values[e].property)),this._values[e].transition=Ve(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e["".concat(t,"-transition")]=i)}return e}transitioned(e,t){const n=new wa(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new wa(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ba{constructor(e,t,n,i,r){const s=i.delay||0,a=i.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+s,this.end=this.begin+a,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),s=this.prior;if(s){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return s.possiblyEvaluate(e,t,n);{const a=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(e,t,n),r,Te(a))}}return r}}class wa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Sa(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ja{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=n,this.configDependencies=new Set}getValue(e){return Ve(this._values[e].value)}setValue(e,t){this._values[e]=new ya(this._values[e].property,null===t?void 0:Ve(t),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Sa(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class Na{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Sa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ka{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=hn[this.specification.type];return i?i(e,t,n):e}}class Ta{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new Na(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Na(this,{kind:"constant",value:void 0},e.parameters);const i=hn[this.specification.type];return i?new Na(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,r,s){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,s)}}class Ca{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class Ea{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new xa(0,{});for(const n in e){const i=e[n];i.specification.overridable&&this.overridableProperties.push(n);const r=this.defaultPropertyValues[n]=new ya(i,void 0),s=this.defaultTransitionablePropertyValues[n]=new va(i);this.defaultTransitioningPropertyValues[n]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=r.possiblyEvaluate(t)}}}Gs(Ta,"DataDrivenProperty"),Gs(ka,"DataConstantProperty"),Gs(Ca,"ColorRampProperty");var Aa=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Ma(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Da(e){if(Array.isArray(e))return e.map(Da);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Da(e[n]);return t}return Ma(e)}function Ia(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ia(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Pa(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ia(e)||(e=Va(e));const r=e;let s=!0;try{s=function(e){if(!za(e))return e;let t=Da(e);return La(t),t=Ra(t),t}(r)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(r,null,2),"\n        "))}let a=null,o=null;if("background"!==i&&"sky"!==i&&"slot"!==i){o=Aa["filter_".concat(i)];const e=Rs(s,o,t,n);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));a=(t,n,i)=>e.value.evaluate(t,n,{},i)}let l=null,c=null;if(s!==r){const e=Rs(r,o,t,n);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));l=(t,n,i,r,s)=>e.value.evaluate(t,n,{},i,void 0,void 0,r,s),c=!ur(e.value.expression)}return{filter:a,dynamicFilter:l||void 0,needGeometry:Ba(s),needFeature:!!c}}function Ra(e){if(!Array.isArray(e))return e;const t=function(e){if(Oa.has(e[0]))for(let t=1;t<e.length;t++)if(za(e[t]))return!0;return e}(e);return!0===t?t:t.map(e=>Ra(e))}function La(e){let t=!1;const n=[];if("case"===e[0]){for(let i=1;i<e.length-1;i+=2)t=t||za(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||za(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||za(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}t&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)La(e[i])}function za(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(za(e[n]))return!0;return!1}const Oa=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fa(e,t){return e<t?-1:e>t?1:0}function Ba(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Ba(e[t]))return!0;return!1}function Va(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Ua(e[1],e[2],"=="):"!="===t?Wa(Ua(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Ua(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(Va))):"all"===t?["all"].concat(e.slice(1).map(Va)):"none"===t?["all"].concat(e.slice(1).map(Va).map(Wa)):"in"===t?Ha(e[1],e.slice(2)):"!in"===t?Wa(Ha(e[1],e.slice(2))):"has"===t?qa(e[1]):"!has"!==t||Wa(qa(e[1]));var n}function Ua(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function Ha(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Fa)]]:["filter-in-small",e,["literal",t]]}}function qa(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Wa(e){return["!",e]}const Ga="\x1f";function Ya(e,t){return t?"".concat(e).concat(Ga).concat(t):e}const Za="-transition",Xa=new Set(["fill","line","background","hillshade","raster"]);class Ka extends en{constructor(e,t,n,i,r){if(super(),this.id=e.id,this.fqid=Ya(this.id,n),this.type=e.type,this.scope=n,this.lut=i,this.options=r,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==e.type){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const t=Rs(this.filter,Aa["filter_".concat(e.type)]);"error"!==t.result&&(this.configDependencies=new Set([...this.configDependencies,...t.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new ja(t.layout,this.scope,r),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),t.paint){this._transitionablePaint=new _a(t.paint,this.scope,r);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sa(t.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Xa.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...n.configDependencies]),"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Za)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const n=this._transitionablePaint,i=n._properties.properties;if(e.endsWith(Za)){const r=e.slice(0,-11);return i[r]&&n.setTransition(r,t||void 0),!1}if(!i[e])return!1;const r=n._values[e],s=r.value.isDataDriven(),a=r.value;n.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...n.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const o=n._values[e].value,l=o.isDataDriven(),c=e.endsWith("pattern")||"line-dasharray"===e;return l||s||c||this._handleOverridablePaintPropertyUpdate(e,a,o)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t,n){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return Be({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Na&&bs(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Pa(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,t,n,i,r,s,a,o,l){}}const Qa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ja{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $a{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&t.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function eo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:e.map(e=>{const r=Qa[e.type].BYTES_PER_ELEMENT,s=n=to(n,Math.max(t,r)),a=e.components||1;return i=Math.max(i,r),n+=r*a,{name:e.name,type:e.type,components:a,offset:s}}),size:to(n,Math.max(i,t)),alignment:t}}function to(e,t){return Math.ceil(e/t)*t}class no extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}no.prototype.bytesPerElement=4,Gs(no,"StructArrayLayout2i4");class io extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}io.prototype.bytesPerElement=6,Gs(io,"StructArrayLayout3i6");class ro extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const s=4*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,e}}ro.prototype.bytesPerElement=8,Gs(ro,"StructArrayLayout4i8");class so extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}so.prototype.bytesPerElement=4,Gs(so,"StructArrayLayout1f4");class ao extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=4*e,s=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.float32[s+1]=i,e}}ao.prototype.bytesPerElement=8,Gs(ao,"StructArrayLayout2i1f8");class oo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=4*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}oo.prototype.bytesPerElement=8,Gs(oo,"StructArrayLayout3i8");class lo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r)}emplace(e,t,n,i,r,s){const a=5*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=s,e}}lo.prototype.bytesPerElement=10,Gs(lo,"StructArrayLayout5i10");class co extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r,s,a)}emplace(e,t,n,i,r,s,a,o){const l=6*e,c=12*e,d=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=s,this.uint8[c+7]=a,this.float32[d+2]=o,e}}co.prototype.bytesPerElement=12,Gs(co,"StructArrayLayout2i4ub1f12");class uo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}uo.prototype.bytesPerElement=12,Gs(uo,"StructArrayLayout3f12");class ho extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r)}emplace(e,t,n,i,r,s){const a=6*e,o=3*e;return this.uint16[a+0]=t,this.uint16[a+1]=n,this.uint16[a+2]=i,this.uint16[a+3]=r,this.float32[o+2]=s,e}}ho.prototype.bytesPerElement=12,Gs(ho,"StructArrayLayout4ui1f12");class po extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const s=4*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=i,this.uint16[s+3]=r,e}}po.prototype.bytesPerElement=8,Gs(po,"StructArrayLayout4ui8");class mo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,s)}emplace(e,t,n,i,r,s,a){const o=6*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,this.int16[o+4]=s,this.int16[o+5]=a,e}}mo.prototype.bytesPerElement=12,Gs(mo,"StructArrayLayout6i12");class fo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a,o,l,c,d,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,n,i,r,s,a,o,l,c,d,u)}emplace(e,t,n,i,r,s,a,o,l,c,d,u,h){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=s,this.uint16[p+5]=a,this.uint16[p+6]=o,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=d,this.int16[p+10]=u,this.int16[p+11]=h,e}}fo.prototype.bytesPerElement=24,Gs(fo,"StructArrayLayout4i4ui4i24");class go extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,s)}emplace(e,t,n,i,r,s,a){const o=10*e,l=5*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.float32[l+2]=r,this.float32[l+3]=s,this.float32[l+4]=a,e}}go.prototype.bytesPerElement=20,Gs(go,"StructArrayLayout3i3f20");class xo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const s=4*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.float32[s+3]=r,e}}xo.prototype.bytesPerElement=16,Gs(xo,"StructArrayLayout4f16");class yo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}yo.prototype.bytesPerElement=4,Gs(yo,"StructArrayLayout1ul4");class vo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}vo.prototype.bytesPerElement=4,Gs(vo,"StructArrayLayout2ui4");class _o extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a,o,l,c,d,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,i,r,s,a,o,l,c,d,u,h)}emplace(e,t,n,i,r,s,a,o,l,c,d,u,h,p){const m=20*e,f=10*e;return this.int16[m+0]=t,this.int16[m+1]=n,this.int16[m+2]=i,this.int16[m+3]=r,this.int16[m+4]=s,this.float32[f+3]=a,this.float32[f+4]=o,this.float32[f+5]=l,this.float32[f+6]=c,this.int16[m+14]=d,this.uint32[f+8]=u,this.uint16[m+18]=h,this.uint16[m+19]=p,e}}_o.prototype.bytesPerElement=40,Gs(_o,"StructArrayLayout5i4f1i1ul2ui40");class bo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r,s,a)}emplace(e,t,n,i,r,s,a,o){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+4]=r,this.int16[l+5]=s,this.int16[l+6]=a,this.int16[l+7]=o,e}}bo.prototype.bytesPerElement=16,Gs(bo,"StructArrayLayout3i2i2i16");class wo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r)}emplace(e,t,n,i,r,s){const a=4*e,o=8*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.int16[o+6]=r,this.int16[o+7]=s,e}}wo.prototype.bytesPerElement=16,Gs(wo,"StructArrayLayout2f1f2i16");class jo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,s)}emplace(e,t,n,i,r,s,a){const o=20*e,l=5*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=s,this.float32[l+4]=a,e}}jo.prototype.bytesPerElement=20,Gs(jo,"StructArrayLayout2ub4f20");class No extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}No.prototype.bytesPerElement=6,Gs(No,"StructArrayLayout3ui6");class So extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_)}emplace(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b){const w=30*e,j=15*e,N=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=i,this.float32[j+2]=r,this.float32[j+3]=s,this.uint16[w+8]=a,this.uint16[w+9]=o,this.uint32[j+5]=l,this.uint32[j+6]=c,this.uint32[j+7]=d,this.uint16[w+16]=u,this.uint16[w+17]=h,this.uint16[w+18]=p,this.float32[j+10]=m,this.float32[j+11]=f,this.uint8[N+48]=g,this.uint8[N+49]=x,this.uint8[N+50]=y,this.uint32[j+13]=v,this.int16[w+28]=_,this.uint8[N+58]=b,e}}So.prototype.bytesPerElement=60,Gs(So,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ko extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b,w,j,N,S,k,T,C,E,A,M,D){const I=this.length;return this.resize(I+1),this.emplace(I,e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b,w,j,N,S,k,T,C,E,A,M,D)}emplace(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b,w,j,N,S,k,T,C,E,A,M,D,I){const P=20*e,R=40*e,L=80*e;return this.float32[P+0]=t,this.float32[P+1]=n,this.int16[R+4]=i,this.int16[R+5]=r,this.int16[R+6]=s,this.int16[R+7]=a,this.int16[R+8]=o,this.int16[R+9]=l,this.int16[R+10]=c,this.int16[R+11]=d,this.int16[R+12]=u,this.uint16[R+13]=h,this.uint16[R+14]=p,this.uint16[R+15]=m,this.uint16[R+16]=f,this.uint16[R+17]=g,this.uint16[R+18]=x,this.uint16[R+19]=y,this.uint16[R+20]=v,this.uint16[R+21]=_,this.uint16[R+22]=b,this.uint16[R+23]=w,this.uint16[R+24]=j,this.uint16[R+25]=N,this.uint16[R+26]=S,this.uint16[R+27]=k,this.uint32[P+14]=T,this.float32[P+15]=C,this.float32[P+16]=E,this.float32[P+17]=A,this.float32[P+18]=M,this.uint8[L+76]=D,this.uint16[R+39]=I,e}}ko.prototype.bytesPerElement=80,Gs(ko,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class To extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,s)}emplace(e,t,n,i,r,s,a){const o=6*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,this.float32[o+4]=s,this.float32[o+5]=a,e}}To.prototype.bytesPerElement=24,Gs(To,"StructArrayLayout6f24");class Co extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r)}emplace(e,t,n,i,r,s){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,this.float32[a+4]=s,e}}Co.prototype.bytesPerElement=20,Gs(Co,"StructArrayLayout5f20");class Eo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r,s,a)}emplace(e,t,n,i,r,s,a,o){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=r,this.float32[l+4]=s,this.float32[l+5]=a,this.float32[l+6]=o,e}}Eo.prototype.bytesPerElement=28,Gs(Eo,"StructArrayLayout7f28");class Ao extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a,o,l,c,d){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,i,r,s,a,o,l,c,d)}emplace(e,t,n,i,r,s,a,o,l,c,d,u){const h=11*e;return this.float32[h+0]=t,this.float32[h+1]=n,this.float32[h+2]=i,this.float32[h+3]=r,this.float32[h+4]=s,this.float32[h+5]=a,this.float32[h+6]=o,this.float32[h+7]=l,this.float32[h+8]=c,this.float32[h+9]=d,this.float32[h+10]=u,e}}Ao.prototype.bytesPerElement=44,Gs(Ao,"StructArrayLayout11f44");class Mo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a,o,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,i,r,s,a,o,l)}emplace(e,t,n,i,r,s,a,o,l,c){const d=9*e;return this.float32[d+0]=t,this.float32[d+1]=n,this.float32[d+2]=i,this.float32[d+3]=r,this.float32[d+4]=s,this.float32[d+5]=a,this.float32[d+6]=o,this.float32[d+7]=l,this.float32[d+8]=c,e}}Mo.prototype.bytesPerElement=36,Gs(Mo,"StructArrayLayout9f36");class Do extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}Do.prototype.bytesPerElement=8,Gs(Do,"StructArrayLayout2f8");class Io extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const s=6*e;return this.uint32[3*e+0]=t,this.uint16[s+2]=n,this.uint16[s+3]=i,this.uint16[s+4]=r,e}}Io.prototype.bytesPerElement=12,Gs(Io,"StructArrayLayout1ul3ui12");class Po extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Po.prototype.bytesPerElement=2,Gs(Po,"StructArrayLayout1ui2");class Ro extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f)}emplace(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g){const x=16*e;return this.float32[x+0]=t,this.float32[x+1]=n,this.float32[x+2]=i,this.float32[x+3]=r,this.float32[x+4]=s,this.float32[x+5]=a,this.float32[x+6]=o,this.float32[x+7]=l,this.float32[x+8]=c,this.float32[x+9]=d,this.float32[x+10]=u,this.float32[x+11]=h,this.float32[x+12]=p,this.float32[x+13]=m,this.float32[x+14]=f,this.float32[x+15]=g,e}}Ro.prototype.bytesPerElement=64,Gs(Ro,"StructArrayLayout16f64");class Lo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r,s,a)}emplace(e,t,n,i,r,s,a,o){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,this.uint16[l+2]=i,this.uint16[l+3]=r,this.float32[c+2]=s,this.float32[c+3]=a,this.float32[c+4]=o,e}}Lo.prototype.bytesPerElement=20,Gs(Lo,"StructArrayLayout4ui3f20");class zo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}zo.prototype.bytesPerElement=2,Gs(zo,"StructArrayLayout1i2");class Oo extends $a{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}Oo.prototype.bytesPerElement=1,Gs(Oo,"StructArrayLayout1ub1");class Fo extends Ja{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fo.prototype.size=40;class Bo extends _o{get(e){return new Fo(this,e)}}Gs(Bo,"CollisionBoxArray");class Vo extends Ja{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Vo.prototype.size=60;class Uo extends So{get(e){return new Vo(this,e)}}Gs(Uo,"PlacedSymbolArray");class Ho extends Ja{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ho.prototype.size=80;class qo extends ko{get(e){return new Ho(this,e)}}Gs(qo,"SymbolInstanceArray");class Wo extends so{getoffsetX(e){return this.float32[1*e+0]}}Gs(Wo,"GlyphOffsetArray");class Go extends no{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Gs(Go,"SymbolLineVertexArray");class Yo extends Ja{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yo.prototype.size=12;class Zo extends Io{get(e){return new Yo(this,e)}}Gs(Zo,"FeatureIndexArray");class Xo extends vo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Gs(Xo,"FillExtrusionCentroidArray");class Ko extends Ja{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ko.prototype.size=6;class Qo extends io{get(e){return new Ko(this,e)}}Gs(Qo,"FillExtrusionWallArray");const Jo=eo([{name:"a_pos",components:2,type:"Int16"}],4),$o=eo([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),el=eo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class tl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>tl.MAX_VERTEX_ARRAY_LENGTH&&qe("Max vertices per segment is ".concat(tl.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!r||r.vertexLength+e>tl.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t,primitiveOffset:n,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}prepareSegment(e,t,n,i){return this._prepareSegment(e,t.length,n.length,i)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new tl([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function nl(e,t){return 256*(e=Ae(Math.floor(e),0,255))+Ae(Math.floor(t),0,255)}tl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gs(tl,"SegmentVector");const il=eo([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rl=eo([{name:"a_pattern_b",components:4,type:"Uint16"}]),sl=eo([{name:"a_dash",components:4,type:"Uint16"}]);class al{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(ol(e)),this.positions.push(t,n,i)}eachPosition(e,t){const n=ol(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=n?r=e:i=e+1}for(;this.ids[i]===n;)t(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return ll(n,i,0,n.length-1),t&&(t.add(n.buffer),t.add(i.buffer)),{ids:n,positions:i}}static deserialize(e){const t=new al;let n;t.ids=e.ids,t.positions=e.positions;for(const i of t.ids)i!==n&&t.uniqueIds.push(i),n=i;return t.indexed=!0,t}}function ol(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Xt(String(e))}function ll(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let s=n-1,a=i+1;for(;;){do{s++}while(e[s]<r);do{a--}while(e[a]>r);if(s>=a)break;cl(e,s,a),cl(t,3*s,3*a),cl(t,3*s+1,3*a+1),cl(t,3*s+2,3*a+2)}a-n<i-a?(ll(e,t,n,a),n=a+1):(ll(e,t,a+1,i),i=a)}}function cl(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Gs(al,"FeaturePositionMap");class dl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,n){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ul extends dl{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class hl extends dl{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class pl extends dl{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class ml extends dl{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class fl extends dl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class gl extends dl{constructor(e){super(e),this.current=an.transparent.toPremultipliedRenderColor(null)}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const xl=new Float32Array(16);class yl extends dl{constructor(e){super(e),this.current=xl}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const vl=new Float32Array(9),_l=new Float32Array(4);class bl extends dl{constructor(e){super(e),this.current=_l}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<4;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}function wl(e){return[nl(255*e.r,255*e.g),nl(255*e.b,255*e.a)]}class jl{constructor(e,t,n,i){this.value=e,this.uniformNames=t.map(e=>"u_".concat(e)),this.type=n,this.context=i}setUniform(e,t,n,i,r){const s=i.constantOr(this.value);t.set(e,r,s instanceof an?s.toPremultipliedRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):s)}getBinding(e,t){return"color"===this.type?new gl(e):new hl(e)}}class Nl{constructor(e,t){this.uniformNames=t.map(e=>"u_".concat(e)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,t){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=t?t.tl.concat(t.br):this.pattern}setUniform(e,t,n,i,r){let s=null;"u_pattern"!==r&&"u_dash"!==r||(s=this.pattern),"u_pattern_b"===r&&(s=this.patternTransition),"u_pixel_ratio"===r&&(s=this.pixelRatio),s&&t.set(e,r,s)}getBinding(e,t){return"u_pattern"===t||"u_pattern_b"===t||"u_dash"===t?new fl(e):new hl(e)}}class Sl{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r,s,a,o){const l=this.paintVertexArray.length,c="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new xa(0,{brightness:s,worldview:o}),t,{},r,i,a):"constant"===this.expression.kind&&this.expression.value,d=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xa(0,{brightness:s,worldview:o}),t,{},r,i,a):this.lutExpression.value);this.paintVertexArray.resize(e),this._setPaintValue(l,e,c,d?null:this.context.lut)}updatePaintArray(e,t,n,i,r,s,a,o){const l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:a,worldview:o},n,i,void 0,r):"constant"===this.expression.kind&&this.expression.value,c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xa(0,{brightness:a,worldview:o}),n,i,void 0,r):this.lutExpression.value);this._setPaintValue(e,t,l,c?null:this.context.lut)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=wl(n.toPremultipliedRenderColor(i));for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kl{constructor(e,t,n,i,r,s){this.expression=e,this.uniformNames=t.map(e=>"u_".concat(e,"_t")),this.type=n,this.useIntegerZoom=i,this.context=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,t,n,i,r,s,a,o){const l=this.expression.evaluate(new xa(this.context.zoom,{brightness:s,worldview:o}),t,{},r,i,a),c=this.expression.evaluate(new xa(this.context.zoom+1,{brightness:s,worldview:o}),t,{},r,i,a),d=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xa(0,{brightness:s,worldview:o}),t,{},r,i,a):this.lutExpression.value),u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(u,e,l,c,d?null:this.context.lut)}updatePaintArray(e,t,n,i,r,s,a,o){const l=this.expression.evaluate({zoom:this.context.zoom,brightness:a,worldview:o},n,i,void 0,r),c=this.expression.evaluate({zoom:this.context.zoom+1,brightness:a,worldview:o},n,i,void 0,r),d=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xa(0,{brightness:a,worldview:o}),n,i,void 0,r):this.lutExpression.value);this._setPaintValue(e,t,l,c,d?null:this.context.lut)}_setPaintValue(e,t,n,i,r){if("color"===this.type){const i=wl(n.toPremultipliedRenderColor(r)),s=wl(n.toPremultipliedRenderColor(r));for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1],s[0],s[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,i,r){const s=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,a=Ae(this.expression.interpolationFactor(s,this.context.zoom,this.context.zoom+1),0,1);t.set(e,r,a)}getBinding(e,t){return new hl(e)}}class Tl{constructor(e,t,n,i,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===n?sl:il).members;for(let s=0;s<t.length;++s);this.paintVertexArray=new i,this.paintTransitionVertexArray=new po}populatePaintArray(e,t,n,i){const r=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r,s,a){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],s)}_setPaintValues(e,t,n,i){if(!i||!n)return;const r=i[n[0]],s=i[n[1]];if(r){if(r){const{tl:n,br:i,pixelRatio:s}=r;for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1],i[0],i[1],s)}if(s){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:n,br:i}=s;for(let r=e;r<t;r++)this.paintTransitionVertexArray.emplace(r,n[0],n[1],i[0],i[1])}}}upload(e){const t=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,t)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,rl.members,t))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Cl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[],this.context=t;const i=[];for(const r in e.paint._values){const s=e.paint.get(r);if(r.endsWith("-use-theme"))continue;if(!n(r))continue;if(!(s instanceof Na&&bs(s.property.specification)))continue;const a=Ml(r,e.type),o=s.value,l=s.property.specification.type,c=!!s.property.useIntegerZoom,d="line-dasharray"===r||r.endsWith("pattern"),u=e.paint.get("".concat(r,"-use-theme")),h="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind||u&&"constant"!==u.value.kind;if("constant"!==o.kind||h)if("source"===o.kind||h||d){const t=Pl(r,l,"source");this.binders[r]=d?new Tl(o,a,l,t,e.id):new Sl(o,a,l,t),i.push("/a_".concat(r))}else{const e=Pl(r,l,"composite");this.binders[r]=new kl(o,a,l,c,t,e),i.push("/z_".concat(r))}else this.binders[r]=d?new Nl(o.value,a):new jl(o.value,a,l,t),i.push("/u_".concat(r));u&&(this.binders[r].lutExpression=u.value)}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Sl||t instanceof kl?t.maxValue:0}populatePaintArrays(e,t,n,i,r,s,a,o){for(const l in this.binders){const c=this.binders[l];c.context=this.context,(c instanceof Sl||c instanceof kl||c instanceof Tl)&&c.populatePaintArray(e,t,n,i,r,s,a,o)}}setConstantPatternPositions(e,t){for(const n in this.binders){const i=this.binders[n];i instanceof Nl&&i.setConstantPatternPositions(e,t)}}getPatternTransitionVertexBuffer(e){const t=this.binders[e];return t instanceof Tl?t.paintTransitionVertexBuffer:null}updatePaintArrays(e,t,n,i,r,s,a,o,l,c){let d=!1;const u=Object.keys(e),h=0!==u.length&&!o,p=h?u:t.uniqueIds;this.context.lut=r.lut;for(const m in this.binders){const o=this.binders[m];if(o.context=this.context,(o instanceof Sl||o instanceof kl||o instanceof Tl)&&o.expression&&o.expression.kind&&"constant"!==o.expression.kind&&(!0===o.expression.isStateDependent||!1===o.expression.isLightConstant)){const u=r.paint.get(m);o.expression=u.value;for(const n of p){const r=e[n.toString()];t.eachPosition(n,(e,t,n)=>{const d=i.feature(e);o.updatePaintArray(t,n,d,r,s,a,l,c)})}if(!h)for(const t of n.uniqueIds){const r=e[t.toString()];n.eachPosition(t,(e,t,n)=>{const d=i.feature(e);o.updatePaintArray(t,n,d,r,s,a,l,c)})}d=!0}}return d}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof jl||n instanceof Nl)&&e.push(...n.uniformNames.map(e=>"#define HAS_UNIFORM_".concat(e)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Sl||n instanceof kl||n instanceof Tl)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);if(n instanceof Tl)for(let t=0;t<rl.members.length;t++)e.push(rl.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof jl||n instanceof Nl||n instanceof kl)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof jl||i instanceof Nl||i instanceof kl)for(const r of i.uniformNames)t.push({name:r,property:n,binding:i.getBinding(e,r)})}return t}setUniforms(e,t,n,i,r){for(const{name:s,property:a,binding:o}of n)this.binders[a].setUniform(e,o,r,i.get(a),s)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Sl||t instanceof kl||t instanceof Tl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer),t instanceof Tl&&t.paintTransitionVertexBuffer&&this._buffers.push(t.paintTransitionVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Sl||n instanceof kl||n instanceof Tl)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Sl||t instanceof kl||t instanceof Tl)&&t.destroy()}}}class El{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Cl(i,t,n);this.needsUpload=!1,this._featureMap=new al,this._featureMapWithoutIds=new al,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,n,i,r,s,a,o,l){for(const c in this.programConfigurations)this.programConfigurations[c].populatePaintArrays(e,t,i,r,s,a,o,l);void 0!==t.id?this._featureMap.add(t.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i,r,s,a,o){for(const l of n)this.needsUpload=this.programConfigurations[l.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,l,i,r,s,a||0,o)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Al={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Ml(e,t){return Al[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const Dl={"line-pattern":{source:ho,composite:ho},"fill-pattern":{source:ho,composite:ho},"fill-extrusion-pattern":{source:ho,composite:ho},"line-dasharray":{source:po,composite:po}},Il={color:{source:Do,composite:xo},number:{source:so,composite:Do}};function Pl(e,t,n){const i=Dl[e];return i&&i[n]||Il[t][n]}Gs(jl,"ConstantBinder"),Gs(Nl,"PatternConstantBinder"),Gs(Sl,"SourceExpressionBinder"),Gs(Tl,"PatternCompositeBinder"),Gs(kl,"CompositeExpressionBinder"),Gs(Cl,"ProgramConfiguration",{omit:["_buffers"]}),Gs(El,"ProgramConfigurationSet");const Rl=Pi/Math.PI/2,Ll=5,zl=6,Ol=16383,Fl=64,Bl=[Fl,32,16],Vl=-Rl,Ul=Rl;function Hl(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Rl;return n=Ne(n),[e*Math.sin(n)*i,-t*i,e*Math.cos(n)*i]}function ql(e,t,n){return Hl(Math.cos(Ne(e)),Math.sin(Ne(e)),t,n)}const Wl=6371008.8,Gl=2*Math.PI*Wl;class Yl{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yl(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Wl*Math.acos(Math.min(r,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new Zl({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return ql(this.lat,this.lng,Rl+e*Rl/Wl)}static convert(e){if(e instanceof Yl)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Yl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Yl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Zl{constructor(e,t){if(e)if(t)this.setSouthWest(e).setNorthEast(t);else if(4===e.length){const t=e;this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]])}else{const t=e;this.setSouthWest(t[0]).setNorthEast(t[1])}}setNorthEast(e){return this._ne=e instanceof Yl?new Yl(e.lng,e.lat):Yl.convert(e),this}setSouthWest(e){return this._sw=e instanceof Yl?new Yl(e.lng,e.lat):Yl.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,r;if(e instanceof Yl)i=e,r=e;else{if(!(e instanceof Zl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Zl.convert(e)):this.extend(Yl.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Yl.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Yl(i.lng,i.lat),this._ne=new Yl(r.lng,r.lat)),this}getCenter(){return new Yl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yl(this.getWest(),this.getNorth())}getSouthEast(){return new Yl(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Yl.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){if(e)return e instanceof Zl?e:new Zl(e)}}const Xl=0,Kl=25.5;function Ql(e){return Gl*Math.cos(e*Math.PI/180)}function Jl(e){return(180+e)/360}function $l(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ec(e,t){return e/Ql(t)}function tc(e){return 360*e-180}function nc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function ic(e,t){return e*Ql(nc(t))}const rc=85.051129;function sc(e){return Math.cos(Ne(Ae(e,-rc,rc)))}function ac(e,t){const n=Ae(t,Xl,Kl),i=Math.pow(2,n);return sc(e)*Gl/(512*i)}function oc(e){return 1/Math.cos(e*Math.PI/180)}function lc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.exp(Math.PI*(1-(e.y+t/Pi)/(1<<e.z)*2));return 80150034*n/(n*n+1)/Pi/(1<<e.z)}class cc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Yl.convert(e);return new cc(Jl(n.lng),$l(n.lat),ec(t,n.lat))}toLngLat(){return new Yl(tc(this.x),nc(this.y))}toAltitude(){return ic(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gl*oc(nc(this.y))}}function dc(e,t,n,i,r,s,a,o,l){const c=(t+i)/2,d=(n+r)/2,u=new _e(c,d);o(u),function(e,t,n,i,r,s){const a=n-r,o=i-s;return Math.abs((i-t)*a-(n-e)*o)/Math.hypot(a,o)}(u.x,u.y,s.x,s.y,a.x,a.y)>=l?(dc(e,t,n,c,d,s,u,o,l),dc(e,c,d,i,r,u,a,o,l)):e.push(a)}function uc(e,t,n){let i=e[0],r=i.x,s=i.y;t(i);const a=[i];for(let o=1;o<e.length;o++){const l=e[o],{x:c,y:d}=l;t(l),dc(a,r,s,c,d,i,l,t,n),r=c,s=d,i=l}return a}function hc(e,t,n,i){if(i(t,n)){const r=t.add(n)._mult(.5);hc(e,t,r,i),hc(e,r,n,i)}else e.push(n)}function pc(e,t){let n=e[0];const i=[n];for(let r=1;r<e.length;r++){const s=e[r];hc(i,n,s,t),n=s}return i}const mc=Math.pow(2,14)-1,fc=-mc-1;function gc(e,t){const n=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=Ae(n,fc,mc),e.y=Ae(i,fc,mc),(n<e.x||n>e.x+1||i<e.y||i>e.y+1)&&qe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function xc(e,t,n){const i=e.loadGeometry(),r=e.extent,s=Pi/r;if(t&&n&&n.projection.isReprojectedInTileSpace){const s=1<<t.z,{scale:a,x:o,y:l,projection:c}=n,d=e=>{const n=tc((t.x+e.x/r)/s),i=nc((t.y+e.y/r)/s),d=c.project(n,i);e.x=(d.x*a-o)*r,e.y=(d.y*a-l)*r};for(let t=0;t<i.length;t++)if(1!==e.type)i[t]=uc(i[t],d,1);else{const e=[];for(const n of i[t])n.x<0||n.x>=r||n.y<0||n.y>=r||(d(n),e.push(n));i[t]=e}}for(const a of i)for(const e of a)gc(e,s);return i}function yc(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?xc(e):[]}}class vc{constructor(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(_c,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,n=[];let i,r=1,s=0,a=0,o=0;for(;e.pos<t;){if(s<=0){const t=e.readVarint();r=7&t,s=t>>3}if(s--,1===r||2===r)a+=e.readSVarint(),o+=e.readSVarint(),1===r&&(i&&n.push(i),i=[]),i&&i.push(new _e(a,o));else{if(7!==r)throw new Error("unknown command ".concat(r));i&&i.push(i[0].clone())}}return i&&n.push(i),n}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let n=1,i=0,r=0,s=0,a=1/0,o=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(i<=0){const t=e.readVarint();n=7&t,i=t>>3}if(i--,1===n||2===n)r+=e.readSVarint(),s+=e.readSVarint(),r<a&&(a=r),r>o&&(o=r),s<l&&(l=s),s>c&&(c=s);else if(7!==n)throw new Error("unknown command ".concat(n))}return[a,l,o,c]}toGeoJSON(e,t,n){const i=this.extent*Math.pow(2,n),r=this.extent*e,s=this.extent*t,a=this.loadGeometry();function o(e){return[360*(e.x+r)/i-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+s)/i)*Math.PI))-90]}function l(e){return e.map(o)}let c;if(1===this.type){const e=[];for(const n of a)e.push(n[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=a.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const n=[];let i,r;for(let s=0;s<t;s++){const t=bc(e[s]);0!==t&&(void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[e[s]]):i&&i.push(e[s]))}return i&&n.push(i),n}(a),t=[];for(const n of e)t.push(n.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const d={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(d.id=this.id),d}}function _c(e,t,n){1===e?t.id=n.readVarint():2===e?function(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(n,t):3===e?t.type=n.readVarint():4===e&&(t._geometry=n.pos)}function bc(e){let t=0;for(let n,i,r=0,s=e.length,a=s-1;r<s;a=r++)n=e[r],i=e[a],t+=(i.x-n.x)*(n.y+i.y);return t}vc.types=["Unknown","Point","LineString","Polygon"];class wc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(jc,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new vc(this._pbf,t,this.extent,this._keys,this._values)}}function jc(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(n))}class Nc{constructor(e,t){this.layers=e.readFields(Sc,{},t)}}function Sc(e,t,n){if(3===e){const e=new wc(n,n.readVarint()+n.pos);e.length&&(t[e.name]=e)}}const kc="3d_elevation_id",Tc="level";class Cc{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(e,t){return this._valid&&e(t(this._geometry)),this}require(e,t,n){return this.get(e,!0,t,n)}optional(e,t,n){return this.get(e,!1,t,n)}success(){return this._valid}get(e,t,n,i){const r=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&void 0!==r&&!Number.isNaN(r)?n(i?i(r):r):t&&(this._valid=!1),this}}class Ec{constructor(e,t){this.featureFunc=e,this.vertexFunc=t}parseFeature(e,t,n){return this.featureFunc(e,t,n)}parseVertex(e,t,n){return this.vertexFunc(e,t,n)}}const Ac=new Ec((e,t,n)=>e.reset(t).require(kc,e=>{n.id=e}).optional("fixed_height_relative",e=>{n.constantHeight=e},Dc.decodeRelativeHeight).geometry(e=>{n.bounds=e},hi).success(),(e,t,n)=>e.reset(t).require(kc,e=>{n.id=e}).require("elevation_idx",e=>{n.idx=e}).require("extent",e=>{n.extent=e}).require("height_relative",e=>{n.height=e},Dc.decodeRelativeHeight).geometry(e=>{n.position=e},Dc.getPoint).success()),Mc=new Ec((e,t,n)=>e.reset(t).require(kc,e=>{n.id=e}).optional("fixed_height",e=>{n.constantHeight=e},Dc.decodeMetricHeight).geometry(e=>{n.bounds=e},hi).success(),(e,t,n)=>e.reset(t).require(kc,e=>{n.id=e}).require("elevation_idx",e=>{n.idx=e}).require("extent",e=>{n.extent=e}).require("height",e=>{n.height=e},Dc.decodeMetricHeight).geometry(e=>{n.position=e},Dc.getPoint).success());class Dc{static getPoint(e){return oe(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const t=[],n=[],i=e.length,r=new Cc;for(let a=0;a<i;a++){const i=e.feature(a),o=i.properties.version,l=(s=o)?"1.0.1"===s?Mc:void 0:Ac;if(void 0===l){qe("Unknown elevation feature version number ".concat(o||"(unknown)"));continue}const c=i.properties.hasOwnProperty("type")?i.properties.type:void 0;if(c)if("Point"===vc.types[i.type]&&"curve_point"===c){const e={};l.parseVertex(r,i,e)&&t.push(e)}else if("Polygon"===vc.types[i.type]&&"curve_meta"===c){const e={};l.parseFeature(r,i,e)&&n.push(e)}}var s;return{vertices:t,features:n}}}class Ic{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=pe(t,this.dir);if(Math.abs(i)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1])/i;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,!0}}class Pc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=L(t,this.dir);if(Math.abs(i)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/i;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,n[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,n,i){if(function(e,n){var i=e[0],r=e[1],s=e[2],a=n[0],o=n[1],l=n[2];return Math.abs(i-a)<=t*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=t*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-l)<=t*Math.max(1,Math.abs(s),Math.abs(l))}(this.pos,e)||0===n)return i[0]=i[1]=i[2]=0,!1;const[r,s,a]=this.dir,o=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],d=r*r+s*s+a*a,u=2*(o*r+l*s+c*a),h=u*u-4*d*(o*o+l*l+c*c-n*n);if(h<0){const e=Math.max(-u/2,0),t=o+r*e,d=l+s*e,h=c+a*e,p=Math.hypot(t,d,h);return i[0]=t*n/p,i[1]=d*n/p,i[2]=h*n/p,!1}{const e=(-u-Math.sqrt(h))/(2*d);if(e<0){const e=Math.hypot(o,l,c);return i[0]=o*n/e,i[1]=l*n/e,i[2]=c*n/e,!1}return i[0]=o+r*e,i[1]=l+s*e,i[2]=c+a*e,!0}}}class Rc{constructor(e,t,n,i,r){this.TL=e,this.TR=t,this.BR=n,this.BL=i,this.horizon=r}static fromInvProjectionMatrix(e,t,n){const i=[-1,1,1],r=[1,1,1],s=[1,-1,1],a=[-1,-1,1],o=F(i,i,e),l=F(r,r,e),c=F(s,s,e),d=F(a,a,e);return new Rc(o,l,c,d,t/n)}}function Lc(e,t,n){let i=1/0,r=-1/0;const s=[];for(const a of e){q(s,a,t);const e=L(s,n);i=Math.min(i,e),r=Math.max(r,e)}return[i,r]}function zc(e,t){let n=!0;for(let i=0;i<e.planes.length;i++){const r=e.planes[i];let s=0;for(let e=0;e<t.length;e++)s+=L(r,t[e])+r[3]>=0;if(0===s)return 0;s!==t.length&&(n=!1)}return n?2:1}function Oc(e,t){for(const n of e.projections){const i=Lc(t,e.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function Fc(e,t){let n=0;const i=[0,0,0,0];for(let a=0;a<e.length;a++)i[0]=e[a][0],i[1]=e[a][1],i[2]=e[a][2],i[3]=1,(r=i)[0]*(s=t)[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]>=0&&n++;var r,s;return n}class Bc{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Vc.fromPoints(this.points),this.projections=[],this.frustumEdges=[q([],this.points[2],this.points[3]),q([],this.points[0],this.points[3]),q([],this.points[4],this.points[0]),q([],this.points[5],this.points[1]),q([],this.points[6],this.points[2]),q([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const e=[0,-n[2],n[1]],t=[n[2],0,-n[0]];this.projections.push({axis:e,projection:Lc(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:Lc(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(e,t,n,i){const r=Math.pow(2,n),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(n=>{const s=K([],n,e),a=1/s[3]/t*r;return(o=s)[0]=(l=s)[0]*(c=[a,a,i?1/s[3]:a,a])[0],o[1]=l[1]*c[1],o[2]=l[2]*c[2],o[3]=l[3]*c[3],o;var o,l,c}),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const t=R([],z([],q([],s[e[0]],s[e[1]]),q([],s[e[2]],s[e[1]]))),n=-L(t,s[e[1]]);return t.concat(n)}),o=[];for(let l=0;l<s.length;l++)o.push([s[l][0],s[l][1],s[l][2]]);return new Bc(o,a)}intersectsPrecise(e,t,n){for(let i=0;i<t.length;i++)if(!Fc(e,t[i]))return 0;for(let i=0;i<this.planes.length;i++)if(!Fc(e,this.planes[i]))return 0;for(const i of n)for(const t of this.frustumEdges){const n=z([],i,t),r=w(n);if(0===r)continue;A(n,n,1/r);const s=Lc(this.points,this.points[0],n),a=Lc(e,this.points[0],n);if(s[0]>a[1]||a[0]>s[1])return 0}return 1}containsPoint(e){for(const t of this.planes){const n=t[3];if(L([t[0],t[1],t[2]],e)+n<0)return!1}return!0}}class Vc{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const i of e)C(t,t,i),E(n,n,i);return new Vc(t,n)}static fromTileIdAndHeight(e,t,n){const i=1<<e.canonical.z,r=e.canonical.x,s=e.canonical.y;return new Vc([r/i,s/i,t],[(r+1)/i,(s+1)/i,n])}static applyTransform(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)F(n[i],n[i],t);return Vc.fromPoints(n)}static applyTransformFast(e,t){const n=[t[12],t[13],t[14]],i=[...n];for(let r=0;r<3;r++)for(let s=0;s<3;s++){const a=t[4*s+r],o=a*e.min[s],l=a*e.max[s];n[r]+=Math.min(o,l),i[r]+=Math.max(o,l)}return new Vc(n,i)}static projectAabbCorners(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)F(n[i],n[i],t);return n}constructor(e,t){this.min=e,this.max=t,this.center=A([],S([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=b(this.min),i=b(this.max);for(let r=0;r<t.length;r++)n[r]=t[r]?this.min[r]:this.center[r],i[r]=t[r]?this.center[r]:this.max[r];return i[2]=this.max[2],new Vc(n,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zc(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Oc(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Oc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Gs(Vc,"Aabb");class Uc{constructor(e,t){this.feature=e,this.metersToTile=t,this.index=0}get(){const e=this.feature.vertices[this.index],t=this.feature.vertexProps[this.index].dir,n=t[1],i=-t[0],r=(e.extent+1)*this.metersToTile;return[new _e(Math.trunc(e.position[0]+n*r),Math.trunc(e.position[1]+i*r)),new _e(Math.trunc(e.position[0]-n*r),Math.trunc(e.position[1]-i*r))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Hc{constructor(e,t,n,i,r,s){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:n,max:n},this.safeArea=t,this.constantHeight=n,null==this.constantHeight&&(null!=this.constantHeight||0!==i.length)){this.vertices=i,this.edges=r,this.edges=this.edges.filter(e=>{return e.a<this.vertices.length&&e.b<this.vertices.length&&!((t=this.vertices[e.a].position)[0]===(n=this.vertices[e.b].position)[0]&&t[1]===n[1]);var t,n}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const e of this.vertices)this.vertexProps.push({dir:oe(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(const e of this.edges){const t=this.vertices[e.a].position,n=this.vertices[e.b].position,i=ce(ae(),n,t),r=ue(i),s=de(ae(),i,1/r);this.edgeProps.push({vec:i,dir:s,len:r});const a=this.vertexProps[e.a].dir,o=this.vertexProps[e.b].dir;le(a,a,s),le(o,o,s)}for(const e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||he(e.dir,e.dir);this.tessellate(s)}}pointElevation(e){if(null!=this.constantHeight)return this.constantHeight;const t=this.getClosestEdge(e);if(null==t)return 0;const[n,i]=t;return dn(this.vertices[this.edges[n].a].height,this.vertices[this.edges[n].b].height,i)}computeSlopeNormal(e,t){const n=this.getClosestEdge(e);if(!n)return j(0,0,1);const i=n[0],r=this.edges[i],s=this.edgeProps[i].vec,a=j(s[0],s[1],(this.vertices[r.b].height-this.vertices[r.a].height)*t),o=j(a[1],-a[0],0);z(o,o,a);const l=w(o);return l>0?A(o,o,1/l):j(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(0===this.edges.length)return;let t=0,n=Number.POSITIVE_INFINITY,i=0;const r=oe(e.x,e.y);for(let s=0;s<this.edges.length;s++){const e=this.edges[s],a=this.edgeProps[s].dir,o=new Ic(r,this.edgeProps[s].dir),l=this.vertices[e.a].position,c=this.vertices[e.b].position,d=ae(),u=ae(),h=o.intersectsPlane(l,this.vertexProps[e.a].dir,d),p=o.intersectsPlane(c,this.vertexProps[e.b].dir,u);if(!h||!p)continue;const m=ce(ae(),u,d),f=ce(ae(),r,d),g=pe(m,m),x=g>0?pe(f,m)/g:0,y=Ae(x,0,1),v=Math.abs((x-y)*this.edgeProps[s].len),_=ce(ae(),r,l),b=v+Math.abs(pe(_,oe(a[1],-a[0])));b<n&&(t=s,n=b,i=y)}return[t,i]}tessellate(e){for(let t=this.edges.length-1;t>=0;--t){const n=this.edges[t].a,i=this.edges[t].b,{position:r,height:s,extent:a}=this.vertices[n],{position:o,height:l,extent:c}=this.vertices[i],d=this.vertexProps[n].dir,u=this.vertexProps[i].dir,h=j(r[0]/e,r[1]/e,s),p=j(o[0]/e,o[1]/e,l),m=j(d[1],-d[0],0);A(m,m,a);const f=j(u[1],-u[0],0);if(A(f,f,c),this.distSqLines(j(h[0]+.5*m[0],h[1]+.5*m[1],h[2]+.5*m[2]),j(p[0]-.5*f[0],p[1]-.5*f[1],p[2]-.5*f[2]),j(h[0]-.5*m[0],h[1]-.5*m[1],h[2]-.5*m[2]),j(p[0]+.5*f[0],p[1]+.5*f[1],p[2]+.5*f[2]))<=.0025000000000000005)continue;const g=this.vertices.length,x=le(ae(),r,o);this.vertices.push({position:de(x,x,.5),height:.5*(s+l),extent:.5*(a+c)});const y=le(ae(),d,u);this.vertexProps.push({dir:he(y,y)}),this.edges.splice(t,1),this.edgeProps.splice(t,1),this.edges.push({a:n,b:g}),this.edges.push({a:g,b:i});const v=ce(ae(),this.vertices[g].position,r),_=ue(v),b={vec:v,dir:de(ae(),v,1/_),len:_};this.edgeProps.push(b),this.edgeProps.push(b)}}distSqLines(e,t,n,i){const r=k(_(),t,e),s=k(_(),i,n),a=k(_(),e,n),o=L(r,r),l=L(r,s),c=L(r,a),d=L(s,s),u=L(s,a),h=o*d-l*l;if(0===h){const t=L(a,s)/L(s,s);return D(O(_(),n,i,t),e)}const p=(l*u-c*d)/h,m=(o*u-l*c)/h;return D(O(_(),e,t,p),O(_(),n,i,m))}}class qc{static parseFrom(e,t){const n=Dc.parse(e);if(!n)return[];let{vertices:i,features:r}=n;const s=1/lc(t);r.sort((e,t)=>e.id-t.id),i.sort((e,t)=>e.id-t.id||e.idx-t.idx),i=i.filter((e,t,n)=>t===n.findIndex(t=>t.id===e.id&&t.idx===e.idx));const a=new Array;let o=0;const l=i.length;for(const c of r){if(c.constantHeight){a.push(new Hc(c.id,c.bounds,c.constantHeight));continue}for(;o!==l&&i[o].id<c.id;)o++;if(o===l||i[o].id!==c.id)continue;const e=new Array,t=new Array,n=o;for(;o!==l&&i[o].id===c.id;){const r=i[o];if(e.push({position:r.position,height:r.height,extent:r.extent}),o!==n&&i[o-1].idx===r.idx-1){const e=o-n;t.push({a:e-1,b:e})}o++}a.push(new Hc(c.id,c.bounds,void 0,e,t,s))}return a}static getElevationFeature(e,t){if(!t)return;const n=+e.properties[kc];return Number.isNaN(n)?void 0:t.find(e=>e.id===n)}}class Wc{constructor(e,t){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(t)||(this.zScale=Math.pow(2,t.z-e.z),this.xOffset=(e.x*this.zScale-t.x)*Pi,this.yOffset=(e.y*this.zScale-t.y)*Pi)}constantElevation(e,t){if(null!=e.constantHeight)return this.computeBiasedHeight(e.constantHeight,t)}pointElevation(e,t,n){const i=this.constantElevation(t,n);return null!=i?i:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(t.pointElevation(e),n))}computeBiasedHeight(e,t){return t<=0?e:e+t*Me(0,t,e>=0?e:Math.abs(.5*e))}}Gs(Hc,"ElevationFeature");class Gc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new no,this.indexArray=new No,this.segments=new tl,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,"none"!==this.elevationMode&&(this.elevatedLayoutVertexArray=new so),this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){const r=this.layers[0],s=[];let a=null;"circle"===r.type&&(a=r.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:d,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(l,e);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom,{worldview:this.worldview}),t,n))continue;const r=a?a.evaluate(t,{},n):void 0,o={id:c,properties:l.properties,type:l.type,sourceLayerIndex:u,index:d,geometry:e?t.geometry:xc(l,n,i),patterns:{},sortKey:r};s.push(o)}a&&s.sort((e,t)=>e.sortKey-t.sortKey);let o=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new mo,o=i.projection);for(const l of s){const{geometry:i,index:r,sourceLayerIndex:s}=l,a=e[r].feature;this.addFeature(l,i,r,t.availableImages,n,o,t.brightness,t.elevationFeatures),t.featureIndex.insert(a,i,r,s,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,t,n,i,r,s,a){this.programConfigurations.updatePaintArrays(e,t,r,n,i,s,a,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jo.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,el.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,$o.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,t,n,i,r,s,a,o){let l;"none"!==this.elevationMode&&(l=qc.getElevationFeature(e,o));for(const c of t)for(const t of c){const n=t.x,i=t.y;if(n<0||n>=Pi||i<0||i>=Pi)continue;if(s){const e=s.projectTilePoint(n,i,r),t=s.upVector(r,n,i);this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),o=a.vertexLength;if(this.addCircleVertex(n,i,-1,-1),this.addCircleVertex(n,i,1,-1),this.addCircleVertex(n,i,1,1),this.addCircleVertex(n,i,-1,1),"none"!==this.elevationMode){const e=l?l.pointElevation(new _e(n,i)):0;this.hasElevation=this.hasElevation||0!==e;for(let t=0;t<4;t++)this.elevatedLayoutVertexArray.emplaceBack(e)}this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+2,o+3),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,r,a,void 0,this.worldview)}addCircleVertex(e,t,n,i){this.layoutVertexArray.emplaceBack(2*e+(n+1)/2,2*t+(i+1)/2)}addGlobeExtVertex(e,t){const n=16384;this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,t[0]*n,t[1]*n,t[2]*n)}}function Yc(e,t){for(let n=0;n<e.length;n++)if(rd(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(rd(e,t[n]))return!0;return!!Qc(e,t)}function Zc(e,t,n){return!!rd(e,t)||!!td(t,e,n)}function Xc(e,t){if(1===e.length)return id(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(rd(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(id(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Qc(e,t[n]))return!0;return!1}function Kc(e,t,n){if(e.length>1){if(Qc(e,t))return!0;for(let i=0;i<t.length;i++)if(td(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(td(e[i],t,n))return!0;return!1}function Qc(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(Jc(i,r,t[e],t[e+1]))return!0}return!1}function Jc(e,t,n,i){return We(e,n,i)!==We(t,n,i)&&We(e,t,n)!==We(e,t,i)}function $c(e,t,n){return(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x)}function ed(e,t,n,i){const r=$c(e,t,i),s=$c(e,t,n);if(Math.sign(r)===Math.sign(s))return;const a=$c(n,i,e),o=a+s-r;return Math.sign(a)!==Math.sign(o)?[a/(a-o),s/(s-r)]:void 0}function td(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let r=1;r<t.length;r++)if(nd(e,t[r-1],t[r])<i)return!0;return!1}function nd(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function id(e,t){let n,i,r,s=!1;for(let a=0;a<e.length;a++){n=e[a];for(let e=0,a=n.length-1;e<n.length;a=e++)i=n[e],r=n[a],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(s=!s)}return s}function rd(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const s=e[i],a=e[r];s.y>t.y!=a.y>t.y&&t.x<(a.x-s.x)*(t.y-s.y)/(a.y-s.y)+s.x&&(n=!n)}return n}function sd(e,t,n,i,r){for(const a of e)if(t<=a.x&&n<=a.y&&i>=a.x&&r>=a.y)return!0;const s=[new _e(t,n),new _e(t,r),new _e(i,r),new _e(i,n)];if(e.length>2)for(const a of s)if(rd(e,a))return!0;for(let a=0;a<e.length-1;a++)if(ad(e[a],e[a+1],s))return!0;return!1}function ad(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const s=We(e,t,n[0]);return s!==We(e,t,n[1])||s!==We(e,t,n[2])||s!==We(e,t,n[3])}function od(e,t,n,i,r,s){let a=t.y-e.y,o=e.x-t.x;if(s=s||0){const e=a*a+o*o;if(0===e)return!0;const t=Math.sqrt(e);a/=t,o/=t}return!((n.x-e.x)*a+(n.y-e.y)*o-s<0||(i.x-e.x)*a+(i.y-e.y)*o-s<0||(r.x-e.x)*a+(r.y-e.y)*o-s<0)}function ld(e,t,n,i,r,s,a){return!(od(e,t,i,r,s,a)||od(t,n,i,r,s,a)||od(n,e,i,r,s,a)||od(i,r,e,t,n,a)||od(r,s,e,t,n,a)||od(s,i,e,t,n,a))}function cd(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function dd(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ud(e,t,n,i,r){if(!t[0]&&!t[1])return e;const s=_e.convert(t)._mult(r);"viewport"===n&&s._rotate(-i);const a=[];for(let o=0;o<e.length;o++)a.push(e[o].sub(s));return a}function hd(e,t,n,i){const r=_e.convert(e)._mult(i);return"viewport"===t&&r._rotate(-n),r}let pd,md;function fd(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}Gs(Gc,"CircleBucket",{omit:["layers"]});class gd{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=vd(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const t=this.z-e.z;return 0===e.z||e.z<this.z&&e.x===this.x>>t&&e.y===this.y>>t}url(e,t){const n=function(e,t,n){var i=fd(256*e,256*(t=Math.pow(2,n)-t-1),n),r=fd(256*(e+1),256*(t+1),n);return i[0]+","+i[1]+","+r[0]+","+r[1]}(this.x,this.y,this.z),i=function(e,t,n){let i,r="";for(let s=e;s>0;s--)i=1<<s-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class xd{constructor(e,t){this.wrap=e,this.canonical=t,this.key=vd(e,t.z,t.z,t.x,t.y)}}class yd{constructor(e,t,n,i,r){this.overscaledZ=e,this.wrap=t,this.canonical=new gd(n,+i,+r),this.key=0===t&&e===n?this.canonical.key:vd(t,e,n,i,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new yd(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yd(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return vd(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return vd(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new yd(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new yd(t,this.wrap,t,n,i),new yd(t,this.wrap,t,n+1,i),new yd(t,this.wrap,t,n,i+1),new yd(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yd(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yd(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xd(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function vd(e,t,n,i,r){const s=1<<Math.min(n,22);let a=s*(r%s)+i%s;return e&&n<22&&(a+=s*s*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*a+n)+(t-n)}const _d=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new yd(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new yd(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new yd(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new yd(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Gs(gd,"CanonicalTileID"),Gs(yd,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const bd=eo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:wd}=bd,jd=eo([{name:"a_pos_3",components:3,type:"Int16"}]);var Nd=eo([{name:"a_pos",type:"Int16",components:2}]);function Sd(e){return e*Rl/Wl}const kd=[new Vc([Vl,Vl,Vl],[Ul,Ul,Ul]),new Vc([Vl,Vl,Vl],[0,0,Ul]),new Vc([0,Vl,Vl],[Ul,0,Ul]),new Vc([Vl,0,Vl],[0,Ul,Ul]),new Vc([0,0,Vl],[Ul,Ul,Ul])];function Td(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=A([],e._camera.position,e.worldSize),s=[t,n,1,1];K(s,s,e.pixelMatrixInverse),Z(s,s,1/s[3]);const a=R([],q([],s,r)),o=e.globeMatrix,l=[o[12],o[13],o[14]],c=q([],l,r),d=w(c),u=R([],c),h=e.worldSize/(2*Math.PI),p=L(u,a),m=Math.asin(h/d);if(m<Math.acos(p)){if(!i)return null;const e=[],t=[];A(e,a,d/p),R(t,q(t,e,c)),R(a,S(a,c,A(a,t,Math.tan(m)*d)))}const f=[];new Pc(r,a).closestPointOnSphere(l,h,f);const g=R([],Qe(o,0)),x=R([],Qe(o,1)),y=R([],Qe(o,2)),v=L(g,f),_=L(x,f),b=L(y,f),j=Se(Math.asin(-_/h));let N=Se(Math.atan2(v,b));N=e.center.lng+function(e,t){const n=(t-e+180)%360-180;return n<-180?n+360:n}(e.center.lng,N);const k=Jl(N),T=Ae($l(j),0,1);return new cc(k,T)}class Cd{constructor(e,t,n){this.a=q([],e,n),this.b=q([],t,n),this.center=n;const i=R([],this.a),r=R([],this.b);this.angle=Math.acos(L(i,r))}}function Ed(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(e,t,n,i){const r=Math.sin(n);return e*(Math.sin((1-i)*n)/r)+t*(Math.sin(i*n)/r)}(e.a[t],e.b[t],e.angle,Ae(n,0,1))+e.center[t]}function Ad(e){if(e.z<=1)return kd[e.z+2*e.y+e.x];const t=Rd(Pd(e));return Vc.fromPoints(t)}function Md(e,t,n){return A(e,e,1-n),M(e,e,t,n)}function Dd(e,t,n){for(const i of e)F(i,i,t),A(i,i,n)}function Id(e,t,n,i){const r=t/e.worldSize,s=e.globeMatrix;if(n.z<=1){const e=Ad(n).getCorners();return Dd(e,s,r),Vc.fromPoints(e)}const a=Pd(n,i),o=Rd(a,Rl+Sd(e._tileCoverLift));Dd(o,s,r);const l=Number.MAX_VALUE,c=[-l,-l,-l],d=[l,l,l];if(a.contains(e.center)){for(const e of o)C(d,d,e),E(c,c,e);c[2]=0;const t=e.point,n=[t.x*r,t.y*r,0];return C(d,d,n),E(c,c,n),new Vc(d,c)}if(e._tileCoverLift>0){for(const e of o)C(d,d,e),E(c,c,e);return new Vc(d,c)}const u=[s[12]*r,s[13]*r,s[14]*r],h=a.getCenter(),p=Ae(e.center.lat,-rc,rc),m=Ae(h.lat,-rc,rc),f=Jl(e.center.lng),g=$l(p);let x=f-Jl(h.lng);const y=g-$l(m);x>.5?x-=1:x<-.5&&(x+=1);let v=0;Math.abs(x)>Math.abs(y)?v=x>=0?1:3:(v=y>=0?0:2,M(u,u,[s[4]*r,s[5]*r,s[6]*r],-Math.sin(Ne(y>=0?a.getSouth():a.getNorth()))*Rl));const _=o[v],b=o[(v+1)%4],w=new Cd(_,b,u),j=[Ed(w,0)||_[0],Ed(w,1)||_[1],Ed(w,2)||_[2]],N=qd(e.zoom);if(N>0){const i=function(e,t,n,i,r){let{x:s,y:a,z:o}=e;const l=1/(1<<o);let c=s*l,d=c+l,u=a*l,h=u+l,p=0;const m=(c+d)/2-i;return m>.5?p=-1:m<-.5&&(p=1),c=((c+p)*t-(i*=t))*n+i,d=((d+p)*t-i)*n+i,u=(u*t-(r*=t))*n+r,h=(h*t-r)*n+r,[[c,h,0],[d,h,0],[d,u,0],[c,u,0]]}(n,t,e._pixelsPerMercatorPixel,f,g);for(let e=0;e<o.length;e++)Md(o[e],i[e],N);const r=S([],i[v],i[(v+1)%4]);A(r,r,.5),Md(j,r,N)}for(const S of o)C(d,d,S),E(c,c,S);return d[2]=Math.min(_[2],b[2]),C(d,d,j),E(c,c,j),new Vc(d,c)}function Pd(e){let{x:t,y:n,z:i}=e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=1/(1<<i),a=new Yl(tc(t*s),n===(1<<i)-1&&r?-90:nc((n+1)*s)),o=new Yl(tc((t+1)*s),0===n&&r?90:nc(n*s));return new Zl(a,o)}function Rd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rl;const n=Ne(e.getNorth()),i=Ne(e.getSouth()),r=Math.cos(n),s=Math.cos(i),a=Math.sin(n),o=Math.sin(i),l=e.getWest(),c=e.getEast();return[Hl(s,o,l,t),Hl(s,o,c,t),Hl(r,a,c,t),Hl(r,a,l,t)]}function Ld(e,t,n,i){const r=1<<n.z,s=(e/Pi+n.x)/r;return ql(nc((t/Pi+n.y)/r),tc(s),i)}function zd(e){let{min:t,max:n}=e;return Ol/Math.max(n[0]-t[0],n[1]-t[1],n[2]-t[2])}const Od=new Float64Array(16);function Fd(e){const t=zd(e),n=g(Od,[t,t,t]);return u(n,n,P([],e.min))}function Bd(e){const t=(i=e.min,(n=Od)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n);var n,i;const r=1/zd(e);return h(t,t,[r,r,r])}function Vd(e){const t=Pi/(2*Math.PI);return e/(2*Math.PI)/t}function Ud(e,t){return Pi/(512*Math.pow(2,e))*zd(Ad(t))}function Hd(e,t,n,i,r){const s=Vd(n),a=[e,t,-n/(2*Math.PI)],o=l(new Float64Array(16));return u(o,o,a),h(o,o,[s,s,s]),p(o,o,Ne(-r)),m(o,o,Ne(-i)),o}function qd(e){return Me(Ll,zl,e)}function Wd(e,t){const n=ql(t.lat,t.lng),i=function(e){const t=ql(e._center.lat,e._center.lng);let n=z([],j(0,1,0),t);const i=x([],-e.angle,t);n=F(n,n,i),x(i,-e._pitch,n);const r=R([],t);return A(r,r,Sd(e.cameraToCenterDistance/e.pixelsPerMeter)),F(r,r,i),S([],t,r)}(e);return a=(r=k([],i,n))[0],o=r[1],l=r[2],c=(s=n)[0],d=s[1],u=s[2],p=(h=Math.sqrt(a*a+o*o+l*l)*Math.sqrt(c*c+d*d+u*u))&&L(r,s)/h,Math.acos(Math.min(Math.max(p,-1),1));var r,s,a,o,l,c,d,u,h,p}function Gd(e,t){return Wd(e,t)>Math.PI/2*1.01}const Yd=Ne(85),Zd=Math.cos(Yd),Xd=Math.sin(Yd),Kd=o(),Qd=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Jd(e,t,n,i,r,s,a,o,l){if(s&&e.queryGeometry.isAboveHorizon)return!1;s&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,d=n.projection.upVectorScale(c,n.center.lat,n.worldSize).metersToTile;for(const u of t)for(const t of u){const u=t.add(o),h=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(u.x,u.y,!0):0,p=n.projection.projectTilePoint(u.x,u.y,c);if(h>0){const e=n.projection.upVector(c,u.x,u.y);p.x+=e[0]*d*h,p.y+=e[1]*d*h,p.z+=e[2]*d*h}const m=s?u:$d(p.x,p.y,p.z,i),f=s?e.tilespaceRays.map(e=>nu(e,h)):e.queryGeometry.screenGeometry,g=K([],[p.x,p.y,p.z,1],i);if(!a&&s?l*=g[3]/n.cameraToCenterDistance:a&&!s&&(l*=n.cameraToCenterDistance/g[3]),s){const e=nc((t.y/Pi+c.y)/(1<<c.z));l/=n.projection.pixelsPerMeter(e,1)/ec(1,e)}if(Zc(f,m,l))return!0}return!1}function $d(e,t,n,i){const r=K([],[e,t,n,1],i);return new _e(r[0]/r[3],r[1]/r[3])}const eu=j(0,0,0),tu=j(0,0,1);function nu(e,t){const n=_();return eu[2]=t,e.intersectsPlane(eu,tu,n),new _e(n[0],n[1])}class iu extends Gc{}let ru,su,au,ou;function lu(e,t,n,i){let{width:r,height:s}=t;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*s*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*s*n);return e.width=r,e.height=s,e.data=i,e}function cu(e,t,n){const{width:i,height:r}=t;i===e.width&&r===e.height||(du(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,r)},n,null),e.width=i,e.height=r,e.data=t.data)}function du(e,t,n,i,r,s,a,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,c=t.data,d=4===s&&o;for(let u=0;u<r.height;u++){const o=((n.y+u)*e.width+n.x)*s,h=((i.y+u)*t.width+i.x)*s;if(d)for(let e=0;e<r.width;e++){const t=o+e*s+3,n=h+e*s;c[n+0]=255,c[n+1]=255,c[n+2]=255,c[n+3]=l[t]}else if(a)for(let e=0;e<r.width;e++){const t=o+e*s,n=h+e*s,i=new an(l[t+0]/255,l[t+1]/255,l[t+2]/255,l[t+3]).toNonPremultipliedRenderColor(a).toArray();c[n+0]=i[0],c[n+1]=i[1],c[n+2]=i[2],c[n+3]=i[3]}else for(let e=0;e<r.width*s;e++)c[h+e]=l[o+e]}return t}Gs(iu,"HeatmapBucket",{omit:["layers"]});class uu{constructor(e,t){lu(this,e,1,t)}resize(e){cu(this,new uu(e),1)}clone(){return new uu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){du(e,t,n,i,r,1,null)}}class hu{constructor(e,t){lu(this,e,4,t)}resize(e){cu(this,new hu(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new hu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r,s,a){du(e,t,n,i,r,4,s,a)}}class pu{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}function mu(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new hu({width:n,height:i}),s=(n,i,s)=>{t[e.evaluationKey]=s;const a=e.expression.evaluate(t),o=a?a.toNonPremultipliedRenderColor(null):null;o&&(r.data[n+i+0]=Math.floor(255*o.r),r.data[n+i+1]=Math.floor(255*o.g),r.data[n+i+2]=Math.floor(255*o.b),r.data[n+i+3]=Math.floor(255*o.a))};if(e.clips)for(let a=0,o=0;a<i;++a,o+=4*n)for(let t=0,i=0;t<n;t++,i+=4){const r=t/(n-1),{start:l,end:c}=e.clips[a];s(o,i,l*(1-r)+c*r)}else for(let a=0,o=0;a<n;a++,o+=4)s(0,o,a/(n-1));return r}Gs(uu,"AlphaImage"),Gs(hu,"RGBAImage");const fu=eo([{name:"a_pos",components:2,type:"Int16"}],4),gu=eo([{name:"a_road_z_offset",components:1,type:"Float32"}],4),xu=eo([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),yu=eo([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function vu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,r=i?t[0]*n:e.length;let s=_u(e,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c;if(i&&(s=function(e,t,n,i){const r=[];for(let s=0,a=t.length;s<a;s++){const n=_u(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i,!1);n===n.next&&(n.steiner=!0),r.push(Mu(n))}r.sort(Tu);for(let s=0;s<r.length;s++)n=Cu(r[s],n);return n}(e,t,s,n)),e.length>80*n){o=e[0],l=e[1];let t=o,i=l;for(let s=n;s<r;s+=n){const n=e[s],r=e[s+1];n<o&&(o=n),r<l&&(l=r),n>t&&(t=n),r>i&&(i=r)}c=Math.max(t-o,i-l),c=0!==c?32767/c:0}return wu(s,a,n,o,l,c,0),a}function _u(e,t,n,i,r){let s;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(let a=t;a<n;a+=i)s=Uu(a/i|0,e[a],e[a+1],s);else for(let a=n-i;a>=t;a-=i)s=Uu(a/i|0,e[a],e[a+1],s);return s&&Lu(s,s.next)&&(Hu(s),s=s.next),s}function bu(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Lu(i,i.next)&&0!==Ru(i.prev,i,i.next))i=i.next;else{if(Hu(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function wu(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Au(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n=1;do{let i,r=e;e=null;let s=null;for(t=0;r;){t++;let a=r,o=0;for(let e=0;e<n&&(o++,a=a.nextZ,a);e++);let l=n;for(;o>0||l>0&&a;)0!==o&&(0===l||!a||r.z<=a.z)?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=a}s.nextZ=null,n*=2}while(t>1)}(r)}(e,i,r,s);let o=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(s?Nu(e,i,r,s):ju(e))t.push(l.i,e.i,c.i),Hu(e),e=c.next,o=c.next;else if((e=c)===o){a?1===a?wu(e=Su(bu(e),t),t,n,i,r,s,2):2===a&&ku(e,t,n,i,r,s):wu(bu(e),t,n,i,r,s,1);break}}}function ju(e){const t=e.prev,n=e,i=e.next;if(Ru(t,n,i)>=0)return!1;const r=t.x,s=n.x,a=i.x,o=t.y,l=n.y,c=i.y,d=Math.min(r,s,a),u=Math.min(o,l,c),h=Math.max(r,s,a),p=Math.max(o,l,c);let m=i.next;for(;m!==t;){if(m.x>=d&&m.x<=h&&m.y>=u&&m.y<=p&&Iu(r,o,s,l,a,c,m.x,m.y)&&Ru(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Nu(e,t,n,i){const r=e.prev,s=e,a=e.next;if(Ru(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,d=r.y,u=s.y,h=a.y,p=Math.min(o,l,c),m=Math.min(d,u,h),f=Math.max(o,l,c),g=Math.max(d,u,h),x=Au(p,m,t,n,i),y=Au(f,g,t,n,i);let v=e.prevZ,_=e.nextZ;for(;v&&v.z>=x&&_&&_.z<=y;){if(v.x>=p&&v.x<=f&&v.y>=m&&v.y<=g&&v!==r&&v!==a&&Iu(o,d,l,u,c,h,v.x,v.y)&&Ru(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==r&&_!==a&&Iu(o,d,l,u,c,h,_.x,_.y)&&Ru(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=x;){if(v.x>=p&&v.x<=f&&v.y>=m&&v.y<=g&&v!==r&&v!==a&&Iu(o,d,l,u,c,h,v.x,v.y)&&Ru(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=y;){if(_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==r&&_!==a&&Iu(o,d,l,u,c,h,_.x,_.y)&&Ru(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Su(e,t){let n=e;do{const i=n.prev,r=n.next.next;!Lu(i,r)&&zu(i,n,n.next,r)&&Bu(i,r)&&Bu(r,i)&&(t.push(i.i,n.i,r.i),Hu(n),Hu(n.next),n=e=r),n=n.next}while(n!==e);return bu(n)}function ku(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Pu(a,e)){let o=Vu(a,e);return a=bu(a,a.next),o=bu(o,o.next),wu(a,t,n,i,r,s,0),void wu(o,t,n,i,r,s,0)}e=e.next}a=a.next}while(a!==e)}function Tu(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Cu(e,t){const n=function(e,t){let n=t;const i=e.x,r=e.y;let s,a=-1/0;if(Lu(e,n))return n;do{if(Lu(e,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a&&(a=e,s=n.x<n.next.x?n:n.next,e===i))return s}n=n.next}while(n!==t);if(!s)return null;const o=s,l=s.x,c=s.y;let d=1/0;n=s;do{if(i>=n.x&&n.x>=l&&i!==n.x&&Du(r<c?i:a,r,l,c,r<c?a:i,r,n.x,n.y)){const t=Math.abs(r-n.y)/(i-n.x);Bu(n,e)&&(t<d||t===d&&(n.x>s.x||n.x===s.x&&Eu(s,n)))&&(s=n,d=t)}n=n.next}while(n!==o);return s}(e,t);if(!n)return t;const i=Vu(n,e);return bu(i,i.next),bu(n,n.next)}function Eu(e,t){return Ru(e.prev,e,t.prev)<0&&Ru(t.next,e,e.next)<0}function Au(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Mu(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Du(e,t,n,i,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Iu(e,t,n,i,r,s,a,o){return!(e===a&&t===o)&&Du(e,t,n,i,r,s,a,o)}function Pu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&zu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Bu(e,t)&&Bu(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Ru(e.prev,e,t.prev)||Ru(e,t.prev,t))||Lu(e,t)&&Ru(e.prev,e,e.next)>0&&Ru(t.prev,t,t.next)>0)}function Ru(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Lu(e,t){return e.x===t.x&&e.y===t.y}function zu(e,t,n,i){const r=Fu(Ru(e,t,n)),s=Fu(Ru(e,t,i)),a=Fu(Ru(n,i,e)),o=Fu(Ru(n,i,t));return r!==s&&a!==o||!(0!==r||!Ou(e,n,t))||!(0!==s||!Ou(e,i,t))||!(0!==a||!Ou(n,e,i))||!(0!==o||!Ou(n,t,i))}function Ou(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Fu(e){return e>0?1:e<0?-1:0}function Bu(e,t){return Ru(e.prev,e,e.next)<0?Ru(e,t,e.next)>=0&&Ru(e,e.prev,t)>=0:Ru(e,t,e.prev)<0||Ru(e,e.next,t)<0}function Vu(e,t){const n=qu(e.i,e.x,e.y),i=qu(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Uu(e,t,n,i){const r=qu(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Hu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function qu(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Wu(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,s;for(let a=0;a<n;a++){const t=Ge(e[a]);0!==t&&(e[a].area=Math.abs(t),void 0===s&&(s=t<0),s===t<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}if(r&&i.push(r),t>1)for(let a=0;a<i.length;a++)i[a].length<=t||(ni(i[a],t,1,i[a].length-1,Gu),i[a]=i[a].slice(0,t));return i}function Gu(e,t){return t.area-e.area}function Yu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e)return null;const i="string"==typeof e?zn.from(e).getPrimary():e.getPrimary(),r="string"==typeof e?null:e.getSecondary();for(const s of[i,r]){if(!s)continue;const e=s.id.toString();t.has(e)||t.set(e,[]),s.scaleSelf(n),t.get(e).push(s)}return{primary:i.toString(),secondary:r?r.toString():null}}function Zu(e,t,n,i){const r=i.patternDependencies;let s=!1;for(const a of t){const t=a.paint.get("".concat(e,"-pattern"));t.isConstant()||(s=!0),Yu(t.constantOr(null),r,n)&&(s=!0)}return s}function Xu(e,t,n,i,r,s){const a=s.patternDependencies;for(const o of t){const t=o.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i},n,{},s.availableImages);e=e&&e.name?e.name:e;const l=Yu(e,a,r);if(!l)continue;const{primary:c,secondary:d}=l;c&&(n.patterns[o.id]=[c,d].filter(Boolean))}}return n}class Ku{constructor(){this.polygons=new Map}add(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.polygons.has(e)?this.polygons.get(e).push(...n):this.polygons.set(e,n)}merge(e){for(const[t,n]of e.polygons)this.add(t,...n)}}class Qu{constructor(){this.portals=[]}static evaluate(e){if(0===e.length)return new Qu;let t=[];for(const l of e)t.push(...l.portals);if(0===t.length)return new Qu;const n=(e,t)=>e<=0&&t<=0||e>=Pi&&t>=Pi;for(const l of t){const e=l.va,t=l.vb;(n(e.x,t.x)||n(e.y,t.y))&&(l.type="border")}const i=t.filter(e=>"unevaluated"!==e.type),r=t.filter(e=>"unevaluated"===e.type);if(0===r.length)return new Qu;r.sort((e,t)=>e.hash===t.hash?e.isTunnel===t.isTunnel?0:e.isTunnel?-1:1:e.hash<t.hash?1:-1),t=i.concat(r);let s=i.length,a=s,o=s;do{if(a++,a===t.length||t[s].hash!==t[a].hash){if(a-s==2){o<s&&(t[o]=t[s],t[s]=null);const e=t[o],n=t[a-1];e.type=e.isTunnel!==n.isTunnel?"tunnel":"polygon",e.connection={a:e.connection.a,b:n.connection.a},o++}s=a}}while(s!==t.length);return t.splice(o),t.sort((e,t)=>e.hash<t.hash?1:-1),{portals:t}}}Gs(Qu,"ElevationPortalGraph"),Gs(Ku,"ElevationPolygons");class Ju{constructor(e,t,n){this.outPositions=e,this.outNormals=t,this.outIndices=n,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,t,n){let i=e[2];null!=n&&(i*=n);const r=this.getVec3Bits(e)<<96n|this.getVec3Bits(t),s=this.vertexLookup.get(r);if(null!=s)return s;const a=this.outPositions.length;this.vertexLookup.set(r,a);const o=Math.trunc(16384*t[0]),l=Math.trunc(16384*t[1]),c=Math.trunc(16384*t[2]);return this.outPositions.emplaceBack(e[0],e[1],i),this.outNormals.emplaceBack(o,l,c),a}addTriangle(e,t,n){this.outIndices.emplaceBack(e,t,n)}addTriangles(e,t,n){if(0===e.length)return;const i=1===n.length,r=_(),s=_();for(let a=0;a<e.length;a+=3){const o=t[e[a+0]],l=t[e[a+1]],c=t[e[a+2]],d=i?n[0]:n[e[a+1]],u=i?n[0]:n[e[a+2]];N(r,o.x,o.y,i?n[0]:n[e[a+0]]);const h=this.addVertex(r,s);N(r,l.x,l.y,d);const p=this.addVertex(r,s);N(r,c.x,c.y,u);const m=this.addVertex(r,s);this.outIndices.emplaceBack(h,p,m)}}addQuad(e,t,n,i,r,s){const a=this.addVertex(e,r,s),o=this.addVertex(t,r,s),l=this.addVertex(n,r,s),c=this.addVertex(i,r,s);this.addTriangle(a,o,l),this.addTriangle(l,c,a)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class $u{constructor(e,t,n,i){this.unevaluatedPortals=new Qu,this.portalPolygons=new Ku,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ao,this.vertexNormals=new oo,this.indexArray=new No,this.tileToMeters=lc(e),this.bridgeProgramConfigurations=new El(t,{zoom:n,lut:i},e=>"fill-tunnel-structure-color"!==e),this.tunnelProgramConfigurations=new El(t,{zoom:n,lut:i},e=>"fill-bridge-guard-rail-color"!==e)}addVertices(e,t){const n=this.unevalVertices.length;for(let i=0;i<e.length;i++)this.unevalVertices.push(e[i]),this.unevalHeights.push(t[i]);return n}addTriangles(e,t,n){const i=n?this.unevalTunnelTriangles:this.unevalTriangles;for(const r of e)i.push(r+t)}addRenderableRing(e,t,n,i,r,s){const a=[new _e(r.min.x,r.min.y),new _e(r.max.x,r.min.y),new _e(r.max.x,r.max.y),new _e(r.min.x,r.max.y)];for(let o=0;o<n-1;o++){const n=t+o,l=n+1,c=this.unevalVertices[n],d=this.unevalVertices[l];if(!(c.x>=r.min.x&&c.x<=r.max.x&&c.y>=r.min.y&&c.y<=r.max.y||d.x>=r.min.x&&d.x<=r.max.x&&d.y>=r.min.y&&d.y<=r.max.y||ad(c,d,a)))continue;if(this.isOnBorder(c.x,d.x)||this.isOnBorder(c.y,d.y))continue;const u=$u.computeEdgeHash(this.unevalVertices[n],this.unevalVertices[l]);let h,p=this.vertexHashLookup.get($u.computePosHash(c));null!=p?h=p.next:(p=this.vertexHashLookup.get($u.computePosHash(d)),h=null!=p?p.prev:u),this.unevalEdges.push({polygonIdx:e,a:n,b:l,hash:u,portalHash:h,isTunnel:i,type:"unevaluated",featureInfo:s})}}addPortalCandidates(e,t,n,i,r){if(0===t.length)return;this.portalPolygons.add(e,{geometry:t,zLevel:r});const s=t[0];this.vertexHashLookup.clear();let a=$u.computeEdgeHash(s[s.length-2],s[s.length-1]);for(let o=0;o<s.length-1;o++){const t=s[o+0],r=s[o+1],l=oe(r.x-t.x,r.y-t.y),c=ue(l);if(0===c)continue;let d="unevaluated";const u=i.pointElevation(t),h=i.pointElevation(r);Math.abs(u)<.01&&Math.abs(h)<.01?d="entrance":(this.isOnBorder(t.x,r.x)||this.isOnBorder(t.y,r.y))&&(d="border");const p=$u.computeEdgeHash(t,r);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:t,vb:r,vab:l,length:c,hash:p,isTunnel:n,type:d});const m=$u.computePosHash(t);this.vertexHashLookup.set(m,{prev:a,next:p}),a=p}}construct(e){if(0===this.unevalVertices.length)return;const t=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),n=e=>{e.primitiveLength=this.indexArray.length-e.primitiveOffset},i=new Ju(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const r=t(),s=t(),a=t(),o=(e,t)=>{e.sort((e,n)=>e.type===t&&n.type!==t?-1:e.type!==t&&n.type===t?1:0);const n=e.findIndex(e=>e.type!==t);return n>=0?n:e.length};let l=0;this.unevalEdges.length>0&&(l=o(this.unevalEdges,"none"),this.constructBridgeStructures(i,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},this.tileToMeters)),n(a);const c=t(),d=t();if(this.unevalEdges.length>0){const e=this.unevalEdges.splice(l),t=o(e,"tunnel")+l;this.unevalEdges.push(...e),this.constructTunnelStructures(i,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},{min:l,max:t})}n(c),i.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),n(d),i.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),n(s),i.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),n(r),this.maskSegments=tl.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength),this.depthSegments=tl.simpleSegment(0,s.primitiveOffset,0,s.primitiveLength),this.renderableBridgeSegments=tl.simpleSegment(0,a.primitiveOffset,0,a.primitiveLength),this.renderableTunnelSegments=tl.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength),this.shadowCasterSegments=tl.simpleSegment(0,r.primitiveOffset,0,r.primitiveLength)}update(e,t,n,i,r,s,a,o){this.bridgeProgramConfigurations.updatePaintArrays(e,t,r,n,i,s,a,o),this.tunnelProgramConfigurations.updatePaintArrays(e,t,r,n,i,s,a,o)}upload(e){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,xu.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,yu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,t,n,i,r){const s=(s,a)=>{for(let o=0;o<a.length-1;o++){const l=a[o].featureIndex,c=a[o+1].vertexStart,d=e.feature(l);s.populatePaintArrays(c,d,l,{},n,t,i,void 0,r)}};s(this.bridgeProgramConfigurations,this.bridgeFeatureSections),s(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,t,n,i,r){const s=new Map;for(let a=i;a<r;a++){const i=n[a],r=i.a,o=i.b,l=$u.computePosHash(e[r]),c=$u.computePosHash(e[o]);let d=s.get(l);d||(d={},s.set(l,d));let u=s.get(c);u||(u={},s.set(c,u)),t[r]<=0&&t[o]<=0||(d.to=o,u.from=r)}return s}isTerminalVertex(e,t){const n=$u.computePosHash(this.unevalVertices[e]),i=t.get(n);return!i||!i.from||!i.to}constructBridgeStructures(e,t,n,i,r,s){e.clearVertexLookup();const a=this.computeVertexConnections(t,n,i,r.min,r.max),o=1/s,l=.5*o,c=(e,i)=>N(e,t[i].x,t[i].y,n[i]*o),d=_(),u=_(),h=_(),p=_(),m=_(),f=(e,n)=>{const i=a.get($u.computePosHash(t[n])),r=i.from,s=i.to;if(!r||!s)return;c(d,r),c(u,n),c(h,s),U(p),H(d,u)||(q(m,u,d),R(p,m)),H(h,u)||(q(m,h,u),S(p,p,R(m,m)));const o=G(p);return o>0?A(e,p,1/o):void 0};let g=Number.POSITIVE_INFINITY;this.sortSubarray(i,r.min,r.max,(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex);const x=_(),y=_(),v=_(),b=_(),w=_(),j=_(),k=_(),T=_(),C=_(),E=[_(),_(),_(),_()],M=[_(),_(),_(),_()],D=[{coord:new _e(0,0),height:0},{coord:new _e(0,0),height:0}],I=(e,t)=>e>t;for(let _=r.min;_<r.max;_++){const r=i[_];if(!r.featureInfo.guardRailEnabled)continue;if(!this.prepareEdgePoints(D,t,n,r,I))continue;const[c,d]=D;if(N(x,c.coord.x,c.coord.y,o*c.height),N(y,d.coord.x,d.coord.y,o*d.height),H(x,y))continue;q(v,y,x),R(v,v);const u=f(T,r.a)||v,h=f(C,r.b)||v;N(b,u[1],-u[0],0),R(b,b),N(w,h[1],-h[0],0),R(w,w),z(T,b,u),R(j,T),z(T,w,h),R(k,T),S(E[0],x,A(T,q(T,b,j),l)),S(E[1],x,A(T,S(T,b,j),l)),S(E[2],x,A(T,j,l)),E[3]=x,S(M[0],y,A(T,q(T,w,k),l)),S(M[1],y,A(T,S(T,w,k),l)),S(M[2],y,A(T,k,l)),M[3]=y,g=this.addFeatureSection(r.featureInfo.featureIndex,g,this.bridgeFeatureSections,e);const p=e.addVertex(E[0],b,s),m=e.addVertex(E[1],b,s),L=e.addVertex(M[0],w,s),O=e.addVertex(M[1],w,s);e.addTriangle(p,m,L),e.addTriangle(m,O,L);const F=e.addVertex(E[1],j,s),B=e.addVertex(E[2],j,s),V=e.addVertex(M[1],k,s),U=e.addVertex(M[2],k,s);e.addTriangle(F,B,V),e.addTriangle(B,U,V),P(b,b),P(w,w);const W=e.addVertex(E[2],b,s),G=e.addVertex(E[3],b,s),Y=e.addVertex(M[2],w,s),Z=e.addVertex(M[3],w,s);e.addTriangle(W,G,Y),e.addTriangle(G,Z,Y);const X=this.isTerminalVertex(r.a,a),K=this.isTerminalVertex(r.b,a);c.height<.01&&X&&e.addQuad(E[3],E[2],E[1],E[0],P(u,u),s),d.height<.01&&K&&e.addQuad(M[0],M[1],M[2],M[3],h,s)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,t,n,i,r,s){e.clearVertexLookup();let a=Number.POSITIVE_INFINITY;const o=(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex;this.sortSubarray(i,r.min,r.max,o),this.sortSubarray(i,s.min,s.max,o);const l=e=>R(e,e),c=[{coord:new _e(0,0),height:0},{coord:new _e(0,0),height:0}],d=(e,t)=>e<t,u=_(),h=_(),p=_(),m=_(),f=_();for(let g=r.min;g<r.max;g++){if(!this.prepareEdgePoints(c,t,n,i[g],d))continue;const[r,s]=c,o=l(N(f,-(s.coord.y-r.coord.y),s.coord.x-r.coord.x,0));a=this.addFeatureSection(i[g].featureInfo.featureIndex,a,this.tunnelFeatureSections,e),e.addQuad(N(u,r.coord.x,r.coord.y,r.height),N(h,s.coord.x,s.coord.y,s.height),N(p,s.coord.x,s.coord.y,i[g].isTunnel?-.1:0),N(m,r.coord.x,r.coord.y,i[g].isTunnel?-.1:0),o)}for(let g=s.min;g<s.max;g++){const r=i[g];r.isTunnel&&([r.a,r.b]=[r.b,r.a]);const s=t[r.a],o=t[r.b],c=l(N(f,-(o.y-s.y),o.x-s.x,0));a=this.addFeatureSection(r.featureInfo.featureIndex,a,this.tunnelFeatureSections,e),e.addQuad(N(u,o.x,o.y,0),N(h,s.x,s.y,0),N(p,s.x,s.y,n[r.a]+4),N(m,o.x,o.y,n[r.b]+4),c),e.addQuad(N(u,s.x,s.y,0),N(h,o.x,o.y,0),N(p,o.x,o.y,n[r.b]+4),N(m,s.x,s.y,n[r.a]+4),c)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,t,n,i){e.coord.x=t,e.coord.y=n,e.height=i}prepareEdgePoints(e,t,n,i,r){let s=t[i.a].x,a=t[i.a].y,o=t[i.b].x,l=t[i.b].y,c=n[i.a],d=n[i.b];const u=r(c,0),h=r(d,0);if(u&&h)return this.setElevatedPoint(e[0],s,a,c),this.setElevatedPoint(e[1],o,l,d),!0;if(!u&&!h)return!1;if(u){if(!h){const e=d/(d-c);o=dn(o,s,e),l=dn(l,a,e),d=dn(d,c,e)}}else{const e=c/(c-d);s=dn(s,o,e),a=dn(a,l,e),c=dn(c,d,e)}return this.setElevatedPoint(e[0],s,a,c),this.setElevatedPoint(e[1],o,l,d),!0}prepareEdges(e,t){if(0===t.length)return;t.sort((e,t)=>e.hash===t.hash?t.polygonIdx-e.polygonIdx:t.hash>e.hash?1:-1);let n=0,i=0,r=0,s=t[n].polygonIdx;do{i++,(i===t.length||t[n].hash!==t[i].hash)&&((1==i-n||t[i-1].polygonIdx!==s)&&(r<n&&(t[r]=t[n],t[n]=null),t[r].type="none",r++),n=i,n!==t.length&&(s=t[n].polygonIdx))}while(n!==t.length);if(t.splice(r),0!==t.length&&0!==e.length){t.sort((e,t)=>e.portalHash<t.portalHash?1:-1);let n=0,i=0;for(;n!==t.length&&i!==e.length;){const r=t[n],s=e[i];r.portalHash>s.hash?n++:s.hash>r.portalHash?i++:(r.type=s.type,n++)}}}isOnBorder(e,t){return e<=0&&t<=0||e>=Pi&&t>=Pi}addFeatureSection(e,t,n,i){return e!==t&&(t=e,n.push({featureIndex:e,vertexStart:i.getVertexCount()}),i.clearVertexLookup()),t}sortSubarray(e,t,n,i){const r=e.slice(t,n);r.sort(i),e.splice(t,r.length,...r)}static computeEdgeHash(e,t){return(e.y===t.y&&e.x>t.x||e.y>t.y)&&([e,t]=[t,e]),BigInt($u.computePosHash(e))<<32n|BigInt($u.computePosHash(t))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var eh,th={exports:{}},nh=(eh||(eh=1,function(e,t){!function(e){function t(e,t){return e>t?1:e<t?-1:0}var n=function(e,n){void 0===e&&(e=t),void 0===n&&(n=!1),this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!n},i={size:{configurable:!0}};function r(e,t,n,i,s){var a=s-i;if(a>0){var o=i+Math.floor(a/2),l={key:t[o],data:n[o],parent:e};return l.left=r(l,t,n,i,o),l.right=r(l,t,n,o+1,s),l}return null}function s(e,t,n,i,r){if(!(n>=i)){for(var a=e[n+i>>1],o=n-1,l=i+1;;){do{o++}while(r(e[o],a)<0);do{l--}while(r(e[l],a)>0);if(o>=l)break;var c=e[o];e[o]=e[l],e[l]=c,c=t[o],t[o]=t[l],t[l]=c}s(e,t,n,l,r),s(e,t,l+1,i,r)}}n.prototype.rotateLeft=function(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t},n.prototype.rotateRight=function(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t},n.prototype._splay=function(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}},n.prototype.splay=function(e){for(var t,n,i,r,s;e.parent;)(n=(t=e.parent).parent)&&n.parent?((i=n.parent).left===n?i.left=e:i.right=e,e.parent=i):(e.parent=null,this._root=e),r=e.left,s=e.right,e===t.left?(n&&(n.left===t?(t.right?(n.left=t.right,n.left.parent=n):n.left=null,t.right=n,n.parent=t):(r?(n.right=r,r.parent=n):n.right=null,e.left=n,n.parent=e)),s?(t.left=s,s.parent=t):t.left=null,e.right=t,t.parent=e):(n&&(n.right===t?(t.left?(n.right=t.left,n.right.parent=n):n.right=null,t.left=n,n.parent=t):(s?(n.left=s,s.parent=n):n.left=null,e.right=n,n.parent=e)),r?(t.right=r,r.parent=t):t.right=null,e.left=t,t.parent=e)},n.prototype.replace=function(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)},n.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.insert=function(e,t){var n=this._root,i=null,r=this._compare;if(this._noDuplicates)for(;n;){if(i=n,0===r(n.key,e))return;n=r(n.key,e)<0?n.right:n.left}else for(;n;)i=n,n=r(n.key,e)<0?n.right:n.left;return n={key:e,data:t,left:null,right:null,parent:i},i?r(i.key,n.key)<0?i.right=n:i.left=n:this._root=n,this.splay(n),this._size++,n},n.prototype.find=function(e){for(var t=this._root,n=this._compare;t;){var i=n(t.key,e);if(i<0)t=t.right;else{if(!(i>0))return t;t=t.left}}return null},n.prototype.contains=function(e){for(var t=this._root,n=this._compare;t;){var i=n(e,t.key);if(0===i)return!0;t=i<0?t.left:t.right}return!1},n.prototype.remove=function(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var n=this.minNode(t.right);n.parent!==t&&(this.replace(n,n.right),n.right=t.right,n.right.parent=n),this.replace(t,n),n.left=t.left,n.left.parent=n}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},n.prototype.removeNode=function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},n.prototype.erase=function(e){var t=this.find(e);if(t){this.splay(t);var n=t.left,i=t.right,r=null;n&&(n.parent=null,r=this.maxNode(n),this.splay(r),this._root=r),i&&(n?r.right=i:this._root=i,i.parent=r),this._size--}},n.prototype.pop=function(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t},n.prototype.next=function(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t},n.prototype.prev=function(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t},n.prototype.forEach=function(e){for(var t=this._root,n=[],i=!1,r=0;!i;)t?(n.push(t),t=t.left):n.length>0?(e(t=n.pop(),r++),t=t.right):i=!0;return this},n.prototype.range=function(e,t,n,i){for(var r=[],s=this._compare,a=this._root;0!==r.length||a;)if(a)r.push(a),a=a.left;else{if(s((a=r.pop()).key,t)>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},n.prototype.keys=function(){for(var e=this._root,t=[],n=[],i=!1;!i;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.key),e=e.right):i=!0;return n},n.prototype.values=function(){for(var e=this._root,t=[],n=[],i=!1;!i;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.data),e=e.right):i=!0;return n},n.prototype.at=function(e){for(var t=this._root,n=[],i=!1,r=0;!i;)if(t)n.push(t),t=t.left;else if(n.length>0){if(t=n.pop(),r===e)return t;r++,t=t.right}else i=!0;return null},n.prototype.load=function(e,t,n){if(void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var i=e.length;return n&&s(e,t,0,i-1,this._compare),this._root=r(null,e,t,0,i),this._size=i,this},n.prototype.min=function(){var e=this.minNode(this._root);return e?e.key:null},n.prototype.max=function(){var e=this.maxNode(this._root);return e?e.key:null},n.prototype.isEmpty=function(){return null===this._root},i.size.get=function(){return this._size},n.createTree=function(e,t,i,r,s){return new n(i,s).load(e,t,r)},Object.defineProperties(n.prototype,i);var a=0,o=1,l=2,c=3,d=0,u=1,h=2,p=3;function m(e,t,n){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!f(t,n)||t.isVertical()?t.prevInResult:t));var i=f(e,n);e.resultTransition=i?function(e,t){var n,i=!e.inOut,r=!e.otherInOut;switch(t){case d:n=i&&r;break;case u:n=i||r;break;case p:n=i^r;break;case h:n=e.isSubject?i&&!r:r&&!i}return n?1:-1}(e,n):0}function f(e,t){switch(e.type){case a:switch(t){case d:return!e.otherInOut;case u:return e.otherInOut;case h:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case p:return!0}break;case l:return t===d||t===u;case c:return t===h;case o:return!1}return!1}var g=function(e,t,n,i,r){this.left=t,this.point=e,this.otherEvent=n,this.isSubject=i,this.type=r||a,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},x={inResult:{configurable:!0}};function y(e,t){return e[0]===t[0]&&e[1]===t[1]}g.prototype.isBelow=function(e){var t=this.point,n=this.otherEvent.point;return this.left?(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])>0:(n[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(n[1]-e[1])>0},g.prototype.isAbove=function(e){return!this.isBelow(e)},g.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},x.inResult.get=function(){return 0!==this.resultTransition},g.prototype.clone=function(){var e=new g(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e},Object.defineProperties(g.prototype,x);var v=11102230246251565e-32,_=134217729,b=(3+8*v)*v;function w(e,t,n,i,r){var s,a,o,l,c=t[0],d=i[0],u=0,h=0;d>c==d>-c?(s=c,c=t[++u]):(s=d,d=i[++h]);var p=0;if(u<e&&h<n)for(d>c==d>-c?(o=s-((a=c+s)-c),c=t[++u]):(o=s-((a=d+s)-d),d=i[++h]),s=a,0!==o&&(r[p++]=o);u<e&&h<n;)d>c==d>-c?(o=s-((a=s+c)-(l=a-s))+(c-l),c=t[++u]):(o=s-((a=s+d)-(l=a-s))+(d-l),d=i[++h]),s=a,0!==o&&(r[p++]=o);for(;u<e;)o=s-((a=s+c)-(l=a-s))+(c-l),c=t[++u],s=a,0!==o&&(r[p++]=o);for(;h<n;)o=s-((a=s+d)-(l=a-s))+(d-l),d=i[++h],s=a,0!==o&&(r[p++]=o);return 0===s&&0!==p||(r[p++]=s),p}function j(e){return new Float64Array(e)}var N=33306690738754716e-32,S=22204460492503146e-32,k=11093356479670487e-47,T=j(4),C=j(8),E=j(12),A=j(16),M=j(4);function D(e,t,n){var i=function(e,t,n,i,r,s){var a=(t-s)*(n-r),o=(e-r)*(i-s),l=a-o;if(0===a||0===o||a>0!=o>0)return l;var c=Math.abs(a+o);return Math.abs(l)>=N*c?l:-function(e,t,n,i,r,s,a){var o,l,c,d,u,h,p,m,f,g,x,y,v,j,N,D,I,P,R=e-r,L=n-r,z=t-s,O=i-s;T[0]=(N=(m=R-(p=(h=_*R)-(h-R)))*(g=O-(f=(h=_*O)-(h-O)))-((j=R*O)-p*f-m*f-p*g))-((x=N-(I=(m=z-(p=(h=_*z)-(h-z)))*(g=L-(f=(h=_*L)-(h-L)))-((D=z*L)-p*f-m*f-p*g)))+(u=N-x))+(u-I),T[1]=(v=j-((y=j+x)-(u=y-j))+(x-u))-((x=v-D)+(u=v-x))+(u-D),T[2]=y-((P=y+x)-(u=P-y))+(x-u),T[3]=P;var F=function(e,t){for(var n=t[0],i=1;i<4;i++)n+=t[i];return n}(0,T),B=S*a;if(F>=B||-F>=B)return F;if(o=e-(R+(u=e-R))+(u-r),c=n-(L+(u=n-L))+(u-r),l=t-(z+(u=t-z))+(u-s),d=i-(O+(u=i-O))+(u-s),0===o&&0===l&&0===c&&0===d)return F;if(B=k*a+b*Math.abs(F),(F+=R*d+O*o-(z*c+L*l))>=B||-F>=B)return F;M[0]=(N=(m=o-(p=(h=_*o)-(h-o)))*(g=O-(f=(h=_*O)-(h-O)))-((j=o*O)-p*f-m*f-p*g))-((x=N-(I=(m=l-(p=(h=_*l)-(h-l)))*(g=L-(f=(h=_*L)-(h-L)))-((D=l*L)-p*f-m*f-p*g)))+(u=N-x))+(u-I),M[1]=(v=j-((y=j+x)-(u=y-j))+(x-u))-((x=v-D)+(u=v-x))+(u-D),M[2]=y-((P=y+x)-(u=P-y))+(x-u),M[3]=P;var V=w(4,T,4,M,C);M[0]=(N=(m=R-(p=(h=_*R)-(h-R)))*(g=d-(f=(h=_*d)-(h-d)))-((j=R*d)-p*f-m*f-p*g))-((x=N-(I=(m=z-(p=(h=_*z)-(h-z)))*(g=c-(f=(h=_*c)-(h-c)))-((D=z*c)-p*f-m*f-p*g)))+(u=N-x))+(u-I),M[1]=(v=j-((y=j+x)-(u=y-j))+(x-u))-((x=v-D)+(u=v-x))+(u-D),M[2]=y-((P=y+x)-(u=P-y))+(x-u),M[3]=P;var U=w(V,C,4,M,E);M[0]=(N=(m=o-(p=(h=_*o)-(h-o)))*(g=d-(f=(h=_*d)-(h-d)))-((j=o*d)-p*f-m*f-p*g))-((x=N-(I=(m=l-(p=(h=_*l)-(h-l)))*(g=c-(f=(h=_*c)-(h-c)))-((D=l*c)-p*f-m*f-p*g)))+(u=N-x))+(u-I),M[1]=(v=j-((y=j+x)-(u=y-j))+(x-u))-((x=v-D)+(u=v-x))+(u-D),M[2]=y-((P=y+x)-(u=P-y))+(x-u),M[3]=P;var H=w(U,E,4,M,A);return A[H-1]}(e,t,n,i,r,s,c)}(e[0],e[1],t[0],t[1],n[0],n[1]);return i>0?-1:i<0?1:0}function I(e,t){var n=e.point,i=t.point;return n[0]>i[0]?1:n[0]<i[0]?-1:n[1]!==i[1]?n[1]>i[1]?1:-1:function(e,t,n){return e.left!==t.left?e.left?1:-1:0!==D(n,e.otherEvent.point,t.otherEvent.point)?e.isBelow(t.otherEvent.point)?-1:1:!e.isSubject&&t.isSubject?1:-1}(e,t,n)}function P(e,t,n){var i=new g(t,!1,e,e.isSubject),r=new g(t,!0,e.otherEvent,e.isSubject);return y(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),i.contourId=r.contourId=e.contourId,I(r,e.otherEvent)>0&&(e.otherEvent.left=!0,r.left=!1),e.otherEvent.otherEvent=r,e.otherEvent=i,n.push(r),n.push(i),n}function R(e,t){return e[0]*t[1]-e[1]*t[0]}function L(e,t){return e[0]*t[0]+e[1]*t[1]}function z(e,t,n){var i=function(e,t,n,i){var r=[t[0]-e[0],t[1]-e[1]],s=[i[0]-n[0],i[1]-n[1]];function a(e,t,n){return[e[0]+t*n[0],e[1]+t*n[1]]}var o=[n[0]-e[0],n[1]-e[1]],l=R(r,s),c=l*l,d=L(r,r);if(c>0){var u=R(o,s)/l;if(u<0||u>1)return null;var h=R(o,r)/l;return h<0||h>1?null:0===u||1===u?[a(e,u,r)]:0===h||1===h?[a(n,h,s)]:[a(e,u,r)]}if((c=(l=R(o,r))*l)>0)return null;var p=L(r,o)/d,m=p+L(r,s)/d,f=Math.min(p,m),g=Math.max(p,m);return f<=1&&g>=0?1===f?[a(e,f>0?f:0,r)]:0===g?[a(e,g<1?g:1,r)]:[a(e,f>0?f:0,r),a(e,g<1?g:1,r)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),r=i?i.length:0;if(0===r)return 0;if(1===r&&(y(e.point,t.point)||y(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===r&&e.isSubject===t.isSubject)return 0;if(1===r)return y(e.point,i[0])||y(e.otherEvent.point,i[0])||P(e,i[0],n),y(t.point,i[0])||y(t.otherEvent.point,i[0])||P(t,i[0],n),1;var s=[],a=!1,d=!1;return y(e.point,t.point)?a=!0:1===I(e,t)?s.push(t,e):s.push(e,t),y(e.otherEvent.point,t.otherEvent.point)?d=!0:1===I(e.otherEvent,t.otherEvent)?s.push(t.otherEvent,e.otherEvent):s.push(e.otherEvent,t.otherEvent),a&&d||a?(t.type=o,e.type=t.inOut===e.inOut?l:c,a&&!d&&P(s[1].otherEvent,s[0].point,n),2):d?(P(s[0],s[1].point,n),3):s[0]!==s[3].otherEvent?(P(s[0],s[1].point,n),P(s[1],s[2].point,n),3):(P(s[0],s[1].point,n),P(s[3].otherEvent,s[2].point,n),3)}function O(e,t){if(e===t)return 0;if(0!==D(e.point,e.otherEvent.point,t.point)||0!==D(e.point,e.otherEvent.point,t.otherEvent.point))return y(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===I(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;var n=e.point,i=t.point;return n[0]===i[0]&&n[1]===i[1]?(n=e.otherEvent.point)[0]===(i=t.otherEvent.point)[0]&&n[1]===i[1]?0:e.contourId>t.contourId?1:-1:1===I(e,t)?1:-1}var F=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function B(e,t,n,i){var r,s=e+1,a=t[e].point,o=t.length;for(s<o&&(r=t[s].point);s<o&&r[0]===a[0]&&r[1]===a[1];){if(!n[s])return s;++s<o&&(r=t[s].point)}for(s=e-1;n[s]&&s>i;)s--;return s}F.prototype.isExterior=function(){return null==this.holeOf};var V=H,U=H;function H(e,t){if(!(this instanceof H))return new H(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||q,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function q(e,t){return e<t?-1:e>t?1:0}H.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,s=t[r];if(n(i,s)>=0)break;t[e]=s,e=r}t[e]=i},_down:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var s=1+(e<<1),a=s+1,o=t[s];if(a<this.length&&n(t[a],o)<0&&(s=a,o=t[a]),n(o,r)>=0)break;t[e]=o,e=s}t[e]=r}},V.default=U;var W=Math.max,G=Math.min,Y=0;function Z(e,t,n,i,r,s){var a,o,l,c,d,u;for(a=0,o=e.length-1;a<o;a++)if(c=e[a+1],d=new g(l=e[a],!1,void 0,t),u=new g(c,!1,d,t),d.otherEvent=u,l[0]!==c[0]||l[1]!==c[1]){d.contourId=u.contourId=n,s||(d.isExteriorRing=!1,u.isExteriorRing=!1),I(d,u)>0?u.left=!0:d.left=!0;var h=l[0],p=l[1];r[0]=G(r[0],h),r[1]=G(r[1],p),r[2]=W(r[2],h),r[3]=W(r[3],p),i.push(d),i.push(u)}}var X=[];function K(e,t,i){"number"==typeof e[0][0][0]&&(e=[e]),"number"==typeof t[0][0][0]&&(t=[t]);var r=function(e,t,n){var i=null;return e.length*t.length==0&&(n===d?i=X:n===h?i=e:n!==u&&n!==p||(i=0===e.length?t:e)),i}(e,t,i);if(r)return r===X?null:r;var s=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],o=function(e,t,n,i,r){var s,a,o,l,c,d,u=new V(null,I);for(o=0,l=e.length;o<l;o++)for(c=0,d=(s=e[o]).length;c<d;c++)(a=0===c)&&Y++,Z(s[c],!0,Y,u,n,a);for(o=0,l=t.length;o<l;o++)for(c=0,d=(s=t[o]).length;c<d;c++)a=0===c,r===h&&(a=!1),a&&Y++,Z(s[c],!1,Y,u,i,a);return u}(e,t,s,a,i);if(r=function(e,t,n,i,r){var s=null;return(n[0]>i[2]||i[0]>n[2]||n[1]>i[3]||i[1]>n[3])&&(r===d?s=X:r===h?s=e:r!==u&&r!==p||(s=e.concat(t))),s}(e,t,s,a,i))return r===X?null:r;for(var l=function(e){var t,n,i=function(e){var t,n,i,r,s=[];for(n=0,i=e.length;n<i;n++)((t=e[n]).left&&t.inResult||!t.left&&t.otherEvent.inResult)&&s.push(t);for(var a=!1;!a;)for(a=!0,n=0,i=s.length;n<i;n++)n+1<i&&1===I(s[n],s[n+1])&&(r=s[n],s[n]=s[n+1],s[n+1]=r,a=!1);for(n=0,i=s.length;n<i;n++)(t=s[n]).otherPos=n;for(n=0,i=s.length;n<i;n++)(t=s[n]).left||(r=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=r);return s}(e),r={},s=[],a=function(){if(!r[t]){var e=s.length,n=function(e,t,n){var i=new F;if(null!=e.prevInResult){var r=e.prevInResult,s=r.outputContourId;if(r.resultTransition>0){var a=t[s];if(null!=a.holeOf){var o=a.holeOf;t[o].holeIds.push(n),i.holeOf=o,i.depth=t[s].depth}else t[s].holeIds.push(n),i.holeOf=s,i.depth=t[s].depth+1}else i.holeOf=null,i.depth=t[s].depth}else i.holeOf=null,i.depth=0;return i}(i[t],s,e),a=function(t){r[t]=!0,t<i.length&&i[t]&&(i[t].outputContourId=e)},o=t,l=t;for(n.points.push(i[t].point);a(o),a(o=i[o].otherPos),n.points.push(i[o].point),!((o=B(o,i,r,l))==l||o>=i.length)&&i[o];);s.push(n)}};for(t=0,n=i.length;t<n;t++)a();return s}(function(e,t,i,r,s,a){for(var o,l,c,u=new n(O),p=[],f=Math.min(r[2],s[2]);0!==e.length;){var g=e.pop();if(p.push(g),a===d&&g.point[0]>f||a===h&&g.point[0]>r[2])break;if(g.left){l=o=u.insert(g),o=o!==(c=u.minNode())?u.prev(o):null,l=u.next(l);var x=o?o.key:null;if(m(g,x,a),l&&2===z(g,l.key,e)&&(m(g,x,a),m(l.key,g,a)),o&&2===z(o.key,g,e)){var y=o;m(x,(y=y!==c?u.prev(y):null)?y.key:null,a),m(g,x,a)}}else l=o=u.find(g=g.otherEvent),o&&l&&(o=o!==c?u.prev(o):null,l=u.next(l),u.remove(g),l&&o&&z(o.key,l.key,e))}return p}(o,0,0,s,a,i)),c=[],f=0;f<l.length;f++){var g=l[f];if(g.isExterior()){for(var x=[g.points],y=0;y<g.holeIds.length;y++)x.push(l[g.holeIds[y]].points);c.push(x)}}return c}var Q={UNION:u,DIFFERENCE:h,INTERSECTION:d,XOR:p};e.diff=function(e,t){return K(e,t,h)},e.intersection=function(e,t){return K(e,t,d)},e.operations=Q,e.union=function(e,t){return K(e,t,u)},e.xor=function(e,t){return K(e,t,p)},Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,th.exports)),th.exports);function ih(e,t,n,i){const r=[],s=0===i?(e,t,n,i,r,s)=>{e.push(new _e(s,n+(s-t)/(i-t)*(r-n)))}:(e,t,n,i,r,s)=>{e.push(new _e(t+(s-n)/(r-n)*(i-t),s))};for(const a of e){const e=[];for(const r of a){if(r.length<=2)continue;const a=[];for(let e=0;e<r.length-1;e++){const o=r[e].x,l=r[e].y,c=r[e+1].x,d=r[e+1].y,u=0===i?o:l,h=0===i?c:d;u<t?h>t&&s(a,o,l,c,d,t):u>n?h<n&&s(a,o,l,c,d,n):a.push(r[e]),h<t&&u>=t&&s(a,o,l,c,d,t),h>n&&u<=n&&s(a,o,l,c,d,n)}let o=r[r.length-1];const l=0===i?o.x:o.y;l>=t&&l<=n&&a.push(o),a.length&&(o=a[a.length-1],a[0].x===o.x&&a[0].y===o.y||a.push(a[0]),e.push(a))}e.length&&r.push(e)}return r}function rh(e,t){const n=ah(e),i=ah([t]),r=nh.intersection(n,i);return null==r?[]:oh(r)}function sh(e,t){const n=65536;let i=ah(e,n);for(;t.valid();t.next()){const[e,r]=t.get(),s=e.x*n,a=e.y*n,o=r.x*n,l=r.y*n,c=o-s,d=l-a,u=Math.hypot(c,d),h=Math.trunc(d/u*3),p=-Math.trunc(c/u*3);i=nh.diff(i,[[[s,a],[o,l],[o+h,l+p],[s+h,a+p],[s,a]]])}return oh(i,1/n)}function ah(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[e.map(e=>e.map(e=>[e.x*t,e.y*t]))]}function oh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.map(e=>e.map((e,n)=>{const i=e.map(e=>new _e(e[0]*t,e[1]*t).round());return n>0&&i.reverse(),i}))}class lh{constructor(e,t){this.layoutVertexArray=new no,this.indexArray=new No,this.lineIndexArray=new vo,this.triangleSegments=new tl,this.lineSegments=new tl,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,t&&(this.elevatedLayoutVertexArray=new so)}update(e,t,n,i,r,s,a,o){this.programConfigurations.updatePaintArrays(e,t,r,n,i,s,a,o)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,gu.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,t,n,i,r,s,a){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,t,n,i,r,s,void 0,a)}}class ch{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new lh(e,!1),this.elevationBufferData=new lh(e,!0),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){this.hasPattern=Zu("fill",this.layers,this.pixelRatio,t);const r=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:a,id:o,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,d=yc(a,e);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom,{worldview:this.worldview}),d,n))continue;const u=r?r.evaluate(d,{},n,t.availableImages):void 0,h={id:o,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?d.geometry:xc(a,n,i),patterns:{},sortKey:u};s.push(h)}r&&s.sort((e,t)=>e.sortKey-t.sortKey);for(const a of s){const{geometry:i,index:r,sourceLayerIndex:s}=a;if(this.hasPattern){const e=Xu("fill",this.layers,a,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(a,i,r,n,{},t.availableImages,t.brightness,t.elevationFeatures);t.featureIndex.insert(e[r].feature,i,r,s,this.index)}}update(e,t,n,i,r,s,a){this.bufferData.update(e,t,n,i,r,s,a,this.worldview),this.elevationBufferData.update(e,t,n,i,r,s,a,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,t,n,i,r,s,a,this.worldview)}addFeatures(e,t,n,i,r,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i,s,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;const l=Wu(t,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(e,l,i,n,o):this.addGeometry(l,this.bufferData),this.bufferData.populatePaintArrays(e,n,r,s,i,a,this.worldview),this.elevationBufferData.populatePaintArrays(e,n,r,s,i,a,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,t,n,i,r){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(t,n,i,r,this.worldview))}addElevatedRoadFeature(e,t,n,i,r){const s=new Array,a=qc.getElevationFeature(e,r);if(!a)return void this.addGeometry(t,this.bufferData);{const e=this.clipPolygonsToTile(t,1);e.length>0&&s.push({polygons:e,elevationFeature:a,elevationTileID:n})}const o={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},n),featureIndex:i};for(const l of s)if(l.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new $u(l.elevationTileID,this.layers,this.zoom,this.lut));const t=l.elevationFeature.isTunnel();let n=0;e.properties.hasOwnProperty(Tc)&&(n=+e.properties[Tc]);for(const e of l.polygons)this.elevatedStructures.addPortalCandidates(l.elevationFeature.id,e,t,l.elevationFeature,n)}null==l.elevationFeature.constantHeight&&(l.polygons=this.prepareElevatedPolygons(l.polygons,l.elevationFeature,l.elevationTileID));const t=new Wc(n,l.elevationTileID);this.addElevatedGeometry(l.polygons,t,l.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,i,o)}}addElevatedGeometry(e,t,n,i,r,s){const a={elevation:n,elevationSampler:t,bias:i,index:r,featureInfo:s},[o,l]=this.addGeometry(e,this.elevationBufferData,a);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:o,max:l}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,o),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,l))}addGeometry(e,t,n){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=null;n&&(s=n.elevationSampler.constantElevation(n.elevation,n.bias),null!=s&&(i=s,r=s));const a=(e,a,o)=>{if(null!=n)if(a.push(e),null!=s)t.elevatedLayoutVertexArray.emplaceBack(s),o.push(s);else{const s=n.elevationSampler.pointElevation(e,n.elevation,n.bias);t.elevatedLayoutVertexArray.emplaceBack(s),o.push(s),i=Math.min(i,s),r=Math.max(r,s)}};for(const o of e){let e=0;for(const t of o)e+=t.length;const i=t.triangleSegments.prepareSegment(e,t.layoutVertexArray,t.indexArray),r=i.vertexLength,s=[],l=[],c=[],d=[],u=[],h=t.layoutVertexArray.length;for(const m of o){if(0===m.length)continue;m!==o[0]&&l.push(s.length/2);const e=t.lineSegments.prepareSegment(m.length,t.layoutVertexArray,t.lineIndexArray),i=e.vertexLength;n&&u.push(t.layoutVertexArray.length-h),a(m[0],c,d),t.layoutVertexArray.emplaceBack(m[0].x,m[0].y),t.lineIndexArray.emplaceBack(i+m.length-1,i),s.push(m[0].x),s.push(m[0].y);for(let n=1;n<m.length;n++)a(m[n],c,d),t.layoutVertexArray.emplaceBack(m[n].x,m[n].y),t.lineIndexArray.emplaceBack(i+n-1,i+n),s.push(m[n].x),s.push(m[n].y);e.vertexLength+=m.length,e.primitiveLength+=m.length}const p=vu(s,l);for(let n=0;n<p.length;n+=3)t.indexArray.emplaceBack(r+p[n],r+p[n+1],r+p[n+2]);if(p.length>0&&n&&"hd-road-base"===this.elevationMode){const e=n.elevation.isTunnel(),t=n.elevation.safeArea,i=this.elevatedStructures.addVertices(c,d);this.elevatedStructures.addTriangles(p,i,e);const r=u.length;if(r>0){for(let s=0;s<r-1;s++)this.elevatedStructures.addRenderableRing(n.index,u[s]+i,u[s+1]-u[s],e,t,n.featureInfo);this.elevatedStructures.addRenderableRing(n.index,u[r-1]+i,c.length-u[r-1],e,t,n.featureInfo)}}i.vertexLength+=e,i.primitiveLength+=p.length/3}return[i,r]}prepareElevatedPolygons(e,t,n){const i=1/lc(n),r=[];for(const s of e){const e=sh(s,new Uc(t,i));r.push(...e)}return r}clipPolygonsToTile(e,t){const n=-t,i=-t,r=Pi+t,s=Pi+t;let a=0;const o=[],l=[];for(;a<e.length;a++){const t=e[a],c=hi(t);(c.min.x>=n&&c.max.x<=r&&c.min.y>=i&&c.max.y<=s?o:l).push(t)}if(o.length===e.length)return e;const c=[new _e(n,i),new _e(r,i),new _e(r,s),new _e(n,s),new _e(n,i)],d=o;for(const u of l)d.push(...rh(u,c));return d}}let dh,uh,hh,ph;Gs(ch,"FillBucket",{omit:["layers","patternFeatures"]}),Gs(lh,"FillBufferData"),Gs($u,"ElevatedStructures");class mh{constructor(e,t,n,i){if(this.triangleCount=t.length/3,this.min=new _e(0,0),this.max=new _e(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[r,s]=[e[0].clone(),e[0].clone()];for(let d=1;d<e.length;++d){const t=e[d];r.x=Math.min(r.x,t.x),r.y=Math.min(r.y,t.y),s.x=Math.max(s.x,t.x),s.y=Math.max(s.y,t.y)}if(i){const e=Math.ceil(Math.max(s.x-r.x,s.y-r.y)/i);n=Math.max(n,e)}if(0===n)return;this.min=r,this.max=s;const a=this.max.sub(this.min);a.x=Math.max(a.x,1),a.y=Math.max(a.y,1);const o=Math.max(a.x,a.y)/n;this.cellsX=Math.max(1,Math.ceil(a.x/o)),this.cellsY=Math.max(1,Math.ceil(a.y/o)),this.xScale=1/o,this.yScale=1/o;const l=[];for(let d=0;d<this.triangleCount;d++){const n=e[t[3*d+0]].sub(this.min),i=e[t[3*d+1]].sub(this.min),r=e[t[3*d+2]].sub(this.min),s=fh(Math.floor(Math.min(n.x,i.x,r.x)),this.xScale,this.cellsX),a=fh(Math.floor(Math.max(n.x,i.x,r.x)),this.xScale,this.cellsX),c=fh(Math.floor(Math.min(n.y,i.y,r.y)),this.yScale,this.cellsY),u=fh(Math.floor(Math.max(n.y,i.y,r.y)),this.yScale,this.cellsY),h=new _e(0,0),p=new _e(0,0),m=new _e(0,0),f=new _e(0,0);for(let e=c;e<=u;++e){h.y=p.y=e*o,m.y=f.y=(e+1)*o;for(let t=s;t<=a;++t)h.x=m.x=t*o,p.x=f.x=(t+1)*o,(ld(n,i,r,h,p,f)||ld(n,i,r,h,f,m))&&l.push({cellIdx:e*this.cellsX+t,triIdx:d})}}if(0===l.length)return;l.sort((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx);let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,t){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const n=fh(e.x-this.min.x,this.xScale,this.cellsX),i=fh(e.y-this.min.y,this.yScale,this.cellsY),r=this.cells[i*this.cellsX+n];if(r){this._lazyInitLookup();for(let e=0;e<r.len;e++){const n=this.payload[r.start+e],i=Math.floor(n/8),s=1<<n%8;if(!(this.lookup[i]&s)&&(this.lookup[i]|=s,t.push(n),t.length===this.triangleCount))return}}}query(e,t,n){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this._lazyInitLookup();const i=fh(e.x-this.min.x,this.xScale,this.cellsX),r=fh(t.x-this.min.x,this.xScale,this.cellsX),s=fh(e.y-this.min.y,this.yScale,this.cellsY),a=fh(t.y-this.min.y,this.yScale,this.cellsY);for(let o=s;o<=a;o++)for(let e=i;e<=r;e++){const t=this.cells[o*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const i=this.payload[t.start+e],r=Math.floor(i/8),s=1<<i%8;if(!(this.lookup[r]&s)&&(this.lookup[r]|=s,n.push(i),n.length===this.triangleCount))return}}}}function fh(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}Gs(mh,"TriangleGridIndex");class gh{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,t){for(const n of this.footprints)t.push({footprint:n,id:e})}populate(e,t,n,i){const r=[];for(const{feature:s,id:a,index:o,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(s,e);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom,{worldview:this.worldview}),t,n))continue;const c={id:a,properties:s.properties,type:s.type,sourceLayerIndex:l,index:o,geometry:e?t.geometry:xc(s,n,i),patterns:{}};r.push(c)}for(const s of r){const{geometry:i,index:r,sourceLayerIndex:a}=s;this.addFeature(s,i,r,n,{},t.availableImages,t.brightness),t.featureIndex.insert(e[r].feature,i,r,a,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,t,n,i,r,s,a){}destroy(){}addFeature(e,t,n,i,r){for(const s of Wu(t,2)){const e=[],t=[],n=[],i=new _e(1/0,1/0),r=new _e(-1/0,-1/0);for(const l of s)if(0!==l.length){l!==s[0]&&n.push(t.length/2);for(let n=0;n<l.length;n++)t.push(l[n].x),t.push(l[n].y),e.push(l[n]),i.x=Math.min(i.x,l[n].x),i.y=Math.min(i.y,l[n].y),r.x=Math.max(r.x,l[n].x),r.y=Math.max(r.y,l[n].y)}const a=vu(t,n),o=new mh(e,a,8,256);this.footprints.push({vertices:e,indices:a,grid:o,min:i,max:r})}}}Gs(gh,"ClipBucket",{omit:["layers"]});const xh=eo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),yh=eo([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),vh=eo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_h=eo([{name:"a_join_normal_inside",components:3,type:"Int16"}]),bh=eo([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),wh=eo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:jh}=xh,Nh=Number.MAX_SAFE_INTEGER,Sh=Nh-1;function kh(e,t,n,i){return e.order<t||e.order===Nh||!(e.clipMask&n)||function(e,t){return 0!==t.length&&void 0===t.find(t=>t===e)}(i,e.clipScope)}function Th(e,t){return e.x-t.x||e.y-t.y}function Ch(e,t){return 0===Th(e.min,t.min)&&0===Th(e.max,t.max)}function Eh(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Ah(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].sourceId!==t[n].sourceId||!Ch(e[n],t[n])||e[n].order!==t[n].order||e[n].clipMask!==t[n].clipMask||!be(e[n].clipScope,t[n].clipScope))return!1;return!0}function Mh(e,t,n){const i=1/Pi,r=1/(1<<n.canonical.z),s=(t.x*i+n.canonical.x)*r+n.wrap,a=(t.y*i+n.canonical.y)*r;return{min:new _e((e.x*i+n.canonical.x)*r+n.wrap,(e.y*i+n.canonical.y)*r),max:new _e(s,a)}}function Dh(e,t,n){const i=1<<n.canonical.z,r=((t.x-n.wrap)*i-n.canonical.x)*Pi,s=(t.y*i-n.canonical.y)*Pi;return{min:new _e(((e.x-n.wrap)*i-n.canonical.x)*Pi,(e.y*i-n.canonical.y)*Pi),max:new _e(r,s)}}function Ih(e,t,n,i,r,s,a){const o=e.indices,l=e.vertices,c=[];for(let d=i;d<i+r;d+=3){const i=t[n[d+0]+s],r=t[n[d+1]+s],u=t[n[d+2]+s],h=Math.min(i.x,r.x,u.x),p=Math.max(i.x,r.x,u.x),m=Math.min(i.y,r.y,u.y),f=Math.max(i.y,r.y,u.y);c.length=0,e.grid.query(new _e(h,m),new _e(p,f),c);for(let e=0;e<c.length;e++){const t=c[e];if(ld(l[o[3*t+0]],l[o[3*t+1]],l[o[3*t+2]],i,r,u,a))return!0}}return!1}function Ph(e,t,n,i){if(!e||!n)return!1;let r=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(n.vertices.length<e.vertices.length)return Ph(n,i,e,t);const s=t.canonical,a=i.canonical,o=Math.pow(2,a.z-s.z);r=e.vertices.map(e=>new _e((e.x+s.x*Pi)*o-a.x*Pi,(e.y+s.y*Pi)*o-a.y*Pi))}return Ih(n,r,e.indices,0,e.indices.length,0,0)}function Rh(e,t,n,i){const r=Math.pow(2,i.z-n.z);return new _e((e+n.x*Pi)*r-i.x*Pi,(t+n.y*Pi)*r-i.y*Pi)}function Lh(e,t){const n=[];t.grid.queryPoint(e,n);const i=t.indices,r=t.vertices;for(let s=0;s<n.length;s++){const t=n[s];if(rd([r[i[3*t+0]],r[i[3*t+1]],r[i[3*t+2]]],e))return!0}return!1}const zh=[new _e(0,0),new _e(Pi,0),new _e(Pi,Pi),new _e(0,Pi)];function Oh(e,t){const n=[];let i=[];if(!t||e.length<2)return[e];if(2===e.length)return ad(e[0],e[1],zh)?[e]:[];for(let r=0;r<e.length+2;r++){const t=e[r%e.length],s=e[(r+1)%e.length],a=ad(0===r?e[e.length-1]:e[(r-1)%e.length],t,zh),o=ad(t,s,zh),l=a||o;l&&i.push(t),l&&o||i.length>0&&(i.length>1&&n.push(i),i=[])}return i.length>1&&n.push(i),n}const Fh=vc.types,Bh=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Vh=["fill-extrusion-flood-light-ground-radius"],Uh=Math.pow(2,13),Hh=Math.pow(2,15)-1,qh=new _e(0,1),Wh=2147483648;function Gh(e,t,n,i,r,s,a,o){e.emplaceBack((t<<1)+a,(n<<1)+s,(Math.floor(i*Uh)<<1)+r,Math.round(o))}function Yh(e,t,n){e.emplaceBack(t.x*Pi,t.y*Pi,n?1:0)}function Zh(e,t,n,i,r,s){e.emplaceBack(t.x,t.y,(n.x<<1)+i,(n.y<<1)+r,s)}function Xh(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class Kh{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Qh{constructor(){this.centroidXY=new _e(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _e(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _e(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new _e(this.max.x-this.min.x,this.max.y-this.min.y)}}class Jh{constructor(){this.acc=new _e(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,n){this.accCount++,this.acc._add(t);let i=!!this.borders;t.x<e.min.x?(e.min.x=t.x,i=!0):t.x>e.max.x&&(e.max.x=t.x,i=!0),t.y<e.min.y?(e.min.y=t.y,i=!0):t.y>e.max.y&&(e.max.y=t.y,i=!0),((0===t.x||t.x===Pi)&&t.x===n.x)!=((0===t.y||t.y===Pi)&&t.y===n.y)&&this.processBorderOverlap(t,n),i&&this.checkBorderIntersection(t,n)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,dn(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Pi!=e.x>Pi&&this.addBorderIntersection(1,dn(t.y,e.y,(Pi-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,dn(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Pi!=e.y>Pi&&this.addBorderIntersection(3,dn(t.x,e.x,(Pi-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){return 0===this.accCount?new _e(0,0):new _e(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0):0}}function $h(e,t){const n=e.add(t)._unit(),i=Ae(e.x*n.x+e.y*n.y,-1,1);var r,s,a;return r=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(r)))/4*Hh*((s=e).x*(a=t).y-s.y*a.x<0?-1:1)}const ep=[e=>e.x<0,e=>e.x>Pi,e=>e.y<0,e=>e.y>Pi];function tp(e,t,n,i){const r=[4];if(0===i)return r;n._mult(i);const s=e.sub(n),a=t.sub(n),o=[e,t,s,a];for(let l=0;l<4;l++)for(const e of o)if(ep[l](e)){r.push(l);break}return r}class np{constructor(e){this.vertexArray=new lo,this.indexArray=new No,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut},e=>Vh.includes(e)),this._segments=new tl,this.hiddenByLandmarkVertexArray=new Oo,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new tl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e.length;if(r>2){let s=Math.max(0,this._segments.get().length-1);const a=this._segments._prepareSegment(4*r,this.vertexArray.length,2*this._segmentToGroundQuads[s].length);let o;s!==this._segments.get().length-1&&(s++,this._segmentToGroundQuads[s]=[],this._segmentToRegionTriCounts[s]=[0,0,0,0,0]);{const t=e[0],n=e[1];o=$h(t.sub(e[r-1])._perp()._unit(),n.sub(t)._perp()._unit())}for(let l=0;l<r;l++){const c=l===r-1?0:l+1,d=e[l],u=e[c],h=e[c===r-1?0:c+1],p=u.sub(d)._perp()._unit(),m=$h(p,h.sub(u)._perp()._unit()),f=o,g=m;if(op(d,u,t)||i&&lp(d,t)&&lp(u,t)){o=m;continue}const x=a.vertexLength;Zh(this.vertexArray,d,u,1,1,f),Zh(this.vertexArray,d,u,1,0,f),Zh(this.vertexArray,d,u,0,1,g),Zh(this.vertexArray,d,u,0,0,g),a.vertexLength+=4;const y=tp(d,u,p,n);for(const e of y)this._segmentToGroundQuads[s].push({id:x,region:e}),this._segmentToRegionTriCounts[s][e]+=2,a.primitiveLength+=2;o=m}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let n=0;n<t;n++)this._segmentToGroundQuads[n].sort((e,t)=>e.region-t.region);for(let n=0;n<t;n++){const t=this._segmentToGroundQuads[n],i=e[n],r=this._segmentToRegionTriCounts[n];r.reduce((e,t)=>e+t,0);let s=0;for(let e=0;e<=4;e++){const t=r[e];if(0!==t){let n=this.regionSegments[e];n||(n=this.regionSegments[e]=new tl);const r={vertexOffset:i.vertexOffset,primitiveOffset:i.primitiveOffset+s,vertexLength:i.vertexLength,primitiveLength:t};n.get().push(r)}s+=t}for(let e=0;e<t.length;e++){const n=t[e].id;this.indexArray.emplaceBack(n,n+1,n+3),this.indexArray.emplaceBack(n,n+3,n+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,n,i,r,s,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,n,i,r,s,void 0,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,yh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,n,i,r,s,a,o){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,n,i,r,s,a,o)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Wh))}updateHiddenByLandmarkRange(e,t,n){if(!this.hasData())return;const i=t+e;if(0!==t){for(let t=e;t<i;++t)this.hiddenByLandmarkVertexArray.emplace(t,n?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,bh.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class ip{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new No,this.footprintVertices=new no,this.footprintSegments=[],this.layoutVertexArray=new ro,this.centroidVertexArray=new Xo,this.wallVertexArray=new Qo,this.indexArray=new No,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut},e=>Bh.includes(e)),this.segments=new tl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new np(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){this.features=[],this.hasPattern=Zu("fill-extrusion",this.layers,this.pixelRatio,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=lc(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:r,id:s,index:a,sourceLayerIndex:o}of e){const e=this.layers[0]._featureFilter.needGeometry,l=yc(r,e);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom,{worldview:this.worldview}),l,n))continue;const c={id:s,sourceLayerIndex:o,index:a,geometry:e?l.geometry:xc(r,n,i),properties:r.properties,type:r.type,patterns:{}},d=this.layoutVertexArray.length,u="Polygon"===Fh[c.type];if(this.hasPattern)this.features.push({featureId:r.id,feature:Xu("fill-extrusion",this.layers,c,this.zoom,this.pixelRatio,t)});else if(this.wallMode)for(const s of c.geometry)for(const e of Oh(s,u))this.addFeature(r.id,c,[e],a,n,{},t.availableImages,i,t.brightness);else this.addFeature(r.id,c,c.geometry,a,n,{},t.availableImages,i,t.brightness);t.featureIndex.insert(r,c.geometry,a,o,this.index,d)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,n,i,r,s){for(const{featureId:a,feature:o}of this.features){const e="Polygon"===Fh[o.type],{geometry:l}=o;if(this.wallMode)for(const c of l)for(const l of Oh(c,e))this.addFeature(a,o,[l],o.index,t,n,i,r,s);else this.addFeature(a,o,l,o.index,t,n,i,r,s)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,n,i,r,s,a){this.programConfigurations.updatePaintArrays(e,t,r,n,i,s,a,this.worldview),this.groundEffect.update(e,t,r,n,i,s,a,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,_h.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,wh.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,vh.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r,s,a,o,l){const c=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,d=[new _e(0,0),new _e(Pi,Pi)],u=o.projection,h="globe"===u.name,p=this.wallMode||"Polygon"===Fh[t.type],m=new Jh;m.centroidDataIndex=this.centroidData.length;const f=new Qh;f.buildingId=e,t.properties&&t.properties.hasOwnProperty("building_id")&&(f.buildingId=t.properties.building_id);const g=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},r)<=0,x=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},r);let y;if(f.height=x,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new mo),this.wallMode){if(h)return void qe("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==n.length)return;y=function(e){const t=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y,n=function(e){let t=0;const n=e.length;for(let i=0;i<n;i++)t+=(e[(i+1)%n].x-e[i].x)*(e[(i+1)%n].y+e[i].y);return t>=0}(e);n||(e=e.reverse());const i={geometry:[],joinNormals:[],indices:[]},r=[],s=[],a=[];let o=e.length;for(;o>=2&&e[o-1].equals(e[o-2]);)o--;if(o<(t?3:2))return i;let l,c,d,u,h,p=0;for(;p<o-1&&e[p].equals(e[p+1]);)p++;t&&(l=e[o-2],h=e[p].sub(l)._unit()._perp());for(let f=p;f<o;f++){if(d=f===o-1?t?e[p+1]:void 0:e[f+1],d&&e[f].equals(d))continue;h&&(u=h),l&&(c=l),l=e[f],h=d?d.sub(l)._unit()._perp():u,u=u||h;let n=u.add(h);0===n.x&&0===n.y||n._unit();const i=n.x*h.x+n.y*h.y,m=0!==i?1/i:1/0,g=u.x*h.y-u.y*h.x>0;let x="miter";const y=2;"miter"===x&&m>y&&(x="bevel"),"bevel"===x&&(m>100&&(x="flipbevel"),m<y&&(x="miter"));const v=(e,t,n,i)=>{const o=new _e(e.x,e.y),l=new _e(e.x,e.y);o.x+=t.x*i,o.y+=t.y*i,l.x-=t.x*Math.max(n,1),l.y-=t.y*Math.max(n,1),a.push(t),r.push(o),s.push(l)};if("miter"===x)n._mult(m),v(l,n,0,0);else if("flipbevel"===x)n=h.mult(-1),v(l,n,0,0),v(l,n.mult(-1),0,0);else{const e=-Math.sqrt(m*m-1),t=g?e:0,n=g?0:e;c&&v(l,u,t,n),d&&v(l,h,t,n)}}i.geometry=[...r,...s.reverse(),r[0]],i.joinNormals=[...a,...a.reverse(),a[a.length-1]];const m=i.geometry.length-1;for(let f=0;f<m/2;f++)if(f+1<m/2){let e=f,t=f+1,n=m-1-f,r=m-2-f;e=0===e?m-1:e-1,t=0===t?m-1:t-1,n=0===n?m-1:n-1,r=0===r?m-1:r-1,i.indices.push(n),i.indices.push(t),i.indices.push(e),i.indices.push(n),i.indices.push(r),i.indices.push(t)}return i}(n[0]),n=[y.geometry]}const v=(e,t)=>e<(t.length-1)/2||e===t.length-1,_=this.wallMode?[n]:Wu(n,500);for(let k=_.length-1;k>=0;k--){const e=_[k];(0===e.length||(b=e[0]).every(e=>e.x<=0)||b.every(e=>e.x>=Pi)||b.every(e=>e.y<=0)||b.every(e=>e.y>=Pi))&&_.splice(k,1)}var b;let w;if(h)w=hp(_,d,r);else{w=[];for(const e of _)w.push({polygon:e,bounds:d})}const j=p?this.edgeRadius:0,N=j>0&&this.zoom<17,S=(e,t)=>{if(0===e.length)return!1;const n=e[e.length-1];return t.x===n.x&&t.y===n.y};for(const{polygon:k,bounds:T}of w){let e=0,t=0;for(const r of k)p&&!r[0].equals(r[r.length-1])&&r.push(r[0]),t+=p?r.length-1:r.length;const n=this.segments.prepareSegment((p?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const i={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},s=new Kh;if(s.vertexOffset=this.footprintVertices.length,s.indexOffset=3*this.footprintIndices.length,s.ringIndices=[],p){const t=[],i=[];e=n.vertexLength;for(let e=0;e<k.length;e++){const a=k[e];a.length&&0!==e&&i.push(t.length/2);const o=[];let l,d;l=a[1].sub(a[0])._perp()._unit(),s.ringIndices.push(a.length-1);for(let e=1;e<a.length;e++){const i=a[e],s=a[e===a.length-1?1:e+1],c=i.clone();if(j){d=s.sub(i)._perp()._unit();const e=l.add(d)._unit(),t=j*Math.min(4,1/(l.x*e.x+l.y*e.y));c.x+=t*e.x,c.y+=t*e.y,c.x=Math.round(c.x),c.y=Math.round(c.y),l=d}if(!g||0!==j&&!N||S(o,c)||o.push(c),Gh(this.layoutVertexArray,c.x,c.y,0,0,1,1,0),this.wallMode){const t=v(e,a);Yh(this.wallVertexArray,y.joinNormals[e],!t)}n.vertexLength++,this.footprintVertices.emplaceBack(i.x,i.y),t.push(i.x,i.y),h&&Xh(this.layoutVertexExtArray,u.projectTilePoint(c.x,c.y,r),u.upVector(r,c.x,c.y))}g&&(0===j||N)&&(0!==o.length&&S(o,o[0])&&o.pop(),this.groundEffect.addData(o,T,c))}const a=this.wallMode?y.indices:vu(t,i);for(let r=0;r<a.length;r+=3)this.footprintIndices.emplaceBack(s.vertexOffset+a[r+0],s.vertexOffset+a[r+1],s.vertexOffset+a[r+2]),this.indexArray.emplaceBack(e+a[r],e+a[r+2],e+a[r+1]),n.primitiveLength++;s.indexCount+=a.length,s.vertexCount+=this.footprintVertices.length-s.vertexOffset}for(let a=0;a<k.length;a++){const t=k[a];m.startRing(f,t[0]);let i=t.length>4&&cp(t[t.length-2],t[0],t[1]),s=j?sp(t[t.length-2],t[0],t[1],j):0;const o=[];let l,d,x;d=t[1].sub(t[0])._perp()._unit();let _=!0;for(let a=1,c=0;a<t.length;a++){let p=t[a-1],b=t[a];const w=t[a===t.length-1?1:a+1];if(m.appendEdge(f,b,p),op(b,p,T)){j&&(d=w.sub(b)._perp()._unit(),_=!_);continue}const N=b.sub(p)._perp(),k=N.x/(Math.abs(N.x)+Math.abs(N.y)),C=N.y>0?1:0,E=p.dist(b);if(c+E>32768&&(c=0),j){x=w.sub(b)._perp()._unit();let e=ap(p,b,w,rp(d,x),j);isNaN(e)&&(e=0);const t=b.sub(p)._unit();p=p.add(t.mult(s))._round(),b=b.add(t.mult(-e))._round(),s=e,d=x,g&&this.zoom>=17&&(S(o,p)||o.push(p),S(o,b)||o.push(b))}const A=n.vertexLength,M=t.length>4&&cp(p,b,w);let D=dp(c,i,_);if(Gh(this.layoutVertexArray,p.x,p.y,k,C,0,0,D),Gh(this.layoutVertexArray,p.x,p.y,k,C,0,1,D),this.wallMode){const e=v(a-1,t),n=y.joinNormals[a-1];Yh(this.wallVertexArray,n,e),Yh(this.wallVertexArray,n,e)}if(c+=E,D=dp(c,M,!_),i=M,Gh(this.layoutVertexArray,b.x,b.y,k,C,0,0,D),Gh(this.layoutVertexArray,b.x,b.y,k,C,0,1,D),this.wallMode){const e=v(a,t),n=y.joinNormals[a];Yh(this.wallVertexArray,n,e),Yh(this.wallVertexArray,n,e)}if(n.vertexLength+=4,this.indexArray.emplaceBack(A+0,A+1,A+2),this.indexArray.emplaceBack(A+1,A+3,A+2),n.primitiveLength+=2,j){const i=e+(1===a?t.length-2:a-2),r=1===a?e:i+1;if(this.indexArray.emplaceBack(A+1,i,A+3),this.indexArray.emplaceBack(i,r,A+3),n.primitiveLength+=2,void 0===l&&(l=A),!op(w,t[a],T)){const e=a===t.length-1?l:n.vertexLength;this.indexArray.emplaceBack(A+2,A+3,e),this.indexArray.emplaceBack(A+3,e+1,e),this.indexArray.emplaceBack(A+3,r,e+1),n.primitiveLength+=3}_=!_}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(p.x,p.y,r),n=u.projectTilePoint(b.x,b.y,r),i=u.upVector(r,p.x,p.y),s=u.upVector(r,b.x,b.y);Xh(e,t,i),Xh(e,t,i),Xh(e,n,s),Xh(e,n,s)}}p&&(e+=t.length-1),g&&j&&this.zoom>=17&&(0!==o.length&&S(o,o[0])&&o.pop(),this.groundEffect.addData(o,T,c,j>0))}this.footprintSegments.push(s),i.triangleCount=this.indexArray.length-i.triangleArrayOffset,this.polygonSegments.push(i),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=m.borders?qh:this.encodeCentroid(m,f),this.centroidData.push(f),m.borders){this.featuresOnBorder.push(m);const e=this.featuresOnBorder.length-1;for(let t=0;t<m.borders.length;t++)m.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,s,a,r,l,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(t,i,s,a,r,l,this.worldview),this.maxHeight=Math.max(this.maxHeight,x)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let a=0;a<this.centroidData.length;a++){const t=this.centroidData[a],n=+(t.min.y+t.max.y>Pi),i=2*n+(+(t.min.x+t.max.x>Pi)^n);for(let r=0;r<t.polygonSegLen;r++){const n=t.polygonSegIdx+r;e.push({centroidIdx:a,subtile:i,polygonSegmentIdx:n,triangleSegmentIdx:this.polygonSegments[n].triangleSegIdx})}}const t=new No;e.sort((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx);let n=0,i=0,r=0;for(const a of e){if(a.triangleSegmentIdx!==n)break;r++}const s=e.length;for(;i!==e.length;){n=e[i].triangleSegmentIdx;let a=0,o=i,l=i;for(let t=o;t<r&&e[t].subtile===a;t++)l++;for(;o!==r;){const i=e[o];a=i.subtile;const s=this.centroidData[i.centroidIdx].min.clone(),c=this.centroidData[i.centroidIdx].max.clone(),d={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let n=o;n<l;n++){const i=e[n],r=this.polygonSegments[i.polygonSegmentIdx],a=this.centroidData[i.centroidIdx].min,o=this.centroidData[i.centroidIdx].max,l=this.indexArray.uint16;for(let e=r.triangleArrayOffset;e<r.triangleArrayOffset+r.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);d.primitiveLength+=r.triangleCount,s.x=Math.min(s.x,a.x),s.y=Math.min(s.y,a.y),c.x=Math.max(c.x,o.x),c.y=Math.max(c.y,o.y)}d.primitiveLength>0&&this.triangleSubSegments.push({segment:d,min:s,max:c}),o=l;for(let t=o;t<r&&e[t].subtile===e[o].subtile;t++)l++}i=r;for(let t=i;t<s&&e[t].triangleSegmentIdx===e[i].triangleSegmentIdx;t++)r++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,n){const i=new tl;if(this.wallMode){for(const e of this.triangleSubSegments)i.segments.push(e.segment);return i}let r=0,s=0;const a=1<<e.canonical.z;if(t){const n=t.getMinMaxForTile(e);n&&(r=n.min,s=n.max)}s+=this.maxHeight;const o=e.toUnwrapped();let l;const c=[o.canonical.x/a+o.wrap,o.canonical.y/a],d=[(o.canonical.x+1)/a+o.wrap,(o.canonical.y+1)/a],u=(e,t,n)=>[e[0]*(1-n[0])+t[0]*n[0],e[1]*(1-n[1])+t[1]*n[1]],h=[],p=[];for(const m of this.triangleSubSegments){h[0]=m.min.x/Pi,h[1]=m.min.y/Pi,p[0]=m.max.x/Pi,p[1]=m.max.y/Pi;const e=u(c,d,h),t=u(c,d,p);if(0===new Vc([e[0],e[1],r],[t[0],t[1],s]).intersectsPrecise(n)){l&&(i.segments.push(l),l=void 0);continue}const a=m.segment;l&&l.vertexOffset!==a.vertexOffset&&(i.segments.push(l),l=void 0),l?(l.vertexLength+=a.vertexLength,l.primitiveLength+=a.primitiveLength):l={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&i.segments.push(l),i}encodeCentroid(e,t){const n=e.centroid(),i=t.span(),r=Math.min(7,Math.round(i.x*this.tileToMeter/10)),s=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new _e(Ae(n.x,1,Pi-1)<<3|r,Ae(n.y,1,Pi-1)<<3|s)}encodeBorderCentroid(e){if(!e.borders)return new _e(0,0);const t=e.borders,n=Number.MAX_VALUE;if(t[0][0]!==n||t[1][0]!==n){const e=t[0][0]!==n?0:1;return new _e(6|(t[0][0]!==n?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==n?2:3;return new _e((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==n?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=2147483647,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,i=e.flags&Wh?qh:e.centroidXY,r=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==i.y||r!==i.x){for(let e=t;e<n;++e)this.centroidVertexArray.emplace(e,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t,n){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped());if(Ah(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const s of this.centroidData)s.flags&=2147483647;const r=[];for(const s of this.activeReplacements){if(s.order<n)continue;const t=Math.max(1,Math.pow(2,s.footprintTileId.canonical.z-e.canonical.z));if(s.footprint.buildingId){const e=s.footprint.buildingId;for(const t of this.centroidData)t.buildingId===e&&(t.flags|=Wh)}else for(const n of this.centroidData)if(!(n.flags&Wh||s.min.x>n.max.x||n.min.x>s.max.x||s.min.y>n.max.y||n.min.y>s.max.y))for(let i=0;i<n.footprintSegLen;i++){const a=this.footprintSegments[n.footprintSegIdx+i];if(r.length=0,pp(this.footprintVertices,a.vertexOffset,a.vertexCount,s.footprintTileId.canonical,e.canonical,r),Ih(s.footprint,r,this.footprintIndices.uint16,a.indexOffset,a.indexCount,-a.vertexOffset,-t)){n.flags|=Wh;break}}}for(const s of this.centroidData)this.writeCentroidToBuffer(s);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,n){let i=!1;for(let r=0;r<n.footprintSegLen;r++){const s=this.footprintSegments[n.footprintSegIdx+r];let a=0;for(const n of s.ringIndices){for(let r=a,o=n+a-1;r<n+a;o=r++){const n=this.footprintVertices.int16[2*(r+s.vertexOffset)+0],a=this.footprintVertices.int16[2*(r+s.vertexOffset)+1],l=this.footprintVertices.int16[2*(o+s.vertexOffset)+1];a>t!=l>t&&e<(this.footprintVertices.int16[2*(o+s.vertexOffset)+0]-n)*(t-a)/(l-a)+n&&(i=!i)}a=n}}return i}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,i=!0;const r=4*(e+Pi)*Pi+(t+Pi);if(this.partLookup.hasOwnProperty(r)){const e=this.partLookup[r];return e?{height:e.height,hidden:!!(e.flags&Wh)}:void 0}for(const s of this.centroidData)e>s.max.x||s.min.x>e||t>s.max.y||s.min.y>t||s.height<=n||this.footprintContainsPoint(e,t,s)&&(n=s.height,this.partLookup[r]=s,i=!!(s.flags&Wh));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:i};this.partLookup[r]=void 0}}function rp(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function sp(e,t,n,i){const r=t.sub(e)._perp()._unit(),s=n.sub(t)._perp()._unit();return ap(e,t,n,rp(r,s),i)}function ap(e,t,n,i,r){const s=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(n)/3,r*s/i)}function op(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function lp(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function cp(e,t,n){if(e.x<0||e.x>=Pi||t.x<0||t.x>=Pi||n.x<0||n.x>=Pi)return!1;const i=n.sub(t),r=i.perp(),s=e.sub(t);return(i.x*s.x+i.y*s.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(s.x*s.x+s.y*s.y))>-.866&&r.x*s.x+r.y*s.y<0}function dp(e,t,n){const i=t?2|e:-3&e;return n?1|i:-2&i}function up(){const e=Math.PI/32,t=Math.tan(e),n=Wl;return n*Math.sqrt(1+2*t*t)-n}function hp(e,t,n){const i=1<<n.z,r=tc(n.x/i),s=tc((n.x+1)/i),a=nc(n.y/i),o=nc((n.y+1)/i);return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0;const a=[];if(!e.length||!n||!i)return a;const o=(e,t)=>{for(const n of e)a.push({polygon:n,bounds:t})},l=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(i)),d=l-c,u=[];for(let m=0;m<Math.abs(d);m++)u.push(d>0?0:1);for(let m=0;m<Math.min(l,c);m++)u.push(0),u.push(1);let h=e;if(h=ih(h,t[0].y-r,t[1].y+r,1),h=ih(h,t[0].x-r,t[1].x+r,0),!h.length)return a;const p=[];for(u.length?p.push({polygons:h,bounds:t,depth:0}):o(h,t);p.length;){const e=p.pop(),t=e.depth,n=u[t],i=e.bounds[0],a=e.bounds[1],l=0===n?i.x:i.y,c=0===n?a.x:a.y,d=s?s(n,l,c):.5*(l+c),h=ih(e.polygons,l-r,d+r,n),m=ih(e.polygons,d-r,c+r,n);if(h.length){const e=[i,new _e(0===n?d:a.x,1===n?d:a.y)];u.length>t+1?p.push({polygons:h,bounds:e,depth:t+1}):o(h,e)}if(m.length){const e=[new _e(0===n?d:i.x,1===n?d:i.y),a];u.length>t+1?p.push({polygons:m,bounds:e,depth:t+1}):o(m,e)}}return a}(e,t,Math.ceil((s-r)/11.25),Math.ceil((a-o)/11.25),1,(e,t,r)=>{if(0===e)return.5*(t+r);{const e=nc((n.y+t/Pi)/i);return($l(.5*(nc((n.y+r/Pi)/i)+e))*i-n.y)*Pi}})}function pp(e,t,n,i,r,s){const a=Math.pow(2,i.z-r.z);for(let o=0;o<n;o++){let n=e.int16[2*(o+t)+0],l=e.int16[2*(o+t)+1];n=(n+r.x*Pi)*a-i.x*Pi,l=(l+r.y*Pi)*a-i.y*Pi,s.push(new _e(n,l))}}let mp,fp;Gs(ip,"FillExtrusionBucket",{omit:["layers","features"]}),Gs(Qh,"PartData"),Gs(Kh,"FootprintSegment"),Gs(Jh,"BorderCentroidData"),Gs(np,"GroundEffect");class gp extends _e{constructor(e,t,n){super(e,t),this.z=n}}class xp extends gp{constructor(e,t,n,i){super(e,t,n),this.w=i}}function yp(e,t,n,i){const r="x"===n?"y":"x",s=(i-e[n])/(t[n]-e[n]);e[r]=Math.round(e[r]+(t[r]-e[r])*s),e[n]=i,e.hasOwnProperty("z")&&(e.z=dn(e.z,t.z,s)),e.hasOwnProperty("w")&&(e.w=dn(e.w,t.w,s))}function vp(e,t,n,i){const r=n,s=i;for(const a of["x","y"]){let n=e,i=t;n[a]>=i[a]&&(n=t,i=e),n[a]<r&&i[a]>r&&yp(n,i,a,r),n[a]<s&&i[a]>s&&yp(i,n,a,s)}}function _p(e,t,n,i,r,s){const a=[];for(let o=0;o<e.length;o++){const l=e[o];let c;const d=a.length;let u=0;for(let e=0;e<l.length-1;e++){let d=l[e],h=l[e+1],p=0;const m=u;let f,g;s&&(p=Math.hypot(h.x-d.x,h.y-d.y),u+=p,f=d,g=h),d.x<t&&h.x<t||(d.x<t?d=new _e(t,d.y+(t-d.x)/(h.x-d.x)*(h.y-d.y))._round():h.x<t&&(h=new _e(t,d.y+(t-d.x)/(h.x-d.x)*(h.y-d.y))._round()),d.y<n&&h.y<n||(d.y<n?d=new _e(d.x+(n-d.y)/(h.y-d.y)*(h.x-d.x),n)._round():h.y<n&&(h=new _e(d.x+(n-d.y)/(h.y-d.y)*(h.x-d.x),n)._round()),d.x>=i&&h.x>=i||(d.x>=i?d=new _e(i,d.y+(i-d.x)/(h.x-d.x)*(h.y-d.y))._round():h.x>=i&&(h=new _e(i,d.y+(i-d.x)/(h.x-d.x)*(h.y-d.y))._round()),d.y>=r&&h.y>=r||(d.y>=r?d=new _e(d.x+(r-d.y)/(h.y-d.y)*(h.x-d.x),r)._round():h.y>=r&&(h=new _e(d.x+(r-d.y)/(h.y-d.y)*(h.x-d.x),r)._round()),c&&d.equals(c[c.length-1])||(c=[d],a.push(c),s&&s.push({progress:{min:m+wp(f,g,d)*p,max:1},parentIndex:o,prevPoint:f,nextPoint:g})),c.push(h),s&&(s[s.length-1].progress.max=m+wp(f,g,h)*p,s[s.length-1].nextPoint=g)))))}if(s&&u>0)for(let e=d;e<a.length;e++)s[e].progress.min/=u,s[e].progress.max/=u}return a}function bp(e,t,n,i,r){if(e.length<2)return void i.push(e);const s=[];for(;t.valid();){const[n,i]=t.get();for(let t=0;t<e.length-1;t++){const r=e[t],a=e[t+1],o=ed(r,a,n,i);if(o){const[e]=o,n=new _e(dn(r.x,a.x,e),dn(r.y,a.y,e));s.push({t:t+e,distance:0,point:n})}}t.next()}if(0===s.length)return void i.push(e);s.sort((e,t)=>e.t-t.t);let a=0,o=0,l=[];for(i.push(l);a!==e.length;){if(o===s.length){for(;a!==e.length;)0!==l.length&&l[l.length-1].equals(e[a])||l.push(e[a]),a++;break}s[o].t<=a?(0!==l.length&&l[l.length-1].equals(s[o].point)||l.push(s[o].point),Math.trunc(s[o].t),o++):(0!==l.length&&l[l.length-1].equals(e[a])||l.push(e[a]),a++)}}function wp(e,t,n){return e.x!==t.x?(n.x-e.x)/(t.x-e.x):e.y!==t.y?(n.y-e.y)/(t.y-e.y):0}function jp(e,t){return e.x*t.x+e.y*t.y}function Np(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const s=t[n],a=e[0],o=r.sub(i),l=s.sub(i),c=a.sub(i),d=jp(o,o),u=jp(o,l),h=jp(l,l),p=jp(c,o),m=jp(c,l),f=d*h-u*u,g=(h*p-u*m)/f,x=(d*m-u*p)/f,y=i.z*(1-g-x)+r.z*g+s.z*x;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function Sp(e,t,n,i,r,s,a,o){const l=a*r.getElevationAt(e,t,!0,!0),c=0!==s[0],d=c?0===s[1]?a*(s[0]/7-450):a*function(e,t,n){const i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),s=10*(t[0]-8*i),a=10*(t[1]-8*r),o=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(s*l-1)),d=Math.floor(.5*(a*l-1)),u=e.tileCoordToPixel(i,r),h=2*c+1,p=2*d+1,m=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,u.x-c,u.y-d,h,p),f=Math.abs(m[0]-m[1]),g=Math.abs(m[2]-m[3]),x=Math.abs(m[0]-m[2])+Math.abs(m[1]-m[3]),y=Math.min(.25,.5*l*(f+g)/h),v=Math.min(.25,.5*l*x/p);return o+Math.max(y*s,v*a)}(r,s,o):l;return{base:l+(0===n?-1:n),top:c?Math.max(d+i,l+n+2):l+i}}class kp{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tp{constructor(){this.tasks={},this.taskQueue=[],Oe(["process"],this),this.invoker=new kp(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function(e){let{type:t,isSymbolTile:n,zoom:i}=e;return i=i||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-i:"maybePrepare"===t&&n?400-i:500:200-i:100-i}(t);if(0===i){try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class Cp{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Oe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Tp}send(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=s,this.callbacks[a]=n);const o=new Set;return this.target.postMessage({id:a,type:e,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:Xs(t,o)},o),{cancel:()=>{n&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data;if(!t)return;const n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||Ze(self)){const e=this.callbacks[n],i=this.scheduler.add(()=>this.processTask(n,t),e&&e.metadata||{type:"message"});i&&(this.cancelCallbacks[n]=i)}else this.processTask(n,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(Ks(t.error)):n(null,Ks(t.data)))}else{const n=new Set,i=t.hasCallback?(t,i)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Xs(t):null,data:Xs(i,n)},n)}:()=>{},r=Ks(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,i);else if(this.parent.getWorkerSource){const e=t.type.split("."),{source:n,scope:s}=r;this.parent.getWorkerSource(t.sourceMapId,e[0],n,s)[e[1]](r,i)}else i(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ep={workerUrl:"",workerClass:null,workerParams:void 0};const Ap="mapboxgl_preloaded_worker_pool";class Mp{constructor(){this.active={}}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mp.workerCount;if(!this.workers)for(this.workers=[];this.workers.length<t;)this.workers.push(null!=Ep.workerClass?new Ep.workerClass:new self.Worker(Ep.workerUrl,Ep.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ap]}numActive(){return Object.keys(this.active).length}}Mp.workerCount=2;class Dp{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Worker",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mp.workerCount;this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Le();const r=this.workerPool.acquire(this.id,i);for(let s=0;s<r.length;s++){const e=new Dp.Actor(r[s],t,this.id);e.name="".concat(n," ").concat(s),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,t,n){Ie(this.actors,(n,i)=>{n.send(e,t,i)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Ip,Pp;function Rp(){return Ip||(Ip=new Mp),Ip}Dp.Actor=Cp;class Lp{constructor(e){this.module=e}createIntArray(e){const t=new Int32Array(e),n=this.module.malloc(t.length*t.BYTES_PER_ELEMENT);return this.module.heap32.set(t,n/t.BYTES_PER_ELEMENT),n}createFloatArray(e){const t=new Float32Array(e),n=this.module.malloc(t.length*t.BYTES_PER_ELEMENT);return this.module.heapF32.set(t,n/t.BYTES_PER_ELEMENT),n}createStringBuffer(e){const t=this.module.malloc(e.length+1);for(let n=0;n<e.length;++n)this.module.heapU8[t+n]=e.charCodeAt(n);return this.module.heapU8[t+e.length]=0,t}readStringBuffer(e){let t="";for(;0!==this.module.heapU8[e];)t+=String.fromCharCode(this.module.heapU8[e]),++e;return t}setStyle(e){const t=e.entranceColorRgb,n=e.facadeGlazingColorRgb,i=e.roofColorRgb,r=e.wallColorRgb,s=e.normalScale;this.module.setStyle(t[0],t[1],t[2],n[0],n[1],n[2],i[0],i[1],i[2],r[0],r[1],r[2],s[0],s[1],s[2],e.tileToMeters)}setAOOptions(e,t){this.module.setAOOptions(e?1:0,t)}setMetricOptions(e,t){this.module.setMetricOptions(e?1:0,t)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,t){this.module.setFacadeOptions(e,t?1:0)}setFauxFacadeOptions(e,t,n){this.module.setFauxFacadeOptions(e?1:0,t?1:0,n)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,t){for(const a of e){const e=this.createStringBuffer(a.roofType),t=[0],n=[];for(const s of a.coordinates)if(Array.isArray(s)){for(const e of s)n.push(e.x),n.push(e.y);t.push(n.length)}const i=this.createIntArray(t),r=this.createFloatArray(n);this.module.addFeature(a.id,a.sourceId,a.minHeight,a.height,e,a.roofType.length,r,i,t.length-1),this.module.free(e),this.module.free(i),this.module.free(r)}for(const a of t){let e;e=a.entrances?JSON.parse(a.entrances):[];const t=this.createFloatArray(e),n=[];for(const r of a.coordinates)n.push(r.x),n.push(r.y);const i=this.createFloatArray(n);this.module.addFacade(a.sourceId,a.crossPerc,a.distanceToRoad,t,e.length,i,n.length),this.module.free(t),this.module.free(i)}if(!this.module.generateMesh()){const e=this.module.getLastError();return this.readStringBuffer(e)}const n=this.module.getMeshCount(),i=new Array(n);for(let a=0;a<n;a++){const e=this.module.getPositionsPtr(a),t=this.module.getPositionsLength(a),n=new Float32Array(this.module.heapF32.buffer,e,t),r=this.module.getNormalsPtr(a),s=this.module.getNormalsLength(a),o=new Float32Array(this.module.heapF32.buffer,r,s),l=this.module.getColorsPtr(a),c=this.module.getColorsLength(a),d=new Uint8Array(this.module.heapU8.buffer,l,c),u=this.module.getAOPtr(a),h=this.module.getAOLength(a),p=new Float32Array(this.module.heapF32.buffer,u,h),m=this.module.getUVPtr(a),f=this.module.getUVLength(a),g=new Float32Array(this.module.heapF32.buffer,m,f),x=this.module.getFauxFacadePtr(a),y=this.module.getFauxFacadeLength(a),v=new Uint8Array(this.module.heapU8.buffer,x,y),_=this.module.getIndicesPtr(a),b=this.module.getIndicesLength(a),w=new Int32Array(this.module.heap32.buffer,_,b),j=this.module.getBuildingPart(a),N=this.readStringBuffer(j);i[a]={positions:n,normals:o,colors:d,ao:p,uv:g,isFauxFacade:v,indices:w,buildingPart:N}}const r=this.module.getRingCount(),s=[];for(let a=0;a<r;a++){const e=this.module.getRingPtr(a),t=this.module.getRingLength(a),n=new Float32Array(this.module.heapF32.buffer,e,t);s.push(n)}return{meshes:i,modifiedPolygonRings:s}}}let zp,Op,Fp,Bp,Vp,Up=null,Hp=null,qp=null,Wp=null;function Gp(){return Ze(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Op||it.DRACO_URL}function Yp(){if(Ze(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Bp)return Bp;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Bp=WebAssembly.validate(e)?it.MESHOPT_SIMD_URL:it.MESHOPT_URL,Bp}function Zp(){return Wp}const Xp={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Kp={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Qp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Jp(e,t,n){const i=n.json.bufferViews.length,r=n.buffers.length;t.bufferView=i,n.json.bufferViews[i]={buffer:r,byteLength:e.byteLength},n.buffers[r]=e}const $p="KHR_draco_mesh_compression";function em(e,t){const n=e.extensions&&e.extensions[$p];if(!n)return;const i=new Fp.Decoder,r=om(t,n.bufferView),s=new Fp.Mesh;if(!i.DecodeArrayToMesh(r,r.byteLength,s))throw new Error("Failed to decode Draco mesh");const a=t.json.accessors[e.indices],o=Xp[a.componentType],l=a.count*o.BYTES_PER_ELEMENT,c=Fp._malloc(l);o===Uint16Array?i.GetTrianglesUInt16Array(s,l,c):i.GetTrianglesUInt32Array(s,l,c),Jp(Fp.memory.buffer.slice(c,c+l),a,t),Fp._free(c);for(const d of Object.keys(n.attributes)){const r=i.GetAttributeByUniqueId(s,n.attributes[d]),a=t.json.accessors[e.attributes[d]],o=Kp[a.componentType],l=a.count*Qp[a.type]*Xp[a.componentType].BYTES_PER_ELEMENT,c=Fp._malloc(l);i.GetAttributeDataArrayForAllPoints(s,r,Fp[o],l,c),Jp(Fp.memory.buffer.slice(c,c+l),a,t),Fp._free(c)}i.destroy(),s.destroy(),delete e.extensions[$p]}const tm="EXT_meshopt_compression";function nm(e,t){if(!e.extensions||!e.extensions[tm])return;const n=e.extensions[tm],i=new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),r=new Uint8Array(n.count*n.byteStride);Vp.decodeGltfBuffer(r,n.count,n.byteStride,i,n.mode,n.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=r.buffer,delete e.extensions[tm]}const im=1179937895,rm=new TextDecoder("utf8");function sm(e,t){return new URL(e,t).href}function am(e,t,n,i){return fetch(sm(e.uri,i)).then(e=>e.arrayBuffer()).then(e=>{t.buffers[n]=e})}function om(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function lm(e,t,n,i){if(e.uri){const r=sm(e.uri,i);return fetch(r).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{t.images[n]=e})}if(void 0!==e.bufferView){const i=om(t,e.bufferView),r=new Blob([i],{type:e.mimeType});return createImageBitmap(r).then(e=>{t.images[n]=e})}}function cm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===im){const n=new Uint32Array(e,t);let r=2;const s=(n[r++]>>2)-3,a=n[r++]>>2;if(r++,i.json=JSON.parse(rm.decode(n.subarray(r,r+a))),r+=a,r<s){const s=n[r++];r++;const a=t+(r<<2);i.buffers[0]=e.slice(a,a+s)}}else i.json=JSON.parse(rm.decode(new Uint8Array(e,t)));const{buffers:r,images:s,meshes:a,extensionsUsed:o,bufferViews:l}=i.json;let c=Promise.resolve();if(r){const e=[];for(let t=0;t<r.length;t++){const s=r[t];s.uri?e.push(am(s,i,t,n)):i.buffers[t]||(i.buffers[t]=null)}c=Promise.all(e)}return c.then(()=>{const e=[],t=o&&o.includes($p),r=o&&o.includes(tm);if(t&&e.push(function(){if(!Fp)return null!=zp?zp:(zp=function(e){let t,n=null;function i(){t=new Uint8Array(n.buffer)}function r(){throw new Error("Unexpected Draco error.")}const s={a:{a:r,d:function(e,n,i){return t.copyWithin(e,n,n+i)},c:function(e){const r=t.length,s=Math.max(e>>>0,Math.ceil(1.2*r)),a=Math.ceil((s-r)/65536);try{return n.grow(a),i(),!0}catch(e){return!1}},b:r}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,s):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,s))).then(e=>{const{Rb:r,Qb:s,P:a,T:o,X:l,Ja:c,La:d,Qa:u,Va:h,Wa:p,eb:m,jb:f,f:g,e:x,yb:y,zb:v,Ab:_,Bb:b,Db:w,Gb:j}=e.instance.exports;n=x;const N=(()=>{let e=0,n=0,i=0,a=0;return o=>{i&&(r(a),r(e),n+=i,i=e=0),e||(n+=128,e=s(n));const l=o.length+7&-8;let c=e;l>=n&&(i=l,c=a=s(l));for(let e=0;e<o.length;e++)t[c+e]=o[e];return c}})();return i(),g(),{memory:x,_free:r,_malloc:s,Mesh:class{constructor(){this.ptr=a()}destroy(){o(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){f(this.ptr)}DecodeArrayToMesh(e,t,n){const i=N(e),r=d(this.ptr,i,t,n.ptr);return!!l(r)}GetAttributeByUniqueId(e,t){return{ptr:u(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,n){h(this.ptr,e.ptr,t,n)}GetTrianglesUInt32Array(e,t,n){p(this.ptr,e.ptr,t,n)}GetAttributeDataArrayForAllPoints(e,t,n,i,r){m(this.ptr,e.ptr,t.ptr,n,i,r)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:_(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:j()}})}(fetch(Gp())),zp.then(e=>{Fp=e,zp=void 0}))}()),r&&e.push(function(){if(Vp)return;const e=function(e){let t;const n=WebAssembly.instantiateStreaming(e,{}).then(e=>{t=e.instance,t.exports.__wasm_call_ctors()}),i={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},r={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:n,supported:!0,decodeGltfBuffer(e,n,s,a,o,l){!function(e,t,n,i,r,s,a){const o=e.exports.sbrk,l=i+3&-4,c=o(l*r),d=o(s.length),u=new Uint8Array(e.exports.memory.buffer);u.set(s,d);const h=t(c,i,r,d,s.length);if(0===h&&a&&a(c,l,r),n.set(u.subarray(c,c+i*r)),o(c-o(0)),0!==h)throw new Error("Malformed buffer data: ".concat(h))}(t,t.exports[r[o]],e,n,s,a,t.exports[i[l]])}}}(fetch(Yp()));return e.ready.then(()=>{Vp=e})}()),s)for(let a=0;a<s.length;a++)e.push(lm(s[a],i,a,n));return(e.length?Promise.all(e):Promise.resolve()).then(()=>{if(t&&a)for(const{primitives:e}of a)for(const t of e)em(t,i);if(r&&a&&l)for(const e of l)nm(e,i);return i})})}function dm(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function um(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class hm{constructor(e,t,n,i){this.context=e,this.format=n,this.useMipmap=i&&i.useMipmap,this.texture=e.gl.createTexture(),this.update(t,{premultiply:i&&i.premultiply})}update(e,t){const n=e&&e instanceof HTMLVideoElement&&0===e.width?e.videoWidth:e.width,i=e&&e instanceof HTMLVideoElement&&0===e.height?e.videoHeight:e.height,{context:r}=this,{gl:s}=r,{x:a,y:o}=t&&t.position?t.position:{x:0,y:0},l=a+n,c=o+i;!this.size||this.size[0]===l&&this.size[1]===c||(s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(this.texture),this.texture=s.createTexture(),this.size=null),s.bindTexture(s.TEXTURE_2D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA8&&(!t||!1!==t.premultiply));const d=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&l>0&&c>0){const e=this.useMipmap?Math.floor(Math.log2(Math.max(l,c)))+1:1;s.texStorage2D(s.TEXTURE_2D,e,this.format,l,c),this.size=[l,c]}if(this.size)if(d)s.texSubImage2D(s.TEXTURE_2D,0,a,o,dm(this.format),um(this.format),e);else{const t=e.data;t&&s.texSubImage2D(s.TEXTURE_2D,0,a,o,n,i,dm(this.format),um(this.format),t)}this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,n,i,r){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),this.wrapS=n),i!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapT=i),r!==this.compareMode&&(r?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_COMPARE_FUNC,r)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_COMPARE_MODE,a.NONE),this.compareMode=r)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pm{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}}const mm=eo([{name:"a_pos_3f",components:3,type:"Float32"}]),fm=eo([{name:"a_color_3f",components:3,type:"Float32"}]),gm=eo([{name:"a_color_4f",components:4,type:"Float32"}]),xm=eo([{name:"a_uv_2f",components:2,type:"Float32"}]),ym=eo([{name:"a_normal_3f",components:3,type:"Float32"}]),vm=eo([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),_m=eo([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function bm(e,t){const n=jm(e.projection,e.zoom,e.width,e.height),i=function(e,t,n,i,r){const s=new Yl(n.lng-180*Nm,n.lat),a=new Yl(n.lng+180*Nm,n.lat),o=e.project(s.lng,s.lat),c=e.project(a.lng,a.lat),u=-Math.atan2(c.y-o.y,c.x-o.x),p=cc.fromLngLat(n);p.y=Ae(p.y,-1+Nm,1-Nm);const m=p.toLngLat(),g=e.project(m.lng,m.lat),x=cc.fromLngLat(m);x.x+=Nm;const y=x.toLngLat(),v=e.project(y.lng,y.lat),_=km(v.x-g.x,v.y-g.y,u),b=cc.fromLngLat(m);b.y+=Nm;const w=b.toLngLat(),j=e.project(w.lng,w.lat),N=km(j.x-g.x,j.y-g.y,u),S=Math.abs(_.x)/Math.abs(N.y),k=l([]);f(k,k,-u*(1-(r?0:i)));const T=l([]);return h(T,T,[1,1-(1-S)*i,1]),T[4]=-N.x/N.y*i,f(T,T,u),d(T,k,T),T}(e.projection,0,e.center,n,t),r=wm(e);return h(i,i,[r,r,1]),i}function wm(e){const t=e.projection,n=jm(e.projection,e.zoom,e.width,e.height),i=Sm(t,e.center),r=Sm(t,Yl.convert(t.center));return Math.pow(2,i*n+(1-n)*r)}function jm(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const s=e.range;if(!s)return 0;const a=Math.min(r,Math.max(n,i)),o=Math.log(a/1024)/Math.LN2;return Me(s[0]+o,s[1]+o,t)}const Nm=1/4e4;function Sm(e,t){const n=Ae(t.lat,-rc,rc),i=new Yl(t.lng-180*Nm,n),r=new Yl(t.lng+180*Nm,n),s=e.project(i.lng,n),a=e.project(r.lng,n),o=cc.fromLngLat(i),l=cc.fromLngLat(r),c=a.x-s.x,d=a.y-s.y,u=l.x-o.x,h=l.y-o.y,p=Math.sqrt((u*u+h*h)/(c*c+d*d));return Math.log(p)/Math.LN2}function km(e,t,n){const i=Math.cos(n),r=Math.sin(n);return{x:e*i-t*r,y:e*r+t*i}}function Tm(e,t,n){l(e),f(e,e,Ne(t[2])),p(e,e,Ne(t[0])),m(e,e,Ne(t[1])),h(e,e,n),d(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Cm(e,t,n,i,r,s,a,o){const l=[n[0]-t[0],n[1]-t[1],0],c=[i[0]-t[0],i[1]-t[1],0];if(w(l)<1e-12||w(c)<1e-12)return J(e);const d=z([],l,c);R(d,d),k(c,i,t),l[2]=(s-r)*o,c[2]=(a-r)*o;const u=l;return z(u,l,c),R(u,u),se(e,d,u)}function Em(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=qd(t.zoom),r=function(e,t,n){const i=t.worldSize,r=[e[12],e[13],e[14]],s=nc(r[1]/i),a=tc(r[0]/i),o=l([]),c=ec(1,s)*i,p=ec(1,0)*i*ac(s,t.zoom),m=1/Vd(i);let f=p*m;if(n){const e=jm(t.projection,t.zoom,t.width,t.height,1024);f=m*t.projection.pixelSpaceConversion(t.center.lat,i,e)}const g=ql(s,a);S(g,g,A([],R([],g),c*f*r[2]));const x=function(e){const t=[e[0],e[1],e[2]];let n=[0,1,0];const i=z([],n,t);return z(n,t,i),0===I(n)&&(n=[0,1,0],z(i,t,n)),R(i,i),R(n,n),R(t,t),[i[0],i[1],i[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(g);h(o,o,[f,f,f*c]),u(o,o,[-r[0],-r[1],-r[2]]);const y=d([],t.globeMatrix,x);return d(y,y,o),d(y,y,e),y}(e,t,n);if(i>0){const n=function(e,t){const n=t.worldSize,i=ec(1,0)*n*ac(t.center.lat,t.zoom)/Vd(n),r=ec(1,t.center.lat)*n,s=l([]);return m(s,s,Ne(t.center.lng)),p(s,s,Ne(t.center.lat)),u(s,s,[0,0,Rl]),h(s,s,[i,i,i*r]),u(s,s,[t.point.x-.5*n,t.point.y-.5*n,0]),d(s,s,e),d(s,t.globeMatrix,s)}(e,t);return function(e,t,n){const i=(e,t,n)=>{const i=w(e),r=w(t),s=Md(e,t,n);return A(s,s,1/w(s)*dn(i,r,n))},r=i([e[0],e[1],e[2]],[t[0],t[1],t[2]],n),s=i([e[4],e[5],e[6]],[t[4],t[5],t[6]],n),a=i([e[8],e[9],e[10]],[t[8],t[9],t[10]],n),o=Md([e[12],e[13],e[14]],[t[12],t[13],t[14]],n);return[r[0],r[1],r[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],0,o[0],o[1],o[2],1]}(r,n,i)}return r}function Am(e,t,n,i){const r=Vc.projectAabbCorners(i,n);let s=Number.MAX_VALUE,a=-1;for(let c=0;c<r.length;++c){const e=r[c];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<s&&(a=c,s=e[2])}const o=e=>new _e(r[e][0],r[e][1]);let l;switch(a){case 0:case 6:l=[o(1),o(5),o(4),o(7),o(3),o(2),o(1)];break;case 1:case 7:l=[o(0),o(4),o(5),o(6),o(2),o(3),o(0)];break;case 3:case 5:l=[o(1),o(0),o(4),o(7),o(6),o(2),o(1)];break;default:l=[o(1),o(5),o(6),o(7),o(3),o(0),o(1)]}if(Yc(e,l))return s}const Mm=64,Dm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Im(e,t,n,i,r,s,a,o,c){let p=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const m=n.zoom,f=n.project(i),g=ac(i.lat,m),x=1/g;l(e),u(e,e,[f.x+a[0]*x,f.y+a[1]*x,a[2]]);let v=1,_=1;const b=n.worldSize;if(p){if("mercator"===n.projection.name){let e=0;n.elevation&&(e=n.elevation.getAtPointOrZero(new cc(f.x/b,f.y/b),0));const t=K([],[f.x,f.y,e,1],n.projMatrix)[3]/n.cameraToCenterDistance;v=t,_=t*ac(n.center.lat,m)}else if("globe"===n.projection.name){const t=Em(e,n),r=[0,0,0,1];K(r,r,d([],n.projMatrix,t));const s=r[3]/n.cameraToCenterDistance,a=qd(m),o=n.projection.pixelsPerMeter(i.lat,b)*ac(i.lat,m),l=n.projection.pixelsPerMeter(n.center.lat,b)*ac(n.center.lat,m);v=s/dn(o,sc(n.center.lat),a),_=s*g/o,v*=l,_*=l}}else v=x;h(e,e,[v,v,_]);const w=[...e],j=t.orientation,N=[];if(Tm(N,[j[0]+r[0],j[1]+r[1],j[2]+r[2]],s),d(e,w,N),o&&n.elevation){let r=0;const s=[];if(c&&n.elevation){r=function(e,t,n,i,r){const s=t.elevation;if(!s)return 0;const a=Vc.projectAabbCorners(n,i),o=ec(1,r.lat)*t.worldSize,l=function(e,t){const n=[0,0,1],i=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const r of i){const i=e[r.corners[0]],s=e[r.corners[1]],a=e[r.corners[2]],o=[s[0]-i[0],s[1]-i[1],t*(s[2]-i[2])],l=z(o,o,[a[0]-i[0],a[1]-i[1],t*(a[2]-i[2])]);R(l,l),r.dotProductWithUp=L(l,n)}return i.sort((e,t)=>e.dotProductWithUp-t.dotProductWithUp),i[0].corners}(a,o),c=a[l[0]],d=a[l[1]],u=a[l[2]],h=a[l[3]],p=s.getAtPointOrZero(new cc(c[0]/t.worldSize,c[1]/t.worldSize),0),m=s.getAtPointOrZero(new cc(d[0]/t.worldSize,d[1]/t.worldSize),0),f=s.getAtPointOrZero(new cc(u[0]/t.worldSize,u[1]/t.worldSize),0),g=s.getAtPointOrZero(new cc(h[0]/t.worldSize,h[1]/t.worldSize),0),x=(p+g)/2,y=(m+f)/2;return x>y?m<f?Cm(e,d,h,c,m,g,p,o):Cm(e,u,c,h,f,p,g,o):p<g?Cm(e,c,d,u,p,m,f,o):Cm(e,h,u,d,g,f,m,o),Math.max(x,y)}(s,n,t.aabb,e,i);const a=d([],y([],s),N);d(e,w,a)}else r=n.elevation.getAtPointOrZero(new cc(f.x/b,f.y/b),0);0!==r&&(e[14]+=r)}}function Pm(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new hm(t,e.image,n?t.gl.R8:t.gl.RGBA8,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function Rm(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,mm.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,ym.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,xm.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?fm:gm).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,_m.members,!0)),e.segments=tl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&Pm(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&Pm(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&Pm(i.normalTexture,t),i.occlusionTexture&&Pm(i.occlusionTexture,t,n),i.emissionTexture&&Pm(i.emissionTexture,t)}function Lm(e,t,n){if(e.meshes)for(const i of e.meshes)Rm(i,t,n);if(e.children)for(const i of e.children)Lm(i,t,n)}function zm(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)zm(t)}function Om(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)Om(n)}function Fm(e,t){const n=e.json.bufferViews[t.bufferView],i=Xp[t.componentType];return new i(e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*(n.byteStride&&n.byteStride!==Qp[t.type]*i.BYTES_PER_ELEMENT?n.byteStride/i.BYTES_PER_ELEMENT:Qp[t.type]))}function Bm(e,t,n,i){const r=Xp[t.componentType],s=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(r),a=e.json.bufferViews[t.bufferView],o=a.byteStride?a.byteStride/r.BYTES_PER_ELEMENT:Qp[t.type],l=n.float32,c=l.length/n.capacity;for(let d=0,u=0;d<t.count*o;d+=o,u+=c)for(let e=0;e<c;e++)l[u+e]=i[d+e]*s;n._trim()}function Vm(e,t,n){const i=e.indices,r=e.attributes,s={};s.indexArray=new No;const a=t.json.accessors[i],o=a.count/3;s.indexArray.reserve(o);const l=Fm(t,a);for(let h=0;h<o;h++)s.indexArray.emplaceBack(l[3*h],l[3*h+1],l[3*h+2]);s.indexArray._trim(),s.vertexArray=new uo;const c=t.json.accessors[r.POSITION];s.vertexArray.reserve(c.count);const d=Fm(t,c);for(let h=0;h<c.count;h++)s.vertexArray.emplaceBack(d[3*h],d[3*h+1],d[3*h+2]);if(s.vertexArray._trim(),s.aabb=new Vc(c.min,c.max),s.centroid=function(e,t){const n=[0,0,0],i=e.length;if(i>0){for(let r=0;r<i;r++){const i=3*e[r];n[0]+=t[i],n[1]+=t[i+1],n[2]+=t[i+2]}n[0]/=i,n[1]/=i,n[2]/=i}return n}(l,d),void 0!==r.COLOR_0){const e=t.json.accessors[r.COLOR_0],n=Qp[e.type],i=Fm(t,e);s.colorArray=3===n?new uo:new xo,s.colorArray.resize(e.count),Bm(t,e,s.colorArray,i)}if(void 0!==r.NORMAL){s.normalArray=new uo;const e=t.json.accessors[r.NORMAL];s.normalArray.resize(e.count);const n=Fm(t,e);Bm(t,e,s.normalArray,n)}if(void 0!==r.TEXCOORD_0&&n.length>0){s.texcoordArray=new Do;const e=t.json.accessors[r.TEXCOORD_0];s.texcoordArray.resize(e.count);const n=Fm(t,e);Bm(t,e,s.texcoordArray,n)}if(void 0!==r._FEATURE_ID_RGBA4444){const e=t.json.accessors[r._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(s.featureData=Fm(t,e))}void 0!==r._FEATURE_RGBA4444&&(s.featureData=new Uint32Array(Fm(t,t.json.accessors[r._FEATURE_RGBA4444]).buffer));const u=e.material;return s.material=function(e,t){const{emissiveFactor:n=[0,0,0],alphaMode:i="OPAQUE",alphaCutoff:r=.5,normalTexture:s,occlusionTexture:a,emissiveTexture:o,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:d=1,roughnessFactor:u=1,baseColorTexture:h,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{},m=a?t[a.index]:void 0;if(a&&a.extensions&&a.extensions.KHR_texture_transform&&m){const e=a.extensions.KHR_texture_transform;m.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new an(...c),metallicFactor:d,roughnessFactor:u,baseColorTexture:h?t[h.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:new an(...n),alphaMode:i,alphaCutoff:r,normalTexture:s?t[s.index]:void 0,occlusionTexture:m,emissionTexture:o?t[o.index]:void 0,defined:void 0===e.defined}}(void 0!==u?t.json.materials[u]:{defined:!1},n),s}function Um(e,t,n){const{matrix:i,rotation:r,translation:s,scale:a,mesh:o,extras:l,children:c}=e,d={};if(d.matrix=i||function(e,t,n,i){var r=t[0],s=t[1],a=t[2],o=t[3],l=r+r,c=s+s,d=a+a,u=r*l,h=r*c,p=r*d,m=s*c,f=s*d,g=a*d,x=o*l,y=o*c,v=o*d,_=i[0],b=i[1],w=i[2];return e[0]=(1-(m+g))*_,e[1]=(h+v)*_,e[2]=(p-y)*_,e[3]=0,e[4]=(h-v)*b,e[5]=(1-(u+g))*b,e[6]=(f+x)*b,e[7]=0,e[8]=(p+y)*w,e[9]=(f-x)*w,e[10]=(1-(u+m))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}([],r||[0,0,0,1],s||[0,0,0],a||[1,1,1]),void 0!==o){d.meshes=n[o];const e=d.anchor=[0,0];for(const t of d.meshes){const{min:n,max:i}=t.aabb;e[0]+=n[0]+i[0],e[1]+=n[1]+i[1]}e[0]=Math.floor(e[0]/d.meshes.length/2),e[1]=Math.floor(e[1]/d.meshes.length/2)}if(l&&(l.id&&(d.id=l.id),l.lights&&(d.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.codePointAt(i);return n}(e),n=[],i=t.length/24,r=new Uint16Array(t.buffer),s=new Float32Array(t.buffer);for(let a=0;a<i;a++){const e=r[2*a*6]/30,t=r[2*a*6+1]/30,i=r[2*a*6+10]/100,o=s[6*a+1],l=s[6*a+2],c=s[6*a+3],d=s[6*a+4],u=c-o,h=d-l,p=Math.hypot(u,h);n.push({pos:[o+.5*u,l+.5*h,t],normal:[h/p,-u/p,0],width:p,height:e,depth:i,points:[o,l,c,d]})}return n}(l.lights))),c){const e=[];for(const i of c)e.push(Um(t.json.nodes[i],t,n));d.children=e}return d}function Hm(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new mh(e.vertices,e.indices,8,256),[n,i]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:n,max:i}}function qm(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const a of n){if(!Array.isArray(a)||2!==a.length)continue;const e=a[0],t=a[1];"number"==typeof e&&"number"==typeof t&&i.push(new _e(e,t))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let r=0;for(let a=0;a<i.length;a++){const e=i[a],t=i[(a+1)%i.length],n=i[(a+2)%i.length];r+=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}r>0&&i.reverse();const s=vu(i.flatMap(e=>[e.x,e.y]),[]);return 0===s.length?null:{vertices:i,indices:s}}function Wm(e,t){const n=[],i=[];let r=0;const s=[];for(const a of e){r=n.length;const e=a.vertexArray.float32,o=a.indexArray.uint16;for(let i=0;i<a.vertexArray.length;i++)s[0]=e[3*i+0],s[1]=e[3*i+1],s[2]=e[3*i+2],F(s,s,t),n.push(new _e(s[0],s[1]));for(let t=0;t<3*a.indexArray.length;t++)i.push(o[t]+r)}if(i.length%3!=0)return null;for(let a=0;a<i.length;a+=3){const e=n[i[a+0]],t=n[i[a+1]],r=n[i[a+2]];(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)>0&&([i[a+1],i[a+2]]=[i[a+2],i[a+1]])}return{vertices:n,indices:i}}function Gm(e){const t=function(e,t){const n=[],i=WebGL2RenderingContext;if(e.json.textures)for(const r of e.json.textures){const s={magFilter:i.LINEAR,minFilter:i.NEAREST,wrapS:i.REPEAT,wrapT:i.REPEAT};void 0!==r.sampler&&Object.assign(s,e.json.samplers[r.sampler]),n.push({image:t[r.source],sampler:s,uploaded:!1})}return n}(e,e.images),n=function(e,t){const n=[];for(const i of e.json.meshes){const r=[];for(const n of i.primitives)r.push(Vm(n,e,t));n.push(r)}return n}(e,t),{scenes:i,scene:r,nodes:s}=e.json,a=i?i[r||0].nodes:s,o=[];for(const l of a)o.push(Um(s[l],e,n));return function(e,t,n){const i={},r=new Set;for(let s=0;s<e.length;s++){const e=n[t[s]];if(!e.extras)continue;const a=e.extras["mapbox:footprint:version"],o=e.extras["mapbox:footprint:id"];(a||o)&&r.add(s),"1.0.0"===a&&o&&(i[o]=s)}for(let s=0;s<e.length;s++){if(r.has(s))continue;const a=e[s],o=n[t[s]];if(!o.extras)continue;let l=null;a.id in i&&(l=Wm(e[i[a.id]].meshes,a.matrix)),l||(l=qm(o)),l&&(a.footprint=Hm(l))}if(r.size>0){const t=Array.from(r.values()).sort((e,t)=>e-t);for(let n=t.length-1;n>=0;n--)e.splice(t[n],1)}}(o,a,e.json.nodes),o}function Ym(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,i=e.aabb.min[1]-1,r=Mm/(e.aabb.max[0]-n+2),s=Mm/(e.aabb.max[1]-i+2);for(let a=0;a<t.length;a+=3){const o=t[a+2],l=(t[a+0]-n)*r|0,c=(t[a+1]-i)*s|0;o>e.heightmap[c*Mm+l]&&(e.heightmap[c*Mm+l]=o)}}function Zm(e,t,n,i,r){n.reserve(n.length+4*e.length),i.reserve(i.length+10*e.length),r.reserve(r.length+10*e.length);let s=i.length;for(const a of e){const e=Math.min(10,Math.max(4,1.3*a.height))*t,o=[-a.normal[1],a.normal[0],0],l=Math.min(.29,.1*a.width/a.depth),c=a.width-2*a.depth*t*(l+.01),d=M([],a.pos,o,c/2),u=M([],a.pos,o,-c/2),h=[d[0],d[1],d[2]+a.height],p=[u[0],u[1],u[2]+a.height],m=M([],a.normal,o,l);A(m,m,e);const f=M([],a.normal,o,-l);A(f,f,e),S(m,d,m),S(f,u,f),d[2]+=.1,u[2]+=.1,i.emplaceBack(m[0],m[1],m[2]),i.emplaceBack(f[0],f[1],f[2]),i.emplaceBack(d[0],d[1],d[2]),i.emplaceBack(u[0],u[1],u[2]),i.emplaceBack(h[0],h[1],h[2]),i.emplaceBack(p[0],p[1],p[2]),i.emplaceBack(d[0],d[1],d[2]),i.emplaceBack(u[0],u[1],u[2]),i.emplaceBack(m[0],m[1],m[2]),i.emplaceBack(f[0],f[1],f[2]);const g=c/e/2;r.emplaceBack(-g-l,-1,g,.8),r.emplaceBack(g+l,-1,g,.8),r.emplaceBack(-g,0,g,1.3),r.emplaceBack(g,0,g,1.3),r.emplaceBack(g+l,-.8,g,.7),r.emplaceBack(g+l,-.8,g,.7),r.emplaceBack(0,0,g,1.3),r.emplaceBack(0,0,g,1.3),r.emplaceBack(g+l,-1.2,g,.8),r.emplaceBack(g+l,-1.2,g,.8),n.emplaceBack(6+s,4+s,8+s),n.emplaceBack(7+s,9+s,5+s),n.emplaceBack(0+s,1+s,2+s),n.emplaceBack(1+s,3+s,2+s),s+=10}}function Xm(e,t){const n={};n.indexArray=new No,n.vertexArray=new uo,n.colorArray=new xo,Zm(e,t,n.indexArray,n.vertexArray,n.colorArray);const i={defined:!0};i.emissiveFactor=an.black;const r={};return r.baseColorFactor=an.white,i.pbrMetallicRoughness=r,n.material=i,n.aabb=new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const Km=eo([{name:"a_pos_3f",components:3,type:"Float32"}]),Qm=eo([{name:"a_normal_3",components:3,type:"Int16"}]),Jm=eo([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),$m=eo([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),ef=vc.types,tf=32767;function nf(e,t){const n=Pi+t;for(const i of e)for(const e of i)if(e.x<-t||e.x>n||e.y<-t||e.y>n)return!1;return!0}class rf{constructor(e){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.layoutVertexArray=new uo,this.layoutNormalArray=new io,this.layoutColorArray=new vo,this.indexArray=new No,this.indexArrayForConflation=new No,this.entranceBloom={layoutVertexArray:new uo,layoutVertexBuffer:null,layoutAttenuationArray:new xo,layoutAttenuationBuffer:null,layoutColorArray:new vo,layoutColorBuffer:null,indexArray:new No,indexArrayForConflation:new No,indexBuffer:null,segmentsBucket:new tl},this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.segmentsBucket=new tl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.groundEffect=new np(e)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(e,t){for(const n of this.footprints)t.push({footprint:n,id:e})}prepare(){return function(){if(null!=Wp||null!=qp)return null;if(null!=Hp)return Hp;const e=fetch(it.BUILDING_GEN_URL);return Hp=function(e){let t,n,i,r;function s(){t=new Uint8Array(r.buffer),n=new Int32Array(r.buffer),i=new Float32Array(r.buffer)}function a(){throw new Error("Unexpected BuildingGen error.")}const o=()=>{},l={a:{a:a,f:function(e){const n=t.length,i=Math.max(e>>>0,Math.ceil(1.2*n)),a=Math.ceil((i-n)/65536);try{return r.grow(a),s(),!0}catch(e){return!1}},g:a,b:o,c:o,d:o,e:o}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,l):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,l))).then(e=>{const a=e.instance.exports;return(0,a.g)(),r=a.f,s(),new Lp({setStyle:a.h,setAOOptions:a.i,setMetricOptions:a.j,setStructuralOptions:a.k,setFacadeOptions:a.l,setFauxFacadeOptions:a.m,setFacadeClassifierOptions:a.n,addFeature:a.o,addFacade:a.p,generateMesh:a.q,getLastError:a.r,getMeshCount:a.s,getPositionsPtr:a.t,getPositionsLength:a.u,getNormalsPtr:a.v,getNormalsLength:a.w,getColorsPtr:a.x,getColorsLength:a.y,getAOPtr:a.z,getAOLength:a.A,getUVPtr:a.B,getUVLength:a.C,getFauxFacadePtr:a.D,getFauxFacadeLength:a.E,getIndicesPtr:a.F,getIndicesLength:a.G,getBuildingPart:a.H,getRingCount:a.I,getRingPtr:a.J,getRingLength:a.K,free:a.L,malloc:a.M,heapU8:t,heap32:n,heapF32:i})})}(e).then(e=>(Hp=null,Wp=e,Wp)).catch(e=>{qe("Could not load building-gen"),Hp=null,qp=e}),Hp}()}populate(e,t,n,i){const r=Zp();if(!r)return;const s=lc(n);this.tileToMeter=s,this.brightness=t.brightness,r.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,s],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:s,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),r.setAOOptions(!1,.3),r.setMetricOptions(!1,16),r.setStructuralOptions(!0),r.setFacadeOptions(4,!0),r.setFauxFacadeOptions(!1,!1,1),r.setFacadeClassifierOptions(3);const a=new Map;for(const{feature:o}of e){if("LineString"!==ef[o.type])continue;const e=this.layers[0]._featureFilter.needGeometry,t=yc(o,e);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom),t,n))continue;const r=e?t.geometry:xc(o,n,i),s=[];for(const n of r)for(const e of n)s.push({x:e.x,y:e.y});const l={coordinates:s,crossPerc:o.properties.cross_perc,distanceToRoad:o.properties.distance_to_road,entrances:o.properties.entrances,sourceId:0},c=o.properties.source_id;let d=a.get(c);d||(d=[],a.set(c,d)),d.push(l)}this.maxHeight=0;for(const{feature:o,index:l}of e){if("LineString"===ef[o.type])continue;const e=this.layers[0]._featureFilter.needGeometry,s=yc(o,e);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom),s,n))continue;const c=e?s.geometry:xc(o,n,i),d=Wu(c,500);if(!nf(c,163))continue;const u=this.layers[0],h=u.layout.get("building-base").evaluate(o,{},n),p=u.layout.get("building-height").evaluate(o,{},n),m=u.layout.get("building-roof-shape").evaluate(o,{},n),f=u.paint.get("building-ambient-occlusion-intensity"),g=u.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if("flat"===m)continue;const x=o.properties.source_id;let y;y=a.has(x)?a.get(x):[];const v=[],_=new _e(1/0,1/0),b=new _e(-1/0,-1/0);for(const t of d)if(t.length>0){const e=[];for(const n of t){const t=[];for(let e=n.length-1;e>=0;e--){const i=n[e];t.push({x:i.x,y:i.y}),_.x=Math.min(_.x,i.x),_.y=Math.min(_.y,i.y),b.x=Math.max(b.x,i.x),b.y=Math.max(b.y,i.y)}e.push(t)}v.push({id:o.id,height:p,minHeight:h,sourceId:0,roofType:m,coordinates:e})}const w=r.generateMesh(v,y);if("string"==typeof w)continue;if(0===w.meshes.length||0===w.modifiedPolygonRings.length)continue;let j=0;for(const t of w.meshes)j+=t.positions.length/3;const N=this.segmentsBucket.prepareSegment(j,this.layoutVertexArray,this.indexArray),S=[];let k=null,T=0,C=-1;const E=this.indexArray.length;let A=0;for(const t of w.meshes){const e=this.layoutVertexArray.length;if("entrance"===t.buildingPart){const e=new Array;for(let s=0;s<t.indices.length;s+=12){const n=t.positions[s+0],i=t.positions[s+1],r=t.positions[s+3],a=t.positions[s+4],o=t.positions[s+2],l=t.positions[s+8]-o,c=1,d=r-n,u=a-i,h=Math.hypot(d,u);e.push({pos:[n+.5*d,i+.5*u,o],normal:[u/h,-d/h,0],width:h,height:l,depth:c,points:[n,i,r,a]})}const n=this.entranceBloom.segmentsBucket.prepareSegment(10*e.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),i=this.entranceBloom.layoutVertexArray.length;T=this.entranceBloom.indexArray.length,Zm(e,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const r=this.entranceBloom.layoutVertexArray.length-i;C=this.entranceBloom.indexArray.length-T;for(let t=0;t<r;t++){const e=65535;this.entranceBloom.layoutColorArray.emplaceBack(e,e)}n.vertexLength+=r,n.primitiveLength+=C,k={part:t.buildingPart,vertexOffset:i,vertexLength:r}}for(let i=0;i<t.positions.length;i+=3)A=Math.max(A,t.positions[i+2]),this.layoutVertexArray.emplaceBack(t.positions[i],t.positions[i+1],t.positions[i+2]);for(let i=0;i<t.normals.length;i+=3)this.layoutNormalArray.emplaceBack(t.normals[i+0]*tf,t.normals[i+1]*tf,t.normals[i+2]*tf);for(let i=0;i<t.ao.length;i++)this.layoutAOArray.push(t.ao[i]);for(let i=0;i<t.colors.length;i+=3){const e=1+(t.ao[i/3]-1)*f;this.layoutColorArray.emplaceBack(t.colors[i]*e<<8|t.colors[i+1]*e,t.colors[i+2]*e<<8)}const n=N.vertexLength;for(let i=0;i<t.indices.length;i+=3)this.indexArray.emplaceBack(n+t.indices[i],n+t.indices[i+1],n+t.indices[i+2]);N.vertexLength+=t.positions.length/3,N.primitiveLength+=t.indices.length/3,("roof"===t.buildingPart||"wall"===t.buildingPart||"facade_glazing"===t.buildingPart||"entrance"===t.buildingPart)&&S.push({part:t.buildingPart,vertexOffset:e,vertexLength:t.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,A),this.buildingFeatures.push({feature:s,segment:N,parts:S,buildingBloom:k});const M=this.indexArray.length-E,D=[],I=[],P=new _e(1/0,1/0),R=new _e(-1/0,-1/0),L=this.groundEffect.vertexArray.length;for(const t of w.modifiedPolygonRings){const e=[],n=new _e(1/0,1/0),i=new _e(-1/0,-1/0);for(let r=0;r<t.length;r+=2){const s=t.length-r-2;n.x=Math.min(n.x,t[s]),n.y=Math.min(n.y,t[s+1]),i.x=Math.max(i.x,t[s]),i.y=Math.max(i.y,t[s+1]);const a=new _e(t[s],t[s+1]);e.push(a),D.push(a.x,a.y),I.push(a.clone())}P.x=Math.min(P.x,n.x),P.y=Math.min(P.y,n.y),R.x=Math.max(R.x,i.x),R.y=Math.max(R.y,i.y),this.groundEffect.addData(e,[n,i],g)}const z=this.groundEffect.vertexArray.length-L;(_.x<0||b.x>Pi||_.y<0||b.y>Pi)&&this.featuresOnBorder.push({featureId:o.id,footprintIndex:this.footprints.length});{const e=vu(D,null,2),t=new mh(I,e,8,256);let n=o.id;o.properties&&o.properties.hasOwnProperty("building_id")&&(n=o.properties.building_id),this.footprints.push({vertices:I,indices:e,grid:t,min:P,max:R,buildingId:n,hiddenFlags:0,indicesOffset:E,indicesLength:M,bloomIndicesOffset:T,bloomIndicesLength:C,groundEffectVertexOffset:L,groundEffectVertexLength:z,segment:N,height:A})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,l,{},t.availableImages,n,t.brightness),this.groundEffect.addPaintPropertiesData(o,l,{},t.availableImages,n,t.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(e,t,n,i,r,s,a){this.programConfigurations.updatePaintArrays(e,t,r,n,i,s,a),this.groundEffect.update(e,t,r,n,i,s,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Km.members),this.layoutNormalBuffer=e.createVertexBuffer(this.layoutNormalArray,Qm.members),this.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(this.entranceBloom.layoutVertexArray,Km.members),this.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,$m.members),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!1;const r=n?t:0,s=0|(n?-1:~t);0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of e){const e=this.footprints[a],t=e.hiddenFlags&s|r;e.hiddenFlags!==t&&(e.hiddenFlags=t,i=!0,this.groundEffect.updateHiddenByLandmarkRange(e.groundEffectVertexOffset,e.groundEffectVertexLength,0!==e.hiddenFlags))}return i&&(this.indexArrayForConflationUploaded=!1),i}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),!this.indexArrayForConflationUploaded&&0!==this.indexArray.length){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const e of this.footprints){const t=e.indicesOffset+e.indicesLength;if(0!==e.hiddenFlags){for(let i=e.indicesOffset;i<t;i++)this.indexArrayForConflation.uint16[3*i+0]=0,this.indexArrayForConflation.uint16[3*i+1]=0,this.indexArrayForConflation.uint16[3*i+2]=0;const n=e.bloomIndicesOffset+e.bloomIndicesLength;for(let t=e.bloomIndicesOffset;t<n;t++)this.entranceBloom.indexArrayForConflation.uint16[3*t+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*t+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*t+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=e.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=e.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(e){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=e.createVertexBuffer(this.layoutColorArray,Jm.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=e.createVertexBuffer(this.entranceBloom.layoutColorArray,Jm.members,!0)}evaluate(e){const t=e.paint.get("building-ambient-occlusion-intensity");for(const n of this.buildingFeatures){const i=n.feature;i.properties["building-part"]="roof";const r=e.paint.get("building-color").evaluate(i,{},this.canonical),s=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);i.properties["building-part"]="wall";const a=e.paint.get("building-color").evaluate(i,{},this.canonical),o=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);i.properties["building-part"]="window";const l=e.paint.get("building-color").evaluate(i,{},this.canonical),c=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);i.properties["building-part"]="door";const d=e.paint.get("building-color").evaluate(i,{},this.canonical),u=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);for(const e of n.parts){let n,i=r;"roof"===e.part?(i=r,n=s):"wall"===e.part?(i=a,n=o):"facade_glazing"===e.part?(i=l,n=c):"entrance"===e.part&&(i=d,n=u),n=Ae(n,0,1);for(let r=0;r<e.vertexLength;r++){const s=e.vertexOffset+r,a=1+(this.layoutAOArray[s]-1)*t;this.layoutColorArray.emplace(s,i.r*a*255<<8|i.g*a*255,i.b*a*255<<8|255*n)}}const h=n.buildingBloom;if(h)for(let e=0;e<h.vertexLength;e++)this.bloomGeometry.layoutColorArray.emplace(h.vertexOffset+e,255*d.r<<8|255*d.g,255*d.b<<8|51*u)}}needsEvaluation(e,t){const n=e.transform.projectionOptions,i=e.style.getBrightness();return!(this.uploaded&&n.name===this.projection.name&&this.brightness===i||(this.projection=n,this.brightness=i,0))}updateReplacement(e,t,n){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped());if(Ah(this.activeReplacements,i))return;this.activeReplacements=i;for(const s of this.footprints)s.hiddenFlags&=-2;const r=[];for(const s of this.activeReplacements){if(s.order<=Sh)continue;const t=Math.max(1,Math.pow(2,s.footprintTileId.canonical.z-e.canonical.z));for(const n of this.footprints)n.min.x>s.max.x||n.max.x<s.min.x||n.min.y>s.max.y||n.max.y<s.min.y||(r.length=0,sf(n.vertices,0,n.vertices.length,s.footprintTileId.canonical,e.canonical,r),Ih(s.footprint,r,n.indices,0,n.indices.length,0,-t)&&(n.hiddenFlags|=1))}0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(s.groundEffectVertexOffset,s.groundEffectVertexLength,0!==s.hiddenFlags);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,i=!0;const r=4*(e+Pi)*Pi+(t+Pi);if(this.footprintLookup.hasOwnProperty(r)){const e=this.footprintLookup[r];return e?{height:e.height,hidden:0!==e.hiddenFlags}:void 0}const s=new _e(e,t);for(const a of this.footprints)e>a.max.x||a.min.x>e||t>a.max.y||a.min.y>t||a.height<=n||Lh(s,a)&&(n=a.height,this.footprintLookup[r]=a,i=0!==a.hiddenFlags);if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:i};this.footprintLookup[r]=void 0}}function sf(e,t,n,i,r,s){const a=Math.pow(2,i.z-r.z);for(let o=0;o<n;o++){let n=e[o+t].x,l=e[o+t].y;n=(n+r.x*Pi)*a-i.x*Pi,l=(l+r.y*Pi)*a-i.y*Pi,s.push(new _e(n,l))}}let af,of;Gs(rf,"BuildingBucket",{omit:["layers"]});const lf=eo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),cf=eo([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:df}=lf,uf=eo([{name:"a_packed",components:3,type:"Float32"}]),{members:hf}=uf,pf=eo([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:mf}=pf;class ff{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new uu({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=ze(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,s=e[0]*n,a=!0;i.push({left:r,right:s,isDash:a,zeroLength:0===e[0]});let o=e[0];for(let l=1;l<e.length;l++){a=!a;const t=e[l];r=o*n,o+=t,s=o*n,i.push({left:r,right:s,isDash:a,zeroLength:0===t})}return i}addRoundDash(e,t,n){const i=t/2;for(let r=-n;r<=n;r++){const t=this.width*(this.nextRow+n+r);let s=0,a=e[s];for(let o=0;o<this.width;o++){o/a.right>1&&(a=e[++s]);const l=Math.abs(o-a.left),c=Math.abs(o-a.right),d=Math.min(l,c);let u;const h=r/n*(i+1);if(a.isDash){const e=i-Math.abs(h);u=Math.sqrt(d*d+e*e)}else u=i-Math.sqrt(d*d+h*h);this.image.data[t+o]=Math.max(0,Math.min(255,u+128))}}}addRegularDash(e,t){for(let o=e.length-1;o>=0;--o){const t=e[o],n=e[o+1];t.zeroLength?e.splice(o,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(o,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let s=0,a=e[s];for(let o=0;o<this.width;o++){o/a.right>1&&(a=e[++s]);const n=Math.abs(o-a.left),i=Math.abs(o-a.right),l=Math.min(n,i);this.image.data[r+o]=Math.max(0,Math.min(255,(a.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,r=i?7:0,s=2*r+1;if(this.nextRow+s>this.height)return qe("LineAtlas out of space"),null;0===e.length&&e.push(1);let a=0;for(let c=0;c<e.length;c++)e[c]<0&&(qe("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),a+=e[c];if(0!==a){const n=this.width/a,s=this.getDashRanges(e,this.width,n);i?this.addRoundDash(s,n,r):this.addRegularDash(s,"square"===t?.5*n:0)}const o=this.nextRow+r;this.nextRow+=s;const l={tl:[o,r],br:[a,0]};return this.positions[n]=l,l}}Gs(ff,"LineAtlas");const gf=vc.types,xf=Math.cos(Math.PI/180*37.5),yf=Math.cos(Math.PI/180*5);class vf{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new co,this.layoutVertexArray2=new uo,this.patternVertexArray=new uo,this.indexArray=new No,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new tl,this.maxLineLength=0,this.zOffsetVertexArray=new uo,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Pi/64,this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){this.hasPattern=Zu("line",this.layers,this.pixelRatio,t);const r=this.layers[0].layout.get("line-sort-key");this.tileToMeter=lc(n);const s=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===s)this.elevationType="road";else{const e=this.layers[0].layout.get("line-z-offset"),t=e.isConstant()&&!e.constantOr(0);this.elevationType="sea"!==s&&"ground"!==s&&t?"none":"offset","offset"===this.elevationType&&"none"===s&&qe("line-elevation-reference: ground is used for the layer ".concat(this.layerIds[0]," because non-zero line-z-offset value was found."))}const a=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==a;const o=[];for(const{feature:u,id:h,index:p,sourceLayerIndex:m}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(u,e);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom,{worldview:this.worldview}),t,n))continue;const s=r?r.evaluate(t,{},n):void 0,a={id:h,properties:u.properties,type:u.type,sourceLayerIndex:m,index:p,geometry:e?t.geometry:xc(u,n,i),patterns:{},sortKey:s};o.push(a)}r&&o.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:l,featureIndex:c}=t,d=this.addConstantDashes(l);for(const u of o){const{geometry:i,index:r,sourceLayerIndex:s}=u;if(d&&this.addFeatureDashes(u,l),this.hasPattern){const e=Xu("line",this.layers,u,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(u,i,r,n,l.positions,t.availableImages,t.brightness,t.elevationFeatures);c.insert(e[r].feature,i,r,s,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,n=i.value;if(!n)continue;e.addDash(n,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,s=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===s.kind)continue;let a,o;if("constant"===r.kind){if(a=r.value,!a)continue}else a=r.evaluate({zoom:n},e);o="constant"===s.kind?s.value:s.evaluate({zoom:n},e),t.addDash(a,o),e.patterns[i.id]=[t.getKey(a,o)]}}update(e,t,n,i,r,s,a,o){this.programConfigurations.updatePaintArrays(e,t,r,n,i,s,a,o)}addFeatures(e,t,n,i,r,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,hf)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,mf)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,cf.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,df),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r,s,a,o){const l=this.layers[0].layout,c=l.get("line-join").evaluate(e,{}),d=l.get("line-cap").evaluate(e,{}),u=l.get("line-miter-limit"),h=l.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=l.get("line-z-offset").value;const p=this.layers[0].paint.get("line-width").value;if("constant"!==p.kind&&!1===p.isLineProgressConstant&&(this.variableWidthValue=p),"road"===this.elevationType){const n=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,t,i,o,c,d,u,h)){const[r,s]=this.clipRuntimeLinesToTile(t,1);for(let t=0;t<r.length;t++){const n=r[t],a=s[t],o={progress:{min:a.progress.min,max:a.progress.max},nextDir:this.computeSegNextDir(a,n),prevDir:this.computeSegPrevDir(a,n)};this.addLine(n,e,i,c,d,u,h,o)}this.fillNonElevatedRoadSegment(n)}}else for(const m of t)this.addLine(m,e,i,c,d,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,s,i,a,void 0,this.worldview)}computeSegNextDir(e,t){return e.nextPoint.sub(t.at(-2)).unit()}computeSegPrevDir(e,t){return t[1].sub(e.prevPoint).unit()}clipLinesToTile(e,t){return _p(e,-t,-t,Pi+t,Pi+t)}clipRuntimeLinesToTile(e,t){const n=[];return[_p(e,-t,-t,Pi+t,Pi+t,n),n]}addElevatedRoadFeature(e,t,n,i,r,s,a,o){const l=[],c=qc.getElevationFeature(e,i);if(c){const e=this.clipLinesToTile(t,1),i=this.prepareElevatedLines(e,c,n);for(const t of i)l.push({geometry:t,elevation:c,elevationTileID:n,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===l.length)return!1;for(const d of l){const t=this.layoutVertexArray.length;this.addLine(d.geometry,e,n,r,s,a,o);const i=new Wc(n,d.elevationTileID);if(d.elevation)for(let e=t;e<this.layoutVertexArray.length;e++){const t=new _e(this.layoutVertexArray.int16[6*e]>>1,this.layoutVertexArray.int16[6*e+1]>>1),n=i.pointElevation(t,d.elevation,.05);this.updateHeightRange(n),this.zOffsetVertexArray.emplaceBack(n,0,0)}else this.fillNonElevatedRoadSegment(t)}return!0}prepareElevatedLines(e,t,n){if(null!=t.constantHeight)return e;const i=[],r=1/lc(n);for(const s of e)bp(s,new Uc(t,r),0,i);return i}fillNonElevatedRoadSegment(e){for(let t=e;t<this.layoutVertexArray.length;t++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,t,n,i,r,s,a,o){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const l="none"===i;this.patternJoinNone=this.hasPattern&&l,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const c=o&&o.progress.min>0,d=o&&o.progress.max<1;if(this.lineClips){let n={min:this.lineClips.start,max:this.lineClips.end},i=1;if(o){const e=this.lineClips.end-this.lineClips.start;n=function(e,t,n){return{min:nt(e.min,t,n),max:nt(e.max,t,n)}}(o.progress,{min:0,max:1},n),e>0&&(i=(n.max-n.min)/e)}const r=+t.properties.mapbox_clip_feature_len,s=+t.properties.mapbox_clip_seg_len;if(Number.isNaN(r)||Number.isNaN(s)){for(let n=0;n<e.length-1;n++)this.totalDistance+=e[n].dist(e[n+1]);const t=this.totalDistance/(n.max-n.min);this.totalFeatureLength=Number.isFinite(t)?t:0,this.lineClips.start=n.min,this.lineClips.end=n.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=r,this.distance=s*i,this.lineClips.start=n.min,this.lineClips.end=n.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const u="Polygon"===gf[t.type];let h=e.length;for(;h>=2&&e[h-1].equals(e[h-2]);)h--;let p=0;for(;p<h-1&&e[p].equals(e[p+1]);)p++;if(h<(u?3:2))return;"bevel"===i&&(s=1.05);const m=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray);let f,g,x,y,v,_,b,w;o&&o.prevDir&&(_=o.prevDir.perp()),o&&o.nextDir&&(b=o.nextDir.perp()),this.e1=this.e2=-1,u&&(f=e[h-2],v=e[p].sub(f)._unit()._perp());for(let j=p;j<h;j++){if(x=j===h-1?u?e[p+1]:void 0:e[j+1],x&&e[j].equals(x))continue;v&&(y=v),f&&(g=f),f=e[j],w=this.evaluateLineProgressFeatures(g?g.dist(f):0),v=x?x.sub(f)._unit()._perp():y,y=y||v;const t=g&&x;let n=t?i:u||l?"butt":r;const o=y.x*v.x+y.y*v.y;if(l){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,n=e.lineSoFar-e.segmentStart;for(let i=0;i<t;++i){const t=e.segmentPoints[2*i+1],r=Math.round(e.segmentPoints[2*i])+.5+.25*t;e.patternVertexArray.emplaceBack(r,n,e.segmentStart),e.patternVertexArray.emplaceBack(r,n,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(t&&o<yf){this.updateDistance(g,f),this.addCurrentVertex(f,y,1,1,m,w),e(this),this.addCurrentVertex(f,v,-1,-1,m,w);continue}if(g){if(!x){this.updateDistance(g,f),this.addCurrentVertex(f,y,1,1,m,w),e(this);continue}n="miter"}}let N=y.add(v);0===N.x&&0===N.y||N._unit();const S=N.x*v.x+N.y*v.y,k=0!==S?1/S:1/0,T=2*Math.sqrt(2-2*S),C=S<xf&&g&&x,E=y.x*v.y-y.y*v.x>0,A=this.overscaling<=16?15*Pi/(512*this.overscaling):0;if(t&&"round"===n)if(k<a)n="miter";else if(k<=2){const e=_f(f,-10,Pi+10);n="offset"===this.elevationType&&(e||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===n&&k>s&&(n="bevel"),"bevel"===n&&(k>2&&(n="flipbevel"),k<s&&(n="miter")),g&&!("miter"===n&&C)&&this.updateDistance(g,f),"miter"===n)if(C){const e=f.dist(g);if(e>2*A){const t=f.sub(f.sub(g)._mult(A/e)._round());this.updateDistance(g,t),this.addCurrentVertex(t,y,0,0,m,w),g=t}this.updateDistance(g,f),N._mult(k),this.addCurrentVertex(f,N,0,0,m,w);const t=f.dist(x);if(t>2*A){const e=f.add(x.sub(f)._mult(A/t)._round());this.updateDistance(f,e),this.addCurrentVertex(e,v,0,0,m,w),f=e}}else N._mult(k),this.addCurrentVertex(f,N,0,0,m,w);else if("flipbevel"===n){if(k>100)N=v.mult(-1);else{const e=k*y.add(v).mag()/y.sub(v).mag();N._perp()._mult(e*(E?-1:1))}this.addCurrentVertex(f,N,0,0,m,w),this.addCurrentVertex(f,N.mult(-1),0,0,m,w)}else if("bevel"===n||"fakeround"===n){null!=w&&g&&this.addCurrentVertex(f,b||y,-1,-1,m,w);const e=f.dist(g)<=2*A&&"bevel"!==n,t=N.mult(E?1:-1);t._mult(k);const i=v.mult(E?-1:1),r=y.mult(E?-1:1),s=this.evaluateLineProgressFeatures(this.distance);if(null==w&&(this.addHalfVertex(f,t.x,t.y,!1,!E,0,m,s),e||this.addHalfVertex(f,t.x+2*r.x,t.y+2*r.y,!1,E,0,m,s)),"fakeround"===n){const e=Math.round(180*T/Math.PI/20);this.addHalfVertex(f,r.x,r.y,!1,E,0,m,s);for(let t=0;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+o*(o*(3.55645-1.43519*o)-3.2452))*e*e+(.848013+o*(.215638*o-1.06021)))}const a=i.sub(r)._mult(n)._add(r)._unit();this.addHalfVertex(f,a.x,a.y,!1,E,0,m,s)}this.addHalfVertex(f,i.x,i.y,!1,E,0,m,s)}e||null!=w||this.addHalfVertex(f,t.x+2*i.x,t.y+2*i.y,!1,E,0,m,s),null!=w&&x&&this.addCurrentVertex(f,_||v,1,1,m,w)}else if("butt"===n)this.addCurrentVertex(f,N,0,0,m,w);else if("square"===n){if(!g){const e=c?0:-1;this.addCurrentVertex(f,N,e,e,m,w)}if(this.addCurrentVertex(f,N,0,0,m,w),g){const e=d?0:1;this.addCurrentVertex(f,N,e,e,m,w)}}else if("round"===n){if(g){const e=!t&&b?b:y;this.addCurrentVertex(f,e,0,0,m,w),!t&&d||this.addCurrentVertex(f,e,1,1,m,w,!0)}if(x){const e=!t&&_?_:v;!t&&c||this.addCurrentVertex(f,e,-1,-1,m,w,!0),this.addCurrentVertex(f,e,0,0,m,w)}}}}addVerticesTo(e,t,n,i,r,s,a,o,l,c){const d=(t.w-e.w)/this.tessellationStep|0;let u=0;const h=this.scaledDistance;if(d>1){this.lineSoFar=e.w;const h=(t.x-e.x)/d,p=(t.y-e.y)/d,m=(t.z-e.z)/d,f=(t.w-e.w)/d;for(let t=1;t<d;++t){e.x+=h,e.y+=p,e.z+=m,this.lineSoFar+=f,u+=f;const t=this.evaluateLineProgressFeatures(this.prevDistance+u);this.scaledDistance=(this.prevDistance+u)/this.totalDistance,this.addHalfVertex(e,n,i,c,!1,a,l,t),this.addHalfVertex(e,r,s,c,!0,-o,l,t)}}this.lineSoFar=t.w,this.scaledDistance=h;const p=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(t,n,i,c,!1,a,l,p),this.addHalfVertex(t,r,s,c,!0,-o,l,p)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):qe("line-progress evaluation for ".concat(this.layerIds[0]," requires enabling 'lineMetrics' for the source."));let t=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(t=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:t}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:t}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:t}}addCurrentVertex(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const o=t.x+t.y*n,l=t.y-t.x*n,c=t.y*i-t.x,d=-t.y-t.x*i;if(null!=s){const t="offset"===this.elevationType,u=-10,h=Pi+10,p=s.zOffset,m=new xp(e.x,e.y,p,this.lineSoFar),f=!!t&&_f(e,u,h),g=this.lineSoFar,x=this.distance;if(this.currentVertex)if(f){const t=this.currentVertexIsOutside,s=this.currentVertex,f=new xp(e.x,e.y,p,this.lineSoFar);if(vp(s,f,u,h),!_f(f,u,h)){if(t){this.e1=this.e2=-1,this.distance-=s.dist(m),this.lineSoFar=s.w;const e=this.evaluateLineProgressFeatures(s.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(s,o,l,a,!1,n,r,e),this.addHalfVertex(s,c,d,a,!0,-i,r,e),this.prevDistance=this.distance}this.distance=this.prevDistance+s.dist(f),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(s,f,o,l,c,d,n,i,r,a),this.distance=x,this.scaledDistance=this.distance/this.totalDistance}}else{const e=this.currentVertex;if(this.currentVertexIsOutside){vp(e,m,u,h),this.e1=this.e2=-1,this.distance-=e.dist(m),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e.w;const t=this.evaluateLineProgressFeatures(e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(e,o,l,a,!1,n,r,t),this.addHalfVertex(e,c,d,a,!0,-i,r,t),this.prevDistance=this.distance,this.distance=x,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(e,m,o,l,c,d,n,i,r,a)}else f||(this.addHalfVertex(e,o,l,a,!1,n,r,s),this.addHalfVertex(e,c,d,a,!0,-i,r,s));this.currentVertex=m,this.currentVertexIsOutside=f,this.lineSoFar=g}else this.addHalfVertex(e,o,l,a,!1,n,r,s),this.addHalfVertex(e,c,d,a,!0,-i,r,s)}addHalfVertex(e,t,n,i,r,s,a,o){let{x:l,y:c}=e;if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),r||this.segmentPoints.push(this.lineSoFar-this.segmentStart,s)),this.layoutVertexArray.emplaceBack((l<<1)+(i?1:0),(c<<1)+(r?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const e=dn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,e)}const d=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,d),a.primitiveLength++),r?this.e2=d:this.e1=d,null!=o&&this.zOffsetVertexArray.emplaceBack(o.zOffset,o.variableWidth,o.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.prevDistance=this.distance,this.distance+=e.dist(t),this.updateScaledDistance()}}function _f(e,t,n){return e.x<t||e.x>n||e.y<t||e.y>n}let bf,wf;function jf(e,t,n){return t*(Pi/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}Gs(vf,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Nf=(e,t,n)=>(1-n)*e+n*t;function Sf(e,t){return 1/jf(e,1,t.tileZoom)}function kf(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Tf=e=>{const t=[];Cf(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const i="none"===e.layout.get("line-join").constantOr("miter"),r=!!e.paint.get("line-pattern").constantOr(1);return i&&r&&t.push("LINE_JOIN_NONE"),t};function Cf(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}let Ef;const Af=()=>Ef||(Ef={layout:bf||(bf=new Ea({"line-cap":new Ta(Aa.layout_line["line-cap"]),"line-join":new Ta(Aa.layout_line["line-join"]),"line-miter-limit":new ka(Aa.layout_line["line-miter-limit"]),"line-round-limit":new ka(Aa.layout_line["line-round-limit"]),"line-sort-key":new Ta(Aa.layout_line["line-sort-key"]),"line-z-offset":new Ta(Aa.layout_line["line-z-offset"]),"line-elevation-reference":new ka(Aa.layout_line["line-elevation-reference"]),"line-cross-slope":new ka(Aa.layout_line["line-cross-slope"]),visibility:new ka(Aa.layout_line.visibility),"line-width-unit":new ka(Aa.layout_line["line-width-unit"])})),paint:wf||(wf=new Ea({"line-opacity":new Ta(Aa.paint_line["line-opacity"]),"line-color":new Ta(Aa.paint_line["line-color"]),"line-translate":new ka(Aa.paint_line["line-translate"]),"line-translate-anchor":new ka(Aa.paint_line["line-translate-anchor"]),"line-width":new Ta(Aa.paint_line["line-width"]),"line-gap-width":new Ta(Aa.paint_line["line-gap-width"]),"line-offset":new Ta(Aa.paint_line["line-offset"]),"line-blur":new Ta(Aa.paint_line["line-blur"]),"line-dasharray":new Ta(Aa.paint_line["line-dasharray"]),"line-pattern":new Ta(Aa.paint_line["line-pattern"]),"line-pattern-cross-fade":new ka(Aa.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ca(Aa.paint_line["line-gradient"]),"line-trim-offset":new ka(Aa.paint_line["line-trim-offset"]),"line-trim-fade-range":new ka(Aa.paint_line["line-trim-fade-range"]),"line-trim-color":new ka(Aa.paint_line["line-trim-color"]),"line-emissive-strength":new ka(Aa.paint_line["line-emissive-strength"]),"line-border-width":new Ta(Aa.paint_line["line-border-width"]),"line-border-color":new Ta(Aa.paint_line["line-border-color"]),"line-occlusion-opacity":new ka(Aa.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},Ef);class Mf extends Ta{possiblyEvaluate(e,t){return t=new xa(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition,worldview:t.worldview}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=Pe({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}let Df;function If(e,t){return t>0?t+2*e:e}const Pf=eo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Rf=eo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Lf=eo([{name:"a_projected_pos",components:4,type:"Float32"}],4);eo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zf=eo([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Of=eo([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Ff=eo([{name:"a_texb",components:2,type:"Uint16"}]),Bf=eo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Vf=eo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);eo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uf=eo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hf=eo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);eo([{name:"triangle",components:3,type:"Uint16"}]),eo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),eo([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),eo([{type:"Float32",name:"offsetX"}]),eo([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var qf=24;function Wf(e,t,n){return e.sections.forEach(e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),ga.applyArabicShaping&&(e=ga.applyArabicShaping(e)),e}(e.text,t,n)}),e}const Gf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Yf(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Zf(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const Xf=4294967296,Kf=1/Xf,Qf="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");let Jf=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<n;){const n=this.readVarint(),i=n>>3,r=this.pos;this.type=7&n,e(i,t,this),this.pos===r&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Xf;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Xf;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let n,i;return i=t[this.pos++],n=127&i,i<128?n:(i=t[this.pos++],n|=(127&i)<<7,i<128?n:(i=t[this.pos++],n|=(127&i)<<14,i<128?n:(i=t[this.pos++],n|=(127&i)<<21,i<128?n:(i=t[this.pos],n|=(15&i)<<28,function(e,t,n){const i=n.buf;let r,s;if(s=i[n.pos++],r=(112&s)>>4,s<128)return $f(e,r,t);if(s=i[n.pos++],r|=(127&s)<<3,s<128)return $f(e,r,t);if(s=i[n.pos++],r|=(127&s)<<10,s<128)return $f(e,r,t);if(s=i[n.pos++],r|=(127&s)<<17,s<128)return $f(e,r,t);if(s=i[n.pos++],r|=(127&s)<<24,s<128)return $f(e,r,t);if(s=i[n.pos++],r|=(1&s)<<31,s<128)return $f(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(n,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Qf?Qf.decode(this.buf.subarray(t,e)):function(e,t,n){let i="",r=t;for(;r<n;){const t=e[r];let s,a,o,l=null,c=t>239?4:t>223?3:t>191?2:1;if(r+c>n)break;1===c?t<128&&(l=t):2===c?(s=e[r+1],128==(192&s)&&(l=(31&t)<<6|63&s,l<=127&&(l=null))):3===c?(s=e[r+1],a=e[r+2],128==(192&s)&&128==(192&a)&&(l=(15&t)<<12|(63&s)<<6|63&a,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(s=e[r+1],a=e[r+2],o=e[r+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(l=(15&t)<<18|(63&s)<<12|(63&a)<<6|63&o,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readVarint(t));return e}readPackedSVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error("Unimplemented type: ".concat(t));this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Kf),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Kf),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(n=~(-e%4294967296),i=~(-e/4294967296),4294967295^n?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){const n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,n){for(let i,r,s=0;s<t.length;s++){if(i=t.charCodeAt(s),i>55295&&i<57344){if(!r){i>56319||s+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);const n=this.pos-t;n>=128&&eg(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let n=0;n<t;n++)this.buf[this.pos++]=e[n]}writeRawMessage(e,t){this.pos++;const n=this.pos;e(t,this);const i=this.pos-n;i>=128&&eg(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i}writeMessage(e,t,n){this.writeTag(e,2),this.writeRawMessage(t,n)}writePackedVarint(e,t){t.length&&this.writeMessage(e,tg,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,ng,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,sg,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,ig,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,rg,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,ag,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,og,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,lg,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,cg,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function $f(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function eg(e,t,n){const i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(let r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function tg(e,t){for(let n=0;n<e.length;n++)t.writeVarint(e[n])}function ng(e,t){for(let n=0;n<e.length;n++)t.writeSVarint(e[n])}function ig(e,t){for(let n=0;n<e.length;n++)t.writeFloat(e[n])}function rg(e,t){for(let n=0;n<e.length;n++)t.writeDouble(e[n])}function sg(e,t){for(let n=0;n<e.length;n++)t.writeBoolean(e[n])}function ag(e,t){for(let n=0;n<e.length;n++)t.writeFixed32(e[n])}function og(e,t){for(let n=0;n<e.length;n++)t.writeSFixed32(e[n])}function lg(e,t){for(let n=0;n<e.length;n++)t.writeFixed64(e[n])}function cg(e,t){for(let n=0;n<e.length;n++)t.writeSFixed64(e[n])}const dg=3;function ug(e,t,n){t.glyphs=[],1===e&&n.readMessage(hg,t)}function hg(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:s,left:a,top:o,advance:l}=n.readMessage(pg,{});t.glyphs.push({id:e,bitmap:new uu({width:r+2*dg,height:s+2*dg},i),metrics:{width:r,height:s,left:a,top:o,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function pg(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const mg=dg,fg={horizontal:1,vertical:2,horizontalOnly:3};class gg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,t){const n=new gg;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new gg;return t.image=e,t}}class xg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t,n){const i=new xg;for(let r=0;r<e.sections.length;r++){const s=e.sections[r];s.image?i.addImageSection(s,n):i.addTextSection(s,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,s=e.charCodeAt(i-1)||null;n+=!t&&(r&&na(r)&&!Gf[e[i+1]]||s&&na(s)&&!Gf[e[i-1]])||!Gf[e[i]]?e[i]:Gf[e[i]]}return n}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&vg[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&vg[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new xg;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(gg.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e,t){const n=e.image?e.image.getPrimary():null;if(!n)return void qe("Can't add FormattedSection with an empty image.");n.scaleSelf(t);const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(gg.forImage(n)),this.sectionIndex.push(this.sections.length-1)):qe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yg(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m){let f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;const g=xg.fromFeature(e,r,f);u===fg.vertical&&g.verticalizePunctuation(h);let x=[];const y=function(e,t,n,i,r,s){if(!e)return[];const a=[],o=function(e,t,n,i,r,s){let a=0;for(let o=0;o<e.length();o++){const n=e.getSection(o);a+=bg(e.getCodePoint(o),n,i,r,t,s)}return a/Math.max(1,Math.ceil(a/n))}(e,t,n,i,r,s),l=e.text.indexOf("\u200b")>=0;let c=0;for(let u=0;u<e.length();u++){const n=e.getSection(u),h=e.getCodePoint(u);if(vg[h]||(c+=bg(h,n,i,r,t,s)),u<e.length()-1){const t=!((d=h)<11904||!(Qs["Bopomofo Extended"](d)||Qs.Bopomofo(d)||Qs["CJK Compatibility Forms"](d)||Qs["CJK Compatibility Ideographs"](d)||Qs["CJK Compatibility"](d)||Qs["CJK Radicals Supplement"](d)||Qs["CJK Strokes"](d)||Qs["CJK Symbols and Punctuation"](d)||Qs["CJK Unified Ideographs Extension A"](d)||Qs["CJK Unified Ideographs"](d)||Qs["Enclosed CJK Letters and Months"](d)||Qs["Halfwidth and Fullwidth Forms"](d)||Qs.Hiragana(d)||Qs["Ideographic Description Characters"](d)||Qs["Kangxi Radicals"](d)||Qs["Katakana Phonetic Extensions"](d)||Qs.Katakana(d)||Qs["Vertical Forms"](d)||Qs["Yi Radicals"](d)||Qs["Yi Syllables"](d)));(_g[h]||t||n.image)&&a.push(Ng(u+1,c,o,a,jg(h,e.getCodePoint(u+1),t&&l),!1))}}var d;return Sg(Ng(e.length(),c,o,a,0,!0))}(g,c,s,t,i,p),{processBidirectionalText:v,processStyledBidirectionalText:_}=ga;if(v&&1===g.sections.length){const e=v(g.toString(),y);for(const t of e){const e=new xg;e.text=t,e.sections=g.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);x.push(e)}}else if(_){const e=_(g.text,g.sectionIndex,y);for(const t of e){const e=new xg;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,x.push(e)}}else x=function(e,t){const n=[],i=e.text;let r=0;for(const s of t)n.push(e.substring(r,s)),r=s;return r<i.length&&n.push(e.substring(r,i.length)),n}(g,y);const b=[],w={positionedLines:b,text:g.toString(),top:d[1],bottom:d[1],left:d[0],right:d[0],writingMode:u,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(e,t,n,i,r,s,a,o,l,c,d,u){let h=0,p=0,m=0;const f="right"===o?1:"left"===o?0:.5;let g=!1;for(const w of r){const e=w.getSections();for(const n of e){if(n.image)continue;const e=t[n.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let x=0;for(const w of r){w.trim();const r=w.getMaxScale(),a=(r-1)*qf,o={positionedGlyphs:[],lineOffset:0};e.positionedLines[x]=o;const v=o.positionedGlyphs;let _=0;if(!w.length()){p+=s,++x;continue}let b=0,j=0;for(let s=0;s<w.length();s++){const a=w.getSection(s),o=w.getSectionIndex(s),m=w.getCodePoint(s);let f=a.scale,x=null,N=null,S=null,k=qf,T=0,C=l;C===fg.vertical&&(12312===(y=m)||12313===y||12316===y||12540===y||12448===y)&&(C=fg.horizontal);const E=!(C===fg.horizontal||!d&&!ta(m)||d&&(vg[m]||ia(m)));if(a.image){const t=i.get(a.image.toString());if(!t)continue;S=a.image,e.iconsInText=e.iconsInText||!0,N=t.paddedRect;const n=t.displaySize;f=f*qf/u,x={width:n[0],height:n[1],left:0,top:-mg,advance:E?n[1]:n[0],localGlyph:!1},T=g?-x.height*f:r*qf-17-n[1]*f,k=x.advance;const s=(E?n[0]:n[1])*f-qf*r;s>0&&s>_&&(_=s)}else{const e=n[a.fontStack];if(!e)continue;e[m]&&(N=e[m]);const i=t[a.fontStack];if(!i)continue;const s=i.glyphs[m];if(!s)continue;if(x=s.metrics,k=8203!==m?qf:0,g){const e=void 0!==i.ascender?Math.abs(i.ascender):0,t=void 0!==i.descender?Math.abs(i.descender):0,n=(e+t)*f;b<n&&(b=n,j=(e-t)/2*f),T=-e*f}else T=(r-f)*qf-17}E?(e.verticalizable=!0,v.push({glyph:m,image:S,x:h,y:p+T,vertical:E,scale:f,localGlyph:x.localGlyph,fontStack:a.fontStack,sectionIndex:o,metrics:x,rect:N}),h+=k*f+c):(v.push({glyph:m,image:S,x:h,y:p+T,vertical:E,scale:f,localGlyph:x.localGlyph,fontStack:a.fontStack,sectionIndex:o,metrics:x,rect:N}),h+=x.advance*f+c)}0!==v.length&&(m=Math.max(h-c,m),g?Tg(v,f,_,j,s*r/2):Tg(v,f,_,0,s/2)),h=0;const N=s*r+_;o.lineOffset=Math.max(_,a),p+=N,++x}var y;const v=p,{horizontalAlign:_,verticalAlign:b}=kg(a);(function(e,t,n,i,r,s){const a=(t-n)*r,o=-s*i;for(const l of e)for(const e of l.positionedGlyphs)e.x+=a,e.y+=o})(e.positionedLines,f,_,b,m,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-_*m,e.right=e.left+m,e.hasBaseline=g}(w,t,n,i,x,a,o,l,u,c,h,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b))return w}const vg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_g={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bg(e,t,n,i,r,s){if(t.image){const e=i.get(t.image.toString());return e?e.displaySize[0]*t.scale*qf/s+r:0}{const i=n[t.fontStack],s=i&&i.glyphs[e];return s?s.metrics.advance*t.scale+r:0}}function wg(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function jg(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Ng(e,t,n,i,r,s){let a=null,o=wg(t,n,r,s);for(const l of i){const e=wg(t-l.x,n,r,s)+l.badness;e<=o&&(a=l,o=e)}return{index:e,x:t,priorBreak:a,badness:o}}function Sg(e){return e?Sg(e.priorBreak).concat(e.index):[]}function kg(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Tg(e,t,n,i,r){if(!(t||n||i||r))return;const s=e.length-1,a=e[s],o=(a.x+a.metrics.advance*a.scale)*t;for(let l=0;l<=s;l++)e[l].x-=o,e[l].y+=n+i+r}function Cg(e){return void 0!==e.imagePrimary&&void 0!==e.top&&void 0!==e.bottom&&void 0!==e.left&&void 0!==e.right}function Eg(e,t,n,i){const{horizontalAlign:r,verticalAlign:s}=kg(i),a=n[0]-e.displaySize[0]*r,o=n[1]-e.displaySize[1]*s;return{imagePrimary:e,imageSecondary:t,top:o,bottom:o+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function Ag(e,t,n,i,r,s){const a=e.imagePrimary;let o;if(a.content){const e=a.content,t=a.pixelRatio||1;o=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}const l=t.left*s,c=t.right*s;let d,u,h,p;"width"===n||"both"===n?(p=r[0]+l-i[3],u=r[0]+c+i[1]):(p=r[0]+(l+c-a.displaySize[0])/2,u=p+a.displaySize[0]);const m=t.top*s,f=t.bottom*s;return"height"===n||"both"===n?(d=r[1]+m-i[0],h=r[1]+f+i[2]):(d=r[1]+(m+f-a.displaySize[1])/2,h=d+a.displaySize[1]),{imagePrimary:a,imageSecondary:void 0,top:d,right:u,bottom:h,left:p,collisionPadding:o}}function Mg(e){return!e.imagePrimary.stretchX}function Dg(e){return!e.imagePrimary.stretchY}function Ig(e){return{width:e.right-e.left,height:e.bottom-e.top}}const Pg=128;function Rg(e,t,n){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new xa(e+1,{worldview:n}))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let s=0;for(;s<t.length&&t[s]<=e;)s++;s=Math.max(0,s-1);let a=s;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const o=t[s],l=t[a];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:l,interpolationType:r}:{kind:"camera",minZoom:o,maxZoom:l,minSize:i.evaluate(new xa(o,{worldview:n})),maxSize:i.evaluate(new xa(l,{worldview:n})),interpolationType:r}}}function Lg(e,t,n){let{uSize:i,uSizeT:r}=t,{lowerSize:s,upperSize:a}=n;return"source"===e.kind?s/Pg:"composite"===e.kind?dn(s/Pg,a/Pg,r):i}function zg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=0,r=0;if("constant"===e.kind)r=e.layoutSize*n;else if("source"!==e.kind){const{interpolationType:s,minZoom:a,maxZoom:o}=e,l=s?Ae(Ur.interpolationFactor(s,t,a,o),0,1):0;"camera"===e.kind?r=dn(e.minSize,e.maxSize,l)*n:i=l*n}return{uSizeT:i,uSize:r}}class Og extends _e{constructor(e,t,n,i,r){super(e,t),this.angle=i,this.z=n,void 0!==r&&(this.segment=r)}clone(){return new Og(this.x,this.y,this.z,this.angle,this.segment)}}function Fg(e,t,n,i,r){if(void 0===t.segment)return!0;let s=t,a=t.segment+1,o=0;for(;o>-n/2;){if(a--,a<0)return!1;o-=e[a].dist(s),s=e[a]}o+=e[a].dist(e[a+1]),a++;const l=[];let c=0;for(;o<n/2;){const t=e[a],n=e[a+1];if(!n)return!1;let s=e[a-1].angleTo(t)-t.angleTo(n);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:o,angleDelta:s}),c+=s;o-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;a++,o+=t.dist(n)}return!0}function Bg(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Vg(e,t,n){return e?.6*t*n:0}function Ug(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Hg(e,t,n,i,r,s){const a=Vg(n,r,s),o=Ug(n,i)*s;let l=0;const c=Bg(e)/2;for(let d=0;d<e.length-1;d++){const n=e[d],i=e[d+1],r=n.dist(i);if(l+r>c){const s=(c-l)/r,u=dn(n.x,i.x,s),h=dn(n.y,i.y,s),p=new Og(u,h,0,i.angleTo(n),d);return!a||Fg(e,p,o,a,t)?p:void 0}l+=r}}function qg(e,t,n,i,r,s,a,o,l){const c=Vg(i,s,a),d=Ug(i,r),u=d*a,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-u<t/4&&(t=u+t/4),Wg(e,h?t/2*o%t:(d/2+2*s)*a*o%t,t,c,n,u,h,!1,l)}function Wg(e,t,n,i,r,s,a,o,l){const c=s/2,d=Bg(e);let u=0,h=t-n,p=[];for(let m=0;m<e.length-1;m++){const t=e[m],a=e[m+1],o=t.dist(a),f=a.angleTo(t);for(;h+n<u+o;){h+=n;const g=(h-u)/o,x=dn(t.x,a.x,g),y=dn(t.y,a.y,g);if(x>=0&&x<l&&y>=0&&y<l&&h-c>=0&&h+c<=d){const t=new Og(x,y,0,f,m);i&&!Fg(e,t,s,i,r)||p.push(t)}}u+=o}return o||p.length||a||(p=Wg(e,u/2,n,i,r,s,a,!0,l)),p}function Gg(e){let t=0,n=0;for(const a of e)t+=a.w*a.h,n=Math.max(n,a.w);e.sort((e,t)=>t.h-e.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,s=0;for(const a of e)for(let e=i.length-1;e>=0;e--){const t=i[e];if(!(a.w>t.w||a.h>t.h)){if(a.x=t.x,a.y=t.y,s=Math.max(s,a.y+a.h),r=Math.max(r,a.x+a.w),a.w===t.w&&a.h===t.h){const t=i.pop();t&&e<i.length&&(i[e]=t)}else a.h===t.h?(t.x+=a.w,t.w-=a.w):a.w===t.w?(t.y+=a.h,t.h-=a.h):(i.push({x:t.x+a.w,y:t.y,w:t.w-a.w,h:a.h}),t.y+=a.h,t.h-=a.h);break}}return{w:r,h:s,fill:t/(r*s)||0}}Gs(Og,"Anchor");const Yg=1;class Zg{static getImagePositionScale(e,t,n){if(t&&e&&e.options&&e.options.transform){const t=e.options.transform;return{x:t.a,y:t.d}}return{x:n,y:n}}constructor(e,t,n,i){this.paddedRect=e;const{pixelRatio:r,version:s,stretchX:a,stretchY:o,content:l,sdf:c,usvg:d}=t;this.pixelRatio=r,this.stretchX=a,this.stretchY=o,this.content=l,this.version=s,this.padding=n,this.sdf=c,this.usvg=d,this.scale=Zg.getImagePositionScale(i,d,r)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Xg(e,t,n){const i=Ln.parse(e),r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1];return{x:0,y:0,w:(e.data?e.data.width:e.width*n[0])+2*t,h:(e.data?e.data.height:e.height*n[1])+2*t}}(t,n,[i.options.transform.a,i.options.transform.d]);return{bin:r,imagePosition:new Zg(r,t,n,i),imageVariant:i}}class Kg{constructor(e,t,n){const i=new Map,r=new Map;this.haveRenderCallbacks=[];const s=[];this.addImages(e,i,Yg,s),this.addImages(t,r,2,s);const{w:a,h:o}=Gg(s),l=new hu({width:a||1,height:o||1});for(const[c,d]of e.entries()){const e=i.get(c).paddedRect;hu.copy(d.data,l,{x:0,y:0},{x:e.x+Yg,y:e.y+Yg},d.data,n,d.sdf)}for(const[c,d]of t.entries()){const e=r.get(c),t=e.paddedRect;let i=e.padding;const s=t.x+i,a=t.y+i,o=d.data.width,u=d.data.height;i=i>1?i-1:i,hu.copy(d.data,l,{x:0,y:0},{x:s,y:a},d.data,n),hu.copy(d.data,l,{x:0,y:u-i},{x:s,y:a-i},{width:o,height:i},n),hu.copy(d.data,l,{x:0,y:0},{x:s,y:a+u},{width:o,height:i},n),hu.copy(d.data,l,{x:o-i,y:0},{x:s-i,y:a},{width:i,height:u},n),hu.copy(d.data,l,{x:0,y:0},{x:s+o,y:a},{width:i,height:u},n),hu.copy(d.data,l,{x:o-i,y:u-i},{x:s-i,y:a-i},{width:i,height:i},n),hu.copy(d.data,l,{x:0,y:u-i},{x:s+o,y:a-i},{width:i,height:i},n),hu.copy(d.data,l,{x:0,y:0},{x:s+o,y:a+u},{width:i,height:i},n),hu.copy(d.data,l,{x:o-i,y:0},{x:s-i,y:a+u},{width:i,height:i},n)}this.lut=n,this.image=l,this.iconPositions=i,this.patternPositions=r}addImages(e,t,n,i){for(const[r,s]of e.entries()){const{bin:e,imagePosition:a,imageVariant:o}=Xg(r,s,n);t.set(r,a),i.push(e),s.hasRenderCallback&&this.haveRenderCallbacks.push(o.id)}}patchUpdatedImages(e,t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(t=>e.hasImage(t,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const i of e.getUpdatedImages(n)){for(const r of this.iconPositions.keys()){const s=Ln.parse(r);if(tn.isEqual(s.id,i)){const s=e.getImage(i,n);this.patchUpdatedImage(this.iconPositions.get(r),s,t)}}for(const r of this.patternPositions.keys()){const s=Ln.parse(r);if(tn.isEqual(s.id,i)){const s=e.getImage(i,n);this.patchUpdatedImage(this.patternPositions.get(r),s,t)}}}}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl,s=e.sdf;if(this.lut||s){const e={width:t.data.width,height:t.data.height},a=new hu(e);hu.copy(t.data,a,{x:0,y:0},{x:0,y:0},e,this.lut,s),n.update(a,{position:{x:i,y:r}})}else n.update(t.data,{position:{x:i,y:r}})}}Gs(Zg,"ImagePosition"),Gs(Kg,"ImageAtlas");const Qg=1e20;function Jg(e,t,n,i,r,s,a,o,l){for(let c=t;c<t+i;c++)$g(e,n*s+c,s,r,a,o,l);for(let c=n;c<n+r;c++)$g(e,c*s+t,1,i,a,o,l)}function $g(e,t,n,i,r,s,a){s[0]=0,a[0]=-Qg,a[1]=Qg,r[0]=e[t];for(let o=1,l=0,c=0;o<i;o++){r[o]=e[t+o*n];const i=o*o;do{const e=s[l];c=(r[o]-r[e]+i-e*e)/(o-e)/2}while(c<=a[l]&&--l>-1);l++,s[l]=o,a[l]=c,a[l+1]=Qg}for(let o=0,l=0;o<i;o++){for(;a[l+1]<o;)l++;const i=s[l],c=o-i;e[t+o*n]=r[i]+c*c}}const ex=2,tx={none:0,ideographs:1,all:2};class nx{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[],i=this.url||it.GLYPHS_URL;for(const r in e)for(const t of e[r])n.push({stack:r,id:t});Ie(n,(e,t)=>{let{stack:n,id:r}=e,s=this.entries[n];s||(s=this.entries[n]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let a=s.glyphs[r];if(void 0!==a)return void t(null,{stack:n,id:r,glyph:a});if(a=this._tinySDF(s,n,r),a)return s.glyphs[r]=a,void t(null,{stack:n,id:r,glyph:a});const o=Math.floor(r/256);if(256*o>65535)return qe("glyphs > 65535 not supported"),void t(null,{stack:n,id:r,glyph:a});if(s.ranges[o])return void t(null,{stack:n,id:r,glyph:a});let l=s.requests[o];l||(l=s.requests[o]=[],nx.loadGlyphRange(n,o,i,this.requestManager,(e,t)=>{if(t){s.ascender=t.ascender,s.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(s.glyphs[+e]=t.glyphs[+e]);s.ranges[o]=!0}for(const n of l)n(e,t);delete s.requests[o]})),l.push((e,i)=>{e?t(e):i&&t(null,{stack:n,id:r,glyph:i.glyphs[r]||null})})},(e,n)=>{if(e)t(e);else if(n){const e={};for(const{stack:t,id:i,glyph:r}of n)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==tx.none&&(this.localGlyphMode===tx.all?!!this.localFontFamily:!!this.localFontFamily&&(Qs["CJK Unified Ideographs"](e)||Qs["Hangul Syllables"](e)||Qs.Hiragana(e)||Qs.Katakana(e)||Qs["CJK Symbols and Punctuation"](e)||Qs["CJK Unified Ideographs Extension A"](e)||Qs["CJK Unified Ideographs Extension B"](e)||Qs.Osage(e)))}_tinySDF(e,t,n){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(n))return;let r=e.tinySDF;if(!r){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),r=e.tinySDF=new nx.TinySDF({fontFamily:i,fontWeight:n,fontSize:24*ex,buffer:3*ex,radius:8*ex}),r.fontWeight=n}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const s=String.fromCodePoint(n),{data:a,width:o,height:l,glyphWidth:c,glyphHeight:d,glyphLeft:u,glyphTop:h,glyphAdvance:p}=r.draw(s);return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new uu({width:o,height:l},a),metrics:{width:c/ex,height:d/ex,left:u/ex,top:h/ex-27,advance:p/ex,localGlyph:!0}}}}nx.loadGlyphRange=function(e,t,n,i,r){const s=256*t,a=s+255,o=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}","".concat(s,"-").concat(a)),Dt.Glyphs);Lt(o,(e,t)=>{if(e)r(e);else if(t){const e={},n=function(e){return new Jf(e).readFields(ug,{})}(t);for(const t of n.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}})},nx.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:s="normal",fontStyle:a="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=i,this.radius=n;const o=this.size=e+4*t,l=this._createCanvas(o),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font="".concat(a," ").concat(s," ").concat(e,"px ").concat(r),c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Uint16Array(o)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:s}=this.ctx.measureText(e),a=Math.ceil(n),o=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-r))),l=Math.min(this.size-this.buffer,a+Math.ceil(i)),c=o+2*this.buffer,d=l+2*this.buffer,u=Math.max(c*d,0),h=new Uint8ClampedArray(u),p={data:h,width:c,height:d,glyphWidth:o,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===o||0===l)return p;const{ctx:m,buffer:f,gridInner:g,gridOuter:x}=this;m.clearRect(f,f,o,l),m.fillText(e,f,f+a);const y=m.getImageData(f,f,o,l);x.fill(Qg,0,u),g.fill(0,0,u);for(let v=0;v<l;v++)for(let e=0;e<o;e++){const t=y.data[4*(v*o+e)+3]/255;if(0===t)continue;const n=(v+f)*c+e+f;if(1===t)x[n]=0,g[n]=Qg;else{const e=.5-t;x[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}Jg(x,0,0,c,d,c,this.f,this.v,this.z),Jg(g,f,f,o,l,c,this.f,this.v,this.z);for(let v=0;v<u;v++){const e=Math.sqrt(x[v])-Math.sqrt(g[v]);h[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const ix=Yg;function rx(e,t){return e+t[1]-t[0]}function sx(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=[],a=e.imagePrimary,o=a.pixelRatio,l=a.paddedRect.w-2*ix,c=a.paddedRect.h-2*ix,d=(e.right-e.left)*r,u=(e.bottom-e.top)*r,h=a.stretchX||[[0,l]],p=a.stretchY||[[0,c]],m=h.reduce(rx,0),f=p.reduce(rx,0),g=l-m,x=c-f;let y=0,v=m,_=0,b=f,w=0,j=g,N=0,S=x;if(a.content&&i){const e=a.content;y=ax(h,0,e[0]),_=ax(p,0,e[1]),v=ax(h,e[0],e[2]),b=ax(p,e[1],e[3]),w=e[0]-y,N=e[1]-_,j=e[2]-e[0]-v,S=e[3]-e[1]-b}const k=(i,s,l,c)=>{const h=lx(i.stretch-y,v,d,e.left*r),p=cx(i.fixed-w,j,i.stretch,m),g=lx(s.stretch-_,b,u,e.top*r),x=cx(s.fixed-N,S,s.stretch,f),k=lx(l.stretch-y,v,d,e.left*r),T=cx(l.fixed-w,j,l.stretch,m),C=lx(c.stretch-_,b,u,e.top*r),E=cx(c.fixed-N,S,c.stretch,f),A=new _e(h,g),M=new _e(k,g),D=new _e(k,C),I=new _e(h,C),P=new _e(p/o,x/o),R=new _e(T/o,E/o),L=t*Math.PI/180;if(L){const e=Math.sin(L),t=Math.cos(L),n=[t,-e,e,t];A._matMult(n),M._matMult(n),I._matMult(n),D._matMult(n)}const z=i.stretch+i.fixed,O=l.stretch+l.fixed,F=s.stretch+s.fixed,B=c.stretch+c.fixed,V=e.imageSecondary;return{tl:A,tr:M,bl:I,br:D,texPrimary:{x:a.paddedRect.x+ix+z,y:a.paddedRect.y+ix+F,w:O-z,h:B-F},texSecondary:V?{x:V.paddedRect.x+ix+z,y:V.paddedRect.y+ix+F,w:O-z,h:B-F}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:P,pixelOffsetBR:R,minFontScaleX:j/o/d,minFontScaleY:S/o/u,isSDF:n}};if(i&&(a.stretchX||a.stretchY)){const e=ox(h,g,m),t=ox(p,x,f);for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)s.push(k(i,t[e],r,t[e+1]))}}else s.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return s}function ax(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function ox(e,t,n){const i=[{fixed:-ix,stretch:0}];for(const[r,s]of e){const e=i[i.length-1];i.push({fixed:r-e.stretch,stretch:e.stretch}),i.push({fixed:r-e.stretch,stretch:e.stretch+(s-r)})}return i.push({fixed:t+ix,stretch:n}),i}function lx(e,t,n,i){return e/t*n+i}function cx(e,t,n,i){return e-t*n/i}function dx(e,t,n,i){const r=t+e.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(t+e.positionedLines[i-1].lineOffset))/2}function ux(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,r=1/0,s=-1/0,a=-1/0;const o=e[0];for(let p=0;p<o.length;p++){const e=o[p];(!p||e.x<i)&&(i=e.x),(!p||e.y<r)&&(r=e.y),(!p||e.x>s)&&(s=e.x),(!p||e.y>a)&&(a=e.y)}const l=Math.min(s-i,a-r);let c=l/2;const d=new Ii([],hx);if(0===l)return new _e(i,r);for(let p=i;p<s;p+=l)for(let t=r;t<a;t+=l)d.push(new px(p+c,t+c,c,e));let u=function(e){let t=0,n=0,i=0;const r=e[0];for(let s=0,a=r.length,o=a-1;s<a;o=s++){const e=r[s],a=r[o],l=e.x*a.y-a.x*e.y;n+=(e.x+a.x)*l,i+=(e.y+a.y)*l,t+=3*l}return new px(n/t,i/t,0,e)}(e),h=d.length;for(;d.length;){const i=d.pop();(i.d>u.d||!u.d)&&(u=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,h)),i.max-u.d<=t||(c=i.h/2,d.push(new px(i.p.x-c,i.p.y-c,c,e)),d.push(new px(i.p.x+c,i.p.y-c,c,e)),d.push(new px(i.p.x-c,i.p.y+c,c,e)),d.push(new px(i.p.x+c,i.p.y+c,c,e)),h+=4)}return n&&(console.log("num probes: ".concat(h)),console.log("best distance: ".concat(u.d))),u.p}function hx(e,t){return t.max-e.max}class px{constructor(e,t,n,i){this.p=new _e(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const s=t[r];for(let t=0,r=s.length,a=r-1;t<r;a=t++){const r=s[t],o=s[a];r.y>e.y!=o.y>e.y&&e.x<(o.x-r.x)*(e.y-r.y)/(o.y-r.y)+r.x&&(n=!n),i=Math.min(i,nd(e,r,o))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const mx=Object.keys,fx=Number.POSITIVE_INFINITY,gx=Math.sqrt(2);function xx(e,t){let[n,i]=t,r=0,s=0;if(i===fx){n<0&&(n=0);const t=n/gx;switch(e){case"top-right":case"top-left":s=t-7;break;case"bottom-right":case"bottom-left":s=7-t;break;case"bottom":s=7-n;break;case"top":s=n-7}switch(e){case"top-right":case"bottom-right":r=-t;break;case"top-left":case"bottom-left":r=t;break;case"left":r=n;break;case"right":r=-n}}else{switch(n=Math.abs(n),i=Math.abs(i),e){case"top-right":case"top-left":case"top":s=i-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-i}switch(e){case"top-right":case"bottom-right":case"right":r=-n;break;case"top-left":case"bottom-left":case"left":r=n}}return[r,s]}function yx(e,t,n,i,r,s,a,o,l){if(!t||!t.usvg)return;const c=Ig(i),d=Ig(r),u="both"!==s&&"width"!==s||!Mg(i)?1:d.width/c.width,h="both"!==s&&"height"!==s||!Dg(i)?1:d.height/c.height;n.scaleSelf(u,h);const p=n.toString();a.set(p,n),o.set(p,t);const{imagePosition:m}=Xg(p,t,Yg);l.set(p,m)}function vx(e,t,n,i,r,s,a,o,l){if(!e)return;const c=function(e,t,n,i,r,s){if("camera"===e.kind)return e.maxSize;if("composite"===e.kind){const i=t.possiblyEvaluate(new xa(e.maxZoom,{worldview:s}),n).evaluate(r,{},n),a=t.possiblyEvaluate(new xa(e.minZoom,{worldview:s}),n).evaluate(r,{},n);return Math.max(i,a)}return t.possiblyEvaluate(new xa(i,{worldview:s})).evaluate(r,{},n)}(t,n,i,r,s,l);return e.scaleSelf(c*o*a)}function _x(e,t,n,i,r,s,a,o,l){return{iconPrimary:vx(e.getPrimary(),t,n,i,r,s,a,o,l),iconSecondary:vx(e.getSecondary(),t,n,i,r,s,a,o,l)}}function bx(e,t,n){if(!t)return;const i=n.get(e.toString()),r=n.get(t.toString());r&&(i.paddedRect.w===r.paddedRect.w&&i.paddedRect.h===r.paddedRect.h||qe("Mismatch in icon variant sizes: ".concat(e.toString()," and ").concat(t.toString())),i.usvg!==r.usvg&&qe("Mismatch in icon variant image types: ".concat(e.id," and ").concat(t.id)))}function wx(e,t,n,i){if(!e)return;const r=t.get(n.toString());if(e.imagePrimary=r,i){const n=t.get(i.toString());e.imageSecondary=n}}function jx(e,t){for(const n in e.horizontal)Nx(e.horizontal[n],t);Nx(e.vertical,t)}function Nx(e,t){if(e)for(const n of e.positionedLines)for(const e of n.positionedGlyphs)if(null!==e.image){const n=e.image.toString();e.rect=t.get(n).paddedRect}}function Sx(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kx(e,t,n,i,r,s,a,o,l){const c=Mx(s.horizontal)||s.vertical,d=n.get("icon-text-fit-padding").evaluate(i,{},r);let u,h=t;return t&&"none"!==l&&(e.allowVerticalPlacement&&s.vertical&&(u=Ag(t,s.vertical,l,d,o,a)),c&&(h=Ag(t,c,l,d,o,a))),{defaultShapedIcon:h,verticallyShapedIcon:u}}function Tx(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v){let _=a.textMaxSize.evaluate(t,{},h);void 0===_?_=o*a.textScaleFactor:_*=a.textScaleFactor;const b=e.layers[0].layout,w=Mx(n.horizontal)||n.vertical,j="globe"===p.name,N=qf,S=e.tilePixelRatio*_/N,k=(D=e.overscaling,e.zoom>18&&D>2&&(D>>=1),Math.max(Pi/(512*D),1)*b.get("symbol-spacing")),T=b.get("text-padding")*e.tilePixelRatio,C=b.get("icon-padding")*e.tilePixelRatio,E=Ne(b.get("text-max-angle")),A="map"===b.get("icon-rotation-alignment")&&"point"!==v,M=k/2;var D;!1===e.hasAnyIconTextFit&&"none"!==g&&(e.hasAnyIconTextFit=!0);const I=t.properties?+t.properties[kc]:null,P=I&&e.elevationFeatureIdToIndex?e.elevationFeatureIdToIndex.get(I):65535,R=(o,l,v)=>{if(l.x<0||l.x>=Pi||l.y<0||l.y>=Pi)return;let _=null;if(j){const{x:e,y:t,z:n}=p.projectTilePoint(l.x,l.y,v);_={anchor:new Og(e,t,n,0,void 0),up:p.upVector(v,l.x,l.y)}}!function(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b,w,j,N,S,k,T,C){const E=e.addToLineVertexArray(t,i);let A,M,D,I,P,R,L,z=0,O=0,F=0,B=0,V=-1,U=-1;const H={};let q=Xt("");const W=n?n.anchor:t,G="none"!==T;let Y=0,Z=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")){const e=l.layout.get("text-offset").evaluate(_,{},N);Y=e[0]*qf,Z=e[1]*qf}else Y=l.layout.get("text-radial-offset").evaluate(_,{},N)*qf,Z=fx;if(e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(m)R=Ix(e),o&&(L=Ix(o));else{const n=l.layout.get("text-rotate").evaluate(_,{},N)+90;D=Dx(c,W,t,d,u,h,e,p,n,f),o&&(I=Dx(c,W,t,d,u,h,o,x,n))}}if(s){const i=e.iconSizeData,r=l.layout.get("icon-rotate").evaluate(_,{},N),a=sx(s,r,w,G,b.iconScaleFactor),p=o?sx(o,r,w,G,b.iconScaleFactor):void 0;M=Dx(c,W,t,d,u,h,s,x,r,null),z=4*a.length;let m=null;"source"===i.kind?(m=[Pg*l.layout.get("icon-size").evaluate(_,{},N)*b.iconScaleFactor],m[0]>Ex&&qe("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Cx,'. Reduce your "icon-size".'))):"composite"===i.kind&&(m=[Pg*b.compositeIconSizes[0].evaluate(_,{},N)*b.iconScaleFactor,Pg*b.compositeIconSizes[1].evaluate(_,{},N)*b.iconScaleFactor],(m[0]>Ex||m[1]>Ex)&&qe("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Cx,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,a,m,v,y,_,void 0,n,t,E.lineStartIndex,E.lineLength,-1,j,N,S,k),V=e.icon.placedSymbolArray.length-1,p&&(O=4*p.length,e.addSymbols(e.icon,p,m,v,y,_,fg.vertical,n,t,E.lineStartIndex,E.lineLength,-1,j,N,S,k),U=e.icon.placedSymbolArray.length-1)}for(const J in r.horizontal){const i=J,s=r.horizontal[i];A||(q=Xt(s.text),m?P=Ix(s):A=Dx(c,W,t,d,u,h,s,p,l.layout.get("text-rotate").evaluate(_,{},N),f));const o=1===s.positionedLines.length;if(F+=Ax(e,n,t,s,a,l,m,_,f,E,r.vertical?fg.horizontal:fg.horizontalOnly,o?mx(r.horizontal):[i],H,V,b,j,N,S),o)break}r.vertical&&(B+=Ax(e,n,t,r.vertical,a,l,m,_,f,E,fg.vertical,["vertical"],H,U,b,j,N,S));let X=-1;const K=(e,t)=>e?Math.max(e,t):t;X=K(P,X),X=K(R,X),X=K(L,X);const Q=X>-1?1:0;e.glyphOffsetArray.length>=65535&&qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==_.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,_.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,W.x,W.y,W.z,H.right>=0?H.right:-1,H.center>=0?H.center:-1,H.left>=0?H.left:-1,H.vertical>=0?H.vertical:-1,V,U,q,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,void 0!==D?D:e.collisionBoxArray.length,void 0!==D?D+1:e.collisionBoxArray.length,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,I||e.collisionBoxArray.length,I?I+1:e.collisionBoxArray.length,d,F,B,z,O,Q,0,Y,Z,X,0,G?1:0,C)}(e,l,_,o,n,i,s,r,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,T,y,c,0,C,A,x,t,a,d,u,h,m,f,g,P)};if("line"===v)for(const L of _p(t.geometry,0,0,Pi,Pi)){const t=qg(L,k,E,n.vertical||w,i,N,S,e.overscaling,Pi);for(const n of t)w&&Px(e,w.text,M,n)||R(L,n,h)}else if("line-center"===v){for(const L of t.geometry)if(L.length>1){const e=Hg(L,E,n.vertical||w,i,N,S);e&&R(L,e,h)}}else if("Polygon"===t.type)for(const L of Wu(t.geometry,0)){const e=ux(L,16);R(L[0],new Og(e.x,e.y,0,0,void 0),h)}else if("LineString"===t.type)for(const L of t.geometry)R(L,new Og(L[0].x,L[0].y,0,0,void 0),h);else if("Point"===t.type)for(const L of t.geometry)for(const e of L)R([e],new Og(e.x,e.y,0,0,void 0),h)}const Cx=255,Ex=Cx*Pg;function Ax(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x){const y=function(e,t,n,i,r,s,a,o){const l=[];if(0===t.positionedLines.length)return l;const c=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,d=function(e){const t=e[0],n=e[1],i=t*n;return i>0?[t,-n]:i<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let u=Math.abs(t.top-t.bottom);for(const f of t.positionedLines)u-=f.lineOffset;const h=t.positionedLines.length,p=u/h;let m=t.top-n[1];for(let f=0;f<h;++f){const e=t.positionedLines[f];m=dx(t,p,m,f);for(const i of e.positionedGlyphs){if(!i.rect)continue;const e=i.rect||{};let s=mg+1,u=!0,h=1,p=0;if(i.image){const e=a.get(i.image.toString());if(!e)continue;if(e.sdf){qe("SDF images are not supported in formatted text and will be ignored.");continue}u=!1,h=e.pixelRatio,s=Yg/h}const f=(r||o)&&i.vertical,g=i.metrics.advance*i.scale/2,x=i.metrics,y=i.rect;if(null===y)continue;o&&t.verticalizable&&(p=i.image?g-i.metrics.width*i.scale/2:0);const v=r?[i.x+g,i.y]:[0,0];let _=[0,0],b=[0,0],w=!1;r||(f?(b=[i.x+g+d[0],i.y+d[1]-p],w=!0):_=[i.x+g+n[0],i.y+n[1]-p]);const j=y.w*i.scale/(h*(i.localGlyph?ex:1)),N=y.h*i.scale/(h*(i.localGlyph?ex:1));let S,k,T,C;if(f){const e=i.y-m,t=new _e(-g,g-e),n=-Math.PI/2,r=new _e(...b);S=new _e(-g+_[0],_[1]),S._rotateAround(n,t)._add(r),S.x+=-e+g,S.y-=(x.left-s)*i.scale;const a=i.image?x.advance*i.scale:qf*i.scale,o=String.fromCodePoint(i.glyph);Yf(o)?S.x+=(1-s)*i.scale:Zf(o)?S.x+=a-x.height*i.scale+(-s-1)*i.scale:S.x+=i.image||x.width+2*s===y.w&&x.height+2*s===y.h?(a-N)/2:(a-(x.height+2*s)*i.scale)/2,k=new _e(S.x,S.y-j),T=new _e(S.x+N,S.y),C=new _e(S.x+N,S.y-j)}else{const e=(x.left-s)*i.scale-g+_[0],t=(-x.top-s)*i.scale+_[1],n=e+j,r=t+N;S=new _e(e,t),k=new _e(n,t),T=new _e(e,r),C=new _e(n,r)}if(c){let e;e=r?new _e(0,0):w?new _e(d[0],d[1]):new _e(n[0],n[1]),S._rotateAround(c,e),k._rotateAround(c,e),T._rotateAround(c,e),C._rotateAround(c,e)}const E=new _e(0,0),A=new _e(0,0);l.push({tl:S,tr:k,bl:T,br:C,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:i.sectionIndex,isSDF:u,pixelOffsetTL:E,pixelOffsetBR:A,minFontScaleX:0,minFontScaleY:0})}}return l}(0,i,l,s,a,o,r,e.allowVerticalPlacement),v=e.textSizeData;let _=null;"source"===v.kind?(_=[Pg*s.layout.get("text-size").evaluate(o,{},g)*m.textScaleFactor],_[0]>Ex&&qe("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Cx,'. Reduce your "text-size".'))):"composite"===v.kind&&(_=[Pg*m.compositeTextSizes[0].evaluate(o,{},g)*m.textScaleFactor,Pg*m.compositeTextSizes[1].evaluate(o,{},g)*m.textScaleFactor],(_[0]>Ex||_[1]>Ex)&&qe("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Cx,'. Reduce your "text-size".'))),e.addSymbols(e.text,y,_,l,a,o,d,t,n,c.lineStartIndex,c.lineLength,p,f,g,x,!1);for(const b of u)h[b]=e.text.placedSymbolArray.length-1;return 4*y.length}function Mx(e){for(const t in e)return e[t];return null}function Dx(e,t,n,i,r,s,a,o,l,c){let d=a.top,u=a.bottom,h=a.left,p=a.right;if(Cg(a)&&a.collisionPadding){const e=a.collisionPadding;h-=e[0],d-=e[1],p+=e[2],u+=e[3]}if(l){const e=new _e(h,d),t=new _e(p,d),n=new _e(h,u),i=new _e(p,u),r=Ne(l);let s=new _e(0,0);c&&(s=new _e(c[0],c[1])),e._rotateAround(r,s),t._rotateAround(r,s),n._rotateAround(r,s),i._rotateAround(r,s),h=Math.min(e.x,t.x,n.x,i.x),p=Math.max(e.x,t.x,n.x,i.x),d=Math.min(e.y,t.y,n.y,i.y),u=Math.max(e.y,t.y,n.y,i.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,h,d,p,u,o,i,r,s),e.length-1}function Ix(e){Cg(e)&&e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Px(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}function Rx(e,t){const n=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),s=Math.sin(n)*r/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01));let a=Math.sin(e._pitch)*s+r;const o=r*(1/e._horizonShift);if(!e.elevation||0===e.elevation.exaggeration()){let t=Math.max(e.zoom-17,0);e.isOrthographic&&(t/=10),a*=1+t}return Math.min(1.01*a,o)}function Lx(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),i=e.x*n,r=(e.x+1)*n,s=e.y*n,a=(e.y+1)*n,o=tc(i),l=tc(r),c=nc(s),d=nc(a),u=t.project(o,c),h=t.project(l,c),p=t.project(l,d),m=t.project(o,d);let f=Math.min(u.x,h.x,p.x,m.x),g=Math.min(u.y,h.y,p.y,m.y),x=Math.max(u.x,h.x,p.x,m.x),y=Math.max(u.y,h.y,p.y,m.y);const v=n/16;function _(e,n,i,r,s,a){const o=(i+s)/2,l=(r+a)/2,c=t.project(tc(o),nc(l)),d=Math.max(0,f-c.x,g-c.y,c.x-x,c.y-y);f=Math.min(f,c.x),x=Math.max(x,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),d>v&&(_(e,c,i,r,o,l),_(c,n,o,l,s,a))}_(u,h,i,s,r,s),_(h,p,r,s,r,a),_(p,m,r,a,i,a),_(m,u,i,a,i,s),f-=v,g-=v,x+=v,y+=v;const b=1/Math.max(x-f,y-g);return{scale:b,x:f*b,y:g*b,x2:x*b,y2:y*b,projection:t}}function zx(e,t){let{x:n,y:i}=t;return new _e(((n-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*Pi,(i*e.scale-e.y)*Pi)}const Ox=l(new Float32Array(16));class Fx{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Yl(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._coordinatePoint(e.locationCoordinate(t,n),i)}pixelsPerMeter(e,t){return ec(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return Rx(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,i){const r=e.horizonLineFromTop(!1),s=new _e(t,Math.max(r,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(s,i))}pointCoordinate3D(e,t,n){const i=new _e(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);{const t=this.pointCoordinate(e,i.x,i.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return Ox}createTileMatrix(e,t,n){let i,r,s;const a=n.canonical,o=l(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Lx(a,this);i=1,r=l.x+n.wrap*l.scale,s=l.y,h(o,o,[i/l.scale,i/l.scale,e.pixelsPerMeter/t])}else i=t/e.zoomScale(a.z),r=(a.x+Math.pow(2,a.z)*n.wrap)*i,s=a.y*i;return u(o,o,[r,s,0]),h(o,o,[i/Pi,i/Pi,1]),o}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class Bx extends Fx{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(Ne(t));this.n=(i+Math.sin(Ne(n)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:n,c:i,r0:r}=this,s=Ne(e-this.center[0]),a=Ne(t),o=Math.sqrt(i-2*n*Math.sin(a))/n;return{x:o*Math.sin(s*n),y:o*Math.cos(s*n)-r,z:0}}unproject(e,t){const{n:n,c:i,r0:r}=this,s=r+t;let a=Math.atan2(e,Math.abs(s))*Math.sign(s);s*n<0&&(a-=Math.PI*Math.sign(e)*Math.sign(s));const o=Ne(this.center[0])*n;a=De(a,-Math.PI-o,Math.PI-o);const l=Ae(Se(a/n)+this.center[0],-180,180),c=Math.asin(Ae((i-(e*e+s*s)*n*n)/(2*n),-1,1)),d=Ae(Se(c),-rc,rc);return new Yl(l,d)}}const Vx=1.340264,Ux=-.081106,Hx=893e-6,qx=.003796,Wx=Math.sqrt(3)/2;class Gx extends Fx{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Wx*Math.sin(t)),i=n*n,r=i*i*i;return{x:.5*(e*Math.cos(n)/(Wx*(Vx+3*Ux*i+r*(7*Hx+9*qx*i)))/Math.PI+.5),y:1-.5*(n*(Vx+Ux*i+r*(Hx+qx*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=n*n,r=i*i*i;for(let c,d,u,h=0;h<12&&(d=n*(Vx+Ux*i+r*(Hx+qx*i))-t,u=Vx+3*Ux*i+r*(7*Hx+9*qx*i),c=d/u,n=Ae(n-c,-Math.PI/3,Math.PI/3),i=n*n,r=i*i*i,!(Math.abs(c)<1e-12));++h);const s=Wx*e*(Vx+3*Ux*i+r*(7*Hx+9*qx*i))/Math.cos(n),a=Math.asin(Math.sin(n)/Wx),o=Ae(180*s/Math.PI,-180,180),l=Ae(180*a/Math.PI,-rc,rc);return new Yl(o,l)}}class Yx extends Fx{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),i=Ae(360*(.5-t),-rc,rc);return new Yl(n,i)}}const Zx=Math.PI/2;function Xx(e){return Math.tan((Zx+e)/2)}class Kx extends Fx{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let i=Ne(t),r=Ne(n);this.southernCenter=i+r<0,this.southernCenter&&(i=-i,r=-r);const s=Math.cos(i),a=Xx(i);this.n=i===r?Math.sin(i):Math.log(s/Math.cos(r))/Math.log(Xx(r)/a),this.f=s*Math.pow(Xx(i),this.n)/this.n}project(e,t){t=Ne(t),this.southernCenter&&(t=-t),e=Ne(e-this.center[0]);const n=1e-6,{n:i,f:r}=this;r>0?t<-Zx+n&&(t=-Zx+n):t>Zx-n&&(t=Zx-n);const s=r/Math.pow(Xx(t),i);let a=s*Math.sin(i*e),o=r-s*Math.cos(i*e);return a=.5*(a/Math.PI+.5),o=.5*(o/Math.PI+.5),{x:a,y:this.southernCenter?o:1-o,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:n,f:i}=this,r=i-t,s=Math.sign(r),a=Math.sign(n)*Math.sqrt(e*e+r*r);let o=Math.atan2(e,Math.abs(r))*s;r*n<0&&(o-=Math.PI*Math.sign(e)*s);const l=Ae(Se(o/n)+this.center[0],-180,180),c=Ae(Se(2*Math.atan(Math.pow(i/a,1/n))-Zx),-rc,rc);return new Yl(l,this.southernCenter?-c:c)}}class Qx extends Fx{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Jl(e),y:$l(t),z:0}}unproject(e,t){const n=tc(e),i=nc(t);return new Yl(n,i)}}const Jx=Ne(rc);class $x extends Fx{project(e,t){const n=(t=Ne(t))*t,i=n*n;return{x:.5*((e=Ne(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=25,r=0,s=n*n;do{s=n*n;const e=s*s;r=(n*(1.007226+s*(.015085+e*(.028874*s-.044475-.005916*e)))-t)/(1.007226+s*(.045255+e*(.259866*s-.311325-.005916*11*e))),n=Ae(n-r,-Jx,Jx)}while(Math.abs(r)>1e-6&&--i>0);s=n*n;const a=Ae(Se(e/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),o=Se(n);return new Yl(a,o)}}const ey=Ne(rc);class ty extends Fx{project(e,t){t=Ne(t),e=Ne(e);const n=Math.cos(t),i=2/Math.PI,r=Math.acos(n*Math.cos(e/2)),s=Math.sin(r)/r,a=.5*(e*i+2*n*Math.sin(e/2)/s)||0,o=.5*(t+Math.sin(t)/s)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(o/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,r=25;const s=1e-6;let a=0,o=0;do{const r=Math.cos(i),s=Math.sin(i),l=2*s*r,c=s*s,d=r*r,u=Math.cos(n/2),h=Math.sin(n/2),p=2*u*h,m=h*h,f=1-d*u*u,g=f?1/f:0,x=f?Math.acos(r*u)*Math.sqrt(1/f):0,y=.5*(2*x*r*h+2*n/Math.PI)-e,v=.5*(x*s+i)-t,_=.5*g*(d*m+x*r*u*c)+1/Math.PI,b=g*(p*l/4-x*s*h),w=.125*g*(l*h-x*s*d*p),j=.5*g*(c*u+x*m*r)+.5,N=b*w-j*_;a=(v*b-y*j)/N,o=(y*w-v*_)/N,n=Ae(n-a,-Math.PI,Math.PI),i=Ae(i-o,-ey,ey)}while((Math.abs(a)>s||Math.abs(o)>s)&&--r>0);return new Yl(Se(n),Se(i))}}class ny extends Fx{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:i}=this;return{x:Ne(e)*i*n+.5,y:-Math.sin(Ne(t))/i*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:i}=this,r=-(t-.5)/n,s=Ae(Se((e-.5)/n)/i,-180,180),a=Math.asin(Ae(r*i,-1,1)),o=Ae(Se(a),-rc,rc);return new Yl(s,o)}}class iy extends Qx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const i=Ld(e,t,n);return F(i,i,Fd(Ad(n))),{x:i[0],y:i[1],z:i[2]}}locationPoint(e,t,n){const i=ql(t.lat,t.lng),r=R([],i),s=n?e._centerAltitude+n:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;M(i,i,r,ec(1,0)*Pi*s);const a=l(new Float64Array(16));return d(a,e.pixelMatrix,e.globeMatrix),F(i,i,a),new _e(i[0],i[1])}pixelsPerMeter(e,t){return ec(1,0)*t}pixelSpaceConversion(e,t,n){const i=ec(1,e)*t,r=dn(ec(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,n){const i=Bd(Ad(n.canonical));return d(new Float64Array(16),e.globeMatrix,i)}createInversionMatrix(e,t){const{center:n}=e,i=Fd(Ad(t));return m(i,i,Ne(n.lng)),p(i,i,Ne(n.lat)),h(i,i,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(i)}pointCoordinate(e,t,n,i){return Td(e,t,n,!0)||new cc(0,0)}pointCoordinate3D(e,t,n){const i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!Td(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const n=e.cameraToCenterDistance,i=e._centerAltitude*t,r=e._camera,s=e._camera.forward(),a=S([],A([],s,-n),[0,0,i]),o=e.worldSize/(2*Math.PI),l=[0,0,-o],c=e.width/e.height,d=Math.tan(e.fovAboveCenter),u=A([],r.up(),d),h=A([],r.right(),d*c),p=R([],S([],S([],s,u),h)),m=[];let f;if(new Pc(a,p).closestPointOnSphere(l,o,m)){const t=S([],m,l),n=q([],t,a);f=Math.cos(e.fovAboveCenter)*w(n)}else{const e=q([],a,l),t=q([],l,a);R(t,t);const n=w(e)-o;f=Math.sqrt(n*(n+2*o));const i=Math.acos(f/(o+n))-Math.acos(L(s,t));f*=Math.cos(i)}return 1.01*f}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=qd(e.zoom);if(n>0){const i=Rx(e,ec(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),s=Math.max(e.width,e.height)/e.worldSize*Math.PI;return dn(t,i+r*(1-Math.cos(s)),Math.pow(n,10))}return t}upVector(e,t,n){return Ld(t,n,e,1)}upVectorScale(e){return{metersToTile:Sd(zd(Ad(e)))}}}function ry(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Qx(e);case"equirectangular":return new Yx(e);case"naturalEarth":return new $x(e);case"equalEarth":return new Gx(e);case"winkelTripel":return new ty(e);case"albers":return n?new ny(e):new Bx(e);case"lambertConformalConic":return n?new ny(e):new Kx(e);case"globe":return new iy(e)}throw new Error("Invalid projection name: ".concat(e.name))}const sy=vc.types,ay=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oy(e,t,n,i,r,s,a,o,l,c,d,u,h){const p=o?Math.min(Ex,Math.round(o[0])):0,m=o?Math.min(Ex,Math.round(o[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),s,a,(p<<1)+(l?1:0),m,16*c,16*d,256*u,256*h)}function ly(e,t,n){e.emplaceBack(t,n)}function cy(e,t,n,i,r,s,a){e.emplaceBack(t,n,i,r,s,a)}const dy=(e,t,n,i)=>{for(let r=0;r<t;r++)e.emplaceBack(n[0],n[1],n[2],i[0],i[1],i[2])};function uy(e,t,n,i,r){e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r)}function hy(e){for(const t of e.sections)if(aa(t.text))return!0;return!1}class py{constructor(e){this.layoutVertexArray=new fo,this.indexArray=new No,this.programConfigurations=e,this.segments=new tl,this.dynamicLayoutVertexArray=new xo,this.opacityVertexArray=new yo,this.placedSymbolArray=new Uo,this.iconTransitioningVertexArray=new vo,this.globeExtVertexArray=new go,this.zOffsetVertexArray=new so,this.orientationVertexArray=new To}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,n,i,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Lf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ay,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Ff.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Rf.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||r)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,zf.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Of.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Gs(py,"SymbolBuffers");class my{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new tl,this.collisionVertexArray=new jo,this.collisionVertexArrayExt=new xo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Bf.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Vf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gs(my,"CollisionBuffers");class fy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=l([]),this.placementViewportMatrix=l([]);const t=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Rg(this.zoom,t["text-size"],this.worldview),this.iconSizeData=Rg(this.zoom,t["icon-size"],this.worldview);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(e=>fg[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new py(new El(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new py(new El(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Wo,this.lineVertexArray=new Go,this.symbolInstances=new qo}calculateGlyphDependencies(e,t,n,i,r){for(const s of e){const e=s.codePointAt(0);if(void 0===e)break;if(t[e]=!0,i&&r&&e<=65535){const e=Gf[s];e&&(t[e.charCodeAt(0)]=!0)}}}updateFootprints(e,t){}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ah(this.activeReplacements,n)&&(this.activeReplacements=n,!0)}populate(e,t,n,i){const r=this.layers[0],s=r.layout,a="globe"===this.projection.name,o=s.get("text-font"),l=s.get("text-field"),c=s.get("icon-image"),[d,u]=s.get("icon-size-scale-range"),h=Ae(t.scaleFactor||1,d,u),p=("constant"!==l.value.kind||l.value.value instanceof Rn&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),m="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,f=s.get("symbol-sort-key");if(this.features=[],!p&&!m)return;const g=t.iconDependencies,x=t.glyphDependencies,y=t.availableImages,v=new xa(this.zoom,{worldview:this.worldview});for(const{feature:_,id:b,index:w,sourceLayerIndex:j}of e){const e=r._featureFilter.needGeometry,t=yc(_,e);if(!r._featureFilter.filter(v,t,n))continue;if(e||(t.geometry=xc(_,n,i)),a&&1!==_.type&&n.z<=5){const e=t.geometry,i=.98078528056,r=(e,t)=>L(Ld(e.x,e.y,n,1),Ld(t.x,t.y,n,1))<i;for(let t=0;t<e.length;t++)e[t]=pc(e[t],r)}let l,c;if(p){const e=r.getValueAndResolveTokens("text-field",t,n,y),i=Rn.factory(e);hy(i)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ma()||this.hasRTLText&&ga.isParsed())&&(l=Wf(i,r,t))}if(m){const e=r.getValueAndResolveTokens("icon-image",t,n,y);c="string"==typeof e?zn.build(e):e}if(!l&&!c)continue;const d=this.sortFeaturesByKey?f.evaluate(t,{},n):void 0,u={id:b,text:l,icon:c,index:w,sourceLayerIndex:j,geometry:t.geometry,properties:_.properties,type:sy[_.type],sortKey:d};if(this.features.push(u),c){const e=this.layers[0]._unevaluatedLayout._values,{iconPrimary:t,iconSecondary:i}=_x(c,this.iconSizeData,e["icon-size"],n,this.zoom,u,this.pixelRatio,h,this.worldview),r=t.id.toString();if(g.has(r)?g.get(r).push(t):g.set(r,[t]),i){this.hasAnySecondaryIcon=!0;const e=i.id.toString();g.has(e)?g.get(e).push(i):g.set(e,[i])}}if(l){const e=o.evaluate(t,{},n).join(","),i="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fg.vertical)>=0;for(const t of l.sections)if(t.image){const e=t.image.getPrimary().scaleSelf(this.pixelRatio),n=e.id.toString(),i=g.get(n)||[];i.push(e),g.set(n,i)}else{const n=Js(l.toString()),r=t.fontStack||e,s=x[r]=x[r]||{};this.calculateGlyphDependencies(t.text,s,i,this.allowVerticalPlacement,n)}}}if("line"===s.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function s(t){i.push(e[t]),r++}function a(e,t,r){const s=n[e];return delete n[e],n[t]=s,i[s].geometry[0].pop(),i[s].geometry[0]=i[s].geometry[0].concat(r[0]),s}function o(e,n,r){const s=t[n];return delete t[n],t[e]=s,i[s].geometry[0].shift(),i[s].geometry[0]=r[0].concat(i[s].geometry[0]),s}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(i.x,":").concat(i.y)}for(let c=0;c<e.length;c++){const d=e[c],u=d.geometry,h=d.text?d.text.toString():null;if(!h){s(c);continue}const p=l(h,u),m=l(h,u,!0);if(p in n&&m in t&&n[p]!==t[m]){const e=o(p,m,u),r=a(p,m,i[e].geometry);delete t[p],delete n[m],n[l(h,i[r].geometry,!0)]=r,i[e].geometry=null}else p in n?a(p,m,u):m in t?o(p,m,u):(s(c),t[p]=r-1,n[m]=r-1)}return i.filter(e=>e.geometry)}(this.features)),"hd-road-markup"===s.get("symbol-elevation-reference")){if(this.elevationType="road",t.elevationFeatures){!this.elevationFeatures&&t.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const e of t.elevationFeatures)this.elevationFeatureIdToIndex.set(e.id,this.elevationFeatures.length),this.elevationFeatures.push(e)}}else s.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}update(e,t,n,i,r,s,a){this.text.programConfigurations.updatePaintArrays(e,t,r,n,i,s,a,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,t,r,n,i,s,a,this.worldview)}updateRoadElevation(e){if("road"!==this.elevationType||!this.elevationFeatures)return;if(this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let t=!1;const n=lc(e),i=1/n;let r=!1,s=!1;for(let a=0;a<this.symbolInstances.length;a++){const e=this.symbolInstances.get(a),o=j(1,0,0),l=j(0,1,0),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:d,numIconVertices:u,numVerticalIconVertices:h}=e,p=c>0||d>0,m=u>0,f=this.elevationFeatures[e.elevationFeatureIndex];if(f){const a=new _e(e.tileAnchorX,e.tileAnchorY),c=.075+f.pointElevation(a);e.zOffset!==c&&(t=!0,e.zOffset=c);const d=f.computeSlopeNormal(a,i),u=se(Q(),j(0,0,1),d);V(o,o,u),V(l,l,u),o[2]*=n,l[2]*=n,1===o[0]&&0===o[1]&&0===o[2]&&0===l[0]&&1===l[1]&&0===l[2]||(r=r||p,s=s||m)}if(p&&(dy(this.text.orientationVertexArray,c,o,l),dy(this.text.orientationVertexArray,d,o,l)),m){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:n}=e;t>=0&&dy(this.icon.orientationVertexArray,u,o,l),n>=0&&dy(this.icon.orientationVertexArray,h,o,l)}}r||(this.text.orientationVertexArray=void 0),s||(this.icon.orientationVertexArray=void 0),t&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(e,t,i)=>{n+=t,n>e.length&&e.resize(n);for(let r=-t;r<0;r++)e.emplace(r+n,i)},t=(e,t,n)=>{i+=t,i>e.length&&e.resize(i);for(let r=-t;r<0;r++)e.emplace(r+i,n)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,i=0;for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:s,numIconVertices:a}=n,o=n.zOffset,l=a>0;if((i>0||s>0)&&(e(this.text.zOffsetVertexArray,i,o),e(this.text.zOffsetVertexArray,s,o)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=n;e>=0&&t(this.icon.zOffsetVertexArray,a,o),i>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,o)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ry(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:i,y:r}of t)this.lineVertexArray.emplaceBack(i,r);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f){const g=e.indexArray,x=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,x,g,this.canOverlap?s.sortKey:void 0),_=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&a===fg.vertical?Math.PI/2:0,j=s.text&&s.text.sections;for(let S=0;S<t.length;S++){const{tl:i,tr:r,bl:a,br:c,texPrimary:d,texSecondary:u,pixelOffsetTL:_,pixelOffsetBR:b,minFontScaleX:N,minFontScaleY:k,glyphOffset:T,isSDF:C,sectionIndex:E}=t[S],A=v.vertexLength,M=T[1];if(oy(x,l.x,l.y,i.x,M+i.y,d.x,d.y,n,C,_.x,_.y,N,k),oy(x,l.x,l.y,r.x,M+r.y,d.x+d.w,d.y,n,C,b.x,_.y,N,k),oy(x,l.x,l.y,a.x,M+a.y,d.x,d.y+d.h,n,C,_.x,b.y,N,k),oy(x,l.x,l.y,c.x,M+c.y,d.x+d.w,d.y+d.h,n,C,b.x,b.y,N,k),o){const{x:t,y:n,z:i}=o.anchor,[r,s,a]=o.up;cy(y,t,n,i,r,s,a),cy(y,t,n,i,r,s,a),cy(y,t,n,i,r,s,a),cy(y,t,n,i,r,s,a),uy(e.dynamicLayoutVertexArray,t,n,i,w)}else uy(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(f){const t=u||d;ly(e.iconTransitioningVertexArray,t.x,t.y),ly(e.iconTransitioningVertexArray,t.x+t.w,t.y),ly(e.iconTransitioningVertexArray,t.x,t.y+t.h),ly(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(A,A+1,A+2),g.emplaceBack(A+1,A+2,A+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),S!==t.length-1&&E===t[S+1].sectionIndex||e.programConfigurations.populatePaintArrays(x.length,s,s.index,{},h,p,m,j&&j[E],this.worldview)}const N=o?o.anchor:l;e.placedSymbolArray.emplaceBack(N.x,N.y,N.z,l.x,l.y,_,this.glyphOffsetArray.length-_,b,c,d,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],a,0,0,0,u,0)}_commitLayoutVertex(e,t,n,i,r,s,a){e.emplaceBack(t,n,i,r,s,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,n,i,r,s,a){const o=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=o.vertexLength,c=a.tileAnchorX,d=a.tileAnchorY;for(let h=0;h<4;h++)n.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,t,e.padding,a.zOffset),this._commitLayoutVertex(n.layoutVertexArray,i,r,s,c,d,new _e(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,s,c,d,new _e(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,s,c,d,new _e(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,r,s,c,d,new _e(e.x1,e.y2)),o.vertexLength+=4;const u=n.indexArray;u.emplaceBack(l,l+1),u.emplaceBack(l+1,l+2),u.emplaceBack(l+2,l+3),u.emplaceBack(l+3,l),o.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,r,s){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceTextSize(e,s,t,a);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(e,t,n,i,r,s){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceIconSize(e,t,s.placedIconSymbolIndex);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,s)}}generateCollisionDebugBuffers(e,t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new my(bo,Uf.members,vo),this.iconCollisionBox=new my(bo,Uf.members,vo);const i=zg(this.iconSizeData,e),r=zg(this.textSizeData,e,n);for(let s=0;s<this.symbolInstances.length;s++){const n=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(r,e,t,n.textBoxStartIndex,n.textBoxEndIndex,n),this._addTextDebugCollisionBoxes(r,e,t,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n),this._addIconDebugCollisionBoxes(i,e,t,n.iconBoxStartIndex,n.iconBoxEndIndex,n),this._addIconDebugCollisionBoxes(i,e,t,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n)}}getSymbolInstanceTextSize(e,t,n,i){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),s=Lg(this.textSizeData,e,r)/qf;return this.tilePixelRatio*s}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),r=Lg(this.iconSizeData,e,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,n,i){e.emplaceBack(t,-n,-n,i),e.emplaceBack(t,n,-n,i),e.emplaceBack(t,n,n,i),e.emplaceBack(t,-n,n,i)}_updateTextDebugCollisionBoxes(e,t,n,i,r,s,a){for(let o=i;o<r;o++){const i=n.get(o),r=this.getSymbolInstanceTextSize(e,s,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding,s.zOffset)}}_updateIconDebugCollisionBoxes(e,t,n,i,r,s,a){for(let o=i;o<r;o++){const i=n.get(o),r=this.getSymbolInstanceIconSize(e,t,s.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding,s.zOffset)}}updateCollisionDebugBuffers(e,t,n,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=zg(this.iconSizeData,e,i),s=zg(this.textSizeData,e,n);for(let a=0;a<this.symbolInstances.length;a++){const o=this.symbolInstances.get(a);this._updateTextDebugCollisionBoxes(s,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o,n),this._updateTextDebugCollisionBoxes(s,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,n),this._updateIconDebugCollisionBoxes(r,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o,i),this._updateIconDebugCollisionBoxes(r,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,i)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,s,a,o,l){const c={};if(t<n){const{x1:n,y1:i,x2:r,y2:s,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h,featureIndex:p}=e.get(t);c.textBox={x1:n,y1:i,x2:r,y2:s,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h},c.textFeatureIndex=p}if(i<r){const{x1:t,y1:n,x2:r,y2:s,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h,featureIndex:p}=e.get(i);c.verticalTextBox={x1:t,y1:n,x2:r,y2:s,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h},c.verticalTextFeatureIndex=p}if(s<a){const{x1:t,y1:n,x2:i,y2:r,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h,featureIndex:p}=e.get(s);c.iconBox={x1:t,y1:n,x2:i,y2:r,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h},c.iconFeatureIndex=p}if(o<l){const{x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h,featureIndex:p}=e.get(o);c.verticalIconBox={x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:d,tileAnchorX:u,tileAnchorY:h},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)e.indexArray.emplaceBack(r,r+1,r+2),e.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],s=[];for(let a=0;a<this.symbolInstances.length;++a){s.push(a);const e=this.symbolInstances.get(a);i.push(0|Math.round(t*e.tileAnchorX+n*e.tileAnchorY)),r.push(e.featureIndex)}return s.sort((e,t)=>i[e]-i[t]||r[t]-r[e]),s}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:s,placedIconSymbolIndex:a,verticalPlacedIconSymbolIndex:o}=t;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&r!==n&&this.addIndicesForPlacedSymbol(this.text,r),s>=0&&this.addIndicesForPlacedSymbol(this.text,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gy,xy,yy;Gs(fy,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fy.addDynamicAttributes=uy;class vy{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gs(vy,"FormatSectionOverride",{omit:["defaultValue"]});const _y=()=>yy||(yy={layout:gy||(gy=new Ea({"symbol-placement":new ka(Aa.layout_symbol["symbol-placement"]),"symbol-spacing":new ka(Aa.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ka(Aa.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ta(Aa.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ka(Aa.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ka(Aa.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ka(Aa.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ka(Aa.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ka(Aa.layout_symbol["icon-ignore-placement"]),"icon-optional":new ka(Aa.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ka(Aa.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ta(Aa.layout_symbol["icon-size"]),"icon-size-scale-range":new ka(Aa.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ta(Aa.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ta(Aa.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ta(Aa.layout_symbol["icon-image"]),"icon-rotate":new Ta(Aa.layout_symbol["icon-rotate"]),"icon-padding":new ka(Aa.layout_symbol["icon-padding"]),"icon-keep-upright":new ka(Aa.layout_symbol["icon-keep-upright"]),"icon-offset":new Ta(Aa.layout_symbol["icon-offset"]),"icon-anchor":new Ta(Aa.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ka(Aa.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ka(Aa.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ka(Aa.layout_symbol["text-rotation-alignment"]),"text-field":new Ta(Aa.layout_symbol["text-field"]),"text-font":new Ta(Aa.layout_symbol["text-font"]),"text-size":new Ta(Aa.layout_symbol["text-size"]),"text-size-scale-range":new ka(Aa.layout_symbol["text-size-scale-range"]),"text-max-width":new Ta(Aa.layout_symbol["text-max-width"]),"text-line-height":new Ta(Aa.layout_symbol["text-line-height"]),"text-letter-spacing":new Ta(Aa.layout_symbol["text-letter-spacing"]),"text-justify":new Ta(Aa.layout_symbol["text-justify"]),"text-radial-offset":new Ta(Aa.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ka(Aa.layout_symbol["text-variable-anchor"]),"text-anchor":new Ta(Aa.layout_symbol["text-anchor"]),"text-max-angle":new ka(Aa.layout_symbol["text-max-angle"]),"text-writing-mode":new ka(Aa.layout_symbol["text-writing-mode"]),"text-rotate":new Ta(Aa.layout_symbol["text-rotate"]),"text-padding":new ka(Aa.layout_symbol["text-padding"]),"text-keep-upright":new ka(Aa.layout_symbol["text-keep-upright"]),"text-transform":new Ta(Aa.layout_symbol["text-transform"]),"text-offset":new Ta(Aa.layout_symbol["text-offset"]),"text-allow-overlap":new ka(Aa.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ka(Aa.layout_symbol["text-ignore-placement"]),"text-optional":new ka(Aa.layout_symbol["text-optional"]),visibility:new ka(Aa.layout_symbol.visibility)})),paint:xy||(xy=new Ea({"icon-opacity":new Ta(Aa.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ta(Aa.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ta(Aa.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ta(Aa.paint_symbol["text-emissive-strength"]),"icon-color":new Ta(Aa.paint_symbol["icon-color"]),"icon-halo-color":new Ta(Aa.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ta(Aa.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ta(Aa.paint_symbol["icon-halo-blur"]),"icon-translate":new ka(Aa.paint_symbol["icon-translate"]),"icon-translate-anchor":new ka(Aa.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ka(Aa.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ta(Aa.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ta(Aa.paint_symbol["text-occlusion-opacity"]),"text-color":new Ta(Aa.paint_symbol["text-color"],{runtimeType:_n,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Ta(Aa.paint_symbol["text-halo-color"]),"text-halo-width":new Ta(Aa.paint_symbol["text-halo-width"]),"text-halo-blur":new Ta(Aa.paint_symbol["text-halo-blur"]),"text-translate":new ka(Aa.paint_symbol["text-translate"]),"text-translate-anchor":new ka(Aa.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ka(Aa.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ka(Aa.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ka(Aa.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ka(Aa.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ta(Aa.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},yy);class by extends Ka{constructor(e,t,n,i){super(e,_y(),t,n,i),this._colorAdjustmentMatrix=l([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,t,n,i){return this._saturation===e&&this._contrast===t&&this._brightnessMin===n&&this._brightnessMax===i||(this._colorAdjustmentMatrix=function(e,t,n,i){e=tt(e),t=et(t);const r=o(),s=e/3,a=1-2*s,l=[a,s,s,0,s,a,s,0,s,s,a,0,0,0,0,1],c=.5-.5*t,u=i-n;return d(r,[u,0,0,0,0,u,0,0,0,0,u,0,n,n,n,1],[t,0,0,0,0,t,0,0,0,0,t,0,c,c,c,1]),d(r,r,l),r}(e,t,n,i),this._saturation=e,this._contrast=t,this._brightnessMin=n,this._brightnessMax=i),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||Ps(s.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,(t,n)=>n in e?String(e[n]):"")}(t.properties,r)}createBucket(e){return new fy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of _y().paint.overridableProperties){if(!by.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new vy(t),i=new Is(n,t.property.specification,this.scope,this.options);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new Ls("source",i):new zs("composite",i,t.value.zoomStops,t.value.interpolationType),this.paint._values[e]=new Na(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&by.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=_y().paint.properties[t];let r=!1;const s=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof Rn)s(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof Un&&Bn(t.value)===Nn?s(t.value.sections):t instanceof Gn?s(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,t,n){return{config:new Cl(this,{zoom:t,lut:n}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let wy,jy,Ny,Sy;var ky=eo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ty(e,t,n,i,r,o,l,c){const d=[e,t,1,n,i,1,r,o,1],u=[l,c,1],h=s([],d),[p,m,f]=B(u,u,h);return a(d,d,[p,0,0,0,m,0,0,0,f])}function Cy(e,t,n,i,r,o,l,c){const d=function(e,t,n,i,r,o,l,c){const d=Ty(0,0,1,0,1,1,0,1),u=Ty(e,t,n,i,r,o,l,c);return a(u,u,s([],d))}(e,t,n,i,r,o,l,c);return[d[2]/d[8]/Pi,d[5]/d[8]/Pi]}function Ey(e){return[e[0],Math.min(Math.max(e[1],-rc),rc)]}class Ay extends en{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new Kt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Vt(this.map._requestManager.transformRequest(this.url,Dt.Image),(t,n)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new Qt(t)):n&&(this.image=n instanceof HTMLImageElement?pt.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new pm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Kt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof pm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],n=e[0][1];for(const r of e)r[1]>n&&(n=r[1]),r[1]<t&&(t=r[1]);const i=(n+t)/2;if(i>rc?this.onNorthPole=!0:i<-rc&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(cc.fromLngLat);this.tileID=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const c of e)t=Math.min(t,c.x),n=Math.min(n,c.y),i=Math.max(i,c.x),r=Math.max(r,c.y);const s=Math.max(i-t,r-n),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),o=Math.pow(2,a);let l=Math.floor((t+i)/2*o);return l>1&&(l-=1),new gd(a,l,Math.floor((n+r)/2*o))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Kt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof pm||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const s in this.tiles){const e=this.tiles[s];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const t=Lx(new gd(0,0,0),this.map.transform.projection),n=[t.projection.project(this.coordinates[0][0],this.coordinates[0][1]),t.projection.project(this.coordinates[1][0],this.coordinates[1][1]),t.projection.project(this.coordinates[2][0],this.coordinates[2][1]),t.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,n=e[1].y-e[0].y,i=e[2].x-e[1].x,r=e[2].y-e[1].y,s=e[3].x-e[2].x,a=e[3].y-e[2].y,o=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*r-i*n,d=i*a-s*r,u=s*l-o*a,h=o*n-t*l;return c>0&&d>0&&u>0&&h>0||c<0&&d<0&&u<0&&h<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const i=Lx(this.tileID,this.map.transform.projection),[r,o,l,c]=this.coordinates.map(e=>{const t=i.projection.project(e[0],e[1]);return zx(i,t)._round()});this.perspectiveTransform=Cy(r.x,r.y,o.x,o.y,l.x,l.y,c.x,c.y);const d=this._boundsArray=new ro;d.emplaceBack(r.x,r.y,0,0),d.emplaceBack(o.x,o.y,Pi,0),d.emplaceBack(c.x,c.y,0,Pi),d.emplaceBack(l.x,l.y,Pi,Pi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(d,ky.members),this.boundsSegments=tl.simpleSegment(0,0,4,2);const u=[],h=[Ey((p=this.coordinates)[0]),Ey(p[1]),Ey(p[2]),Ey(p[3])];var p;const[m,f,g,x]=function(e){let t=e[0][0],n=t,i=e[0][1],r=i;for(let s=1;s<e.length;s++)e[s][0]<t?t=e[s][0]:e[s][0]>n&&(n=e[s][0]),e[s][1]<i?i=e[s][1]:e[s][1]>r&&(r=e[s][1]);return[t,i,n-t,r-i]}(h);{const i=new ro,[r,o,l,c]=function(e){let t=e[0].x,n=t,i=e[0].y,r=i;for(let s=1;s<e.length;s++)e[s].x<t?t=e[s].x:e[s].x>n&&(n=e[s].x),e[s].y<i?i=e[s].y:e[s].y>r&&(r=e[s].y);return[t,i,n-t,r-i]}(n),d=e=>[(e.x-r)/l,(e.y-o)/c],[h,p,y,v]=n.map(d),_=function(e,t,n,i,r,o,l,c){const d=Ty(0,0,1,0,1,1,0,1);return a(d,d,s([],Ty(e,t,n,i,r,o,l,c)))}(h[0],h[1],p[0],p[1],y[0],y[1],v[0],v[1]);this.elevatedGlobePerspectiveTransform=Cy(h[0],h[1],p[0],p[1],y[0],y[1],v[0],v[1]);const b=(e,t)=>{u.push(e.lng);const n=Math.round((e.lng-m)/g*Pi),r=Math.round((e.lat-f)/x*Pi),s=d(t),a=B([],[s[0],s[1],1],_),o=Math.round(a[0]/a[2]*Pi),l=Math.round(a[1]/a[2]*Pi);i.emplaceBack(n,r,o,l)},w=n[3].x-n[0].x,j=n[3].y-n[0].y,N=n[2].x-n[1].x,S=n[2].y-n[1].y;for(let e=0;e<65;e++){const i=e/64,r=[n[0].x+i*w,n[0].y+i*j],s=[n[1].x+i*N,n[1].y+i*S],a=s[0]-r[0],o=s[1]-r[1];for(let e=0;e<65;e++){const n=e/64,i={x:r[0]+a*n,y:r[1]+o*n};b(t.projection.unproject(i.x,i.y),i)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(i,ky.members)}{this.maxLongitudeTriangleSize=0;let t=[],n=new No;const i=(e,i,r)=>{n.emplaceBack(e,i,r);const s=u[e],a=u[i],o=u[r],l=Math.min(Math.min(s,a),o),c=Math.max(Math.max(s,a),o)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let e=0;e<64;e++)for(let t=0;t<64;t++){const n=65*e+t,r=n+1,s=n+65,a=s+1;i(n,s,r),i(r,s,a)}[t,n]=function(e,t){const n=Array.from({length:e.length},(e,t)=>t);n.sort((t,n)=>e[t]-e[n]);const i=[],r=new No;for(let s=0;s<n.length;s++){const a=n[s];i.push(e[a]);const o=3*a,l=o+1;r.emplaceBack(t.uint16[o],t.uint16[l],t.uint16[l+1])}return[i,r]}(t,n),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(n)}this.elevatedGlobeSegments=tl.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,g/Pi,0,x/Pi,0,0,f,m,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,n=t.gl;!this._dirty||this.texture instanceof pm||(this.texture?this.texture.update(this.image):(this.texture=new hm(t,this.image,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let i=(r=e+180)+360*Math.round((n[0]-r)/360);var r;const s=new tl,a=(e,n)=>{s.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:n,sortKey:void 0,vaos:{}})},o=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-i)<=o){const e=$e(n,0,n.length,i+o);return e===n.length||a(e,Je(n,e+1,n.length,i+360-o)-e),s}i<n[0]&&(i+=360);const l=Je(n,0,n.length,i-o);if(l===n.length)return a(0,n.length),s;a(0,l-0);const c=$e(n,l+1,n.length,i+o);return c!==n.length&&a(c,n.length-c),s}}const My=(Math.pow(256,2)-1)/16907520;class Dy extends Ka{constructor(e,t,n,i){super(e,{layout:Ny||(Ny=new Ea({visibility:new ka(Aa.layout_raster.visibility)})),paint:Sy||(Sy=new Ea({"raster-opacity":new ka(Aa.paint_raster["raster-opacity"]),"raster-color":new Ca(Aa.paint_raster["raster-color"]),"raster-color-mix":new ka(Aa.paint_raster["raster-color-mix"]),"raster-color-range":new ka(Aa.paint_raster["raster-color-range"]),"raster-hue-rotate":new ka(Aa.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ka(Aa.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ka(Aa.paint_raster["raster-brightness-max"]),"raster-saturation":new ka(Aa.paint_raster["raster-saturation"]),"raster-contrast":new ka(Aa.paint_raster["raster-contrast"]),"raster-resampling":new ka(Aa.paint_raster["raster-resampling"]),"raster-fade-duration":new ka(Aa.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ka(Aa.paint_raster["raster-emissive-strength"]),"raster-array-band":new ka(Aa.paint_raster["raster-array-band"]),"raster-elevation":new ka(Aa.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Ay&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[n,i]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(i)||n===this._curRampRange[0]&&i===this._curRampRange[1]||(this.colorRamp=mu({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:i}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,i])}}let Iy,Py,Ry,Ly,zy;class Oy extends Ka{constructor(e,t,n,i){super(e,{layout:Iy||(Iy=new Ea({visibility:new ka(Aa["layout_raster-particle"].visibility)})),paint:Py||(Py=new Ea({"raster-particle-array-band":new ka(Aa["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ka(Aa["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ca(Aa["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ka(Aa["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ka(Aa["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ka(Aa["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ka(Aa["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ka(Aa["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._updateColorRamp(),this.lastInvalidatedAt=pt.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=mu({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=pt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Fy extends Ka{constructor(e,t){super(e,{},t,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function By(e,t,n){const i=[0,0,1],r=J([]);return ee(r,r,n?-Ne(e)+Math.PI:Ne(e)),$(r,r,-Ne(t)),V(i,i,r),R(i,i)}const Vy={None:0,Model:1,Symbol:2,FillExtrusion:4};class Uy{constructor(e,t,n,i){this.message=(e?"".concat(e,": "):"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function Hy(e,t){const n=-1===e.indexOf("://");try{return new URL(e,n&&t?"http://example.com":void 0),!0}catch(e){return!1}}class qy{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Wy{constructor(){this.instancedDataArray=new Ro,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Gy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,t){}populate(e,t,n,i){this.tileToMeter=lc(n);const r=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:s,id:a,index:o,sourceLayerIndex:l}of e){const e=null!=a?a:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0,c=yc(s,r);if(!this.layers[0]._featureFilter.filter(new xa(this.zoom,{worldview:this.worldview}),c,n))continue;const d={id:e,sourceLayerIndex:l,index:o,geometry:r?c.geometry:xc(s,n,i),properties:s.properties,type:s.type,patterns:{}},u=this.addFeature(d,d.geometry,c);u&&t.featureIndex.insert(s,d.geometry,o,l,this.index,this.instancesPerModel[u].instancedDataArray.length,Pi/32)}this.lookup=null}update(e,t,n,i){for(const r in this.instancesPerModel){const t=this.instancesPerModel[r];for(const n in e)t.idToFeaturesIndex.hasOwnProperty(n)&&(this.evaluate(t.features[t.idToFeaturesIndex[n]],e[n],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];for(const t of n.features){const i=this.layers[0],r=t.feature,s=this.canonical,a=i.paint.get("model-rotation").evaluate(r,{},s),o=i.paint.get("model-scale").evaluate(r,{},s),l=i.paint.get("model-translation").evaluate(r,{},s);H(t.rotation,a)&&H(t.scale,o)&&H(t.translation,l)||(this.evaluate(t,t.featureStates,n,!0),e=!0)}}return e}updateReplacement(e,t,n,i){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ah(this.activeReplacements,r))return!1;this.activeReplacements=r;let s=!1;for(const a in this.instancesPerModel){const t=this.instancesPerModel[a],r=t.instancedDataArray;for(const a of t.features){const t=a.instancedDataOffset,o=a.instancedDataCount;for(let a=0;a<o;a++){const o=16*(a+t);let l=r.float32[o+0];const c=l>Pi;l=c?l-Pi:l;const d=Math.floor(l),u=r.float32[o+1];let h=!1;for(const t of this.activeReplacements)if(!kh(t,n,Vy.Model,i)&&!(t.min.x>d||d>t.max.x||t.min.y>u||u>t.max.y)&&(h=Lh(Rh(d,u,e.canonical,t.footprintTileId.canonical),t.footprint),h))break;r.float32[o]=h?l+Pi:l,s=s||h!==c}}}return s}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length<0||0===n.instancedDataArray.length||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,vm.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const t of this.modelUris)e.removeModel(t,"",!0)}addFeature(e,t,n){const i=this.layers[0],r=i.layout.get("model-id").evaluate(n,{},this.canonical);if(!r)return qe("modelId is not evaluated for layer ".concat(i.id," and it is not going to get rendered.")),r;(Hy(r,!1)||void 0!==this.styleDefinedModelURLs[r])&&(this.modelUris.includes(r)||this.modelUris.push(r)),this.instancesPerModel[r]||(this.instancesPerModel[r]=new Wy);const s=this.instancesPerModel[r],a=s.instancedDataArray,o=new qy(n,a.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=Pi||e.y<0||e.y>=Pi)continue;const t=(this.lookupDim-1)/Pi,n=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[n])continue;this.lookup[n]=1}this.instanceCount++;const i=a.length;a.resize(i+1),s.instancesEvaluatedElevation.push(0),a.float32[16*i]=e.x,a.float32[16*i+1]=e.y}return o.instancedDataCount=s.instancedDataArray.length-o.instancedDataOffset,o.instancedDataCount>0&&(e.id&&(s.idToFeaturesIndex[e.id]=s.features.length),s.features.push(o),this.evaluate(o,{},s,!1)),r}getModelUris(){return this.modelUris}evaluate(e,t,n,i){const r=this.layers[0],s=e.feature,a=this.canonical,o=e.rotation=r.paint.get("model-rotation").evaluate(s,t,a),l=e.scale=r.paint.get("model-scale").evaluate(s,t,a),c=e.translation=r.paint.get("model-translation").evaluate(s,t,a),d=r.paint.get("model-color").evaluate(s,t,a);d.a=r.paint.get("model-color-mix-intensity").evaluate(s,t,a);const u=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Tm(u,o,l);const h=Math.round(100*d.a)+d.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,r=16*t,s=n.instancedDataArray.float32;let o=0;i&&(o=s[r+6]-n.instancesEvaluatedElevation[t]);const l=0|s[r+1];s[r]=(0|s[r])+d.r/1.05,s[r+1]=l+d.g/1.05,s[r+2]=h,s[r+3]=1/(a.z>10?this.tileToMeter:lc(a,l)),s[r+4]=c[0],s[r+5]=c[1],s[r+6]=c[2]+o,s[r+7]=u[0],s[r+8]=u[1],s[r+9]=u[2],s[r+10]=u[4],s[r+11]=u[5],s[r+12]=u[6],s[r+13]=u[8],s[r+14]=u[9],s[r+15]=u[10],n.instancesEvaluatedElevation[t]=c[2]}}}let Yy,Zy;Gs(Gy,"ModelBucket",{omit:["layers"]}),Gs(Wy,"PerModelAttributes"),Gs(qy,"ModelFeature");class Xy{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const r=i.dem,s=i.tileID,a=1<<t.canonical.z-s.canonical.z;return new Xy(i,r.dim/Pi/a,[(t.canonical.x/a-s.canonical.x)*r.dim,(t.canonical.y/a-s.canonical.y)*r.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1];return new _e(Math.floor(e*this._scale+this._offset[0]),Math.floor(n))}getElevationAt(e,t,n,i){const r=e*this._scale+this._offset[0],s=t*this._scale+this._offset[1],a=Math.floor(r),o=Math.floor(s),l=this._dem;return i=!!i,n?dn(dn(l.get(a,o,i),l.get(a,o+1,i),s-o),dn(l.get(a+1,o,i),l.get(a+1,o+1,i),s-o),r-a):l.get(a,o,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ec(1,e)*this._dem.stride}}const Ky=new Float32Array(262144),Qy=new Uint8Array(262144);function Jy(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,Jy(n));return t}function $y(e,t,n){if(e.meshes)for(const i of e.meshes){if(i.aabb.min[0]===1/0)continue;const r=Vc.applyTransform(i.aabb,e.matrix);n.insert(t,r.min[0],r.min[1],r.max[0],r.max[1])}if(e.children)for(const i of e.children)$y(i,t,n)}const ev=["","wall","door","roof","window","lamp","logo"];class tv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Jy(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.node.meshes)this.node.lightMeshIndex!==e&&(n.transformedAabb=Vc.applyTransformFast(n.aabb,this.node.matrix),t.encapsulate(n.transformedAabb)),e++;this.aabb=t}return this.aabb}}class nv{constructor(e,t,n,i,r,s,a,o){this.id=n,this.layers=e,this.layerIds=this.layers.map(e=>e.fqid),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.modelTraits|=Dm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=Dm.HasMapboxMeshFeatures),r&&(this.modelTraits|=Dm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=s,this.worldview=o,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const l of t)this.nodesInfo.push(new tv(l)),$y(l,a.featureIndexArray.length,a.grid),a.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,a.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,t){for(const n of this.getNodesInfo()){const i=n.node;i.footprint&&t.push({footprint:i.footprint,id:e})}}update(e){const t=0!==Object.keys(e).length;if(t&&!this.stateDependentLayers.length)return;const n=t?this.stateDependentLayers:this.layers;if(!be(e,this.states))for(const i of n)this.evaluate(i,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const n of t){const t=n.node;this.uploaded?this.updatePbrBuffer(t):Lm(t,e,!0)}for(const n of t)zm(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),t=!0);return t}needsReEvaluation(e,t,n){const i=e.transform.projectionOptions,r=e.style.getBrightness(),s=this.brightness!==r;if(!this.uploaded||this.dirty||i.name!==this.projection.name||iv(n.paint.get("model-color").value,s)||iv(n.paint.get("model-color-mix-intensity").value,s)||iv(n.paint.get("model-roughness").value,s)||iv(n.paint.get("model-emissive-strength").value,s)||iv(n.paint.get("model-height-based-emissive-strength-multiplier").value,s)){this.projection=i,this.brightness=r;const e=this.getNodesInfo();for(const t of e)t.state=null;return!0}return!1}evaluateTransform(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),i=this.id.canonical;for(const r of n){const e=r.feature;r.evaluatedTranslation=t.paint.get("model-translation").evaluate(e,{},i),r.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},i)}}evaluate(e,t){const n=this.getNodesInfo();for(const i of n){if(!i.node.meshes)continue;const n=i.feature,r=t&&t[n.id];if(be(r,i.state))continue;i.state=structuredClone(r);const s=i.node.meshes&&i.node.meshes[0].featureData,a=i.evaluatedColor[2],o=i.evaluatedRMEA[2],l=this.id.canonical;if(i.hasTranslucentParts=!1,s){for(let t=0;t<ev.length;t++){const s=ev[t];s.length&&(n.properties.part=s);const a=e.paint.get("model-color").evaluate(n,r,l).toPremultipliedRenderColor(null),o=e.paint.get("model-color-mix-intensity").evaluate(n,r,l);i.evaluatedColor[t]=[a.r,a.g,a.b,o],i.evaluatedRMEA[t][0]=e.paint.get("model-roughness").evaluate(n,r,l),i.evaluatedRMEA[t][2]=e.paint.get("model-emissive-strength").evaluate(n,r,l),i.evaluatedRMEA[t][3]=a.a,i.emissionHeightBasedParams[t]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(n,r,l),!i.hasTranslucentParts&&a.a<1&&(i.hasTranslucentParts=!0)}delete n.properties.part,sv(i,a!==i.evaluatedColor[2]||o!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(n,r,l);i.evaluatedTranslation=e.paint.get("model-translation").evaluate(n,r,l),i.evaluatedScale=e.paint.get("model-scale").evaluate(n,r,l),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,n,i){const r=e.findDEMTileFor(n);if(r&&(r.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(r.dem&&r.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=r.tileID.overscaledZ;const t=Xy.create(e,n,r);if(!t)return;this.modelTraits&Dm.HasMapboxMeshFeatures&&this.updateDEM(e,t,n,i);for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.vertices||!n.footprint.vertices.length)continue;const i=n.footprint.vertices;let r=t.getElevationAt(i[0].x,i[0].y,!0,!0);for(let e=1;e<i.length;e++)r=Math.min(r,t.getElevationAt(i[e].x,i[e].y,!0,!0));n.elevation=r}}this.terrainTile=r.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,n,i){let r=t._dem._modifiedForSources[i];if(void 0===r&&(t._dem._modifiedForSources[i]=[],r=t._dem._modifiedForSources[i]),r.includes(n.canonical))return;const s=t._dem.dim;r.push(n.canonical);let a=!1;for(const o of this.getNodesInfo()){const e=o.node;if(!e.footprint||!e.footprint.grid)continue;const n=e.footprint.grid,i=t.tileCoordToPixel(n.min.x,n.min.y),r=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(s-r.y,i.x),Math.min(i.y,s-r.x));if(l<0)continue;const c=Ae(l,2,5);let d=Math.max(0,i.x-c),u=Math.max(0,i.y-c),h=Math.min(r.x+c,s-1),p=Math.min(r.y+c,s-1);for(let t=u;t<=p;++t)for(let e=d;e<=h;++e)Qy[t*s+e]=255;let m=0,f=0;for(let a=0;a<n.cellsY;++a)for(let e=0;e<n.cellsX;++e){if(!n.cells[a*n.cellsX+e])continue;const i=t.tileCoordToPixel(n.min.x+e/n.xScale,n.min.y+a/n.yScale),r=t.tileCoordToPixel(n.min.x+(e+1)/n.xScale,n.min.y+(a+1)/n.yScale);for(let e=i.y;e<=Math.min(r.y+1,s-1);++e)for(let n=i.x;n<=Math.min(r.x+1,s-1);++n)255===Qy[e*s+n]&&(Qy[e*s+n]=0,m+=t.getElevationAtPixel(n,e),f++)}const g=m/f;d=Math.max(1,i.x-c),u=Math.max(1,i.y-c),h=Math.min(r.x+c,s-2),p=Math.min(r.y+c,s-2),a=!0;for(let a=u;a<=p;++a)for(let e=d;e<=h;++e)0===Qy[a*s+e]&&(Ky[a*s+e]=t._dem.set(e,a,g));for(let a=1;a<c;++a){d=Math.max(1,i.x-a),u=Math.max(1,i.y-a),h=Math.min(r.x+a,s-2),p=Math.min(r.y+a,s-2);for(let e=u;e<=p;++e)for(let n=d;n<=h;++n){const i=e*s+n;if(255===Qy[i]){let r=0,o=0,l=-1,d=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const c=(e+t)*s+n+i;if(Qy[c]>=a)continue;const u=Ky[c],h=Math.abs(u);h>o&&(r=u,o=h,l=i,d=t)}if(o>.1){const s=1-(a+.5*Math.abs(l*d))/c;let o=t._dem.get(n,e)+r*s;const u=t._dem.get(n+l,e+d),h=t._dem.get(n-l,e-d,!0);(o-u)*(o-h)>0&&(o=(u+h)/2),Ky[i]=t._dem.set(n,e,o),Qy[i]=a}}}}}a&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=pt.now())}setFilter(e){this.filter=e?Pa(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new xa(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)zm(t.node),Om(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());for(const i of this.getNodesInfo()){const e=i.node.footprint;i.hiddenByReplacement=!!e&&!n.find(t=>t.footprint===e)}}getHeightAtTileCoord(e,t){const n=[],i=[0,0,0],r=l([]);for(const s of this.getNodesInfo()){const a=s.node.meshes[0],o=a.transformedAabb;if(e<o.min[0]||t<o.min[1]||e>o.max[0]||t>o.max[1])continue;if(!0===s.node.hidden)return{height:1/0,maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]};c(r,s.node.matrix),i[0]=e,i[1]=t,F(i,i,r);const l=(i[0]-a.aabb.min[0])/(a.aabb.max[0]-a.aabb.min[0])*Mm|0,d=Math.min(63,(i[1]-a.aabb.min[1])/(a.aabb.max[1]-a.aabb.min[1])*Mm|0)*Mm+Math.min(63,l),u=a.heightmap[d];if(!(u<0&&s.node.footprint)){if(s.hiddenByReplacement)return;return{height:u,maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]}}if(s.node.footprint.grid.query(new _e(e,t),new _e(e,t),n),n.length>0)return{height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function iv(e,t){return e instanceof Ls&&!e.isLightConstant&&t}function rv(e,t,n,i,r,s,a,o){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,d=240&t|(240&t)>>4;n[3]>0&&(l=dn(l,255*n[0],n[3]),c=dn(c,255*n[1],n[3]),d=dn(d,255*n[2],n[3]));const u=l<<8|c,h=d<<8|Math.floor(255*i[3]),p=function(e){const t=Ae(e,0,2);return Math.min(Math.round(.5*t*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],m=Ae(r[0],0,1),f=Ae(r[1],0,1),g=Ae(r[2],0,1),x=Ae(r[3],0,1);let y,v,_,b;if(m!==f&&a!==s&&f!==m){const e=a-s;v=1/(e*(f-m)),_=-(s+e*m)/(e*(f-m));const t=Ae(r[4],-1,1);b=Math.pow(10,t),y=255*g<<8|255*x}else y=65535,v=0,_=1,b=1;if(e.emplaceBack(u,h,p,y,v,_,b),o){const e=o.length;o.clear();for(let t=0;t<e;t++)o.emplaceBack(u,h,p,y,v,_,b)}}function sv(e,t,n){const i=e.node;let r=0;const s=n&Dm.HasMeshoptCompression;for(const a of i.meshes){if(i.lights&&i.lightMeshIndex===r)continue;if(!a.featureData)continue;a.featureArray=new Lo,a.featureArray.reserve(a.featureData.length);let n=t;for(const t of a.featureData){const r=s?65535&t:t>>16&65535,o=s?t>>16&65535:65535&t,l=(15&o)<8?15&o:0,c=e.evaluatedRMEA[l],d=e.evaluatedColor[l],u=e.emissionHeightBasedParams[l];let h;if(n&&2===l&&i.lights&&(h=new Lo,h.resize(10*i.lights.length)),rv(a.featureArray,r,d,c,u,a.aabb.min[2],a.aabb.max[2],h),h&&n){n=!1;const e=i.meshes[i.lightMeshIndex];e.featureArray=h,e.featureArray._trim()}}a.featureArray._trim(),r++}}function av(e,t,n,i){const r=1<<e.z;t.lat=nc((i/Pi+e.y)/r),t.lng=tc((n/Pi+e.x)/r)}function ov(e,t,n,i){const r=e.getNodesInfo()[t];if(!r||r.hiddenByReplacement||!r.node.meshes)return;let s=Number.MAX_VALUE;const a=r.node,o=n.tile,l=i.calculatePosMatrix(o.tileID.toUnwrapped(),i.worldSize),c=r.evaluatedScale;let p=0;i.elevation&&a.elevation&&(p=a.elevation*i.elevation.exaggeration()),u(l,l,[(a.anchor?a.anchor[0]:0)*(c[0]-1),(a.anchor?a.anchor[1]:0)*(c[1]-1),p]),h(l,l,c);const m=n.queryGeometry,f=m.isPointQuery()?m.screenBounds:m.screenGeometry,g=function(e){const t=d([],l,e.matrix);d(t,i.expandedFarZProjMatrix,t);for(let n=0;n<e.meshes.length;++n){const r=e.meshes[n];if(n===e.lightMeshIndex)continue;const a=Am(f,i,t,r.aabb);null!=a&&(s=Math.min(a,s))}if(e.children)for(const n of e.children)g(n)};if(g(a),s===Number.MAX_VALUE)return;const x=new Yl(0,0);return av(o.tileID.canonical,x,r.node.anchor[0],r.node.anchor[1]),{intersectionZ:s,position:x,feature:r.feature}}Gs(nv,"Tiled3dModelBucket",{omit:["layers"]}),Gs(tv,"Tiled3dModelFeature");const lv={circle:class extends Ka{constructor(e,t,n,i){super(e,{layout:pd||(pd=new Ea({"circle-sort-key":new Ta(Aa.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ka(Aa.layout_circle["circle-elevation-reference"]),visibility:new ka(Aa.layout_circle.visibility)})),paint:md||(md=new Ea({"circle-radius":new Ta(Aa.paint_circle["circle-radius"]),"circle-color":new Ta(Aa.paint_circle["circle-color"]),"circle-blur":new Ta(Aa.paint_circle["circle-blur"]),"circle-opacity":new Ta(Aa.paint_circle["circle-opacity"]),"circle-translate":new ka(Aa.paint_circle["circle-translate"]),"circle-translate-anchor":new ka(Aa.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ka(Aa.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ka(Aa.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ta(Aa.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ta(Aa.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ta(Aa.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ka(Aa.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}createBucket(e){return new Gc(e)}queryRadius(e){const t=e;return cd("circle-radius",this,t)+cd("circle-stroke-width",this,t)+dd(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,s,a,o){const l=hd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Jd(e,i,s,a,o,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t,n){const i=Qd(this);return{config:new Cl(this,{zoom:t,lut:n}),defines:i,overrideFog:!1}}is3D(e){return!e&&!!this.layout&&"none"!==this.layout.get("circle-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends Ka{createBucket(e){return new iu(e)}constructor(e,t,n,i){super(e,{layout:ru||(ru=new Ea({visibility:new ka(Aa.layout_heatmap.visibility)})),paint:su||(su=new Ea({"heatmap-radius":new Ta(Aa.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ta(Aa.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ka(Aa.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ca(Aa.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ka(Aa.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(e){return cd("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,r,s,a,o){const l=this.paint.get("heatmap-radius").evaluate(t,n);return Jd(e,i,s,a,o,!0,!0,new _e(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t,n){return"heatmap"===e?{config:new Cl(this,{zoom:t,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Ka{constructor(e,t,n,i){super(e,{layout:au||(au=new Ea({visibility:new ka(Aa.layout_hillshade.visibility)})),paint:ou||(ou=new Ea({"hillshade-illumination-direction":new ka(Aa.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ka(Aa.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ka(Aa.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ka(Aa.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ka(Aa.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ka(Aa.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ka(Aa.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t,n){return{overrideFog:!1}}},fill:class extends Ka{constructor(e,t,n,i){super(e,{layout:dh||(dh=new Ea({"fill-sort-key":new Ta(Aa.layout_fill["fill-sort-key"]),visibility:new ka(Aa.layout_fill.visibility),"fill-elevation-reference":new ka(Aa.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ta(Aa.layout_fill["fill-construct-bridge-guard-rail"])})),paint:uh||(uh=new Ea({"fill-antialias":new ka(Aa.paint_fill["fill-antialias"]),"fill-opacity":new Ta(Aa.paint_fill["fill-opacity"]),"fill-color":new Ta(Aa.paint_fill["fill-color"]),"fill-outline-color":new Ta(Aa.paint_fill["fill-outline-color"]),"fill-translate":new ka(Aa.paint_fill["fill-translate"]),"fill-translate-anchor":new ka(Aa.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ta(Aa.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ka(Aa.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ka(Aa.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ta(Aa.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ta(Aa.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ta(Aa.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t,n){return{config:new Cl(this,{zoom:t,lut:n}),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ch(e)}queryRadius(){return dd(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,s){return!e.queryGeometry.isAboveHorizon&&Xc(ud(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(e){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const t=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=e?t&&!e:t}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends Ka{constructor(e,t,n,i){super(e,{layout:mp||(mp=new Ea({visibility:new ka(Aa["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ka(Aa["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:fp||(fp=new Ea({"fill-extrusion-opacity":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ta(Aa["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ka(Aa["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new ip(e)}queryRadius(){return dd(this.paint.get("fill-extrusion-translate"))}is3D(e){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,i,r,s,a,o,l){const c=hd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),d=this.paint.get("fill-extrusion-height").evaluate(t,n),u=this.paint.get("fill-extrusion-base").evaluate(t,n),h=[0,0],p=o&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,f=e.tile.getBucket(this);if(p&&f instanceof ip){const e=f.centroidVertexArray,t=l+1;t<e.length&&(h[0]=e.geta_centroid_pos0(t),h[1]=e.geta_centroid_pos1(t))}if(0===h[0]&&1===h[1])return!1;"globe"===s.projection.name&&(i=hp([i],[new _e(0,0),new _e(Pi,Pi)],e.tileID.canonical).map(e=>e.polygon).flat());const g=p?o:null,[x,y]=function(e,t,n,i,r,s,a,o,l,c,d){return"globe"===e.projection.name?function(e,t,n,i,r,s,a,o,l,c,d){const u=[],h=[],p=e.projection.upVectorScale(d,e.center.lat,e.worldSize).metersToTile,m=[0,0,0,1],f=[0,0,0,1],g=(e,t,n,i)=>{e[0]=t,e[1]=n,e[2]=i,e[3]=1},x=up();n>0&&(n+=x),i+=x;for(const y of t){const t=[],x=[];for(const u of y){const h=u.x+r.x,y=u.y+r.y,v=e.projection.projectTilePoint(h,y,d),_=e.projection.upVector(d,u.x,u.y);let b=n,w=i;if(a){const e=Sp(h,y,n,i,a,o,l,c);b+=e.base,w+=e.top}0!==n?g(m,v.x+_[0]*p*b,v.y+_[1]*p*b,v.z+_[2]*p*b):g(m,v.x,v.y,v.z),g(f,v.x+_[0]*p*w,v.y+_[1]*p*w,v.z+_[2]*p*w),F(m,m,s),F(f,f,s),t.push(new gp(m[0],m[1],m[2])),x.push(new gp(f[0],f[1],f[2]))}u.push(t),h.push(x)}return[u,h]}(e,t,n,i,r,s,a,o,l,c,d):a?function(e,t,n,i,r,s,a,o,l){const c=[],d=[],u=[0,0,0,1];for(const h of e){const e=[],p=[];for(const c of h){const d=c.x+i.x,h=c.y+i.y,m=Sp(d,h,t,n,s,a,o,l);u[0]=d,u[1]=h,u[2]=m.base,u[3]=1,K(u,u,r),u[3]=Math.max(u[3],1e-5);const f=new gp(u[0]/u[3],u[1]/u[3],u[2]/u[3]);u[0]=d,u[1]=h,u[2]=m.top,u[3]=1,K(u,u,r),u[3]=Math.max(u[3],1e-5);const g=new gp(u[0]/u[3],u[1]/u[3],u[2]/u[3]);e.push(f),p.push(g)}c.push(e),d.push(p)}return[c,d]}(t,n,i,r,s,a,o,l,c):function(e,t,n,i,r){const s=[],a=[],o=r[8]*t,l=r[9]*t,c=r[10]*t,d=r[11]*t,u=r[8]*n,h=r[9]*n,p=r[10]*n,m=r[11]*n;for(const f of e){const e=[],t=[];for(const n of f){const s=n.x+i.x,a=n.y+i.y,f=r[0]*s+r[4]*a+r[12],g=r[1]*s+r[5]*a+r[13],x=r[2]*s+r[6]*a+r[14],y=r[3]*s+r[7]*a+r[15],v=f+o,_=g+l,b=x+c,w=Math.max(y+d,1e-5),j=f+u,N=g+h,S=x+p,k=Math.max(y+m,1e-5);e.push(new gp(v/w,_/w,b/w)),t.push(new gp(j/k,N/k,S/k))}s.push(e),a.push(t)}return[s,a]}(t,n,i,r,s)}(s,i,u,d,c,a,g,h,m,s.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(e,t,n){let i=1/0;Xc(n,t)&&(i=Np(n,t[0]));for(let r=0;r<t.length;r++){const s=t[r],a=e[r];for(let e=0;e<s.length-1;e++){const t=s[e],r=[t,s[e+1],a[e+1],a[e],t];Yc(n,r)&&(i=Math.min(i,Np(n,r)))}}return i!==1/0&&i}(x,y,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},building:class extends Ka{constructor(e,t,n,i){super(e,{layout:af||(af=new Ea({visibility:new ka(Aa.layout_building.visibility),"building-facade":new Ta(Aa.layout_building["building-facade"]),"building-facade-floors":new Ta(Aa.layout_building["building-facade-floors"]),"building-facade-window":new Ta(Aa.layout_building["building-facade-window"]),"building-roof-shape":new Ta(Aa.layout_building["building-roof-shape"]),"building-height":new Ta(Aa.layout_building["building-height"]),"building-base":new Ta(Aa.layout_building["building-base"])})),paint:of||(of=new Ea({"building-opacity":new ka(Aa.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ka(Aa.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ka(Aa.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ka(Aa.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ka(Aa.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ka(Aa.paint_building["building-vertical-scale"]),"building-cast-shadows":new ka(Aa.paint_building["building-cast-shadows"]),"building-color":new Ta(Aa.paint_building["building-color"]),"building-emissive-strength":new Ta(Aa.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ka(Aa.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ka(Aa.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new rf(e)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(e){return!0}},line:class extends Ka{constructor(e,t,n,i){const r=Af();super(e,r,t,n,i),r.layout&&(this.layout=new Sa(r.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof jr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=(()=>{if(Df)return Df;const e=Af();return Df=new Mf(e.paint.properties["line-width"].specification),Df.useIntegerZoom=!0,Df})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new vf(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t,n){const i=Tf(this);return{config:new Cl(this,{zoom:t,lut:n}),defines:i,overrideFog:!1}}queryRadius(e){const t=e,n=If(cd("line-width",this,t),cd("line-gap-width",this,t)),i=cd("line-offset",this,t);return n/2+Math.abs(i)+dd(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,r,s){if(e.queryGeometry.isAboveHorizon)return!1;const a=ud(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),o=e.pixelToTileUnitsFactor/2*If(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(i=function(e,t){const n=[],i=new _e(0,0);for(let r=0;r<e.length;r++){const s=e[r],a=[];for(let e=0;e<s.length;e++){const n=s[e],r=s[e+1],o=0===e?i:n.sub(s[e-1])._unit()._perp(),l=e===s.length-1?i:r.sub(n)._unit()._perp(),c=o._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(t)._add(n))}n.push(a)}return n}(i,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(rd(e,r[t]))return!0;if(Kc(e,r,n))return!0}return!1}(a,i,o)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(e){return!this.hasElevatedBuckets||this.layout&&"hd-road-markup"===this.layout.get("line-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:by,background:class extends Ka{constructor(e,t,n,i){super(e,{layout:wy||(wy=new Ea({visibility:new ka(Aa.layout_background.visibility)})),paint:jy||(jy=new Ea({"background-pitch-alignment":new ka(Aa.paint_background["background-pitch-alignment"]),"background-color":new ka(Aa.paint_background["background-color"]),"background-pattern":new ka(Aa.paint_background["background-pattern"]),"background-opacity":new ka(Aa.paint_background["background-opacity"]),"background-emissive-strength":new ka(Aa.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t,n){return{overrideFog:!1}}is3D(e){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:Dy,"raster-particle":Oy,sky:class extends Ka{constructor(e,t,n,i){super(e,{layout:Ry||(Ry=new Ea({visibility:new ka(Aa.layout_sky.visibility)})),paint:Ly||(Ly=new Ea({"sky-type":new ka(Aa.paint_sky["sky-type"]),"sky-atmosphere-sun":new ka(Aa.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ka(Aa.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ka(Aa.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ka(Aa.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ca(Aa.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ka(Aa.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ka(Aa.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ka(Aa.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=mu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,s=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&qe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?By(s.azimuthal,90-s.polar,t):By(n[0],90-n[1],t)}const n=this.paint.get("sky-gradient-center");return By(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Ka{constructor(e,t,n,i){super(e,{paint:zy||(zy=new Ea({}))},t,null)}},model:class extends Ka{constructor(e,t,n,i){super(e,{layout:Yy||(Yy=new Ea({visibility:new ka(Aa.layout_model.visibility),"model-id":new Ta(Aa.layout_model["model-id"])})),paint:Zy||(Zy=new Ea({"model-opacity":new Ta(Aa.paint_model["model-opacity"]),"model-rotation":new Ta(Aa.paint_model["model-rotation"]),"model-scale":new Ta(Aa.paint_model["model-scale"]),"model-translation":new Ta(Aa.paint_model["model-translation"]),"model-color":new Ta(Aa.paint_model["model-color"]),"model-color-mix-intensity":new Ta(Aa.paint_model["model-color-mix-intensity"]),"model-type":new ka(Aa.paint_model["model-type"]),"model-cast-shadows":new ka(Aa.paint_model["model-cast-shadows"]),"model-receive-shadows":new ka(Aa.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ka(Aa.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ta(Aa.paint_model["model-emissive-strength"]),"model-roughness":new Ta(Aa.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ta(Aa.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ka(Aa.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ka(Aa.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ta({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Gy(e)}getProgramIds(){return["model"]}is3D(e){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof nv?Pi-1:0}queryIntersectsFeature(e,t,n,i,r,s){if(!this.modelManager)return!1;const a=this.modelManager,l=e.tile.getBucket(this);if(!(l&&l instanceof Gy))return!1;for(const c in l.instancesPerModel){const n=l.instancesPerModel[c],i=void 0!==t.id?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(n.idToFeaturesIndex.hasOwnProperty(i)){const t=n.features[n.idToFeaturesIndex[i]],r=a.getModel(c,this.scope);if(!r)return!1;let u=o();const h=new Yl(0,0),p=l.canonical;let m=Number.MAX_VALUE;for(let i=0;i<t.instancedDataCount;++i){const a=16*(t.instancedDataOffset+i),o=n.instancedDataArray.float32,l=[o[a+4],o[a+5],o[a+6]];av(p,h,o[a],0|o[a+1]),Im(u,r,s,h,t.rotation,t.scale,l,!1,!1,!1),"globe"===s.projection.name&&(u=Em(u,s));const c=d([],s.projMatrix,u),f=e.queryGeometry,g=Am(f.isPointQuery()?f.screenBounds:f.screenGeometry,s,c,r.aabb);null!=g&&(m=Math.min(g,m))}return m!==Number.MAX_VALUE&&m}}return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof zs}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ka{constructor(e,t,n,i){super(e,{layout:hh||(hh=new Ea({"clip-layer-types":new ka(Aa.layout_clip["clip-layer-types"]),"clip-layer-scope":new ka(Aa.layout_clip["clip-layer-scope"])})),paint:ph||(ph=new Ea({}))},t,n,i)}recalculate(e,t){super.recalculate(e,t)}createBucket(e){return new gh(e)}is3D(e){return!0}}},cv=new an(0,0,0),dv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},uv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},hv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},pv={PAINT_ORDER_FILL_AND_STROKE:1},mv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},fv={MASK_TYPE_LUMINANCE:1};function gv(e,t,n){1===e&&t.icons.push(function(e,t){return function(e){if(e.usvg_tree.height||(e.usvg_tree.height=e.usvg_tree.width),!e.metadata)return e;const{metadata:t}=e;if(t.content_area){const{content_area:n}=t;null==n.top&&(n.top=n.left),null==n.width&&(n.width=e.usvg_tree.width),null==n.height&&(n.height=n.width)}return t.stretch_x&&t.stretch_x.length&&xv(t,"x"),t.stretch_y&&t.stretch_y.length&&xv(t,"y"),e}(e.readFields(yv,{name:void 0},t))}(n,n.readVarint()+n.pos))}function xv(e,t){const n=[],i=e["stretch_".concat(t)];let r=null;for(let s=0;s<i.length;s++)null===r?r=0===n.length?i[0]:n[n.length-1][1]+i[s]:(n.push([r,r+i[s]]),r=null);e["stretch_".concat(t,"_areas")]=n}function yv(e,t,n){1===e?t.name=n.readString():2===e?t.metadata=function(e,t){return e.readFields(vv,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},t)}(n,n.readVarint()+n.pos):3===e&&(t.usvg_tree=function(e,t){return e.readFields(wv,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},t)}(n,n.readVarint()+n.pos),t.data="usvg_tree")}function vv(e,t,n){1===e?t.stretch_x=n.readPackedVarint():2===e?t.stretch_y=n.readPackedVarint():3===e?t.content_area=function(e,t){return e.readFields(_v,{left:0},t)}(n,n.readVarint()+n.pos):4===e&&t.variables.push(function(e,t){return e.readFields(bv,{name:void 0},t)}(n,n.readVarint()+n.pos))}function _v(e,t,n){1===e?t.left=n.readVarint():2===e?t.width=n.readVarint():3===e?t.top=n.readVarint():4===e&&(t.height=n.readVarint())}function bv(e,t,n){1===e?t.name=n.readString():2===e&&(t.rgb_color=Av(n.readVarint()),t.value="rgb_color")}function wv(e,t,n){1===e?t.width=t.height=n.readVarint():2===e?t.height=n.readVarint():3===e?t.children.push(jv(n,n.readVarint()+n.pos)):4===e?t.linear_gradients.push(function(e,t){return e.readFields(Dv,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},t)}(n,n.readVarint()+n.pos)):5===e?t.radial_gradients.push(function(e,t){return e.readFields(Rv,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},t)}(n,n.readVarint()+n.pos)):7===e?t.clip_paths.push(function(e,t){return e.readFields(Lv,{children:[]},t)}(n,n.readVarint()+n.pos)):8===e&&t.masks.push(function(e,t){const n=e.readFields(zv,{left:0,width:20,mask_type:fv.MASK_TYPE_LUMINANCE,children:[]},t);return null==n.height&&(n.height=n.width),null==n.top&&(n.top=n.left),n}(n,n.readVarint()+n.pos))}function jv(e,t){return e.readFields(Nv,{},t)}function Nv(e,t,n){1===e?(t.group=function(e,t){return e.readFields(Sv,{opacity:255,children:[]},t)}(n,n.readVarint()+n.pos),t.node="group"):2===e&&(t.path=function(e,t){return e.readFields(Cv,{paint_order:1,commands:[],step:1,diffs:[],rule:dv.PATH_RULE_NON_ZERO},t)}(n,n.readVarint()+n.pos),t.node="path")}function Sv(e,t,n){1===e?t.transform=kv(n,n.readVarint()+n.pos):2===e?t.opacity=n.readVarint():5===e?t.clip_path_idx=n.readVarint():6===e?t.mask_idx=n.readVarint():7===e&&t.children.push(jv(n,n.readVarint()+n.pos))}function kv(e,t){return e.readFields(Tv,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function Tv(e,t,n){1===e?t.sx=n.readFloat():2===e?t.ky=n.readFloat():3===e?t.kx=n.readFloat():4===e?t.sy=n.readFloat():5===e?t.tx=n.readFloat():6===e&&(t.ty=n.readFloat())}function Cv(e,t,n){1===e?t.fill=function(e,t){return e.readFields(Ev,{rgb_color:cv,paint:"rgb_color",opacity:255},t)}(n,n.readVarint()+n.pos):2===e?t.stroke=function(e,t){return e.readFields(Mv,{rgb_color:cv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},t)}(n,n.readVarint()+n.pos):3===e?t.paint_order=n.readVarint():5===e?n.readPackedVarint(t.commands):6===e?t.step=n.readFloat():7===e?n.readPackedSVarint(t.diffs):8===e&&(t.rule=n.readVarint())}function Ev(e,t,n){1===e?(t.rgb_color=Av(n.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):5===e&&(t.opacity=n.readVarint())}function Av(e){return new an((e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1)}function Mv(e,t,n){1===e?(t.rgb_color=Av(n.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):5===e?n.readPackedFloat(t.dasharray):6===e?t.dashoffset=n.readFloat():7===e?t.miterlimit=n.readFloat():8===e?t.opacity=n.readVarint():9===e?t.width=n.readFloat():10===e?t.linecap=n.readVarint():11===e&&(t.linejoin=n.readVarint())}function Dv(e,t,n){1===e?t.transform=kv(n,n.readVarint()+n.pos):2===e?t.spread_method=n.readVarint():3===e?t.stops.push(Iv(n,n.readVarint()+n.pos)):4===e?t.x1=n.readFloat():5===e?t.y1=n.readFloat():6===e?t.x2=n.readFloat():7===e&&(t.y2=n.readFloat())}function Iv(e,t){return e.readFields(Pv,{offset:0,opacity:255,rgb_color:cv},t)}function Pv(e,t,n){1===e?t.offset=n.readFloat():2===e?t.opacity=n.readVarint():3===e&&(t.rgb_color=Av(n.readVarint()))}function Rv(e,t,n){1===e?t.transform=kv(n,n.readVarint()+n.pos):2===e?t.spread_method=n.readVarint():3===e?t.stops.push(Iv(n,n.readVarint()+n.pos)):4===e?t.cx=n.readFloat():5===e?t.cy=n.readFloat():6===e?t.r=n.readFloat():7===e?t.fx=n.readFloat():8===e?t.fy=n.readFloat():9===e&&(t.fr=n.readFloat())}function Lv(e,t,n){1===e?t.transform=kv(n,n.readVarint()+n.pos):2===e?t.clip_path_idx=n.readVarint():3===e&&t.children.push(jv(n,n.readVarint()+n.pos))}function zv(e,t,n){1===e?t.left=t.top=n.readFloat():2===e?t.width=t.height=n.readFloat():3===e?t.top=n.readFloat():4===e?t.height=n.readFloat():5===e?t.mask_type=n.readVarint():6===e?t.mask_idx=n.readVarint():7===e&&t.children.push(jv(n,n.readVarint()+n.pos))}class Ov{static calculate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=new Map,i=new Map;if(0===Object.keys(e).length)return n;t.forEach(e=>{i.set(e.name,e.rgb_color||new an(0,0,0))});for(const[r,s]of Object.entries(e))i.has(r)?n.set(i.get(r).toString(),s):console.warn('Ignoring unknown image variable "'.concat(r,'"'));return n}}function Fv(e){let t=arguments.length>2?arguments[2]:void 0;const n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:255)/255,i=e.toString(),r=t.has(i)?t.get(i).clone():e.clone();return r.a*=n,r.toString()}function Bv(e,t){if(!ht()){const n=document.createElement("canvas");return n.width=e,n.height=t,n}return new OffscreenCanvas(e,t)}function Vv(e,t){const n=Ov.calculate(t.params,e.metadata?e.metadata.variables:[]),i=e.usvg_tree,r=i.width,s=i.height,a=t.transform?t.transform:new DOMMatrix,o=Math.max(1,Math.round(r*a.a)),l=Math.max(1,Math.round(s*a.d)),c=new DOMMatrix([o/r,0,0,l/s,0,0]),d=Bv(o,l).getContext("2d");return Uv(d,c,i,i,n),d.getImageData(0,0,o,l)}function Uv(e,t,n,i,r){for(const s of i.children)Hv(e,t,n,s,r)}function Hv(e,t,n,i,r){i.group?(e.save(),function(e,t,n,i,r){const s=null!=i.mask_idx?n.masks[i.mask_idx]:null,a=null!=i.clip_path_idx?n.clip_paths[i.clip_path_idx]:null;if(i.transform&&(t=Jv(i.transform).preMultiplySelf(t)),!function(e,t,n){return 255!==e.opacity||t||n}(i,null!=a,null!=s))return void Uv(e,t,n,i,r);const o=Bv(e.canvas.width,e.canvas.height),l=o.getContext("2d");Uv(l,t,n,i,r),a&&Kv(l,t,n,a),s&&Qv(l,t,n,s,r),e.globalAlpha=i.opacity/255,e.drawImage(o,0,0)}(e,t,n,i.group,r),e.restore()):i.path&&(e.save(),function(e,t,n,i,r){e.setTransform(t),i.paint_order===pv.PAINT_ORDER_FILL_AND_STROKE?(qv(e,n,i,r),Gv(e,n,i,r)):(Gv(e,n,i,r),qv(e,n,i,r))}(e,t,n,i.path,r),e.restore())}function qv(e,t,n,i){const r=n.fill;if(!r)return;const s=r.opacity/255;switch(e.save(),e.beginPath(),$v(n,e),r.paint){case"rgb_color":e.fillStyle=Fv(r.rgb_color,r.opacity,i);break;case"linear_gradient_idx":{const n=t.linear_gradients[r.linear_gradient_idx];n.transform&&e.setTransform(Jv(n.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Yv(e,n,s,i);break}case"radial_gradient_idx":{const n=t.radial_gradients[r.radial_gradient_idx];n.transform&&e.setTransform(Jv(n.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Zv(e,n,s,i)}}e.fill(Wv(n)),e.restore()}function Wv(e){return e.rule===dv.PATH_RULE_NON_ZERO?"nonzero":e.rule===dv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Gv(e,t,n,i){const r=n.stroke;if(!r)return;const s=e_(n);e.lineWidth=r.width,e.miterLimit=r.miterlimit,e.setLineDash(r.dasharray),e.lineDashOffset=r.dashoffset;const a=r.opacity/255;switch(r.paint){case"rgb_color":e.strokeStyle=Fv(r.rgb_color,r.opacity,i);break;case"linear_gradient_idx":e.strokeStyle=Yv(e,t.linear_gradients[r.linear_gradient_idx],a,i,!0);break;case"radial_gradient_idx":e.strokeStyle=Zv(e,t.radial_gradients[r.radial_gradient_idx],a,i,!0)}switch(r.linejoin){case hv.LINE_JOIN_MITER_CLIP:case hv.LINE_JOIN_MITER:e.lineJoin="miter";break;case hv.LINE_JOIN_ROUND:e.lineJoin="round";break;case hv.LINE_JOIN_BEVEL:e.lineJoin="bevel"}switch(r.linecap){case uv.LINE_CAP_BUTT:e.lineCap="butt";break;case uv.LINE_CAP_ROUND:e.lineCap="round";break;case uv.LINE_CAP_SQUARE:e.lineCap="square"}e.stroke(s)}function Yv(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Fv(e.rgb_color,e.opacity*n,i)}const{x1:s,y1:a,x2:o,y2:l}=t;let c=new DOMPoint(s,a),d=new DOMPoint(o,l);if(r){const e=Jv(t.transform);c=e.transformPoint(c),d=e.transformPoint(d)}const u=e.createLinearGradient(c.x,c.y,d.x,d.y);for(const h of t.stops)u.addColorStop(h.offset,Fv(h.rgb_color,h.opacity*n,i));return u}function Zv(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Fv(e.rgb_color,e.opacity*n,i)}const s=Jv(t.transform),{fx:a,fy:o,fr:l,cx:c,cy:d,r:u}=t;let h=new DOMPoint(a,o),p=new DOMPoint(c,d),m=l,f=u;if(r){h=s.transformPoint(h),p=s.transformPoint(p);const e=(s.a+s.d)/2;m=l*e,f=t.r*e}const g=e.createRadialGradient(h.x,h.y,m,p.x,p.y,f);for(const x of t.stops)g.addColorStop(x.offset,Fv(x.rgb_color,x.opacity*n,i));return g}function Xv(e,t,n,i){const r=i.transform?Jv(i.transform).preMultiplySelf(t):t,s=Bv(e.canvas.width,e.canvas.height),a=s.getContext("2d");for(const l of i.children)if(l.group)Xv(a,r,n,l.group);else if(l.path){const e=l.path,t=new Path2D;t.addPath(e_(e),r),a.fill(t,Wv(e))}const o=null!=i.clip_path_idx?n.clip_paths[i.clip_path_idx]:null;o&&Kv(a,r,n,o),e.globalCompositeOperation="source-over",e.drawImage(s,0,0)}function Kv(e,t,n,i){const r=Bv(e.canvas.width,e.canvas.height);Xv(r.getContext("2d"),t,n,i),e.globalCompositeOperation="destination-in",e.drawImage(r,0,0)}function Qv(e,t,n,i,r){if(0===i.children.length)return;const s=null!=i.mask_idx?n.masks[i.mask_idx]:null;s&&Qv(e,t,n,s,r);const a=e.canvas.width,o=e.canvas.height,l=Bv(a,o),c=l.getContext("2d"),d=i.width,u=i.height,h=i.left,p=i.top,m=new Path2D,f=new Path2D;f.rect(h,p,d,u),m.addPath(f,t),c.clip(m);for(const y of i.children)Hv(c,t,n,y,r);const g=c.getImageData(0,0,a,o),x=g.data;if(i.mask_type===fv.MASK_TYPE_LUMINANCE)for(let y=0;y<x.length;y+=4)x[y+3]=x[y+3]/255*(.2126*x[y]+.7152*x[y+1]+.0722*x[y+2]);c.putImageData(g,0,0),e.globalCompositeOperation="destination-in",e.drawImage(l,0,0)}function Jv(e){return e?new DOMMatrix([e.sx,e.ky,e.kx,e.sy,e.tx,e.ty]):new DOMMatrix}function $v(e,t){const n=e.step;let i=e.diffs[0]*n,r=e.diffs[1]*n;t.moveTo(i,r);for(let s=0,a=2;s<e.commands.length;s++)switch(e.commands[s]){case mv.PATH_COMMAND_MOVE:i+=e.diffs[a++]*n,r+=e.diffs[a++]*n,t.moveTo(i,r);break;case mv.PATH_COMMAND_LINE:i+=e.diffs[a++]*n,r+=e.diffs[a++]*n,t.lineTo(i,r);break;case mv.PATH_COMMAND_QUAD:{const s=i+e.diffs[a++]*n,o=r+e.diffs[a++]*n;i=s+e.diffs[a++]*n,r=o+e.diffs[a++]*n,t.quadraticCurveTo(s,o,i,r);break}case mv.PATH_COMMAND_CUBIC:{const s=i+e.diffs[a++]*n,o=r+e.diffs[a++]*n,l=s+e.diffs[a++]*n,c=o+e.diffs[a++]*n;i=l+e.diffs[a++]*n,r=c+e.diffs[a++]*n,t.bezierCurveTo(s,o,l,c,i,r);break}case mv.PATH_COMMAND_CLOSE:t.closePath()}return t}function e_(e){return $v(e,new Path2D)}class t_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}delete(e){this.cache.delete(e)}}Gs(t_,"LRUCache");class n_{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new hu(e,e.data)}getFromCache(e,t,n){return this.cacheMap.has(n)||this.cacheMap.set(n,new t_(150)),this.cacheMap.get(n).get(Ya(e.toString(),t))}setInCache(e,t,n,i){this.cacheDependenciesMap.has(i)||this.cacheDependenciesMap.set(i,new Map),this.cacheMap.has(i)||this.cacheMap.set(i,new t_(150));const r=this.cacheDependenciesMap.get(i),s=Ya(e.id.toString(),n);r.get(s)||r.set(s,new Set);const a=this.cacheMap.get(i),o=e.toString();r.get(s).add(o),a.put(Ya(e.toString(),n),t)}removeImagesFromCacheByIds(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.cacheMap.has(n)||!this.cacheDependenciesMap.has(n))return;const i=this.cacheMap.get(n),r=this.cacheDependenciesMap.get(n);for(const s of e){const e=Ya(s.toString(),t);if(r.has(e)){for(const t of r.get(e))i.delete(t);r.delete(e)}}}rasterize(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Vv;const s=this.getFromCache(e,n,i);if(s)return s.clone();const a=r(t.icon,e.options),o=n_._getImage(a);return this.setInCache(e,o,n,i),o.clone()}}class i_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function r_(e,t,n,i){let r=0,s=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(i[a])<1e-15){if(n[a]<e[a]||n[a]>t[a])return null}else{const o=1/i[a];let l=(e[a]-n[a])*o,c=(t[a]-n[a])*o;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<s&&(s=c),r>s)return null}return r}function s_(e,t,n,i,r,s,a,o,l,c,d){const u=i-e,h=r-t,p=s-n,m=a-e,f=o-t,g=l-n,x=d[1]*g-d[2]*f,y=d[2]*m-d[0]*g,v=d[0]*f-d[1]*m,_=u*x+h*y+p*v;if(Math.abs(_)<1e-15)return null;const b=1/_,w=c[0]-e,j=c[1]-t,N=c[2]-n,S=(w*x+j*y+N*v)*b;if(S<0||S>1)return null;const k=j*p-N*h,T=N*u-w*p,C=w*h-j*u,E=(d[0]*k+d[1]*T+d[2]*C)*b;return E<0||S+E>1?null:(m*k+f*T+g*C)*b}function a_(e,t,n){return(e-t)/(n-t)}function o_(e,t,n,i,r,s,a,o,l){const c=1<<n,d=s-i,u=a-r,h=(e+1)/c*d+i,p=(t+0)/c*u+r,m=(t+1)/c*u+r;o[0]=(e+0)/c*d+i,o[1]=p,l[0]=h,l[1]=m}class l_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let i=Math.ceil(Math.pow(2,t));const r=1/i,s=(e,t,n,i,r)=>{const s=i?1:0,a=(e+1)*n-s,o=t*n,l=(t+1)*n-s;r[0]=e*n,r[1]=o,r[2]=a,r[3]=l};let a=new i_(i);const o=[];for(let l=0;l<i*i;l++){s(l%i,Math.floor(l/i),r,!1,o);const t=d_(o[0],o[1],e),n=d_(o[2],o[1],e),c=d_(o[2],o[3],e),d=d_(o[0],o[3],e);a.minimums.push(Math.min(t,n,c,d)),a.maximums.push(Math.max(t,n,c,d)),a.leaves.push(1)}for(n.push(a),i/=2;i>=1;i/=2){const e=n[n.length-1];a=new i_(i);for(let t=0;t<i*i;t++){s(t%i,Math.floor(t/i),2,!0,o);const n=e.getElevation(o[0],o[1]),r=e.getElevation(o[2],o[1]),l=e.getElevation(o[2],o[3]),c=e.getElevation(o[0],o[3]),d=e.isLeaf(o[0],o[1]),u=e.isLeaf(o[2],o[1]),h=e.isLeaf(o[2],o[3]),p=e.isLeaf(o[0],o[3]),m=Math.min(n.min,r.min,l.min,c.min),f=Math.max(n.max,r.max,l.max,c.max),g=d&&u&&h&&p;a.maximums.push(f),a.minimums.push(m),a.leaves.push(f-m<=5&&g?1:0)}n.push(a)}return n}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return r_([e,t,-100],[n,i,this.maximums[0]*a],r,s)}raycast(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const o=this.raycastRoot(e,t,n,i,r,s,a);if(null==o)return null;const l=[],c=[],d=[],u=[],h=[{idx:0,t:o,nodex:0,nodey:0,depth:0}];for(;h.length>0;){const{idx:o,t:p,nodex:m,nodey:f,depth:g}=h.pop();if(this.leaves[o]){o_(m,f,g,e,t,n,i,d,u);const o=1<<g,l=(m+0)/o,c=(m+1)/o,h=(f+0)/o,x=(f+1)/o,y=d_(l,h,this.dem)*a,v=d_(c,h,this.dem)*a,_=d_(c,x,this.dem)*a,b=d_(l,x,this.dem)*a,w=s_(d[0],d[1],y,u[0],d[1],v,u[0],u[1],_,r,s),j=s_(u[0],u[1],_,d[0],u[1],b,d[0],d[1],y,r,s),N=Math.min(null!==w?w:Number.MAX_VALUE,null!==j?j:Number.MAX_VALUE);if(N!==Number.MAX_VALUE)return N;{const e=M([],r,s,p);if(c_(y,v,b,_,a_(e[0],d[0],u[0]),a_(e[1],d[1],u[1]))>=e[2])return p}continue}let x=0;for(let h=0;h<this._siblingOffset.length;h++){o_((m<<1)+this._siblingOffset[h][0],(f<<1)+this._siblingOffset[h][1],g+1,e,t,n,i,d,u),d[2]=-100,u[2]=this.maximums[this.childOffsets[o]+h]*a;const p=r_(d,u,r,s);if(null!=p){const e=p;l[h]=e;let t=!1;for(let n=0;n<x&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,h),t=!0);t||(c[x]=h),x++}}for(let e=0;e<x;e++){const t=c[e];h.push({idx:this.childOffsets[o]+t,t:l[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(f<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,r){if(1===e[i].isLeaf(t,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const s=i-1,a=e[s];let o=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],i=2*n+this._siblingOffset[c][1],r=a.getElevation(e,i),s=a.isLeaf(e,i),d=this._addNode(r.min,r.max,s);s&&(o|=1<<c),l||(l=d)}for(let c=0;c<this._siblingOffset.length;c++)o&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],s,l+c)}}function c_(e,t,n,i,r,s){return dn(dn(e,n,s),dn(t,i,s),r)}function d_(e,t,n){const i=n.dim,r=Ae(e*i-.5,0,i-1),s=Ae(t*i-.5,0,i-1),a=Math.floor(r),o=Math.floor(s),l=Math.min(a+1,i-1),c=Math.min(o+1,i-1);return c_(n.get(a,o),n.get(l,o),n.get(a,c),n.get(l,c),r-a,s-o)}const u_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function h_(e,t,n){return(256*e*256+256*t+n)/10-1e4}function p_(e,t,n){return 256*e+t+n/256-32768}class m_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return void qe('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const r=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=i,this._modifiedForSources={},!i){for(let e=0;e<r;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(r,e)]=s[this._idx(r-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,r)]=s[this._idx(e,r-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(r,-1)]=s[this._idx(r-1,0)],s[this._idx(-1,r)]=s[this._idx(0,r-1)],s[this._idx(r,r)]=s[this._idx(r-1,r-1)]}const a="terrarium"===n?p_:h_;for(let o=0;o<s.length;++o){const e=4*o;this.floatView[o]=a(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=pt.now()}_buildQuadTree(){this._tree=new l_(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=Ae(e,-1,this.dim),t=Ae(t,-1,this.dim));const n=this._idx(e,t);return this.floatView[n]}set(e,t,n){const i=this._idx(e,t),r=this.floatView[i];return this.floatView[i]=n,n-r}static getUnpackVector(e){return u_[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],i=m_.getUnpackVector(t);let r=Math.floor((e+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return new pu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,s=n*this.dim,a=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:s=a-1;break;case 1:a=s+1}const o=-t*this.dim,l=-n*this.dim;for(let c=s;c<a;c++)for(let t=i;t<r;t++){const n=4*this._idx(t,c),i=4*this._idx(t+o,c+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function f_(e,t,n){1===e?t.headerLength=n.readFixed32():2===e?t.x=n.readVarint():3===e?t.y=n.readVarint():4===e?t.z=n.readVarint():5===e&&t.layers.push(function(e,t){return e.readFields(__,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},t)}(n,n.readVarint()+n.pos))}function g_(e,t,n){1===e?(t.delta_filter=function(e,t){return e.readFields(x_,{blockSize:0},t)}(n,n.readVarint()+n.pos),t.filter="delta_filter"):2===e?(n.readVarint(),t.filter="zigzag_filter"):3===e?(n.readVarint(),t.filter="bitshuffle_filter"):4===e&&(n.readVarint(),t.filter="byteshuffle_filter")}function x_(e,t,n){1===e&&(t.blockSize=n.readVarint())}function y_(e,t,n){1===e?(n.readVarint(),t.codec="gzip_data"):2===e?(n.readVarint(),t.codec="jpeg_image"):3===e?(n.readVarint(),t.codec="webp_image"):4===e&&(n.readVarint(),t.codec="png_image")}function v_(e,t,n){let i=0,r=0;1===e?t.firstByte=n.readFixed64():2===e?t.lastByte=n.readFixed64():3===e?t.filters.push(function(e,t){return e.readFields(g_,{},t)}(n,n.readVarint()+n.pos)):4===e?t.codec=function(e,t){return e.readFields(y_,{},t)}(n,n.readVarint()+n.pos):5===e?r=n.readFloat():6===e?i=n.readFloat():7===e?t.bands.push(n.readString()):8===e?t.offset=n.readDouble():9===e&&(t.scale=n.readDouble()),0===t.offset&&(t.offset=r),0===t.scale&&(t.scale=i)}function __(e,t,n){1===e?t.version=n.readVarint():2===e?t.name=n.readString():3===e?t.units=n.readString():4===e?t.tileSize=n.readVarint():5===e?t.buffer=n.readVarint():6===e?t.pixelFormat=n.readVarint():7===e&&t.dataIndex.push(function(e,t){return e.readFields(v_,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)}(n,n.readVarint()+n.pos))}function b_(e,t,n){if(2===e)!function(e,t,n){e.readFields(w_,n,t)}(n,n.readVarint()+n.pos,t);else if(3===e)throw new Error("Not implemented")}function w_(e,t,n){if(1===e){let e=0;const i=n.readVarint()+n.pos;for(;n.pos<i;)t[e++]=n.readVarint()}}function j_(e,t){if(4!==t.length)throw new Error("Expected data of dimension 4 but got ".concat(t.length,"."));let n=t[3];for(let i=2;i>=1;i--){const r=1===i?1:0,s=2===i?1:0;for(let i=0;i<t[0];i++){const a=t[1]*i;for(let i=r;i<t[1];i++){const r=t[2]*(i+a);for(let i=s;i<t[2];i++){const s=t[3]*(i+r);for(let i=0;i<t[3];i++){const t=s+i;e[t]+=e[t-n]}}}}n*=t[i]}return e}function N_(e){for(let t=0,n=e.length;t<n;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function S_(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];e[t]=(240&n)>>4|(61440&n)>>8|(240&i)<<4|61440&i,e[t+1]=15&n|(3840&n)>>4|(15&i)<<8|(3840&i)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const n=e[t],i=e[t+1],r=e[t+2],s=e[t+3];e[t+0]=(192&n)>>6|(192&i)>>4|(192&r)>>2|192&s,e[t+1]=(48&n)>>4|(48&i)>>2|48&r|(48&s)<<2,e[t+2]=(12&n)>>2|12&i|(12&r)<<2|(12&s)<<4,e[t+3]=3&n|(3&i)<<2|(3&r)<<4|(3&s)<<6}return e;default:throw new Error('Invalid pixel format, "'.concat(t,'"'))}}Gs(m_,"DEMData"),Gs(l_,"DemMinMaxQuadTree",{omit:["dem"]});var k_=Uint8Array,T_=Uint16Array,C_=Int32Array,E_=new k_([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),A_=new k_([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),M_=new k_([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D_=function(e,t){for(var n=new T_(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new C_(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return{b:n,r:r}},I_=D_(E_,2),P_=I_.b,R_=I_.r;P_[28]=258,R_[258]=28;for(var L_=D_(A_,0).b,z_=new T_(32768),O_=0;O_<32768;++O_){var F_=(43690&O_)>>1|(21845&O_)<<1;z_[O_]=((65280&(F_=(61680&(F_=(52428&F_)>>2|(13107&F_)<<2))>>4|(3855&F_)<<4))>>8|(255&F_)<<8)>>1}var B_=function(e,t,n){for(var i=e.length,r=0,s=new T_(t);r<i;++r)e[r]&&++s[e[r]-1];var a,o=new T_(t);for(r=1;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;a=new T_(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],d=t-e[r],u=o[e[r]-1]++<<d,h=u|(1<<d)-1;u<=h;++u)a[z_[u]>>l]=c;return a},V_=new k_(288);for(O_=0;O_<144;++O_)V_[O_]=8;for(O_=144;O_<256;++O_)V_[O_]=9;for(O_=256;O_<280;++O_)V_[O_]=7;for(O_=280;O_<288;++O_)V_[O_]=8;var U_=new k_(32);for(O_=0;O_<32;++O_)U_[O_]=5;var H_=B_(V_,9),q_=B_(U_,5),W_=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},G_=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Y_=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Z_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],X_=function(e,t,n){var i=new Error(t||Z_[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,X_),!n)throw i;return i},K_=new k_(0),Q_="undefined"!=typeof TextDecoder&&new TextDecoder;try{Q_.decode(K_,{stream:!0})}catch(e){}const J_={gzip_data:"gzip"};class $_ extends Error{constructor(e){super(e),this.name="MRTError"}}const eb={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},tb={uint32:1,uint16:2,uint8:4},nb={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ib;class rb{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const t=this.layers[e];if(!t)throw new $_("Layer '".concat(e,"' not found"));return t}getHeaderLength(e){const t=new Uint8Array(e),n=new DataView(e);if(13!==t[0])throw new $_("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),n=this.getHeaderLength(e);if(t.length<n)throw new $_("Expected header with length >= ".concat(n," but got buffer of length ").concat(t.length));const i=new ib(t.subarray(0,n)).readFields(f_,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==i.x||this.y!==i.y||this.z!==i.z))throw new $_("Invalid attempt to parse header ".concat(i.z,"/").concat(i.x,"/").concat(i.y," for tile ").concat(this.z,"/").concat(this.x,"/").concat(this.y));this.x=i.x,this.y=i.y,this.z=i.z;for(const r of i.layers)this.layers[r.name]=new sb(r,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],n=this.getLayer(e.layerName);for(let i of e.blockIndices){const r=n.dataIndex[i],s=r.firstByte-e.firstByte,a=r.lastByte-e.firstByte;if(n._blocksInProgress.has(i))continue;const o={layerName:n.name,firstByte:s,lastByte:a,pixelFormat:n.pixelFormat,blockIndex:i,blockShape:[r.bands.length].concat(n.bandShape),buffer:n.buffer,codec:r.codec.codec,filters:r.filters.map(e=>e.filter)};n._blocksInProgress.add(i),t.push(o)}return new ab(t,()=>{t.forEach(e=>n._blocksInProgress.delete(e.blockIndex))},(e,i)=>{if(t.forEach(e=>n._blocksInProgress.delete(e.blockIndex)),e)throw e;i.forEach(e=>{this.getLayer(e.layerName).processDecodedData(e)})})}}class sb{constructor(e,t){let{version:n,name:i,units:r,tileSize:s,pixelFormat:a,buffer:o,dataIndex:l}=e;if(this.version=n,1!==this.version)throw new $_("Cannot parse raster layer encoded with MRT version ".concat(n));this.name=i,this.units=r,this.tileSize=s,this.buffer=o,this.pixelFormat=eb[a],this.dataIndex=l,this.bandShape=[s+2*o,s+2*o,tb[this.pixelFormat]],this._decodedBlocks=new t_(t?t.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return tb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(e=>{let{bands:t}=e;return t}).flat()}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.put(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[n,i]of this.dataIndex.entries()){for(const[r,s]of i.bands.entries())if(s===e)return{bandIndex:t+r,blockIndex:n,blockBandIndex:r};t+=i.bands.length}break;case"number":for(const[n,i]of this.dataIndex.entries()){if(e>=t&&e<t+i.bands.length)return{bandIndex:e,blockIndex:n,blockBandIndex:e-t};t+=i.bands.length}break;default:throw new $_("Invalid band `".concat(JSON.stringify(e),"`. Expected string or integer."))}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let t=1/0,n=-1/0;const i=[],r=new Set;for(const s of e){const{blockIndex:e}=this.getBlockForBand(s);if(e<0)throw new $_("Invalid band: ".concat(JSON.stringify(s)));const a=this.dataIndex[e];i.includes(e)||i.push(e),r.add(e),t=Math.min(t,a.firstByte),n=Math.max(n,a.lastByte)}if(r.size>this.cacheSize)throw new $_("Number of blocks to decode (".concat(r.size,") exceeds cache size (").concat(this.cacheSize,")."));return{layerName:this.name,firstByte:t,lastByte:n,blockIndices:i}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:n}=this.getBlockForBand(e);if(t<0)throw new $_("Band not found: ".concat(JSON.stringify(e)));const i=this._decodedBlocks.get(t.toString());if(!i)throw new $_("Data for band ".concat(JSON.stringify(e),' of layer "').concat(this.name,'" not decoded.'));const r=this.dataIndex[t],s=this.bandShape.reduce((e,t)=>e*t,1),a=n*s,o=i.subarray(a,a+s);return{data:o,bytes:new Uint8Array(o.buffer).subarray(o.byteOffset,o.byteOffset+o.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:r.offset,scale:r.scale}}}rb.setPbf=function(e){ib=e};class ab{constructor(e,t,n){this.tasks=e,this._onCancel=t,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}rb.performDecoding=function(e,t){const n=new Uint8Array(e);return Promise.all(t.tasks.map(e=>{const{layerName:t,firstByte:i,lastByte:r,pixelFormat:s,blockShape:a,blockIndex:o,filters:l,codec:c}=e,d=n.subarray(i,r+1),u=new Uint32Array(a[0]*a[1]*a[2]);let h;if("gzip_data"!==c)throw new $_("Unhandled codec: ".concat(c));return h=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((s=function(e){31==e[0]&&139==e[1]&&8==e[2]||X_(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=2+(e[10]|e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[n++]);return n+(2&t)}(r=e))+8>r.length&&X_(6,"invalid gzip data"),function(e,t,n){var i=e.length;if(!i||t.f&&!t.l)return n||new k_(0);var r=!n,s=r||2!=t.i,a=t.i;r&&(n=new k_(3*i));var o,l,c=function(e){var t=n.length;if(e>t){var i=new k_(Math.max(2*t,e));i.set(n),n=i}},d=t.f||0,u=t.p||0,h=t.b||0,p=t.l,m=t.d,f=t.m,g=t.n,x=8*i;do{if(!p){d=G_(e,u,1);var y=G_(e,u+1,3);if(u+=3,!y){var v=e[(A=4+((u+7)/8|0))-4]|e[A-3]<<8,_=A+v;if(_>i){a&&X_(0);break}s&&c(h+v),n.set(e.subarray(A,_),h),t.b=h+=v,t.p=u=8*_,t.f=d;continue}if(1==y)p=H_,m=q_,f=9,g=5;else if(2==y){var b=G_(e,u,31)+257,w=G_(e,u+10,15)+4,j=b+G_(e,u+5,31)+1;u+=14;for(var N=new k_(j),S=new k_(19),k=0;k<w;++k)S[M_[k]]=G_(e,u+3*k,7);u+=3*w;var T=W_(S),C=(1<<T)-1,E=B_(S,T);for(k=0;k<j;){var A,M=E[G_(e,u,C)];if(u+=15&M,(A=M>>4)<16)N[k++]=A;else{var D=0,I=0;for(16==A?(I=3+G_(e,u,3),u+=2,D=N[k-1]):17==A?(I=3+G_(e,u,7),u+=3):18==A&&(I=11+G_(e,u,127),u+=7);I--;)N[k++]=D}}var P=N.subarray(0,b),R=N.subarray(b);f=W_(P),g=W_(R),p=B_(P,f),m=B_(R,g)}else X_(1);if(u>x){a&&X_(0);break}}s&&c(h+131072);for(var L=(1<<f)-1,z=(1<<g)-1,O=u;;O=u){var F=(D=p[Y_(e,u)&L])>>4;if((u+=15&D)>x){a&&X_(0);break}if(D||X_(2),F<256)n[h++]=F;else{if(256==F){O=u,p=null;break}var B=F-254;F>264&&(B=G_(e,u,(1<<(H=E_[k=F-257]))-1)+P_[k],u+=H);var V=m[Y_(e,u)&z],U=V>>4;if(V||X_(3),u+=15&V,R=L_[U],U>3){var H=A_[U];R+=Y_(e,u)&(1<<H)-1,u+=H}if(u>x){a&&X_(0);break}s&&c(h+131072);var q=h+B;if(h<R){var W=0-R,G=Math.min(R,q);for(W+h<0&&X_(3);h<G;++h)n[h]=(void 0)[W+h]}for(;h<q;++h)n[h]=n[h-R]}}t.l=p,t.p=O,t.b=h,t.f=d,p&&(d=1,t.m=f,t.d=m,t.n=g)}while(!d);return h!=n.length&&r?(o=n,(null==(l=h)||l>o.length)&&(l=o.length),new k_(o.subarray(0,l))):n.subarray(0,h)}(r.subarray(s,-8),{i:2},new k_(((n=r)[(i=n.length)-4]|n[i-3]<<8|n[i-2]<<16|n[i-1]<<24)>>>0))));var n,i,r,s;const a=J_[t];if(!a)throw new Error("Unhandled codec: ".concat(t));const o=new globalThis.DecompressionStream(a);return new Response(new Blob([e]).stream().pipeThrough(o)).arrayBuffer().then(e=>new Uint8Array(e))}(d,c).then(e=>(function(e,t){e.readFields(b_,t)}(new ib(e),u),new(0,nb[s])(u.buffer))),h.then(e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":j_(e,a);break;case"zigzag_filter":N_(e);break;case"bitshuffle_filter":S_(e,s);break;default:throw new $_('Unhandled filter "'.concat(l[t],'"'))}return{layerName:t,blockIndex:o,data:e}}).catch(e=>{throw e})}))},Gs(ab,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Gs(rb,"MapboxRasterTile"),Gs(sb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class ob{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const lb=["id","tile","layer","source","sourceLayer","state"];class cb{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=i,this.properties=e.properties,this.id=r}clone(){const e=new cb(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const t of lb)void 0!==this[t]&&(e[t]=this[t]);return e}}class db{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qs(Pi,16,0),this.featureIndexArray=new Zo,this.promoteId=t,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,s);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const i=e[t];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}0!==a&&(n[0]-=a,n[1]-=a,n[2]+=a,n[3]+=a),n[0]<Pi&&n[1]<Pi&&n[2]>=0&&n[3]>=0&&l.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Nc(new Jf(this.rawTileData)).layers,this.sourceLayerCoder=new ob(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t){var n=this;const{tilespaceGeometry:i,transform:r,tileTransform:s,pixelPosMatrix:a,availableImages:o,worldview:l}=t;this.loadVTLayers(),this.serializedLayersCache.clear();const c=i.bufferedTilespaceBounds,d=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(e,t,n,r)=>sd(i.bufferedTilespaceGeometry,e,t,n,r));d.sort(hb);let u=null;r.elevation&&d.length>0&&(u=Xy.create(r.elevation,this.tileID));const h={};let p;for(let m=0;m<d.length;m++){const t=d[m];if(t===p)continue;p=t;const c=this.featureIndexArray.get(t);let f=null;this.is3DTile?this.loadMatchingModelFeature(h,c,e,i,r,l):this.loadMatchingFeature(h,c,e,o,l,function(e,t,o){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return f||(f=xc(e,n.tileID.canonical,s)),t.queryIntersectsFeature(i,e,o,f,n.z,r,a,u,l)})}return h}loadMatchingFeature(e,t,n,i,r,s){const{featureIndex:a,bucketIndex:o,sourceLayerIndex:l,layoutVertexArrayOffset:c}=t,d=this.bucketLayerIDs[o],u=n.layers,h=Object.keys(u);if(h.length&&!Ue(h,d))return;const p=n.sourceCache,m=this.sourceLayerCoder.decode(l),f=this.vtLayers[m].feature(a),g=this.getId(f,m);for(let x=0;x<d.length;x++){const t=d[x];if(!u[t])continue;const{styleLayer:n,targets:o}=u[t];let l={};void 0!==g&&(l=p.getFeatureState(n.sourceLayer,g));const h=!s||s(f,n,l,c);if(!h)continue;const m=new cb(f,this.z,this.x,this.y,g);m.tile=this.tileID.canonical,m.state=l;let y=this.serializedLayersCache.get(t);y||(y=n.serialize(),y.id=t,this.serializedLayersCache.set(t,y)),m.source=y.source,m.sourceLayer=y["source-layer"],m.layer=Pe({},y),m.layer.paint=ub(y.paint,n.paint,f,l,i),m.layer.layout=ub(y.layout,n.layout,f,l,i);let v=!1;for(const e of o){this.updateFeatureProperties(m,e);const{filter:t}=e;if(t)if(f.properties=m.properties,t.needGeometry){const e=yc(f,!0);if(!t.filter(new xa(this.tileID.overscaledZ,{worldview:r}),e,this.tileID.canonical))continue}else if(!t.filter(new xa(this.tileID.overscaledZ,{worldview:r}),f))continue;v=!0,e.targetId&&this.addFeatureVariant(m,e)}v&&this.appendToResult(e,t,a,m,h)}}loadMatchingModelFeature(e,t,n,i,r,s){const{featureIndex:a,bucketIndex:o}=t,l=this.bucketLayerIDs[o],c=n.layers,d=Object.keys(c);if(!d.length||Ue(d,l))for(let u=0;u<l.length;u++){const t=l[u],{styleLayer:o,targets:d}=c[t];if("model"!==o.type)continue;const h=i.tile,p=h.getBucket(o);if(!(p&&p instanceof nv))continue;const m=ov(p,a,i,r);if(!m)continue;const{z:f,x:g,y:x}=h.tileID.canonical,{feature:y,intersectionZ:v,position:_}=m;let b={};void 0!==y.id&&(b=n.sourceCache.getFeatureState(o.sourceLayer,y.id));const w=new cb({},f,g,x,y.id);w.tile=this.tileID.canonical,w.state=b,w.properties=y.properties,w.geometry={type:"Point",coordinates:[_.lng,_.lat]};let j=this.serializedLayersCache.get(t);j||(j=o.serialize(),j.id=t,this.serializedLayersCache.set(t,j)),w.source=j.source,w.sourceLayer=j["source-layer"],w.layer=Pe({},j);let N=!1;for(const e of d){this.updateFeatureProperties(w,e);const{filter:t}=e;if(t)if(y.properties=w.properties,t.needGeometry){if(!t.filter(new xa(this.tileID.overscaledZ,{worldview:s}),y,this.tileID.canonical))continue}else if(!t.filter(new xa(this.tileID.overscaledZ,{worldview:s}),y))continue;N=!0,e.targetId&&this.addFeatureVariant(w,e)}N&&this.appendToResult(e,t,a,w,v)}}updateFeatureProperties(e,t,n){if(t.properties){const i={};for(const r in t.properties){const s=t.properties[r].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,n);null!=s&&(i[r]=s)}e.properties=i}}addFeatureVariant(e,t,n){const i={target:t.target,namespace:t.namespace,uniqueFeatureID:t.uniqueFeatureID};t.properties&&(i.properties=e.properties),e.variants=e.variants||{},e.variants[t.targetId]=e.variants[t.targetId]||[],e.variants[t.targetId].push(i)}appendToResult(e,t,n,i,r){let s=e[t];void 0===s&&(s=e[t]=[]),s.push({featureIndex:n,feature:i,intersectionZ:r})}lookupSymbolFeatures(e,t,n,i,r,s){const a={};this.loadVTLayers();for(const o of e)this.loadMatchingFeature(a,{bucketIndex:t,sourceLayerIndex:n,featureIndex:o,layoutVertexArrayOffset:0},i,r,s);return a}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(n),r=this.vtFeatures[i];if(r[t])return r[t];const s=this.vtLayers[i].feature(t);return r[t]=s,s}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const i=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[t];if(null!=i)if(Array.isArray(i)){if(!this.promoteIdExpression){const e=Rs(i);if("success"!==e.result){const t=e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", ");return void qe("Failed to create expression for promoteId: ".concat(t))}this.promoteIdExpression=e.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Jn),n=this.promoteIdExpression.evaluate({zoom:0},e)}else n=e.properties[i];"boolean"==typeof n&&(n=Number(n))}return n}}function ub(e,t,n,i,r){return Fe(e,(e,s)=>{const a=t instanceof Sa?t.get(s):null;return a&&a.evaluate?a.evaluate(n,i,void 0,r):a})}function hb(e,t){return t-e}Gs(db,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const pb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error("Got v".concat(i," data when expected v1."));const r=pb[15&n];if(!r)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new mb(a,s,r,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,i=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=pb.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-a%8)%8;if(r<0)throw new Error("Unexpected typed array class: ".concat(n,"."));i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+a+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return fb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:s,nodeSize:a}=this,o=[0,r.length-1,0],l=[];for(;o.length;){const c=o.pop()||0,d=o.pop()||0,u=o.pop()||0;if(d-u<=a){for(let a=u;a<=d;a++){const o=s[2*a],c=s[2*a+1];o>=e&&o<=n&&c>=t&&c<=i&&l.push(r[a])}continue}const h=u+d>>1,p=s[2*h],m=s[2*h+1];p>=e&&p<=n&&m>=t&&m<=i&&l.push(r[h]),(0===c?e<=p:t<=m)&&(o.push(u),o.push(h-1),o.push(1-c)),(0===c?n>=p:i>=m)&&(o.push(h+1),o.push(d),o.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:s}=this,a=[0,i.length-1,0],o=[],l=n*n;for(;a.length;){const c=a.pop()||0,d=a.pop()||0,u=a.pop()||0;if(d-u<=s){for(let n=u;n<=d;n++)vb(r[2*n],r[2*n+1],e,t)<=l&&o.push(i[n]);continue}const h=u+d>>1,p=r[2*h],m=r[2*h+1];vb(p,m,e,t)<=l&&o.push(i[h]),(0===c?e-n<=p:t-n<=m)&&(a.push(u),a.push(h-1),a.push(1-c)),(0===c?e+n>=p:t+n>=m)&&(a.push(h+1),a.push(d),a.push(1-c))}return o}}function fb(e,t,n,i,r,s){if(r-i<=n)return;const a=i+r>>1;gb(e,t,a,i,r,s),fb(e,t,n,i,a-1,1-s),fb(e,t,n,a+1,r,1-s)}function gb(e,t,n,i,r,s){for(;r>i;){if(r-i>600){const a=r-i+1,o=n-i+1,l=Math.log(a),c=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*c*(a-c)/a)*(o-a/2<0?-1:1);gb(e,t,n,Math.max(i,Math.floor(n-o*c/a+d)),Math.min(r,Math.floor(n+(a-o)*c/a+d)),s)}const a=t[2*n+s];let o=i,l=r;for(xb(e,t,i,n),t[2*r+s]>a&&xb(e,t,i,r);o<l;){for(xb(e,t,o,l),o++,l--;t[2*o+s]<a;)o++;for(;t[2*l+s]>a;)l--}t[2*i+s]===a?xb(e,t,i,l):(l++,xb(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function xb(e,t,n,i){yb(e,n,i),yb(t,2*n,2*i),yb(t,2*n+1,2*i+1)}function yb(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function vb(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}e.$=$n,e.A=Kt,e.B=Ln,e.C=Ya,e.D=Dp,e.E=en,e.F=2,e.G=Zg,e.H=Gg,e.I=tn,e.J=Zn,e.K=class extends Uy{},e.L=pn,e.M=Ma,e.N=Ns,e.O=bs,e.P=_e,e.Q=js,e.R=Dt,e.S=Ps,e.T=hm,e.U=Da,e.V=Uy,e.W=Os,e.X=Rs,e.Y=hr,e.Z=mr,e._=ur,e.a=function(e){return it.API_CDN_URL_REGEX.test(e)},e.a$=Le,e.a0=sn,e.a1=Ia,e.a2=Ss,e.a3=ws,e.a4=function(e){const t=e.value;let n=[];if(!t)return n;const i=Zn(t);return"string"!==i?(n=n.concat([new Uy(e.key,t,'string expected, "'.concat(i,'" found'))]),n):(Hy(t,!0)||(n=n.concat([new Uy(e.key,t,'invalid url "'.concat(t,'"'))])),n)},e.a5=Aa,e.a6=_a,e.a7=Ea,e.a8=ka,e.a9=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return Ye(e.expression.evaluate(t))}interpolate(e,t,n){return{x:dn(e.x,t.x,n),y:dn(e.y,t.y,n),z:dn(e.z,t.z,n),azimuthal:dn(e.azimuthal,t.azimuthal,n),polar:dn(e.polar,t.polar,n)}}},e.aA=K,e.aB=Rl,e.aC=rd,e.aD=Jl,e.aE=uc,e.aF=function(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n},e.aG=Zl,e.aH=$l,e.aI=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,n]=r.result;return this.scheduler?this.scheduler.add(()=>{i(e,n)},t):i(e,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n((n,i)=>{r.result=[n,i];for(const e of r.callbacks)this.scheduler?this.scheduler.add(()=>{e(n,i)},t):e(n,i);setTimeout(()=>delete this.entries[e],3e3)})),()=>{r.result||(r.callbacks=r.callbacks.filter(e=>e!==i),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}},e.aJ=function(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},t=>{const i=Lt(e.request,(e,i,r,s)=>{e?t(e):i&&t(null,{vectorTile:n?void 0:new Nc(new Jf(i)),rawData:i,cacheControl:r,expires:s})});return()=>{i.cancel(),t()}},t)},e.aK=function(e){Nt++,Nt>yt&&(e.getActor().send("enforceCacheSizeLimit",xt),Nt=0)},e.aL=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.aM=yd,e.aN=Dy,e.aO=Oy,e.aP=Ay,e.aQ=function(e,t){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let i=0;i<e.length;i++){const t=document.createElement("source");zt(e[i])||(n.crossOrigin="Anonymous"),t.src=e[i],n.appendChild(t)}return{cancel:()=>{}}},e.aR=pm,e.aS=function(e){return fetch(e).then(e=>e.arrayBuffer()).then(t=>cm(t,0,e))},e.aT=Gm,e.aU=class{constructor(e,t,n,i){this.id=e,this.position=null!=t?new Yl(t[0],t[1]):new Yl(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(d(e.matrix,t,e.matrix),e.meshes)for(const n of e.meshes){const t=Vc.applyTransformFast(n.aabb,e.matrix);this.aabb.encapsulate(t)}if(e.children)for(const n of e.children)this._applyTransformations(n,e.matrix)}computeBoundsAndApplyParent(){const e=l([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Im(this.matrix,this,e.transform,this.position,t,n,i,r,s,a)}upload(e){if(!this.uploaded){for(const t of this.nodes)Lm(t,e);for(const e of this.nodes)zm(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Om(e)}},e.aV=Oe,e.aW=Lx,e.aX=tc,e.aY=nc,e.aZ=ro,e.a_=No,e.aa=xa,e.ab=zs,e.ac=cc,e.ad=F,e.ae=w,e.af=Me,e.ag=Sa,e.ah=qd,e.ai=dn,e.aj=Pi,e.ak=un,e.al=Ne,e.am=an,e.an=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,n]=e;const i=Ye([1,t,n]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:dn(e.x,t.x,n),y:dn(e.y,t.y,n),z:dn(e.z,t.z,n)}}},e.ao=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=new _e(n,n),s=e.sub(r),a=t.add(r),o=[s,new _e(a.x,s.y),a,new _e(s.x,a.y)];return i&&o.push(s.clone()),o},e.ap=function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=De(i-1,-1,e.length-1),s=De(i+1,-1,e.length-1),a=e[i],o=e[s],l=e[r].sub(a).unit(),c=o.sub(a).unit(),d=c.angleWithSep(l.x,l.y),u=l.add(c).unit().mult(-1*t/Math.sin(d/2));n.push(a.add(u))}return n},e.aq=zx,e.ar=sd,e.as=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return j(((t.x-n)*e.scale-e.x)*Pi,(t.y*e.scale-e.y)*Pi,ic(t.z,t.y))},e.at=q,e.au=R,e.av=Pc,e.aw=jf,e.ax=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const s of e)t=Math.min(t,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x),r=Math.max(r,s.y);return{min:new _e(t,n),max:new _e(i,r)}},e.ay=Ae,e.az=d,e.b=function(e){return it.API_FONTS_REGEX.test(e)},e.b$=Sx,e.b0=Bo,e.b1=fy,e.b2=function(){ga.isLoading()||ga.isLoaded()||"deferred"!==ma()||fa()},e.b3=Pa,e.b4=yc,e.b5=cb,e.b6=Xe,e.b7=vf,e.b8=ch,e.b9=xc,e.bA=function(e,t){const{x:n,y:i}=e.point,r=Hd(n,i,e.worldSize/e._pixelsPerMercatorPixel,0,0);return d(r,r,Bd(Ad(t)))},e.bB=i,e.bC=U,e.bD=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.bE=M,e.bF=z,e.bG=L,e.bH=zg,e.bI=fg,e.bJ=Lg,e.bK=function(e,t,n,i,r){const s=5*t+2;e.float32[s+0]=n,e.float32[s+1]=i,e.float32[s+2]=r},e.bL=uy,e.bM=oe,e.bN=de,e.bO=le,e.bP=ge,e.bQ=De,e.bR=function(e,t,i,r){var s=new n(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s},e.bS=_p,e.bT=Yc,e.bU=qf,e.bV=kh,e.bW=Vy,e.bX=Rh,e.bY=Lh,e.bZ=kg,e.b_=xx,e.ba=no,e.bb=Po,e.bc=Nd,e.bd=tl,e.be=vu,e.bf=ky,e.bg=function(e,t){const n=qd(t.zoom);if(0===n)return Ad(e);const i=Pd(e),r=Rd(i),s=Jl(i.getWest())*t.worldSize,a=Jl(i.getEast())*t.worldSize,o=$l(i.getNorth())*t.worldSize,l=$l(i.getSouth())*t.worldSize,d=[s,o,0],u=[a,o,0],h=[s,l,0],p=[a,l,0],m=c([],t.globeMatrix);return F(d,d,m),F(u,u,m),F(h,h,m),F(p,p,m),r[0]=Md(r[0],h,n),r[1]=Md(r[1],p,n),r[2]=Md(r[2],u,n),r[3]=Md(r[3],d,n),Vc.fromPoints(r)},e.bh=Fd,e.bi=c,e.bj=Ld,e.bk=Md,e.bl=io,e.bm=jd,e.bn=g,e.bo=u,e.bp=rb,e.bq=Jf,e.br=Lt,e.bs=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n},e.bt=Ie,e.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.bv=be,e.bw=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.bx=l,e.by=f,e.bz=o,e.c=st,e.c$=45,e.c0=mb,e.c1=A,e.c2=G,e.c3=J,e.c4=function(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*o,e[1]=r*l-i*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e},e.c5=$,e.c6=Qe,e.c7=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.c8=y,e.c9=function(e,t,n,i,r){var s,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(s=1/(i-r)),e[14]=2*r*i*s):(e[10]=-1,e[14]=-2*i),e},e.cA=gd,e.cB=Id,e.cC=function(e,t,n,i,r,s,a,o,l){if("globe"===l.name)return Id(e,t,new gd(n,i,r),!1);const c=Lx({z:n,x:i,y:r},l);return new Vc([(s+c.x/c.scale)*t,t*(c.y/c.scale),a],[(s+c.x2/c.scale)*t,t*(c.y2/c.scale),o])},e.cD=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},e.cE=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},e.cF=function(e){const t=Math.round((e+45+360)%360/90)%4;return ke[t]},e.cG=rc,e.cH=Z,e.cI=zl,e.cJ=function(e){const t=l(new Float64Array(16));d(t,e.pixelMatrix,e.globeMatrix);const n=[0,Vl,0],i=[0,Ul,0];return F(n,n,t),F(i,i,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Gd(e,new Yl(e.center.lat,90)),i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Gd(e,new Yl(e.center.lat,-90))]},e.cK=function(e,t){const{scale:n}=e.tileTransform,i=n*Pi/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return function(e,t,n){var i=t[1],r=t[2],s=t[3],a=n[0],o=n[1];return e[0]=t[0]*a,e[1]=i*a,e[2]=r*o,e[3]=s*o,e}(new Float32Array(4),t.inverseAdjustmentMatrix,[i,i])},e.cL=jm,e.cM=v,e.cN=bm,e.cO=function(e){const t=bm(e,!0);return i([],[t[0],t[1],t[4],t[5]])},e.cP=h,e.cQ=Rc,e.cR=p,e.cS=function(e){const{x:t,y:n}=e.point,{lng:i,lat:r}=e._center;return Hd(t,n,e.worldSize,i,r)},e.cT=T,e.cU=Se,e.cV=vd,e.cW=ad,e.cX=Ll,e.cY=function(e,t,n){let i=0;for(let r=0;r<2;++r){const n=0;e[r]>n&&(i+=(e[r]-n)*(e[r]-n)),t[r]<n&&(i+=(n-t[r])*(n-t[r]))}return i},e.cZ=function(e){return e*e*e*e*e},e.c_=Ql,e.ca=function(e,t,n,i,r,s,a){var o=1/(t-n),l=1/(i-r),c=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*o,e[13]=(r+i)*l,e[14]=(a+s)*c,e[15]=1,e},e.cb=ec,e.cc=function(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},e.cd=ul,e.ce=ml,e.cf=hl,e.cg=pl,e.ch=yl,e.ci=Yl,e.cj=ry,e.ck=function(){var e=new n(4);return n!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.cl=function(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*o,e[1]=r*l+a*o,e[2]=i*-o+s*l,e[3]=r*-o+a*l,e},e.cm=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.cn=H,e.co=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.cp=re,e.cq=V,e.cr=xd,e.cs=3,e.ct=2,e.cu=7,e.cv=6,e.cw=O,e.cx=_,e.cy=Bc,e.cz=wm,e.d=function(e){return it.API_TILEJSON_REGEX.test(e)},e.d$=(e,t,n,i,r,s,a,o,l,c)=>{const d=e.transform,u=d.calculatePixelsToTileUnitsMatrix(t),h="none"===n.paint.get("line-trim-color-use-theme").constantOr("default"),p=d.pitch<15?Nf(.07,.7,Ae((14-d.zoom)/5,0,1)):.07;return{u_matrix:kf(e,t,n,i),u_pixels_to_tile_units:u,u_device_pixel_ratio:s,u_width_scale:a,u_floor_width_scale:o,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:Cf(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Sf(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(h?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:p,u_tile_to_meter:lc(t.tileID.canonical,0),u_ground_shadow_factor:c}},e.d0=fl,e.d1=function(e,t,n){const i=Math.sqrt(e*e+t*t+n*n),r=i>0?Math.acos(n/i)*je:0;let s=0!==e||0!==t?Math.atan2(-t,-e)*je+90:0;return s<0&&(s+=360),[i,s,r]},e.d2=j,e.d3=Ye,e.d4=lc,e.d5=S,e.d6=Vc,e.d7=k,e.d8=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.d9=Hy,e.dA=Pd,e.dB=function(e){const t=rc-5;e=Ae(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(Ne(e))),3);return Math.round(n*(Bl.length-1))},e.dC=function(e,t,n,i){const r=t.getNorth(),s=t.getSouth(),o=t.getWest(),l=t.getEast(),c=1<<e.z,d=l-o,u=r-s,h=d/Fl,p=-u/Bl[n],m=[0,h,0,p,0,0,r,o,0];if(e.z>0){const e=180/i;a(m,m,[e/d+1,0,0,0,e/u+1,0,-.5*e/h,.5*e/p,1])}return m[2]=c,m[5]=e.x,m[8]=e.y,m},e.dD=Ad,e.dE=function(e,t,n){const i=l(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return m(i,n.globeMatrix,r),Float32Array.from(i)},e.dF=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,i=1<<n,r=Math.floor(e.x),s=Math.floor((e.x-r)*i),a=Math.floor(e.y*i),o=this.findDEMTileFor(new yd(n,r,n,s,a));return!(!o||!o.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,s=1<<r,a=Math.floor(e.x),o=e.x-a,l=new yd(r,a,r,Math.floor(o*s),Math.floor(e.y*s)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const d=c.dem,u=1<<c.tileID.canonical.z,h=(o*u-c.tileID.canonical.x)*d.dim,p=(e.y*u-c.tileID.canonical.y)*d.dim,m=Math.floor(h),f=Math.floor(p);return(n?this.exaggeration():1)*dn(dn(d.get(m,f),d.get(m,f+1),p-f),dn(d.get(m+1,f),d.get(m+1,f+1),p-f),h-m)}getAtTileOffset(e,t,n){const i=1<<e.canonical.z;return this.getAtPointOrZero(new cc(e.wrap+(e.canonical.x+t/Pi)/i,(e.canonical.y+n/Pi)/i))}getAtTileOffsetFunc(e,t,n,i){return r=>{const s=this.getAtTileOffset(e,r.x,r.y),a=i.upVector(e.canonical,r.x,r.y);return A(a,a,s*i.upVectorScale(e.canonical,t,n).metersToTile),a}}getForTilePoints(e,t,n,i){if(this.isUsingMockSource())return!1;const r=Xy.create(this,e,i);return!!r&&(t.forEach(e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],n)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z;let s=e.canonical.x/r-i.canonical.x,a=e.canonical.y/r-i.canonical.y,o=0;for(let l=0;l<e.canonical.z-i.canonical.z&&!n.leaves[o];l++){s*=2,a*=2;const e=2*Math.floor(a)+Math.floor(s);o=n.childOffsets[o]+e,s%=1,a%=1}return{min:this.exaggeration()*n.minimums[o],max:this.exaggeration()*n.maximums[o]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,n=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const r of e){const e=this.getMinMaxForTile(r.tileID);e&&(n=Math.min(n,e.min),i=Math.max(i,e.max),t=!0)}return t?{min:n,max:i}:null}},e.dG=pu,e.dH=Sd,e.dI=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.dJ=r,e.dK=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.dL=B,e.dM=Ud,e.dN=et,e.dO=tt,e.dP=256,e.dQ=function(e,t){const n=[0,0,0];return F(n,n,Fd(Ad(t.canonical))),F(n,n,e),n},e.dR=e=>({u_matrix:new yl(e),u_texsize:new pl(e),u_pixels_to_tile_units:new bl(e),u_device_pixel_ratio:new hl(e),u_width_scale:new hl(e),u_floor_width_scale:new hl(e),u_image:new ul(e),u_units_to_pixels:new pl(e),u_tile_units_to_pixels:new hl(e),u_alpha_discard_threshold:new hl(e),u_trim_offset:new pl(e),u_trim_fade_range:new pl(e),u_trim_color:new fl(e),u_emissive_strength:new hl(e),u_zbias_factor:new hl(e),u_tile_to_meter:new hl(e),u_ground_shadow_factor:new ml(e),u_pattern_transition:new hl(e)}),e.dS=e=>({u_matrix:new yl(e),u_pixels_to_tile_units:new bl(e),u_device_pixel_ratio:new hl(e),u_width_scale:new hl(e),u_floor_width_scale:new hl(e),u_units_to_pixels:new pl(e),u_dash_image:new ul(e),u_gradient_image:new ul(e),u_image_height:new hl(e),u_texsize:new pl(e),u_tile_units_to_pixels:new hl(e),u_alpha_discard_threshold:new hl(e),u_trim_offset:new pl(e),u_trim_fade_range:new pl(e),u_trim_color:new fl(e),u_emissive_strength:new hl(e),u_zbias_factor:new hl(e),u_tile_to_meter:new hl(e),u_ground_shadow_factor:new ml(e)}),e.dT=e=>({u_camera_to_center_distance:new hl(e),u_extrude_scale:new bl(e),u_device_pixel_ratio:new hl(e),u_matrix:new yl(e),u_inv_rot_matrix:new yl(e),u_merc_center:new pl(e),u_tile_id:new ml(e),u_zoom_transition:new hl(e),u_up_dir:new ml(e),u_emissive_strength:new hl(e)}),e.dU=wo,e.dV=Hf,e.dW=Qd,e.dX=(e,t,n,i,r,s)=>{const a=e.transform,o="globe"===a.projection.name;let l;if("map"===s.paint.get("circle-pitch-alignment"))if(o){const e=Ud(a.zoom,t.canonical)*a._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=a.calculatePixelsToTileUnitsMatrix(n);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(a.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:pt.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Kd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:s.paint.get("circle-emissive-strength")};if(o){c.u_inv_rot_matrix=i,c.u_merc_center=r,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=qd(a.zoom);const e=r[0]*Pi,n=r[1]*Pi;c.u_up_dir=a.projection.upVector(new gd(0,0,0),e,n)}return c},e.dY=Tf,e.dZ=zn,e.d_=(e,t,n,i,r,s,a,o,l,c)=>{const d=e.transform,u=d.pitch<15?Nf(.07,.7,Ae((14-d.zoom)/5,0,1)):.07,h="none"===n.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:kf(e,t,n,i),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_width_scale:s,u_floor_width_scale:a,u_image:0,u_tile_units_to_pixels:Sf(t,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:o,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(h?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:u,u_tile_to_meter:lc(t.tileID.canonical,0),u_ground_shadow_factor:l,u_pattern_transition:c}},e.da=function(e,t){return e.readFields(gv,{icons:[]},t)},e.db=Rp,e.dc=nx,e.dd=tx,e.de=Pt,e.df=ua,e.dg=ft,e.dh=Xt,e.di=Ve,e.dj=function(e){const t=e.indexOf(Ga);return t>=0?e.slice(0,t):e},e.dk=function(e){return e.indexOf(Ga)>=0},e.dl=function(e){const t=e.lastIndexOf(Ga);return t>=0?e.slice(t+1):""},e.dm=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t},e.dn=function(e,t,n,i){return"custom"===e.type?new Fy(e,t):new lv[e.type](e,t,n,i)},e.dp=Be,e.dq=function(e){const t=e.indexOf(Ga);return t>=0?e.slice(t+1):""},e.dr=class extends cb{constructor(e,t){super(e._vectorTileFeature,e._z,e._x,e._y,e.id),e.state&&(this.state=Object.assign({},e.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=e.source,this.sourceLayer=e.sourceLayer,this.layer=e.layer)}toJSON(){const e=super.toJSON();return e.target=this.target,e.namespace=this.namespace,e}},e.ds=pa,e.dt=Rt,e.du=function(e){return e({pluginStatus:ca,pluginURL:da}),pa.on("pluginStateChange",e),e},e.dv=gl,e.dw=class extends dl{constructor(e){super(e),this.current=vl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},e.dx=Te,e.dy=function(e,t,n){const i=qd(n.zoom),r=e.style.map._antialias,s=e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!r&&!s},e.dz=function(e){const t=e.pixelsPerMeter,n=t/ec(1,e.center.lat),i=l(new Float64Array(16));return u(i,i,[e.point.x,e.point.y,0]),h(i,i,[n,n,t]),Float32Array.from(i)},e.e=it,e.e$=ma,e.e0=ze,e.e1=mu,e.e2=ic,e.e3=_d,e.e4=ip,e.e5=up,e.e6=Wh,e.e7=450,e.e8=7,e.e9=ac,e.eA=function(e,t,i,r,s,a,o,l,c,d,u,h,p,m,f,g){var x=new n(16);return x[0]=e,x[1]=t,x[2]=i,x[3]=r,x[4]=s,x[5]=a,x[6]=o,x[7]=l,x[8]=c,x[9]=d,x[10]=u,x[11]=h,x[12]=p,x[13]=m,x[14]=f,x[15]=g,x},e.eB=Wl,e.eC=Mo,e.eD=Ao,e.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new _e(1/0,1/0),max:new _e(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Mh(new _e(0,0),new _e(Pi,Pi),e),i=[];if(t&&!Eh(n,this._globalClipBounds))return i;for(const r of this._activeRegions){if(r.hiddenByOverlap)continue;if(!Eh(n,r))continue;const t=Dh(r.min,r.max,e);i.push({min:t.min,max:t.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId,order:r.order,clipMask:r.clipMask,clipScope:r.clipScope})}return i}setSources(e){this._setSources(e.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const n of e.cache.getVisibleCoordinates()){const i=e.cache.getTile(n).buckets[e.layer];i&&i.updateFootprints(n.toUnwrapped(),t)}return t},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(e){const t=e.getFootprints();if(0===t.length)return;const n=e.getOrder(),i=e.getClipMask(),r=e.getClipScope();for(const s of t){if(!s.footprint)continue;const e=Mh(s.footprint.min,s.footprint.max,s.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:s.id,footprint:s.footprint,order:n,clipMask:i,clipScope:r})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,t)=>e.priority-t.priority||Th(e.min,t.min)||Th(e.max,t.max)||e.order-t.order||e.clipMask-t.clipMask||function(e,t){const n=(e,t)=>e+t;return e.length-t.length||e.reduce(n,"").localeCompare(t.reduce(n,""))}(e.clipScope,t.clipScope));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0;for(;!e&&t!==this._activeRegions.length;){const n=this._activeRegions[t],i=this._prevRegions[t];e=n.priority!==i.priority||!Ch(n,i)||n.order!==i.order||n.clipMask!==i.clipMask||!be(n.clipScope,i.clipScope),++t}}if(e){++this._updateTime;for(const t of this._activeRegions)t.order!==Nh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const n=t[e].priority;for(;e<t.length&&t[e].priority===n;)++e;return e};if(this._sourceIds.length>1){let t=0,n=e(t);for(;t!==n;){let i=t;const r=t;for(;i!==n;){const e=this._activeRegions[i];e.hiddenByOverlap=!1;for(let t=0;t<r;t++){const n=this._activeRegions[t];if(!n.hiddenByOverlap&&e.order===Nh&&Eh(e,n)&&(e.hiddenByOverlap=Ph(e.footprint,e.tileId,n.footprint,n.tileId),e.hiddenByOverlap))break}++i}t=n,n=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.eF=Nh,e.eG=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const n=new no,i=new No,r=[],s=e+1+2,a=t[0]+1,o=t[0]+1+(1+t.length),l=(e,t,n)=>{let i=e===s-1?e-2:0===e?e:e-1;return i+=n?24575:0,[i,t]};for(let c=0;c<s;++c)n.emplaceBack(...l(c,0,!0));for(let c=0;c<a;++c)for(let e=0;e<s;++e)n.emplaceBack(...l(e,c,(0===e||e===s-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<s;++t)n.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=i.length,a=t[c]+1+2,l=new No;for(let n=0;n<a-1;n++){const e=n===a-2,r=e?s*(o-t.length+c-n):s;for(let t=0;t<s-1;t++){const a=n*s+t;0===n||e||0===t||t===s-2?(l.emplaceBack(a+1,a,a+r),l.emplaceBack(a+r,a+r+1,a+1)):(i.emplaceBack(a+1,a,a+r),i.emplaceBack(a+r,a+r+1,a+1))}}const d=tl.simpleSegment(0,e,n.length,i.length-e);for(let t=0;t<l.uint16.length;t+=3)i.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const u=tl.simpleSegment(0,e,n.length,i.length-e);r.push({withoutSkirts:d,withSkirts:u})}return{vertices:n,indices:i,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(Fl,Bl);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Nd.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new No;for(let a=0;a<=Fl;a++)t.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new Co,i=new Co,r=new Co,s=new Co;this._poleSegments=[];for(let a=0,o=0;a<Ll;a++){const e=360/(1<<a);n.emplaceBack(0,-Rl,0,.5,0),i.emplaceBack(0,-Rl,0,.5,1),r.emplaceBack(0,-Rl,0,.5,.5),s.emplaceBack(0,-Rl,0,.5,.5);for(let t=0;t<=Fl;t++){let a=t/Fl,o=0;const l=dn(0,e,a),[c,d,u]=Hl(Zd,Xd,l,Rl);n.emplaceBack(c,d,u,a,o),i.emplaceBack(c,d,u,a,1-o);const h=Ne(l);a=.5+.5*Math.sin(h),o=.5+.5*Math.cos(h),r.emplaceBack(c,d,u,a,o),s.emplaceBack(c,d,u,a,1-o)}this._poleSegments.push(tl.simpleSegment(o,0,66,64)),o+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,wd,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,wd,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(r,wd,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(s,wd,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.eH=Sh,e.eI=Ce,e.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.eK=Ee,e.eL=oc,e.eM=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.eN=W,e.eO=ql,e.eP=I,e.eQ=N,e.eR=function(e){let[t,n,i]=e;const r=Math.hypot(t,n,i),s=Math.atan2(t,i),a=.5*Math.PI-Math.acos(-n/r);return new Yl(Se(s),Se(a))},e.eS=X,e.eT=Sm,e.eU=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==Ke){const t=e.navigator?e.navigator.userAgent:null;Ke=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ke}(e)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},e.eV=function(e,t){xt=e,yt=t},e.eW=Gd,e.eX=Wd,e.eY=function(e){const t=[0,0,0],n=l(new Float64Array(16));return d(n,e.pixelMatrix,e.globeMatrix),F(t,t,n),new _e(t[0],t[1])},e.eZ=function(){const e=Ip;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Ap),Ip=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.e_=function(){Rp().acquire(Ap)},e.ea=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=r,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.eb=My,e.ec=eo,e.ed=zo,e.ee=256,e.ef=Bd,e.eg=uo,e.eh=m,e.ei=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.ej=Co,e.ek=Eo,e.el=us,e.em=function(e,t,n,i,r){return Ae((e-t)/(n-t)*(r-i)+i,i,r)},e.en=ee,e.eo=function(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],d=t[8],u=d*a-o*c,h=-d*s+o*l,p=c*s-a*l,m=n*u+i*h+r*p;return m?(e[0]=u*(m=1/m),e[1]=(-d*i+r*c)*m,e[2]=(o*i-r*a)*m,e[3]=h*m,e[4]=(d*n-r*l)*m,e[5]=(-o*n+r*s)*m,e[6]=p*m,e[7]=(-c*n+i*l)*m,e[8]=(a*n-i*s)*m,e):null},e.ep=2,e.eq=P,e.er=Em,e.es=[1,1,1],e.et=class{constructor(e,t,n,i){this.context=e,this.format=i,this.size=n,this.texture=e.gl.createTexture();const[r,s,a]=this.size,{gl:o}=e;o.bindTexture(o.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1),o.texImage3D(o.TEXTURE_3D,0,this.format,r,s,a,0,dm(this.format),um(this.format),t.data)}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_3D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.eu=Xy,e.ev=Y,e.ew=function(e,t,n,i){var r=t[0],s=t[1],a=t[2],o=t[3];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=a+i*(n[2]-a),e[3]=o+i*(n[3]-o),e},e.ex=Dm,e.ey=vo,e.ez=Do,e.f=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t))))},e.f0=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ca===oa.deferred||ca===oa.loading||ca===oa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");da=pt.resolveURL(e),ca=oa.deferred,la=t,ha(),n||fa()},e.f1=function(e){Bp=pt.resolveURL(e),Up||(Up=new Dp(Rp(),new en)),Up.broadcast("setMeshoptUrl",Bp)},e.f2=Yp,e.f3=function(e){Op=pt.resolveURL(e),Up||(Up=new Dp(Rp(),new en)),Up.broadcast("setDracoUrl",Op)},e.f4=Gp,e.f5=Ep,e.f6=function(e){const t=wt();if(!t)return;const n=t.delete(gt);e&&n.then(()=>e()).catch(e)},e.f7=Mp,e.f8=Gs,e.f9=uu,e.fa=ex,e.fb=ob,e.fc=db,e.fd=ff,e.fe=kc,e.ff="hd_road_elevation",e.fg=qc,e.fh=Fe,e.fi=Qu,e.fj=Xg,e.fk=Yg,e.fl=function(e,t,n,i,r,s,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0;e.createArrays(),e.tilePixelRatio=Pi/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const u=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,p={};p.scaleFactor=o,p.textSizeScaleRange=u.get("text-size-scale-range"),p.iconSizeScaleRange=u.get("icon-size-scale-range");const[m,f]=p.textSizeScaleRange,[g,x]=p.iconSizeScaleRange;p.textScaleFactor=Ae(p.scaleFactor,m,f),p.iconScaleFactor=Ae(p.scaleFactor,g,x);const y=h["text-size"],v=h["icon-size"];if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;p.compositeTextSizes=[y.possiblyEvaluate(new xa(t,{worldview:d}),s),y.possiblyEvaluate(new xa(n,{worldview:d}),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;p.compositeIconSizes=[v.possiblyEvaluate(new xa(t,{worldview:d}),s),v.possiblyEvaluate(new xa(n,{worldview:d}),s)]}p.layoutTextSize=y.possiblyEvaluate(new xa(a+1,{worldview:d}),s),p.layoutIconSize=v.possiblyEvaluate(new xa(a+1,{worldview:d}),s),p.textMaxSize=y.possiblyEvaluate(new xa(18,{worldview:d}),s);const _=u.get("symbol-placement"),b="map"===u.get("text-rotation-alignment")&&"point"!==_,w=u.get("text-size");let j=!1;const N=[];for(const S of e.features){const a=u.get("text-font").evaluate(S,{},s).join(","),o=w.evaluate(S,{},s)*p.textScaleFactor,m=p.layoutTextSize.evaluate(S,{},s)*p.textScaleFactor,f=p.layoutIconSize.evaluate(S,{},s)*p.iconScaleFactor,g={horizontal:{},vertical:void 0},x=S.text;let y,v=[0,0];if(x){const i=x.toString(),c=u.get("text-letter-spacing").evaluate(S,{},s)*qf,d=u.get("text-line-height").evaluate(S,{},s)*qf,h=$s(i)?c:0,p=u.get("text-anchor").evaluate(S,{},s),f=u.get("text-variable-anchor");if(!f){const e=u.get("text-radial-offset").evaluate(S,{},s);if(e)v=xx(p,[e*qf,fx]);else{const e=u.get("text-offset").evaluate(S,{},s);v=[e[0]*qf,e[1]*qf]}}let y=b?"center":u.get("text-justify").evaluate(S,{},s);const w="point"===_,j=w?u.get("text-max-width").evaluate(S,{},s)*qf:1/0,N=s=>{e.allowVerticalPlacement&&Js(i)&&(g.vertical=yg(x,t,n,r,a,j,d,p,s,h,v,fg.vertical,!0,m,o,l))};if(!b&&f){const e="auto"===y?f.map(e=>Sx(e)):[y];let i=!1;for(let s=0;s<e.length;s++){const c=e[s];if(!g.horizontal[c])if(i)g.horizontal[c]=g.horizontal[0];else{const e=yg(x,t,n,r,a,j,d,"center",c,h,v,fg.horizontal,!1,m,o,l);e&&(g.horizontal[c]=e,i=1===e.positionedLines.length)}}N("left")}else{if("auto"===y&&(y=Sx(p)),w||u.get("text-writing-mode").indexOf("horizontal")>=0||!Js(i)){const e=yg(x,t,n,r,a,j,d,p,y,h,v,fg.horizontal,!1,m,o,l);e&&(g.horizontal[y]=e)}N(w?"left":y)}}let k,T,C,E,A,M,D=!1;const I=u.get("icon-text-fit").evaluate(S,{},s);if(S.icon&&S.icon.hasPrimary()){const t=_x(S.icon,e.iconSizeData,h["icon-size"],s,e.zoom,S,l,p.iconScaleFactor,d);k=t.iconPrimary,C=t.iconSecondary;const n=k.toString();if(T=i.get(n),T&&(A=u.get("icon-offset").evaluate(S,{},s),M=u.get("icon-anchor").evaluate(S,{},s),y=Eg(r.get(n),C?r.get(C.toString()):void 0,A,M),D=T.sdf,void 0===e.sdfIcons?e.sdfIcons=T.sdf:e.sdfIcons!==T.sdf&&qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(T.pixelRatio!==e.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0)),C){const e=C.toString();E=i.get(e)}}j=j||!(!S.icon||!S.icon.hasSecondary());const P=Mx(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!P&&P.iconsInText);const R=m*p.textScaleFactor/qf,{defaultShapedIcon:L,verticallyShapedIcon:z}=kx(e,y,u,S,s,g,R,A,I);"none"!==I&&y&&(Mg(y)||Dg(y))&&(yx(0,T,k,y,L,I,c,i,r),yx(0,E,C,y,L,I,c,i,r),z&&(yx(0,T,k,y,z,I,c,i,r),yx(0,E,C,y,z,I,c,i,r))),y=L,N.push({feature:S,shapedTextOrientations:g,shapedText:P,shapedIcon:y,iconPrimary:k,iconSecondary:C,iconOffset:A,iconAnchor:M,verticallyShapedIcon:z,layoutTextSize:m,layoutIconSize:f,textOffset:v,isSDFIcon:D,iconTextFit:I})}return{featureData:N,sizes:p,hasAnySecondaryIcon:j,textAlongLine:b,symbolPlacement:_}},e.fm=Kg,e.fn=function(e,t,n,i,r,s,a,o,l,c){const{featureData:d,hasAnySecondaryIcon:u,sizes:h,textAlongLine:p,symbolPlacement:m}=t;for(const f of d){const{shapedIcon:t,verticallyShapedIcon:n,feature:s,shapedTextOrientations:d,shapedText:g,layoutTextSize:x,textOffset:y,isSDFIcon:v,iconPrimary:_,iconSecondary:b,iconTextFit:w,iconOffset:j}=f;wx(t,c.iconPositions,_,b),wx(n,c.iconPositions,_,b),jx(d,c.iconPositions),bx(_,b,c.iconPositions),(g||t)&&Tx(e,s,d,t,n,l,h,x,0,y,v,i,r,a,o,u,w,j,p,m)}n&&e.generateCollisionDebugBuffers(s,e.collisionBoxArray,h.textScaleFactor)},e.fo=Nc,e.fp=m_,e.fq=vc,e.fr=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==im){const n=new Uint32Array(e,0,7),[,,i,r,s,a]=n;t=n.byteLength+r+s+a+s,(i!==e.byteLength||t>=e.byteLength)&&qe("Invalid b3dm header information.")}return cm(e,t)},e.fs=function(e,t){const n=Gm(e);for(const i of n){for(const e of i.meshes)Ym(e);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(Xm(i.lights,t)))}return n},e.ft=nv,e.fu=Ze,e.fv=Cp,e.fw=ga,e.fx=oa,e.fy=function(e){jt(),null!=_t&&_t.then(t=>{t.keys().then(n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i]).catch(e=>qe(e.message))}).catch(e=>qe(e.message))}).catch(e=>qe(e.message))},e.g=function(e,t){return Rt(Pe(e,{method:"GET"}),t)},e.h=Pe,e.i=function(e){return it.API_STYLE_REGEX.test(e)&&!st(e)},e.j=function(e){return 0===e.indexOf("mapbox:")},e.k=rt,e.l=St,e.m=function(e){return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},e.n=function(e,t){return Rt(Pe(e,{type:"json"}),t)},e.o=Vt,e.p=function(e,t){return Rt(Pe(e,{method:"POST"}),t)},e.q=pt,e.r=hu,e.s=function(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}},e.t=ht,e.u=function(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()},e.v=function(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.w=qe,e.x=function(){return Pp||(Pp=new Mp),Pp},e.y=n_,e.z=Qt}),a(["./shared"],function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function n(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const i of e)t+="".concat(n(i),",");return"".concat(t,"]")}let t="{";for(const i of Object.keys(e).sort())t+="".concat(i,":").concat(n(e[i]),",");return"".concat(t,"}")}function i(t){let i="";for(const r of e.bu)i+="/".concat(n(t[r]));return i}class r{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,r,s){this._options=s;for(const n of t)this._layerConfigs[n.id]=n,(this._layers[n.id]=e.dn(n,this.scope,null,this._options)).compileFilter(s),this.keyCache[n.id]&&delete this.keyCache[n.id];for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const a=function(e,t){const r={};for(let a=0;a<e.length;a++){const s=e[a];let o=t&&t[s.id];o||("symbol"===s.type?o=s.id:(o=i(s),"line"===s.type&&s.paint&&function e(t){return"string"==typeof t&&"line-progress"===t||(Array.isArray(t)?t.some(e):!(!t||"object"!=typeof t)&&Object.values(t).some(e))}(s.paint["line-width"])&&(o+="/".concat(n(s.paint["line-width"]))))),t&&(t[s.id]=o);let l=r[o];l||(l=r[o]=[]),l.push(s)}const s=[];for(const n in r)s.push(r[n]);return s}(Object.values(this._layerConfigs),this.keyCache);for(const e of a){const t=e.map(e=>this._layers[e.id]),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const s=n.sourceLayer||"_geojsonTileLayer";let a=r[s];a||(a=r[s]=[]),a.push(t)}}}const s=1*e.fa;class a{constructor(t){const n={},i=[];for(const e in t){const r=t[e],a=n[e]={};for(const e in r.glyphs){const t=r.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?s:1,o={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};i.push(o),a[e]=o}}const{w:r,h:a}=e.H(i),o=new e.f9({width:r||1,height:a||1});for(const l in t){const i=t[l];for(const t in i.glyphs){const r=i.glyphs[+t];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const a=n[l][t],c=r.metrics.localGlyph?s:1;e.f9.copy(r.bitmap,o,{x:0,y:0},{x:a.x+c,y:a.y+c},r.bitmap)}}this.image=o,this.positions=n}}e.f8(a,"GlyphAtlas");class o{constructor(t){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.request&&t.request.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.aW(t.tileID.canonical,t.projection),this.projection=t.projection,this.worldview=t.worldview,this.localizableLayerIds=t.localizableLayerIds,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep,this.scaleFactor=t.scaleFactor,this.worldview=t.worldview}parse(t,n,i,r,s,o){this.status="parsing",this.data=t,this.collisionBoxArray=new e.b0;const c=new e.fb(Object.keys(t.layers).sort()),d=new e.fc(this.tileID,this.promoteId);d.bucketLayerIDs=[];const u={},h=new e.fd(256,256),p={featureIndex:d,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:h,availableImages:i,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},m=[],f=n.familiesBySource[this.source];for(const a in f){const n=t.layers[a];if(!n)continue;let s=!1,o=!1,h=!1;for(const e of f[a])"symbol"===e[0].type?s=!0:o=!0,e[0].is3D()&&"model"!==e[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!s)continue;if(!1===this.isSymbolTile&&!o)continue;1===n.version&&e.w('Vector tile source "'.concat(this.source,'" layer "').concat(a,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const g=c.encode(a),x=[];let y=!1;for(let t=0,i=0;t<n.length;t++){const r=n.feature(t),s=d.getId(r,a);if(this.localizableLayerIds&&this.localizableLayerIds.has(a)){const e=r.properties?r.properties.worldview:null;if(this.worldview&&"string"==typeof e)if("all"===e)r.properties.$localized=!0;else{if(!e.split(",").includes(this.worldview))continue;r.properties.$localized=!0,r.properties.worldview=this.worldview}}!y&&r.properties&&r.properties.hasOwnProperty(e.fe)&&(y=!0),x.push({feature:r,id:s,index:i,sourceLayerIndex:g}),i++}y&&!p.elevationFeatures&&t.layers.hasOwnProperty(e.ff)&&(p.elevationFeatures=e.fg.parseFrom(t.layers[e.ff],this.canonical));for(const t of f[a]){const n=t[0];if(this.extraShadowCaster&&(!n.is3D()||"model"===n.type))continue;if(void 0!==this.isSymbolTile&&"symbol"===n.type!==this.isSymbolTile)continue;if(n.minzoom&&this.zoom<Math.floor(n.minzoom))continue;if(n.maxzoom&&this.zoom>=n.maxzoom)continue;if("none"===n.visibility)continue;l(t,this.zoom,p.brightness,i,this.worldview);const s=u[n.id]=n.createBucket({index:d.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:g,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:r,worldview:this.worldview});d.bucketLayerIDs.push(t.map(t=>e.C(t.id,t.scope)));let a=s.prepare?s.prepare():null;null!=a?(a=a.then(()=>s.populate(x,p,this.tileID.canonical,this.tileTransform)),m.push(a)):s.populate(x,p,this.tileID.canonical,this.tileTransform)}}const g=()=>{let n,r,m,f,g,x;h.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},v=()=>{if(n)return this.status="done",o(n);if(this.extraShadowCaster)this.status="done",o(null,{buckets:Object.values(u).filter(e=>!e.isEmpty()),featureIndex:d,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:p.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(r&&m&&f){const t=new a(r),n=new Map;for(const[i,r]of m.entries()){const{imagePosition:t}=e.fj(i,r,e.fk);n.set(i,t)}const o={};for(const s in u){const a=u[s];a instanceof e.b1&&(l(a.layers,this.zoom,p.brightness,i,this.worldview),o[s]=e.fl(a,r,t.positions,m,n,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,g,this.worldview))}const c={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(s,m,g,()=>{c.iconsPending=!1,_(o,t,c)}),this.rasterizeIfNeeded(s,f,x,()=>{c.patternsPending=!1,_(o,t,c)})}},_=(t,n,r,s)=>{if(r.iconsPending||r.patternsPending)return;const a=new e.fm(m,f,this.lut);for(const o in u){const n=u[o];if(o in t)e.fn(n,t[o],this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,m,a);else if(n.hasPattern&&(n instanceof e.b7||n instanceof e.b8||n instanceof e.e4)){l(n.layers,this.zoom,p.brightness,i,this.worldview);const e=Object.fromEntries(a.patternPositions);n.addFeatures(p,this.tileID.canonical,e,i,this.tileTransform,this.brightness)}}this.status="done",o(null,{buckets:Object.values(u).filter(e=>!e.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:n.image,lineAtlas:h,imageAtlas:a,brightness:p.brightness})};if(!this.extraShadowCaster){const t=e.fh(p.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(t).length?s.send("getGlyphs",{uid:this.uid,stacks:t},(e,t)=>{n||(n=e,r=t,v())},void 0,!1,y):r={};const i=Array.from(p.iconDependencies.keys()).map(t=>e.I.parse(t));i.length?s.send("getImages",{images:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,t)=>{n||(n=e,m=new Map,g=this.updateImageMapAndGetImageTaskQueue(m,t,p.iconDependencies),v())},void 0,!1,y):(m=new Map,g=new Map);const a=Array.from(p.patternDependencies.keys()).map(t=>e.I.parse(t));a.length?s.send("getImages",{images:a,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,t)=>{n||(n=e,f=new Map,x=this.updateImageMapAndGetImageTaskQueue(f,t,p.patternDependencies),v())},void 0,!1,y):(f=new Map,x=new Map)}if(p.elevationFeatures&&p.elevationFeatures.length>0){const n=[];for(const t of Object.values(u))if(t instanceof e.b8){const e=t.getUnevaluatedPortalGraph();e&&n.push(e)}const i=e.fi.evaluate(n);for(const r of Object.values(u))if(r instanceof e.b8){const e=t.layers[c.decode(r.sourceLayerIndex)];r.setEvaluatedPortalGraph(i,e,this.tileID.canonical,p.availableImages,p.brightness)}}v()};m.length>0?Promise.allSettled(m).then(g).catch(o):g()}rasterizeIfNeeded(e,t,n,i){Array.from(t.values()).some(e=>e.usvg)?this.rasterize(e,t,n,i):i()}updateImageMapAndGetImageTaskQueue(e,t,n){const i=new Map;for(const r of t.keys()){const s=n.get(r)||[];for(const n of s){const r=n.toString(),s=t.get(n.id.toString());s.usvg?i.has(r)||(i.set(r,n),e.set(r,Object.assign({},s))):e.set(r,s)}}return i}rasterize(e,t,n,i){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:n},(e,n)=>{if(!e)for(const[i,r]of n.entries()){const e=Object.assign(t.get(i),{data:r});t.set(i,e)}i()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function l(t,n,i,r,s){const a=new e.aa(n,{brightness:i,worldview:s});for(const e of t)e.recalculate(a,r)}class c extends e.E{constructor(t,n,i,r,s,a,o){super(),this.actor=t,this.layerIndex=n,this.availableImages=i,this.availableModels=r,this.loadVectorData=a||e.aJ,this.loading={},this.loaded={},this.deduped=new e.aI(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler,this.brightness=o}loadTile(n,i){const r=n.uid,s=n&&n.request,a=s&&s.collectResourceTiming,l=this.loading[r]=new o(n);l.abort=this.loadVectorData(n,(o,c)=>{const d=!this.loading[r];if(delete this.loading[r],l.cancelRasterize(),d||o||!c)return l.status="done",d||(this.loaded[r]=l),i(o);const u=c.rawData,h={};c.expires&&(h.expires=c.expires),c.cacheControl&&(h.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.fo(new e.bq(u));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(n,r)=>{if(n||!r)return i(n);const o={};if(a){const e=t(s);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}i(null,e.h({rawTileData:u.slice(0)},r,h,o))})};this.isSpriteLoaded?p():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):p()}),this.loaded=this.loaded||{},this.loaded[r]=l})}reloadTile(t,n){const i=this.loaded,r=t.uid;if(i&&i[r]){const s=i[r];s.scaleFactor=t.scaleFactor,s.showCollisionBoxes=t.showCollisionBoxes,s.projection=t.projection,s.brightness=t.brightness,s.tileTransform=e.aW(t.tileID.canonical,t.projection),s.extraShadowCaster=t.extraShadowCaster,s.lut=t.lut,s.worldview=t.worldview;const a=(e,t)=>{const i=s.reloadCallback;i&&(delete s.reloadCallback,s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,i)),n(e,t)};"parsing"===s.status?s.reloadCallback=a:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,a):a())}else n(null,void 0)}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class d{loadTile(t,n){const{uid:i,encoding:r,rawImageData:s,padding:a}=t,o=ImageBitmap&&s instanceof ImageBitmap?this.getImageData(s,a):s;n(null,new e.fp(i,o,r,a<1))}reloadTile(e,t){t(null,null)}abortTile(e,t){t()}removeTile(e,t){t()}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}e.bp.setPbf(e.bq);class u{constructor(t){this._mrt=new e.bp(t.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=t.uid,this.tileID=t.tileID,this.source=t.source}parse(t,n){const i=this._mrt;this.status="parsing",this._entireBuffer=t;try{i.parseHeader(t),this._isHeaderLoaded=!0;const r=[];for(const n in i.layers){const s=i.getLayer(n),a=s.getDataRange(s.getBandList()),o=i.createDecodingTask(a),l=t.slice(a.firstByte,a.lastByte+1),c=e.bp.performDecoding(l,o).then(e=>o.complete(null,e)).catch(e=>o.complete(e,null));r.push(c)}Promise.allSettled(r).then(()=>n(null,i)).catch(e=>n(e))}catch(e){n(e)}}}class h{constructor(e){this.actor=e,this.loading={},this.loaded={}}loadTile(t,n){const i=t.uid,r=t.request,s=this.loading[i]=new u(t),{cancel:a}=e.br(r,(e,t,r,a)=>{const o=!this.loading[i];if(delete this.loading[i],o||e||!t)return s.status="done",o||(this.loaded[i]=s),n(e);s.parse(t,(e,t)=>{if(e||!t)return n(e);n(null,t,r,a)}),this.loaded[i]=s});s.abort=a}reloadTile(e,t){t(null,void 0)}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=e.uid;this.loaded[n]&&delete this.loaded[n],t()}decodeRasterArray(t,n){e.bp.performDecoding(t.buffer,t.task).then(e=>n(null,e)).catch(e=>n(e))}}const p=e.fq.prototype.toGeoJSON;class m{constructor(t){this._feature=t,this.extent=e.aj,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return p.call(this,e,t,n)}}class f{constructor(t,n){this.name=t,this.extent=e.aj,this.length=n.length,this._jsonFeatures=n}feature(e){return new m(this._jsonFeatures[e])}}class g{constructor(t){this.layers={},this.extent=e.aj;for(const e of Object.keys(t))this.layers[e]=new f(e,t[e])}}const x=64/4096,y=128;class v{constructor(){this.features=new Map}clear(){this.features.clear()}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;for(const n of e){const e=n.id;if(null==e)continue;let i=this.features.get(e);i&&this.updateCache(i,t),n.geometry?(i=b(n),this.updateCache(i,t),this.features.set(e,i)):this.features.delete(e),this.updateCache(i,t)}}updateCache(e,t){for(const{canonical:n,uid:i}of Object.values(t)){const{z:r,x:s,y:a}=n;_(e,Math.pow(2,r),s,a)&&delete t[i]}}getTile(e,t,n){const i=Math.pow(2,e),r=[];for(const s of this.features.values())_(s,i,t,n)&&r.push(S(s,i,t,n));return{features:r}}getFeatures(){return[...this.features.values()]}}function _(e,t,n,i){let{minX:r,minY:s,maxX:a,maxY:o}=e;return r<(n+1+x)/t&&s<(i+1+x)/t&&a>(n-x)/t&&o>(i-x)/t}function b(e){const{id:t,geometry:n,properties:i}=e;if(!n)return;if("GeometryCollection"===n.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:r,coordinates:s}=n,a={id:t,type:1,geometry:[],tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},o=a.geometry;if("Point"===r)w(s,o,a);else if("MultiPoint"===r)for(const l of s)w(l,o,a);else if("LineString"===r)a.type=2,j(s,o,a);else if("MultiLineString"===r)a.type=2,N(s,o,a);else if("Polygon"===r)a.type=3,N(s,o,a,!0);else{if("MultiPolygon"!==r)throw new Error("Input data is not a valid GeoJSON object.");a.type=3;for(const e of s)N(e,o,a,!0)}return a}function w(t,n,i){let[r,s]=t;const a=e.aD(r);let o=e.aH(s);o=o<0?0:o>1?1:o,n.push(a,o),i.minX=Math.min(i.minX,a),i.minY=Math.min(i.minY,o),i.maxX=Math.max(i.maxX,a),i.maxY=Math.max(i.maxY,o)}function j(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=[];for(const a of e)w(a,s,n);t.push(s),i&&function(e,t){let n=0;for(let i=0,r=e.length,s=r-2;i<r;s=i,i+=2)n+=(e[i]-e[s])*(e[i+1]+e[s+1]);if(n>0===t)for(let i=0,r=e.length;i<r/2;i+=2){const t=e[i],n=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=t,e[r-1-i]=n}}(s,r)}function N(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let r=0;r<e.length;r++)j(e[r],t,n,i,0===r)}function S(t,n,i,r){const{id:s,type:a,geometry:o,tags:l}=t,c=[];if(1===a)!function(t,n,i,r,s){for(let a=0;a<t.length;a+=2){const o=Math.round(e.aj*(t[a+0]*n-i)),l=Math.round(e.aj*(t[a+1]*n-r));s.push([o,l])}}(o,n,i,r,c);else for(const e of o)k(e,n,i,r,c);return{id:s,type:a,geometry:c,tags:l}}function k(t,n,i,r,s){const a=-y,o=e.aj+y;let l;for(let c=0;c<t.length-2;c+=2){let d=Math.round(e.aj*(t[c+0]*n-i)),u=Math.round(e.aj*(t[c+1]*n-r)),h=Math.round(e.aj*(t[c+2]*n-i)),p=Math.round(e.aj*(t[c+3]*n-r));const m=h-d,f=p-u;d<a&&h<a||(d<a?(u+=Math.round(f*((a-d)/m)),d=a):h<a&&(p=u+Math.round(f*((a-d)/m)),h=a),u<a&&p<a||(u<a?(d+=Math.round(m*((a-u)/f)),u=a):p<a&&(h=d+Math.round(m*((a-u)/f)),p=a),d>=o&&h>=o||(d>=o?(u+=Math.round(f*((o-d)/m)),d=o):h>=o&&(p=u+Math.round(f*((o-d)/m)),h=o),u>=o&&p>=o||(u>=o?(d+=Math.round(m*((o-u)/f)),u=o):p>=o&&(h=d+Math.round(m*((o-u)/f)),p=o),l&&d===l[l.length-1][0]&&u===l[l.length-1][1]||(l=[[d,u]],s.push(l)),l.push([h,p])))))}}function T(t,n){let{name:i,features:r}=t;n.writeStringField(1,i),n.writeVarintField(5,e.aj);const s=new Map,a=new Map,o={keys:s,values:a,feature:null};for(const e of r)o.feature=e,n.writeMessage(2,C,o);for(const e of s.keys())n.writeStringField(3,e);for(const e of a.keys())n.writeMessage(4,I,e)}function C(e,t){const n=e.feature;void 0===n.id||isNaN(+n.id)||t.writeVarintField(1,+n.id),n.tags&&t.writeMessage(2,E,e),t.writeVarintField(3,n.type),t.writeMessage(4,D,n)}function E(e,t){let{keys:n,values:i,feature:r}=e;for(const s of Object.keys(r.tags)){let e=r.tags[s];if(null===e)continue;let a=n.get(s);void 0===a&&(a=n.size,n.set(s,a)),t.writeVarint(a);const o=typeof e;"string"!==o&&"boolean"!==o&&"number"!==o&&(e=JSON.stringify(e));let l=i.get(e);void 0===l&&(l=i.size,i.set(e,l)),t.writeVarint(l)}}function A(e,t){return(t<<3)+(7&e)}function M(e){return e<<1^e>>31}function D(e,t){const{geometry:n,type:i}=e;let r=0,s=0;if(1===i){t.writeVarint(A(1,n.length));for(const e of n){const n=e[0]-r,i=e[1]-s;t.writeVarint(M(n)),t.writeVarint(M(i)),r+=n,s+=i}}else for(const a of n){t.writeVarint(A(1,1));const e=a.length-(3===i?1:0);for(let n=0;n<e;n++){1===n&&t.writeVarint(A(2,e-1));const i=a[n][0]-r,o=a[n][1]-s;t.writeVarint(M(i)),t.writeVarint(M(o)),r+=i,s+=o}3===i&&t.writeVarint(A(7,1))}}function I(e,t){const n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}const P={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},R=Math.fround||(L=new Float32Array(1),e=>(L[0]=+e,L[0]));var L;const z=3,O=5,F=6;class B{constructor(e){this.options=Object.assign(Object.create(P),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r="prepare ".concat(e.length," points");t&&console.time(r),this.points=e;const s=[];for(let o=0;o<e.length;o++){const t=e[o];if(!t.geometry)continue;const[n,i]=t.geometry.coordinates,r=R(H(n)),a=R(q(i));s.push(r,a,1/0,o,-1,1),this.options.reduce&&s.push(0)}let a=this.trees[i+1]=this._createTree(s);t&&console.timeEnd(r);for(let o=i;o>=n;o--){const e=+Date.now();a=this.trees[o]=this._createTree(this._cluster(a,o)),t&&console.log("z%d: %d clusters in %dms",o,a.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,s],t),a=this.getClusters([-180,i,r,s],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],o=a.range(H(n),q(s),H(r),q(i)),l=a.data,c=[];for(const d of o){const e=this.stride*d;c.push(l[e+O]>1?V(l,e,this.clusterProps):this.points[l[e+z]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const s=r.data;if(t*this.stride>=s.length)throw new Error(i);const a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),o=r.within(s[t*this.stride],s[t*this.stride+1],a),l=[];for(const c of o){const t=c*this.stride;s[t+4]===e&&l.push(s[t+O]>1?V(s,t,this.clusterProps):this.points[s[t+z]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:s,radius:a}=this.options,o=a/s,l=(n-o)/r,c=(n+1+o)/r,d={features:[]};return this._addTileFeatures(i.range((t-o)/r,l,(t+1+o)/r,c),i.data,t,n,r,d),0===t&&this._addTileFeatures(i.range(1-o/r,l,1,c),i.data,r,n,r,d),t===r-1&&this._addTileFeatures(i.range(0,l,o/r,c),i.data,-1,n,r,d),d.features.length?d:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const s=this.getChildren(t);for(const a of s){const t=a.properties;if(t&&t.cluster?r+t.point_count<=i?r+=t.point_count:r=this._appendLeaves(e,t.cluster_id,n,i,r):r<i?r++:e.push(a),e.length===n)break}return r}_createTree(t){const n=new e.c0(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,i,r,s){for(const a of e){const e=a*this.stride,o=t[e+O]>1;let l,c,d;if(o)l=U(t,e,this.clusterProps),c=t[e],d=t[e+1];else{const n=this.points[t[e+z]];l=n.properties;const[i,r]=n.geometry.coordinates;c=H(i),d=q(r)}const u={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(d*r-i))]],tags:l};let h;h=o||this.options.generateId?t[e+z]:this.points[t[e+z]].id,void 0!==h&&(u.id=h),s.features.push(u)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:s}=this.options,a=n/(i*Math.pow(2,t)),o=e.data,l=[],c=this.stride;for(let d=0;d<o.length;d+=c){if(o[d+2]<=t)continue;o[d+2]=t;const n=o[d],i=o[d+1],u=e.within(o[d],o[d+1],a),h=o[d+O];let p=h;for(const e of u){const n=e*c;o[n+2]>t&&(p+=o[n+O])}if(p>h&&p>=s){let e,s=n*h,a=i*h,m=-1;const f=(d/c<<5)+(t+1)+this.points.length;for(const n of u){const i=n*c;if(o[i+2]<=t)continue;o[i+2]=t;const l=o[i+O];s+=o[i]*l,a+=o[i+1]*l,o[i+4]=f,r&&(e||(e=this._map(o,d,!0),m=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(o,i)))}o[d+4]=f,l.push(s/p,a/p,1/0,f,-1,p),r&&l.push(m)}else{for(let e=0;e<c;e++)l.push(o[d+e]);if(p>1)for(const e of u){const n=e*c;if(!(o[n+2]<=t)){o[n+2]=t;for(let e=0;e<c;e++)l.push(o[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+O]>1){const i=this.clusterProps[e[t+F]];return n?Object.assign({},i):i}const i=this.points[e[t+z]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function V(e,t,n){return{type:"Feature",id:e[t+z],properties:U(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),W(e[t+1])]}};var i}function U(e,t,n){const i=e[t+O],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,s=e[t+F],a=-1===s?{}:Object.assign({},n[s]);return Object.assign(a,{cluster:!0,cluster_id:e[t+z],point_count:i,point_count_abbreviated:r})}function H(e){return e/360+.5}function q(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function W(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function G(e,t,n,i){let r=i;const s=t+(n-t>>1);let a,o=n-t;const l=e[t],c=e[t+1],d=e[n],u=e[n+1];for(let h=t+3;h<n;h+=3){const t=Y(e[h],e[h+1],l,c,d,u);if(t>r)a=h,r=t;else if(t===r){const e=Math.abs(h-s);e<o&&(a=h,o=e)}}r>i&&(a-t>3&&G(e,t,a,i),e[a+2]=r,n-a>3&&G(e,a,n,i))}function Y(e,t,n,i,r,s){let a=r-n,o=s-i;if(0!==a||0!==o){const l=((e-n)*a+(t-i)*o)/(a*a+o*o);l>1?(n=r,i=s):l>0&&(n+=a*l,i+=o*l)}return a=e-n,o=t-i,a*a+o*o}function Z(e,t,n,i){const r={id:null!==e&&void 0!==e?e:null,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)X(r,n);else if("Polygon"===t)X(r,n[0]);else if("MultiLineString"===t)for(const s of n)X(r,s);else if("MultiPolygon"===t)for(const s of n)X(r,s[0]);return r}function X(e,t){for(let n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function K(e,t,n,i){if(!t.geometry)return;const r=t.geometry.coordinates;if(r&&0===r.length)return;const s=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let o=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===s)Q(r,o);else if("MultiPoint"===s)for(const c of r)Q(c,o);else if("LineString"===s)J(r,o,a,!1);else if("MultiLineString"===s){if(n.lineMetrics){for(const n of r)o=[],J(n,o,a,!1),e.push(Z(l,"LineString",o,t.properties));return}$(r,o,a,!1)}else if("Polygon"===s)$(r,o,a,!0);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(const r of t.geometry.geometries)K(e,{id:l,geometry:r,properties:t.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of r){const t=[];$(e,t,a,!0),o.push(t)}}e.push(Z(l,s,o,t.properties))}function Q(e,t){t.push(ee(e[0]),te(e[1]),0)}function J(e,t,n,i){let r,s,a=0;for(let l=0;l<e.length;l++){const n=ee(e[l][0]),o=te(e[l][1]);t.push(n,o,0),l>0&&(a+=i?(r*o-n*s)/2:Math.sqrt(Math.pow(n-r,2)+Math.pow(o-s,2))),r=n,s=o}const o=t.length-3;t[2]=1,G(t,0,o,n),t[o+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function $(e,t,n,i){for(let r=0;r<e.length;r++){const s=[];J(e[r],s,n,i),t.push(s)}}function ee(e){return e/360+.5}function te(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ne(e,t,n,i,r,s,a,o){if(i/=t,s>=(n/=t)&&a<i)return e;if(a<n||s>=i)return null;const l=[];for(const c of e){const e=c.geometry;let t=c.type;const s=0===r?c.minX:c.minY,a=0===r?c.maxX:c.maxY;if(s>=n&&a<i){l.push(c);continue}if(a<n||s>=i)continue;let d=[];if("Point"===t||"MultiPoint"===t)ie(e,d,n,i,r);else if("LineString"===t)re(e,d,n,i,r,!1,o.lineMetrics);else if("MultiLineString"===t)ae(e,d,n,i,r,!1);else if("Polygon"===t)ae(e,d,n,i,r,!0);else if("MultiPolygon"===t)for(const o of e){const e=[];ae(o,e,n,i,r,!0),e.length&&d.push(e)}if(d.length){if(o.lineMetrics&&"LineString"===t){for(const e of d)l.push(Z(c.id,t,e,c.tags));continue}"LineString"!==t&&"MultiLineString"!==t||(1===d.length?(t="LineString",d=d[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===d.length?"Point":"MultiPoint"),l.push(Z(c.id,t,d,c.tags))}}return l.length?l:null}function ie(e,t,n,i,r){for(let s=0;s<e.length;s+=3){const a=e[s+r];a>=n&&a<=i&&oe(t,e[s],e[s+1],e[s+2])}}function re(e,t,n,i,r,s,a){let o=se(e);const l=0===r?le:ce;let c,d,u=e.start;for(let g=0;g<e.length-3;g+=3){const h=e[g],p=e[g+1],m=e[g+2],f=e[g+3],x=e[g+4],y=0===r?h:p,v=0===r?f:x;let _=!1;a&&(c=Math.sqrt(Math.pow(h-f,2)+Math.pow(p-x,2))),y<n?v>n&&(d=l(o,h,p,f,x,n),a&&(o.start=u+c*d)):y>i?v<i&&(d=l(o,h,p,f,x,i),a&&(o.start=u+c*d)):oe(o,h,p,m),v<n&&y>=n&&(d=l(o,h,p,f,x,n),_=!0),v>i&&y<=i&&(d=l(o,h,p,f,x,i),_=!0),!s&&_&&(a&&(o.end=u+c*d),t.push(o),o=se(e)),a&&(u+=c)}let h=e.length-3;const p=e[h],m=e[h+1],f=0===r?p:m;f>=n&&f<=i&&oe(o,p,m,e[h+2]),h=o.length-3,s&&h>=3&&(o[h]!==o[0]||o[h+1]!==o[1])&&oe(o,o[0],o[1],o[2]),o.length&&t.push(o)}function se(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ae(e,t,n,i,r,s){for(const a of e)re(a,t,n,i,r,s,!1)}function oe(e,t,n,i){e.push(t,n,i)}function le(e,t,n,i,r,s){const a=(s-t)/(i-t);return oe(e,s,n+(r-n)*a,1),a}function ce(e,t,n,i,r,s){const a=(s-n)/(r-n);return oe(e,t+(i-t)*a,s,1),a}function de(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],s=r.type;let a;if("Point"===s||"MultiPoint"===s||"LineString"===s)a=ue(r.geometry,t);else if("MultiLineString"===s||"Polygon"===s){a=[];for(const e of r.geometry)a.push(ue(e,t))}else if("MultiPolygon"===s){a=[];for(const e of r.geometry){const n=[];for(const i of e)n.push(ue(i,t));a.push(n)}}n.push(Z(r.id,s,a,r.tags))}return n}function ue(e,t){const n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(let i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function he(e,t){if(e.transformed)return e;const n=1<<e.z,i=e.x,r=e.y;for(const s of e.features){const e=s.geometry,a=s.type;if(s.geometry=[],1===a)for(let o=0;o<e.length;o+=2)s.geometry.push(pe(e[o],e[o+1],t,n,i,r));else for(let o=0;o<e.length;o++){const a=[];for(let s=0;s<e[o].length;s+=2)a.push(pe(e[o][s],e[o][s+1],t,n,i,r));s.geometry.push(a)}}return e.transformed=!0,e}function pe(e,t,n,i,r,s){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-s))]}function me(e,t,n,i,r){const s=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const o of e)fe(a,o,s,r);return a}function fe(e,t,n,i){const r=t.geometry,s=t.type,a=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===s||"MultiPoint"===s)for(let o=0;o<r.length;o+=3)a.push(r[o],r[o+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)ge(a,r,e,n,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(let o=0;o<r.length;o++)ge(a,r[o],e,n,"Polygon"===s,0===o);else if("MultiPolygon"===s)for(let o=0;o<r.length;o++){const t=r[o];for(let i=0;i<t.length;i++)ge(a,t[i],e,n,!0,0===i)}if(a.length){let n=t.tags||null;if("LineString"===s&&i.lineMetrics){n={};for(const e in t.tags)n[e]=t.tags[e];n.mapbox_clip_start=r.start/r.size,n.mapbox_clip_end=r.end/r.size}const o={geometry:a,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:n};null!==t.id&&(o.id=t.id),e.features.push(o)}}function ge(e,t,n,i,r,s){const a=i*i;if(i>0&&t.size<(r?a:i))return void(n.numPoints+=t.length/3);const o=[];for(let l=0;l<t.length;l+=3)(0===i||t[l+2]>a)&&(n.numSimplified++,o.push(t[l],t[l+1])),n.numPoints++;r&&function(e,t){let n=0;for(let i=0,r=e.length,s=r-2;i<r;s=i,i+=2)n+=(e[i]-e[s])*(e[i+1]+e[s+1]);if(n>0===t)for(let i=0,r=e.length;i<r/2;i+=2){const t=e[i],n=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=t,e[r-1-i]=n}}(o,s),e.push(o)}const xe={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ye{constructor(e,t){const n=(t=this.options=function(e,t){for(const n in t)e[n]=t[n];return e}(Object.create(xe),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(e,t){const n=[];if("FeatureCollection"===e.type)for(let i=0;i<e.features.length;i++)K(n,e.features[i],t,i);else K(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(e,t){const n=t.buffer/t.extent;let i=e;const r=ne(e,1,-1-n,n,0,-1,2,t),s=ne(e,1,1-n,2+n,0,-1,2,t);return(r||s)&&(i=ne(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=de(r,1).concat(i)),s&&(i=i.concat(de(s,-1)))),i}(i,t),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,n,i,r,s,a){const o=[e,t,n,i],l=this.options,c=l.debug;for(;o.length;){i=o.pop(),n=o.pop(),t=o.pop(),e=o.pop();const d=1<<t,u=ve(t,n,i);let h=this.tiles[u];if(!h&&(c>1&&console.time("creation"),h=this.tiles[u]=me(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));const e="z".concat(t);this.stats[e]=(this.stats[e]||0)+1,this.total++}if(h.source=e,null==r){if(t===l.indexMaxZoom||h.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===r)continue;if(null!=r){const e=r-t;if(n!==s>>e||i!==a>>e)continue}}if(h.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,m=.5-p,f=.5+p,g=1+p;let x=null,y=null,v=null,_=null,b=ne(e,d,n-p,n+f,0,h.minX,h.maxX,l),w=ne(e,d,n+m,n+g,0,h.minX,h.maxX,l);e=null,b&&(x=ne(b,d,i-p,i+f,1,h.minY,h.maxY,l),y=ne(b,d,i+m,i+g,1,h.minY,h.maxY,l),b=null),w&&(v=ne(w,d,i-p,i+f,1,h.minY,h.maxY,l),_=ne(w,d,i+m,i+g,1,h.minY,h.maxY,l),w=null),c>1&&console.timeEnd("clipping"),o.push(x||[],t+1,2*n,2*i),o.push(y||[],t+1,2*n,2*i+1),o.push(v||[],t+1,2*n+1,2*i),o.push(_||[],t+1,2*n+1,2*i+1)}}getTile(e,t,n){e=+e,t=+t,n=+n;const i=this.options,{extent:r,debug:s}=i;if(e<0||e>24)return null;const a=1<<e,o=ve(e,t=t+a&a-1,n);if(this.tiles[o])return he(this.tiles[o],r);s>1&&console.log("drilling down to z%d-%d-%d",e,t,n);let l,c=e,d=t,u=n;for(;!l&&c>0;)c--,d>>=1,u>>=1,l=this.tiles[ve(c,d,u)];return l&&l.source?(s>1&&(console.log("found parent tile z%d-%d-%d",c,d,u),console.time("drilling down")),this.splitTile(l.source,c,d,u,e,t,n),s>1&&console.timeEnd("drilling down"),this.tiles[o]?he(this.tiles[o],r):null):null}}function ve(e,t,n){return 32*((1<<e)*n+t)+e}function _e(t,n){const i=t.tileID.canonical;if(!this._geoJSONIndex)return void n(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return void n(null,null);const s=e=>e.tags&&"3d_elevation_id"in e.tags&&"source"in e.tags&&"elevation"===e.tags.source,a=r.features.filter(e=>s(e));let o={_geojsonTileLayer:r.features};a.length>0&&(o={_geojsonTileLayer:r.features.filter(e=>!s(e)),hd_road_elevation:a});const l=new g(o),c=function(t){const n=new e.bq;for(const e of Object.keys(t))n.writeMessage(3,T,{name:e,features:t[e]});return n.finish()}(o).buffer;n(null,{vectorTile:l,rawData:c})}class be extends c{constructor(e,t,n,i,r,s,a){super(e,t,n,i,r,_e,a),s&&(this.loadGeoJSON=s),this._dynamicIndex=new v}loadData(n,i){const r=n&&n.request,s=r&&r.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(n,(a,o)=>{if(a||!o)return i(a);if("object"!=typeof o)return i(new Error("Input data given to '".concat(n.source,"' is not a valid GeoJSON object.")));{try{if(n.filter){const t=e.X(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));o.features=o.features.filter(e=>t.value.evaluate({zoom:0},e))}n.dynamic?("Feature"===o.type&&(o={type:"FeatureCollection",features:[o]}),n.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(o.features,this.loaded),n.cluster&&(o.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=n.cluster?new B(function(t){let{superclusterOptions:n,clusterProperties:i}=t;if(!i||!n)return n;const r={},s={},a={accumulated:null,zoom:0},o={properties:null},l=Object.keys(i);for(const c of l){const[t,n]=i[c],a=e.X(n),o=e.X("string"==typeof t?[t,["accumulated"],["get",c]]:t);r[c]=a.value,s[c]=o.value}return n.map=e=>{o.properties=e;const t={};for(const n of l)t[n]=r[n].evaluate(a,o);return t},n.reduce=(e,t)=>{o.properties=t;for(const n of l)a.accumulated=e[n],e[n]=s[n].evaluate(a,o)},n}(n)).load(o.features):n.dynamic?this._dynamicIndex:function(e,t){return new ye(e,t)}(o,n.geojsonVtOptions)}catch(e){return i(e)}const a={};if(s){const e=t(r);e&&(a.resourceTiming={},a.resourceTiming[n.source]=JSON.parse(JSON.stringify(e)))}i(null,a)}})}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.n(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));setTimeout(()=>{try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}},0)}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class we{constructor(t,n,i){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=n,this.worldview=i}parse(t,n,i,r){this.status="parsing";const s=new e.aM(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),a=[],o=n.familiesBySource[i.source],l=new e.fc(s,i.promoteId);l.bucketLayerIDs=[],l.is3DTile=!0,e.fr(t).then(t=>{if(!t)return r(new Error("Could not parse tile"));const n=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),d=new e.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const r in o)for(const u of o[r]){const r=u[0];l.bucketLayerIDs.push(u.map(t=>e.C(t.id,t.scope))),r.recalculate(d,[]);const o=e.fs(t,1/e.d4(i.tileID.canonical)),h=new e.ft(u,o,s,n,c,this.brightness,l,this.worldview);n||(h.needsUpload=!0),a.push(h),h.evaluate(r)}this.status="done",r(null,{buckets:a,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(e=>r(new Error(e.message)))}}class je{constructor(e,t,n,i,r,s,a,o){this.actor=e,this.layerIndex=t,this.availableImages=n,this.availableModels=i,this.brightness=a,this.loading={},this.loaded={},this.worldview=o}loadTile(t,n){const i=t.uid,r=this.loading[i]=new we(t,this.brightness,this.worldview);e.br(t.request,(e,s)=>{const a=!this.loading[i];return delete this.loading[i],a||e?(r.status="done",a||(this.loaded[i]=r),n(e)):s&&0!==s.byteLength?void r.parse(s,this.layerIndex,t,(e,t)=>{r.status="done",this.loaded=this.loaded||{},this.loaded[i]=r,e||!t?n(e):n(null,t)}):(r.status="done",this.loaded[i]=r,n())})}reloadTile(e,t){const n=this.loaded,i=e.uid;if(n&&n[i]){const r=n[i];r.projection=e.projection,r.brightness=e.brightness;const s=(n,i)=>{r.reloadCallback&&(delete r.reloadCallback,this.loadTile(e,t)),t(n,i)};"parsing"===r.status?r.reloadCallback=s:"done"===r.status&&this.loadTile(e,t)}}abortTile(e,t){const n=e.uid;this.loading[n]&&delete this.loading[n],t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class Ne{constructor(t){this.self=t,this.actor=new e.fv(t,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new e.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=e.cj({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:be,"raster-dem":d,"raster-array":h,"batched-model":je},this.workerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.fw.isParsed())throw new Error("RTL text plugin already registered.");e.fw.setState({pluginStatus:e.fx.parsed,pluginURL:e.fw.getPluginURL()}),e.fw.applyArabicShaping=t.applyArabicShaping,e.fw.processBidirectionalText=t.processBidirectionalText,e.fw.processStyledBidirectionalText=t.processStyledBidirectionalText;for(const e of this.rtlPluginParsingListeners)e(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.availableModels[e],delete this.workerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={});const{scope:i,isLoaded:r}=n;if(this.isSpriteLoaded[t][i]=r,this.workerSources[t]&&this.workerSources[t][i])for(const s in this.workerSources[t][i]){const n=this.workerSources[t][i][s];for(const t in n){const i=n[t];i instanceof c&&(i.isSpriteLoaded=r,i.fire(new e.A("isSpriteLoaded")))}}}setImages(e,t,n){this.availableImages[e]||(this.availableImages[e]={});const{scope:i,images:r}=t;if(this.availableImages[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const n=this.workerSources[e][i][t];for(const e in n)n[e].availableImages=r}n()}else n()}setModels(e,t,n){let{scope:i,models:r}=t;if(this.availableModels[e]||(this.availableModels[e]={}),this.availableModels[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const n=this.workerSources[e][i][t];for(const e in n)n[e].availableModels=r}n()}else n()}setProjection(t,n){this.projections[t]=e.cj(n)}setBrightness(e,t,n){this.brightness=t,n()}setWorldview(e,t,n){this.worldview=t,n()}setLayers(e,t,n){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),n()}updateLayers(e,t,n){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),n()}loadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,n)}decodeRasterArray(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).decodeRasterArray(t,n)}reloadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,n)}removeSource(e,t,n){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const i=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,i){if(e.fw.isParsed())i(null,!0);else if(e.fw.isParsing())this.rtlPluginParsingListeners.push(i);else try{e.fw.setState(n);const t=e.fw.getPluginURL();!e.fw.isLoaded()||e.fw.isParsed()||e.fw.isParsing()||null==t||(e.fw.setState({pluginStatus:e.fx.parsing,pluginURL:e.fw.getPluginURL()}),this.self.importScripts(t),e.fw.isParsed()?i(null,!0):this.rtlPluginParsingListeners.push(i))}catch(e){i(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let n=this.availableImages[e][t];return n||(n=[]),n}getAvailableModels(e,t){this.availableModels[e]||(this.availableModels[e]={});let n=this.availableModels[e][t];return n||(n={}),n}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let n=this.layerIndexes[e][t];return n||(n=this.layerIndexes[e][t]=new r,n.scope=t),n}getWorkerSource(e,t,n,i){const r=this.workerSources;return r[e]||(r[e]={}),r[e][i]||(r[e][i]={}),r[e][i][t]||(r[e][i][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),r[e][i][t][n]||(r[e][i][t][n]=new this.workerSourceTypes[t]({send:(t,n,i,r,s,a)=>this.actor.send(t,n,i,e,s,a),scheduler:this.actor.scheduler},this.getLayerIndex(e,i),this.getAvailableImages(e,i),this.getAvailableModels(e,i),this.isSpriteLoaded[e][i],void 0,this.brightness,this.worldview)),r[e][i][t][n]}rasterizeImagesWorker(e,t,n){const i=new Map;for(const[r,{image:s,imageVariant:a}]of t.tasks.entries()){const n=this.imageRasterizer.rasterize(a,s,t.scope,e);i.set(r,n)}n(void 0,i)}removeRasterizedImages(e,t,n){this.imageRasterizer.removeImagesFromCacheByIds(t.imageIds,t.scope,e),n()}enforceCacheSizeLimit(t,n){e.fy(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return e.fu(self)&&(self.worker=new Ne(self)),Ne}),a(["./shared"],function(e){var t="3.14.0";const n={create:"create",load:"load",fullLoad:"fullLoad"},a={mark(e){performance.mark(e)},measure(e,t,n){performance.measure(e,t,n)}};function o(t){const n=t.name.split("?")[0];return e.a(n)&&n.includes("mapbox-gl.js")?"javascript":e.a(n)&&n.includes("mapbox-gl.css")?"css":e.b(n)?"fontRange":e.c(n)?"sprite":e.i(n)?"style":e.d(n)?"tilejson":"other"}var l,c={},d=function(){if(l)return c;function e(e){return!t(e)}function t(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===n[i=t&&t.failIfMajorPerformanceCaveat]&&(n[i]=function(t){var n,i=function(t){var n=document.createElement("canvas"),i=Object.create(e.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,n.getContext("webgl2",i)}(t);if(!i)return!1;try{n=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!n||i.isContextLost())&&(i.shaderSource(n,"void main() {}"),i.compileShader(n),!0===i.getShaderParameter(n,i.COMPILE_STATUS))}(i)),n[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var i}l=1,c.supported=e,c.notSupportedReason=t;var n={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},c}();function u(e,t,n){const i=document.createElement(e);return null!=t&&(i.className=t),n&&n.appendChild(i),i}function h(e,t,n){const i=document.createElementNS("http://www.w3.org/2000/svg",e);for(const r of Object.keys(t))i.setAttributeNS(null,r,String(t[r]));return n&&n.appendChild(i),i}const p="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,m=p&&void 0!==p.userSelect?"userSelect":"WebkitUserSelect";let f;function g(){p&&m&&(f=p[m],p[m]="none")}function x(){p&&m&&(p[m]=f)}function y(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",y,!0)}function v(){window.addEventListener("click",y,!0),window.setTimeout(()=>{window.removeEventListener("click",y,!0)},0)}function _(e,t){const n=e.getBoundingClientRect();return j(e,n,t)}function b(e,t){const n=e.getBoundingClientRect(),i=[];for(let r=0;r<t.length;r++)i.push(j(e,n,t[r]));return i}function w(e){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function j(t,n,i){const r=t.offsetWidth===n.width?1:t.offsetWidth/n.width;return new e.P((i.clientX-n.left)*r,(i.clientY-n.top)*r)}const N="01",S="NO_ACCESS_TOKEN";class k{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",N,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(n,i){if(!e.j(n))return n;const r=C(n);return r.params.push("sdk=js-".concat(t)),r.path="/styles/v1".concat(r.path),this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(t,n){if(!e.j(t))return t;const i=C(t);return i.path="/fonts/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||n)}normalizeModelURL(t,n){if(!e.j(t))return t;const i=C(t);return i.path="/models/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||n)}normalizeSourceURL(t,n,i,r){if(!e.j(t))return t;const s=C(t);return s.path="/v4/".concat(s.authority,".json"),s.params.push("secure"),i&&s.params.push("language=".concat(i)),r&&s.params.push("worldview=".concat(r)),this._makeAPIURL(s,this._customAccessToken||n)}normalizeIconsetURL(t,n){const i=C(t);return e.j(t)?(i.path="/styles/v1".concat(i.path,"/iconset.pbf"),this._makeAPIURL(i,this._customAccessToken||n)):E(i)}normalizeSpriteURL(t,n,i,r){const s=C(t);return e.j(t)?(s.path="/styles/v1".concat(s.path,"/sprite").concat(n).concat(i),this._makeAPIURL(s,this._customAccessToken||r)):(s.path+="".concat(n).concat(i),E(s))}normalizeTileURL(t,n,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!e.j(t))return t;const r=C(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(n||i&&"raster"!==r.authority&&512===i?"@2x":"").concat(e.l.supported?".webp":"$1")),"raster"===r.authority?r.path="/".concat(e.e.RASTER_URL_PREFIX).concat(r.path):"rasterarrays"===r.authority?r.path="/".concat(e.e.RASTERARRAYS_URL_PREFIX).concat(r.path):"3dtiles"===r.authority?r.path="/".concat(e.e.TILES3D_URL_PREFIX).concat(r.path):(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/".concat(e.e.TILE_URL_VERSION).concat(r.path));const s=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(r.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&r.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(r,s)}canonicalizeTileURL(t,n){const i=C(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+="raster/".concat(i.path.replace("/".concat(e.e.RASTER_URL_PREFIX,"/"),"")):i.path.match(/^\/rasterarrays\/v1\//)?r+="rasterarrays/".concat(i.path.replace("/".concat(e.e.RASTERARRAYS_URL_PREFIX,"/"),"")):r+="tiles/".concat(i.path.replace("/".concat(e.e.TILE_URL_VERSION,"/"),""));let s=i.params;return n&&(s=s.filter(e=>!e.match(/^access_token=/))),s.length&&(r+="?".concat(s.join("&"))),r}canonicalizeTileset(t,n){const i=!!n&&e.j(n),r=[];for(const s of t.tiles||[])e.k(s)?r.push(this.canonicalizeTileURL(s,i)):r.push(s);return r}_makeAPIURL(t,n){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=C(e.e.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path="".concat(r.path).concat(t.path)),!e.e.REQUIRE_ACCESS_TOKEN)return E(t);if(n=n||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error("An API access token is required to use Mapbox GL. ".concat(i));if("s"===n[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(i))}return t.params=t.params.filter(e=>-1===e.indexOf("access_token")),t.params.push("access_token=".concat(n||"")),E(t)}}const T=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function C(e){const t=e.match(T);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function E(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const A="mapbox.eventData";function M(t){if(!t)return null;const n=t.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(e.m(n[1]))}catch(e){return null}}class D{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=M(e.e.ACCESS_TOKEN);let i="";return i=n&&n.u?e.f(n.u):e.e.ACCESS_TOKEN||"",t?"".concat(A,".").concat(t,":").concat(i):"".concat(A,":").concat(i)}fetchEventData(){const t=e.s("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const e=localStorage.getItem(n);e&&(this.eventData=JSON.parse(e));const t=localStorage.getItem(i);t&&(this.anonId=t)}catch(t){e.w("Unable to read from LocalStorage")}}saveEventData(){const t=e.s("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid"),r=this.anonId;if(t&&r)try{localStorage.setItem(i,r),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch(t){e.w("Unable to write to LocalStorage")}}processRequests(e){}postEvent(t,n,i,r){if(!e.e.EVENTS_URL)return;const s=C(e.e.EVENTS_URL);s.params.push("access_token=".concat(r||e.e.ACCESS_TOKEN||""));const a={event:this.type,created:new Date(t).toISOString()},o=n?e.h(a,n):a,l={url:E(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([o])};this.pendingRequest=e.p(l,e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const I=new class extends D{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(t,n){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>e.j(t)||e.k(t))&&this.queueRequest(Date.now(),n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=M(e.e.ACCESS_TOKEN),r=i?i.u:e.e.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;e.v(this.anonId)||(this.anonId=e.u(),s=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(a),n=(a-this.eventData.lastSuccess)/864e5;s=s||n>=1||n<-1||e.getDate()!==t.getDate()}else s=!0;s?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:N,"enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},n):this.processRequests()}},P=I.postTurnstileEvent.bind(I),R=new class extends D{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,n,i,r){this.skuToken=n,this.errorCb=r,e.e.EVENTS_URL&&(i||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(S)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:r}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),e.v(this.anonId)||(this.anonId=e.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:N,skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):i&&(this.success[i]=!0)},n))}remove(){this.errorCb=null}},L=R.postMapLoadEvent.bind(R),z=new class extends D{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let n=this.mapInstanceIdMap.get(t);return n||(n=e.u(),this.mapInstanceIdMap.set(t,n)),n}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(t,n){const{map:i,style:r,importedStyles:s}=n;if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;const a=this.getMapInstanceId(i),o={mapInstanceId:a,eventId:this.getEventId(a),style:r};s.length&&(o.importedStyles=s),this.queueRequest({timestamp:Date.now(),payload:o},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},e)}},O=z.postStyleLoadEvent.bind(z),F=new class extends D{constructor(){super("gljs.performance")}postPerformanceEvent(t,n){e.e.EVENTS_URL&&(t||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},t)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:s}=this.queue.shift(),a=function(i){const r=performance.getEntriesByType("resource"),s=performance.getEntriesByType("mark"),a=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const i of e[n]){const e="".concat(n,"ResolveRangeMin"),r="".concat(n,"ResolveRangeMax"),s="".concat(n,"RequestCount"),a="".concat(n,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,i.startTime),t[r]=Math.max(t[r]||-1/0,i.responseEnd);const o=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==i.transferSize&&0===i.transferSize&&o(a),o(s)}return t}(function(e,t){const n={};if(e)for(const i of e){const e=t(i);void 0===n[e]&&(n[e]=[]),n[e].push(i)}return n}(r,o)),l=window.devicePixelRatio,c=navigator.connection||navigator.mozConnection||navigator.webkitConnection,d=c?c.effectiveType:void 0,u={counters:[],metadata:[],attributes:[]},h=(e,t,n)=>{null!=n&&e.push({name:t,value:n.toString()})};for(const e in a)h(u.counters,e,a[e]);if(i.interactionRange[0]!==1/0&&i.interactionRange[1]!==-1/0&&(h(u.counters,"interactionRangeMin",i.interactionRange[0]),h(u.counters,"interactionRangeMax",i.interactionRange[1])),s)for(const e of Object.keys(n)){const t=n[e],i=s.find(e=>e.name===t);i&&h(u.counters,t,i.startTime)}return h(u.counters,"visibilityHidden",i.visibilityHidden),h(u.attributes,"style",function(t){if(t)for(const n of t){const t=n.name.split("?")[0];if(e.i(t)){const e=t.split("/").slice(-2);if(2===e.length)return"mapbox://styles/".concat(e[0],"/").concat(e[1])}}}(r)),h(u.attributes,"terrainEnabled",i.terrainEnabled?"true":"false"),h(u.attributes,"fogEnabled",i.fogEnabled?"true":"false"),h(u.attributes,"projection",i.projection),h(u.attributes,"zoom",i.zoom),h(u.metadata,"devicePixelRatio",l),h(u.metadata,"connectionEffectiveType",d),h(u.metadata,"navigatorUserAgent",navigator.userAgent),h(u.metadata,"screenWidth",window.screen.width),h(u.metadata,"screenHeight",window.screen.height),h(u.metadata,"windowWidth",window.innerWidth),h(u.metadata,"windowHeight",window.innerHeight),h(u.metadata,"mapWidth",i.width/l),h(u.metadata,"mapHeight",i.height/l),h(u.metadata,"webglRenderer",i.renderer),h(u.metadata,"webglVendor",i.vendor),h(u.metadata,"sdkVersion",t),h(u.metadata,"sdkIdentifier","mapbox-gl-js"),u}(s);for(const e of a.metadata);for(const e of a.counters);for(const e of a.attributes);this.postEvent(r,a,()=>{},i)}},B=F.postPerformanceEvent.bind(F),V=new class extends D{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,n,i,r){if(!e.e.API_URL||!e.e.SESSION_PATH)return;const s=C(e.e.API_URL+e.e.SESSION_PATH);s.params.push("sku=".concat(n||"")),s.params.push("access_token=".concat(r||e.e.ACCESS_TOKEN||""));const a={url:E(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(a,e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,n,i,r){this.skuToken=n,this.errorCb=r,e.e.SESSION_PATH&&e.e.API_URL&&(i||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(S)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}remove(){this.errorCb=null}},U=V.getSessionAPI.bind(V),H=new Set;function q(e,t){t?H.add(e):H.delete(e)}class W{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(t,n){this._updatedImages[n]=this._updatedImages[n]||new Set,this._updatedImages[n].add(e.I.toString(t)),this.setDirty()}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function G(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class Y extends e.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,"raster"!==t&&e.t()&&(this.imageRasterizerDispatcher=new e.D(e.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new e.r({width:1,height:1}))}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);const t=this.atlasTexture.get(e);t&&(t.destroy(),this.atlasTexture.delete(e))}addImageProvider(e,t){this.imageProviders.has(t)||this.imageProviders.set(t,new Map),this.imageProviders.get(t).set(e.id,e)}removeImageProvider(e,t){this.imageProviders.has(t)&&this.imageProviders.get(t).delete(e)}getPendingImageProviders(){const e=[];for(const t of this.imageProviders.values())for(const n of t.values())n.hasPendingRequests()&&e.push(n);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.y),this._imageRasterizer}isLoaded(){for(const e of this.loaded.keys())if(!this.loaded.get(e))return!1;return!0}setLoaded(e,t){if(this.loaded.get(t)!==e&&(this.loaded.set(t,e),e)){for(const{ids:e,callback:n}of this.requestors)this._notify(e,t,n);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images.get(t).get(e.toString())}addImage(e,t,n){this._validate(e,n)&&this.images.get(t).set(e.toString(),n)}_validate(t,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.z(new Error('Image "'.concat(t.name,'" has invalid "stretchX" value')))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.z(new Error('Image "'.concat(t.name,'" has invalid "stretchY" value')))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.z(new Error('Image "'.concat(t.name,'" has invalid "content" value')))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;if(!t.usvg){if(e[0]<0||t.data.width<e[0])return!1;if(e[1]<0||t.data.height<e[1])return!1;if(e[2]<0||t.data.width<e[2])return!1;if(e[3]<0||t.data.height<e[3])return!1}return!(e[2]<e[0]||e[3]<e[1])}updateImage(e,t,n){const i=this.images.get(t).get(e.toString());n.version=i.version+1,this.images.get(t).set(e.toString(),n),this.updatedImages.get(t).add(e),this.removeFromImageRasterizerCache(e,t)}clearUpdatedImages(e){this.updatedImages.get(e).clear()}removeFromImageRasterizerCache(t,n){"raster"!==this.spriteFormat&&(e.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(e,t){const n=this.images.get(t),i=n.get(e.toString());n.delete(e.toString()),this.patterns.get(t).delete(e.toString()),this.removeFromImageRasterizerCache(e,t),i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(t=>e.I.from(t))}getImages(e,t,n){const i=[],r=[],s=this.imageProviders.get(t);for(const c of e){if(!c.iconsetId){i.push(c);continue}const e=s.get(c.iconsetId);e&&(this.getImage(c,t)?r.push(c):e.addPendingRequest(c))}if(0===i.length)return void this._notify(r,t,n);let a=!0;const o=!!this.loaded.get(t),l=this.images.get(t);if(!o)for(const c of i)l.has(c.toString())||(a=!1);o||a?this._notify(i,t,n):this.requestors.push({ids:i,scope:t,callback:n})}rasterizeImages(e,t){const n=new Map,{tasks:i,scope:r}=e;for(const[s,a]of i.entries()){const e=this.getImage(a.id,r);e&&n.set(s,{image:e,imageVariant:a})}this._rasterizeImages(r,n,t)}_rasterizeImages(t,n,i){if(e.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:n,scope:t},i);else{const e=new Map;for(const[i,{image:r,imageVariant:s}]of n.entries())e.set(i,this.imageRasterizer.rasterize(s,r,t,0));i(void 0,e)}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(t,n,i){const r=this.images.get(n),s=new Map;for(const a of t){if(!r.get(a.toString())){if(a.iconsetId)continue;this.fire(new e.A("styleimagemissing",{id:a.name}))}const t=r.get(a.toString());if(!t){e.w('Image "'.concat(a.name,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'));continue}const n={data:t.usvg?null:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,usvg:t.usvg,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)};t.usvg&&Object.assign(n,{width:t.icon.usvg_tree.width,height:t.icon.usvg_tree.height}),s.set(e.I.toString(a),n)}i(null,s)}getPixelSize(e){const{width:t,height:n}=this.atlasImage.get(e);return{width:t,height:n}}getPattern(t,n,i){const r=t.toString(),s=this.patterns.get(n),a=s.get(r),o=this.getImage(t,n);if(!o)return null;if(a){if(a.position.version===o.version)return a.position;a.position.version=o.version}else{if(o.usvg&&!o.data){const s=this.getPatternInFlightId(r,n);if(this.patternsInFlight.has(s))return null;this.patternsInFlight.add(s);const a=new e.B(t).scaleSelf(e.q.devicePixelRatio),l=new Map([[a.toString(),{image:o,imageVariant:a}]]);return this._rasterizeImages(n,l,(e,t)=>this.storePatternImage(a,n,o,i,t)),null}this.storePattern(t,n,o)}return this._updatePatternAtlas(n,i),s.get(r).position}getPatternInFlightId(t,n){return e.C(t,n)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,t,n,i,r){const s=e.toString(),a=r?r.get(s):void 0;a&&(n.data=a,this.storePattern(e.id,t,n),this._updatePatternAtlas(t,i),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),t)))}storePattern(t,n,i){const r={w:i.data.width+2*e.F,h:i.data.height+2*e.F,x:0,y:0},s=new e.G(r,i,e.F);this.patterns.get(n).set(t.toString(),{bin:r,position:s})}destroyAtlasTextures(){for(const e of this.atlasTexture.values())e&&e.destroy();this.atlasTexture.clear()}bind(t,n){const i=t.gl;let r=this.atlasTexture.get(n);r?this.dirty&&(r.update(this.atlasImage.get(n)),this.dirty=!1):(r=new e.T(t,this.atlasImage.get(n),i.RGBA8),this.atlasTexture.set(n,r)),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const i=this.patterns.get(t),r=Array.from(i.values()).map(e=>{let{bin:t}=e;return t}),{w:s,h:a}=e.H(r),o=this.atlasImage.get(t);o.resize({width:s||1,height:a||1});const l=this.images.get(t);for(const[c,{bin:d,position:u}]of i.entries()){let t=u.padding;const i=d.x+t,r=d.y+t,s=l.get(c).data,a=s.width,h=s.height;t=t>1?t-1:t,e.r.copy(s,o,{x:0,y:0},{x:i,y:r},{width:a,height:h},n),e.r.copy(s,o,{x:0,y:h-t},{x:i,y:r-t},{width:a,height:t},n),e.r.copy(s,o,{x:0,y:0},{x:i,y:r+h},{width:a,height:t},n),e.r.copy(s,o,{x:a-t,y:0},{x:i-t,y:r},{width:t,height:h},n),e.r.copy(s,o,{x:0,y:0},{x:i+a,y:r},{width:t,height:h},n),e.r.copy(s,o,{x:a-t,y:h-t},{x:i-t,y:r-t},{width:t,height:t},n),e.r.copy(s,o,{x:0,y:h-t},{x:i+a,y:r-t},{width:t,height:t},n),e.r.copy(s,o,{x:0,y:0},{x:i+a,y:r+h},{width:t,height:t},n),e.r.copy(s,o,{x:a-t,y:0},{x:i-t,y:r+h},{width:t,height:t},n)}this.dirty=!0}beginFrame(){for(const e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set)}dispatchRenderCallbacks(e,t){const n=this.images.get(t);for(const i of e){if(this.callbackDispatchedThisFrame.get(t).has(i.toString()))continue;this.callbackDispatchedThisFrame.get(t).add(i.toString());const e=n.get(i.toString());G(e)&&this.updateImage(i,t,e)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Z(t){const n=t.key,i=t.value,r=t.valueSpec||{},s=t.objectElementValidators||{},a=t.style,o=t.styleSpec;let l=[];const c=e.J(i);if("object"!==c)return[new e.V(n,i,"object expected, ".concat(c," found"))];for(const d in i){const t=d.split(".")[0];let c;s[t]?c=s[t]:r[t]?c=ge:s["*"]?c=s["*"]:r["*"]&&(c=ge),c?l=l.concat(c({key:(n?"".concat(n,"."):n)+d,value:i[d],valueSpec:r[t]||r["*"],style:a,styleSpec:o,object:i,objectKey:d},i)):l.push(new e.K(n,i[d],'unknown property "'.concat(d,'"')))}for(const d in r)s[d]||r[d].required&&void 0===r[d].default&&void 0===i[d]&&l.push(new e.V(n,i,'missing required property "'.concat(d,'"')));return l}function X(t){const n=t.value,i=t.valueSpec,r=t.style,s=t.styleSpec,a=t.key,o=t.arrayElementValidator||ge;if("array"!==e.J(n))return[new e.V(a,n,"array expected, ".concat(e.J(n)," found"))];if(i.length&&n.length!==i.length)return[new e.V(a,n,"array length ".concat(i.length," expected, length ").concat(n.length," found"))];if(i["min-length"]&&n.length<i["min-length"])return[new e.V(a,n,"array length at least ".concat(i["min-length"]," expected, length ").concat(n.length," found"))];let l={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};s.$version<7&&(l.function=i.function),"object"===e.J(i.value)&&(l=i.value);let c=[];for(let e=0;e<n.length;e++)c=c.concat(o({array:n,arrayIndex:e,value:n[e],valueSpec:l,style:r,styleSpec:s,key:"".concat(a,"[").concat(e,"]")},!0));return c}function K(t){const n=t.key,i=t.value,r=t.valueSpec;let s=e.J(i);if("number"===s&&i!=i&&(s="NaN"),"number"!==s)return[new e.V(n,i,"number expected, ".concat(s," found"))];if("minimum"in r){let s=r.minimum;if("array"===e.J(r.minimum)&&(s=r.minimum[t.arrayIndex]),i<s)return[new e.V(n,i,"".concat(i," is less than the minimum value ").concat(s))]}if("maximum"in r){let s=r.maximum;if("array"===e.J(r.maximum)&&(s=r.maximum[t.arrayIndex]),i>s)return[new e.V(n,i,"".concat(i," is greater than the maximum value ").concat(s))]}return[]}function Q(t){const n=t.valueSpec,i=e.M(t.value.type);let r,s,a,o={};const l="categorical"!==i&&void 0===t.value.property,c=!l,d="array"===e.J(t.value.stops)&&"array"===e.J(t.value.stops[0])&&"object"===e.J(t.value.stops[0][0]),u=Z({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let n=[];const r=t.value;return n=n.concat(X({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===e.J(r)&&0===r.length&&n.push(new e.V(t.key,r,"array must have at least one stop")),n},default:function(e){return ge({key:e.key,value:e.value,valueSpec:n,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&l&&u.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!e.N(t.valueSpec)&&u.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.O(t.valueSpec)?u.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.Q(t.valueSpec)&&u.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!d||void 0!==t.value.property||u.push(new e.V(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const r=t.value,l=t.key;if("array"!==e.J(r))return[new e.V(l,r,"array expected, ".concat(e.J(r)," found"))];if(2!==r.length)return[new e.V(l,r,"array length 2 expected, length ".concat(r.length," found"))];if(d){if("object"!==e.J(r[0]))return[new e.V(l,r,"object expected, ".concat(e.J(r[0])," found"))];if(void 0===r[0].zoom)return[new e.V(l,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new e.V(l,r,"object stop key must have value")];const n=e.M(r[0].zoom);if("number"!=typeof n)return[new e.V(l,r[0].zoom,"stop zoom values must be numbers")];if(a&&a>n)return[new e.V(l,r[0].zoom,"stop zoom values must appear in ascending order")];n!==a&&(a=n,s=void 0,o={}),i=i.concat(Z({key:"".concat(l,"[0]"),value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:K,value:p}}))}else i=i.concat(p({key:"".concat(l,"[0]"),value:r[0],style:t.style,styleSpec:t.styleSpec},r));return e.S(e.U(r[1]))?i.concat([new e.V("".concat(l,"[1]"),r[1],"expressions are not allowed in function stops.")]):i.concat(ge({key:"".concat(l,"[1]"),value:r[1],valueSpec:n,style:t.style,styleSpec:t.styleSpec}))}function p(t,a){const l=e.J(t.value),c=e.M(t.value),d=null!==t.value?t.value:a;if(r){if(l!==r)return[new e.V(t.key,d,"".concat(l," stop domain type must match previous stop domain type ").concat(r))]}else r=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new e.V(t.key,d,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==i){let r="number expected, ".concat(l," found");return e.O(n)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,d,r)]}return"categorical"!==i||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==i&&"number"===l&&"number"==typeof c&&"number"==typeof s&&void 0!==s&&c<s?[new e.V(t.key,d,"stop domain values must appear in ascending order")]:(s=c,"categorical"===i&&c in o?[new e.V(t.key,d,"stop domain values must be unique")]:(o[c]=!0,[])):[new e.V(t.key,d,"integer expected, found ".concat(String(c)))]}}function J(t){const n=("property"===t.expressionContext?e.W:e.X)(e.U(t.value),t.valueSpec);if("error"===n.result)return n.value.map(n=>new e.V("".concat(t.key).concat(n.key),t.value,n.message));const i=n.value.expression||n.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new e.V(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.Y(i))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return $(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.Z(i,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e._(i))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $(t,n){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const e of n.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const r=[];return t instanceof e.$&&i.has(t.name)?[new e.V(n.key,n.value,'["'.concat(t.name,'"] expression is not supported in a filter for a ').concat(n.object.type," layer with id: ").concat(n.object.id))]:(t.eachChild(e=>{r.push(...$(e,n))}),r)}function ee(t){const n=t.key,i=t.value,r=t.valueSpec,s=[];return Array.isArray(r.values)?-1===r.values.indexOf(e.M(i))&&s.push(new e.V(n,i,"expected one of [".concat(r.values.join(", "),"], ").concat(JSON.stringify(i)," found"))):-1===Object.keys(r.values).indexOf(e.M(i))&&s.push(new e.V(n,i,"expected one of [".concat(Object.keys(r.values).join(", "),"], ").concat(JSON.stringify(i)," found"))),s}function te(t){return e.a1(e.U(t.value))?J(e.L({},t,{expressionContext:"filter",valueSpec:t.styleSpec["filter_".concat(t.layerType||"fill")]})):ne(t)}function ne(t){const n=t.value,i=t.key;if("array"!==e.J(n))return[new e.V(i,n,"array expected, ".concat(e.J(n)," found"))];const r=t.styleSpec;let s,a=[];if(n.length<1)return[new e.V(i,n,"filter array must have at least 1 element")];switch(a=a.concat(ee({key:"".concat(i,"[0]"),value:n[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===e.M(n[1])&&a.push(new e.V(i,n,'"$type" cannot be use with operator "'.concat(n[0],'"')));case"==":case"!=":3!==n.length&&a.push(new e.V(i,n,'filter array for operator "'.concat(n[0],'" must have 3 elements')));case"in":case"!in":n.length>=2&&(s=e.J(n[1]),"string"!==s&&a.push(new e.V("".concat(i,"[1]"),n[1],"string expected, ".concat(s," found"))));for(let o=2;o<n.length;o++)s=e.J(n[o]),"$type"===e.M(n[1])?a=a.concat(ee({key:"".concat(i,"[").concat(o,"]"),value:n[o],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&a.push(new e.V("".concat(i,"[").concat(o,"]"),n[o],"string, number, or boolean expected, ".concat(s," found")));break;case"any":case"all":case"none":for(let e=1;e<n.length;e++)a=a.concat(ne({key:"".concat(i,"[").concat(e,"]"),value:n[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":s=e.J(n[1]),2!==n.length?a.push(new e.V(i,n,'filter array for "'.concat(n[0],'" operator must have 2 elements'))):"string"!==s&&a.push(new e.V("".concat(i,"[1]"),n[1],"string expected, ".concat(s," found")))}return a}function ie(t,n){const i=t.key,r=t.style,s=t.layer,a=t.styleSpec,o=t.value,l=t.objectKey,c=a["".concat(n,"_").concat(t.layerType)];if(!c)return[];const d=l.match(/^(.*)-use-theme$/);if("paint"===n&&d&&c[d[1]])return e.S(o)?[].concat(ge({key:t.key,value:o,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:r,styleSpec:a,expressionContext:"property",propertyType:n,propertyKey:l})):ge({key:i,value:o,valueSpec:{type:"string"},style:r,styleSpec:a});const u=l.match(/^(.*)-transition$/);if("paint"===n&&u&&c[u[1]]&&c[u[1]].transition)return ge({key:i,value:o,valueSpec:a.transition,style:r,styleSpec:a});const h=t.valueSpec||c[l];if(!h)return[new e.K(i,o,'unknown property "'.concat(l,'"'))];let p;if("string"===e.J(o)&&e.O(h)&&!h.tokens&&(p=/^{([^}]+)}$/.exec(o))){const t='`{ "type": "identity", "property": '.concat(p?JSON.stringify(p[1]):'"_"'," }`");return[new e.V(i,o,'"'.concat(l,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(t,"."))]}const m=[];if("symbol"===t.layerType)"text-field"!==l||!r||r.glyphs||r.imports||m.push(new e.V(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.a2(e.U(o))&&"identity"===e.M(o.type)&&m.push(new e.V(i,o,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===n&&s&&s.layout&&s.layout.hasOwnProperty("model-id")&&e.O(h)&&(e.a3(h)||e.Q(h))){const t=e.W(e.U(o),h),n=t.value.expression||t.value._styleExpression.expression;n&&!e.Z(n,["measure-light"])&&("model-emissive-strength"===l&&e._(n)&&e.Y(n)||m.push(new e.V(i,o,"".concat(l," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return m.concat(ge({key:t.key,value:o,valueSpec:h,style:r,styleSpec:a,expressionContext:"property",propertyType:n,propertyKey:l}))}function re(e){return ie(e,"paint")}function se(e){return ie(e,"layout")}function ae(t){let n=[];const i=t.value,r=t.key,s=t.style,a=t.styleSpec;i.type||i.ref||n.push(new e.V(r,i,'either "type" or "ref" is required'));let o=e.M(i.type);const l=e.M(i.ref);if(i.id){const a=e.M(i.id);for(let o=0;o<t.arrayIndex;o++){const t=s.layers[o];e.M(t.id)===a&&n.push(new e.V(r,i.id,'duplicate layer id "'.concat(i.id,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in i&&n.push(new e.V(r,i[t],'"'.concat(t,'" is prohibited for ref layers')))}),s.layers.forEach(n=>{e.M(n.id)===l&&(t=n)}),t?t.ref?n.push(new e.V(r,i.ref,"ref cannot reference another ref layer")):o=e.M(t.type):"string"==typeof l&&n.push(new e.V(r,i.ref,'ref layer "'.concat(l,'" not found')))}else if("background"!==o&&"sky"!==o&&"slot"!==o)if(i.source){const t=s.sources&&s.sources[i.source],a=t&&e.M(t.type);t?"vector"===a&&"raster"===o?n.push(new e.V(r,i.source,'layer "'.concat(i.id,'" requires a raster source'))):"raster"===a&&"raster"!==o?n.push(new e.V(r,i.source,'layer "'.concat(i.id,'" requires a vector source'))):"vector"!==a||i["source-layer"]?"raster-dem"===a&&"hillshade"!==o?n.push(new e.V(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==a||["raster","raster-particle"].includes(o)?"line"===o&&i.paint&&(i.paint["line-gradient"]||i.paint["line-trim-offset"])&&"geojson"===a&&!t.lineMetrics?n.push(new e.V(r,i,'layer "'.concat(i.id,'" specifies a line-gradient, which requires the GeoJSON source to have `lineMetrics` enabled.'))):"raster-particle"===o&&"raster-array"!==a&&n.push(new e.V(r,i.source,'layer "'.concat(i.id,"\" requires a 'raster-array' source."))):n.push(new e.V(r,i.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new e.V(r,i,'layer "'.concat(i.id,'" must specify a "source-layer"'))):n.push(new e.V(r,i.source,'source "'.concat(i.source,'" not found')))}else n.push(new e.V(r,i,'missing required property "source"'));return n=n.concat(Z({key:r,value:i,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ge({key:"".concat(r,".type"),value:i.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:t=>te(e.L({layerType:o},t)),layout:t=>Z({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>se(e.L({layerType:o},t))}}),paint:t=>Z({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>re(e.L({layerType:o,layer:i},t))}})}})),n}function oe(t){const n=t.value,i=t.key,r=e.J(n);return"string"!==r?[new e.V(i,n,"string expected, ".concat(r," found"))]:[]}const le={promoteId:function t(n){let{key:i,value:r}=n;if("string"===e.J(r))return oe({key:i,value:r});if(Array.isArray(r)){const t=[],n=e.U(r),s=e.X(n);return"error"===s.result&&s.value.forEach(n=>{t.push(new e.V("".concat(i).concat(n.key),null,"".concat(n.message)))}),e.Z(s.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||t.push(new e.V("".concat(i),null,"promoteId expression should be only feature dependent")),t}{const e=[];for(const n in r)e.push(...t({key:"".concat(i,".").concat(n),value:r[n]}));return e}}};function ce(t){const n=t.value,i=t.key,r=t.styleSpec,s=t.style;if(!n.type)return[new e.V(i,n,'"type" is required')];const a=e.M(n.type);let o=[];switch(["vector","raster","raster-dem","raster-array"].includes(a)&&(n.url||n.tiles||o.push(new e.K(i,n,'Either "url" or "tiles" is required.'))),a){case"vector":case"raster":case"raster-dem":case"raster-array":return o=o.concat(Z({key:i,value:n,valueSpec:r["source_".concat(a.replace("-","_"))],style:t.style,styleSpec:r,objectElementValidators:le})),o;case"geojson":if(o=Z({key:i,value:n,valueSpec:r.source_geojson,style:s,styleSpec:r,objectElementValidators:le}),n.cluster)for(const e in n.clusterProperties){const[t,r]=n.clusterProperties[e],s="string"==typeof t?[t,["accumulated"],["get",e]]:t;o.push(...J({key:"".concat(i,".").concat(e,".map"),value:r,expressionContext:"cluster-map"})),o.push(...J({key:"".concat(i,".").concat(e,".reduce"),value:s,expressionContext:"cluster-reduce"}))}return o;case"video":return Z({key:i,value:n,valueSpec:r.source_video,style:s,styleSpec:r});case"image":return Z({key:i,value:n,valueSpec:r.source_image,style:s,styleSpec:r});case"canvas":return[new e.V(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ee({key:"".concat(i,".type"),value:n.type,valueSpec:{values:de(r)}})}}function de(e){return e.source.reduce((t,n)=>{const i=e[n];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t},[])}function ue(t){const n=t.value,i=t.styleSpec,r=i.light,s=t.style;let a=[];const o=e.J(n);if(void 0===n)return a;if("object"!==o)return a=a.concat([new e.V("light",n,"object expected, ".concat(o," found"))]),a;for(const l in n){const t=l.match(/^(.*)-transition$/),o=l.match(/^(.*)-use-theme$/);a=a.concat(o&&r[o[1]]?ge({key:l,value:n[l],valueSpec:{type:"string"},style:s,styleSpec:i}):t&&r[t[1]]&&r[t[1]].transition?ge({key:l,value:n[l],valueSpec:i.transition,style:s,styleSpec:i}):r[l]?ge({key:l,value:n[l],valueSpec:r[l],style:s,styleSpec:i}):[new e.V(l,n[l],'unknown property "'.concat(l,'"'))])}return a}function he(t){const n=t.value;let i=[];if(!n)return i;const r=e.J(n);if("object"!==r)return i=i.concat([new e.V("light-3d",n,"object expected, ".concat(r," found"))]),i;const s=t.styleSpec,a=s["light-3d"],o=t.key,l=t.style,c=t.style.lights;for(const h of["type","id"])if(!(h in n))return i=i.concat([new e.V("light-3d",n,"missing property ".concat(h," on light"))]),i;if(n.type&&c)for(let h=0;h<t.arrayIndex;h++){const t=e.M(n.type),r=c[h];e.M(r.type)===t&&i.push(new e.V(o,n.id,'duplicate light type "'.concat(n.type,'", previously defined at line ').concat(r.id.__line__)))}const d="properties_light_".concat(n.type);if(!(d in s))return i=i.concat([new e.V("light-3d",n,"Invalid light type ".concat(n.type))]),i;const u=s[d];for(const h in n)if("properties"===h){const r=n[h],a=e.J(r);if("object"!==a)return i=i.concat([new e.V("properties",r,"object expected, ".concat(a," found"))]),i;for(const o in r){const a=o.match(/^(.*)-transition$/),c=o.match(/^(.*)-use-theme$/);i=i.concat(c&&u[c[1]]?ge({key:h,value:r[o],valueSpec:{type:"string"},style:l,styleSpec:s}):a&&u[a[1]]&&u[a[1]].transition?ge({key:h,value:n[h],valueSpec:s.transition,style:l,styleSpec:s}):u[o]?ge({key:o,value:r[o],valueSpec:u[o],style:l,styleSpec:s}):[new e.K(t.key,r[o],'unknown property "'.concat(o,'"'))])}}else i=i.concat(a[h]?ge({key:h,value:n[h],valueSpec:a[h],style:l,styleSpec:s}):[new e.K(h,n[h],'unknown property "'.concat(h,'"'))]);return i}function pe(t){const n=t.value,i=t.key,r=t.style,s=t.styleSpec,a=s.terrain;let o=[];const l=e.J(n);if(void 0===n)return o;if("null"===l)return o;if("object"!==l)return o=o.concat([new e.V("terrain",n,"object expected, ".concat(l," found"))]),o;for(const c in n){const t=c.match(/^(.*)-transition$/),i=c.match(/^(.*)-use-theme$/);o=o.concat(i&&a[i[1]]?ge({key:c,value:n[c],valueSpec:{type:"string"},style:r,styleSpec:s}):t&&a[t[1]]&&a[t[1]].transition?ge({key:c,value:n[c],valueSpec:s.transition,style:r,styleSpec:s}):a[c]?ge({key:c,value:n[c],valueSpec:a[c],style:r,styleSpec:s}):[new e.K(c,n[c],'unknown property "'.concat(c,'"'))])}if(n.source){const t=r.sources&&r.sources[n.source],s=t&&e.M(t.type);t?"raster-dem"!==s&&o.push(new e.V(i,n.source,"terrain cannot be used with a source of type ".concat(String(s),', it only be used with a "raster-dem" source type'))):o.push(new e.V(i,n.source,'source "'.concat(n.source,'" not found')))}else o.push(new e.V(i,n,'terrain is missing required property "source"'));return o}function me(t){const n=t.value,i=t.style,r=t.styleSpec,s=r.fog;let a=[];const o=e.J(n);if(void 0===n)return a;if("object"!==o)return a=a.concat([new e.V("fog",n,"object expected, ".concat(o," found"))]),a;for(const l in n){const t=l.match(/^(.*)-transition$/),o=l.match(/^(.*)-use-theme$/);a=a.concat(o&&s[o[1]]?ge({key:l,value:n[l],valueSpec:{type:"string"},style:i,styleSpec:r}):t&&s[t[1]]&&s[t[1]].transition?ge({key:l,value:n[l],valueSpec:r.transition,style:i,styleSpec:r}):s[l]?ge({key:l,value:n[l],valueSpec:s[l],style:i,styleSpec:r}):[new e.K(l,n[l],'unknown property "'.concat(l,'"'))])}return a}const fe={"*":()=>[],array:X,boolean:function(t){const n=t.value,i=t.key,r=e.J(n);return"boolean"!==r?[new e.V(i,n,"boolean expected, ".concat(r," found"))]:[]},number:K,color:function(t){const n=t.key,i=t.value,r=e.J(i);return"string"!==r?[new e.V(n,i,"color expected, ".concat(r," found"))]:null===e.a0.parseCSSColor(i)?[new e.V(n,i,'color expected, "'.concat(i,'" found'))]:[]},enum:ee,filter:te,function:Q,layer:ae,object:Z,source:ce,model:e.a4,light:ue,"light-3d":he,terrain:pe,fog:me,string:oe,formatted:function(e){return 0===oe(e).length?[]:J(e)},resolvedImage:function(e){return 0===oe(e).length?[]:J(e)},projection:function(t){const n=t.value,i=t.styleSpec,r=i.projection,s=t.style;let a=[];const o=e.J(n);if("object"===o)for(const e in n)a=a.concat(ge({key:e,value:n[e],valueSpec:r[e],style:s,styleSpec:i}));else"string"!==o&&(a=a.concat([new e.V("projection",n,"object or string expected, ".concat(o," found"))]));return a},import:function(t){const{value:n,styleSpec:s}=t,{data:a}=n,o=i(n,r);Object.defineProperty(o,"__line__",{value:n.__line__,enumerable:!1});let l=Z(e.L({},t,{value:o,valueSpec:s.import}));return""===e.M(o.id)&&l.push(new e.V("".concat(t.key,".id"),o,"import id can't be an empty string")),a&&(l=l.concat(ye(a,s,{key:"".concat(t.key,".data")}))),l},iconset:function(t){const n=t.value,i=t.key,r=t.styleSpec,s=t.style;if(!n.type)return[new e.V(i,n,'"type" is required')];const a=e.M(n.type);let o=[];if(o=o.concat(Z({key:i,value:n,valueSpec:r["iconset_".concat(a)],style:s,styleSpec:r})),"source"===a&&n.source){const t=s.sources&&s.sources[n.source],r=t&&e.M(t.type);t?"raster-array"!==r&&o.push(new e.V(i,n.source,"iconset cannot be used with a source of type ".concat(String(r),', it only be used with a "raster-array" source type'))):o.push(new e.V(i,n.source,'source "'.concat(n.source,'" not found')))}return o}};function ge(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t.value,r=t.valueSpec,s=t.styleSpec;if(r.expression&&e.a2(e.M(i)))return Q(t);if(r.expression&&e.S(e.U(i)))return J(t);if(r.type&&fe[r.type]){const i=fe[r.type](t);return!0===n&&i.length>0&&"array"===e.J(t.value)?J(t):i}return Z(e.L({},t,{valueSpec:r.type?s[r.type]:r}))}function xe(t){const n=t.value,i=t.key,r=oe(t);return r.length||(-1===n.indexOf("{fontstack}")&&r.push(new e.V(i,n,'"glyphs" url must include a "{fontstack}" token')),-1===n.indexOf("{range}")&&r.push(new e.V(i,n,'"glyphs" url must include a "{range}" token'))),r}function ye(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a5;return ge({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:n.$root,styleSpec:n,style:t,objectElementValidators:{glyphs:xe,"*":()=>[]}})}function ve(t){return De(ye(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a5))}const _e=e=>De(ce(e)),be=e=>De(ue(e)),we=e=>De(he(e)),je=e=>De(pe(e)),Ne=e=>De(me(e)),Se=t=>De(function(t){const n=t.value,i=t.style,r=t.styleSpec,s=r.snow;let a=[];const o=e.J(n);if(void 0===n)return a;if("object"!==o)return a=a.concat([new e.V("snow",n,"object expected, ".concat(o," found"))]),a;for(const l in n){const t=l.match(/^(.*)-transition$/);a=a.concat(t&&s[t[1]]&&s[t[1]].transition?ge({key:l,value:n[l],valueSpec:r.transition,style:i,styleSpec:r}):s[l]?ge({key:l,value:n[l],valueSpec:s[l],style:i,styleSpec:r}):[new e.K(l,n[l],'unknown property "'.concat(l,'"'))])}return a}(t)),ke=t=>De(function(t){const n=t.value,i=t.style,r=t.styleSpec,s=r.rain;let a=[];const o=e.J(n);if(void 0===n)return a;if("object"!==o)return a=a.concat([new e.V("rain",n,"object expected, ".concat(o," found"))]),a;for(const l in n){const t=l.match(/^(.*)-transition$/);a=a.concat(t&&s[t[1]]&&s[t[1]].transition?ge({key:l,value:n[l],valueSpec:r.transition,style:i,styleSpec:r}):s[l]?ge({key:l,value:n[l],valueSpec:s[l],style:i,styleSpec:r}):[new e.K(l,n[l],'unknown property "'.concat(l,'"'))])}return a}(t)),Te=e=>De(ae(e)),Ce=e=>De(te(e)),Ee=e=>De(re(e)),Ae=e=>De(se(e)),Me=t=>De(e.a4(t));function De(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Ie(t,n){let i=!1;if(n&&n.length)for(const r of n)r instanceof e.K?e.w(r.message):(t.fire(new e.z(new Error(r.message))),i=!0);return i}let Pe;class Re extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.a6(Pe||(Pe=new e.a7({anchor:new e.a8(e.a5.light.anchor),position:new e.a9(e.a5.light.position),color:new e.a8(e.a5.light.color),intensity:new e.a8(e.a5.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(be,e,n)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Ie(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let Le=class extends e.E{constructor(t,n,i,r,s){super(),this.scope=i,this._transitionable=new e.a6(new e.a7({source:new e.a8(e.a5.terrain.source),exaggeration:new e.a8(e.a5.terrain.exaggeration)}),i,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=s}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.aa(t,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const t=this._transitionable._values.exaggeration;if(!t)return null;const n=t.value.expression;if(!n)return null;let i=-1,r=-1,s=1;for(const a of n.zoomStops)s=n.evaluate(new e.aa(a,{worldview:this.worldview})),s>.01?(i=a,r=-1):r=a;return s<.01&&i>0&&r>i?[i,r]:null}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.ab}};const ze=45,Oe=65,Fe=.05;function Be(t,n,i,r){const s=e.af(ze,Oe,i),[a,o]=Ve(t,r);let l=1-Math.min(1,Math.exp((n-a)/(o-a)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*s*t.alpha}function Ve(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function Ue(t,n,i,r,s){const a=e.ad([],[n,i,r],s.mercatorFogMatrix);return Be(t,e.ae(a),s.pitch,s._fov)}function He(t,n,i,r,s,a,o){const l=[[i,r,0],[s,r,0],[s,a,0],[i,a,0]];let c=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(const u of l){const t=e.ad([],u,n),i=e.ae(t);c=Math.min(c,i),d=Math.max(d,i)}return[Be(t,c,o.pitch,o._fov),Be(t,d,o.pitch,o._fov)]}class qe extends e.E{constructor(t,n,i,r){super();const s=new e.a7({range:new e.a8(e.a5.fog.range),color:new e.a8(e.a5.fog.color),"color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.a8(e.a5.fog["high-color"]),"high-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.a8(e.a5.fog["space-color"]),"space-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.a8(e.a5.fog["horizon-blend"]),"star-intensity":new e.a8(e.a5.fog["star-intensity"]),"vertical-range":new e.a8(e.a5.fog["vertical-range"])});this._transitionable=new e.a6(s,i,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new e.ag(s),this.scope=i}get state(){const t=this._transform,n="globe"===t.projection.name,i=e.ah(t.zoom),r=this.properties.get("range"),s=[.5,3];return{range:n?[e.ai(s[0],r[0],i),e.ai(s[1],r[1],i)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Ne,t,i))return;const r=e.h({},t);for(const s of Object.keys(e.a5.fog))void 0===r[s]&&(r[s]=e.a5.fog[s].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.af(ze,Oe,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(t,n,i){const r=e.ac.fromLngLat(n),s=i.elevation?i.elevation.getAtPointOrZero(r):0;return Ue(t,r.x,r.y,s,i)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return He(this.state,n,0,0,e.aj,e.aj,this._transform)}getOpacityForBounds(e,t,n,i,r){return this._transform.projection.supportsFog?He(this.state,e,t,n,i,r,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Ve(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const i of n){const n=t.points[i];let r;if(n[2]>=0)r=n;else{const s=t.points[i-4];r=e.ak(s,n,s[2]/(s[2]-n[2]))}if(Ue(this.state,r[0],r[1],0,this._transform)>=Fe)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Ie(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let We,Ge,Ye,Ze,Xe=class extends e.E{constructor(t,n,i,r){super();const s=We||(We=new e.a7({density:new e.a8(e.a5.snow.density),intensity:new e.a8(e.a5.snow.intensity),color:new e.a8(e.a5.snow.color),opacity:new e.a8(e.a5.snow.opacity),vignette:new e.a8(e.a5.snow.vignette),"vignette-color":new e.a8(e.a5.snow["vignette-color"]),"center-thinning":new e.a8(e.a5.snow["center-thinning"]),direction:new e.a8(e.a5.snow.direction),"flake-size":new e.a8(e.a5.snow["flake-size"])}));this._transitionable=new e.a6(s,i,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(s),this.scope=i}get state(){const t=this.properties.get("opacity"),n=this.properties.get("color"),i=this.properties.get("direction"),r=e.al(i[0]),s=-Math.max(e.al(i[1]),.01),a=[Math.cos(r)*Math.cos(s),Math.sin(r)*Math.cos(s),Math.sin(s)],o=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=o,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(n.r,n.g,n.b,n.a*t),direction:a,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Se,t,i))return;const r=e.h({},t);for(const s of Object.keys(e.a5.snow))void 0===r[s]&&(r[s]=e.a5.snow[s].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Ie(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}},Ke=class extends e.E{constructor(t,n,i,r){super();const s=Ge||(Ge=new e.a7({density:new e.a8(e.a5.rain.density),intensity:new e.a8(e.a5.rain.intensity),color:new e.a8(e.a5.rain.color),opacity:new e.a8(e.a5.rain.opacity),vignette:new e.a8(e.a5.rain.vignette),"vignette-color":new e.a8(e.a5.rain["vignette-color"]),"center-thinning":new e.a8(e.a5.rain["center-thinning"]),direction:new e.a8(e.a5.rain.direction),"droplet-size":new e.a8(e.a5.rain["droplet-size"]),"distortion-strength":new e.a8(e.a5.rain["distortion-strength"])}));this._transitionable=new e.a6(s,i,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(s),this.scope=i}get state(){const t=this.properties.get("opacity"),n=this.properties.get("color"),i=this.properties.get("direction"),r=e.al(i[0]),s=-Math.max(e.al(i[1]),.01),a=[Math.cos(r)*Math.cos(s),Math.sin(r)*Math.cos(s),Math.sin(s)],o=this.properties.get("vignette-color");return o.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(n.r,n.g,n.b,n.a*t),direction:a,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:o}}get(){return this._transitionable.serialize()}set(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(ke,t,i))return;const r=e.h({},t);for(const s of Object.keys(e.a5.rain))void 0===r[s]&&(r[s]=e.a5.rain[s].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Ie(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}};class Qe extends e.E{constructor(t,n,i,r){super(),this.scope=i,this._options=t,this.properties=new e.ag(n),this._transitionable=new e.a6(n,i,new Map(r)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class Je{constructor(e,t,n){this.screenBounds=e,this.cameraPoint=n.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=t,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(t,n){let i,r;if(t instanceof e.P||"number"==typeof t[0]){const s=e.P.convert(t);i=[s],r=n.isPointAboveHorizon(s)}else{const s=e.P.convert(t[0]),a=e.P.convert(t[1]),o=s.add(a)._div(2);i=[s,a],r=e.ao(s,a).every(e=>n.isPointAboveHorizon(e))&&n.isPointAboveHorizon(o)}return new Je(i,r,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.ao(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.ao(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),e.ap(r,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.ao(n,i,t),s=this.cameraPoint.clone();switch(3*((s.y>n.y)+(s.y>i.y))+((s.x>n.x)+(s.x>i.x))){case 0:r[0]=s,r[4]=s.clone();break;case 1:r.splice(1,0,s);break;case 2:r[1]=s;break;case 3:r.splice(4,0,s);break;case 5:r.splice(2,0,s);break;case 6:r[3]=s;break;case 7:r.splice(3,0,s);break;case 8:r[2]=s}return r}containsTile(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=t.queryPadding/n._pixelsPerMercatorPixel+1,a=i?this._bufferedCameraMercator(s,n):this._bufferedScreenMercator(s,n);let o=t.tileID.wrap+(a.unwrapped?r:0);const l=a.polygon.map(n=>e.aq(t.tileTransform,n,o));if(!e.ar(l,0,0,e.aj,e.aj))return;o=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map(n=>e.as(t.tileTransform,n,o)),d=c.map(t=>new e.P(t[0],t[1])),u=n.getFreeCameraOptions().position||new e.ac(0,0,0),h=e.as(t.tileTransform,u,o),p=c.map(t=>{const n=e.at(t,t,h);return e.au(n,n),new e.av(h,n)}),m=e.aw(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:d,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(f=e.ax(l),f.min.x=e.ay(f.min.x,0,e.aj),f.min.y=e.ay(f.min.y,0,e.aj),f.max.x=e.ay(f.max.x,0,e.aj),f.max.y=e.ay(f.max.y,0,e.aj),f),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:m};var f}_bufferedScreenMercator(e,t){const n=tt(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(e,t){const n=tt(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[n]=i,i}}_projectAndResample(t,n){const i=function(t,n){const i=e.az([],n.pixelMatrix,n.globeMatrix),r=[0,-e.aB,0,1],s=[0,e.aB,0,1],a=[0,0,0,1];e.aA(r,r,i),e.aA(s,s,i),e.aA(a,a,i);const o=new e.P(r[0]/r[3],r[1]/r[3]),l=new e.P(s[0]/s[3],s[1]/s[3]),c=e.aC(t,o)&&r[3]<a[3],d=e.aC(t,l)&&s[3]<a[3];if(!c&&!d)return null;const u=function(e,t,n){for(let i=1;i<e.length;i++){const r=et(t.pointCoordinate3D(e[i-1]).x),s=et(t.pointCoordinate3D(e[i]).x);if(n<0){if(r<s)return{idx:i,t:-r/(s-1-r)}}else if(s<r)return{idx:i,t:(1-r)/(s+1-r)}}return null}(t,n,c?-1:1);if(!u)return null;const{idx:h,t:p}=u;let m=h>1?$e(t.slice(0,h),n):[],f=h<t.length?$e(t.slice(h),n):[];m=m.map(t=>new e.P(et(t.x),t.y)),f=f.map(t=>new e.P(et(t.x),t.y));const g=[...m];0===g.length&&g.push(f[f.length-1]);const x=e.ai(g[g.length-1].y,(0===f.length?m[0]:f[0]).y,p);let y;return y=c?[new e.P(0,x),new e.P(0,0),new e.P(1,0),new e.P(1,x)]:[new e.P(1,x),new e.P(1,1),new e.P(0,1),new e.P(0,x)],g.push(...y),0===f.length?g.push(m[0]):g.push(...f),{polygon:g.map(t=>new e.ac(t.x,t.y)),unwrapped:!1}}(t,n);if(i)return i;const r=function(t,n){let i=!1,r=-1/0,s=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,s=e);for(let e=0;e<t.length-1;e++){const n=(s+e)%(t.length-1),r=t[n],a=t[n+1];Math.abs(r.x-a.x)>.5&&(r.x<a.x?(r.x+=1,0===n&&(t[t.length-1].x+=1)):(a.x+=1,n+1===t.length-1&&(t[0].x+=1)),i=!0)}const a=e.aD(n.center.lng);return i&&a<Math.abs(a-1)&&t.forEach(e=>{e.x-=1}),{polygon:t,unwrapped:i}}($e(t,n).map(t=>new e.P(et(t.x),t.y)),n);return{polygon:r.polygon.map(t=>new e.ac(t.x,t.y)),unwrapped:r.unwrapped}}}function $e(t,n){return e.aE(t,e=>{const t=n.pointCoordinate3D(e);e.x=t.x,e.y=t.y},1/256)}function et(e){return e<0?1+e%1:e%1}function tt(e){return 100*e|0}function nt(t,n,r,a,o){const l=function(i,r){if(i)return o(i);if(r){if(t.url&&r.tiles&&t.tiles&&delete t.tiles,r.variants){if(!Array.isArray(r.variants))return o(new Error("variants must be an array"));for(const t of r.variants){if(null==t||"object"!=typeof t||t.constructor!==Object)return o(new Error("variant must be an object"));if(!Array.isArray(t.capabilities))return o(new Error("capabilities must be an array"));if(1===t.capabilities.length&&"meshopt"===t.capabilities[0]){r=e.h(r,t);break}}}const i=e.aF(e.h({},r,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);i.tiles=n.canonicalizeTileset(i,t.url),o(null,i)}},c=function(e,t,n){if(!e)return null;if(!t&&!n)return e;n=n||e.worldview_default;const i=Object.values(e.language||{});if(0===i.length)return null;const r=Object.values(e.worldview||{});if(0===r.length)return null;const s=i.every(e=>e===t),a=r.every(e=>e===n);return s&&a?e:t in(e.language_options||{})||n in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,r,a);return c?e.q.frame(()=>l(null,c)):t.url?e.n(n.transformRequest(n.normalizeSourceURL(t.url,null,r,a),e.R.Source),l):e.q.frame(()=>{const{data:e}=t,n=i(t,s);l(null,n)})}function it(t,n){const i=Math.pow(2,n.z),r=Math.floor(e.aD(t.getWest())*i),s=Math.floor(e.aH(t.getNorth())*i),a=Math.ceil(e.aD(t.getEast())*i),o=Math.ceil(e.aH(t.getSouth())*i);return n.x>=r&&n.x<a&&n.y>=s&&n.y<o}class rt{constructor(t,n,i){this.bounds=t?e.aG.convert(this.validateBounds(t)):null,this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const n of t)this.extraBounds.push(e.aG.convert(this.validateBounds(n)))}}contains(e){if(e.z>this.maxzoom||e.z<this.minzoom)return!1;if(this.bounds&&!it(this.bounds,e))return!1;if(!this.extraBounds)return!0;for(const t of this.extraBounds)if(it(t,e))return!0;return!1}static fromTileJSON(e){if(!e.bounds&&!e.extra_bounds)return null;const t=new rt(e.bounds,e.minzoom,e.maxzoom);return t.addExtraBounds(e.extra_bounds),t}}class st extends e.E{constructor(t,n,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.h(this,e.aF(n,["url","scheme","tileSize","promoteId"])),this._options=e.h({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.aI}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=nt(this._options,this.map._requestManager,n,i,(r,s)=>{if(this._tileJSONRequest=null,this._loaded=!0,r)n&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(n)),i&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(i)),this.fire(new e.z(r));else if(s){if(e.h(this,s),this.hasWorldviews=!!s.worldview_options,s.worldview_default&&(this.worldviewDefault=s.worldview_default),s.vector_layers){this.vectorLayers=s.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const e of s.vector_layers)this.vectorLayerIds.push(e.id),s.worldview&&s.worldview[e.source]&&this.localizableLayerIds.add(e.id)}this.tileBounds=rt.fromTileJSON(s),P(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(r)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.h({},this._options)}loadTile(t,n){const i=t.tileID.canonical.url(this.tiles,this.scheme),r=this.map._requestManager.normalizeTileURL(i),s=this.map._requestManager.transformRequest(r,e.R.Tile),a=this.map.style?this.map.style.getLut(this.scope):null,o=a?{image:a.image.clone()}:null,l={request:s,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:o,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&e.j(i)&&(l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else{const n=e.aJ.call({deduped:this._deduped},l,(e,n)=>{e||!n?c.call(this,e):(l.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0))},!0);t.request={cancel:n}}function c(i,r){return delete t.request,t.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.aK(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class at extends e.E{constructor(t,n,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.h({type:"raster"},n),e.h(this,e.aF(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=this.map.getWorldview();this._tileJSONRequest=nt(this._options,this.map._requestManager,null,n,(n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new e.z(n)):i&&(e.h(this,i),i.raster_layers&&(this.rasterLayers=i.raster_layers,this.rasterLayerIds=this.rasterLayers.map(e=>e.id)),this.tileBounds=rt.fromTileJSON(i),P(i.tiles),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.h({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,n){const i=e.q.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=e.o(this.map._requestManager.transformRequest(r,e.R.Tile),(i,r,s,a)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):i?(t.state="errored",n(i)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a}),t.setTexture(r,this.map.painter),t.state="loaded",e.aK(this.dispatcher),void n(null)):n(null)))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t()}unloadTile(t,n){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ot extends at{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=e.h({type:"raster-array"},n)}triggerRepaint(e){const t=this.map.painter._terrain,n=this.map.style.getSourceCache(this.id);t&&t.enabled&&n&&t._clearRenderCacheForTile(n.id,e.tileID),this.map.triggerRepaint()}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),r=this.map._requestManager.transformRequest(i,e.R.Tile),s={request:r,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=r,t.actor||(t.actor=this.dispatcher.getActor());const a=(e,i,r,s)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(e){if("AbortError"===e.name)return;return t.state="errored",n(e)}if(this.map._refreshExpiredTiles&&i&&t.setExpiryData({cacheControl:r,expires:s}),this.partial)t.state="empty";else{if(!i)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=i}n(null)};t.request=this.partial?t.fetchHeader(void 0,a.bind(this)):t.actor.send("loadTile",s,a.bind(this),void 0,!0)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){const n=e.texturePerLayer;if(e.flushAllQueues(),n.size){e.destroy(!0);for(const e of n.values())this.map.painter.saveTileTexture(e)}else e.destroy()}prepareTile(t,n,i,r){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(n,i,r,(n,r)=>{if(n)return t.state="errored",this.fire(new e.z(n)),void this.triggerRepaint(t);r&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(i,r,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find(t=>{let{id:n}=t;return n===e}),n=t&&t.fields,i=n&&n.bands&&n.bands;return i?i[0]:0}getTextureDescriptor(t,n,i){if(!t)return;const r=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!r)return;let s=null;n instanceof e.aN?s=n.paint.get("raster-array-band"):n instanceof e.aO&&(s=n.paint.get("raster-particle-array-band"));const a=s||this.getInitialBand(r);if(null==a)return;if(!t.textureDescriptorPerLayer.get(n.id))return void this.prepareTile(t,r,n.id,a);if(t.updateNeeded(n.id,a)&&!i)return;const o=t.textureDescriptorPerLayer.get(n.id);return Object.assign({},o,{texture:t.texturePerLayer.get(n.id)})}getImages(t,n){const i=new Map;for(const r of t)for(const t of n){const[n,s]=t.split("/"),a=r.getLayer(n);if(!a)continue;if(!a.hasBand(s)||!a.hasDataForBand(s))continue;const{bytes:o,tileSize:l,buffer:c}=a.getBandView(s),d=l+2*c,u={data:new e.r({width:d,height:d},o),pixelRatio:2,sdf:!1,usvg:!1,version:0};i.set(t,u)}return i}}const lt={vector:st,raster:at,"raster-dem":class extends at{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=e.h({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,i){e&&(t.state="errored",n(e)),i&&(t.dem=i,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.o(this.map._requestManager.transformRequest(i,e.R.Tile),function(i,s,a,o){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(s){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:o});const n=ImageBitmap&&s instanceof ImageBitmap&&e.t(),i=1-(s.width-e.aL(s.width))/2;i<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?s:e.q.getImageData(s,i),c={uid:t.uid,tileID:t.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,s=0===n.x?t.wrap-1:t.wrap,a=(n.x+1+i)%i,o=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.aM(t.overscaledZ,s,n.z,r,n.y).key]={backfilled:!1},l[new e.aM(t.overscaledZ,o,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(l[new e.aM(t.overscaledZ,s,n.z,r,n.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,o,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.aM(t.overscaledZ,s,n.z,r,n.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,o,n.z,a,n.y+1).key]={backfilled:!1}),l}},"raster-array":ot,geojson:class extends e.E{constructor(t,n,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=e.h({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),void 0!==n.minzoom&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const s=e.aj/this.tileSize;this.workerOptions=e.h({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*s,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*s,extent:e.aj,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.aj,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*s,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const n of t.features)e.set(n.id,n);this._data.features=[...e.values()]}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=e.h({append:t},this.workerOptions);n.scope=this.scope;const i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(e.q.resolveURL(i),e.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(i),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),n,(n,i)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new e.z(n));else{const n={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(n.resourceTiming=i.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.A("data",n)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t),this._updateWorkerData()}loadTile(t,n){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r=this.map.style?this.map.style.getLut(this.scope):null,s=r?{image:r.image.clone()}:null,a=this._partialReload,o={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:s,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:a,worldview:this.map.getWorldview()};t.request=this.actor.send(i,o,(e,r)=>a&&!r?(t.state="loaded",n(null)):(delete t.request,t.destroy(),t.aborted?n(null):e?n(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===i),n(null))),void 0,"loadTile"===i)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aP{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,e.R.Source).url);e.aQ(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new e.z(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.z(new e.V("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aP,model:class extends e.E{constructor(e,t,n,i){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const n in this._options.models){const i=this._options.models[n],r=e.aS(this.map._requestManager.transformRequest(i.uri,e.R.Model).url).then(t=>{if(!t)return;const r=e.aT(t),s=new e.aU(n,i.position,i.orientation,r);s.computeBoundsAndApplyParent(),this.models.push(s)}).catch(t=>{this.fire(new e.z(new Error("Could not load model ".concat(n," from ").concat(i.uri,": ").concat(t.message))))});t.push(r)}Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new e.z(new Error("Could not load models: ".concat(t.message))))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return this._options}},"batched-model":class extends e.E{constructor(e,t,n,i){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=nt(this._options,this.map._requestManager,n,i,(r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?(n&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(n)),i&&2!==i.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(i)),this.fire(new e.z(r))):s&&(e.h(this,s),s.bounds&&(this.tileBounds=new rt(s.bounds,this.minzoom,this.maxzoom)),P(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.q.devicePixelRatio,promoteId:this.promoteId};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=n;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,s.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,s.bind(this),void 0,!0);function s(e,i){return t.aborted?n(null):e&&404!==e.status?n(e):(this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadModelData(i,this.map.painter),t.state="loaded",void n(null))}}serialize(){return e.h({},this._options)}},canvas:class extends e.aP{constructor(t,n,i,r){super(t,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new e.z(new e.V("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.z(new e.V("sources.".concat(t),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.z(new e.V("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new e.z(new e.V("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.z(new e.V("sources.".concat(t),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,n,i,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=n,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.z(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new e.z(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new rt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),e.h(this,e.aF(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:i}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:n,y:i,z:r}=e.tileID.canonical,s=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:r},{signal:s.signal})).then(function(n){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===n?(e.state="errored",t(null)):null===n?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(n)?(this.loadTileData(e,n),e.state="loaded",void t(null)):(e.state="errored",t(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch(n=>{"AbortError"!==n.name&&(e.state="errored",t(n))}),e.request.cancel=()=>s.abort()}loadTileData(e,t){e.setTexture(t,this.map.painter)}unloadTile(t,n){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:n,z:i}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:n,z:i})}n&&n()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t)}_update(){this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}}},ct=function(t,n,i,r){const s=new lt[n.type](t,n,i,r);if(s.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(s.id));return e.aV(["load","abort","unload","serialize","prepare"],s),s};function dt(e,t){return"".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",":").concat(t.id||"",":").concat(t.layer.id,":").concat(function(e){if("layerId"in e)return"layer:".concat(e.layerId);{const{featuresetId:t,importId:n}=e;return"featureset:".concat(t).concat(n?":import:".concat(n):"")}}(e.target))}function ut(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(e.uniqueFeatureID){const r=dt(e,t,i);if(n.has(r))return!0;n.add(r)}return!1}function ht(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=t.sourceCache.transform,a=t.sourceCache.tilesIn(e,t.has3DLayers,r);a.sort(ft);const o=[];for(const l of a){const e=l.tile.queryRenderedFeatures(t,l,n,i,s,r);Object.keys(e).length&&o.push({wrappedTileID:l.tile.tileID.wrapped().key,queryResults:e})}return 0===o.length?{}:function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,s=n[r]=n[r]||{};for(const n in e){const i=e[n],r=s[n]=s[n]||{},a=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,a.push(e))}}return t}(o)}function pt(e,t,n,i,r,s){const a={},o=i.queryRenderedSymbols(e),l=[];for(const c of Object.keys(o).map(Number))l.push(r[c]);l.sort(ft);for(const c of l){const e=c.featureIndex.lookupSymbolFeatures(o[c.bucketInstanceId],c.bucketIndex,c.sourceLayerIndex,t,n,s);for(const t in e){const n=a[t]=a[t]||[],i=e[t];i.sort((e,t)=>{const n=c.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex});for(const e of i)n.push(e)}}return a}function mt(e,t){const n=e.getRenderableIds().map(t=>e.getTileByID(t)),i=[],r={};for(let s=0;s<n.length;s++){const e=n[s],a=e.tileID.canonical.key;r[a]||(r[a]=!0,e.querySourceFeatures(i,t))}return i}function ft(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function gt(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)n[t.fqid]=i}}return n}const xt=32,yt=33,vt=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,n=0,r=0,s=0,a=0,o=0;for(1&e?r=s=a=xt:t=n=o=xt;(e>>=1)>1;){const i=t+r>>1,l=n+s>>1;1&e?(r=t,s=n,t=a,n=o):(t=r,n=s,r=a,s=o),a=i,o=l}const l=4*i;vt[l+0]=t,vt[l+1]=n,vt[l+2]=r,vt[l+3]=s}const _t=new Uint16Array(2178),bt=new Uint8Array(1089),wt=new Uint16Array(1089);function jt(e){return 0===e?-.03125:32===e?.03125:0}const Nt={type:2,extent:e.aj,loadGeometry:()=>[[new e.P(0,0),new e.P(e.aj+1,0),new e.P(e.aj+1,e.aj+1),new e.P(0,e.aj+1),new e.P(0,0)]]};class St{constructor(t,n,i,r,s,a){this.tileID=t,this.uid=e.a$(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection),this.worldview=a}registerFadeDuration(t){const n=t+this.timeAdded;n<e.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=gt(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.b1){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.b1&&n.hasRTLText){this.hasRTLText=!0,e.b2();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],i=n.style.getOwnLayer(e);if(!i)continue;const r=i.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,r)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.b0}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(e,t,n){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,gt(e.buckets,t.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex))}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const n=this.buckets[e];n.uploadPending()&&n.upload(t)}const n=t.gl,i=this.imageAtlas;i&&!i.uploaded&&(this.imageAtlasTexture=new e.T(t,i.image,n.RGBA8,{useMipmap:!!i.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,n){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,n),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=t.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this.updateBuckets(t,this._lastUpdatedBrightness!==i),this._lastUpdatedBrightness=i))}queryRenderedFeatures(t,n,i,r,s,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const o=function(t,n){const i=e.bn([],[.5*t.width,.5*-t.height,1]);return e.bo(i,i,[1,-1,0]),e.az(i,i,t.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(i)}(s,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:o,transform:r,availableImages:i,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),s=n?n.sourceLayer:"",a=r._geojsonTileLayer||r[s];if(!a)return;const o=e.b3(n&&n.filter),{z:l,x:c,y:d}=this.tileID.canonical,u={z:l,x:c,y:d};for(let h=0;h<a.length;h++){const n=a.feature(h);if(o.needGeometry){const t=e.b4(n,!0);if(!o.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),t,this.tileID.canonical))continue}else if(!o.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),n))continue;const r=i.getId(n,s),p=new e.b5(n,l,c,d,r);p.tile=u,t.push(p)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const n=e.b6(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{const i=this.expirationTime-n;i?this.expirationTime=e+Math.max(i,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e)}updateBuckets(t,n){if(!this.latestFeatureIndex)return;if(!t.style)return;const i=this.latestFeatureIndex.loadVTLayers(),r=t.style.listImages(),s=t.style.getBrightness();for(const a in this.buckets){if(!t.style.hasLayer(a))continue;const o=this.buckets[a],l=o.layers[0],c=l.sourceLayer||"_geojsonTileLayer",d=i[c],u=t.style.getLayerSourceCache(l);let h={};u&&(h=u._state.getState(c,void 0));const p=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},m=Object.keys(h).length>0&&!n;m&&!o.stateDependentLayers.length&&!n||o.update(h,d,r,p,m?o.stateDependentLayers:o.layers,n,s),(o instanceof e.b7||o instanceof e.b8)&&t._terrain&&t._terrain.enabled&&u&&o.uploadPending()&&t._terrain._clearRenderCacheForTile(u.id,this.tileID);const f=t&&t.style&&t.style.getOwnLayer(a);f&&(this.queryPadding=Math.max(this.queryPadding,f.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.q.now()+t}setTexture(t,n){const i=n.context,r=i.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t):(this.texture=new e.T(i,t,r.RGBA8,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const i=e.b9(Nt,this.tileID.canonical,this.tileTransform)[0],r=new e.ba,s=new e.bb;for(let e=0;e<i.length;e++){const{x:t,y:n}=i[e];r.emplaceBack(t,n),s.emplaceBack(e)}s.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(s),this._tileDebugBuffer=t.createVertexBuffer(r,e.bc.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,r.length,s.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const i=e.b9(Nt,this.tileID.canonical,this.tileTransform)[0];let r,s;if(this.isRaster){const t=function(t,n){const i=e.aW(t,n),r=Math.pow(2,t.z);for(let d=0;d<yt;d++)for(let s=0;s<yt;s++){const a=e.aX((t.x+(s+jt(s))/xt)/r),o=e.aY((t.y+(d+jt(d))/xt)/r),l=n.project(a,o),c=d*yt+s;_t[2*c+0]=Math.round((l.x*i.scale-i.x)*e.aj),_t[2*c+1]=Math.round((l.y*i.scale-i.y)*e.aj)}bt.fill(0),wt.fill(0);for(let e=2045;e>=0;e--){const t=4*e,n=vt[t+0],i=vt[t+1],r=vt[t+2],s=vt[t+3],a=n+r>>1,o=i+s>>1,l=a+o-i,c=o+n-a,d=i*yt+n,u=s*yt+r,h=o*yt+a,p=Math.hypot((_t[2*d+0]+_t[2*u+0])/2-_t[2*h+0],(_t[2*d+1]+_t[2*u+1])/2-_t[2*h+1])>=16;bt[h]=bt[h]||(p?1:0),e<1022&&(bt[h]=bt[h]||bt[(i+c>>1)*yt+(n+l>>1)]||bt[(s+c>>1)*yt+(r+l>>1)])}const s=new e.aZ,a=new e.a_;let o=0;function l(t,n){const i=n*yt+t;return 0===wt[i]&&(s.emplaceBack(_t[2*i+0],_t[2*i+1],t*e.aj/xt,n*e.aj/xt),wt[i]=++o),wt[i]-1}function c(e,t,n,i,r,s){const o=e+n>>1,d=t+i>>1;if(Math.abs(e-r)+Math.abs(t-s)>1&&bt[d*yt+o])c(r,s,e,t,o,d),c(n,i,r,s,o,d);else{const o=l(e,t),c=l(n,i),d=l(r,s);a.emplaceBack(o,c,d)}}return c(0,0,xt,xt,xt,0),c(xt,xt,0,0,0,xt),{vertices:s,indices:a}}(this.tileID.canonical,n);r=t.vertices,s=t.indices}else{r=new e.aZ,s=new e.a_;for(const{x:e,y:n}of i)r.emplaceBack(e,n,0,0);const t=e.be(r.int16.subarray(0,4*r.length),void 0,4);for(let e=0;e<t.length;e+=3)s.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(r,e.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(s),this._tileBoundsSegments=e.bd.simpleSegment(0,0,r.length,s.length)}_makeGlobeTileDebugBuffers(t,n){const i=n.projection;if(!i||"globe"!==i.name||n.freezeTileCoverage)return;const r=this.tileID.canonical,s=e.bg(r,n),a=e.bh(s),o=e.ah(n.zoom);let l;o>0&&(l=e.bi(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,n,a,l,o),this._makeGlobeTileDebugTextBuffer(t,r,n,a,l,o)}_globePoint(t,n,i,r,s,a,o){let l=e.bj(t,n,i);if(a){const s=1<<i.z,c=e.aD(r.center.lng),d=e.aH(r.center.lat),u=(i.x+.5)/s-c;let h=0;u>.5?h=-1:u<-.5&&(h=1);let p=(t/e.aj+i.x)/s+h,m=(n/e.aj+i.y)/s;p=(p-c)*r._pixelsPerMercatorPixel+c,m=(m-d)*r._pixelsPerMercatorPixel+d;const f=[p*r.worldSize,m*r.worldSize,0];e.ad(f,f,a),l=e.bk(l,f,o)}return e.ad(l,l,s)}_makeGlobeTileDebugBorderBuffer(t,n,i,r,s,a){const o=new e.ba,l=new e.bb,c=new e.bl,d=(e,t,d,u,h)=>{const p=(d-e)/(h-1),m=(u-t)/(h-1),f=o.length;for(let g=0;g<h;g++){const d=e+g*p,u=t+g*m;o.emplaceBack(d,u);const h=this._globePoint(d,u,n,i,r,s,a);c.emplaceBack(h[0],h[1],h[2]),l.emplaceBack(f+g)}},u=e.aj;d(0,0,u,0,16),d(u,0,u,u,16),d(u,u,0,u,16),d(0,u,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(o,e.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.bm.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,o.length,l.length)}_makeGlobeTileDebugTextBuffer(t,n,i,r,s,a){const o=e.aj/4,l=new e.ba,c=new e.a_,d=new e.bl,u=25;c.reserve(32),l.reserve(u),d.reserve(u);const h=(e,t)=>u*e+t;for(let e=0;e<u;e++){const t=e*o;for(let e=0;e<u;e++){const c=e*o;l.emplaceBack(c,t);const u=this._globePoint(c,t,n,i,r,s,a);d.emplaceBack(u[0],u[1],u[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const n=h(e,t),i=h(e,t+1),r=h(e+1,t),s=h(e+1,t+1);c.emplaceBack(n,i,r),c.emplaceBack(r,i,s)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(d,e.bm.members),this._tileDebugTextSegments=e.bd.simpleSegment(0,0,u,32)}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}e.bp.setPbf(e.bq);class kt extends St{constructor(e,t,n,i,r){super(e,t,n,i,r),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexturePerLayer(t,n,i){const r=i.context,s=r.gl;let a=this.texturePerLayer.get(t)||i.getTileTexture(n.width);a&&a instanceof e.T?a.update(n,{premultiply:!1}):a=new e.T(r,n,s.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,a)}flushQueues(e){const t=this._workQueuePerLayer.get(e)||[],n=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();for(;n.length;)n.pop()()}flushAllQueues(){for(const e of this._workQueuePerLayer.keys()){const t=this._workQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}for(const e of this._fetchQueuePerLayer.keys()){const t=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}}fetchHeader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,n=arguments.length>1?arguments[1]:void 0;const i=this._mrt=new e.bp(30),r=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.br(r,(e,r,s,a)=>{if(e)n(e);else try{const e=i.getHeaderLength(r);if(e>t)return void(this.request=this.fetchHeader(e,n));i.parseHeader(r),this._isHeaderLoaded=!0;let o=0;for(const t of Object.values(i.layers))o=Math.max(o,t.dataIndex[t.dataIndex.length-1].lastByte);r.byteLength>=o&&(this.entireBuffer=r),n(null,this.entireBuffer||r,s,a)}catch(e){n(e)}}),this.request}fetchBand(t,n,i,r){const s=this._mrt;if(!this._isHeaderLoaded||!s)return void r(new Error("Tile header is not ready"));const a=this.actor;if(!a)return void r(new Error("Can't fetch tile band without an actor"));let o;const l=(e,s)=>{if(o.complete(e,s),e)return void r(e);this.updateTextureDescriptor(t,n,i);const a=this.textureDescriptorPerLayer.get(n);r(null,a&&a.img)},c=(e,t)=>{if(e)return r(e);const i=a.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:t,task:o},l,void 0,!0),s=this._workQueuePerLayer.get(n)||[];s.push(()=>{i&&i.cancel(),o.cancel()}),this._workQueuePerLayer.has(n)||this._workQueuePerLayer.set(n,s)},d=s.getLayer(t);if(!d)return void r(new Error('Unknown sourceLayer "'.concat(t,'"')));if(d.hasDataForBand(i)){this.updateTextureDescriptor(t,n,i);const e=this.textureDescriptorPerLayer.get(n);return void r(null,e?e.img:null)}const u=d.getDataRange([i]);if(o=s.createDecodingTask(u),!o||o.tasks.length)if(this.flushQueues(n),this.entireBuffer)c(null,this.entireBuffer.slice(u.firstByte,u.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:"bytes=".concat(u.firstByte,"-").concat(u.lastByte)}}),i=e.br(t,c),r=this._fetchQueuePerLayer.get(n)||[];r.push(()=>{i.cancel(),o.cancel()}),this._fetchQueuePerLayer.has(n)||this._fetchQueuePerLayer.set(n,r)}else r(null)}updateNeeded(e,t){return(!this.textureDescriptorPerLayer.get(e)||this.textureDescriptorPerLayer.get(e).band!==t)&&"errored"!==this.state}updateTextureDescriptor(t,n,i){if(!this._mrt)return;const r=this._mrt.getLayer(t);if(!r||!r.hasBand(i)||!r.hasDataForBand(i))return;const{bytes:s,tileSize:a,buffer:o,offset:l,scale:c}=r.getBandView(i),d=a+2*o,u=new e.r({width:d,height:d},s),h=this.texturePerLayer.get(n);h&&h instanceof e.T&&h.update(u,{premultiply:!1}),this.textureDescriptorPerLayer.set(n,{layer:t,band:i,img:u,buffer:o,offset:l,tileSize:a,format:r.pixelFormat,mix:[c,256*c,65536*c,16777216*c]})}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(super.destroy(t),delete this._mrt,!t)for(const n of this.texturePerLayer.values())n&&n instanceof e.T&&n.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Tt{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout(()=>{this.remove(e,r)},n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class Ct{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,i){const r=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.h(this.stateChanges[t][r],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])i[e]||(this.deletedStates[t][r][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(t,n){const i=this.state[t]||{},r=this.stateChanges[t]||{},s=this.deletedStates[t];if(null===s)return{};if(void 0!==n){const t=String(n),a=e.h({},i[t],r[t]);if(s){const e=s[n];if(null===e)return{};for(const t in e)delete a[t]}return a}const a=e.h({},i,r);if(s)for(const e in s)delete a[e];return a}initializeTileState(e,t){e.refreshFeatureState(t)}coalesceChanges(t,n){const i={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const t={};for(const n in this.stateChanges[r])this.state[r][n]||(this.state[r][n]={}),e.h(this.state[r][n],this.stateChanges[r][n]),t[n]=this.state[r][n];i[r]=t}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const t={};if(null===this.deletedStates[r])for(const e in this.state[r])t[e]={},this.state[r][e]={};else for(const e in this.deletedStates[r]){if(null===this.deletedStates[r][e])this.state[r][e]={};else if(this.state[r][e])for(const t of Object.keys(this.deletedStates[r][e]))delete this.state[r][e][t];t[e]=this.state[r][e]}i[r]=i[r]||{},e.h(i[r],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const e in t)t[e].refreshFeatureState(n)}}class Et extends e.E{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Tt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ct,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles)if(!this._tiles[e].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(At).map(e=>e.key)}getRenderableIds(t,n){const i=[];for(const e in this._tiles)this._isIdRenderable(+e,t,n)&&i.push(this._tiles[e]);return t?i.sort((t,n)=>{const i=t.tileID,r=n.tileID,s=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),a=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||a.y-s.y||a.x-s.x}).map(e=>e.tileID.key):i.map(e=>e.tileID).sort(At).map(e=>e.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(n||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(t,n,i,r){if(r)if(t.state="errored",404!==r.status)this._source.fire(new e.z(r,{tile:t}));else{if(this._source.fire(new e.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.q.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),s=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[s]&&(e.neighboringTiles[s].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let s=this._tiles[r];if(i[r]||!s.hasData()||s.tileID.overscaledZ<=t||s.tileID.overscaledZ>n)continue;let a=s.tileID;for(;s&&s.tileID.overscaledZ>t+1;){const e=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[e.key],s&&s.hasData()&&(a=e)}let o=a;for(;o.overscaledZ>t;)if(o=o.scaledTo(o.overscaledZ-1),e[o.key]){i[a.key]=a;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),s="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,n,i,r,s){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const a="batched-model"===this._source.type;let o,l=this._source.maxzoom;const c=this.map&&this.map.painter?this.map.painter._terrain:null;if(c&&c.sourceCache===this&&c.attenuationRange()){const e=c.attenuationRange()[0],t=Math.floor(e)-Math.log2(c.getDemUpscale());l>t&&(l=t)}if(this.used||this.usedForTerrain){if(this._source.tileID)o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.aM(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y));else if(0!==this.tileCoverLift){const r=t.clone();r.tileCoverLift=this.tileCoverLift,o=r.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:a}),this._source.minzoom<=1&&"globe"===t.projection.name&&(o.push(new e.aM(1,0,1,0,0)),o.push(new e.aM(1,0,1,1,0)),o.push(new e.aM(1,0,1,0,1)),o.push(new e.aM(1,0,1,1,1)))}else if(o=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:a}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);o=o.filter(t=>e(t))}}else o=[];if(o.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Mt(this._source.type)){const e=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),l=Math.min(e,this._source.maxzoom);if(a){const e=t.extendTileCover(o,l);for(const t of e)o.push(t)}else if(s){const e=t.extendTileCoverToNearPlane(o,this.transform.getFrustum(l),l);for(const t of e)o.push(t)}else if(this.castsShadows&&r){const e=t.extendTileCover(o,l,r);for(const t of e)this._shadowCasterTiles[t.key]=!0,o.push(t)}}const d=this._updateRetainedTiles(o);if(Mt(this._source.type)&&0!==o.length){const t={},n={},i=Object.keys(d);for(const s of i){const i=d[s],r=this._tiles[s];if(!r||r.fadeEndTime&&r.fadeEndTime<=e.q.now())continue;const a=this.findLoadedParent(i,Math.max(i.overscaledZ-Et.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),n[s]=i}const r=o[o.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(d[e]||!t.hasData())continue;let i=t.tileID;for(;i.overscaledZ>r;){i=i.scaledTo(i.overscaledZ-1);const r=this._tiles[i.key];if(r&&r.hasData()&&n[i.key]){d[e]=t.tileID;break}}}for(const e in t)d[e]||(this._coveredTiles[e]=!0,d[e]=t[e])}for(const e in d)this._tiles[e].clearFadeHold();const u=e.bs(this._tiles,d);for(const e of u){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),r=e[0].overscaledZ,s=Math.max(r-Et.maxOverzooming,this._source.minzoom),a=Math.max(r+Et.maxUnderzooming,this._source.minzoom),o={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||i<this._source.maxzoom&&(o[l.key]=l)}this._retainLoadedChildren(o,i,a,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let r=l.overscaledZ-1;r>=s;--r){const s=l.scaledTo(r);if(n[s.key])break;if(n[s.key]=!0,e=this.getTile(s),!e&&i&&(e=this._addTile(s)),e&&(t[s.key]=s,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(t){let n=this._tiles[t.key];if(n)return!0!==n.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const i=Boolean(n);if(!i){const e=this.map?this.map.painter:null,i=this._source.tileSize*t.overscaleFactor();n="raster-array"===this._source.type?new kt(t,i,this.transform.tileZoom,e,this._isRaster):new St(t,i,this.transform.tileZoom,e,this._isRaster,this._source.worldview),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n.uses++,this._tiles[t.key]=n,i||this._source.fire(new e.A("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,i){const r=[],s=this.transform;if(!s)return r;const a="globe"===s.projection.name,o=e.aD(s.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(i&&c.clearQueryDebugViz(),c.holdingForFade())continue;let d;if(a){const t=c.tileID.canonical;if(0===t.z){const n=[Math.abs(e.ay(o,...Dt(t,-1))-o),Math.abs(e.ay(o,...Dt(t,1))-o)];d=[0,2*n.indexOf(Math.min(...n))-1]}else{const n=[Math.abs(e.ay(o,...Dt(t,-1))-o),Math.abs(e.ay(o,...Dt(t,0))-o),Math.abs(e.ay(o,...Dt(t,1))-o)];d=[n.indexOf(Math.min(...n))-1]}}else d=[0];for(const e of d){const i=t.containsTile(c,s,n,e);i&&r.push(i)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const n=this.getRenderableIds(e,t).map(e=>this._tiles[e].tileID),i="globe"===this.transform.projection.name;for(const r of n)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped()),r.expandedProjMatrix=i?this.transform.calculateProjMatrix(r.toUnwrapped(),!1,!0):r.projMatrix;return n}sortCoordinatesByDistance(e){const t=e.slice(),n=this.transform._camera.position,i=this.transform._camera.forward(),r={};for(const s of t){const e=1/(1<<s.canonical.z);r[s.key]=((s.canonical.x+.5)*e+s.wrap-n[0])*i[0]+((s.canonical.y+.5)*e-n[1])*i[1]-n[2]*i[2]}return t.sort((e,t)=>r[e.key]-r[t.key]),t}hasTransition(){if(this._source.hasTransition())return!0;if(Mt(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=e.q.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(t,n){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,n))};return void this._source.on("data",e)}const i=new Map,r=Array.isArray(t)?t:[t],s=this.map.painter.terrain,a=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const e of r){const t=e.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)i.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const o=Array.from(i.values());e.bt(o,(e,t)=>{const n=new St(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(n,e=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),t(e,n)})},n)}}function At(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Mt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Dt(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}Et.maxOverzooming=10,Et.maxUnderzooming=3;class It{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const n in this.style._mergedLayers){const i=this.style._mergedLayers[n];if("fill-extrusion"===i.type||"building"===i.type)this.layers.push({layer:i,visible:e,visibilityChanged:t});else if("model"===i.type){const n=this.style.getLayerSource(i);n&&"batched-model"===n.type&&this.layers.push({layer:i,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const n=t.layer;let i=!1;"fill-extrusion"===n.type?i=!n.isHidden(e)&&n.paint.get("fill-extrusion-opacity")>0:"building"===n.type?i=!n.isHidden(e)&&n.paint.get("building-opacity")>0:"model"===n.type&&(i=!n.isHidden(e)&&n.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!i&&t.visible,t.visible=i}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const i of this.layers){const e=i.layer,n=this.style.getLayerSourceCache(e);let r=1;"fill-extrusion"===e.type?r=i.visible?e.paint.get("fill-extrusion-vertical-scale"):0:"building"===e.type&&(r=i.visible?e.paint.get("building-vertical-scale"):0);let s=n?n.getTile(t):null;if(!s&&n)for(const i in n._tiles){const e=n._tiles[i];if(t.canonical.isChildOf(e.tileID.canonical)){s=e;break}}this.currentBuildingBuckets.push({bucket:s?s.getBucket(e):null,tileID:s?s.tileID:t,verticalScale:r})}e.hasAnyZOffset=!1;let n=!1;for(let i=0;i<e.symbolInstances.length;i++){const r=e.symbolInstances.get(i),s=r.zOffset,a=this._getHeightAtTileOffset(t,r.tileAnchorX,r.tileAnchorY);r.zOffset=a!==Number.NEGATIVE_INFINITY?a:s,n||s===r.zOffset||(n=!0),e.hasAnyZOffset||0===r.zOffset||(e.hasAnyZOffset=!0)}n&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,i,r){let s=n,a=i;if(t.canonical.z!==r.canonical.z){const o=r.canonical,l=1/(1<<t.canonical.z-o.z);s=(n+t.canonical.x*e.aj)*l-o.x*e.aj|0,a=(i+t.canonical.y*e.aj)*l-o.y*e.aj|0}return{tileX:s,tileY:a}}_getHeightAtTileOffset(e,t,n){let i,r;for(let s=0;s<this.layers.length;++s){const a=this.layers[s].layer;if("fill-extrusion"!==a.type&&"building"!==a.type)continue;const{bucket:o,tileID:l,verticalScale:c}=this.currentBuildingBuckets[s];if(!o)continue;const{tileX:d,tileY:u}=this._mapCoordToOverlappingTile(e,t,n,l),h=o.getHeightAtTileCoord(d,u);h&&void 0!==h.height&&(h.hidden?i=h.height:r=Math.max(h.height*c,r||0))}if(void 0!==r)return r;for(let s=0;s<this.layers.length;++s){const r=this.layers[s];if("model"!==r.layer.type||!r.visible)continue;const{bucket:a,tileID:o}=this.currentBuildingBuckets[s];if(!a)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,n,o),d=a.getHeightAtTileCoord(l,c);if(d&&!d.hidden)return void 0===d.height&&void 0!==i?Math.min(d.maxHeight,i)*d.verticalScale:d.height?d.height*d.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Pt(t,n){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return e.bu.forEach(e=>{e in n&&(i[e]=n[e])}),i}function Rt(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=Pt(e[n],t[e[n].ref]));return e}const Lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function zt(e,t,n){n.push({command:Lt.addSource,args:[e,t[e]]})}function Ot(e,t,n){t.push({command:Lt.removeSource,args:[e]}),n[e]=!0}function Ft(e,t,n,i){Ot(e,n,i),zt(e,t,n)}function Bt(t,n,i){let r;for(r in t[i])if(t[i].hasOwnProperty(r)&&"data"!==r&&!e.bv(t[i][r],n[i][r]))return!1;for(r in n[i])if(n[i].hasOwnProperty(r)&&"data"!==r&&!e.bv(t[i][r],n[i][r]))return!1;return!0}function Vt(t,n,i,r,s,a){let o;for(o in n=n||{},t=t||{})t.hasOwnProperty(o)&&(e.bv(t[o],n[o])||i.push({command:a,args:[r,o,n[o],s]}));for(o in n)n.hasOwnProperty(o)&&!t.hasOwnProperty(o)&&(e.bv(t[o],n[o])||i.push({command:a,args:[r,o,n[o],s]}))}function Ut(e){return e.id}function Ht(e,t){return e[t.id]=t,e}function qt(t,n,i){const r=n.createTileMatrix(t,t.worldSize,i.toUnwrapped());return e.az(new Float32Array(16),t.projMatrix,r)}function Wt(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const i=n.clone();return i.setProjection(t.projection),qt(i,t.getProjection(),e)}function Gt(e,t,n){return t.name===n.projection.name?e.projMatrix:qt(n,t,e)}class Yt{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ay(t,0,1);let n=1,i=this._distances[n];const r=t*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const s=n-1,a=this._distances[s],o=i-a,l=o>0?(r-a)/o:0;return this.points[s].mult(1-l).add(this.points[n].mult(l))}}class Zt{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let s=0;s<this.xCellCount*this.yCellCount;s++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,s){this.boxCells[r].push(s)}_insertCircleCell(e,t,n,i,r,s){this.circleCells[r].push(s)}_query(e,t,n,i,r,s){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];const a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}return s?a.filter(s):a}return this._forEachCell(e,t,n,i,this._queryCell,a,{hitTest:r,seenUids:{box:{},circle:{}}},s),r?a.length>0:a}_queryCircle(e,t,n,i,r){const s=e-n,a=e+n,o=t-n,l=t+n;if(a<0||s>this.width||l<0||o>this.height)return!i&&[];const c=[];return this._forEachCell(s,o,a,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}hitTest(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}hitTestCircle(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}_queryCell(e,t,n,i,r,s,a,o){const l=a.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const d of c)if(!l.box[d]){l.box[d]=!0;const c=4*d;if(e<=r[c+2]&&t<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!o||o(this.boxKeys[d]))){if(a.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[d],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const d=this.circleCells[r];if(null!==d){const r=this.circles;for(const c of d)if(!l.circle[c]){l.circle[c]=!0;const d=3*c;if(this._circleAndRectCollide(r[d],r[d+1],r[d+2],e,t,n,i)&&(!o||o(this.circleKeys[c]))){if(a.hitTest)return s.push(!0),!0;{const e=r[d],t=r[d+1],n=r[d+2];s.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,i,r,s,a,o){const l=a.circle,c=a.seenUids,d=this.boxCells[r];if(null!==d){const e=this.bboxes;for(const t of d)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!o||o(this.boxKeys[t])))return s.push(!0),!0}}const u=this.circleCells[r];if(null!==u){const e=this.circles;for(const t of u)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!o||o(this.circleKeys[t])))return s.push(!0),!0}}}_forEachCell(e,t,n,i,r,s,a,o){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),d=this._convertToXCellCoord(n),u=this._convertToYCellCoord(i);for(let h=l;h<=d;h++)for(let l=c;l<=u;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+h,s,a,o))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,s){const a=i-e,o=r-t,l=n+s;return l*l>a*a+o*o}_circleAndRectCollide(e,t,n,i,r,s,a){const o=(s-i)/2,l=Math.abs(e-(i+o));if(l>o+n)return!1;const c=(a-r)/2,d=Math.abs(t-(r+c));if(d>c+n)return!1;if(l<=o||d<=c)return!0;const u=l-o,h=d-c;return u*u+h*h<=n*n}}const Xt={unknown:0,flipRequired:1,flipNotRequired:2},Kt=Math.tan(85*Math.PI/180);function Qt(t,n,i,r,s,a,o){const l=e.bz();if(i)if("globe"===a.name){const t=e.bA(s,n);e.az(l,l,t)}else{const t=e.bB([],o);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.by(l,l,s.angle)}else e.az(l,s.labelPlaneMatrix,t);return l}function Jt(e,t,n,i,r,s,a){const o=Qt(e,t,n,i,r,s,a);return"globe"===s.name&&n||(o[2]=o[6]=o[10]=o[14]=0),o}function $t(t,n,i,r,s,a,o){if(i){if("globe"===a.name){const l=Qt(t,n,i,r,s,a,o);return e.bi(l,l),e.az(l,t,l),l}{const n=e.bw(t),i=e.bx([]);return i[0]=o[0],i[1]=o[1],i[4]=o[2],i[5]=o[3],e.az(n,n,i),r||e.by(n,n,-s.angle),n}}return s.glCoordMatrix}function en(t,n,i,r){const s=[t,n,i,1];i?e.aA(s,s,r):hn(s,s,r);const a=s[3];return s[0]/=a,s[1]/=a,s[2]/=a,s}function tn(e,t){return Math.min(.5+e/t*.5,1.5)}function nn(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function rn(t,n,i,r,s,a,o,l,c,d){const u=i.transform,h=r?t.textSizeData:t.iconSizeData,p=e.bH(h,i.transform.zoom),m="globe"===u.projection.name,f=[256/i.width*2+1,256/i.height*2+1],g=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let x=null;m&&(x=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,v=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,_=i.transform.width/i.transform.height;let b,w=!1;for(let j=0;j<v.length;j++){const r=v.get(j),{numGlyphs:m,writingMode:N}=r;if(N!==e.bI.vertical||w||b===e.bI.horizontal||(w=!0),b=N,(r.hidden||N===e.bI.vertical)&&!w){un(m,g);continue}w=!1;const S=new e.P(r.tileAnchorX,r.tileAnchorY);let{x:k,y:T,z:C}=u.projection.projectTilePoint(S.x,S.y,d.canonical);if(c){const[e,t,n]=c(S);k+=e,T+=t,C+=n}const E=[k,T,C,1];if(e.aA(E,E,n),!nn(E,f)){un(m,g);continue}const A=E[3],M=tn(i.transform.getCameraToCenterDistance(u.projection),A),D=e.bJ(h,p,r),I=o?D/M:D*M,P=en(k,T,C,s);if(P[3]<=0){un(m,g);continue}let R={};const L=e.al(t.layers[0].layout.get("text-max-angle")),z=Math.cos(L),O=o?null:c,F=on(r,I,!1,l,n,s,a,t.glyphOffsetArray,y,g,x,P,S,R,_,O,u.projection,d,o,z);w=F.useVertical,O&&F.needsFlipping&&(R={}),(F.notEnoughRoom||w||F.needsFlipping&&on(r,I,!0,l,n,s,a,t.glyphOffsetArray,y,g,x,P,S,R,_,O,u.projection,d,o,z).notEnoughRoom)&&un(m,g)}r?(t.text.dynamicLayoutVertexBuffer.updateData(g),x&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(x)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),x&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(x))}function sn(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g){const{lineStartIndex:x,glyphStartIndex:y,segment:v}=o,_=y+o.numGlyphs,b=x+o.lineLength,w=t.getoffsetX(y),j=t.getoffsetX(_-1),N=dn(e*w,n,i,r,s,a,v,x,b,l,c,d,u,h,!0,p,m,f,g);if(!N)return null;const S=dn(e*j,n,i,r,s,a,v,x,b,l,c,d,u,h,!0,p,m,f,g);return S?{first:N,last:S}:null}function an(t,n,i,r){return t===e.bI.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:t===e.bI.vertical?r>0?{needsFlipping:!0}:null:n!==Xt.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Kt}(i,r)?n===Xt.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function on(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_){const b=n/24,w=t.lineOffsetX*b,j=t.lineOffsetY*b,{lineStartIndex:N,glyphStartIndex:S,numGlyphs:k,segment:T,writingMode:C,flipState:E}=t,A=N+t.lineLength,M=t=>{if(u){const[n,i,r]=t.up,s=d.length;e.bK(u,s+0,n,i,r),e.bK(u,s+1,n,i,r),e.bK(u,s+2,n,i,r),e.bK(u,s+3,n,i,r)}const[n,i,r]=t.point;e.bL(d,n,i,r,t.angle)};if(k>1){const e=sn(b,l,w,j,i,h,p,t,c,a,m,g,!1,x,y,v,_);if(!e)return{notEnoughRoom:!0};if(r&&!i){let[n,i,r]=e.first.point,[s,a,l]=e.last.point;[n,i]=en(n,i,r,o),[s,a]=en(s,a,l,o);const c=an(C,E,(s-n)*f,a-i);if(t.flipState=c&&c.needsFlipping?Xt.flipRequired:Xt.flipNotRequired,c)return c}M(e.first);for(let t=S+1;t<S+k-1;t++){const e=dn(b*l.getoffsetX(t),w,j,i,h,p,T,N,A,c,a,m,g,!1,!1,x,y,v,_);if(!e)return d.length-=4*(t-S),{notEnoughRoom:!0};M(e)}M(e.last)}else{if(r&&!i){const n=en(p.x,p.y,0,s),i=N+T+1,r=new e.P(c.getx(i),c.gety(i)),a=en(r.x,r.y,0,s),o=a[3]>0?a:cn(p,r,n,1,s,void 0,x,y.canonical),l=an(C,E,(o[0]-n[0])*f,o[1]-n[1]);if(t.flipState=l&&l.needsFlipping?Xt.flipRequired:Xt.flipNotRequired,l)return l}const n=dn(b*l.getoffsetX(S),w,j,i,h,p,T,N,A,c,a,m,g,!1,!1,x,y,v,_);if(!n)return{notEnoughRoom:!0};M(n)}return{}}function ln(e,t,n,i,r){const{x:s,y:a,z:o}=i.projectTilePoint(e.x,e.y,t);if(!r)return en(s,a,o,n);const[l,c,d]=r(e);return en(s+l,a+c,o+d,n)}function cn(t,n,i,r,s,a,o,l){const c=ln(t.sub(n)._unit()._add(t),l,s,o,a);return e.at(c,i,c),e.au(c,c),e.bE(c,i,c,r)}function dn(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v){const _=r?t-n:t+n;let b=_>0?1:-1,w=0;r&&(b*=-1,w=Math.PI),b<0&&(w+=Math.PI);let j=l+o+(b>0?0:1)|0,N=s,S=s,k=0,T=0;const C=Math.abs(_),E=[],A=[];let M=a,D=M,I=e.bC([]);const P=()=>cn(D,M,S,C-k+1,u,p,g,x.canonical);for(;k+T<=C;){if(j+=b,j<l||j>=c)return null;if(S=N,D=M,E.push(S),m&&A.push(D),M=new e.P(d.getx(j),d.gety(j)),N=h[j],!N){const e=ln(M,x.canonical,u,g,p);N=e[3]>0?h[j]=e:P()}k+=T;const t=e.at([],N,S),n=e.bD(S,N);if(i&&n>0&&T>0&&e.bG(I,t)/(T*n)<v)return null;T=n,I=t}f&&p&&(h[j]&&(N=P(),T=e.bD(S,N),I=e.at([],N,S)),h[j]=N);const R=(C-k)/T,L=M.sub(D)._mult(R)._add(D),z=e.bE([],S,I,R);let O=[0,0,1],F=I[0],B=I[1];if(y&&(O=g.upVector(x.canonical,L.x,L.y),0!==O[0]||0!==O[1]||1!==O[2])){const t=[O[2],0,-O[0]],n=e.bF([],O,t);e.au(t,t),e.au(n,n),F=e.bG(I,t),B=e.bG(I,n)}if(i){const t=e.bF([],O,I);e.au(t,t),e.bE(z,z,t,i*b)}const V=w+Math.atan2(B,F);return E.push(z),m&&A.push(L),{point:z,angle:V,path:E,tilePath:A,up:O}}function un(e,t){const n=t.length,i=n+4*e;t.resize(i),t.float32.fill(-1/0,4*n,4*i)}function hn(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const pn=100;class mn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Zt(e.width+200,e.height+200,25),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Zt(e.width+200,e.height+200,25);this.transform=e,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+pn,this.screenBottomBoundary=e.height+pn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(t,n,i,r,s,a,o,l,c,d,u){let h=i.projectedAnchorX,p=i.projectedAnchorY,m=i.projectedAnchorZ;const f=i.tileAnchorX,g=i.tileAnchorY,x=i.elevation,y=i.tileID,v=t.getProjection();if(x&&y){const[e,t,n]=v.upVector(y.canonical,i.tileAnchorX,i.tileAnchorY),r=v.upVectorScale(y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;h+=e*x*r,p+=t*x*r,m+=n*x*r}const _="globe"===t.projection.name,b="globe"===t.projection.name?e.ah(this.transform.zoom):0;if(y&&_&&b<1&&!a){const t=1<<y.canonical.z,n=e.bM(f,g);e.bN(n,n,1/e.aj),e.bO(n,n,e.bM(y.canonical.x,y.canonical.y)),e.bN(n,n,1/t),e.bP(n,n,e.bM(r[0],r[1])),n[0]=e.bQ(n[0],-.5,.5),e.bN(n,n,e.aj);const i=e.bR(n[0],n[1],e.aj/(2*Math.PI),1);e.aA(i,i,s),h=e.ai(h,i[0],b),p=e.ai(p,i[1],b),m=e.ai(m,i[2],b)}const w=this.projectAndGetPerspectiveRatio(d,h,p,m,i.tileID,"globe"===v.name||!!x||this.transform.pitch>0,v),j=c*w.perspectiveRatio,N=(i.x1*n+o.x-i.padding)*j+w.point.x,S=(i.y1*n+o.y-i.padding)*j+w.point.y,k=(i.x2*n+o.x+i.padding)*j+w.point.x,T=(i.y2*n+o.y+i.padding)*j+w.point.y,C=w.perspectiveRatio<=.55||w.occluded;return!this.isInsideGrid(N,S,k,T)||!l&&this.grid.hitTest(N,S,k,T,u)||C?{box:[],offscreen:!1,occluded:w.occluded}:{box:[N,S,k,T],offscreen:this.isOffscreen(N,S,k,T),occluded:!1}}placeCollisionCircles(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f){const g=[],x=this.transform.elevation,y=t.getProjection(),v=x?x.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,y):null,_=new e.P(i.tileAnchorX,i.tileAnchorY);let{x:b,y:w,z:j}=y.projectTilePoint(_.x,_.y,f.canonical);if(v){const[e,t,n]=v(_);b+=e,w+=t,j+=n}const N="globe"===y.name,S=this.projectAndGetPerspectiveRatio(o,b,w,j,f,N||!!x||this.transform.pitch>0,y),{perspectiveRatio:k}=S,T=(u?a/k:a*k)/e.bU,C=en(b,w,j,l),E=i.lineOffsetX*T,A=i.lineOffsetY*T,M=e.al(t.layers[0].layout.get("text-max-angle")),D=Math.cos(M),I=S.signedDistanceFromCamera>0?sn(T,s,E,A,!1,C,_,i,r,l,{},x&&!u?v:null,u&&!!x,y,f,u,D):null;let P=!1,R=!1,L=!0;if(I&&!S.occluded){const t=.5*p*k+m,i=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),s=new Yt,{first:a,last:o}=I,l=a.path.length;let u=[];for(let e=l-1;e>=1;e--)u.push(a.path[e]);for(let e=1;e<o.path.length;e++)u.push(o.path[e]);const f=2.5*t;c&&(u=u.map((e,t)=>{let[n,i,r]=e;return v&&!N&&(r=v(t<l-1?a.tilePath[l-1-t]:o.tilePath[t-l+2])[2]),en(n,i,r,c)}),u.some(e=>e[3]<=0)&&(u=[]));let x=[];if(u.length>0){let t=1/0,n=-1/0,s=1/0,a=-1/0;for(const e of u)t=Math.min(t,e[0]),s=Math.min(s,e[1]),n=Math.max(n,e[0]),a=Math.max(a,e[1]);n>=i.x&&t<=r.x&&a>=i.y&&s<=r.y&&(x=[u.map(t=>new e.P(t[0],t[1]))],(t<i.x||n>r.x||s<i.y||a>r.y)&&(x=e.bS(x,i.x,i.y,r.x,r.y)))}for(const e of x){s.reset(e,.25*t);let i=0;i=s.length<=.5*t?1:Math.ceil(s.paddedLength/f)+1;for(let e=0;e<i;e++){const r=e/Math.max(i-1,1),a=s.lerp(r),o=a.x+pn,l=a.y+pn;g.push(o,l,t,0);const c=o-t,u=l-t,p=o+t,m=l+t;if(L=L&&this.isOffscreen(c,u,p,m),R=R||this.isInsideGrid(c,u,p,m),!n&&this.grid.hitTestCircle(o,l,t,h)&&(P=!0,!d))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!d&&P||!R?[]:g,offscreen:L,collisionDetected:P,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,s=-1/0,a=-1/0;for(const d of t){const t=new e.P(d.x+pn,d.y+pn);i=Math.min(i,t.x),r=Math.min(r,t.y),s=Math.max(s,t.x),a=Math.max(a,t.y),n.push(t)}const o=this.grid.query(i,r,s,a).concat(this.ignoredGrid.query(i,r,s,a)),l={},c={};for(const d of o){const t=d.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const i=[new e.P(d.x1,d.y1),new e.P(d.x2,d.y1),new e.P(d.x2,d.y2),new e.P(d.x1,d.y2)];e.bT(n,i)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r){const s=t?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let o=0;o<e.length;o+=4)s.insertCircle(a,e[o],e[o+1],e[o+2])}projectAndGetPerspectiveRatio(t,n,i,r,s,a,o){const l=[n,i,r,1];let c=!1;if(r||this.transform.pitch>0){if(e.aA(l,l,t),this.fogState&&s&&"globe"!==o.name){const t=function(t,n,i,r,s,a){const o=a.calculateFogTileMatrix(s),l=[n,i,r];return e.ad(l,l,o),Be(t,e.ae(l),a.pitch,a._fov)}(this.fogState,n,i,r,s.toUnwrapped(),this.transform);c=t>.9}}else hn(l,l,t);const d=l[3];return{point:new e.P((l[0]/d+1)/2*this.transform.width+pn,(-l[1]/d+1)/2*this.transform.height+pn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(o)/d*.5,1.5),signedDistanceFromCamera:d,occluded:a&&l[2]>d||c}}isOffscreen(e,t,n,i){return n<pn||e>=this.screenRightBoundary||i<pn||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.bx([]);return e.bo(t,t,[-100,-100,0]),t}}class fn{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class gn{constructor(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new fn(e?e.text:null,t,n,r),this.icon=new fn(e?e.icon:null,t,i,r),this.clipped=s}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=n,this.clipped=i}}class yn{constructor(){this.invProjMatrix=e.bz(),this.viewportMatrix=e.bz(),this.circles=[]}}class vn{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class _n{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function bn(t,n,i,r,s){const{horizontalAlign:a,verticalAlign:o}=e.bZ(t),l=-(a-.5)*n,c=-(o-.5)*i,d=e.b_(t,r);return new e.P(l+d[0]*s,c+d[1]*s)}function wn(t,n,i,r,s){const a=new e.P(t,n);return i&&a._rotate(r?s:-s),a}class jn{constructor(e,t,n,i,r,s){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new mn(this.transform,r),this.buildingIndex=s,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new _n(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const a=i.getBucket(n),o=i.latestFeatureIndex;if(!a||!o||n.fqid!==a.layerIds[0])return;const l=a.layers[0].layout,c=a.layers[0].paint,d=i.collisionBoxArray,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/e.aj,p=i.tileID.toUnwrapped();this.transform.setProjection(a.projection);const m=(f=i.tileID,g=a.getProjection(),x=this.transform,g.name===this.projection?x.calculateProjMatrix(f.toUnwrapped()):qt(x,g,f));var f,g,x;const y="map"===l.get("text-pitch-alignment"),v="map"===l.get("text-rotation-alignment");n.compileFilter(n.options);const _=n.dynamicFilter(),b=n.dynamicFilterNeedsFeature(),w=this.transform.calculatePixelsToTileUnitsMatrix(i),j=Jt(m,i.tileID.canonical,y,v,this.transform,a.getProjection(),w);let N=null;const S=a.getProjection().createInversionMatrix(this.transform,i.tileID.canonical);if(y){const t=$t(m,i.tileID.canonical,y,v,this.transform,a.getProjection(),w);N=e.az([],this.transform.labelPlaneMatrix,t)}let k=null;_&&i.latestFeatureIndex&&(k={unwrappedTileID:p,dynamicFilter:_,dynamicFilterNeedsFeature:b}),this.retainedQueryData[a.bucketInstanceId]=new vn(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,i.tileID);const[T,C]=a.layers[0].layout.get("text-size-scale-range"),E=e.ay(s,T,C),[A,M]=l.get("icon-size-scale-range"),D=e.ay(s,A,M),I={bucket:a,layout:l,paint:c,posMatrix:m,invMatrix:S,mercatorCenter:[e.aD(this.transform.center.lng),e.aH(this.transform.center.lat)],textLabelPlaneMatrix:j,labelToScreenMatrix:N,clippingData:k,scale:u,textPixelRatio:h,holdingForFade:i.holdingForFade(),collisionBoxArray:d,partiallyEvaluatedTextSize:e.bH(a.textSizeData,this.transform.zoom,E),partiallyEvaluatedIconSize:e.bH(a.iconSizeData,this.transform.zoom,D),collisionGroup:this.collisionGroups.get(a.sourceID),latestFeatureIndex:i.latestFeatureIndex};if(r)for(const e of a.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=e;t.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:I})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:I})}attemptAnchorPlacement(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_){const{textOffset0:b,textOffset1:w,crossTileID:j}=m,N=[b,w],S=bn(e,s,a,N,o),k=this.collisionIndex.placeCollisionBox(g,o,t,n,i,r,wn(S.x,S.y,l,c,this.transform.angle),p,d,u,h.predicate);if(y){const e=g.getSymbolInstanceIconSize(_,this.transform.zoom,m.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(g,e,y,n,i,r,wn(S.x,S.y,l,c,this.transform.angle),p,d,u,h.predicate).box.length)return}if(k.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[j]&&this.prevPlacement.placements[j]&&this.prevPlacement.placements[j].text&&(t=this.prevPlacement.variableOffsets[j].anchor),this.variableOffsets[j]={textOffset:N,width:s,height:a,anchor:e,textScale:o,prevAnchor:t},this.markUsedJustification(g,e,m,x),g.allowVerticalPlacement&&(this.markUsedOrientation(g,x,m),this.placedOrientations[j]=x),{shift:S,placedGlyphBoxes:k}}}placeLayerBucketPart(t,n,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{bucket:a,layout:o,paint:l,posMatrix:c,textLabelPlaneMatrix:d,labelToScreenMatrix:u,clippingData:h,textPixelRatio:p,mercatorCenter:m,invMatrix:f,holdingForFade:g,collisionBoxArray:x,partiallyEvaluatedTextSize:y,partiallyEvaluatedIconSize:v,collisionGroup:_,latestFeatureIndex:b}=t.parameters,w=o.get("text-optional"),j=o.get("icon-optional"),N=o.get("text-allow-overlap"),S=o.get("icon-allow-overlap"),k="map"===o.get("text-rotation-alignment"),T="map"===o.get("icon-rotation-alignment"),C="map"===o.get("text-pitch-alignment"),E=l.get("symbol-z-offset"),A="sea"===o.get("symbol-elevation-reference"),M=o.get("symbol-placement"),[D,I]=o.get("text-size-scale-range"),[P,R]=o.get("icon-size-scale-range"),L=e.ay(s,D,I),z=e.ay(s,P,R),O=o.get("text-variable-anchor"),F=k&&"point"!==M,B=T&&"point"!==M,V=O&&a.hasTextData(),U=a.hasIconTextFit()&&V&&a.hasIconData();this.transform.setProjection(a.projection);const H=V||F,q=B||U;let W=N&&(S||!a.hasIconData()||j),G=S&&(N||!a.hasTextData()||w);const Y=!E.isConstant();!a.collisionArrays&&x&&a.deserializeCollisionBoxes(x),i&&r&&a.updateCollisionDebugBuffers(this.transform.zoom,x,L,z);const Z=(t,r,l)=>{const{crossTileID:x,numVerticalGlyphVertices:T}=t;let M=null;if(h&&h.dynamicFilterNeedsFeature||Y){const e=this.retainedQueryData[a.bucketInstanceId];M=b.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(h&&!(0,h.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},M,this.retainedQueryData[a.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(h.unwrappedTileID)))return this.placements[x]=new xn(!1,!1,!1,!0),void n.add(x);const D=E.evaluate(M,{});if(n.has(x))return;if(g)return void(this.placements[x]=new xn(!1,!1,!1));let I=!1,P=!1,R=!0,L=!1,z=!1,F=null,B={box:null,offscreen:null,occluded:null},V={box:null},U=null,Z=null,X=null,K=0,Q=0,J=0;l.textFeatureIndex?K=l.textFeatureIndex:t.useRuntimeCollisionCircles&&(K=t.featureIndex),l.verticalTextFeatureIndex&&(Q=l.verticalTextFeatureIndex);const $=e=>{e.tileID=this.retainedQueryData[a.bucketInstanceId].tileID;const n=this.transform.elevation;e.elevation=A?D:D+(n?n.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0),e.elevation+=t.zOffset},ee=l.textBox;if(ee){$(ee);const n=n=>{let i=e.bI.horizontal;if(a.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[x];e&&(this.placedOrientations[x]=e,i=e,this.markUsedOrientation(a,i,t))}return i},i=(t,n)=>{if(a.allowVerticalPlacement&&T>0&&l.verticalTextBox){for(const i of a.writingModes)if(i===e.bI.vertical?(B=n(),V=B):B=t(),B&&B.box&&B.box.length)break}else B=t()};if(O){let s=O;if(this.prevPlacement&&this.prevPlacement.variableOffsets[x]){const e=this.prevPlacement.variableOffsets[x];s.indexOf(e.anchor)>0&&(s=s.filter(t=>t!==e.anchor),s.unshift(e.anchor))}const o=(e,n,i)=>{const o=a.getSymbolInstanceTextSize(y,t,this.transform.zoom,r),l=(e.x2-e.x1)*o+2*e.padding,d=(e.y2-e.y1)*o+2*e.padding,u=t.hasIconTextFit&&!S?n:null;u&&$(u);let h={box:[],offscreen:!1,occluded:!1};const g=N?2*s.length:s.length;for(let x=0;x<g;++x){const n=this.attemptAnchorPlacement(s[x%s.length],e,m,f,H,l,d,o,k,C,p,c,_,x>=s.length,t,r,a,i,u,y,v);if(n&&(h=n.placedGlyphBoxes,h&&h.box&&h.box.length)){I=!0,F=n.shift;break}}return h};i(()=>o(ee,l.iconBox,e.bI.horizontal),()=>{const t=l.verticalTextBox;return t&&$(t),a.allowVerticalPlacement&&!(B&&B.box&&B.box.length)&&T>0&&t?o(t,l.verticalIconBox,e.bI.vertical):{box:null,offscreen:null,occluded:null}}),B&&(I=B.box,R=B.offscreen,L=B.occluded);const d=n(!(!B||!B.box));if(!I&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[x];e&&(this.variableOffsets[x]=e,this.markUsedJustification(a,e.anchor,t,d))}}else{const o=(n,i)=>{const o=a.getSymbolInstanceTextSize(y,t,this.transform.zoom,r,s),l=this.collisionIndex.placeCollisionBox(a,o,n,m,f,H,new e.P(0,0),N,p,c,_.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(a,i,t),this.placedOrientations[x]=i),l};i(()=>o(ee,e.bI.horizontal),()=>{const t=l.verticalTextBox;return a.allowVerticalPlacement&&T>0&&t?($(t),o(t,e.bI.vertical)):{box:null,offscreen:null,occluded:null}}),n(!!(B&&B.box&&B.box.length))}}if(U=B,I=U&&U.box&&U.box.length>0,R=U&&U.offscreen,L=U&&U.occluded,t.useRuntimeCollisionCircles){const n=a.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.bJ(a.textSizeData,y,n),s=o.get("text-padding");Z=this.collisionIndex.placeCollisionCircles(a,N,n,a.lineVertexArray,a.glyphOffsetArray,r,c,d,u,i,C,_.predicate,t.collisionCircleDiameter*r/e.bU,s,this.retainedQueryData[a.bucketInstanceId].tileID),I=N||Z.circles.length>0&&!Z.collisionDetected,R=R&&Z.offscreen,L=Z.occluded}if(l.iconFeatureIndex&&(J=l.iconFeatureIndex),l.iconBox){const n=n=>{$(n);const i=t.hasIconTextFit&&F?wn(F.x,F.y,k,C,this.transform.angle):new e.P(0,0),r=a.getSymbolInstanceIconSize(v,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(a,r,n,m,f,q,i,S,p,c,_.predicate)};V&&V.box&&V.box.length&&l.verticalIconBox?(X=n(l.verticalIconBox),P=X.box.length>0):(X=n(l.iconBox),P=X.box.length>0),R=R&&X.offscreen,z=X.occluded}const te=w||0===t.numHorizontalGlyphVertices&&0===T,ne=j||0===t.numIconVertices;if(te||ne?ne?te||(P=P&&I):I=P&&I:P=I=P&&I,I&&U&&U.box&&this.collisionIndex.insertCollisionBox(U.box,o.get("text-ignore-placement"),a.bucketInstanceId,V&&V.box&&Q?Q:K,_.ID),P&&X&&this.collisionIndex.insertCollisionBox(X.box,o.get("icon-ignore-placement"),a.bucketInstanceId,J,_.ID),Z&&(I&&this.collisionIndex.insertCollisionCircles(Z.circles,o.get("text-ignore-placement"),a.bucketInstanceId,K,_.ID),i)){const e=a.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new yn);for(let n=0;n<Z.circles.length;n+=4)t.circles.push(Z.circles[n+0]),t.circles.push(Z.circles[n+1]),t.circles.push(Z.circles[n+2]),t.circles.push(Z.collisionDetected?1:0)}const ie="globe"!==a.projection.name;W=W&&(ie||!L),G=G&&(ie||!z),this.placements[x]=new xn(I||W,P||G,R||a.justReloaded),n.add(x)},X=this.retainedQueryData[a.bucketInstanceId].tileID;if("offset"===a.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(a,X),"road"===a.elevationType&&a.updateRoadElevation(X.canonical),a.updateZOffset(),a.sortFeaturesByY){const t=a.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];Z(a.symbolInstances.get(n),n,a.collisionArrays[n])}a.hasAnyZOffset&&e.w("".concat(a.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(a.hasAnyZOffset){const e=a.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const n=e[t];Z(a.symbolInstances.get(n),n,a.collisionArrays[n])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)Z(a.symbolInstances.get(e),e,a.collisionArrays[e]);if(i&&a.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[a.bucketInstanceId];e.bi(t.invProjMatrix,c),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1}markUsedJustification(t,n,i,r){const{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:l,crossTileID:c}=i,d=e.b$(n),u=r===e.bI.vertical?l:"left"===d?s:"center"===d?a:"right"===d?o:-1;s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=u>=0&&s!==u?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=u>=0&&a!==u?0:c),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=u>=0&&o!==u?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=u>=0&&l!==u?0:c)}markUsedOrientation(t,n,i){const r=n===e.bI.horizontal||n===e.bI.horizontalOnly?n:0,s=n===e.bI.vertical?n:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=i,d=t.text.placedSymbolArray;a>=0&&(d.get(a).placedOrientation=r),o>=0&&(d.get(o).placedOrientation=r),l>=0&&(d.get(l).placedOrientation=r),c>=0&&(d.get(c).placedOrientation=s)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},s=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const o in this.placements){const e=this.placements[o],t=r[o];t?(this.opacities[o]=new gn(t,i,e.text,e.icon,null,e.clipped),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[o]=new gn(null,i,e.text,e.icon,e.skipFade,e.clipped),n=n||e.text||e.icon)}for(const o in r){const e=r[o];if(!this.opacities[o]){const t=new gn(e,i,!1,!1);t.isHidden()||(this.opacities[o]=t,n=n||e.text.placed||e.icon.placed)}}for(const o in s)this.variableOffsets[o]||!this.opacities[o]||this.opacities[o].isHidden()||(this.variableOffsets[o]=s[o]);for(const o in a)this.placedOrientations[o]||!this.opacities[o]||this.opacities[o].isHidden()||(this.placedOrientations[o]=a[o]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t,n,i){const r=new Set;for(const s of t){const t=s.getBucket(e);t&&s.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,r,s,s.collisionBoxArray,n,i,s.tileID,e.scope),"offset"===t.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(t,s.tileID),"road"===t.elevationType&&t.updateRoadElevation(s.tileID.canonical),t.updateZOffset())}}updateBucketOpacities(t,n,i,r,s,a,o,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,d=t.layers[0].paint,u=!!t.layers[0].dynamicFilter(),h=new gn(null,0,!1,!1,!0),p=c.get("text-allow-overlap"),m=c.get("icon-allow-overlap"),f=c.get("text-variable-anchor"),g="map"===c.get("text-rotation-alignment"),x="map"===c.get("text-pitch-alignment"),y=d.get("symbol-z-offset"),v="sea"===c.get("symbol-elevation-reference"),_=!y.isConstant(),b=new gn(null,0,p&&(m||!t.hasIconData()||c.get("icon-optional")),m&&(p||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const w=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)};let j=0;a&&t.updateReplacement(o,a);for(let N=0;N<t.symbolInstances.length;N++){const r=t.symbolInstances.get(N),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:d,crossTileID:p,numIconVertices:m,tileAnchorX:S,tileAnchorY:k}=r;let T=null;const C=this.retainedQueryData[t.bucketInstanceId];_&&r&&C&&(T=i.latestFeatureIndex.loadFeature({featureIndex:r.featureIndex,bucketIndex:C.bucketIndex,sourceLayerIndex:C.sourceLayerIndex,layoutVertexArrayOffset:0}));const E=y.evaluate(T,{}),A=n.has(p);let M=this.opacities[p];A?M=h:M||(M=b,this.opacities[p]=M),n.add(p);const D=c>0||d>0,I=m>0,P=this.placedOrientations[p],R=P===e.bI.vertical,L=P===e.bI.horizontal||P===e.bI.horizontalOnly;!D&&!I||M.isHidden()||j++;let z=!1;if((D||I)&&a)for(const n of t.activeReplacements){if(e.bV(n,s,e.bW.Symbol,l))continue;if(n.min.x>S||S>n.max.x||n.min.y>k||k>n.max.y)continue;const t=e.bX(S,k,o.canonical,n.footprintTileId.canonical);if(z=e.bY(t,n.footprint),z)break}if(D){const e=z?In:Dn(M.text);w(t.text,c,R?In:e),w(t.text,d,L?In:e);const n=M.text.isHidden(),{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:o}=r,l=t.text.placedSymbolArray,u=n||R?1:0;i>=0&&(l.get(i).hidden=u),s>=0&&(l.get(s).hidden=u),a>=0&&(l.get(a).hidden=u),o>=0&&(l.get(o).hidden=n||L?1:0);const h=this.variableOffsets[p];h&&this.markUsedJustification(t,h.anchor,r,P);const m=this.placedOrientations[p];m&&(this.markUsedJustification(t,"left",r,m),this.markUsedOrientation(t,m,r))}if(I){const e=z?In:Dn(M.icon),{placedIconSymbolIndex:n,verticalPlacedIconSymbolIndex:i}=r,s=t.icon.placedSymbolArray,a=M.icon.isHidden()?1:0;n>=0&&(w(t.icon,m,R?In:e),s.get(n).hidden=a),i>=0&&(w(t.icon,r.numVerticalIconVertices,L?In:e),s.get(i).hidden=a)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[N];if(n){let i=new e.P(0,0),s=!0;if(n.textBox||n.verticalTextBox){if(f){const e=this.variableOffsets[p];e?(i=bn(e.anchor,e.width,e.height,e.textOffset,e.textScale),g&&i._rotate(x?this.transform.angle:-this.transform.angle)):s=!1}u&&(s=!M.clipped),n.textBox&&Nn(t.textCollisionBox.collisionVertexArray,M.text.placed,!s||R,E,v,i.x,i.y),n.verticalTextBox&&Nn(t.textCollisionBox.collisionVertexArray,M.text.placed,!s||L,E,v,i.x,i.y)}const a=s&&Boolean(!L&&n.verticalIconBox);n.iconBox&&Nn(t.iconCollisionBox.collisionVertexArray,M.icon.placed,a,E,v,r.hasIconTextFit?i.x:0,r.hasIconTextFit?i.y:0),n.verticalIconBox&&Nn(t.iconCollisionBox.collisionVertexArray,M.icon.placed,!a,E,v,r.hasIconTextFit?i.x:0,r.hasIconTextFit?i.y:0)}}}if(t.fullyClipped=0===j,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function Nn(e,t,n,i,r,s,a){e.emplaceBack(t?1:0,n?1:0,s||0,a||0,i,r?1:0),e.emplaceBack(t?1:0,n?1:0,s||0,a||0,i,r?1:0),e.emplaceBack(t?1:0,n?1:0,s||0,a||0,i,r?1:0),e.emplaceBack(t?1:0,n?1:0,s||0,a||0,i,r?1:0)}const Sn=Math.pow(2,25),kn=Math.pow(2,24),Tn=Math.pow(2,17),Cn=Math.pow(2,16),En=Math.pow(2,9),An=Math.pow(2,8),Mn=Math.pow(2,1);function Dn(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*Sn+t*kn+n*Tn+t*Cn+n*En+t*An+n*Mn+t}const In=0;class Pn{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,n,i,r,s){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,i,e[this._currentTileIndex],this._sortAcrossTiles,s),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<a.length;){const e=a[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart,s),this._currentPartIndex++,r())return!0}return!1}}class Rn{constructor(e,t,n,i,r,s,a,o,l){this.placement=new jn(e,r,s,a,o,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,n,i,r,s){const a=e.q.now(),o=()=>{const t=e.q.now()-a;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const a=n[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===a.type&&(!a.minzoom||a.minzoom<=l)&&(!a.maxzoom||a.maxzoom>l)){const t=a,n=t.layout.get("symbol-z-elevate"),l=void 0!==t.layout.get("symbol-sort-key").constantOr(1),c=t.layout.get("symbol-z-order"),d="viewport-y"===c||"auto"===c&&!("viewport-y"!==c&&l),u=t.layout.get("text-allow-overlap")||t.layout.get("icon-allow-overlap")||t.layout.get("text-ignore-placement")||t.layout.get("icon-ignore-placement"),h=d&&u,p=this._inProgressLayer=this._inProgressLayer||new Pn(t),m=e.C(a.source,a.scope);if(p.continuePlacement(n||h?r[m]:i[m],this.placement,this._showCollisionBoxes,a,o,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ln=512/e.aj/2;class zn{constructor(t,n,i){this.tileID=t,this.bucketInstanceId=i,this.index=new e.c0(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=t.canonical.x*e.aj,s=t.canonical.y*e.aj;for(let e=0;e<n.length;e++){const{key:t,crossTileID:i,tileAnchorX:a,tileAnchorY:o}=n.get(e),l=Math.floor((r+a)*Ln),c=Math.floor((s+o)*Ln);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(i)}this.index.finish()}findMatches(t,n,i){const r=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),s=Ln/Math.pow(2,n.canonical.z-this.tileID.canonical.z),a=n.canonical.x*e.aj,o=n.canonical.y*e.aj;for(let e=0;e<t.length;e++){const n=t.get(e);if(n.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:d}=n,u=Math.floor((a+c)*s),h=Math.floor((o+d)*s),p=this.index.range(u-r,h-r,u+r,h+r).sort((e,t)=>e-t);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!i.has(t)){i.add(t),n.crossTileID=t;break}}}}}class On{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],i={};for(const n in e){const r=e[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const i=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in n){const s=n[r];s.tileID.isChildOf(e)&&s.findMatches(t.symbolInstances,e,i)}else{const s=n[e.scaledTo(Number(r)).key];s&&s.findMatches(t.symbolInstances,e,i)}}for(let r=0;r<t.symbolInstances.length;r++){const e=t.symbolInstances.get(r);e.crossTileID||(e.crossTileID=n.generate(),i.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new zn(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.crossTileIDs)this.usedCrossTileIDs[e].delete(n)}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class Bn{constructor(){this.layerIndexes={},this.crossTileIDs=new On,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n,i){let r=this.layerIndexes[e.fqid];void 0===r&&(r=this.layerIndexes[e.fqid]=new Fn);let s=!1;const a={};"globe"!==i.name&&r.handleWrapJump(n);for(const o of t){const t=o.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(o.tileID,t,this.crossTileIDs)&&(s=!0),a[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(s=!0),s}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}const Vn=771;class Un{constructor(e,t,n,i){this.blendFunction=e,this.blendColor=t.toNonPremultipliedRenderColor(null),this.mask=n,this.blendEquation=i}}Un.Replace=[1,0,1,0],Un.disabled=new Un(Un.Replace,e.am.transparent,[!1,!1,!1,!1]),Un.unblended=new Un(Un.Replace,e.am.transparent,[!0,!0,!0,!0]),Un.alphaBlended=new Un([1,Vn,1,Vn],e.am.transparent,[!0,!0,!0,!0]),Un.alphaBlendedNonPremultiplied=new Un([770,Vn,770,Vn],e.am.transparent,[!0,!0,!0,!0]),Un.multiply=new Un([774,0,774,0],e.am.transparent,[!0,!0,!0,!0]);class Hn{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Hn.ReadOnly=!1,Hn.ReadWrite=!0,Hn.disabled=new Hn(519,Hn.ReadOnly,[0,1]);const qn=7680;class Wn{constructor(e,t,n,i,r,s){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=s}}Wn.disabled=new Wn({func:519,mask:0},0,0,qn,qn,qn);const Gn=1029,Yn=2305;class Zn{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}function Xn(t,n){const i=e.c6(t,3);e.c8(t,n),e.cc(t,3,i)}function Kn(t,n){const i=e.c3([]);return e.c4(i,i,-n),e.c5(i,i,-t),i}function Qn(t,n){const i=[t[0],t[1],0],r=[n[0],n[1],0];if(e.ae(i)>=1e-15){const t=e.au([],i);e.c1(r,t,e.bG(r,t)),n[0]=r[0],n[1]=r[1]}const s=e.bF([],n,t);if(e.c2(s)<1e-15)return null;const a=Math.atan2(-s[1],s[0]);return Kn(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),a)}Zn.disabled=new Zn(!1,Gn,Yn),Zn.backCCW=new Zn(!0,Gn,Yn),Zn.backCW=new Zn(!0,Gn,2304),Zn.frontCW=new Zn(!0,1028,2304),Zn.frontCCW=new Zn(!0,1028,Yn);class Jn{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const n=t instanceof e.ac?t:new e.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=e.bQ(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const i=this.position,r=this._elevation?this._elevation.getAtPointOrZero(e.ac.fromLngLat(t)):0,s=e.ac.fromLngLat(t,r),a=[s.x-i.x,s.y-i.y,s.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Qn(a,n)}setPitchBearing(t,n){this.orientation=Kn(e.al(t),e.al(-n))}}class $n{constructor(t,n){this._transform=e.bx([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new e.ac(t[0],t[1],t[2])}get position(){const t=e.c6(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&e.cc(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.c3([]),t&&Xn(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Kn(e,t),Xn(this._transform,this._orientation)}forward(){const t=e.c6(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.c6(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.c6(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const i=new Float64Array(16);return e.bi(i,this.getWorldToCamera(t,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,i){const r=this.position;e.c1(r,r,-t);const s=new Float64Array(16);return e.bn(s,[i,i,i]),e.bo(s,s,r),s[10]*=n,s}getWorldToCamera(t,n){const i=new Float64Array(16),r=new Float64Array(4),s=this.position;return e.c7(r,this._orientation),e.c1(s,s,-t),e.c8(i,r),e.bo(i,i,s),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(t,n,i,r){const s=new Float64Array(16);return e.c9(s,t,n,i,r),s}getCameraToClipOrthographic(t,n,i,r,s,a){const o=new Float64Array(16);return e.ca(o,t,n,i,r,s,a),o}getDistanceToElevation(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=0===t?0:e.cb(t,n?e.aY(this.position[1]):this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}clone(){return new $n([...this.position],[...this.orientation])}}const ei={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ti{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.ai(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.ai(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.ai(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.ai(t.right,n.right,i)),this}getCenter(t,n){const i=e.ay((this.left+t-this.right)/2,0,t),r=e.ay((this.top+n-this.bottom)/2,0,n);return new e.P(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ti(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ni=15;class ii{constructor(t,n,i,r,s,a,o){this.tileSize=512,this._renderWorldCopies=void 0===s||s,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null!==i&&void 0!==i?i:0,this._maxPitch=null!==r&&void 0!==r?r:60,this.setProjection(a),this.setMaxBounds(o),this.width=0,this.height=0,this._center=new e.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ti,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new $n,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const e=new ii(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<ni}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=e.cj(this.projectionOptions);const i=this.getProjection(),r=!e.bv(n,i);return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.cj({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bQ(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=e.ck(),e.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=e.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(void 0===this._centerAltitudeValidForExaggeration)return;const e=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(e)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let r=0,s=0;for(let a=0;a<n.length;a++){const o=new e.P(n[a][0]*this.width,i+n[a][1]*(this.height-i)),l=t.pointCoordinate(o);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,s+=c}return 0===s?NaN:r/s}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,i=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),s=Math.max(i-n,r);this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const r=e.ae(e.at([],this._camera.position,i));return e.ay(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!e.cm(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];e.cn(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new Jn;return n.position=new e.ac(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!e.co(t))return!1;e.cp(t,t);const n=e.cq([],[0,0,-1],t),i=e.cq([],[0,-1,0],t);if(i[2]<0)return!1;const r=Qn(n,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.ay(t[2],r/i,r/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const n=[new e.cr(0,t)];if(this.renderWorldCopies){const i=this.pointCoordinate(new e.P(0,0)),r=this.pointCoordinate(new e.P(this.width,0)),s=this.pointCoordinate(new e.P(this.width,this.height)),a=this.pointCoordinate(new e.P(0,this.height)),o=Math.floor(Math.min(i.x,r.x,s.x,a.x)),l=Math.floor(Math.max(i.x,r.x,s.x,a.x)),c=1;for(let d=o-c;d<=l+c;d++)0!==d&&n.push(new e.cr(d,t))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,i){let r=[];const s=null!=i,a=!s;if(a&&this.zoom<n)return r;if(s&&0===i[0]&&0===i[1])return r;const o=new Set,l=(t,n,i,s,a)=>{const l=e.cV(n,t,i,s,a);o.has(l)||(r.push(new e.aM(t,n,i,s,a)),o.add(l))};for(let e=0;e<t.length;e++){const r=t[e];if(a&&r.canonical.z!==n)continue;const o=r.canonical,c=r.overscaledZ,d=r.wrap,u=1<<o.z,h=o.x+1<u,p=o.x>0,m=o.y+1<u,f=o.y>0,g=r.wrap-(p?0:1),x=r.wrap+(h?0:1),y=p?o.x-1:u-1,v=h?o.x+1:0;if(s)i[0]<0?(l(c,x,o.z,v,o.y),i[1]<0&&m&&(l(c,d,o.z,o.x,o.y+1),l(c,x,o.z,v,o.y+1)),i[1]>0&&f&&(l(c,d,o.z,o.x,o.y-1),l(c,x,o.z,v,o.y-1))):i[0]>0?(l(c,g,o.z,y,o.y),i[1]<0&&m&&(l(c,d,o.z,o.x,o.y+1),l(c,g,o.z,y,o.y+1)),i[1]>0&&f&&(l(c,d,o.z,o.x,o.y-1),l(c,g,o.z,y,o.y-1))):i[1]<0&&m?l(c,d,o.z,o.x,o.y+1):f&&l(c,d,o.z,o.x,o.y-1);else{const e=r.visibleQuadrants;1&e&&(l(c,g,o.z,y,o.y),f&&(l(c,d,o.z,o.x,o.y-1),l(c,g,o.z,y,o.y-1))),2&e&&(l(c,x,o.z,v,o.y),f&&(l(c,d,o.z,o.x,o.y-1),l(c,x,o.z,v,o.y-1))),4&e&&(l(c,g,o.z,y,o.y),m&&(l(c,d,o.z,o.x,o.y+1),l(c,g,o.z,y,o.y+1))),8&e&&(l(c,x,o.z,v,o.y),m&&(l(c,d,o.z,o.x,o.y+1),l(c,x,o.z,v,o.y+1)))}}const c=[];for(const e of r)r.some(t=>e.isChildOf(t))||c.push(e);if(r=c.filter(e=>!t.some(t=>!!(e.overscaledZ<n&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))),a){const e=1<<n,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),i=[e*t.x,e*t.y],s=4,a=s*s;r=r.filter(e=>{const t=e.canonical.x+.5-i[0],n=e.canonical.y+.5-i[1];return t*t+n*n<a})}return r}extendTileCoverToNearPlane(t,n,i){const r=[],s=new Set;for(const e of t)s.add(e.key);const a=(t,n,i,a,o)=>{const l=e.cV(n,t,i,a,o);s.has(l)||(r.push(new e.aM(t,n,i,a,o)),s.add(l))},o=t.reduce((e,t)=>Math.max(e,t.overscaledZ),i),l=1<<i,c=[new e.P(0,0),new e.P(e.aj,0),new e.P(e.aj,e.aj),new e.P(0,e.aj)],d=new e.P(0,0),u=new e.P(0,0),h=(t,n)=>{const r=Math.floor(t[0]),s=Math.floor(t[1]),h=(t[0]-r)*e.aj,p=(t[1]-s)*e.aj,m=Math.floor(n[0]),f=Math.floor(n[1]),g=(n[0]-m)*e.aj,x=(n[1]-f)*e.aj;for(let y=-1;y<=1;y++){const t=r+y;if(!(t<0||t>=l)){d.x=h-y*e.aj,u.x=g-(t-m)*e.aj;for(let n=-1;n<=1;n++){const r=s+n;d.y=p-n*e.aj,u.y=x-(r-f)*e.aj,e.cW(d,u,c)&&a(o,0,i,t,r)}}}},p=n.points,m=p[e.cs],f=p[e.ct],g=this._projectToGround(m,p[e.cu]),x=this._projectToGround(f,p[e.cv]);return h(m,g),h(f,x),r}_projectToGround(t,n){return e.cw(e.cx(),t,n,t[2]/(t[2]-n[2]))}coveringTiles(t){let n=this.coveringZoomLevel(t);const i=n,r=this.elevation&&this.elevation.exaggeration(),s=r&&!t.isTerrainDEM,a="mercator"===this.projection.name;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const o=this.locationCoordinate(this.center),l=this.center.lat,c=1<<n,d=[c*o.x,c*o.y,0],u="globe"===this.projection.name,h=!u,p=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,h),m=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=c*e.cb(1,this.center.lat),g=this._camera.position[2]/e.cb(1,this.center.lat),x=[c*m.x,c*m.y,g*(h?1:f)],y=u||r,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),_=this.isLODDisabled(!0)?n:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,j=this.projection.isReprojectedInTileSpace?e.cz(this):1,N=t=>{const n=1/4e4,i=new e.ac(t.x+n,t.y,t.z),r=new e.ac(t.x,t.y+n,t.z),s=t.toLngLat(),a=i.toLngLat(),o=r.toLngLat(),l=this.locationCoordinate(s),c=this.locationCoordinate(a),d=this.locationCoordinate(o),u=Math.hypot(c.x-l.x,c.y-l.y),h=Math.hypot(d.x-l.x,d.y-l.y);return Math.sqrt(u*h)*j/n},S=t=>{const n=b,i=w;return{aabb:e.cC(this,c,0,0,0,t,i,n,this.projection),zoom:0,x:0,y:0,minZ:i,maxZ:n,wrap:t,fullyVisible:!1}},k=[];let T=[];const C=n,E=t.reparseOverscaled?i:n,A=(g-this._centerAltitude)*f,M=e=>{if(!this._elevation||!e.tileID||!a)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=I(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},D=(e,t)=>{if(.707*t<e)return 1;const n=t/e;return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)},I=t=>{if(t.zoom<_)return!0;if(t.zoom===C)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const n=t.aabb.distanceX(x),r=t.aabb.distanceY(x);let o=A,c=1;if(u){o=t.aabb.distanceZ(x);const n=Math.pow(2,t.zoom),i=e.aY((t.y+1)/n),r=e.aY(t.y/n),s=Math.min(Math.max(l,i),r),a=e.c_(s)/e.c_(l);if(c=s===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,a/this._mercatorScaleRatio),this.zoom<=e.cX&&t.zoom===C-1&&a>=.9)return!0}else if(s&&(o=t.aabb.distanceZ(x)*f),this.projection.isReprojectedInTileSpace&&i<=5){const n=Math.pow(2,t.zoom),i=N(new e.ac((t.x+.5)/n,(t.y+.5)/n));c=i>.85?1:i}if(!a){const e=Math.sqrt(n*n+r*r+o*o);let i=(1<<C-t.zoom)*v*c;return i*=D(Math.max(o,A),e),e<i}let h=Number.MAX_VALUE,p=0;const m=t.aabb.getCorners(),g=[];for(const i of m){e.at(g,i,x),u||(s?g[2]*=f:g[2]=A);const t=e.bG(g,this._camera.forward());t<h&&(h=t,p=Math.abs(g[2]))}let y=(1<<C-t.zoom)*v*c;if(y*=D(Math.max(p,A),h),h<y)return!0;const b=t.aabb.closestPoint(d);return b[0]===d[0]&&b[1]===d[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)k.push(S(-e)),k.push(S(e));for(k.push(S(0));k.length>0;){const i=k.pop(),r=i.x,o=i.y;let l=i.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===i.y||i.y===(1<<i.zoom)-1);if(!l){let t=y?i.aabb.intersects(p):i.aabb.intersectsFlat(p);if(0===t&&h()){const n=new e.cA(i.zoom,r,o);t=e.cB(this,c,n,!0).intersects(p)}if(0===t)continue;l=2===t}if(i.zoom!==C&&I(i))for(let t=0;t<4;t++){const n=(r<<1)+t%2,d=(o<<1)+(t>>1),h={aabb:a?i.aabb.quadrant(t):e.cC(this,c,i.zoom+1,n,d,i.wrap,i.minZ,i.maxZ,this.projection),zoom:i.zoom+1,x:n,y:d,wrap:i.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:i.minZ,maxZ:i.maxZ};s&&!u&&(h.tileID=new e.aM(i.zoom+1===C?E:i.zoom+1,i.wrap,i.zoom+1,n,d),M(h)),k.push(h)}else{const s=i.zoom===C?E:i.zoom;if(t.minzoom&&t.minzoom>s)continue;let a=0;if(!l){let n=y?i.aabb.intersectsPrecise(p):i.aabb.intersectsPreciseFlat(p);if(0===n&&h()){const t=new e.cA(i.zoom,r,o);n=e.cB(this,c,t,!0).intersectsPrecise(p)}if(0===n)continue;if(t.calculateQuadrantVisibility)if(p.containsPoint(i.aabb.center))a=15;else for(let e=0;e<4;e++)0!==i.aabb.quadrant(e).intersects(p)&&(a|=1<<e)}const u=d[0]-(.5+r+(i.wrap<<i.zoom))*(1<<n-i.zoom),m=d[1]-.5-o,f=i.tileID?i.tileID:new e.aM(s,i.wrap,i.zoom,r,o);t.calculateQuadrantVisibility&&(f.visibleQuadrants=a),T.push({tileID:f,distanceSq:u*u+m*m})}}if(this.fogCullDistSq){const n=this.fogCullDistSq,i=this.horizonLineFromTop();T=T.filter(r=>{const s=[0,0,0,1],a=[e.aj,e.aj,0,1],o=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.aA(s,s,o),e.aA(a,a,o);const l=e.cD([],s,a),c=e.cE([],s,a),d=e.cY(l,c);if(0===d)return!0;let u=!1;const h=this._elevation;if(h&&d>n&&0!==i){const n=this.calculateProjMatrix(r.tileID.toUnwrapped());let s;t.isTerrainDEM||(s=h.getMinMaxForTile(r.tileID)),s||(s={min:w,max:b});const a=e.cF(this.rotation),o=[a[0]*e.aj,a[1]*e.aj,s.max];e.ad(o,o,n),u=(1-o[1])*this.height*.5<i}return d<n||u})}return T.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const n=e.ay(t.lat,-e.cG,e.cG),i=this.projection.project(t.lng,n);return new e.P(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let i,r;const s=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;i=(n.x-s.x)/e,r=(n.y-s.y)/e}else{const e=this.pointCoordinate(n),t=this.pointCoordinate(s);i=e.x-t.x,r=e.y-t.y}const a=this.locationCoordinate(t);this.setLocation(new e.ac(a.x-i,a.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e,t){return this.projection.locationPoint(this,e,t)}locationPoint3D(e,t){return this.projection.locationPoint(this,e,t,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,t){return this.coordinateLocation(this.pointCoordinate3D(e,t))}locationCoordinate(t,n){const i=n?e.cb(n,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.ac(r.x,r.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,n){const i=null!=n?n:this._centerAltitude,r=[t.x,t.y,0,1],s=[t.x,t.y,1,1];e.aA(r,r,this.pixelMatrixInverse),e.aA(s,s,this.pixelMatrixInverse);const a=s[3];e.cH(r,r,1/r[3]),e.cH(s,s,1/a);const o=r[2],l=s[2];return{p0:r,p1:s,t:o===l?0:(i-o)/(l-o)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return e.aA(n,n,this.pixelMatrixInverse),e.aA(i,i,this.pixelMatrixInverse),e.cH(n,n,1/n[3]),e.cH(i,i,1/i[3]),n[2]=e.cb(n[2],this._center.lat)*this.worldSize,i[2]=e.cb(i[2],this._center.lat)*this.worldSize,e.cH(n,n,1/this.worldSize),e.cH(i,i,1/this.worldSize),new e.av([n[0],n[1],n[2]],e.au([],e.at([],i,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:i,t:r}=t,s=e.cb(n[2],this._center.lat),a=e.cb(i[2],this._center.lat);return new e.ac(e.ai(n[0],i[0],r)/this.worldSize,e.ai(n[1],i[1],r)/this.worldSize,e.ai(s,a,r))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.ac(i[0],i[1],i[2]);let r=0,s=this.horizonLineFromTop();if(t.y>s)return this.pointCoordinate(t,n);const a=.02*s,o=t.clone();for(let l=0;l<10&&s-r>a;l++){o.y=e.ai(r,s,.66);const t=this.projection.pointCoordinate3D(this,o.x,o.y);t?(s=o.y,i=t):r=o.y}return i?new e.ac(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.cI)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return e.aA(r,r,this.pixelMatrix),r[3]>0?new e.P(r[0]/r[3],r[1]/r[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,s=this.pointLocation3D(new e.P(n,t)),a=this.pointLocation3D(new e.P(r,t)),o=this.pointLocation3D(new e.P(r,i)),l=this.pointLocation3D(new e.P(n,i));let c=Math.min(s.lng,a.lng,o.lng,l.lng),d=Math.max(s.lng,a.lng,o.lng,l.lng),u=Math.min(s.lat,a.lat,o.lat,l.lat),h=Math.max(s.lat,a.lat,o.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,m="globe"===this.projection.name?1:4,f=(t,n,i,r,s)=>{const a=(t+i)/2,o=(n+r)/2,l=new e.P(a,o),{lng:g,lat:x}=this.pointLocation3D(l),y=Math.max(0,c-g,u-x,g-d,x-h);c=Math.min(c,g),d=Math.max(d,g),u=Math.min(u,x),h=Math.max(h,x),(s<m||y>p)&&(f(t,n,a,o,s+1),f(a,o,i,r,s+1))};if(f(n,t,r,t,1),f(r,t,r,i,1),f(r,i,n,i,1),f(n,i,n,t,1),"globe"===this.projection.name){const[t,n]=e.cJ(this);t?(h=90,d=180,c=-180):n&&(u=-90,d=180,c=-180)}return new e.aG(new e.ci(c,u),new e.ci(d,h))}_getBoundsRectangular(t,n){const{top:i,left:r}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,o=new e.P(r,i),l=new e.P(a,i),c=new e.P(a,s),d=new e.P(r,s);let u=this.pointCoordinate(o,t),h=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,n),m=this.pointCoordinate(d,n),f=(e,t)=>(t.y-e.y)/(t.x-e.x);return u.y>1&&h.y>=0?u=new e.ac((1-m.y)/f(m,u)+m.x,1):u.y<0&&h.y<=1&&(u=new e.ac(-m.y/f(m,u)+m.x,0)),h.y>1&&u.y>=0?h=new e.ac((1-p.y)/f(p,h)+p.x,1):h.y<0&&u.y<=1&&(h=new e.ac(-p.y/f(p,h)+p.x,0)),(new e.aG).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(m)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.cG,this.maxLat=e.cG,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.aD(this.minLng)*this.tileSize,this.worldMaxX=e.aD(this.maxLng)*this.tileSize,this.worldMinY=e.aH(this.maxLat)*this.tileSize,this.worldMaxY=e.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const n=t.key,i=this._distanceTileDataCache;if(i[n])return i[n];const r=t.canonical,s=1/this.height,a=this.cameraWorldSize,o=a/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*o,c=r.y*o,d=this.point;d.x*=a/this.worldSize,d.y*=a/this.worldSize;const u=this.angle,h=Math.sin(-u),p=-Math.cos(-u);return i[n]={bearing:[h,p],center:[(d.x-l)*s,(d.y-c)*s],scale:o/e.aj*s},i[n]}calculateFogTileMatrix(t){const n=t.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.az(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}calculateProjMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t.key;let s;if(s=i?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,s[r])return s[r];const a=this.calculatePosMatrix(t,this.worldSize);let o;return o=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,e.az(a,o,a),s[r]=new Float32Array(a),s[r]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];const r=e.cK(t,this);return i[n]=r,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,n=e.bn([],[t,t,t]);return e.az(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const n=e.cb(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),r=this._camera.forward(),s=e.cb(1,this._center.lat);i[2]/=s,r[2]/=s,e.au(r,r);const a=t.raycast(i,r,t.exaggeration());if(a){const t=e.bE([],i,r,a),n=new e.ac(t[0],t[1],e.cb(t[2],e.aY(t[1]))),o=(n.z+e.ae([n.x-i[0],n.y-i[1],n.z-i[2]*s]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(o),this._centerAltitude=n.toAltitude(),this._center=this.coordinateLocation(n),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const n=this._elevation,i=e.cb(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),s=n.getAtPointOrZero(new e.ac(...r)),a=this.pixelsPerMeter/this.worldSize*s,o=this._minimumHeightOverTerrain(),l=r[2]-a;if(l<=o)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),n=[r[0],r[1],t.z-r[2]],i=e.ae(n);n[2]-=(o-l)/this._pixelsPerMercatorPixel;const s=e.ae(n);if(0===s)return;e.c1(n,n,i/s*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-n[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const n=this.center;return n.lat=e.ay(n.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(n.lng=e.ay(n.lng,this.minLng,this.maxLng)),this.center=n,void(this._constraining=!1)}const n=this._unmodified,{x:i,y:r}=this.point;let s=0,a=i,o=r;const l=this.width/2,c=this.height/2,d=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(r-c<d&&(o=d+c),r+c>u&&(o=u-c),u-d<this.height&&(s=Math.max(s,this.height/(u-d)),o=(u+d)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,n=this.worldSize/2-(e+t)/2;a=(i+n+this.worldSize)%this.worldSize-n,a-l<e&&(a=e+l),a+l>t&&(a=t-l),t-e<this.width&&(s=Math.max(s,this.width/(t-e)),a=(t+e)/2)}a===i&&o===r||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(a,o))),s&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(s)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.cb(1,this.center.lat)/e.cb(1,e.c$));const r=e.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const s="meters"===this.projection.zAxisUnit?i:1,a=this._camera.getWorldToCamera(this.worldSize,s);let o;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let n=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=n*this.aspect,r=-i,s=-n;i-=t.x,r-=t.x,n+=t.y,s+=t.y,o=this._camera.getCameraToClipOrthographic(r,i,s,n,this._nearZ,this._farZ),((t,n,i,r)=>{for(let s=0;s<16;s++)t[s]=e.ai(n[s],i[s],r)})(o,o,l,e.cZ(this.pitch>=ni?1:this.pitch/ni))}else o=l;const c=e.cM([],l,a);let d=e.cM([],o,a);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),n=e.bx([]);e.bo(n,n,[t.x*this.worldSize,t.y*this.worldSize,0]),e.az(n,n,e.cN(this)),e.bo(n,n,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.az(d,d,n),e.az(c,c,n),this.inverseAdjustmentMatrix=e.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.cP([],d,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=d,this.invProjMatrix=e.bi(new Float64Array(16),this.projMatrix),n){const n=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);n[8]=2*-t.x/this.width,n[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.cM([],n,a)}else this.expandedFarZProjMatrix=this.projMatrix;const u=e.bi([],o);this.frustumCorners=e.cQ.fromInvProjectionMatrix(u,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const h=new Float32Array(16);e.bx(h),e.cP(h,h,[1,-1,1]),e.cR(h,h,this._pitch),e.by(h,h,this.angle);const p=e.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.bw(p);const m=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+m)/this.height,this.skyboxMatrix=e.az(h,p,h);const f=this.point,g=f.x,x=f.y,y=this.width%2/2,v=this.height%2/2,_=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+_*y+b*v,j=x-Math.round(x)+_*v+b*y,N=new Float64Array(d);if(e.bo(N,N,[w>.5?w-1:w,j>.5?j-1:j,0]),this.alignedProjMatrix=N,d=e.bz(),e.cP(d,d,[this.width/2,-this.height/2,1]),e.bo(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=e.bz(),e.cP(d,d,[1,-1,1]),e.bo(d,d,[-1,-1,0]),e.cP(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d,this.pixelMatrix=e.az(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},d=e.bi(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=d,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.cS(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.ad(t,t,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=d;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,s=[t,t,n];e.c1(s,s,r),e.c1(i,i,-1),e.cT(i,i,s);const a=e.bz();e.bo(a,a,i),e.cP(a,a,s),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),i=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-n[0]*r,i.y/this.worldSize-n[1]*r,e/this.worldSize*this._centerAltitude-n[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],r=t[2];let s=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(s=Math.min((n-i)/r,1)),this._camera.position=e.bE([],this._camera.position,t,s),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),s=e.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.al(this._maxPitch)),o=Math.max((t[2]-s)/Math.cos(i),a),l=this._zoomFromMercatorZ(o);e.bE(t,t,n,o),this._pitch=e.ay(i,e.al(this.minPitch),e.al(this.maxPitch)),this.angle=e.bQ(r,-Math.PI,Math.PI),this._setZoom(e.ay(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,e)*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,i=e.cI,r=0,s=1/0;for(;i-n>1e-6&&i>n;){const e=n+.5*(i-n),a=this.tileSize*Math.pow(2,e),o=this.getCameraToCenterDistance(this.projection,e,a),l=this.scaleZoom(o/(Math.max(0,t)*this.tileSize)),c=Math.abs(e-l);c<s&&(s=c,r=e),e<l?n=e:i=e}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const i=Math.min(t.x,n.x),r=Math.max(t.x,n.x),s=Math.min(t.y,n.y),a=Math.max(t.y,n.y);if(s<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const o=[new e.P(i,s),new e.P(r,a),new e.P(i,a),new e.P(r,s)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of o){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const n=this.rayIntersectionCoordinate(t);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,n){const i=e.ae(e.at([],this._camera.position,t)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,n){let[i,r,s]=t;const a=[i,r,s,1];e.aA(a,a,n);const o=a[3]=Math.max(a[3],1e-6);return a[0]/=o,a[1]/=o,a[2]/=o,a}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const r=e.cL(t,n,this.width,this.height,1024),s=t.pixelSpaceConversion(this.center.lat,i,r);let a=.5/Math.tan(.5*this._fov)*this.height*s;return this.isOrthographic&&(a=e.ai(1,a,e.cZ(this.pitch>=ni?1:this.pitch/ni))),a}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.az(t,t,this.globeMatrix),t}getFrustum(t){return e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const ri=(t,n)=>{if(n>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),n<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=t.transform,r=Math.max(Math.abs(i._zoom-(t.minCutoffZoom-1)),1),s=i.isLODDisabled(!1)?e.af(60,45,i.pitch):e.af(30,15,i.pitch),a=i._farZ-i._nearZ,o=n*i.height,l=((1-(c=s))*i.cameraToCenterDistance+c*(i._farZ+o))*r;var c;return{shouldRenderCutoff:s<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(l-i._nearZ)/a,(l-o-i._nearZ)/a]}}},si={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class ai{constructor(e,t){this.aabb=e,this.lastCascade=t}}class oi{add(e,t){const n=this.receivers[e.key];void 0!==n?(n.aabb.min[0]=Math.min(n.aabb.min[0],t.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],t.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],t.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],t.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],t.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],t.max[2])):this.receivers[e.key]=new ai(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,n,i){const r=e.d6.fromPoints(t.points);let s=0;for(const a in this.receivers){const t=this.receivers[a];if(!t)continue;if(!r.intersectsAabb(t.aabb))continue;t.aabb.min=r.closestPoint(t.aabb.min),t.aabb.max=r.closestPoint(t.aabb.max);const o=t.aabb.getCorners();for(let r=0;r<i.length;r++){let a=!0;for(const t of o){const s=[t[0]*n,t[1]*n,t[2]];if(e.ad(s,s,i[r].matrix),s[0]<-1||s[0]>1||s[1]<-1||s[1]>1){a=!1;break}}if(t.lastCascade=r,s=Math.max(s,r),a)break}}return s+1}}class li{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new oi,this._depthMode=new Hn(e.context.gl.LEQUAL,Hn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),e.tp.registerParameter(si,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(si,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),e.tp.registerParameter(si,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const r=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=i.style.order.reduce((e,n)=>{const r=i.style._mergedLayers[n];return e+(r.hasShadowPass()&&!r.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const s=i.context,a=si.shadowMapResolution,o=si.shadowMapResolution;if(0===this._cascades.length||si.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<si.cascadeCount;++t){const t=i._shadowMapDebug,n=s.gl,r=s.createFramebuffer(a,o,t,"texture"),l=new e.T(s,{width:a,height:o,data:null},n.DEPTH_COMPONENT16);if(r.depthAttachment.set(l.texture),t){const t=new e.T(s,{width:a,height:o,data:null},n.RGBA8);r.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:r,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.cy,scale:0})}}this.shadowDirection=di(n);let l=0;if(t.elevation){const e=t.elevation,n=[1e4,-1e4];e.visibleDemTiles.filter(e=>e.dem).forEach(e=>{const t=e.dem.tree;n[0]=Math.min(n[0],t.minimums[0]),n[1]=Math.max(n[1],t.maximums[0])}),1e4!==n[0]&&(l=(n[1]-n[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,d=3*c,u=new Float64Array(16);for(let m=0;m<this._cascades.length;++m){const n=this._cascades[m];let i=t.height/50,r=1;1===si.cascadeCount?r=d:0===m?r=c:(i=c,r=d);const[s,a]=hi(t,this.shadowDirection,i,r,si.shadowMapResolution,l);n.scale=t.scale,n.matrix=s,n.boundingSphereRadius=a,e.bi(u,n.matrix),n.frustum=e.cy.fromInvProjectionMatrix(u,1,0,!0),n.far=r}const h=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[h].far,this._cascades[h].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/si.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=si.shadowMapResolution,this._uniformValues.u_shadowmap_0=ei.ShadowMap0,this._uniformValues.u_shadowmap_1=ei.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=i.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const n=p.getMinMaxForTile(e);n&&(t=n)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,n){if(!this.enabled)return;const i=this.painter,r=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),r.viewport.set([0,0,si.shadowMapResolution,si.shadowMapResolution]);for(let s=0;s<this._numCascadesToRender;++s){i.currentShadowCascade=s,r.bindFramebuffer.set(this._cascades[s].framebuffer.framebuffer),r.clear({color:e.am.white,depth:1});for(const e of t.order){const r=t._mergedLayers[e];if(!r.hasShadowPass()||r.isHidden(i.transform.zoom))continue;const s=t.getLayerSourceCache(r),a=s?n[s.id]:void 0;("model"===r.type||a&&a.length)&&i.renderLayer(i,s,r,a)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,n=e.context,i=n.gl,r=t.directionalLight,s=t.ambientLight;if(!r||!s)return;const a=[],o=ri(e,e.longestCutoffRange);o.shouldRenderCutoff&&a.push("RENDER_CUTOFF"),a.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&a.push("NORMAL_OFFSET");const l=ui(t,r,s),c=new Hn(i.LEQUAL,Hn.ReadOnly,e.depthRangeFor3D),d=new Wn({func:i.EQUAL,mask:255},0,255,i.KEEP,i.KEEP,i.KEEP);for(const u of this._groundShadowTiles){const t=u.toUnwrapped(),r=e.isTileAffectedByFog(u),s=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:r});this.setupShadows(t,s),e.uploadCommonUniforms(n,s,t,null,o);const h={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:l};s.draw(e,i.TRIANGLES,c,d,Un.multiply,Zn.disabled,h,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Un.unblended:Un.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,i=n.calculatePosMatrix(t,n.worldSize);return e.az(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(t){return e.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,i){if(!this.enabled)return;const r=this.painter.transform,s=this.painter.context,a=s.gl,o=this._uniformValues,l=new Float64Array(16),c=r.calculatePosMatrix(t,r.worldSize);for(let d=0;d<this._cascades.length;d++)e.az(l,this._cascades[d].matrix,c),o[0===d?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),s.activeTexture.set(a.TEXTURE0+ei.ShadowMap0+d),this._cascades[d].texture.bindExtraParam(a.LINEAR,a.LINEAR,a.CLAMP_TO_EDGE,a.CLAMP_TO_EDGE,a.GREATER);if(this.useNormalOffset=!!i,this.useNormalOffset){const n=e.d4(t.canonical),s=2/r.tileSize*e.aj/si.shadowMapResolution,a=s*this._cascades[0].boundingSphereRadius,l=s*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===i?1:3)*function(t){const n=e.ay((t-22)/-22,0,1);return.125*(1-n)+4*n}(r.zoom);o.u_shadow_normal_offset=[n,a*c,l*c],o.u_shadow_bias=[1e-4,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(s,o)}setupShadowsFromMatrix(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const r=this.painter.context,s=r.gl,a=this._uniformValues,o=new Float64Array(16);for(let l=0;l<si.cascadeCount;l++)e.az(o,this._cascades[l].matrix,t),a[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(o),r.activeTexture.set(s.TEXTURE0+ei.ShadowMap0+l),this._cascades[l].texture.bindExtraParam(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE,s.GREATER);if(this.useNormalOffset=i,i){const e=si.normalOffset;a.u_shadow_normal_offset=[1,e,e],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(r,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,i,r){if(r[2]>=0)return{};const s=function(t,n,i){const r=i/(1<<t.canonical.z);return new e.d6([t.canonical.x*r+t.wrap*i,t.canonical.y*r+t.wrap*i,0],[(t.canonical.x+1)*r+t.wrap*i,(t.canonical.y+1)*r+t.wrap*i,n])}(t,n,i).getCorners(),a=n/-r[2];r[0]<0?(e.d5(s[0],s[0],[r[0]*a,0,0]),e.d5(s[3],s[3],[r[0]*a,0,0])):r[0]>0&&(e.d5(s[1],s[1],[r[0]*a,0,0]),e.d5(s[2],s[2],[r[0]*a,0,0])),r[1]<0?(e.d5(s[0],s[0],[0,r[1]*a,0]),e.d5(s[1],s[1],[0,r[1]*a,0])):r[1]>0&&(e.d5(s[2],s[2],[0,r[1]*a,0]),e.d5(s[3],s[3],[0,r[1]*a,0]));const o={};return o.vertices=s,o.planes=[ci(s[1],s[0],s[4]),ci(s[2],s[1],s[5]),ci(s[3],s[2],s[6]),ci(s[0],s[3],s[7])],o}addShadowReceiver(t,n,i){this._receivers.add(t,e.d6.fromTileIdAndHeight(t,n,i))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function ci(t,n,i){const r=e.at([],i,n),s=e.at([],t,n),a=e.bF([],r,s),o=e.ae(a);return 0===o?[0,0,1,0]:(e.c1(a,a,1/o),[a[0],a[1],a[2],-e.bG(a,n)])}function di(t){const n=t.properties.get("direction"),i=e.d1(n.x,n.y,n.z);i[2]=e.ay(i[2],0,75);const r=e.d3([i[0],i[1],i[2]]);return e.d2(r.x,r.y,r.z)}function ui(t,n,i){const r="none"===n.properties.get("color-use-theme"),s=n.properties.get("color"),a=n.properties.get("intensity"),o=n.properties.get("direction"),l=[o.x,o.y,o.z],c="none"===i.properties.get("color-use-theme"),d=i.properties.get("color"),u=i.properties.get("intensity"),h=Math.max(e.bG([0,0,1],l),0),p=[0,0,0];e.c1(p,d.toPremultipliedRenderColor(c?null:t.getLut(n.scope)).toArray01Linear().slice(0,3),u);const m=[0,0,0];return e.c1(m,s.toPremultipliedRenderColor(r?null:t.getLut(i.scope)).toArray01Linear().slice(0,3),h*a),e.d8([p[0]>0?p[0]/(p[0]+m[0]):0,p[1]>0?p[1]/(p[1]+m[1]):0,p[2]>0?p[2]/(p[2]+m[2]):0])}function hi(t,n,i,r,s,a){const o=t.zoom,l=t.scale,c=t.worldSize,d=1/c,u=t.aspect,h=Math.sqrt(1+u*u)*Math.tan(.5*t.fovX),p=h*h,m=r-i,f=r+i;let g,x;p>m/f?(g=r,x=r*h):(g=.5*f*(1+p),x=.5*Math.sqrt(m*m+2*(r*r+i*i)*p+f*f*p*p));const y=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),_=[0,0,-g*d];e.ad(_,_,v);let b=x*d;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const n=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),s=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,i,r);s[8]=2*-t.centerOffset.x/t.width,s[9]=2*t.centerOffset.y/t.height;const a=new Float64Array(16);e.cM(a,s,n);const d=new Float64Array(16);e.bi(d,a);const u=e.cy.fromInvProjectionMatrix(d,c,o,!0);for(const i of u.points){const n=((j=i)[0]/=l,j[1]/=l,j[2]=e.cb(j[2],t._center.lat),j);b=Math.max(b,e.c2(e.d7([],_,n)))}}var j;b*=s/(s-1);const N=Math.acos(n[2]),S=Math.atan2(-n[0],-n[1]),k=new $n;k.position=_,k.setPitchBearing(N,S);const T=k.getWorldToCamera(c,y),C=b*c,E=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*C),A=k.getCameraToClipOrthographic(-C,C,-C,C,E,(C+a*y)/n[2]),M=new Float64Array(16);e.az(M,A,T);const D=e.d2(Math.floor(1e6*_[0])/1e6*c,Math.floor(1e6*_[1])/1e6*c,0),I=.5*s,P=[0,0,0];e.ad(P,D,M),e.c1(P,P,I);const R=[Math.floor(P[0]),Math.floor(P[1]),Math.floor(P[2])],L=[0,0,0];e.at(L,P,R),e.c1(L,L,-1/I);const z=new Float64Array(16);return e.bx(z),e.bo(z,z,L),e.az(M,z,M),[M,C]}class pi extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,n){return e.aS(this.requestManager.transformRequest(n,e.R.Model).url).then(n=>{if(!n)return;const i=e.aT(n),r=new e.aU(t,void 0,void 0,i);return r.computeBoundsAndApplyParent(),r}).catch(i=>{if(i&&404===i.status)return null;this.fire(new e.z(new Error("Could not load model ".concat(t," from ").concat(n,": ").concat(i.message))))})}load(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{forceReload:!1};this.models[n]||(this.models[n]={});const r=Object.keys(t),s=[],a=[];for(const e of r){const r=t[e];this.hasURLBeenRequested(r)&&!i.forceReload||(this.modelByURL[r]={modelId:e,scope:n},s.push(this.loadModel(e,r)),a.push(e)),this.models[n][e]||(this.models[n][e]={model:null,numReferences:1})}this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+a.length,Promise.allSettled(s).then(t=>{for(let e=0;e<t.length;e++){const{status:i}=t[e];if("rejected"===i)continue;const{value:r}=t[e];this.models[n][a[e]]||(this.models[n][a[e]]={model:null,numReferences:1}),this.models[n][a[e]].model=r}this.numModelsLoading[n]-=a.length,this.fire(new e.A("data",{dataType:"style"}))}).catch(t=>{this.fire(new e.z(new Error("Could not load models: ".concat(t.message))))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!((arguments.length>2&&void 0!==arguments[2]?arguments[2]:{exactIdMatch:!1}).exactIdMatch?this.getModel(e,t):this.getModelByURL(this.modelUris[t][e]))}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}getModelByURL(e){if(!e)return null;const t=this.modelByURL[e];return t?this.models[t.scope][t.modelId].model:null}hasModelBeenAdded(e,t){return this.models[t]&&void 0!==this.models[t][e]}getModelURIs(e){return this.modelUris[e]||{}}addModel(e,t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const i=this.requestManager.normalizeModelURL(t);if((this.hasModel(e,n,{exactIdMatch:!0})||this.hasModelBeenAdded(e,n))&&this.modelUris[n][e]===i)this.models[n][e].numReferences++;else if(this.hasURLBeenRequested(i)){const{scope:e,modelId:t}=this.modelByURL[i];this.models[e][t].numReferences++}else this.modelUris[n][e]=i,this.load({[e]:this.modelUris[n][e]},n)}addModelURLs(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const n=this.modelUris[t];for(const i in e)n[i]=this.requestManager.normalizeModelURL(e[i])}reloadModels(e){this.load(this.modelUris[e],e,{forceReload:!0})}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const i={};for(const r of t)this.hasModel(r,n,{exactIdMatch:!0})||this.hasURLBeenRequested(r)?this.models[n][r].numReferences++:this.modelUris[n][r]&&!this.hasURLBeenRequested(r)?i[r]=this.modelUris[n][r]:!this.hasURLBeenRequested(r)&&e.d9(r,!1)&&(this.modelUris[n][r]=this.requestManager.normalizeModelURL(r),i[r]=this.modelUris[n][r]);this.load(i,n)}hasURLBeenRequested(e){return void 0!==this.modelByURL[e]}removeModel(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences||i)){const i=this.modelUris[t][e];n||delete this.modelUris[t][e],delete this.modelByURL[i];const r=this.models[t][e].model;if(!r)return;delete this.models[t][e],r.destroy()}}destroy(){for(const e of Object.keys(this.models))for(const t of Object.keys(this.models[e])){const n=this.models[e][t].model;delete this.models[e][t],n&&n.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const n in this.models[t])this.models[t][n].model&&this.models[t][n].model.upload(e.context)}}const mi=new e.a7({data:new e.a8(e.a5.colorTheme.data)});class fi{constructor(e){this._scope=e,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(e){const t=this._makeBuildingsQueryArea(e),n=this._makeFloorsQueryArea(e),i=e.queryRenderedFeatures(t,this._buildingQueryParams).filter(e=>"building"===e.properties.shape_type).reduce((e,t)=>{const n=t.properties.id;return"building"!==t.properties.shape_type||e.some(e=>e.properties.id===n)||e.push(t),e},[]),r=e.queryRenderedFeatures(n,this._floorQueryParams).filter(e=>"floor"===e.properties.shape_type).reduce((e,t)=>{const n=t.properties.id;return"floor"!==t.properties.shape_type||e.some(e=>e.properties.id===n)||e.push(t),e},[]),s=[e.getCenter().lng,e.getCenter().lat];return{floors:r,building:this._findBuildingAtCenter(s,i)||(i.length>0?i[0]:null)}}_makeBuildingsQueryArea(t){const n=t.transform.width,i=t.transform.height,r=Math.min(n,i),s=r*(1/8),a=r*(1/8),o=.5*(n-s),l=.5*(i-a);return[new e.P(o,l),new e.P(o+s,l+a)]}_makeFloorsQueryArea(t){const n=t.transform.width,i=t.transform.height,r=n*(2/3),s=i*(2/3),a=.5*(n-r),o=.5*(i-s);return[new e.P(a,o),new e.P(a+r,o+s)]}_findBuildingAtCenter(e,t){for(const n of t)if("Polygon"===n.geometry.type&&this._pointInPolygon(e,n.geometry.coordinates[0]))return n;return null}_pointInPolygon(e,t){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const s=t[i][0],a=t[i][1],o=t[r][1];a>e[1]!=o>e[1]&&e[0]<(t[r][0]-s)*(e[1]-a)/(o-a)+s&&(n=!n)}return n}}class gi{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(e){this._selectedBuildingId=e}setFloors(e){if(this._floors=e.filter(e=>e.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(e=>e.properties.id).includes(this._selectedFloorId)){const e=this._floors.map(e=>({id:e.properties.id,level:e.properties.floor_level})).reduce((e,t)=>{const n=Math.abs(e.level-1),i=Math.abs(t.level-1);return i<n||i===n&&t.level>e.level?t:e});this._selectedFloorId=e.id}}setFloorId(e){this._selectedFloorId=e}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const xi={"mbx-indoor-level-selected":{default:["literal",[]]}};function yi(e){return e=e||{},Object.assign(e,xi)}class vi extends e.E{constructor(t){super(),e.aV(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new gi,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new e.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new fi(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const e=this._indoorDataQuery.execute(this._map);e&&0!==e.floors.length?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(e)):this._clearIndoorData()}_selectFloors(e){if(e.building)this._floorSelectionState.setBuildingId(e.building.properties.id),this._floorSelectionState.setFloors(e.floors),this._updateUI();else{const t=this._floorSelectionState.getSelectedFloorId();if(t&&e.floors.some(e=>e.properties.id===t))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const t=this._floorSelectionState.getCurrentBuildingFloors().map(e=>({id:e.properties.id,name:e.properties.name,shortName:e.properties.floor_level,levelOrder:e.properties.floor_level})),n=this._floorSelectionState.getSelectedFloorId();n?(this._updateIndoorConfig(),this.fire(new e.A("indoorupdate",{selectedFloorId:n,floors:t}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const e=this._floorSelectionState.getSelectedFloorId();e?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[e]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(e){this._floorSelectionState.setFloorId(e),this._updateIndoorConfig()}}function _i(t){if(!t.metadata||!t.metadata.content_area)return;const n=e.q.devicePixelRatio,{left:i,top:r,width:s,height:a}=t.metadata.content_area,o=i*n,l=r*n;return[o,l,o+s*n,l+a*n]}function bi(t){if(t)return t.map(t=>{let[n,i]=t;return[n*e.q.devicePixelRatio,i*e.q.devicePixelRatio]})}class wi{constructor(e,t,n){this.id=e,this.scope=t,this.sourceCache=n,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const n=this.sourceCache.getVisibleCoordinates();if(0===n.length)return t;const i=this.sourceCache.getSource();if(!(i instanceof ot))return t;const r=n.map(e=>this.sourceCache.getTile(e)),s=i.getImages(r,Array.from(this.pendingRequests));for(const[a,o]of s)t.set(e.I.from({name:a,iconsetId:this.id}),o),this.pendingRequests.delete(a);for(const e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),t}}const ji=(e,t)=>Ie(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),Ni=e.aF(Lt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Si=e.aF(Lt,["setCenter","setZoom","setBearing","setPitch"]),ki=new Set(["background","sky","slot","custom"]),Ti={version:8,layers:[],sources:{}},Ci={duration:300,delay:0};class Ei extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=e.h({},Ci),this._buildingIndex=new It(this),this.crossTileSymbolIndex=new Bn,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new W,this.dispatcher=n.dispatcher?n.dispatcher:new e.D(e.db(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new Y(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new e.dc(t._requestManager,n.localFontFamily?e.dd.all:n.localIdeographFontFamily?e.dd.ideographs:e.dd.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new pi(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",e.de());const i=this;this._rtlTextPluginCallback=Ei.registerForPluginStateChange(t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,n)=>{if(e.df(t),n&&n.every(e=>e))for(const e in i._sourceCaches){const t=i._sourceCaches[e],n=t.getSource().type;"vector"!==n&&"geojson"!==n||t.reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const n in this._layers){const e=this._layers[n];e.source===t.id&&this._validateLayer(e)}})}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.j(t))return t;const n=e.dg(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch(e){return n}return n}return"json://".concat(e.dh(JSON.stringify(t)))}_diffStyle(t,n,i){this.globalId=this._getGlobalId(t);const r=(e,t)=>{try{t(null,this.setState(e,i))}catch(e){t(e,!1)}};if("string"==typeof t){const i=this.map._requestManager.normalizeStyleURL(t),s=this.map._requestManager.transformRequest(i,e.R.Style);e.n(s,(t,i)=>{t?this.fire(new e.z(t)):i&&r(i,n)})}else"object"==typeof t&&r(t,n)}loadURL(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.A("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!e.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const r=this.importsCache.get(t);if(r)return this._load(r,i);const s=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.n(s,(n,r)=>{if(this._request=null,n)this.fire(new e.z(n));else if(r)return this.importsCache.set(t,r),this._load(r,i)})}loadJSON(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.q.frame(()=>{this._request=null,this._load(t,!1!==n.validate)})}loadEmpty(){this.fire(new e.A("dataloading",{dataType:"style"})),this._load(Ti,!1)}_loadImports(t,n,i){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const e of t){const t=this._createFragmentStyle(e),s=new Promise(e=>{t.once("style.import.load",e),t.once("error",e)}).then(()=>this.mergeAll());if(r.push(s),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const a=e.data||this.importsCache.get(e.url);a?(t.loadJSON(a,{validate:n}),this._isInternalStyle(a)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:n}):t.loadEmpty();const o={style:t,id:e.id,config:e.config};if(i){const e=this.fragments.findIndex(e=>{let{id:t}=e;return t===i});this.fragments=this.fragments.slice(0,e).concat(o).concat(this.fragments.slice(e))}else this.fragments.push(o)}return Promise.allSettled(r)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const n of e.fragments)n.style.globalId&&t.add(n.style.globalId),this.getImportGlobalIds(n.style,t);return[...t.values()]}_createFragmentStyle(t){const n=this.scope?e.C(t.id,this.scope):t.id;let i;const r=this._initialConfig&&this._initialConfig[n];(t.config||r)&&(i=e.h({},t.config,r));const s=new Ei(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:i,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return s.setEventedParent(this.map,{style:s}),s}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,n){const i=t.indoor?yi(t.schema):t.schema;if(this._isInternalStyle(t)){const i=e.h({},Ti,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(i,n)}if(this.updateConfig(this._config,i),n&&ji(this,ve(t)))return;this._loaded=!0,this.stylesheet=e.di(t);const r=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const e in t.iconsets)this.addIconset(e,t.iconsets[e]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const i=Rt(this.stylesheet.layers);if(this._order=i.map(e=>e.id),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Re(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Re(this.stylesheet.light)),this._layers={};for(const t of i){const n=e.dn(t,this.scope,this._styleColorTheme.lut,this.options);0!==n.configDependencies.size&&this._configDependentLayers.add(n.fqid),n.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=n;const i=this.getOwnLayerSourceCache(n),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();i&&n.canCastShadows()&&r&&(i.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const r=this.stylesheet.terrain;r&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(r,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.A("data",{dataType:"style"}));const s=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new e.A(s?"style.load":"style.import.load"))}).catch(t=>{this.fire(new e.z(new Error("Failed to load imports",t))),this.fire(new e.A(s?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new e.A(s?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(s){const t=this._evaluateColorThemeData(s);this._loadColorTheme(t).then(()=>{r()}).catch(t=>{e.w("Couldn't load color theme from the stylesheet: ".concat(t)),r()})}else this._styleColorTheme.lut=null,r()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,n,i,r,s,a,o,l,c,d;const u={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(n=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(i=e.directionalLight);r=this._prioritizeTerrain(r,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(s=e.fog),e.stylesheet.snow&&null!=e.snow&&(a=e.snow),e.stylesheet.rain&&null!=e.rain&&(o=e.rain),null!=e.stylesheet.camera&&(d=e.stylesheet.camera),null!=e.stylesheet.projection&&(l=e.stylesheet.projection),null!=e.stylesheet.transition&&(c=e.stylesheet.transition),u[e.scope]=e._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=i,this.fog=s,this.snow=a,this.rain=o,this._styleColorThemeForScope=u,null===r?delete this.terrain:this.terrain=r,this.camera=d||{"camera-projection":"perspective"},this.projection=l||{name:"mercator"},this.transition=e.h({},Ci,c),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=n=>{for(const e of n.fragments)t(e.style);e(n)};t(this)}_prioritizeTerrain(e,t,n){const i=e&&0===e.drapeRenderMode;return null===n?t&&0===t.drapeRenderMode?t:i?e:null:null!=t&&(!e||i||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)}),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const t={},n={},i={};this.forEachFragmentStyle(r=>{for(const n in r._sourceCaches){const i=e.C(n,r.scope);t[i]=r._sourceCaches[n]}for(const t in r._otherSourceCaches){const i=e.C(t,r.scope);n[i]=r._otherSourceCaches[t]}for(const t in r._symbolSourceCaches){const n=e.C(t,r.scope);i[n]=r._symbolSourceCaches[t]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){var t=this;const n={},i=[],r={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(t=>{for(const r of t._order){const s=t._layers[r];if("slot"===s.type){const t=e.dj(r);if(n[t])continue;n[t]=[]}s.slot&&n[s.slot]?n[s.slot].push(s):i.push(s)}}),this._mergedOrder=[];const s=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const a of i)if("slot"===a.type){const i=e.dj(a.id);n[i]&&s(n[i]),t._mergedSlots.push(i)}else{const n=e.C(a.id,a.scope);t._mergedOrder.push(n),r[n]=a,a.is3D(!!t.terrain)&&(t._has3DLayers=!0),"circle"===a.type&&(t._hasCircleLayers=!0),"symbol"===a.type&&(t._hasSymbolLayers=!0),"clip"===a.type&&(t._clipLayerPresent=!0)}};s(i),this._mergedOrder.sort((e,t)=>{const n=r[e],i=r[t];return n.hasInitialOcclusionOpacityProperties?i.is3D(!!this.terrain)?1:0:n.is3D(!!this.terrain)&&i.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,n,i){const r=e.h({},n);for(const a of Object.keys(e.a5.colorTheme))void 0===r[a]&&(r[a]=e.a5.colorTheme[a].default);const s=new e.a6(mi,t,new Map(i));return s.setTransitionOrValue(r,i),s.untransitioned().possiblyEvaluate(new e.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((i,r)=>{const s="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void i();let a=t;a.startsWith(s)||(a=s+a);const o=e.I.from("mapbox-reserved-lut"),l=new Image;l.src=a,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,r(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void i();this._styleColorTheme.lutLoading=!1;const{width:s,height:a,data:c}=e.q.getImageData(l);if(a>32)return void r(new Error("The height of the image must be less than or equal to 32 pixels."));if(s!==a*a)return void r(new Error("The width of the image must be equal to the height squared."));this.getImage(o)&&this.removeImage(o),this.addImage(o,{data:new e.r({width:s,height:a},c),pixelRatio:1,sdf:!1,usvg:!1,version:0});const d=this.imageManager.getImage(o,this.scope);d?(this._styleColorTheme.lut={image:d.data,data:t},i()):r(new Error("Missing LUT image."))}})}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,n,i){let r,s,a;const o=e.q.devicePixelRatio>1?"@2x":"";let l=e.n(n.transformRequest(n.normalizeSpriteURL(t,o,".json"),e.R.SpriteJSON),(e,t)=>{l=null,a||(a=e,r=t,d())}),c=e.o(n.transformRequest(n.normalizeSpriteURL(t,o,".png"),e.R.SpriteImage),(e,t)=>{c=null,a||(a=e,s=t,d())});function d(){if(a)i(a);else if(r&&s){const t=e.q.getImageData(s),n={};for(const i in r){const{width:s,height:a,x:o,y:l,sdf:c,pixelRatio:d,stretchX:u,stretchY:h,content:p}=r[i],m=new e.r({width:s,height:a});e.r.copy(t,m,{x:o,y:l},{x:0,y:0},{width:s,height:a},null),n[i]={data:m,pixelRatio:d,sdf:c,stretchX:u,stretchY:h,content:p,usvg:!1}}i(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,(t,n)=>{if(this._spriteRequest=null,t)this.fire(new e.z(t));else if(n){const t=new Map;for(const i in n)t.set(e.I.from(i),n[i]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))})}addIconset(t,n){if("sprite"===n.type)return void this._loadSprite(n.url);const i=this.getOwnSourceCache(n.source);if(!i)return void this.fire(new e.z(new Error('Source "'.concat(n.source,'" as specified by iconset "').concat(t,'" does not exist and cannot be used as an iconset source'))));const r=i.getSource();if("raster-array"!==r.type)return void this.fire(new e.z(new Error('Source "'.concat(n.source,'" as specified by iconset "').concat(t,'" is not a "raster-array" source and cannot be used as an iconset source'))));r.partial=!1;const s=new wi(t,this.scope,i);this.imageManager.addImageProvider(s,this.scope)}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope)}_loadIconset(t){if(!e.j(t)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(t);const n="auto"===this.map._spriteFormat;var i,r;this._spriteRequest=(r=(i,r)=>{if(this._spriteRequest=null,i)n?this._loadSprite(t):this.fire(new e.z(i));else if(r){const t=new Map;for(const n in r)t.set(e.I.from(n),r[n]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))},e.br((i=this.map._requestManager).transformRequest(i.normalizeIconsetURL(t),e.R.Iconset),(t,n)=>{if(t)return void r(t);const i={},s=e.da(new e.bq(n));for(const r of s.icons){const t={version:1,pixelRatio:e.q.devicePixelRatio,content:_i(r),stretchX:r.metadata?bi(r.metadata.stretch_x_areas):void 0,stretchY:r.metadata?bi(r.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:r};i[r.name]=t}r(null,i)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const i=t.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new e.z(new Error('Source layer "'.concat(i,'" does not exist on source "').concat(n.id,'" as specified by style layer "').concat(t.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(this.imageManager.hasPatternsInFlight())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,t)=>{const n=this.fragments[t];return n&&n.style&&(e.data=n.style.serialize()),e})}_serializeSources(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return e}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;if(this.hasSnowTransition())return!0;if(this.hasRainTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new e.z(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new e.z(new Error("The source '".concat(t,"' does not exist in the map's style."))))}precompilePrograms(e,t){const n=this.map.painter;if(n)for(let i=e.minzoom||0;i<(e.maxzoom||25.5);i++){const i=e.getProgramIds();if(i)for(const r of i){const i=e.getDefaultProgramParams(r,t.zoom,this._styleColorTheme.lut);i&&(n.style=this,this.fog&&(n._fogVisible=!0,i.overrideFog=!0,n.getOrCreateProgram(r,i)),n._fogVisible=!1,i.overrideFog=!1,n.getOrCreateProgram(r,i),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(i.overrideRtt=!0,n.getOrCreateProgram(r,i)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const i=this._changes.isDirty();let r=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:n,removedIds:i}=e[t];(n||i)&&(this._updateWorkerLayers(t,n,i),r=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const s={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];s[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const n=this._mergedLayers[e];if(n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)){const e=this.getLayerSourceCache(n);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,n.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(n,t)}):this.precompilePrograms(n,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&r&&this.mergeLayers();const a=this.imageManager.getPendingImageProviders();for(const e of a)e.sourceCache.used=!0;for(const o in s){const t=this._mergedSourceCaches[o];s[o]!==t.used&&t.getSource().fire(new e.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),i&&this.fire(new e.A("data",{dataType:"style"}))}updateImageProviders(){const e=this.imageManager.getPendingImageProviders();for(const t of e){const e=t.resolvePendingRequests(),n=this.getFragmentStyle(t.scope);n&&n.addImages(e)}}_updateTilesForChangedImages(){const e={};for(const t in this._mergedSourceCaches){const n=this._mergedSourceCaches[t].getSource().scope;e[n]=e[n]||this._changes.getUpdatedImages(n),0!==e[n].length&&this._mergedSourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e[n])}for(const t in e)this._changes.resetUpdatedImages(t)}_updateWorkerLayers(e,t,n){const i=this.getFragmentStyle(e);i&&this.dispatcher.broadcast("updateLayers",{layers:t?i._serializeLayers(t):[],scope:e,removedIds:n||[],options:i.options})}setState(t,n){if(this._checkLoaded(),ji(this,ve(t)))return!1;(t=e.di(t)).layers=Rt(t.layers);const i=function(t,n){if(!t)return[{command:Lt.setStyle,args:[n]}];let i=[];try{if(!e.bv(t.version,n.version))return[{command:Lt.setStyle,args:[n]}];if(e.bv(t.center,n.center)||i.push({command:Lt.setCenter,args:[n.center]}),e.bv(t.zoom,n.zoom)||i.push({command:Lt.setZoom,args:[n.zoom]}),e.bv(t.bearing,n.bearing)||i.push({command:Lt.setBearing,args:[n.bearing]}),e.bv(t.pitch,n.pitch)||i.push({command:Lt.setPitch,args:[n.pitch]}),e.bv(t.sprite,n.sprite)||i.push({command:Lt.setSprite,args:[n.sprite]}),e.bv(t.glyphs,n.glyphs)||i.push({command:Lt.setGlyphs,args:[n.glyphs]}),e.bv(t.imports,n.imports)||function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0;n=n||[];const r=(t=t||[]).map(Ut),s=n.map(Ut),a=t.reduce(Ht,{}),o=n.reduce(Ht,{}),l=r.slice();let c,d,u,h;for(c=0,d=0;c<r.length;c++)u=r[c],o.hasOwnProperty(u)?d++:(i.push({command:Lt.removeImport,args:[u]}),l.splice(l.indexOf(u,d),1));for(c=0,d=0;c<s.length;c++)u=s[s.length-1-c],l[l.length-1-c]!==u&&(a.hasOwnProperty(u)?(i.push({command:Lt.removeImport,args:[u]}),l.splice(l.lastIndexOf(u,l.length-d),1)):d++,h=l[l.length-c],i.push({command:Lt.addImport,args:[o[u],h]}),l.splice(l.length-c,0,u));for(const p of n){const t=a[p.id];t&&(delete t.data,e.bv(t,p)||i.push({command:Lt.updateImport,args:[p.id,p]}))}}(t.imports,n.imports,i),e.bv(t.transition,n.transition)||i.push({command:Lt.setTransition,args:[n.transition]}),e.bv(t.light,n.light)||i.push({command:Lt.setLight,args:[n.light]}),e.bv(t.fog,n.fog)||i.push({command:Lt.setFog,args:[n.fog]}),e.bv(t.snow,n.snow)||i.push({command:Lt.setSnow,args:[n.snow]}),e.bv(t.rain,n.rain)||i.push({command:Lt.setRain,args:[n.rain]}),e.bv(t.projection,n.projection)||i.push({command:Lt.setProjection,args:[n.projection]}),e.bv(t.lights,n.lights)||i.push({command:Lt.setLights,args:[n.lights]}),e.bv(t.camera,n.camera)||i.push({command:Lt.setCamera,args:[n.camera]}),e.bv(t.iconsets,n.iconsets)||function(t,n,i){let r;for(r in n=n||{},t=t||{})t.hasOwnProperty(r)&&(n.hasOwnProperty(r)||i.push({command:Lt.removeIconset,args:[r]}));for(r in n){if(!n.hasOwnProperty(r))continue;const s=n[r];t.hasOwnProperty(r)?e.bv(t[r],s)||(i.push({command:Lt.removeIconset,args:[r]}),i.push({command:Lt.addIconset,args:[r,s]})):i.push({command:Lt.addIconset,args:[r,s]})}}(t.iconsets,n.iconsets,i),!e.bv(t["color-theme"],n["color-theme"]))return[{command:Lt.setStyle,args:[n]}];const r={},s=[];!function(t,n,i,r){let s;for(s in n=n||{},t=t||{})t.hasOwnProperty(s)&&(n.hasOwnProperty(s)||Ot(s,i,r));for(s in n){if(!n.hasOwnProperty(s))continue;const a=n[s];t.hasOwnProperty(s)?e.bv(t[s],a)||("geojson"===t[s].type&&"geojson"===a.type&&Bt(t,n,s)?i.push({command:Lt.setGeoJSONSourceData,args:[s,a.data]}):Ft(s,n,i,r)):zt(s,n,i)}}(t.sources,n.sources,s,r);const a=[];t.layers&&t.layers.forEach(e=>{e.source&&r[e.source]?i.push({command:Lt.removeLayer,args:[e.id]}):a.push(e)});let o=t.terrain;o&&r[o.source]&&(i.push({command:Lt.setTerrain,args:[void 0]}),o=void 0),i=i.concat(s),e.bv(o,n.terrain)||i.push({command:Lt.setTerrain,args:[n.terrain]}),function(t,n,i){n=n||[];const r=(t=t||[]).map(Ut),s=n.map(Ut),a=t.reduce(Ht,{}),o=n.reduce(Ht,{}),l=r.slice(),c=Object.create(null);let d,u,h,p,m,f,g;for(d=0,u=0;d<r.length;d++)h=r[d],o.hasOwnProperty(h)?u++:(i.push({command:Lt.removeLayer,args:[h]}),l.splice(l.indexOf(h,u),1));for(d=0,u=0;d<s.length;d++)h=s[s.length-1-d],l[l.length-1-d]!==h&&(a.hasOwnProperty(h)?(i.push({command:Lt.removeLayer,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,f=l[l.length-d],i.push({command:Lt.addLayer,args:[o[h],f]}),l.splice(l.length-d,0,h),c[h]=!0);for(d=0;d<s.length;d++)if(h=s[d],p=a[h],m=o[h],!c[h]&&!e.bv(p,m))if(e.bv(p.source,m.source)&&e.bv(p["source-layer"],m["source-layer"])&&e.bv(p.type,m.type)){for(g in Vt(p.layout,m.layout,i,h,null,Lt.setLayoutProperty),Vt(p.paint,m.paint,i,h,null,Lt.setPaintProperty),e.bv(p.slot,m.slot)||i.push({command:Lt.setSlot,args:[h,m.slot]}),e.bv(p.filter,m.filter)||i.push({command:Lt.setFilter,args:[h,m.filter]}),e.bv(p.minzoom,m.minzoom)&&e.bv(p.maxzoom,m.maxzoom)||i.push({command:Lt.setLayerZoomRange,args:[h,m.minzoom,m.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Vt(p[g],m[g],i,h,g.slice(6),Lt.setPaintProperty):e.bv(p[g],m[g])||i.push({command:Lt.setLayerProperty,args:[h,g,m[g]]}));for(g in m)m.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Vt(p[g],m[g],i,h,g.slice(6),Lt.setPaintProperty):e.bv(p[g],m[g])||i.push({command:Lt.setLayerProperty,args:[h,g,m[g]]}))}else i.push({command:Lt.removeLayer,args:[h]}),f=l[l.lastIndexOf(h)+1],i.push({command:Lt.addLayer,args:[m,f]})}(a,n.layers,i)}catch(e){console.warn("Unable to compute style diff:",e),i=[{command:Lt.setStyle,args:[n]}]}return i}(this.serialize(),t).filter(e=>!(e.command in Si));if(0===i.length)return!1;const r=i.filter(e=>!(e.command in Ni));if(r.length>0)throw new Error("Unimplemented: ".concat(r.map(e=>e.command).join(", "),"."));const s=[];return i.forEach(e=>{s.push(this[e.command](...e.args))}),n&&Promise.all(s).then(n).catch(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(0===t.size)return this;for(const[n,i]of t.entries()){if(this.getImage(n))return this.fire(new e.z(new Error('An image with the name "'.concat(n.name,'" already exists.'))));this.imageManager.addImage(n,this.scope,i),this._changes.updateImage(n,this.scope)}return this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this}addImage(t,n){return this.getImage(t)?this.fire(new e.z(new Error('An image with the name "'.concat(t.name,'" already exists.')))):(this.imageManager.addImage(t,this.scope,n),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this)}updateImage(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.imageManager.updateImage(t,this.scope,n),i&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})))}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new e.A("data",{dataType:"style"})),this}addModel(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(Me,"models.".concat(t),n,null,i)||(this.modelManager.addModel(t,n,this.scope),this.fire(new e.A("data",{dataType:"style"}))),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error('There is already a source with ID "'.concat(t,'".'));if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(_e,"sources.".concat(t),n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=ct(t,n,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id}));const s=t=>{const n=(t?"symbol:":"other:")+r.id,i=e.C(n,this.scope),s=this._sourceCaches[n]=new Et(i,r,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=s,s.onAdd(this.map)};s(!1),"vector"!==n.type&&"geojson"!==n.type||s(!0),r.onAdd&&r.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===t)return this.fire(new e.z(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(r,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.z(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));if(this.stylesheet.iconsets){const n=Object.entries(this.stylesheet.iconsets).find(e=>{let[n,i]=e;return"source"===i.type&&i.source===t});if(n)return this.fire(new e.z(new Error('Source "'.concat(t,'" cannot be removed while iconset "').concat(n[0],'" is using it.'))))}const i=this.getOwnSourceCaches(t);for(const r of i){const t=e.dj(r.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(r.id),r.fire(new e.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const n=this.getOwnSourceCache(t);n&&e.push(n.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const s of t){if(this._validate(we,"lights",s))return;switch(s.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(s),e.updateTransitions(n)}else this.ambientLight=new Qe(s,Ye||(Ye=new e.a7({color:new e.a8(e.a5.properties_light_ambient.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(s),e.updateTransitions(n)}else this.directionalLight=new Qe(s,Ze||(Ze=new e.a7({direction:new e.an(e.a5.properties_light_directional.direction),color:new e.a8(e.a5.properties_light_directional.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_directional.intensity),"cast-shadows":new e.a8(e.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new e.a8(e.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.a8(e.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const i=Object.assign(n,{worldview:this.map.getWorldview()}),r=new e.aa(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const i=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),r=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),s=t.properties.get("intensity"),a=t.properties.get("direction"),o=1-e.d1(a.x,a.y,a.z)[2]/90,l=i(r)*s*o,c=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),d=n.properties.get("intensity"),u=i(c)*d;return Number(((l+u)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(null==t||""===t&&this.isRootStyle())return this;if(e.dk(t)){const n=e.dl(t),i=this.fragments.find(e=>{let{id:t}=e;return t===n});if(!i)return;const r=e.dj(t);return i.style.getFragmentStyle(r)}{const e=this.fragments.find(e=>{let{id:n}=e;return n===t});return e?e.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e,"::").concat(t)};this._featuresetSelectors={};for(const r in t){const s=this._featuresetSelectors[r]=[];for(const a of t[r].selectors){if(a.featureNamespace){const t=this.getOwnLayer(a.layer);if(!t){e.w("Layer is undefined for selector: ".concat(a.layer));continue}const s=i(t.source,t.sourceLayer);if(s in n&&n[s]!==a.featureNamespace){e.w('"featureNamespace '.concat(a.featureNamespace," of featureset ").concat(r,"'s selector is not associated to the same source, skip this selector"));continue}n[s]=a.featureNamespace}let t;if(a.properties)for(const n in a.properties){const i=e.X(a.properties[n]);"success"===i.result&&(t=t||{},t[n]=i.value)}s.push({layerId:a.layer,namespace:a.featureNamespace,properties:t,uniqueFeatureID:a._uniqueFeatureID})}}}getFeaturesetDescriptors(e){const t=this.getFragmentStyle(e);if(!t||!t.stylesheet.featuresets)return[];const n=[];for(const i in t.stylesheet.featuresets)n.push({featuresetId:i,importId:t.scope?t.scope:void 0});return n}getFeaturesetLayers(t,n){const i=this.getFragmentStyle(n),r=i.stylesheet.featuresets;if(!r||!r[t])return this.fire(new e.z(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried.")))),[];const s=[];for(const e of r[t].selectors){const t=i.getOwnLayer(e.layer);t&&s.push(t)}return s}getConfigProperty(t,n){const i=this.getFragmentStyle(t);if(!i)return null;const r=e.C(n,i.scope),s=i.options.get(r),a=s?s.value||s.default:null;return a?a.serialize():null}setConfigProperty(t,n,i){const r=this.getFragmentStyle(t);if(!r)return;const s=r.stylesheet.indoor?yi(r.stylesheet.schema):r.stylesheet.schema;if(!s||!s[n])return;const a=e.X(i);if("success"!==a.result)return void ji(this,a.value);const o=a.value.expression,l=e.C(n,r.scope),c=r.options.get(l);if(!c)return;let d;const{minValue:u,maxValue:h,stepValue:p,type:m,values:f}=s[n],g=e.X(s[n].default);"success"===g.result&&(d=g.value.expression),d?(this.options.set(l,Object.assign({},c,{value:o,default:d,minValue:u,maxValue:h,stepValue:p,type:m,values:f})),this.updateConfigDependencies(n)):this.fire(new e.z(new Error('No schema defined for the config option "'.concat(n,'" in the "').concat(t,'" fragment.'))))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const i=n.stylesheet.schema;if(!i)return null;const r={};for(const s in i){const t=e.C(s,n.scope),i=n.options.get(t),a=i?i.value||i.default:null;r[s]=a?a.serialize():null}return r}setConfig(e,t){const n=this.getFragmentStyle(e);n&&(n.updateConfig(t,n.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const n=this.getFragmentStyle(e);n&&(n.stylesheet.schema=t,n.updateConfig(n._config,t),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const i in n){let r,s;const a=e.X(n[i].default);if("success"===a.result&&(r=a.value.expression),t&&void 0!==t[i]){const n=e.X(t[i]);"success"===n.result&&(s=n.value.expression)}const{minValue:o,maxValue:l,stepValue:c,type:d,values:u}=n[i];if(r){const t=e.C(i,this.scope);this.options.set(t,{default:r,value:s,minValue:o,maxValue:l,stepValue:c,type:d,values:u})}else this.fire(new e.z(new Error('No schema defined for config option "'.concat(i,'".'))))}else this.fire(new e.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(e){for(const t of this._configDependentLayers){const n=this.getLayer(t);if(n){if(e&&!n.configDependencies.has(e))continue;n.possiblyEvaluateVisibility(),this._updateLayer(n)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(e=>{const t=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(t){const n=e._evaluateColorThemeData(t);(!e._styleColorTheme.lut&&""!==n||e._styleColorTheme.lut&&n!==e._styleColorTheme.lut.data)&&e.setColorTheme(t)}}),this._changes.setDirty()}addLayer(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=t.id;if(this._layers[r])return void this.fire(new e.z(new Error('Layer with id "'.concat(r,'" already exists on this map'))));let s;if("custom"===t.type){if(ji(this,e.dm(t)))return;s=e.dn(t,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.di(t),t=e.h(t,{source:r})),this._validate(Te,"layers.".concat(r),t,{arrayIndex:-1},i))return;s=e.dn(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(s),s.setEventedParent(this,{layer:{id:r}})}0!==s.configDependencies.size&&this._configDependentLayers.add(s.fqid);let a=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.z(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));s.slot===this._layers[n].slot?a=t:e.w('Layer with id "'.concat(n,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(a,0,r),this._layerOrderChanged=!0,this._layers[r]=s;const o=this.getOwnLayerSourceCache(s),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();o&&s.canCastShadows()&&l&&(o.castsShadows=!0);const c=this._changes.getRemovedLayer(s);if(c&&s.source&&o&&"custom"!==s.type){this._changes.discardLayerRemoval(s);const t=e.C(s.source,s.scope);c.type!==s.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),o.pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),s.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;if(t===n)return;const r=this._order.indexOf(t);this._order.splice(r,1);let s=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.z(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));i.slot===this._layers[n].slot?s=t:e.w('Layer with id "'.concat(n,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(s,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const i=this.getOwnLayerSourceCache(t);if(i&&i.castsShadows){let e=!1;for(const n in this._layers)if(this._layers[n].source===t.source&&this._layers[n].canCastShadows()){e=!0;break}i.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,n){this._checkLoaded();const i=this._checkLayer(e);i&&(i.minzoom===t&&i.maxzoom===n||(null!=t&&(i.minzoom=t),null!=n&&(i.maxzoom=n),this._updateLayer(i)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const n=this._checkLayer(e);n&&n.slot!==t&&(n.slot=t,this._updateLayer(n))}setFilter(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=this._checkLayer(t);if(r&&!e.bv(r.filter,n))return null==n?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(Ce,"layers.".concat(r.id,".filter"),n,{layerType:r.type},i)||(r.filter=e.di(n),this._updateLayer(r)))}getFilter(t){const n=this._checkLayer(t);if(n)return e.di(n.filter)}setLayoutProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const s=this._checkLayer(t);if(s&&!e.bv(s.getLayoutProperty(n),i)){if(null!=i&&(!r||!1!==r.validate)&&ji(s,Ae.call(ve,{key:"layers.".concat(t,".layout.").concat(n),layerType:s.type,objectKey:n,value:i,styleSpec:e.a5,style:{glyphs:!0,sprite:!0}})))return;s.setLayoutProperty(n,i),0!==s.configDependencies.size&&this._configDependentLayers.add(s.fqid),this._updateLayer(s)}}getLayoutProperty(e,t){const n=this._checkLayer(e);if(n)return n.getLayoutProperty(t)}setPaintProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const s=this._checkLayer(t);if(!s)return;if(e.bv(s.getPaintProperty(n),i))return;if(null!=i&&(!r||!1!==r.validate)&&ji(s,Ee.call(ve,{key:"layers.".concat(t,".paint.").concat(n),layerType:s.type,objectKey:n,value:i,styleSpec:e.a5})))return;const a=s.setPaintProperty(n,i);0!==s.configDependencies.size&&this._configDependentLayers.add(s.fqid),a&&this._updateLayer(s),this._changes.updatePaintProperties(s)}getPaintProperty(e,t){const n=this._checkLayer(e);if(n)return n.getPaintProperty(t)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:i}=t.target,r=this.getFragmentStyle(i),s=r.getFeaturesetLayers(e);for(const{source:a,sourceLayer:o}of s)r.setFeatureState({id:t.id,source:a,sourceLayer:o},n)}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);this.setFeatureState({id:t.id,source:i.source,sourceLayer:i.sourceLayer},n)}return}const i=t.source,r=t.sourceLayer,s=this._checkSource(i);if(!s)return;const a=s.type;if("geojson"===a&&r)return void this.fire(new e.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!r)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided.")));const o=this.getOwnSourceCaches(i);for(const e of o)e.setFeatureState(r,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:i}=t.target,r=this.getFragmentStyle(i),s=r.getFeaturesetLayers(e);for(const{source:a,sourceLayer:o}of s)r.removeFeatureState({id:t.id,source:a,sourceLayer:o},n)}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);this.removeFeatureState({id:t.id,source:i.source,sourceLayer:i.sourceLayer},n)}return}const i=t.source,r=this._checkSource(i);if(!r)return;const s=r.type,a="vector"===s?t.sourceLayer:void 0;if("vector"===s&&!a)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.z(new Error("A feature id is required to remove its specific state property.")));const o=this.getOwnSourceCaches(i);for(const e of o)e.removeFeatureState(a,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let n;if("featuresetId"in t.target){const{featuresetId:i,importId:r}=t.target,s=this.getFragmentStyle(r),a=s.getFeaturesetLayers(i);for(const{source:o,sourceLayer:l}of a){const i=s.getFeatureState({id:t.id,source:o,sourceLayer:l});if(i&&!n)n=i;else if(!e.bv(n,i))return void this.fire(new e.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);n=this.getFeatureState({id:t.id,source:i.source,sourceLayer:i.sourceLayer})}return n}const n=t.source,i=t.sourceLayer,r=this._checkSource(n);if(r){if("vector"!==r.type||i)return void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,t.id);this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateFilteredLayers(e){for(const t of Object.values(this._mergedLayers))e(t)&&this._updateLayer(t)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),i=e.C(t.source,t.scope),r=this._changes.getUpdatedSourceCaches();t.source&&!r[i]&&n&&"raster"!==n.getSource().type&&(this._changes.updateSourceCache(i,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>this._mergedLayers[e].is3D(!!this.terrain),n=this.order,i={},r=[];for(let a=n.length-1;a>=0;a--){const s=n[a];if(t(s)){i[s]=a;for(const t of e){const e=t[s];if(e)for(const t of e)r.push(t)}}}r.sort((e,t)=>t.intersectionZ-e.intersectionZ);const s=[];for(let a=n.length-1;a>=0;a--){const o=n[a];if(t(o))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(t.layer&&i[t.layer.id]<a)break;s.push(t),r.pop()}else for(const t of e){const e=t[o];if(e)for(const t of e)s.push(t.feature)}}return s}queryRenderedFeatures(t,n,i){let r;n&&!Array.isArray(n)&&n.filter&&(this._validate(Ce,"queryRenderedFeatures.filter",n.filter,null,n),r=e.b3(n.filter));const s={},a=e=>{if(ki.has(e.type))return;const t=this.getOwnLayerSourceCache(e),n=s[t.id]=s[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(n.has3DLayers=!0),n.layers[e.fqid]=n.layers[e.fqid]||{styleLayer:e,targets:[]},n.layers[e.fqid].targets.push({filter:r})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.z(new Error("parameters.layers must be an Array."))),[];for(const t of n.layers){const n=this._layers[t];if(!n)return this.fire(new e.z(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];a(n)}}else for(const e in this._layers)a(this._layers[e]);const o=this._queryRenderedFeatures(t,s,i),l=this._flattenAndSortRenderedFeatures(o),c=[];for(const d of l)e.dq(d.layer.id)===this.scope&&c.push(d);return c}queryRenderedFeatureset(t,n,i){let r;n&&!Array.isArray(n)&&n.filter&&(this._validate(Ce,"queryRenderedFeatures.filter",n.filter,null,n),r=e.b3(n.filter));const s="mock",a=[];if(n&&n.target)a.push(Object.assign({},n,{targetId:s,filter:r}));else{const e=this.getFeaturesetDescriptors();for(const t of e)a.push({targetId:s,filter:r,target:t});for(const{style:t}of this.fragments){const e=t.getFeaturesetDescriptors();for(const t of e)a.push({targetId:s,filter:r,target:t})}}const o=this.queryRenderedTargets(t,a,i),l=[],c=new Set;for(const d of o)for(const t of d.variants[s])ut(t,d,c)||l.push(new e.dr(d,t));return l}queryRenderedTargets(t,n,i){const r={},s=(e,t,n,i)=>{const s=r[t.id]=r[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};if(s.layers[e.fqid]=s.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(s.has3DLayers=!0),!i)return n.uniqueFeatureID=!1,void s.layers[e.fqid].targets.push(n);s.layers[e.fqid].targets.push(Object.assign({},n,{namespace:i.namespace,properties:i.properties,uniqueFeatureID:i.uniqueFeatureID}))};for(const o of n)if("featuresetId"in o.target){const{featuresetId:t,importId:n}=o.target,i=this.getFragmentStyle(n);if(!i||!i._featuresetSelectors)continue;const r=i._featuresetSelectors[t];if(!r){this.fire(new e.z(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried for features."))));continue}for(const e of r){const t=i.getOwnLayer(e.layerId);t&&!ki.has(t.type)&&s(t,i.getOwnLayerSourceCache(t),o,e)}}else if("layerId"in o.target){const{layerId:e}=o.target,t=this.getLayer(e);if(!t||ki.has(t.type))continue;s(t,this.getLayerSourceCache(t),o)}const a=this._queryRenderedFeatures(t,r,i);return this._flattenAndSortRenderedFeatures(a)}_queryRenderedFeatures(e,t,n){const i=[],r=!!this.map._showQueryGeometry,s=Je.createFromScreenPoints(e,n);for(const a in t){const e=ht(s,t[a],this._availableImages,n,r);Object.keys(e).length&&i.push(e)}if(this.placement)for(const a in t){if(!t[a].sourceCache._onlySymbols)continue;const e=pt(s.screenGeometry,t[a],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(e).length&&i.push(e)}return i}querySourceFeatures(e,t){const n=t&&t.filter;n&&this._validate(Ce,"querySourceFeatures.filter",n,null,t);let i=[];const r=this.getOwnSourceCaches(e);for(const s of r)i=i.concat(mt(s,t));return i}addSourceType(e,t,n){return Ei.getSourceType(e)?n(new Error('A source type called "'.concat(e,'" already exists.'))):(Ei.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=this.light.getLight();let s=!1;for(const o in t)if(!e.bv(t[o],r[o])){s=!0;break}if(!s)return;const a=this._getTransitionParameters();this.light.setLight(t,n,i),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===n&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let i=t;const r=null==t.source;if(1===n){if(this.disableElevatedTerrain)return;if("object"==typeof i.source){const t="terrain-dem-src";this.addSource(t,i.source),i=e.di(i),i=e.h(i,{source:t})}const t=e.h({},i),n={};if(this.terrain&&r){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(n.style=e.serialize())}if(this._validate(je,"terrain",t,n))return}if(!this.terrain||this.terrain.scope!==this.scope&&!r||this.terrain&&n!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,n),this.fire(new e.A("data",{dataType:"style"}))}else{const n=this.terrain,r=n.get();for(const t of Object.keys(e.a5.terrain))!i.hasOwnProperty(t)&&e.a5.terrain[t].default&&(i[t]=e.a5.terrain[t].default);for(const i in t)if(!e.bv(t[i],r[i])){n.set(t,this.options),this.stylesheet.terrain=t;const i=this._getTransitionParameters({duration:0});n.updateTransitions(i),this.fire(new e.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new qe(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_createSnow(e){const t=this.snow=new Xe(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_createRain(e){const t=this.rain=new Ke(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const i=this._evaluateColorThemeData(n);this._loadColorTheme(i).then(()=>{this.fire(new e.A("colorthemeset")),t()}).catch(t=>{e.w("Couldn't set color theme: ".concat(t))})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(e,t){const n=this.getFragmentStyle(e);n&&(n._styleColorTheme.colorThemeOverride=t,n._reloadColorTheme())}_getTransitionParameters(t){return{now:e.q.now(),transition:e.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const n of this._mergedOrder)this.isLayerDraped(this._mergedLayers[n])?e.push(n):t.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const n=this.terrain=new Le(e,t,this.scope,this.options,this.map.getWorldview());1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,n,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(s&&!1===s.validate)return!1;const a=e.h({},this.serialize());return ji(this,t.call(ve,e.h({key:n,style:a,value:i,styleSpec:e.a5},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const n of t)n.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}clearLayers(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];t._clear&&t._clear()}}reloadSource(e){const t=this.getSourceCaches(e);for(const n of t)n.resume(),n.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(e=>{e.modelManager.reloadModels(e.scope)})}updateSources(e){let t;this.directionalLight&&(t=di(this.directionalLight));const n=new Set;for(const i in this._mergedLayers){const e=this._mergedLayers[i];e.hasElevation()&&!n.has(e.source)&&n.add(e.source)}for(const i in this._mergedSourceCaches){const r=this._mergedSourceCaches[i],s=n.has(r._source.id);r.update(e,void 0,void 0,t,s)}}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,n,i,r,s,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!1,c=!1;const d={},u={};for(const h of this._mergedOrder){const t=this._mergedLayers[h];if("symbol"!==t.type)continue;const i=e.C(t.source,t.scope);let r=d[i];if(!r){const e=this.getLayerSourceCache(t);if(!e)continue;const n=e.getRenderableIds(!0).map(t=>e.getTileByID(t));u[i]=n.slice(),r=d[i]=n.sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const s=this.crossTileSymbolIndex.addLayer(t,r,n.center.lng,n.projection);l=l||s}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),o=o||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new e.A("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.q.now(),n.zoom))&&(this.pauseablePlacement=new Rn(n,this._mergedOrder,o,i,r,s,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,d,u,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.q.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(n.zoom);for(let t=0;t<this._mergedOrder.length;t++){const n=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==n.type)continue;const i=this.isLayerClipped(n);this.placement.updateLayerOpacities(n,d[e.C(n.source,n.scope)],t,i?a:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.q.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const i=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==i.findIndex(e=>{let{id:n}=e;return n===t.id}))return void this.fire(new e.z(new Error("Import with id '".concat(t.id,"' already exists in the map's style."))));if(!n)return i.push(t),this._loadImports([t],!0);const r=i.findIndex(e=>{let{id:t}=e;return t===n});return-1===r&&this.fire(new e.z(new Error('Import with id "'.concat(n,'" does not exist on this map.')))),this.stylesheet.imports=i.slice(0,r).concat(t).concat(i.slice(r)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(t);return-1===r?this:"string"==typeof n?(this.setImportUrl(t,n),this):(n.url&&n.url!==i[r].url&&this.setImportUrl(t,n.url),e.bv(n.config,i[r].config)||this.setImportConfig(t,n.config,n.data.schema),e.bv(n.data,i[r].data)||this.setImportData(t,n.data),this)}moveImport(e,t){this._checkLoaded();let n=this.stylesheet.imports||[];const i=this.getImportIndex(e);if(-1===i)return this;const r=this.getImportIndex(t);if(-1===r)return this;const s=n[i],a=this.fragments[i];return n=n.filter(t=>{let{id:n}=t;return n!==e}),this.fragments=this.fragments.filter(t=>{let{id:n}=t;return n!==e}),this.stylesheet.imports=n.slice(0,r).concat(s).concat(n.slice(r)),this.fragments=this.fragments.slice(0,r).concat(a).concat(this.fragments.slice(r)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);if(-1===i)return this;n[i].url=t;const r=this.fragments[i];return r.style=this._createFragmentStyle(n[i]),r.style.on("style.import.load",()=>this.mergeAll()),r.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];return-1===n?this:t?(this.fragments[n].style.setState(t),this._reloadImports(),this):(delete i[n].data,this.setImportUrl(e,i[n].url))}setImportConfig(e,t,n){this._checkLoaded();const i=this.getImportIndex(e),r=this.stylesheet.imports||[];if(-1===i)return this;t?r[i].config=t:delete r[i].config;const s=this.fragments[i];n&&s.style.stylesheet&&(s.style.stylesheet.schema=n);const a=s.style.stylesheet&&s.style.stylesheet.schema;return s.config=t,s.style.updateConfig(t,a),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],n=this.getImportIndex(e);-1!==n&&(t.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(e=>e.id===t);return-1===n&&this.fire(new e.z(new Error("Import '".concat(t,"' does not exist in the map's style and cannot be updated.")))),n}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const n=this._mergedOtherSourceCaches[t];n&&e.push(n.getSource())}return e}getSource(e,t){const n=this.getSourceCache(e,t);return n&&n.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,n){const i=e.C(t,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(t){const n=e.C(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const n=e[t];"reload"===n?this.reloadSource(t):"clear"===n&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const n of t){const t=this.getLayer(n);t&&t.updateTransitions(e)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e)}getImages(t,n,i){this.imageManager.getImages(n.images,n.scope,i),this._updateTilesForChangedImages();const r=t=>{if(t){const i=n.images.map(t=>e.I.toString(t));t.setDependencies(n.tileID.key,n.type,i)}},s=e.C(n.source,n.scope);r(this._mergedOtherSourceCaches[s]),r(this._mergedSymbolSourceCaches[s]),n.images.some(e=>e.iconsetId)&&this.fire(new e.A("data",{dataType:"style"}))}rasterizeImages(e,t,n){this.imageManager.rasterizeImages(t,n)}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)}getResource(t,n,i){return e.dt(n,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return 0===n.length?(this.fire(new e.z(new Error("There is no source with ID '".concat(t,"'")))),!1):n.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,t){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type&&"building"!==e.type)return!1;const n="fill-extrusion"===e.type&&("building"===e.sourceLayer||"procedural_buildings"===e.sourceLayer),i="building"===e.type;if(e.is3D(!!this.terrain)){if(n||i||t&&"batched-model"===t.type)return!0;if("model"===e.type)return!0}else if("symbol"===e.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(e=>{e.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ei.getSourceType=function(e){return lt[e]},Ei.setSourceType=function(e,t){lt[e]=t},Ei.registerForPluginStateChange=e.du;var Ai="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Mi="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Di="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Ii="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pi="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",Ri="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Li="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",zi="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Oi="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Fi="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Bi="#ifdef RENDER_SHADOWS\nprecision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {\n#ifdef CLIP_ZERO_TO_ONE\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);\n#else\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);\n#endif\nreturn texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;\n#ifdef SHADOWS_SINGLE_CASCADE\nvec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);\n#else\nlight_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Vi=[];Yi(Ai,Vi),Yi(Di,Vi),Yi(Mi,Vi);const Ui={"_prelude_fog.vertex.glsl":Ri,"_prelude_terrain.vertex.glsl":Pi,"_prelude_shadow.vertex.glsl":Fi,"_prelude_fog.fragment.glsl":Li,"_prelude_shadow.fragment.glsl":Bi,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":zi,"_prelude_raster_particle.glsl":Oi},Hi={};Zi("",Pi),Zi(Li,Ri),Zi(Bi,Fi),Zi(zi,""),Zi(Oi,"");const qi=Zi(Mi,Di),Wi=Ai;var Gi={background:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nconst float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nin lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;\n#endif\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\nuniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}\n#ifdef BUILDING_FAUX_FACADE\nfloat hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;\n#if 0\nif (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;\n#else\nif (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;\n#endif\nreturn out_color;}\n#endif\nvec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;\n#ifdef BUILDING_FAUX_FACADE\nif (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}\n#endif\nvec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nshadowed_lighting_factor=dot(normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));\n#endif\ncolor.rgb=linearTosRGB(color.rgb);color*=u_opacity;\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_pos.z);\n#endif\nglFragColor=color; \n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nout lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nconst float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#ifdef BUILDING_FAUX_FACADE\nmat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}\n#endif\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;\n#ifdef BUILDING_FAUX_FACADE\nv_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}\n#endif\nv_pos=a_pos_3f;\n#ifdef RENDER_CUTOFF\nvec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=v_pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(v_pos);\n#endif\ngl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}'),buildingBloom:Zi("in vec4 v_color_emissive;\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\nfloat saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;\n#ifdef HAS_ATTRIBUTE_a_bloom_attenuation\nfloat distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);\n#endif\nglFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}","in vec3 a_pos_3f;\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\nout vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\n#ifdef HAS_ATTRIBUTE_a_part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);\n#else\nv_color_emissive=vec4(1.0);\n#endif\ngl_Position=u_matrix*vec4(a_pos_3f,1.0);}"),buildingDepth:Zi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Zi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zi('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Zi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;\n#endif\nout float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);\n#ifdef PROJECTION_GLOBE_VIEW\n#ifndef PROJECTED_POS_ON_VIEWPORT\nvec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);\n#endif\n#endif\nvec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Zi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:Zi("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Zi("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)\n{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nvec3 color=structure_color.xyz;\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,transformed_normal);\n#endif\ncolor=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nv_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef FLIP_Y\nv_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FLIP_Y\nv_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\n#ifdef CLIP_ZERO_TO_ONE\ncutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);\n#else\ncutoff=cutoff_opacity(u_cutoff_params,ground.z);\n#endif\nif (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Zi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Zi('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Zi("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Zi("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Zi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Zi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Zi('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Zi('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef TERRAIN\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#else\nout_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n}'),terrainRaster:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Zi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Zi('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Ii),skyboxGradient:Zi('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Ii),skyboxCapture:Zi("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Zi('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\n#ifdef FLIP_Y\nT=-T;B=-B;\n#endif\nhighp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));\n#ifdef FLIP_Y\nn=normalize(cross(fdx,fdy));\n#else\nn=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\n#ifdef FEATURE_CUTOUT\nfinalColor=apply_feature_cutout(finalColor,gl_FragCoord);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Zi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Zi("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:Zi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:Zi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:Zi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Zi("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Yi(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=i.split(" ");for(const n of e)t.includes(n)||t.push(n)}}function Zi(e,t){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map(e=>{const t=e.split(" ");return t[t.length-1]}),r=[...new Set(r)]);const s={},a=[],o=[];if(e=e.replace(n,(e,t)=>(o.push(t),"")),(t=t.replace(n,(e,t)=>(a.push(t),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Vi];Yi(e,l),Yi(t,l);for(const c of[...a,...o])Ui[c]||console.error("Undefined include: ".concat(c)),Hi[c]||(Hi[c]=[],Yi(Ui[c],Hi[c])),l=[...l,...Hi[c]];return{fragmentSource:e=e.replace(i,(e,t,n,i,r)=>(s[r]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nin ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"":void 0)),vertexSource:t=t.replace(i,(e,t,n,i,r)=>{const a="float"===i?"vec2":i,o=r.match(/color/)?"color":a;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\nin ").concat(n," ").concat(i," a_").concat(r,";\n#endif\n"):s[r]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\nout ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = unpack_mix_").concat(o,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," a_").concat(r,";\n    out ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"define-instanced"===t?"mat4"===o?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(r,"0;\nin vec4 a_").concat(r,"1;\nin vec4 a_").concat(r,"2;\nin vec4 a_").concat(r,"3;\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(n," ").concat(a," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#endif\n"):"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = unpack_mix_").concat(o,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n")}),staticAttributes:r,usedDefines:l,vertexIncludes:a,fragmentIncludes:o}}class Xi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,n,i,r,s,a,o){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let d=0;!l&&d<i.length;d++)this.boundPaintVertexBuffers[d]!==i[d]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==a.length;for(let d=0;!c&&d<a.length;d++)this.boundDynamicVertexBuffers[d]!==a[d]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==s)this.freshBind(t,n,i,r,s,a,o);else{e.bindVertexArrayOES.set(this.vao);for(const n of a)n&&(n.bind(),o&&n.instanceCount&&n.setVertexAttribDivisor(e.gl,t,o));r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,n,i,r,s,a){const o=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=s,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const d of n)d.enableAttributes(c,e),d.bind(),d.setVertexAttribPointers(c,e,r);for(const d of s)d&&(d.enableAttributes(c,e),d.bind(),d.setVertexAttribPointers(c,e,r),a&&d.instanceCount&&d.setVertexAttribDivisor(c,e,a));i&&i.bind(),l.currentNumAttributes=o}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ki(t,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.ac(0,r/i).toLngLat().lat,new e.ac(0,(r+1)/i).toLngLat().lat]}function Qi(t,n,i,r,s,a,o){const l=t.context,c=l.gl,d=i.hillshadeFBO;if(!d)return;t.prepareDrawTile();const u=t.isTileAffectedByFog(n),h=t.getOrCreateProgram("hillshade",{overrideFog:u});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,d.colorAttachment.get());const p=((t,n,i,r)=>{const s=i.paint.get("hillshade-shadow-color"),a="none"===i.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),o=i.paint.get("hillshade-highlight-color"),l="none"===i.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),c=i.paint.get("hillshade-accent-color"),d="none"===i.paint.get("hillshade-accent-color-use-theme").constantOr("default"),u=i.paint.get("hillshade-emissive-strength");let h=e.al(i.paint.get("hillshade-illumination-direction"));if("viewport"===i.paint.get("hillshade-illumination-anchor"))h-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const n=t.style.directionalLight.properties.get("direction"),i=e.d1(n.x,n.y,n.z);h=e.al(i[1])}const p=!t.options.moving;return{u_matrix:r||t.transform.calculateProjMatrix(n.tileID.toUnwrapped(),p),u_image:0,u_latrange:Ki(0,n.tileID),u_light:[i.paint.get("hillshade-exaggeration"),h],u_shadow:s.toPremultipliedRenderColor(a?null:i.lut),u_highlight:o.toPremultipliedRenderColor(l?null:i.lut),u_emissive_strength:u,u_accent:c.toPremultipliedRenderColor(d?null:i.lut)}})(t,i,r,t.terrain?n.projMatrix:null);t.uploadCommonUniforms(l,h,n.toUnwrapped());const{tileBoundsBuffer:m,tileBoundsIndexBuffer:f,tileBoundsSegments:g}=t.getTileBoundsBuffers(i);h.draw(t,c.TRIANGLES,s,a,o,Zn.disabled,p,r.id,m,f,g)}function Ji(t,n,i){if(!n.needsDEMTextureUpload)return;const r=t.context,s=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(i.stride);const a=i.getPixels();n.demTexture?n.demTexture.update(a,{premultiply:!1}):n.demTexture=new e.T(r,a,s.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function $i(t,n,i){const r=t.context,s=r.gl;if(!n.dem)return;const a=n.dem;if(r.activeTexture.set(s.TEXTURE1),Ji(t,n,a),!n.demTexture)return;n.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE);const o=a.dim;r.activeTexture.set(s.TEXTURE0);let l=n.hillshadeFBO;if(!l){const t=new e.T(r,{width:o,height:o,data:null},s.RGBA8);t.bind(s.LINEAR,s.CLAMP_TO_EDGE),l=n.hillshadeFBO=r.createFramebuffer(o,o,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}r.bindFramebuffer.set(l.framebuffer),r.viewport.set([0,0,o,o]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:d,tileBoundsSegments:u}=t.getMercatorTileBoundsBuffers(),h=[];t.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(t,s.TRIANGLES,Hn.disabled,Wn.disabled,Un.unblended,Zn.disabled,((t,n)=>{const i=n.stride,r=e.bz();return e.ca(r,0,e.aj,-e.aj,0,0,1),e.bo(r,r,[0,-e.aj,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ}})(n.tileID,a),i.id,c,d,u),n.needsHillshadePrepare=!1}class er{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class tr extends er{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nr extends er{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ir extends er{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class rr extends er{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class sr extends er{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ar extends er{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class or extends er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class lr extends er{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class cr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class dr extends er{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ur extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class hr extends er{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class pr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class mr extends er{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class fr extends er{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class gr extends er{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class xr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class yr extends er{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class vr extends er{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let _r=class extends er{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class br extends er{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class wr extends er{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class jr extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Nr extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Sr extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class kr extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Tr extends er{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Cr extends er{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class Er extends er{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ar extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Mr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Dr extends er{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Ir extends Dr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Pr extends Dr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Rr extends Dr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Lr extends Pr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const zr=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),Or=(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:r,u_merc_center:s,u_image0:0,u_frustum_tl:a,u_frustum_tr:o,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:d,u_globe_radius:u,u_viewport:h,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:m});function Fr(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const Br=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Vr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ur(e,t,n){if(0===t)return 0;const i=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*i}function Hr(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const qr=e=>({u_matrix:e});function Wr(t,n,i,r,s){if(s>0){const a=e.q.now(),o=(a-t.timeAdded)/s,l=n?(a-n.timeAdded)/s:-1,c=i.getSource(),d=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),u=!n||Math.abs(n.tileID.overscaledZ-d)>Math.abs(t.tileID.overscaledZ-d),h=u&&t.refreshedUponExpiration?1:e.ay(u?o:1-l,0,1);return t.refreshedUponExpiration&&o>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}class Gr extends Et{constructor(e){const t=ct("mock-dem",{type:"raster-dem",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Yr extends Et{constructor(e){const t=ct("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,n){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((t,n)=>{if(t[n.key]="",!this._tiles[n.key]){const t=new St(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom,void 0,void 0,this._source.worldview);t.state="loaded",this._tiles[n.key]=t}return t},{});for(const r in this._tiles)r in i||(this.freeFBO(r),this._tiles[r].unloadVectorData(),delete this._tiles[r])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zr extends e.aM{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class Xr extends e.dF{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,r,s]=function(){const t=new e.ba,n=new e.a_,i=131;t.reserve(17161),n.reserve(33800);const r=e.aj/128,s=e.aj+r/2,a=s+r;for(let l=-r;l<a;l+=r)for(let n=-r;n<a;n+=r){const i=n<0||n>s||l<0||l>s?24575:0,r=e.ay(Math.round(n),0,e.aj),a=e.ay(Math.round(l),0,e.aj);t.emplaceBack(r+i,a)}const o=(e,t)=>{const r=t*i+e;n.emplaceBack(r+1,r,r+i),n.emplaceBack(r+i,r+i+1,r+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)o(t,e);return[0,129].forEach(e=>{for(let t=0;t<130;t++)o(t,e),o(e,t)}),[t,n,32768]}(),a=t.context;this.gridBuffer=a.createVertexBuffer(i,e.bc.members),this.gridIndexBuffer=a.createIndexBuffer(r),this.gridSegments=e.bd.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=e.bd.simpleSegment(0,0,i.length,s),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Yr(n.map),this.orthoMatrix=e.bz(),e.ca(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.aj,0,e.aj,0,1);const o=a.gl;this._overlapStencilMode=new Wn({func:o.GEQUAL,mask:255},0,255,o.KEEP,o.KEEP,o.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gr(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,i){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const r=t.terrain.properties,s=0===t.terrain.drapeRenderMode,a=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.q.now();const o=t.terrain&&t.terrain.scope,l=r.get("source"),c=s?this._mockSourceCache:t.getSourceCache(l,o);if(!c)return void e.w("Couldn't find terrain source \"".concat(l,'".'));if(this.sourceCache=c,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=a?this.calculateExaggeration(n):r.get("exaggeration"),!n.projection.requiresDraping&&a&&0===this._exaggeration)return void this._disable();this.enabled=!0;const d=()=>{this.sourceCache.used&&e.w("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const t=this.getScaledDemTileSize();this.sourceCache.update(n,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,d(),this._initializing=!0),d(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,i=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=i;const r=null!=n?i-n:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const s=t.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(s);let o=s-this._previousZoom;const l=this._previousUpdateTimestamp;let c=s;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(s-c)>.5&&(o=.5*(s-c+o)),o*r<0&&(c+=o)),this._evaluationZoom=c;const d=a.getExaggeration(c),u=d===a.getExaggeration(Math.max(0,c-.1));if(u&&Math.abs(d-this._exaggeration)<.01)return d;let h=Math.min(.1,.00375*(this._updateTimestamp-l));return(u||d<.1||Math.abs(o)<1e-4)&&(h=Math.min(.2,4*h)),e.ai(this._exaggeration,d,h)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(e.ac.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=n.getIds().map(e=>{const t=n.getTileByID(e).tileID;return t.projMatrix=i.calculateProjMatrix(t.toUnwrapped()),t});!function(t,n){const i=n.transform.pointCoordinate(n.transform.getCameraPoint()),r=new e.P(i.x,i.y);t.sort((t,n)=>{if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;const i=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),s=new e.P(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),a=r.mult(1<<t.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(i)-a.distSqr(s)})}(r,this.painter);const s=this.proxyToSource||{};this.proxyToSource={},r.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const e in a){const n=a[e];if(!n.used)continue;if(n!==this.sourceCache&&this.resetTileLookupCache(n.id),this._setupProxiedCoordsForOrtho(n,t[e],s),n.usedForTerrain)continue;const i=t[e];n.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[n.id]=r.map(e=>new Zr(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(s),this.renderingToTexture=!1;const o={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const n=t.tileID.key;n in o||(this._visibleDemTiles.push(t),o[n]=n)}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Ji(this.painter,i,r))}}_prepareDemTileUniforms(e,t,n,i){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,s=Math.pow(2,t.tileID.canonical.z-r.z),a=i||"";return n["u_dem_tl".concat(a)]=[r.x*s%1,r.y*s%1],n["u_dem_scale".concat(a)]=s,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce((t,n)=>{if(!n.dem)return t;const i=n.dem.tree.minimums[0];return i>0&&e++,t+i},0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),r=new e.dG({width:1,height:1},new Float32Array([i]));this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(r,{premultiply:!1}):s=this._emptyDEMTexture=new e.T(t,r,n.R32F,{premultiply:!1}),s}setupElevationDraw(t,n,i){const r=this.painter.context,s=r.gl,a={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};a.u_exaggeration=this.exaggeration();let o=null,l=null,c=1;if(i&&i.morphing&&this._useVertexMorphing){const e=i.morphing.srcDemTile,n=i.morphing.dstDemTile;c=i.morphing.phase,e&&n&&(this._prepareDemTileUniforms(t,e,a,"_prev")&&(l=e),this._prepareDemTileUniforms(t,n,a)&&(o=n))}const d=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?s.LINEAR:s.NEAREST;let u=null;var h;if(this.enabled?l&&o?(u=o.demTexture,r.activeTexture.set(s.TEXTURE4),l.demTexture.bind(d(l),s.CLAMP_TO_EDGE),a.u_dem_lerp=c):(o=this.terrainTileForTile[t.tileID.key],u=this._prepareDemTileUniforms(t,o,a)?o.demTexture:this.emptyDEMTexture):u=this.emptyDEMTexture,r.activeTexture.set(s.TEXTURE2),u&&(a.u_dem_size=1===(h=u).size[0]?1:h.size[0]-2,u.bind(d(o),s.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(i&&i.useDepthForOcclusion,n,a),i&&i.useMeterToDem&&o){const t=(1<<o.tileID.canonical.z)*e.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=t}if(i&&i.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(r,a),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(r,e)}}globeUniformValues(t,n,i){const r=t.projection;return{u_tile_tl_up:r.upVector(n,0,0),u_tile_tr_up:r.upVector(n,e.aj,0),u_tile_br_up:r.upVector(n,e.aj,e.aj),u_tile_bl_up:r.upVector(n,0,e.aj),u_tile_up_scale:i?e.dH(1):r.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,n,i,r,s){if("globe"===t.transform.projection.name)!function(t,n,i,r,s){const a=t.context,o=a.gl;let l,c;const d=t.transform,u=e.dy(t,a,d),h=(e,n)=>{if(c===n)return;const i=[Vr[n],"PROJECTION_GLOBE_VIEW"];u&&i.push("CUSTOM_ANTIALIASING");const r=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:i,overrideFog:r}),c=n},p=t.colorModeForRenderPass(),m=new Hn(o.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D);Br.update(s);const f=e.dz(d),g=[e.aD(d.center.lng),e.aH(d.center.lat)],x=t.globeSharedBuffers,y=[d.width*e.q.devicePixelRatio,d.height*e.q.devicePixelRatio],v=Float32Array.from(d.globeMatrix),_={useDenormalizedUpVectorScale:!0};{const d=t.transform,u=Ur(d.zoom,n.exaggeration(),n.sourceCache._source.tileSize);c=-1;const b=o.TRIANGLES;for(const c of r){const r=i.getTile(c),w=Wn.disabled,j=n.prevTerrainTileForTile[c.key],N=n.terrainTileForTile[c.key];Fr(j,N)&&Br.newMorphing(c.key,j,N,s,250),a.activeTexture.set(o.TEXTURE0),r.texture&&r.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE);const S=Br.getMorphValuesForProxy(c.key),k=S?1:0;S&&e.L(_,{morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:e.dx(S.phase)}});const T=e.dA(c.canonical),C=e.dB(T.getCenter().lat),E=e.dC(c.canonical,T,C,d.worldSize/d._pixelsPerMercatorPixel),A=e.bh(e.dD(c.canonical)),M=Or(d.expandedFarZProjMatrix,v,f,A,e.ah(d.zoom),g,d.frustumCorners.TL,d.frustumCorners.TR,d.frustumCorners.BR,d.frustumCorners.BL,d.globeCenterInViewSpace,d.globeRadius,y,u,d._farZ,E);if(h(c,k),l&&(n.setupElevationDraw(r,l,_),t.uploadCommonUniforms(a,l,c.toUnwrapped()),x)){const[e,n,i]=x.getGridBuffers(C,0!==u);l.draw(t,b,m,w,p,Zn.backCCW,M,"globe_raster",e,n,i)}}}if(x&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const s=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];u&&s.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:s});for(const c of r){const{x:r,y:s,z:u}=c.canonical,h=0===s,f=s===(1<<u)-1,[v,b,w,j]=x.getPoleBuffers(u,!1);if(j&&(h||f)){const s=i.getTile(c);a.activeTexture.set(o.TEXTURE0),s.texture&&s.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE);let x=e.dE(u,r,d);const N=e.bh(e.dD(c.canonical)),S=(e,n)=>e.draw(t,o.TRIANGLES,m,Wn.disabled,p,Zn.disabled,Or(d.expandedFarZProjMatrix,x,x,N,0,g,d.frustumCorners.TL,d.frustumCorners.TR,d.frustumCorners.BR,d.frustumCorners.BL,d.globeCenterInViewSpace,d.globeRadius,y,0,d._farZ),"globe_pole_raster",n,w,j);n.setupElevationDraw(s,l,_),t.uploadCommonUniforms(a,l,c.toUnwrapped()),h&&t.renderDefaultNorthPole&&S(l,v),f&&t.renderDefaultSouthPole&&(x=e.cP(e.bz(),x,[1,-1,1]),S(l,b))}}}}(t,n,i,r,s);else{const a=t.context,o=a.gl;let l,c;const d=t.shadowRenderer,u=ri(t,t.longestCutoffRange),h=e=>{if(c===e)return;const n=[];n.push(Vr[e]),u.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),d&&(n.push("RENDER_SHADOWS","DEPTH_TEXTURE"),d.useNormalOffset&&n.push("NORMAL_OFFSET")),l=t.getOrCreateProgram("terrainRaster",{defines:n}),c=e},p=t.colorModeForRenderPass(),m=new Hn(o.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D);Br.update(s);const f=t.transform,g=Ur(f.zoom,n.exaggeration(),n.sourceCache._source.tileSize);let x=[0,0,0];if(d){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(x=ui(t.style,e,n))}{c=-1;const y=o.TRIANGLES,[v,_]=[n.gridIndexBuffer,n.gridSegments];for(const c of r){const r=i.getTile(c),b=Wn.disabled,w=n.prevTerrainTileForTile[c.key],j=n.terrainTileForTile[c.key];Fr(w,j)&&Br.newMorphing(c.key,w,j,s,250),a.activeTexture.set(o.TEXTURE0),r.texture&&r.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE);const N=Br.getMorphValuesForProxy(c.key),S=N?1:0;let k;N&&(k={morphing:{srcDemTile:N.from,dstDemTile:N.to,phase:e.dx(N.phase)}});const T=zr(c.projMatrix,Hr(c.canonical,f.renderWorldCopies)?g/10:g,x);if(h(S),!l)continue;n.setupElevationDraw(r,l,k);const C=c.toUnwrapped();d&&d.setupShadows(C,l),t.uploadCommonUniforms(a,l,C,null,u),l.draw(t,y,m,b,p,Zn.backCCW,T,"terrain_raster",n.gridBuffer,v,_)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,r=this.proxySourceCache,s=this.proxiedCoords[r.id],a=this._drapedRenderBatches.shift(),o=n.style.order,l=[];let c=0;for(const d of s){const s=r.getTileByID(d.proxyTileKey),u=r.proxyCachedFBO[d.key]?r.proxyCachedFBO[d.key][t]:void 0,h=void 0!==u?r.renderCache[u]:this.pool[c++],p=void 0!==u;if(s.texture=h.tex,p&&!h.dirty){l.push(s.tileID);continue}let m;i.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(i.clear({color:e.am.transparent,stencil:0}),h.dirty=!1);for(let e=a.start;e<=a.end;++e){const t=n.style._mergedLayers[o[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style.getLayerSourceCache(t),s=r?this.proxyToSource[d.key][r.id]:[d];if(!s)continue;const a=s;i.viewport.set([0,0,h.fb.width,h.fb.height]),m!==(r?r.id:null)&&(this._setupStencil(h,s,t,r),m=r?r.id:null),n.renderLayer(n,r,t,a)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=n.style._mergedLayers[o[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style.getLayerSourceCache(t),s=r?this.proxyToSource[d.key][r.id]:[d];if(!s)continue;const a=s;i.viewport.set([0,0,h.fb.width,h.fb.height]),m!==(r?r.id:null)&&(this._setupStencil(h,s,t,r),m=r?r.id:null),n.renderLayer(n,r,t,a)}this.renderedToTile?(h.dirty=!0,l.push(s.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),a.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let n=-1,i=t;for(let r=0;r<t;++r)this._style.isLayerDraped(e._mergedLayers[e.order[r]])?n=Math.max(n,r):i=Math.min(i,r);return i>n}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(t=>{e=Math.min(e,t.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter(e=>e.dem).map(i=>{const r=i.tileID,s=1<<r.overscaledZ,{x:a,y:o}=r.canonical,l=a/s,c=(a+1)/s,d=o/s,u=(o+1)/s;return{minx:l,miny:d,maxx:c,maxy:u,t:i.dem.tree.raycastRoot(l,d,c,u,e,t,n),tile:i}});i.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,n);if(null!=i)return i}return null}_createFBO(){const t=this.painter.context,n=t.gl,i=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const r=new e.T(t,{width:i[0],height:i[1],data:null},n.RGBA8);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);const s=t.createFramebuffer(i[0],i[1],!0,null);return s.colorAttachment.set(r.texture),s.depthAttachment=new Lr(t,s.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,s.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):s.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:s,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const t=this._style._mergedLayers[e],n=t.isHidden(this.painter.transform.zoom);return"hillshade"===t.type||"custom"===t.type?!n&&t.shouldRedrape():!n&&t.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof st){t=!0;break}if(!t)return;const n={};for(let i=0;i<this._style.order.length;++i){const t=this._style._mergedLayers[this._style.order[i]],r=this._style.getLayerSourceCache(t);if(r&&!n[r.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.ab){n[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n]._source instanceof at){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(e);if(!i||t[i.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const r=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=Wr(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(0===n)return;const i=[];this._pendingGroundEffectLayers=[];let r,s=0,a=this._style._mergedLayers[t[s]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++s<n;)a=this._style._mergedLayers[t[s]];for(;s<n;++s){const e=this._style._mergedLayers[t[s]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=s):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(s),void 0!==r&&(i.push({start:r,end:s-1}),r=void 0)))}if(void 0!==r&&i.push({start:r,end:s-1}),0!==i.length){const t=i[i.length-1];this._pendingGroundEffectLayers.every(e=>e>t.end)||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const i=Object.values(e[n]);t.renderCachePool.push(...i)}}return}this._clearRasterLayersFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let s=n.length-1;s>=0;s--){const r=n[s];if(t.getTileByID(r.key),void 0!==t.proxyCachedFBO[r.key]){const n=e[r.key],s=this.proxyToSource[r.key];let a=0;for(const e in s){const t=s[e],r=n[e];if(!r||r.length!==t.length||t.some((t,n)=>t!==r[n]||i[e]&&i[e].hasOwnProperty(t.key))){a=-1;break}++a}for(const e in t.proxyCachedFBO[r.key])t.renderCache[t.proxyCachedFBO[r.key][e]].dirty=a<0||a!==Object.values(n).length}}const r=[...this._drapedRenderBatches];r.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const s of r)for(const e of n){if(t.proxyCachedFBO[e.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][s.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,s=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let a;if(n.isTileClipped())a=t.length,this._overlapStencilMode.test={func:s.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:s.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Wn.disabled}_renderTileClippingMasks(e,t){const n=this.painter,i=this.painter.context,r=i.gl;n._tileClippingMaskIDs={},i.setColorMode(Un.disabled),i.setDepthMode(Hn.disabled);const s=n.getOrCreateProgram("clippingMask");for(const a of e){const e=n._tileClippingMaskIDs[a.key]=--t;s.draw(n,r.TRIANGLES,Hn.disabled,new Wn({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),Un.disabled,Zn.disabled,qr(a.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const i=[t.x,t.y,1,1];e.aA(i,i,n.pixelMatrixInverse),e.cH(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const r=n._camera.position,s=e.cb(1,n.center.lat),a=[r[0],r[1],r[2]/s,0],o=e.d7([],i.slice(0,3),a);e.au(o,o);const l=this.raycast(a,o,this._exaggeration);return null!==l&&l?(e.bE(a,a,o,l),a[3]=a[2],a[2]*=s,a):null}_setupProxiedCoordsForOrtho(t,n,i){if(t.getSource()instanceof e.aP)return this._setupProxiedCoordsForImageSource(t,n,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],s=this.proxyCoords;for(let e=0;e<s.length;e++){const n=s[e],a=this._findTileCoveringTileID(n,t);if(a){const e=this._createProxiedId(n,a,i[n.key]&&i[n.key][t.id]);r.push(e),this.proxyToSource[n.key][t.id]=[e]}}let a=!1;const o=new Set;for(let e=0;e<n.length;e++){const s=t.getTile(n[e]);if(!s||!s.hasData())continue;const l=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==s.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],n=this._createProxiedId(l.tileID,s,i[l.tileID.key]&&i[l.tileID.key][t.id]);e?e.splice(e.length-1,0,n):this.proxyToSource[l.tileID.key][t.id]=[n];const c=this.proxyToSource[l.tileID.key][t.id];o.has(c)||o.add(c),r.push(n),a=!0}}if(this._sourceTilesOverlap[t.id]=a,a&&this._debugParams.sortTilesHiZFirst)for(const e of o)e.sort((e,t)=>t.overscaledZ-e.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,i){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],s=this.proxyCoords,a=t.getSource(),o=a.tileID;if(!o)return;const l=new e.P(o.x,o.y)._div(1<<o.z),c=a.coordinates.map(e.ac.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),d=(t,n)=>{const i=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),s=e.aj/(1<<t.canonical.z),a=n.wrap+n.canonical.x/(1<<n.canonical.z),o=n.canonical.y/(1<<n.canonical.z);return i+s<a+c.min.x||i>a+c.max.x||r+s<o+c.min.y||r>o+c.max.y};for(let e=0;e<s.length;e++){const a=s[e];for(let e=0;e<n.length;e++){const s=t.getTile(n[e]);if(!s||!s.hasData())continue;if(d(a,s.tileID))continue;const o=this._createProxiedId(a,s,i[a.key]&&i[a.key][t.id]),l=this.proxyToSource[a.key][t.id];l?l.push(o):this.proxyToSource[a.key][t.id]=[o],r.push(o)}}}_createProxiedId(t,n,i){let r=this.orthoMatrix;if(i){const e=i.find(e=>e.key===n.tileID.key);if(e)return e}if(n.tileID.key!==t.key){const i=t.canonical.z-n.tileID.canonical.z;let s,a,o;r=e.bz();const l=n.tileID.wrap-t.wrap<<t.overscaledZ;i>0?(s=e.aj>>i,a=s*((n.tileID.canonical.x<<i)-t.canonical.x+l),o=s*((n.tileID.canonical.y<<i)-t.canonical.y)):(s=e.aj<<-i,a=e.aj*(n.tileID.canonical.x-(t.canonical.x+l<<-i)),o=e.aj*(n.tileID.canonical.y-(t.canonical.y<<-i))),e.ca(r,0,s,0,s,0,1),e.bo(r,r,[a,o,0])}return new Zr(n.tileID,t.key,r)}_findTileCoveringTileID(t,n){let i=n.getTile(t);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[n.id],s=r[t.key];if(i=s?n.getTileByID(s):null,i&&i.hasData()||null===s)return i;let a=i?i.tileID:t,o=a.overscaledZ;const l=n.getSource().minzoom,c=[];if(!s){const r=n.getSource().maxzoom;if(t.canonical.z>=r){const i=t.canonical.z-r;n.getSource().reparseOverscaled?(o=Math.max(t.canonical.z+2,n.transform.tileZoom),a=new e.aM(o,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i)):0!==i&&(o=r,a=new e.aM(o,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i))}a.key!==t.key&&(c.push(a.key),i=n.getTile(a))}const d=e=>{c.forEach(t=>{r[t]=e}),c.length=0};for(o-=1;o>=l&&(!i||!i.hasData());o--){i&&d(i.tileID.key);const e=a.calculateScaledKey(o);if(i=n.getTileByID(e),i&&i.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):i=n.getTileByID(t)}return d(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}}function Kr(t,n,i){const r=function(t,n,i){const r=e.bG(n,t),s=e.bG(i,[.2126,.7152,.0722]),a=(e,t,n)=>(1-n)*e+n*t,o=a(1-.3*Math.min(s,1),1,Math.min(r+1,1));return a(.92,1,Math.asin(e.ay(n[2],-1,1))/Math.PI+.5)*o}(t,[0,0,1],n),s=[0,0,0];e.c1(s,i.slice(0,3),r);const a=[0,0,0];e.c1(a,n.slice(0,3),t[2]);const o=[0,0,0];return e.d5(o,s,a),e.d8(o)}const Qr=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Jr=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class $r{static cacheKey(e,t,n,i){let r="".concat(t).concat(i?i.cacheKey:"");for(const s of n)e.usedDefines.includes(s)&&(r+="/".concat(s));return r}constructor(t,n,i,r,s,a){const o=t.gl;this.program=o.createProgram(),this.configuration=r,this.name=n,this.fixedDefines=[...a];const l=r?r.getBinderAttributes():[],c=(i.staticAttributes||[]).concat(l);let d=r?r.defines():[];d=d.concat(a.map(e=>"#define ".concat(e)));const u="#version 300 es\n";let h=u+d.concat("precision mediump float;",Wi,qi.fragmentSource).join("\n");for(const e of i.fragmentIncludes)h+="\n".concat(Ui[e]);h+="\n".concat(i.fragmentSource);let p=u+d.concat("precision highp float;",Wi,qi.vertexSource).join("\n");for(const e of i.vertexIncludes)p+="\n".concat(Ui[e]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&-1!==i.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(p+="\nuniform int u_instanceID;\n"),p+="\n".concat(i.vertexSource),this.forceManualRenderingForInstanceIDShaders&&(p=p.replaceAll("gl_InstanceID","u_instanceID"));const m=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())return void(this.failedToCreate=!0);o.shaderSource(m,h),o.compileShader(m),o.attachShader(this.program,m);const f=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(f,p),o.compileShader(f),o.attachShader(this.program,f),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:"a_".concat(c[e]);o.bindAttribLocation(this.program,e,t),this.attributes[t]=e}o.linkProgram(this.program),o.deleteShader(f),o.deleteShader(m),this.fixedUniforms=s(t),this.binderUniforms=r?r.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(t=>({u_instanceID:new e.cd(t)}))(t)),(a.includes("TERRAIN")||-1!==n.indexOf("symbol")||-1!==n.indexOf("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.cd(t),u_dem_prev:new e.cd(t),u_dem_tl:new e.cg(t),u_dem_scale:new e.cf(t),u_dem_tl_prev:new e.cg(t),u_dem_scale_prev:new e.cf(t),u_dem_size:new e.cf(t),u_dem_lerp:new e.cf(t),u_exaggeration:new e.cf(t),u_depth:new e.cd(t),u_depth_size_inv:new e.cg(t),u_depth_range_unpack:new e.cg(t),u_occluder_half_size:new e.cf(t),u_occlusion_depth_offset:new e.cf(t),u_meter_to_dem:new e.cf(t),u_label_plane_matrix_inv:new e.ch(t)}))(t)),a.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.ce(t),u_tile_tr_up:new e.ce(t),u_tile_br_up:new e.ce(t),u_tile_bl_up:new e.ce(t),u_tile_up_scale:new e.cf(t)}))(t)),a.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.ch(t),u_fog_range:new e.cg(t),u_fog_color:new e.d0(t),u_fog_horizon_blend:new e.cf(t),u_fog_vertical_limit:new e.cg(t),u_fog_temporal_offset:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_globe_transition:new e.cf(t),u_is_globe:new e.cd(t),u_viewport:new e.cg(t)}))(t)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.d0(t)}))(t)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.ce(t),u_lighting_directional_dir:new e.ce(t),u_lighting_directional_color:new e.ce(t),u_ground_radiance:new e.ce(t)}))(t)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.ch(t),u_light_matrix_1:new e.ch(t),u_fade_range:new e.cg(t),u_shadow_normal_offset:new e.ce(t),u_shadow_intensity:new e.cf(t),u_shadow_texel_size:new e.cf(t),u_shadow_map_resolution:new e.cf(t),u_shadow_direction:new e.ce(t),u_shadow_bias:new e.ce(t),u_shadowmap_0:new e.cd(t),u_shadowmap_1:new e.cd(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const n=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const n=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const n=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const n=this.shadowUniforms;e.program.set(this.program);for(const i in t)n[i].set(this.program,i,t[i])}_drawDebugWireframe(t,n,i,r,s,a,o,l,c,d){const u=t.options.wireframe;if(!1===u.terrain&&!1===u.layers2D&&!1===u.layers3D)return;const h=t.context;if(!(()=>!(!u.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!u.layers2D||t._terrain&&t._terrain.renderingToTexture||!Qr.includes(this.name))||!(!u.layers3D||!Jr.includes(this.name)))())return;const p=h.gl,m=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,s,h);if(!m)return;const f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");const g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:f});h.program.set(g.program);const x=(e,t,n)=>{if(t[e]&&n[e])for(const i in t[e])n[e][i]&&n[e][i].set(n.program,i,t[e][i].current)};c&&c.setUniforms(g.program,h,g.binderUniforms,o,{zoom:l}),x("fixedUniforms",this,g),x("terrainUniforms",this,g),x("globeUniforms",this,g),x("fogUniforms",this,g),x("lightsUniforms",this,g),x("shadowUniforms",this,g),m.bind(),h.setColorMode(new Un([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.am.transparent,[!0,!0,!0,!1])),h.setDepthMode(new Hn(n.func===p.LESS?p.LEQUAL:n.func,Hn.ReadOnly,n.range)),h.setStencilMode(Wn.disabled);const y=3*a.primitiveLength*2,v=3*a.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const e=d||1;for(let t=0;t<e;++t)g.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",t),p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,v)}else d&&d>1?p.drawElementsInstanced(p.LINES,y,p.UNSIGNED_SHORT,v,d):p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,v);s.bind(),h.program.set(this.program),h.setDepthMode(n),h.setStencilMode(i),h.setColorMode(r)}checkUniforms(e,t,n){if(this.fixedDefines.includes(t))for(const i of Object.keys(n))if(!n[i].initialized)throw new Error("Program '".concat(this.name,"', from draw '").concat(e,"': uniform ").concat(i," not set but required by ").concat(t," being defined"))}draw(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f){const g=e.context,x=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(n),g.setStencilMode(i),g.setColorMode(r),g.setCullFace(s);for(const _ of Object.keys(this.fixedUniforms))this.fixedUniforms[_].set(this.program,_,a[_]);p&&p.setUniforms(this.program,g,this.binderUniforms,u,{zoom:h});const y={[x.POINTS]:1,[x.LINES]:2,[x.TRIANGLES]:3,[x.LINE_STRIP]:1}[t];this.checkUniforms(o,"RENDER_SHADOWS",this.shadowUniforms);const v=f&&f>0?1:void 0;for(const _ of d.get()){const s=_.vaos||(_.vaos={});if((s[o]||(s[o]=new Xi)).bind(g,this,l,p?p.getPaintVertexBuffers():[],c,_.vertexOffset,m||[],v),this.forceManualRenderingForInstanceIDShaders){const e=f||1;for(let n=0;n<e;++n)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",n),c?x.drawElements(t,_.primitiveLength*y,x.UNSIGNED_SHORT,_.primitiveOffset*y*2):x.drawArrays(t,_.vertexOffset,_.vertexLength)}else f&&f>1?x.drawElementsInstanced(t,_.primitiveLength*y,x.UNSIGNED_SHORT,_.primitiveOffset*y*2,f):c?x.drawElements(t,_.primitiveLength*y,x.UNSIGNED_SHORT,_.primitiveOffset*y*2):x.drawArrays(t,_.vertexOffset,_.vertexLength);t===x.TRIANGLES&&c&&this._drawDebugWireframe(e,n,i,r,c,_,u,h,p,f)}}}function es(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,n.tileID.overscaledZ),s=n.tileSize*Math.pow(2,t.transform.tileZoom)/r,a=s*(n.tileID.canonical.x+n.tileID.wrap*r),o=s*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.aw(n,1,t.transform.tileZoom),u_pixel_coord_upper:[a>>16,o>>16],u_pixel_coord_lower:[65535&a,65535&o],u_pattern_transition:i}}const ts={terrain:0,flat:1},ns=e.bz(),is=(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y)=>{const v=n.style.light,_=v.properties.get("position"),b=[_.x,_.y,_.z],w=e.dJ();"viewport"===v.properties.get("anchor")&&(e.dK(w,-n.transform.angle),e.dL(b,b,w));const j=v.properties.get("color").toPremultipliedRenderColor(null),N=n.transform,S={u_matrix:t,u_lightpos:b,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ns,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ts[d],u_base_type:ts[u],u_ao:s,u_edge_radius:a,u_width_scale:o,u_flood_light_color:f,u_vertical_scale:g,u_flood_light_intensity:x,u_ground_shadow_factor:y};return"globe"===N.projection.name&&(S.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],S.u_zoom_transition=h,S.u_inv_rot_matrix=m,S.u_merc_center=p,S.u_up_dir=N.projection.upVector(new e.cA(0,0,0),p[0]*e.aj,p[1]*e.aj),S.u_height_lift=c),S},rs=(e,t,n,i,r,s)=>({u_matrix:e,u_edge_radius:t,u_width_scale:n,u_vertical_scale:i,u_height_type:ts[r],u_base_type:ts[s]}),ss=(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y)=>{const v=is(t,n,i,r,s,a,o,l,d,u,h,p,m,f,g,x,1,[0,0,0]),_={u_height_factor:-Math.pow(2,l.overscaledZ)/c.tileSize/8};return e.h(v,es(n,c,y),_)},as=(e,t,n)=>({u_matrix:e,u_emissive_strength:t,u_ground_shadow_factor:n}),os=function(t,n,i,r,s){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e.h(as(t,n,s),es(i,r,a))},ls=(e,t,n,i)=>({u_matrix:e,u_world:n,u_emissive_strength:t,u_ground_shadow_factor:i}),cs=function(t,n,i,r,s,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return e.h(os(t,n,i,r,a,o),{u_world:s})},ds=(e,t)=>({u_matrix:e,u_ground_shadow_factor:t}),us=(e,t,n,i,r)=>({u_matrix:e,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:i,u_reset_depth:r}),hs=(e,t)=>({u_matrix:e,u_normal_matrix:t,u_opacity:1}),ps=e=>({u_matrix:e}),ms=e=>({u_matrix:e}),fs=(t,n,i,r,s,a,o,l)=>{const c=e.aj/a.tileSize;return{u_matrix:t,u_inv_rot_matrix:n,u_camera_to_center_distance:i.getCameraToCenterDistance(l),u_extrude_scale:[i.pixelsToGLUnits[0]/c,i.pixelsToGLUnits[1]/c],u_zoom_transition:r,u_tile_id:o,u_merc_center:s}},gs=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},xs=e.bz(),ys=(t,n,i,r,s,a,o)=>{const l=t.transform,c="globe"===l.projection.name,d=c?e.dM(l.zoom,n.canonical)*l._pixelsPerMercatorPixel:e.aw(i,1,a),u={u_matrix:n.projMatrix,u_extrude_scale:d,u_intensity:o,u_inv_rot_matrix:xs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){u.u_inv_rot_matrix=r,u.u_merc_center=s,u.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],u.u_zoom_transition=e.ah(l.zoom);const t=s[0]*e.aj,i=s[1]*e.aj;u.u_up_dir=l.projection.upVector(new e.cA(0,0,0),t,i)}return u};function vs(e,t,n){let[i,r,s,a]=t,[o,l]=n;if(o===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-o));return[i*c,r*c,s*c,a*c]}function _s(e,t,n){let[i,r]=n;return i===r?0:.5/e+(t-i)*(e-1)/(e*(r-i))}const bs=(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b)=>({u_matrix:t,u_normalize_matrix:n,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:s,u_tl_parent:a,u_scale_parent:d,u_fade_t:u.mix,u_opacity:u.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:e.dO(h.paint.get("raster-saturation")),u_contrast_factor:e.dN(h.paint.get("raster-contrast")),u_spin_weights:ws(h.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:m,u_zoom_transition:o,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:vs(e.dP,g,y),u_colorization_offset:_s(e.dP,x,y),u_color_ramp:f,u_texture_offset:[_/(v+2*_),v/(v+2*_)],u_texture_res:[v+2*_,v+2*_],u_emissive_strength:b});function ws(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const js=.05,Ns=(e,t,n,i,r,s,a,o,l,c,d,u)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:i,u_grid_matrix:r,u_tl_parent:s,u_scale_parent:c,u_fade_t:d.mix,u_opacity:d.opacity,u_image0:0,u_image1:1,u_raster_elevation:u,u_zoom_transition:a,u_merc_center:o,u_cutoff_params:l}),Ss=(e,t,n,i,r,s,a,o,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:i,u_color_ramp:s,u_velocity_res:r,u_max_speed:a,u_uv_offset:o,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[js,js]}),ks=(e,t,n,i,r,s,a,o,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:i,u_max_speed:r,u_speed_factor:s,u_reset_rate:a,u_rand_seed:Math.random(),u_uv_offset:o,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[js,js]}),Ts=e.bz(),Cs=(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b,w,j,N)=>{const S=s.transform,k={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:S.getCameraToCenterDistance(v),u_rotate_symbol:+i,u_aspect_ratio:S.width/S.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:l,u_is_text:+d,u_elevation_from_sea:c?1:0,u_pitch_with_map:+r,u_texsize:u,u_texsize_icon:h,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ts,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ts,u_up_vector:[0,-1,0],u_color_adj_mat:w,u_icon_transition:j||0,u_gamma_scale:r?s.transform.getCameraToCenterDistance(v)*Math.cos(s.terrain?0:s.transform._pitch):1,u_device_pixel_ratio:e.q.devicePixelRatio,u_is_halo:1,u_scale_factor:N||1,u_ground_shadow_factor:_,u_inv_matrix:e.bi(e.bz(),o),u_normal_scale:b};return"globe"===v.name&&(k.u_tile_id=[m.canonical.x,m.canonical.y,1<<m.canonical.z],k.u_zoom_transition=f,k.u_inv_rot_matrix=x,k.u_merc_center=g,k.u_camera_forward=S._camera.forward(),k.u_ecef_origin=e.dQ(S.globeMatrix,m.toUnwrapped()),k.u_tile_matrix=Float32Array.from(S.globeMatrix),k.u_up_vector=y),k},Es=(e,t,n,i)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:i}),As=(t,n,i,r,s,a,o,l,c)=>e.h(function(t,n,i,r,s,a){const{width:o,height:l}=r.imageManager.getPixelSize(n),c=Math.pow(2,a.tileID.overscaledZ),d=a.tileSize*Math.pow(2,r.transform.tileZoom)/c,u=d*(a.tileID.canonical.x+a.tileID.wrap*c),h=d*a.tileID.canonical.y;return{u_image:0,u_pattern_tl:i.tl,u_pattern_br:i.br,u_texsize:[o,l],u_pattern_size:i.displaySize,u_pattern_units_to_pixels:s?[r.transform.width,-1*r.transform.height]:[1/e.aw(a,1,r.transform.tileZoom),1/e.aw(a,1,r.transform.tileZoom)],u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(0,a,o,r,l,c),{u_matrix:t,u_emissive_strength:n,u_opacity:i}),Ms=new Float32Array(e.bx([])),Ds=function(t,n,i,r,s,a,o,l,c,d,u,h,p){let m=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],f=arguments.length>14?arguments[14]:void 0;const g=s.style.light,x=g.properties.get("position"),y=[-x.x,-x.y,x.z],v=e.dJ();"viewport"===g.properties.get("anchor")&&(e.dK(v,-s.transform.angle),e.dL(y,y,v));const _="MASK"===u.alphaMode,b=g.properties.get("color").toNonPremultipliedRenderColor(null),w=p.paint.get("model-ambient-occlusion-intensity"),j=p.paint.get("model-color").constantOr(e.am.white).toNonPremultipliedRenderColor(null);return j.a=p.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:t,u_lighting_matrix:n,u_normal_matrix:i,u_node_matrix:r||Ms,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:m,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+_,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:o.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:l.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:c,u_roughnessFactor:d,u_baseColorTexture:ei.BaseColor,u_metallicRoughnessTexture:ei.MetallicRoughness,u_normalTexture:ei.Normal,u_occlusionTexture:ei.Occlusion,u_emissionTexture:ei.Emission,u_lutTexture:ei.LUT,u_color_mix:j.toArray01(),u_aoIntensity:w,u_emissive_strength:h,u_occlusionTextureTransform:f||[0,0,0,0]}},Is=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ms,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ms}},Ps={fillExtrusion:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_opacity:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_flood_light_color:new e.ce(t),u_vertical_scale:new e.cf(t),u_flood_light_intensity:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillExtrusionDepth:t=>({u_matrix:new e.ch(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_vertical_scale:new e.cf(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t)}),fillExtrusionPattern:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_height_factor:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_opacity:new e.cf(t),u_pattern_transition:new e.cf(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.ch(t),u_opacity:new e.cf(t),u_ao_pass:new e.cf(t),u_meter_to_tile:new e.cf(t),u_ao:new e.cg(t),u_flood_light_intensity:new e.cf(t),u_flood_light_color:new e.ce(t),u_attenuation:new e.cf(t),u_edge_radius:new e.cf(t),u_fb:new e.cd(t),u_fb_size:new e.cf(t),u_dynamic_offset:new e.cf(t)}),fill:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),fillOutline:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_ground_shadow_factor:new e.ce(t)}),fillOutlinePattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),building:t=>({u_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_opacity:new e.cf(t)}),buildingBloom:t=>({u_matrix:new e.ch(t)}),buildingDepth:t=>({u_matrix:new e.ch(t)}),elevatedStructuresDepth:t=>({u_matrix:new e.ch(t),u_depth_bias:new e.cf(t)}),elevatedStructures:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),elevatedStructuresDepthReconstruct:t=>({u_matrix:new e.ch(t),u_camera_pos:new e.ce(t),u_depth_bias:new e.cf(t),u_height_scale:new e.cf(t),u_reset_depth:new e.cf(t)}),circle:e.dT,collisionBox:t=>({u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_extrude_scale:new e.cg(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t)}),collisionCircle:t=>({u_matrix:new e.ch(t),u_inv_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_viewport_size:new e.cg(t)}),debug:t=>({u_color:new e.dv(t),u_matrix:new e.ch(t),u_overlay:new e.cd(t),u_overlay_scale:new e.cf(t)}),clippingMask:t=>({u_matrix:new e.ch(t)}),heatmap:t=>({u_extrude_scale:new e.cf(t),u_intensity:new e.cf(t),u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_up_dir:new e.ce(t)}),heatmapTexture:t=>({u_image:new e.cd(t),u_color_ramp:new e.cd(t),u_opacity:new e.cf(t)}),hillshade:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_latrange:new e.cg(t),u_light:new e.cg(t),u_shadow:new e.dv(t),u_highlight:new e.dv(t),u_emissive_strength:new e.cf(t),u_accent:new e.dv(t)}),hillshadePrepare:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_dimension:new e.cg(t),u_zoom:new e.cf(t)}),line:e.dS,linePattern:e.dR,raster:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_brightness_low:new e.cf(t),u_brightness_high:new e.cf(t),u_saturation_factor:new e.cf(t),u_contrast_factor:new e.cf(t),u_spin_weights:new e.ce(t),u_perspective_transform:new e.cg(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t),u_colorization_mix:new e.d0(t),u_colorization_offset:new e.cf(t),u_color_ramp:new e.cd(t),u_texture_offset:new e.cg(t),u_texture_res:new e.cg(t),u_emissive_strength:new e.cf(t)}),rasterParticle:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t)}),rasterParticleTexture:t=>({u_texture:new e.cd(t),u_opacity:new e.cf(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_tile_offset:new e.cg(t),u_velocity:new e.cd(t),u_color_ramp:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_velocity:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_speed_factor:new e.cf(t),u_reset_rate:new e.cf(t),u_rand_seed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),symbol:t=>({u_is_size_zoom_constant:new e.cd(t),u_is_size_feature_constant:new e.cd(t),u_size_t:new e.cf(t),u_size:new e.cf(t),u_camera_to_center_distance:new e.cf(t),u_rotate_symbol:new e.cd(t),u_aspect_ratio:new e.cf(t),u_fade_change:new e.cf(t),u_matrix:new e.ch(t),u_label_plane_matrix:new e.ch(t),u_coord_matrix:new e.ch(t),u_is_text:new e.cd(t),u_elevation_from_sea:new e.cd(t),u_pitch_with_map:new e.cd(t),u_texsize:new e.cg(t),u_texsize_icon:new e.cg(t),u_texture:new e.cd(t),u_texture_icon:new e.cd(t),u_gamma_scale:new e.cf(t),u_device_pixel_ratio:new e.cf(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_camera_forward:new e.ce(t),u_tile_matrix:new e.ch(t),u_up_vector:new e.ce(t),u_ecef_origin:new e.ce(t),u_is_halo:new e.cd(t),u_icon_transition:new e.cf(t),u_color_adj_mat:new e.ch(t),u_scale_factor:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_inv_matrix:new e.ch(t),u_normal_scale:new e.cf(t)}),background:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_color:new e.dv(t)}),backgroundPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_image:new e.cd(t),u_pattern_tl:new e.cg(t),u_pattern_br:new e.cg(t),u_texsize:new e.cg(t),u_pattern_size:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_pattern_units_to_pixels:new e.cg(t)}),terrainRaster:t=>({u_matrix:new e.ch(t),u_image0:new e.cd(t),u_skirt_height:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),skybox:t=>({u_matrix:new e.ch(t),u_sun_direction:new e.ce(t),u_cubemap:new e.cd(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxGradient:t=>({u_matrix:new e.ch(t),u_color_ramp:new e.cd(t),u_center_direction:new e.ce(t),u_radius:new e.cf(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxCapture:t=>({u_matrix_3f:new e.dw(t),u_sun_direction:new e.ce(t),u_sun_intensity:new e.cf(t),u_color_tint_r:new e.d0(t),u_color_tint_m:new e.d0(t),u_luminance:new e.cf(t)}),globeRaster:t=>({u_proj_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_image0:new e.cd(t),u_grid_matrix:new e.dw(t),u_skirt_height:new e.cf(t),u_far_z_cutoff:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_viewport:new e.cg(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_horizon:new e.cf(t),u_transition:new e.cf(t),u_fadeout_range:new e.cf(t),u_color:new e.d0(t),u_high_color:new e.d0(t),u_space_color:new e.d0(t),u_temporal_offset:new e.cf(t),u_horizon_angle:new e.cf(t)}),model:t=>({u_matrix:new e.ch(t),u_lighting_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_node_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_camera_pos:new e.ce(t),u_opacity:new e.cf(t),u_baseColorFactor:new e.d0(t),u_emissiveFactor:new e.d0(t),u_metallicFactor:new e.cf(t),u_roughnessFactor:new e.cf(t),u_baseTextureIsAlpha:new e.cd(t),u_alphaMask:new e.cd(t),u_alphaCutoff:new e.cf(t),u_baseColorTexture:new e.cd(t),u_metallicRoughnessTexture:new e.cd(t),u_normalTexture:new e.cd(t),u_occlusionTexture:new e.cd(t),u_emissionTexture:new e.cd(t),u_lutTexture:new e.cd(t),u_color_mix:new e.d0(t),u_aoIntensity:new e.cf(t),u_emissive_strength:new e.cf(t),u_occlusionTextureTransform:new e.d0(t)}),modelDepth:t=>({u_matrix:new e.ch(t),u_instance:new e.ch(t),u_node_matrix:new e.ch(t)}),groundShadow:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),stars:t=>({u_matrix:new e.ch(t),u_up:new e.ce(t),u_right:new e.ce(t),u_intensity_multiplier:new e.cf(t)}),snowParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_horizontalOscillationRadius:new e.cf(t),u_horizontalOscillationRate:new e.cf(t),u_boxSize:new e.cf(t),u_billboardSize:new e.cf(t),u_simpleShapeParameters:new e.cg(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_particleColor:new e.d0(t),u_direction:new e.ce(t)}),rainParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_texScreen:new e.cd(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_boxSize:new e.cf(t),u_rainDropletSize:new e.cg(t),u_distortionStrength:new e.cf(t),u_rainDirection:new e.ce(t),u_color:new e.d0(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_shapeDirectionalPower:new e.cf(t),u_shapeNormalPower:new e.cf(t),u_mode:new e.cf(t)}),vignette:t=>({u_vignetteShape:new e.ce(t),u_vignetteColor:new e.d0(t)}),occlusion:t=>({u_matrix:new e.ch(t),u_anchorPos:new e.ce(t),u_screenSizePx:new e.cg(t),u_occluderSizePx:new e.cg(t),u_color:new e.d0(t)})};class Rs{constructor(e,t,n,i){this.id=Rs.uniqueIdxCounter,Rs.uniqueIdxCounter++,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Rs.uniqueIdxCounter,Rs.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Rs.uniqueIdxCounter=0;const Ls={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zs{constructor(e,t,n,i,r,s){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.instanceCount=s,this.context=e;const a=e.gl;this.buffer=a.createBuffer(),e.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],s=t.attributes[r.name];void 0!==s&&e.vertexAttribPointer(s,r.components,e[Ls[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(r,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Os{constructor(e,t,n,i,r){this.context=e,this.width=t,this.height=n;const s=this.framebuffer=e.gl.createFramebuffer();i&&(this.colorAttachment=new Ir(e,s)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new Pr(e,s):new Rr(e,s))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class Fs{constructor(e,t){this.gl=e,this.clearColor=new tr(this),this.clearDepth=new nr(this),this.clearStencil=new ir(this),this.colorMask=new rr(this),this.depthMask=new sr(this),this.stencilMask=new ar(this),this.stencilFunc=new or(this),this.stencilOp=new lr(this),this.stencilTest=new cr(this),this.depthRange=new dr(this),this.depthTest=new ur(this),this.depthFunc=new hr(this),this.blend=new pr(this),this.blendFunc=new mr(this),this.blendColor=new fr(this),this.blendEquation=new gr(this),this.cullFace=new xr(this),this.cullFaceSide=new yr(this),this.frontFace=new vr(this),this.program=new _r(this),this.activeTexture=new br(this),this.viewport=new wr(this),this.bindFramebuffer=new jr(this),this.bindRenderbuffer=new Nr(this),this.bindTexture=new Sr(this),this.bindVertexBuffer=new kr(this),this.bindElementBuffer=new Tr(this),this.bindVertexArrayOES=new Cr(this),this.pixelStoreUnpack=new Er(this),this.pixelStoreUnpackPremultiplyAlpha=new Ar(this),this.pixelStoreUnpackFlipY=new Mr(this),this.options=t?Object.assign({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=t&&!!t.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,n){return new Rs(this,e,t,n)}createVertexBuffer(e,t,n,i,r){return new zs(this,e,t,n,i,r)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n,i){return new Os(this,e,t,n,i)}clear(e){let{color:t,depth:n,stencil:i,colorMask:r}=e;const s=this.gl;let a=0;t&&(a|=s.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==n&&(a|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(a|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),s.clear(a)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.bv(t.blendFunction,Un.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Bs;function Vs(t,n,i,r,s,a,o){const l=t.context,c=l.gl,d=t.transform,u=[e.aD(d.center.lng),e.aH(d.center.lat)],h=i.layout.get("symbol-placement"),p=i.layout.get("text-variable-anchor"),m="map"===i.layout.get("icon-rotation-alignment"),f="map"===i.layout.get("text-rotation-alignment"),g="point"!==h,x=[];let y=0,v=0;for(let k=0;k<r.length;k++){const l=r[k],h=n.getTile(l),_=h.getBucket(i);if(!_)continue;const b=_.getProjection().createInversionMatrix(d,l.canonical),w=[],j=Wt(l,_,d),N=!o&&m&&g,S=o&&f&&g,T=p&&_.hasTextData(),C=_.hasIconTextFit()&&T&&_.hasIconData(),E=N||S||o&&T||C,A="globe"===_.projection.name,M=A?e.ah(d.zoom):0;A&&(w.push("PROJECTION_GLOBE_VIEW"),E&&w.push("PROJECTED_POS_ON_VIEWPORT"));const D=t.getOrCreateProgram("collisionBox",{defines:w});let I=j;0===s[0]&&0===s[1]||(I=t.translatePosMatrix(j,h,s,a));const P=o?_.textCollisionBox:_.iconCollisionBox,R=_.collisionCircleArray;if(R.length>0){const t=e.bz(),n=I;e.cM(t,_.placementInvProjMatrix,d.glCoordMatrix),e.cM(t,t,_.placementViewportMatrix),x.push({circleArray:R,circleOffset:v,transform:n,invTransform:t,projection:_.getProjection()}),y+=R.length/4,v=y}if(!P)continue;t.terrain&&t.terrain.setupElevationDraw(h,D);const L=A?[l.canonical.x,l.canonical.y,1<<l.canonical.z]:[0,0,0];D.draw(t,c.LINES,Hn.disabled,Wn.disabled,t.colorModeForRenderPass(),Zn.disabled,fs(I,b,d,M,u,h,L,_.getProjection()),i.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,null,d.zoom,null,[P.collisionVertexBuffer,P.collisionVertexBufferExt])}if(!o||!x.length)return;const _=t.getOrCreateProgram("collisionCircle"),b=new e.dU;b.resize(4*y),b._trim();let w=0;for(const e of x)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],s=e.circleArray[n+2],a=e.circleArray[n+3];b.emplace(w++,i,r,s,a,0),b.emplace(w++,i,r,s,a,1),b.emplace(w++,i,r,s,a,2),b.emplace(w++,i,r,s,a,3)}(!Bs||Bs.length<2*y)&&(Bs=function(t){const n=2*t,i=new e.a_;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(y));const j=l.createIndexBuffer(Bs,!0),N=l.createVertexBuffer(b,e.dV.members,!0);for(const k of x){const n={u_matrix:k.transform,u_inv_matrix:k.invTransform,u_camera_to_center_distance:(S=d).getCameraToCenterDistance(k.projection),u_viewport_size:[S.width,S.height]};_.draw(t,c.TRIANGLES,Hn.disabled,Wn.disabled,t.colorModeForRenderPass(),Zn.disabled,n,i.id,N,j,e.bd.simpleSegment(0,2*k.circleOffset,k.circleArray.length,k.circleArray.length/2),null,d.zoom)}var S;N.destroy(),j.destroy()}const Us=e.bz();function Hs(t){const n=t._camera.getWorldToCamera(t.worldSize,1),i=e.az([],n,t.globeMatrix);e.bi(i,i);const r=[0,0,0],s=[0,1,0,0];return e.aA(s,s,i),r[0]=s[0],r[1]=s[1],r[2]=s[2],e.au(r,r),r}function qs(t,n){let{width:i,height:r,anchor:s,textOffset:a,textScale:o}=t;const{horizontalAlign:l,verticalAlign:c}=e.bZ(s),d=-(l-.5)*i,u=-(c-.5)*r,h=e.b_(s,a);return new e.P((d/o+h[0])*n,(u/o+h[1])*n)}function Ws(t,n,i,r,s,a,o,l,c,d){const u=t.text.placedSymbolArray,h=t.text.dynamicLayoutVertexArray,p=t.icon.dynamicLayoutVertexArray,m={},f=t.getProjection(),g=Gt(o,f,s),x=s.elevation,y=f.upVectorScale(o.canonical,s.center.lat,s.worldSize).metersToTile;h.clear();for(let v=0;v<u.length;v++){const p=u.get(v),{tileAnchorX:_,tileAnchorY:b,numGlyphs:w}=p,j=p.hidden||!p.crossTileID||t.allowVerticalPlacement&&!p.placedOrientation?null:r[p.crossTileID];if(j){let r=0,u=0,v=0;if(x){const e=x?x.getAtTileOffset(o,_,b):0,[t,n,i]=f.upVector(o.canonical,_,b);r=e*t*y,u=e*n*y,v=e*i*y}let[N,S,k,T]=en(p.projectedAnchorX+r,p.projectedAnchorY+u,p.projectedAnchorZ+v,i?g:a);const C=tn(s.getCameraToCenterDistance(f),T);let E=e.bJ(t.textSizeData,c,p)*C/e.bU;i&&(E*=t.tilePixelRatio/l);const A=qs(j,E);i?(({x:N,y:S,z:k}=f.projectTilePoint(_+A.x,b+A.y,o.canonical)),[N,S,k]=en(N+r,S+u,k+v,a)):(n&&A._rotate(-s.angle),N+=A.x,S+=A.y,k=0);const M=t.allowVerticalPlacement&&p.placedOrientation===e.bI.vertical?Math.PI/2:0;for(let t=0;t<w;t++)e.bL(h,N,S,k,M);d&&p.associatedIconIndex>=0&&(m[p.associatedIconIndex]={x:N,y:S,z:k,angle:M})}else un(w,h)}if(d){p.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const i=n.get(t),{numGlyphs:r}=i,s=m[t];if(i.hidden||!s)un(r,p);else{const{x:t,y:n,z:i,angle:a}=s;for(let s=0;s<r;s++)e.bL(p,t,n,i,a)}}t.icon.dynamicLayoutVertexBuffer.updateData(p)}t.text.dynamicLayoutVertexBuffer.updateData(h)}function Gs(t,n,i,r,s,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=i.paint.get("icon-translate"),c=i.paint.get("text-translate"),d=i.paint.get("icon-translate-anchor"),u=i.paint.get("text-translate-anchor"),h=i.layout.get("icon-rotation-alignment"),p=i.layout.get("text-rotation-alignment"),m=i.layout.get("icon-pitch-alignment"),f=i.layout.get("text-pitch-alignment"),g=i.layout.get("icon-keep-upright"),x=i.layout.get("text-keep-upright"),y=i.paint.get("icon-color-saturation"),v=i.paint.get("icon-color-contrast"),_=i.paint.get("icon-color-brightness-min"),b=i.paint.get("icon-color-brightness-max"),w="sea"===i.layout.get("symbol-elevation-reference"),j=t.context,N=j.gl,S=t.transform,k="map"===h,T="map"===p,C="map"===m,E="map"===f,A=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let M=!1;const D=t.depthModeForSublayer(0,Hn.ReadOnly),I=new Hn(t.context.gl.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D),P=[e.aD(S.center.lng),e.aH(S.center.lat)],R=i.layout.get("text-variable-anchor"),L="globe"===S.projection.name,z=[],O=[0,-1,0];for(const F of r){const r=n.getTile(F),s=r.getBucket(i);if(!s)continue;if("mercator"===s.projection.name&&L)continue;if(s.fullyClipped)continue;const a="globe"===s.projection.name,h=a?e.ah(S.zoom):0,p=Gt(F,s.getProjection(),S),m=S.calculatePixelsToTileUnitsMatrix(r),f=R&&s.hasTextData(),j=s.hasIconTextFit()&&f&&s.hasIconData(),B=s.getProjection().createInversionMatrix(S,F.canonical),V=(1<<r.tileID.canonical.z)*e.aj/t.transform.worldSize,U=e=>{let n=[0,0,0];if(e){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(n=ui(t.style,e,i))}return n},H=e=>{S.depthOcclusionForSymbolsAndCircles&&(i.hasInitialOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},q=()=>{const n=k&&"point"!==i.layout.get("symbol-placement"),o=[];H(o);const c=n||j,u="road"===s.elevationType,f=t.shadowRenderer,x=u&&C&&!!f&&f.enabled,T=U(x),E=u&&C&&!t.terrain?I:D,A=i.paint.get("icon-image-cross-fade");t.terrainRenderModeElevated()&&C&&o.push("PITCH_WITH_MAP_TERRAIN"),a&&(o.push("PROJECTION_GLOBE_VIEW"),c&&o.push("PROJECTED_POS_ON_VIEWPORT")),A>0&&s.hasAnySecondaryIcon&&o.push("ICON_TRANSITION"),!s.icon.zOffsetVertexBuffer||u&&t.terrain||o.push("Z_OFFSET"),0===y&&0===v&&0===_&&1===b||o.push("COLOR_ADJUSTMENT"),s.sdfIcons&&o.push("RENDER_SDF"),x&&o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),u&&C&&!t.terrain&&s.icon.orientationVertexBuffer&&o.push("ELEVATED_ROADS");const M=s.icon.programConfigurations.get(i.id),R=t.getOrCreateProgram("symbol",{config:M,defines:o}),z=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],q=s.iconSizeData,W=e.bH(q,S.zoom),G=C||!S.isOrthographic,Y=Qt(p,r.tileID.canonical,C,k,S,s.getProjection(),m),Z=$t(p,r.tileID.canonical,C,k,S,s.getProjection(),m),X=t.translatePosMatrix(Z,r,l,d,!0),K=t.translatePosMatrix(p,r,l,d),Q=c?Us:Y,J=k&&!C&&!n;let $=O;!L&&!S.mercatorFromTransition||k||($=Hs(S));const ee=a?$:O,te=i.getColorAdjustmentMatrix(y,v,_,b),ne=Cs(q.kind,W,J,C,t,K,Q,X,w,!1,z,[0,0],0,F,h,P,B,ee,s.getProjection(),T,V,te,A,null),ie=r.imageAtlasTexture?r.imageAtlasTexture:null,re=1!==i.layout.get("icon-size").constantOr(0)||s.iconsNeedLinear,se=s.sdfIcons||t.options.rotating||t.options.zooming||re||G?N.LINEAR:N.NEAREST,ae=s.sdfIcons&&0!==i.paint.get("icon-halo-width").constantOr(1),oe=t.terrain&&C&&n?e.bi(e.bz(),Y):Us;if(n&&s.icon){const e=S.elevation,n=e?e.getAtTileOffsetFunc(F,S.center.lat,S.worldSize,s.getProjection()):null,i=Jt(p,r.tileID.canonical,C,k,S,s.getProjection(),m);rn(s,p,t,!1,i,Z,C,g,n,F)}return{program:R,buffers:s.icon,uniformValues:ne,atlasTexture:ie,atlasTextureIcon:null,atlasInterpolation:se,atlasInterpolationIcon:null,isSDF:s.sdfIcons,hasHalo:ae,depthMode:E,tile:r,renderWithShadows:x,labelPlaneMatrixInv:oe}},W=()=>{const n=T&&"point"!==i.layout.get("symbol-placement"),o=[],l=n||R||j,d="road"===s.elevationType,f=t.shadowRenderer,g=d&&E&&!!f&&f.enabled,y=U(g),v=d&&E&&!t.terrain?I:D;t.terrainRenderModeElevated()&&E&&o.push("PITCH_WITH_MAP_TERRAIN"),a&&(o.push("PROJECTION_GLOBE_VIEW"),l&&o.push("PROJECTED_POS_ON_VIEWPORT")),!s.text.zOffsetVertexBuffer||d&&t.terrain||o.push("Z_OFFSET"),s.iconsInText&&o.push("RENDER_TEXT_AND_SYMBOL"),o.push("RENDER_SDF"),g&&o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),d&&E&&!t.terrain&&s.text.orientationVertexBuffer&&o.push("ELEVATED_ROADS"),H(o);const _=s.text.programConfigurations.get(i.id),b=t.getOrCreateProgram("symbol",{config:_,defines:o});let k,C=[0,0],A=null;const M=s.textSizeData;s.iconsInText&&(C=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],A=r.imageAtlasTexture?r.imageAtlasTexture:null,k=E||!S.isOrthographic||t.options.rotating||t.options.zooming||"composite"===M.kind||"camera"===M.kind?N.LINEAR:N.NEAREST);const z=r.glyphAtlasTexture?r.glyphAtlasTexture.size:[0,0],q=i.layout.get("text-size-scale-range"),W=e.ay(t.scaleFactor,q[0],q[1]),G=e.bH(M,S.zoom,W),Y=Qt(p,r.tileID.canonical,E,T,S,s.getProjection(),m),Z=$t(p,r.tileID.canonical,E,T,S,s.getProjection(),m),X=t.translatePosMatrix(Z,r,c,u,!0),K=t.translatePosMatrix(p,r,c,u),Q=l?Us:Y,J=T&&!E&&!n;let $=O;!L&&!S.mercatorFromTransition||T||($=Hs(S));const ee=Cs(M.kind,G,J,E,t,K,Q,X,w,!0,z,C,0,F,h,P,B,a?$:O,s.getProjection(),y,V,null,null,W),te=r.glyphAtlasTexture?r.glyphAtlasTexture:null,ne=N.LINEAR,ie=0!==i.paint.get("text-halo-width").constantOr(1),re=t.terrain&&E&&n?e.bi(e.bz(),Y):Us;if(n&&s.text){const e=S.elevation,n=e?e.getAtTileOffsetFunc(F,S.center.lat,S.worldSize,s.getProjection()):null,i=Jt(p,r.tileID.canonical,E,T,S,s.getProjection(),m);rn(s,p,t,!0,i,Z,E,x,n,F)}return{program:b,buffers:s.text,uniformValues:ee,atlasTexture:te,atlasTextureIcon:A,atlasInterpolation:ne,atlasInterpolationIcon:k,isSDF:!0,hasHalo:ie,depthMode:v,tile:r,renderWithShadows:g,labelPlaneMatrixInv:re}},G=s.icon.segments.get().length,Y=s.text.segments.get().length,Z=G&&!o.onlyText?q():null,X=Y&&!o.onlyIcons?W():null,K=i.paint.get("icon-opacity").constantOr(1),Q=i.paint.get("text-opacity").constantOr(1);if(A&&s.canOverlap){M=!0;const t=K&&!o.onlyText?s.icon.segments.get():[],n=Q&&!o.onlyIcons?s.text.segments.get():[];for(const i of t)z.push({segments:new e.bd([i]),sortKey:i.sortKey,state:Z});for(const i of n)z.push({segments:new e.bd([i]),sortKey:i.sortKey,state:X})}else o.onlyText||z.push({segments:K?s.icon.segments:new e.bd([]),sortKey:0,state:Z}),o.onlyIcons||z.push({segments:Q?s.text.segments:new e.bd([]),sortKey:0,state:X})}M&&z.sort((e,t)=>e.sortKey-t.sortKey);for(const e of z){const n=e.state;if(n)if(t.terrain?t.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:S.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:n.labelPlaneMatrixInv}):t.setupDepthForOcclusion(S.depthOcclusionForSymbolsAndCircles,n.program),j.activeTexture.set(N.TEXTURE0),n.atlasTexture&&n.atlasTexture.bind(n.atlasInterpolation,N.CLAMP_TO_EDGE,!0),n.atlasTextureIcon&&(j.activeTexture.set(N.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,N.CLAMP_TO_EDGE,!0)),n.renderWithShadows&&t.shadowRenderer.setupShadows(n.tile.tileID.toUnwrapped(),n.program,"vector-tile"),t.uploadCommonLightUniforms(t.context,n.program),n.hasHalo){const r=n.uniformValues;r.u_is_halo=1,Ys(n.buffers,e.segments,i,t,n.program,n.depthMode,s,a,r,2),r.u_is_halo=0}else{if(n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,Ys(n.buffers,e.segments,i,t,n.program,n.depthMode,s,a,r,1)),r.u_is_halo=0}Ys(n.buffers,e.segments,i,t,n.program,n.depthMode,s,a,n.uniformValues,1)}}}function Ys(e,t,n,i,r,s,a,o,l,c){const d=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer,e.orientationVertexBuffer];r.draw(i,i.context.gl.TRIANGLES,s,a,o,Zn.disabled,l,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),d,c)}function Zs(t,n){const i=1<<t.canonical.z,r=(n.x*i-t.canonical.x-t.wrap*i)*e.aj,s=(n.y*i-t.canonical.y)*e.aj,a=e.e2(n.z,n.y);return e.d2(r,s,a)}function Xs(t,n,i,r,s){if(!i.layout||"none"===i.layout.get("fill-elevation-reference"))return;const a=t.context.gl,o=new Hn(t.context.gl.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D),l=new Hn(t.context.gl.GREATER,Hn.ReadWrite,t.depthRangeFor3D),c=function(t){const n=e.cU(t.pitch);let i=.01;return t.isOrthographic&&(i=e.ai(1e-4,i,e.cZ(n>=ni?1:n/ni))),2*i}(t.transform),d=t.transform.getFreeCameraOptions().position,u="elevatedStructuresDepthReconstruct",h=t.getOrCreateProgram(u,{defines:["DEPTH_RECONSTRUCTION"]}),p=t.getOrCreateProgram(u);for(const e of r){const r=n.getTile(e),u=r.getBucket(i);if(!u)continue;const m=u.elevatedStructures;if(!m)continue;const f=u.elevationBufferData.heightRange,g=Zs(e.toUnwrapped(),d),x=t.translatePosMatrix(e.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));let y,v,_,b;if("initialize"===s){if(!f||f.min>=1||0===m.depthSegments.segments[0].primitiveLength)continue;y=us(x,g,c,1,0),v=o,_=m.depthSegments,b=h}else if("reset"===s){if(!f||f.min>=0||0===m.maskSegments.segments[0].primitiveLength)continue;y=us(x,g,0,0,1),v=l,_=m.maskSegments,b=h}else if("geometry"===s){if(0===m.depthSegments.segments[0].primitiveLength)continue;y=us(x,g,c,1,0),v=o,_=m.depthSegments,b=p}b.draw(t,a.TRIANGLES,v,Wn.disabled,Un.disabled,Zn.disabled,y,i.id,m.vertexBuffer,m.indexBuffer,_,i.paint,t.transform.zoom)}}function Ks(t,n,i){const{painter:r,sourceCache:s,layer:a,coords:o,colorMode:l,elevationType:c,terrainEnabled:d,pass:u}=t,h=r.context.gl,p=a.paint.get("fill-pattern"),m=a.paint.get("fill-pattern-cross-fade"),f=p.constantOr(null);let g=c;"road"!==c||n&&!d||(g="none");const x="road"===g,y=t.painter.shadowRenderer,v=x&&!!y&&y.enabled,_=new Hn(r.context.gl.LEQUAL,Hn.ReadOnly,r.depthRangeFor3D);let b=[0,0,0];if(v){const e=r.style.directionalLight,t=r.style.ambientLight;e&&t&&(b=ui(r.style,e,t))}const w=p&&p.constantOr(1),j=(t,u)=>{let p,g,j,N,S;u?(p=w&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=h.LINES):(p=w?"fillPattern":"fill",j=h.TRIANGLES);for(const k of o){const o=s.getTile(k);if(w&&!o.patternsLoaded())continue;const T=o.getBucket(a);if(!T)continue;const C=n?T.elevationBufferData:T.bufferData;if(C.isEmpty())continue;r.prepareDrawTile();const E=C.programConfigurations.get(a.id),A=r.isTileAffectedByFog(k),M=[],D=[];x&&(M.push("ELEVATED_ROADS"),D.push(C.elevatedLayoutVertexBuffer)),v&&M.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),w&&(r.context.activeTexture.set(h.TEXTURE0),o.imageAtlasTexture&&o.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),E.updatePaintBuffers());let I=!1;if(f&&o.imageAtlas){const t=o.imageAtlas,n=e.dZ.from(f),i=n.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),r=n.getSecondary(),s=t.patternPositions.get(i),a=r?t.patternPositions.get(r.scaleSelf(e.q.devicePixelRatio).toString()):null;I=!!s&&!!a,s&&E.setConstantPatternPositions(s,a)}m>0&&(I||E.getPatternTransitionVertexBuffer("fill-pattern"))&&M.push("FILL_PATTERN_TRANSITION");const P=r.getOrCreateProgram(p,{config:E,overrideFog:A,defines:M}),R=r.translatePosMatrix(k.projMatrix,o,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));v&&y.setupShadows(o.tileID.toUnwrapped(),P,"vector-tile");const L=a.paint.get("fill-emissive-strength");if(u){N=C.lineIndexBuffer,S=C.lineSegments;const e=r.terrain&&r.terrain.renderingToTexture?r.terrain.drapeBufferSize:[h.drawingBufferWidth,h.drawingBufferHeight];g="fillOutlinePattern"===p&&w?cs(R,L,r,o,e,b,m):ls(R,L,e,b)}else N=C.indexBuffer,S=C.triangleSegments,g=w?os(R,L,r,o,b,m):as(R,L,b);r.uploadCommonUniforms(r.context,P,k.toUnwrapped());let z=t;("road"===c&&!d||"offset"===c)&&(z=_),P.draw(r,j,z,i||r.stencilModeForClipping(k),l,Zn.disabled,g,a.id,C.layoutVertexBuffer,N,S,a.paint,r.transform.zoom,E,D)}};r.renderPass===u&&j(r.depthModeForSublayer(1,"opaque"===r.renderPass?Hn.ReadWrite:Hn.ReadOnly),!1),"none"===g&&"translucent"===r.renderPass&&a.paint.get("fill-antialias")&&j(r.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Hn.ReadOnly),!0)}function Qs(t,n,i,r,s,a,o,l){i.resetLayerRenderingStats(t);const c=t.context,d=c.gl,u=t.transform,h=i.paint.get("fill-extrusion-pattern"),p=i.paint.get("fill-extrusion-pattern-cross-fade"),m=h.constantOr(null),f=h.constantOr(1),g=i.paint.get("fill-extrusion-opacity"),x=t.style.enable3dLights(),y=i.paint.get(x&&!f?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),v=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),y],_=i.layout.get("fill-extrusion-edge-radius"),b=_>0&&!i.paint.get("fill-extrusion-rounded-roof"),w=b?0:_,j="globe"===u.projection.name?e.e5():0,N="globe"===u.projection.name,S=N?e.ah(u.zoom):0,k=[e.aD(u.center.lng),e.aH(u.center.lat)],T="none"===i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),C=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(T?null:i.lut).toArray01().slice(0,3),E=i.paint.get("fill-extrusion-flood-light-intensity"),A=i.paint.get("fill-extrusion-vertical-scale"),M=0!==i.paint.get("fill-extrusion-line-width").constantOr(1),D=i.paint.get("fill-extrusion-height-alignment"),I=i.paint.get("fill-extrusion-base-alignment"),P=ri(t,i.paint.get("fill-extrusion-cutoff-fade-range")),R=[];let L;N&&R.push("PROJECTION_GLOBE_VIEW"),v[0]>0&&R.push("FAUX_AO"),b&&R.push("ZERO_ROOF_RADIUS"),l&&R.push("HAS_CENTROID"),E>0&&R.push("FLOOD_LIGHT"),P.shouldRenderCutoff&&R.push("RENDER_CUTOFF"),M&&R.push("RENDER_WALL_MODE");const z="shadow"===t.renderPass,O=t.shadowRenderer,F=z&&!!O,B=z?Zn.disabled:Zn.backCCW;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let V=[0,0,0];if(O){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(V=ui(t.style,e,n)),z||(R.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&R.push("NORMAL_OFFSET")),L=R.concat(["SHADOWS_SINGLE_CASCADE"])}const U=F?"fillExtrusionDepth":f?"fillExtrusionPattern":"fillExtrusion",H=i.getLayerRenderingStats();for(const q of r){const r=n.getTile(q),h=r.getBucket(i);if(!h||h.projection.name!==u.projection.name)continue;let x=!1;O&&(x=0===O.getMaxCascadeForTile(q.toUnwrapped()));const y=t.isTileAffectedByFog(q),_=h.programConfigurations.get(i.id);let b=!1;if(m&&r.imageAtlas){const t=r.imageAtlas,n=e.dZ.from(m),i=n.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),s=n.getSecondary(),a=t.patternPositions.get(i),o=s?t.patternPositions.get(s.scaleSelf(e.q.devicePixelRatio).toString()):null;b=!!a&&!!o,a&&_.setConstantPatternPositions(a,o)}p>0&&(b||_.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&R.push("FILL_EXTRUSION_PATTERN_TRANSITION");const T=t.getOrCreateProgram(U,{config:_,defines:x?L:R,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(r,T,{useMeterToDem:!0}),!h.centroidVertexBuffer){const e=T.attributes.a_centroid_pos;void 0!==e&&d.vertexAttrib2f(e,0,0)}!z&&O&&O.setupShadows(r.tileID.toUnwrapped(),T,"vector-tile"),f&&(t.context.activeTexture.set(d.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),_.updatePaintBuffers());const F=i.paint.get("fill-extrusion-vertical-gradient"),W=1/h.tileToMeter;let G;if(z&&O){if(ra(r.tileID,h.maxHeight,t))continue;const e=O.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());G=rs(e,w,W,A,D,I)}else{const e=t.translatePosMatrix(q.expandedProjMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),n=u.projection.createInversionMatrix(u,q.canonical);G=f?ss(e,t,F,g,v,w,W,q,r,j,D,I,S,k,n,C,A,p):is(e,t,F,g,v,w,W,q,j,D,I,S,k,n,C,A,E,V)}t.uploadCommonUniforms(c,T,q.toUnwrapped(),null,P);let Y=h.segments;if("mercator"===u.projection.name&&!z&&(Y=h.getVisibleSegments(r.tileID,t.terrain,t.transform.getFrustum(0)),!Y.get().length))continue;if(H)if(z)for(const e of Y.get())H.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of Y.get())H.numRenderedVerticesInTransparentPass+=e.primitiveLength;const Z=[];(t.terrain||l)&&Z.push(h.centroidVertexBuffer),N&&Z.push(h.layoutVertexExtBuffer),M&&Z.push(h.wallVertexBuffer),T.draw(t,c.gl.TRIANGLES,s,a,o,B,G,i.id,h.layoutVertexBuffer,h.indexBuffer,Y,i.paint,t.transform.zoom,_,Z)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}class Js{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function $s(t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_){const b=n.context,w=b.gl,j=n.transform,N=n.transform.zoom,S=[],k=t.translate,T=t.translateAnchor,C=t.edgeRadius,E=ri(n,t.cutoffFadeRange);"clear"===u?(S.push("CLEAR_SUBPASS"),_&&(S.push("CLEAR_FROM_TEXTURE"),b.activeTexture.set(w.TEXTURE0),_.bind(w.LINEAR,w.CLAMP_TO_EDGE))):"sdf"===u&&S.push("SDF_SUBPASS"),y&&S.push("HAS_CENTROID"),E.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const A=(e,t,i,s,u)=>{const v=t.programConfigurations.get(r.id),w=n.isTileAffectedByFog(e),j=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:v,defines:S,overrideFog:w}),k=((e,t,n,i,r,s,a,o,l,c,d)=>({u_matrix:t,u_opacity:n,u_ao_pass:i?1:0,u_meter_to_tile:r,u_ao:s,u_flood_light_intensity:a,u_flood_light_color:o,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:d,u_dynamic_offset:1}))(0,s,h,d,u,[p,m*u],f,g,x,N>=17?0:C*u,_?_.size[0]:0),T=[];y&&T.push(t.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(b,j,e.toUnwrapped(),null,E),j.draw(n,b.gl.TRIANGLES,a,o,l,c,k,r.id,t.vertexBuffer,t.indexBuffer,i,r.paint,N,v,T)};for(const M of s){const t=i.getTile(M),s=t.getBucket(r);if(!s||s.projection.name!==j.projection.name||!s.groundEffect||s.groundEffect&&!s.groundEffect.hasData())continue;const a=s.groundEffect,o=1/s.tileToMeter;{const e=n.translatePosMatrix(M.projMatrix,t,k,T),i=a.getDefaultSegment();A(M,a,i,e,o)}if(v)for(let l=0;l<4;l++){const s=e.e3[l](M),a=i.getTile(s);if(!a)continue;const c=a.getBucket(r);if(!c||c.projection.name!==j.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const d=c.groundEffect;let u,h;0===l?(u=[-e.aj,0,0],h=1):1===l?(u=[e.aj,0,0],h=0):2===l?(u=[0,-e.aj,0],h=3):(u=[0,e.aj,0],h=2);const p=d.regionSegments[h];if(!p)continue;const m=new Float32Array(16);e.bo(m,M.projMatrix,u),A(M,d,p,n.translatePosMatrix(m,t,k,T),o)}}}function ea(t,n,i,r,s,a,o){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const l=a?a.findDEMTileFor(i):null;if(!(l&&l.dem||o))return;a&&l&&l.dem&&r.selfDEMTileTimestamp!==l.dem._timestamp&&(r.borderDoneWithNeighborZ=[-1,-1,-1,-1],r.selfDEMTileTimestamp=l.dem._timestamp);const c=t=>new e.P(Math.ceil((t+e.e7)*e.e8),0),d=e=>{const t=n.getSource().minzoom,i=e=>{const t=n.getTileByID(e);if(t&&t.hasData())return t.getBucket(s)},r=[0,-1,1];for(const n of r){if(e.overscaledZ+n<t)continue;const r=i(e.calculateScaledKey(e.overscaledZ+n));if(r)return r}},u=[0,0,0],h=(t,n)=>(u[0]=Math.min(t.min.y,n.min.y),u[1]=Math.max(t.max.y,n.max.y),u[2]=e.aj-n.min.x>t.max.x?n.min.x-e.aj:t.max.x,u),p=(t,n)=>(u[0]=Math.min(t.min.x,n.min.x),u[1]=Math.max(t.max.x,n.max.x),u[2]=e.aj-n.min.y>t.max.y?n.min.y-e.aj:t.max.y,u),m=[(e,t)=>h(e,t),(e,t)=>h(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],f=(t,n,r,s,o,c,d)=>{if(!a)return 0;const u=[[c?r:t,c?t:r,0],[c?r:n,c?n:r,0]],h=d<0?e.aj+d:d,p=[c?h:(t+n)/2,c?(t+n)/2:h,0];return 0===r&&d<0||0!==r&&d>0?a.getForTilePoints(o,[p],!0,s):u.push(p),a.getForTilePoints(i,u,!0,l),Math.max(u[0][2],u[1][2],p[2])/a.exaggeration()};for(let y=0;y<4;y++){const t=r.borderFeatureIndices[y];if(0===t.length)continue;const n=e.e3[y](i),s=d(n);if(!(s&&s instanceof e.e4))continue;const l=a?a.findDEMTileFor(n):null;if(!(l&&l.dem||o))continue;if(a&&l&&l.dem&&r.borderDEMTileTimestamp[y]!==l.dem._timestamp&&(r.borderDoneWithNeighborZ[y]=-1,r.borderDEMTileTimestamp[y]=l.dem._timestamp),r.borderDoneWithNeighborZ[y]===s.canonical.z)continue;0===s.centroidVertexArray.length&&s.createCentroidsBuffer();const u=(y<2?1:5)-y,h=s.borderDoneWithNeighborZ[u]!==r.canonical.z,p=s.borderFeatureIndices[u];let v=0;if(r.canonical.z!==s.canonical.z){for(const e of t)r.showCentroid(r.featuresOnBorder[e]);if(h)for(const e of p)s.showCentroid(s.featuresOnBorder[e]);r.borderDoneWithNeighborZ[y]=s.canonical.z,s.borderDoneWithNeighborZ[u]=r.canonical.z}for(const i of t){const t=r.featuresOnBorder[i],a=r.centroidData[t.centroidDataIndex],d=t.borders[y];let h;for(;v<p.length;){h=s.featuresOnBorder[p[v]];const e=h.borders[u];if(e[1]>d[0]+3||e[0]>d[0]-3)break;s.showCentroid(h),v++}if(h&&v<p.length){const i=v;let _=0;for(;!(h.borders[u][0]>d[1]-3)&&(_++,++v!==p.length);)h=s.featuresOnBorder[p[v]];h=s.featuresOnBorder[p[i]];let b=!1;if(_>=1){const e=h.borders[u];Math.abs(d[0]-e[0])<3&&Math.abs(d[1]-e[1])<3&&(_=1,b=!0,v=i+1)}else if(0===_){r.showCentroid(t);continue}const w=s.centroidData[h.centroidDataIndex];o&&b&&(((g=a).flags|(x=w).flags)&e.e6?(g.flags|=e.e6,x.flags|=e.e6):(g.flags&=~e.e6,x.flags&=~e.e6));const j=t.intersectsCount()>1||h.intersectsCount()>1;if(_>1)v=i,a.centroidXY=w.centroidXY=new e.P(0,0);else if(l&&l.dem&&!j){const t=m[y](a,w),i=y%2?e.aj-1:0,r=f(t[0],Math.min(e.aj-1,t[1]),i,l,n,y<2,t[2]);a.centroidXY=w.centroidXY=c(r)}else j?a.centroidXY=w.centroidXY=new e.P(0,0):(a.centroidXY=r.encodeBorderCentroid(t),w.centroidXY=s.encodeBorderCentroid(h));r.writeCentroidToBuffer(a),s.writeCentroidToBuffer(w)}else r.showCentroid(t)}r.borderDoneWithNeighborZ[y]=s.canonical.z,s.borderDoneWithNeighborZ[u]=r.canonical.z}var g,x;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const ta=[1,0,0],na=[0,1,0],ia=[0,0,1];function ra(t,n,i){const r=i.transform,s=i.shadowRenderer;if(!s)return!0;const a=t.toUnwrapped(),o=r.tileSize*s._cascades[i.currentShadowCascade].scale;let l=n;if(r.elevation){const e=r.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...s.shadowDirection];c[2]=-c[2];const d=s.computeSimplifiedTileShadowVolume(a,l,o,c);if(!d)return!1;const u=[ta,na,ia,c,[c[0],0,c[2]],[0,c[1],c[2]]],h="globe"===r.projection.name,p=r.scaleZoom(o),m=e.cy.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,p,!h),f=s.getCurrentCascadeFrustum();return 0===m.intersectsPrecise(d.vertices,d.planes,u)||0===f.intersectsPrecise(d.vertices,d.planes,u)}function sa(t){const{painter:n,source:i,layer:r,coords:s}=t,a=t.defines,o=n.context,l="shadow"===n.renderPass,c="light-beam"===n.renderPass,d=n.shadowRenderer;let u;d&&(u=a.concat(["SHADOWS_SINGLE_CASCADE"]));const h=e.e9(n.transform.center.lat,n.transform.zoom);for(const p of s){const s=i.getTile(p),m=s.getBucket(r);if(!m)continue;let f=!1;d&&(f=0===d.getMaxCascadeForTile(p.toUnwrapped()));const g=m.programConfigurations.get(r.id);let x,y,v=n.translatePosMatrix(p.expandedProjMatrix,s,[0,0],"map");if(v=e.cP(e.bz(),v,[1,1,t.verticalScale]),l&&d){if(ra(s.tileID,m.maxHeight*h,n))continue;let i=d.calculateShadowPassMatrixFromTile(s.tileID.toUnwrapped());i=e.cP(e.bz(),i,[1,1,t.verticalScale]),y=ms(i),x=n.getOrCreateProgram("buildingDepth",{config:g,defines:f?u:a,overrideFog:!1})}else if(c)x=n.getOrCreateProgram("buildingBloom",{config:g,defines:f?u:a,overrideFog:!1}),y=ps(v);else{const i=n.transform.calculatePosMatrix(p.toUnwrapped(),n.transform.worldSize);e.cP(i,i,[1,1,t.verticalScale]);const r=e.bz();e.cP(r,i,[1,-1,1/h]),e.bi(r,r),e.ea(r,r),y=hs(v,r),x=n.getOrCreateProgram("building",{config:g,defines:f?u:a,overrideFog:!1}),d&&d.setupShadowsFromMatrix(i,x,!0)}if(n.uploadCommonUniforms(o,x,p.toUnwrapped(),null,null),c){const e=m.bloomGeometry;x.draw(n,o.gl.TRIANGLES,t.depthMode,Wn.disabled,t.blendMode,Zn.disabled,y,r.id,e.layoutVertexBuffer,e.indexBuffer,e.segmentsBucket,r.paint,n.transform.zoom,g,[e.layoutAttenuationBuffer,e.layoutColorBuffer])}else x.draw(n,o.gl.TRIANGLES,t.depthMode,Wn.disabled,t.blendMode,l?Zn.disabled:Zn.backCW,y,r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,n.transform.zoom,g,[m.layoutNormalBuffer,m.layoutColorBuffer])}}function aa(t){return[t[0]*e.eb,t[1]*e.eb,t[2]*e.eb,0]}function oa(t,n,i,r,s,a,o,l,c){const d=r.getSource(),u=i.globeSharedBuffers;if(!u)return;let h,p,m;if(n&&(h=r.getTile(n)),d instanceof e.aP?(p=d.texture,m=e.dE(0,0,i.transform)):h&&n&&(p=h.texture,m=e.dE(n.canonical.z,n.canonical.x,i.transform)),!p||!m)return;t||(m=e.cP(e.bz(),m,[1,-1,1]));const f=i.context,g=f.gl,x="nearest"===s.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=i.colorModeForDrapableLayerRenderPass(a),v=o.defines;v.push("GLOBE_POLES");const _=new Hn(g.LEQUAL,Hn.ReadWrite,i.depthRangeFor3D),b=Float32Array.from(i.transform.expandedFarZProjMatrix),w=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),f.activeTexture.set(g.TEXTURE0),p.bind(x,g.CLAMP_TO_EDGE),f.activeTexture.set(g.TEXTURE1),p.bind(x,g.CLAMP_TO_EDGE),"useMipmap"in p&&f.extTextureFilterAnisotropic&&i.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax);const[j,N,S,k]=n?u.getPoleBuffers(n.canonical.z,!1):u.getPoleBuffers(0,!0),T=s.paint.get("raster-elevation");let C;t?(C=j,i.renderDefaultNorthPole=0!==T):(C=N,i.renderDefaultSouthPole=0!==T);const E=aa(o.mix),A=((e,t,n,i,r,s,a,o,l,c,d,u,h)=>bs(e,t,n,new Float32Array(16),new Float32Array(9),[0,0],i,[0,0],[0,0,0,0],1,{opacity:1,mix:0},s,[0,0]||0,o,2,c,d,u,1,0,h))(b,w,m,e.ah(i.transform.zoom),0,s,0,T,0,E,o.offset,o.range,a),M=i.getOrCreateProgram("raster",{defines:v});i.uploadCommonUniforms(f,M,null),M.draw(i,g.TRIANGLES,_,c,y,l,A,s.id,C,S,k)}function la(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),i=n-t,r=.2*e.height,s=t+r;return[t,n,(s-r-t)/i,(s-t)/i]}function ca(e,t,n,i){if(e)return t instanceof ot&&e instanceof kt?t.getTextureDescriptor(e,n,!0):{texture:e.texture,mix:aa(i.mix),offset:i.offset,buffer:0,tileSize:1}}var da=e.ec([{name:"a_index",type:"Int16",components:1}]);class ua{constructor(t,n,i,r){const s={width:i[0],height:i[1],data:null},a=t.gl;this.targetColorTexture=new e.T(t,s,a.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,s,a.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,r),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const i=this.context.gl,r=n.width*n.height;this.particleTexture0=new e.T(this.context,n,i.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,n,i.RGBA8,{premultiply:!1,useMipmap:!1});const s=new e.ed;s.reserve(r);for(let e=0;e<r;e++)s.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(s,da.members,!0),this.particleSegment=e.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ha(t,n,i){if(!t)return null;const r=n.getTextureDescriptor(t,i,!0);if(!r)return null;let{texture:s,mix:a,offset:o,tileSize:l,buffer:c,format:d}=r;if(!s||!d)return null;let u=!1;return"uint32"===d&&(u=!0,a[3]=0,a=vs(e.ee,a,[0,i.paint.get("raster-particle-max-speed")]),o=_s(e.ee,o,[0,i.paint.get("raster-particle-max-speed")])),{texture:s,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:u,scale:a,offset:o,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[d]]}}function pa(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),i=n-t,r=.2*e.height,s=t+r;return[t,n,(s-r-t)/i,(s-t)/i]}const ma=new e.am(1,0,0,1),fa=new e.am(0,1,0,1),ga=new e.am(0,0,1,1),xa=new e.am(1,0,1,1),ya=new e.am(0,1,1,1);function va(t,n,i,r,s,a){for(let o=0;o<i.length;o++)if(s){const s=1,l=.8,c=new e.am(r.r*l,r.g*l,r.b*l,1);_a(t,n,i[o],r,-s,-s,a),_a(t,n,i[o],r,-s,s,a),_a(t,n,i[o],r,s,s,a),_a(t,n,i[o],r,s,-s,a),_a(t,n,i[o],c,0,0,a)}else _a(t,n,i[o],r,0,0,a)}function _a(t,n,i,r,s,a,o){const l=t.context,c=t.transform,d=l.gl,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[];let p=e.bw(i.projMatrix);if(u&&e.ah(c.zoom)>0){const t=e.bg(i.canonical,c),n=e.ef(t);p=e.az(new Float32Array(16),c.globeMatrix,n),e.az(p,c.projMatrix,p)}const m=e.bz();m[12]+=2*s/(e.q.devicePixelRatio*c.width),m[13]+=2*a/(e.q.devicePixelRatio*c.height),e.az(p,m,p);const f=t.getOrCreateProgram("debug",{defines:h}),g=n.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(g,f);const x=Hn.disabled,y=Wn.disabled,v=t.colorModeForRenderPass(),_="$debug";l.activeTexture.set(d.TEXTURE0),t.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),u?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,w=g._tileDebugIndexBuffer||t.debugIndexBuffer,j=g._tileDebugSegments||t.debugSegments;if(f.draw(t,d.LINE_STRIP,x,y,v,Zn.disabled,gs(p,r.toPremultipliedRenderColor(null)),_,b,w,j,null,null,null,[g._globeTileDebugBorderBuffer]),o){const e=g.latestRawTileData,n=Math.floor((e&&e.byteLength||0)/1024);let r=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(r+=" => ".concat(i.overscaledZ)),r+=" ".concat(g.state),r+=" ".concat(n,"kb"),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,r)}const N=n.getTile(i).tileSize,S=512/Math.min(N,512)*(i.overscaledZ/c.zoom)*.5,k=g._tileDebugTextBuffer||t.debugBuffer,T=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,C=g._tileDebugTextSegments||t.debugSegments;f.draw(t,d.TRIANGLES,x,y,Un.alphaBlended,Zn.disabled,gs(p,e.am.transparent.toPremultipliedRenderColor(null),S),_,k,T,C,null,null,null,[g._globeTileDebugTextBuffer])}function ba(e,t,n,i){ja(e,0,t+n/2,e.transform.width,n,i)}function wa(e,t,n,i){ja(e,t-n/2,0,n,e.transform.height,i)}function ja(t,n,i,r,s,a){const o=t.context,l=o.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.q.devicePixelRatio,i*e.q.devicePixelRatio,r*e.q.devicePixelRatio,s*e.q.devicePixelRatio),o.clear({color:a}),l.disable(l.SCISSOR_TEST)}const Na=e.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sa}=Na;function ka(e,t,n,i){e.emplaceBack(t,n,i)}class Ta{constructor(t){this.vertexArray=new e.eg,this.indices=new e.a_,ka(this.vertexArray,-1,-1,1),ka(this.vertexArray,1,-1,1),ka(this.vertexArray,-1,1,1),ka(this.vertexArray,1,1,1),ka(this.vertexArray,-1,-1,-1),ka(this.vertexArray,1,-1,-1),ka(this.vertexArray,-1,1,-1),ka(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Sa),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.bd.simpleSegment(0,0,36,12)}}function Ca(t,n,i,r,s,a){const o=t.context.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),d=n.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,n,i,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.ei(e.dJ(),r),s,d,l.toPremultipliedRenderColor(null),c.toPremultipliedRenderColor(null));o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+a,n.skyboxTexture,0),i.draw(t,o.TRIANGLES,Hn.disabled,Wn.disabled,Un.unblended,Zn.frontCW,u,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Ea=e.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Aa{constructor(t){const n=new e.ej;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const i=new e.a_;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Ea.members),this.indexBuffer=t.createIndexBuffer(i),this.segments=e.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ma=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Da{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ia{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Un([1,Vn,1,Vn],e.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Un([1,0,1,0],e.am.transparent,[!1,!1,!1,!0]),this.params=new Da,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Aa(n);const t=this.params.sizeRange,i=this.params.intensityRange,r=function(t){const n=e.el(30),i=[];for(let r=0;r<t;++r){const t=2*Math.PI*n(),r=Math.acos(1-2*n())-.5*Math.PI;i.push(e.d2(Math.cos(r)*Math.cos(t),Math.cos(r)*Math.sin(t),Math.sin(r)))}return i}(this.params.starsCount),s=e.el(300),a=new e.ek,o=new e.a_;let l=0;for(let n=0;n<r.length;++n){const c=e.c1([],r[n],200),d=Math.max(0,1+.01*t*(1*s()-.5)),u=Math.max(0,1+.01*i*(1*s()-.5));a.emplaceBack(c[0],c[1],c[2],-1,-1,d,u),a.emplaceBack(c[0],c[1],c[2],1,-1,d,u),a.emplaceBack(c[0],c[1],c[2],1,1,d,u),a.emplaceBack(c[0],c[1],c[2],-1,1,d,u),o.emplaceBack(l+0,l+1,l+2),o.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=n.createVertexBuffer(a,Ma.members),this.starsIdx=n.createIndexBuffer(o),this.starsSegments=e.bd.simpleSegment(0,0,a.length,o.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const i=t.context,r=i.gl,s=t.transform,a=new Hn(r.LEQUAL,Hn.ReadOnly,[0,1]),o=e.ah(s.zoom),l=t.style.getLut(n.scope),c="none"===n.properties.get("color-use-theme"),d=n.properties.get("color").toNonPremultipliedRenderColor(c?null:l).toArray01(),u="none"===n.properties.get("high-color-use-theme"),h=n.properties.get("high-color").toNonPremultipliedRenderColor(u?null:l).toArray01(),p="none"===n.properties.get("space-color-use-theme"),m=n.properties.get("space-color").toNonPremultipliedRenderColor(p?null:l).toArray01(),f=5e-4,g=e.em(n.properties.get("horizon-blend"),0,1,f,.25),x=e.dy(t,i,s)&&g===f?s.worldSize/(2*Math.PI*1.025)-1:s.globeRadius,y=t.frameCounter/1e3%1,v=e.ae(s.globeCenterInViewSpace),_=Math.sqrt(Math.pow(v,2)-Math.pow(x,2)),b=Math.acos(_/v),w=e=>{const n="globe"===s.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&n.push("ALPHA_PASS");const l=t.getOrCreateProgram("globeAtmosphere",{defines:n}),c=((e,t,n,i,r,s,a,o,l,c,d,u)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:n,u_frustum_bl:i,u_horizon:r,u_transition:s,u_fadeout_range:a,u_color:o,u_high_color:l,u_space_color:c,u_temporal_offset:d,u_horizon_angle:u}))(s.frustumCorners.TL,s.frustumCorners.TR,s.frustumCorners.BR,s.frustumCorners.BL,s.frustumCorners.horizon,o,g,d,h,m,y,b);t.uploadCommonUniforms(i,l);const u=this.atmosphereBuffer;u&&l.draw(t,r.TRIANGLES,a,Wn.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Zn.backCW,c,e?"atmosphere_glow_alpha":"atmosphere_glow",u.vertexBuffer,u.indexBuffer,u.segments)};w(!1),w(!0)}drawStars(t,n){const i=e.ay(n.properties.get("star-intensity"),0,1);if(0===i)return;const r=t.context,s=r.gl,a=t.transform,o=t.getOrCreateProgram("stars"),l=e.c3([]);e.c5(l,l,-a._pitch),e.c4(l,l,-a.angle),e.c5(l,l,e.al(a._center.lat)),e.en(l,l,-e.al(a._center.lng));const c=e.c8(new Float32Array(16),l),d=e.az([],a.starsProjMatrix,c),u=e.ei([],c),h=e.eo([],u),p=[0,1,0];e.dL(p,p,h),e.c1(p,p,this.params.sizeMultiplier);const m=[1,0,0];e.dL(m,m,h),e.c1(m,m,this.params.sizeMultiplier);const f=(g=p,x=m,y=i,{u_matrix:Float32Array.from(d),u_up:g,u_right:x,u_intensity_multiplier:y});var g,x,y;t.uploadCommonUniforms(r,o),this.starsVx&&this.starsIdx&&o.draw(t,s.TRIANGLES,Hn.disabled,Wn.disabled,this.colorModeAlphaBlendedWriteRGB,Zn.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Pa{constructor(){this.visibleTiles=[]}updateBorders(t,n){const i=[],r=[],s=t._getRenderableCoordinates(!1,!0);for(const e of s){const s=t.getTile(e);if(!s.hasData())continue;const a=s.getBucket(n);a&&(a.isEmpty()||(i.push(e.key),r.push({bucket:a,tileID:e.canonical})))}let a=i.length!==this.visibleTiles.length;if(!a){i.sort();for(let e=0;e<i.length;e++)if(i[e]!==this.visibleTiles[e]){a=!0;break}}if(!a)return;const o=new Set;this.visibleTiles=i,r.sort((e,t)=>e.tileID.z-t.tileID.z||e.tileID.x-t.tileID.x||e.tileID.y-t.tileID.y);for(const l of r){const t=new Array,n=new Array,i=l.bucket;for(const e of i.featuresOnBorder)o.has(e.featureId)?n.push(e.footprintIndex):(o.add(e.featureId),t.push(e.footprintIndex));i.updateFootprintHiddenFlags(t,e.ep,!1),i.updateFootprintHiddenFlags(n,e.ep,!0)}}}function Ra(t,n){const i=[...t],r=n.cameraWorldSizeForFog/n.worldSize,s=e.bx([]);return e.cP(s,s,[r,r,1]),e.az(i,s,i),e.az(i,n.worldToFogMatrix,i),i}function La(t,n,i,r,s){const a=i.material,o=r.context,{baseColorTexture:l,metallicRoughnessTexture:c}=a.pbrMetallicRoughness,{normalTexture:d,occlusionTexture:u,emissionTexture:h}=a;function p(e,n,i){if(e&&(t.push(n),o.activeTexture.set(o.gl.TEXTURE0+i),e.gfxTexture)){const{minFilter:t,magFilter:n,wrapS:i,wrapT:r}=e.sampler;e.gfxTexture.bindExtraParam(t,n,i,r)}}p(l,"HAS_TEXTURE_u_baseColorTexture",ei.BaseColor),p(c,"HAS_TEXTURE_u_metallicRoughnessTexture",ei.MetallicRoughness),p(d,"HAS_TEXTURE_u_normalTexture",ei.Normal),p(u,"HAS_TEXTURE_u_occlusionTexture",ei.Occlusion),p(h,"HAS_TEXTURE_u_emissionTexture",ei.Emission),s&&(s.texture||(s.texture=new e.et(r.context,s.image,[s.image.height,s.image.height,s.image.height],o.gl.RGBA8)),o.activeTexture.set(o.gl.TEXTURE0+ei.LUT),s.texture&&s.texture.bind(o.gl.LINEAR,o.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),i.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(i.texcoordBuffer)),i.colorBuffer&&(t.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(i.colorBuffer)),i.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(i.normalBuffer)),i.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(i.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||t.push("DIFFUSE_SHADED");const m=r.shadowRenderer;m&&(t.push("RENDER_SHADOWS","DEPTH_TEXTURE"),m.useNormalOffset&&t.push("NORMAL_OFFSET"))}function za(t,n,i,r,s,a){const o=i.paint.get("model-opacity").constantOr(1),l=n.context,c=new Hn(n.context.gl.LEQUAL,Hn.ReadWrite,n.depthRangeFor3D),d=n.transform,u=t.mesh,h=u.material,p=h.pbrMetallicRoughness,m=n.style.fog;let f;f="pixels"===n.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.az([],r.zScaleMatrix,t.nodeModelMatrix),e.az(f,r.negCameraPosMatrix,f);const g=e.bi([],f);e.ea(g,g);const x="none"===i.paint.get("model-color-use-theme").constantOr("default"),y=i.paint.get("model-emissive-strength").constantOr(0),v=Ds(new Float32Array(t.worldViewProjection),new Float32Array(f),new Float32Array(g),null,n,o,p.baseColorFactor,h.emissiveFactor,p.metallicFactor,p.roughnessFactor,h,y,i),_={defines:[]},b=[],w=n.shadowRenderer;w&&(w.useNormalOffset=!1),La(_.defines,b,u,n,x?null:i.lut);let j=null;if(m){const e=Ra(t.nodeModelMatrix,n.transform);if(j=new Float32Array(e),"globe"!==d.projection.name){const t=u.aabb.min,n=u.aabb.max,[i,r]=m.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);_.overrideFog=i>=Fe||r>=Fe}}const N=ri(n,i.paint.get("model-cutoff-fade-range"));N.shouldRenderCutoff&&_.defines.push("RENDER_CUTOFF");const S=n.getOrCreateProgram("model",_);n.uploadCommonUniforms(l,S,null,j,N),"shadow"!==n.renderPass&&w&&w.setupShadowsFromMatrix(t.nodeModelMatrix,S),S.draw(n,l.gl.TRIANGLES,c,s,a,u.material.doubleSided?Zn.disabled:Zn.backCCW,v,i.id,u.vertexBuffer,u.indexBuffer,u.segments,i.paint,n.transform.zoom,void 0,b)}function Oa(t,n,i,r,s,a,o){let l;l="globe"===t.projection.name?e.er(i,t):[...i],e.az(l,l,n.matrix);const c=e.az([],r,l);if(n.meshes)for(const d of n.meshes){if("BLEND"!==d.material.alphaMode){o.push({mesh:d,depth:0,modelIndex:s,worldViewProjection:c,nodeModelMatrix:l});continue}const n=e.ad([],d.centroid,c);!t.isOrthographic&&n[2]<=0||a.push({mesh:d,depth:n[2],modelIndex:s,worldViewProjection:c,nodeModelMatrix:l})}if(n.children)for(const e of n.children)Oa(t,e,i,r,s,a,o)}function Fa(e,t,n,i){const r=n.shadowRenderer;if(!r)return;const s=r.getShadowPassDepthMode(),a=r.getShadowPassColorMode(),o=r.calculateShadowPassMatrixFromMatrix(t),l=Is(o);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,s,Wn.disabled,a,Zn.backCCW,l,i.id,e.vertexBuffer,e.indexBuffer,e.segments,i.paint,n.transform.zoom,void 0,void 0)}function Ba(t,n,i){const r=n.updateZoomBasedPaintProperties(),s=function(t,n,i){let r,s,a,o=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&o>0){const n=t.terrain,s=n.findDEMTileFor(i);s&&s.dem?r=e.eu.create(n,i,s):o=0}if(0===o&&(n.terrainElevationMin=0,n.terrainElevationMax=0),o===n.validForExaggeration&&(0===o||r&&r._demTile&&r._demTile.tileID===n.validForDEMTile.id&&r._dem._timestamp===n.validForDEMTile.timestamp))return!1;for(const e in n.instancesPerModel){const t=n.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const i=(r?o*r.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=i,s=s?Math.min(n.terrainElevationMin,i):i,a=a?Math.max(n.terrainElevationMax,i):i}}return n.terrainElevationMin=s||0,n.terrainElevationMax=a||0,n.validForExaggeration=o,n.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,n,i);(r||s)&&(n.uploaded=!1,n.upload(t.context))}const Va={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.d6([0,0,0],[e.aj,e.aj,0])};function Ua(t,n){const i=1<<t.canonical.z,r=n.getFreeCameraOptions().position,s=n.elevation,a=t.canonical.x/i,o=(t.canonical.x+1)/i,l=t.canonical.y/i,c=(t.canonical.y+1)/i;let d=n._centerAltitude;if(s){const e=s.getMinMaxForTile(t);e&&e.max>d&&(d=e.max)}const u=e.ay(r.x,a,o)-r.x,h=e.ay(r.y,l,c)-r.y,p=e.cb(d,n.center.lat)-r.z;return n._zoomFromMercatorZ(Math.sqrt(u*u+h*h+p*p))}function Ha(e,t,n,i,r,s,a){const o=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,d=l&&c?c.getShadowPassDepthMode():new Hn(o.gl.LEQUAL,Hn.ReadWrite,e.depthRangeFor3D),u=e.isTileAffectedByFog(s);if(n.meshes)for(const h of n.meshes){const p=["MODEL_POSITION_ON_GPU"],m=[];let f,g,x;i.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const y=ri(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)f=e.getOrCreateProgram("modelDepth",{defines:p}),g=Is(a.shadowTileMatrix,a.shadowTileMatrix,Float32Array.from(n.matrix)),x=c.getShadowPassColorMode();else{La(p,m,h,e,"none"===t.paint.get("model-color-use-theme").constantOr("default")?null:t.lut),f=e.getOrCreateProgram("model",{defines:p,overrideFog:u});const i=h.material,l=i.pbrMetallicRoughness,d=t.paint.get("model-opacity").constantOr(1),v=t.paint.get("model-emissive-strength").constantOr(0);g=Ds(s.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,e,d,l.baseColorFactor,i.emissiveFactor,l.metallicFactor,l.roughnessFactor,i,v,t,r),c&&(a.shadowUniformsInitialized?f.setShadowUniformValues(o,c.getShadowUniformValues()):(c.setupShadows(s.toUnwrapped(),f,"model-tile"),a.shadowUniformsInitialized=!0)),x=y.shouldRenderCutoff||d<1||"OPAQUE"!==i.alphaMode?Un.alphaBlended:Un.unblended}e.uploadCommonUniforms(o,f,s.toUnwrapped(),null,y);const v=h.material.doubleSided?Zn.disabled:Zn.backCCW;if(i.instancedDataArray.length>20)m.push(i.instancedDataBuffer),f.draw(e,o.gl.TRIANGLES,d,Wn.disabled,x,v,g,t.id,h.vertexBuffer,h.indexBuffer,h.segments,t.paint,e.transform.zoom,void 0,m,i.instancedDataArray.length);else{const n=l?"u_instance":"u_normal_matrix";for(let r=0;r<i.instancedDataArray.length;++r)g[n]=new Float32Array(i.instancedDataArray.arrayBuffer,64*r,16),f.draw(e,o.gl.TRIANGLES,d,Wn.disabled,x,v,g,t.id,h.vertexBuffer,h.indexBuffer,h.segments,t.paint,e.transform.zoom,void 0,m)}}if(n.children)for(const h of n.children)Ha(e,t,h,i,r,s,a)}const qa=[1,-1,1];function Wa(t,n,i,r){if(!i.modelManager)return!0;const s=i.modelManager;if(!i.shadowRenderer)return!0;const a=i.shadowRenderer,o=n.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const n in t.instancesPerModel){const t=s.getModel(n,r);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}o.max[2]=c,o.min[2]+=t.terrainElevationMin,o.max[2]+=t.terrainElevationMax,e.ad(o.min,o.min,n.tileMatrix),e.ad(o.max,o.max,n.tileMatrix);const d=o.intersects(a.getCurrentCascadeFrustum());return 0===i.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===d),0===d}function Ga(t,n){const i=t.uniformValues.u_cutoff_params[0],r=t.uniformValues.u_cutoff_params[1],s=t.uniformValues.u_cutoff_params[2],a=t.uniformValues.u_cutoff_params[3];return r===i||a===s?1:e.ay(((n-i)/(r-i)-s)/(a-s),0,1)}function Ya(t,n,i,r){if(n.pitch<20)return 1;const s=n.getWorldToCameraMatrix();e.az(s,s,t);const a=e.bR(i.min[0],i.min[1],i.min[2],1);let o=e.aA(e.ev(),a,s),l=o,c=o;a[1]=i.max[1],o=e.aA(e.ev(),a,s),l=o[1]<l[1]?o:l,c=o[1]>c[1]?o:c,a[0]=i.max[0],o=e.aA(e.ev(),a,s),l=o[1]<l[1]?o:l,c=o[1]>c[1]?o:c,a[1]=i.min[1],o=e.aA(e.ev(),a,s),l=o[1]<l[1]?o:l,c=o[1]>c[1]?o:c;const d=e.ay(r[0],0,1),u=100*n.pixelsPerMeter*e.ay(r[1],0,1),h=e.ay(r[2],0,1),p=e.ew(e.ev(),l,c,d),m=Math.tan(.5*n.fovX),f=-p[2]*m;if(0===u)return p[1]<-Math.abs(f)?h:1;const g=(-Math.abs(f)-p[1])/u,x=(e,t,n)=>(1-n)*e+n*t,y=e.ay(x(1,h,g),h,1);return x(1,y,e.ay((n.pitch-20)/20,0,1))}class Za{}class Xa{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,i){{const e=this._storage.get(n.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const r=i.gl,s=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),a=new ArrayBuffer(s),o=new Int16Array(a);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const l=new e.ey;for(let e=0;e<s/2;e+=3){const t=o[e],n=o[e+1],i=o[e+2];l.emplaceBack(t,n),l.emplaceBack(n,i),l.emplaceBack(i,t)}const c=i.bindVertexArrayOES.current,d=new Za;return d.buf=new Rs(i,l),d.lastUsedFrameIdx=t,this._storage.set(n.id,d),i.bindVertexArrayOES.set(c),d.buf}update(e){for(const[t,n]of this._storage)e-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class Ka{constructor(e){this.occluderSize=30,this.depthOffset=-1e-4,e.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),e.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Qa=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ja{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class $a{constructor(e,t){this.revealStart=11,this.revealRange=2,e.registerParameter(this,[...t,"Reveal"],"revealStart",{min:0,max:17,step:.05}),e.registerParameter(this,[...t,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const eo=e.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class to{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const i=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const n=new e.ez,i=new e.a_;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1),i.emplaceBack(0,1,2),i.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(n,eo.members),this.vignetteIdx=t.context.createIndexBuffer(i)}const r=e.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,i);const e={u_vignetteShape:(s={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:s.vignetteColor};i.draw(t,t.context.gl.TRIANGLES,Hn.disabled,Wn.disabled,Un.alphaBlended,Zn.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,r)}var s}}class no{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const i=t.getFreeCameraOptions().position,r=i.toAltitude(),s=i.toLngLat(),a=e.al(s.lng),o=e.al(s.lat),l=t.pixelsPerMeter/n,c=a*e.eB,d=e.eB*Math.log(Math.tan(Math.PI/4+o/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const e=-this._offsetYPrev+d,t=-this._elevationPrev+r;this._accumulatedOffsetX+=(-this._offsetXPrev+c)*l,this._accumulatedOffsetY+=e*l,this._accumulatedElevation+=t*l,this._offsetXPrev=c,this._offsetYPrev=d,this._elevationPrev=r}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function io(e,t){return[-(e[0]-Math.floor(e[0]/t)*t),-(e[1]-Math.floor(e[1]/t)*t),-(e[2]-Math.floor(e[2]/t)*t)]}function ro(t){const n=e.el(1323123451230),i=[];for(let r=0;r<t;++r){const t=2*n()-1,r=2*n()-1,s=2*n()-1;i.push(e.d2(t,r,s))}return i}function so(t,n,i,r,s){const a=e.ay((s-i)/(r-i),0,1);return(1-a)*t+a*n}class ao{constructor(e){this._movement=new no,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new to,this._ppmScaleFactor=e}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const i=t.transform;this._movement.update(i,this._ppmScaleFactor);const r=i.starsProjMatrix,s=e.c3([]);e.c5(s,s,e.al(90)-i._pitch),e.c4(s,s,-i.angle);const a=e.c8(new Float32Array(16),s),o=e.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=e.ea([],o),c=e.az([],l,a),d=Date.now()/1e3;return this._accumulatedTimeFromStart+=(d-this._prevTime)*n,this._prevTime=d,{projectionMatrix:r,modelviewMatrix:c}}}class oo extends ao{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new $a(e.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const t=ro(this.particlesCount),i=new e.eC,r=new e.a_;let s=0;const a=e.el(1323123451230);for(let e=0;e<t.length;++e){const n=t[e],o=[2*a()-1,a(),a(),a()];i.emplaceBack(n[0],n[1],n[2],-1,-1,...o),i.emplaceBack(n[0],n[1],n[2],1,-1,...o),i.emplaceBack(n[0],n[1],n[2],1,1,...o),i.emplaceBack(n[0],n[1],n[2],-1,1,...o),r.emplaceBack(s+0,s+1,s+2),r.emplaceBack(s+0,s+2,s+3),s+=4}this.particlesVx=n.createVertexBuffer(i,Qa.members),this.particlesIdx=n.createIndexBuffer(r)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},i=t.transform.zoom;if(n.revealStart>i)return;const r=so(0,1,n.revealStart,n.revealStart+n.revealRange,i);if(!this.particlesVx||!this.particlesIdx)return;const s=structuredClone(this._params);let a=[-s.direction.x,s.direction.y,-100];e.au(a,a);const o=structuredClone(this._vignetteParams);o.strength*=r,s.overrideStyleParameters||(s.intensity=t.style.rain.state.density,s.timeFactor=t.style.rain.state.intensity,s.color=structuredClone(t.style.rain.state.color),a=structuredClone(t.style.rain.state.direction),s.screenThinning.intensity=t.style.rain.state.centerThinning,s.dropletSizeX=t.style.rain.state.dropletSize[0],s.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],s.distortionStrength=100*t.style.rain.state.distortionStrength,o.strength=1,o.color=structuredClone(t.style.rain.state.vignetteColor));const l=this.updateOnRender(t,s.timeFactor),c=t.context,d=c.gl,u=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new e.T(c,{width:t.width,height:t.height,data:null},d.RGBA8)),s.distortionStrength>0&&(c.activeTexture.set(d.TEXTURE0),this.screenTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.copyTexSubImage2D(d.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const h=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(c,h),c.activeTexture.set(d.TEXTURE0),this.screenTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE);const p=[s.color.r,s.color.g,s.color.b,s.color.a],m=(n,i)=>{const r=io(this._movement.getPosition(),n),o=s.dropletSizeX,c=s.dropletSizeX*s.dropletSizeYScale,m=t.width/2,f=t.height/2,g=so(0,s.screenThinning.start,0,1,s.screenThinning.intensity),x=so(.001,s.screenThinning.range,0,1,s.screenThinning.intensity),y=so(0,s.screenThinning.particleOffset,0,1,s.screenThinning.intensity),v=(_={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:r,velocityConeAperture:s.velocityConeAperture,velocity:s.velocity,boxSize:n,rainDropletSize:[o,c],distortionStrength:s.distortionStrength,rainDirection:a,color:p,screenSize:[u.width,u.height],thinningCenterPos:[m,f],thinningShape:[g,x,Math.pow(10,s.screenThinning.fadePower)],thinningAffectedRatio:s.screenThinning.affectedRatio,thinningParticleOffset:y,shapeDirectionalPower:s.shapeDirPower,shapeNormalPower:s.shapeNormalPower,mode:i?0:1},{u_modelview:Float32Array.from(_.modelview),u_projection:Float32Array.from(_.projection),u_time:_.time,u_cam_pos:_.camPos,u_texScreen:0,u_velocityConeAperture:_.velocityConeAperture,u_velocity:_.velocity,u_boxSize:_.boxSize,u_rainDropletSize:_.rainDropletSize,u_distortionStrength:_.distortionStrength,u_rainDirection:_.rainDirection,u_color:_.color,u_screenSize:_.screenSize,u_thinningCenterPos:_.thinningCenterPos,u_thinningShape:_.thinningShape,u_thinningAffectedRatio:_.thinningAffectedRatio,u_thinningParticleOffset:_.thinningParticleOffset,u_shapeDirectionalPower:_.shapeDirectionalPower,u_shapeNormalPower:_.shapeNormalPower,u_mode:_.mode});var _;const b=Math.round(s.intensity*this.particlesCount),w=e.bd.simpleSegment(0,0,4*b,2*b);h.draw(t,d.TRIANGLES,Hn.disabled,Wn.disabled,Un.alphaBlended,Zn.disabled,v,"rain_particles",this.particlesVx,this.particlesIdx,w)};s.distortionStrength>0&&m(s.boxSize,!0),m(s.boxSize,!1),this._vignette.draw(t,o)}}const lo=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class co extends ao{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new $a(e.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const t=ro(this.particlesCount),i=new e.eD,r=new e.a_;let s=0;const a=e.el(1323123451230);for(let e=0;e<t.length;++e){const n=t[e],o=a(),l=a(),c=a(),d=[e/t.length,o,l,c],u=[a(),a()];i.emplaceBack(n[0],n[1],n[2],-1,-1,...d,...u),i.emplaceBack(n[0],n[1],n[2],1,-1,...d,...u),i.emplaceBack(n[0],n[1],n[2],1,1,...d,...u),i.emplaceBack(n[0],n[1],n[2],-1,1,...d,...u),r.emplaceBack(s+0,s+1,s+2),r.emplaceBack(s+0,s+2,s+3),s+=4}this.particlesVx=n.createVertexBuffer(i,lo.members),this.particlesIdx=n.createIndexBuffer(r)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let i=[-n.direction.x,n.direction.y,-100];e.au(i,i);const r=structuredClone(this._vignetteParams),s=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},a=t.transform.zoom;if(s.revealStart>a)return;const o=so(0,1,s.revealStart,s.revealStart+s.revealRange,a);r.strength*=o,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),i=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,r.strength=1,r.color=structuredClone(t.style.snow.state.vignetteColor));const l=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const c=t.context,d=c.gl,u=t.transform,h=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(c,h),((n,r,s)=>{const a=io(this._movement.getPosition(),n),o=u.width/2,c=u.height/2,p=so(0,s.screenThinning.start,0,1,s.screenThinning.intensity),m=so(.001,s.screenThinning.range,0,1,s.screenThinning.intensity),f=so(0,s.screenThinning.particleOffset,0,1,s.screenThinning.intensity),g=(x={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:a,velocityConeAperture:s.velocityConeAperture,velocity:s.velocity,horizontalOscillationRadius:s.horizontalOscillationRadius,horizontalOscillationRate:s.horizontalOscillationRate,boxSize:n,billboardSize:1*s.billboardSize,simpleShapeParameters:[s.shapeFadeStart,s.shapeFadePower],screenSize:[u.width,u.height],thinningCenterPos:[o,c],thinningShape:[p,m,Math.pow(10,s.screenThinning.fadePower)],thinningAffectedRatio:s.screenThinning.affectedRatio,thinningParticleOffset:f,color:[s.color.r,s.color.g,s.color.b,s.color.a],direction:i},{u_modelview:Float32Array.from(x.modelview),u_projection:Float32Array.from(x.projection),u_time:x.time,u_cam_pos:x.camPos,u_velocityConeAperture:x.velocityConeAperture,u_velocity:x.velocity,u_horizontalOscillationRadius:x.horizontalOscillationRadius,u_horizontalOscillationRate:x.horizontalOscillationRate,u_boxSize:x.boxSize,u_billboardSize:x.billboardSize,u_simpleShapeParameters:x.simpleShapeParameters,u_screenSize:x.screenSize,u_thinningCenterPos:x.thinningCenterPos,u_thinningShape:x.thinningShape,u_thinningAffectedRatio:x.thinningAffectedRatio,u_thinningParticleOffset:x.thinningParticleOffset,u_particleColor:x.color,u_direction:x.direction});var x;const y=Math.round(s.intensity*this.particlesCount),v=e.bd.simpleSegment(0,0,4*y,2*y);this.particlesVx&&this.particlesIdx&&h.draw(t,d.TRIANGLES,Hn.disabled,Wn.disabled,Un.alphaBlended,Zn.disabled,g,"snow_particles",this.particlesVx,this.particlesIdx,v)})(n.boxSize,0,n),this._vignette.draw(t,r)}}const uo={symbol:function(t,n,i,r,s){if("translucent"!==t.renderPass)return;const a=Wn.disabled,o=t.colorModeForRenderPass(),l=i.layout.get("text-variable-anchor"),c=i.layout.get("text-size-scale-range"),d=e.ay(t.scaleFactor,c[0],c[1]);l&&function(t,n,i,r,s,a,o,l){const c=n.transform,d="map"===s,u="map"===a;for(const h of t){const t=r.getTile(h),n=t.getBucket(i);if(!n||!n.text||!n.text.segments.get().length)continue;const s=e.bH(n.textSizeData,c.zoom,l),a=Gt(h,n.getProjection(),c),p=c.calculatePixelsToTileUnitsMatrix(t),m=Qt(a,t.tileID.canonical,u,d,c,n.getProjection(),p),f=n.hasIconTextFit()&&n.hasIconData();s&&Ws(n,d,u,o,c,m,h,Math.pow(2,c.zoom-t.tileID.overscaledZ),s,f)}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),s,d);const u=0!==i.paint.get("icon-opacity").constantOr(1),h=0!==i.paint.get("text-opacity").constantOr(1);void 0!==i.layout.get("symbol-sort-key").constantOr(1)&&(u||h)?Gs(t,n,i,r,a,o):(u&&Gs(t,n,i,r,a,o,{onlyIcons:!0}),h&&Gs(t,n,i,r,a,o,{onlyText:!0})),n.map.showCollisionBoxes&&(Vs(t,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Vs(t,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,n,i,r){if("translucent"!==t.renderPass)return;const s=i.paint.get("circle-opacity"),a=i.paint.get("circle-stroke-width"),o=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1),c=i.paint.get("circle-emissive-strength");if(0===s.constantOr(1)&&(0===a.constantOr(1)||0===o.constantOr(1)))return;const d=t.context,u=d.gl,h=t.transform,p=!(!t.terrain||!t.terrain.enabled),m=i.layout.get("circle-elevation-reference"),f=t.depthModeForSublayer(0,Hn.ReadOnly),g=new Hn(t.context.gl.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D),x="none"===m||p?f:g,y=Wn.disabled,v=t.colorModeForDrapableLayerRenderPass(c),_="globe"===h.projection.name,b=[e.aD(h.center.lng),e.aH(h.center.lat)],w=[];for(let N=0;N<r.length;N++){const s=r[N],a=n.getTile(s),o=a.getBucket(i);if(!o||o.projection.name!==h.projection.name)continue;const c=o.programConfigurations.get(i.id),d=o.layoutVertexBuffer,u=o.globeExtVertexBuffer,p=o.indexBuffer,m=e.dW(i),f=[u],g=t.isTileAffectedByFog(s);_&&m.push("PROJECTION_GLOBE_VIEW"),m.push("DEPTH_D24"),t.terrain&&h.depthOcclusionForSymbolsAndCircles&&m.push("DEPTH_OCCLUSION"),o.hasElevation&&!t.terrain&&(m.push("ELEVATED_ROADS"),f.push(o.elevatedLayoutVertexBuffer));const x=t.getOrCreateProgram("circle",{config:c,defines:m,overrideFog:g}),y=h.projection.createInversionMatrix(h,s.canonical),v={programConfiguration:c,program:x,layoutVertexBuffer:d,dynamicBuffers:f,indexBuffer:p,uniformValues:e.dX(t,s,a,y,b,i),tile:a};if(l){const t=o.segments.get();for(const n of t)w.push({segments:new e.bd([n]),sortKey:n.sortKey,state:v})}else w.push({segments:o.segments,sortKey:0,state:v})}l&&w.sort((e,t)=>e.sortKey-t.sortKey);const j={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const e of w){const{programConfiguration:n,program:r,layoutVertexBuffer:s,dynamicBuffers:a,indexBuffer:o,uniformValues:l,tile:c}=e.state,p=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,r,j),t.uploadCommonUniforms(d,r,c.tileID.toUnwrapped()),r.draw(t,u.TRIANGLES,x,y,v,Zn.disabled,l,i.id,s,o,p,i.paint,h.zoom,n,a)}},heatmap:function(t,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const s=t.context,a=s.gl,o=Wn.disabled,l=new Un([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!0,!0,!0,!0]);!function(e,t,n,i){const r=e.gl,s=t.width*i,a=t.height*i;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,s,a]);let o=n.heatmapFbo;if(!o||o&&(o.width!==s||o.height!==a)){o&&o.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),o=n.heatmapFbo=e.createFramebuffer(s,a,!0,null),function(e,t,n,i,r,s){const a=e.gl;a.texImage2D(a.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?a.RGBA16F:a.RGBA,r,s,0,a.RGBA,e.extRenderToTextureHalfFloat?a.HALF_FLOAT:a.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,0,t,o,s,a)}else r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer)}(s,t,i,"globe"===t.transform.projection.name?.5:.25),s.clear({color:e.am.transparent});const c=t.transform,d="globe"===c.projection.name,u=d?["PROJECTION_GLOBE_VIEW"]:[],h=d?Zn.frontCCW:Zn.disabled,p=[e.aD(c.center.lng),e.aH(c.center.lat)];for(let e=0;e<r.length;e++){const m=r[e];if(n.hasRenderableParent(m))continue;const f=n.getTile(m),g=f.getBucket(i);if(!g||g.projection.name!==c.projection.name)continue;const x=t.isTileAffectedByFog(m),y=g.programConfigurations.get(i.id),v=t.getOrCreateProgram("heatmap",{config:y,defines:u,overrideFog:x}),{zoom:_}=t.transform;t.terrain&&t.terrain.setupElevationDraw(f,v),t.uploadCommonUniforms(s,v,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);v.draw(t,a.TRIANGLES,Hn.disabled,o,l,h,ys(t,m,f,b,p,_,i.paint.get("heatmap-intensity")),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,y,d?[g.globeExtVertexBuffer]:null)}s.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){const i=t.context,r=i.gl,s=n.heatmapFbo;if(!s)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let a=n.colorRampTexture;a||(a=n.colorRampTexture=new e.T(i,n.colorRamp,r.RGBA8)),a.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,r.TRIANGLES,Hn.disabled,Wn.disabled,t.colorModeForRenderPass(),Zn.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}(t,i))},line:function(t,n,i,r){if("translucent"!==t.renderPass)return;const s=i.paint.get("line-opacity"),a=i.paint.get("line-width");if(0===s.constantOr(1)||0===a.constantOr(1))return;const o=i.paint.get("line-emissive-strength"),l=i.paint.get("line-occlusion-opacity"),c=i.layout.get("line-elevation-reference"),d="meters"===i.layout.get("line-width-unit"),u="sea"===c,h=!(!t.terrain||!t.terrain.enabled),p=t.context,m=p.gl;if(i.hasElevatedBuckets&&"globe"===t.transform.projection.name)return;const f=i.layout.get("line-cross-slope"),g=void 0!==f,x=f<1,y=t.colorModeForDrapableLayerRenderPass(o),v=t.terrain&&t.terrain.renderingToTexture,_=v?1:e.q.devicePixelRatio,b=i.paint.get("line-dasharray"),w=b.constantOr(1),j=i.layout.get("line-cap"),N=b.constantOr(null),S=j.constantOr(null),k=i.paint.get("line-pattern"),T=k.constantOr(1),C=i.paint.get("line-pattern-cross-fade"),E=k.constantOr(null),A=i.paint.get("line-opacity").constantOr(1);let M=!T&&1!==A||t.depthOcclusion&&l>0&&l<1;const D=i.paint.get("line-gradient"),I=T?"linePattern":"line",P=e.dY(i);let R;if(v&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(M=!1),0!==l&&t.depthOcclusion){const t=i.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?R=t.value:e.w("Occlusion opacity for layer ".concat(i.id," is supported only when line-opacity isn't data-driven."))}"constant"!==a.value.kind&&!1===a.value.isLineProgressConstant&&P.push("VARIABLE_LINE_WIDTH");const L=(r,s,a,o,c,h)=>{for(const f of r){const r=n.getTile(f);if(T&&!r.patternsLoaded())continue;const g=r.getBucket(i);if(!g)continue;if("none"!==g.elevationType&&!c||"none"===g.elevationType&&c)continue;t.prepareDrawTile();const x=[...s],b=t.shadowRenderer,j="road"===g.elevationType&&!!b&&b.enabled;let k=[0,0,0];if(j){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(k=ui(t.style,e,n)),x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const P=g.programConfigurations.get(i.id);let L=!1;if(E&&r.imageAtlas){const t=e.dZ.from(E),n=t.getPrimary().scaleSelf(_).toString(),i=r.imageAtlas.patternPositions.get(n),s=t.getSecondary(),a=s?r.imageAtlas.patternPositions.get(s.scaleSelf(_).toString()):null;L=!!i&&!!a,i&&P.setConstantPatternPositions(i,a)}C>0&&(L||P.getPatternTransitionVertexBuffer("line-pattern"))&&x.push("LINE_PATTERN_TRANSITION");const z=t.isTileAffectedByFog(f),O=t.getOrCreateProgram(I,{config:P,defines:x,overrideFog:z});if(!T&&N&&S&&r.lineAtlas){const e=r.lineAtlas.getDash(N,S);e&&P.setConstantPatternPositions(e)}j&&b.setupShadows(r.tileID.toUnwrapped(),O,"vector-tile");let[F,B]=i.paint.get("line-trim-offset");if("round"===S||"square"===S){const e=1;F!==B&&(0===F&&(F-=e),1===B&&(B+=e))}const V=v?f.projMatrix:null,U=d?1/g.tileToMeter/e.aw(r,1,t.transform.zoom):1,H=d?1/g.tileToMeter/e.aw(r,1,Math.floor(t.transform.zoom)):1,q=T?e.d_(t,r,i,V,_,U,H,[F,B],k,C):e.d$(t,r,i,V,g.lineClipsArray.length,_,U,H,[F,B],k);if(D){const r=g.gradients[i.id];let s=r.texture;if(i.gradientVersion!==r.version){let a=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=f.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-f.canonical.z):1;a=e.ay(e.e0(g.maxLineLength/e.aj*1024*r),256,p.maxTextureSize)}r.gradient=e.e1({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:r.gradient||void 0,clips:g.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.T(p,r.gradient,m.RGBA8),r.version=i.gradientVersion,s=r.texture}p.activeTexture.set(m.TEXTURE1),s.bind(i.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}w&&(p.activeTexture.set(m.TEXTURE0),r.lineAtlasTexture&&r.lineAtlasTexture.bind(m.LINEAR,m.REPEAT),P.updatePaintBuffers()),T&&(p.activeTexture.set(m.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),P.updatePaintBuffers()),c&&!u&&t.terrain.setupElevationDraw(r,O),t.uploadCommonUniforms(p,O,f.toUnwrapped());const W=e=>{null!=R&&(R.value=A*l),O.draw(t,m.TRIANGLES,a,e,y,Zn.disabled,q,i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,P,[g.layoutVertexBuffer2,g.patternVertexBuffer,g.zOffsetVertexBuffer]),null!=R&&(R.value=A)};if(M&&!c){const e=t.stencilModeForClipping(f).ref;0===e&&v&&p.clear({stencil:0});const n={func:m.EQUAL,mask:255};q.u_alpha_discard_threshold=.8,W(new Wn(n,e,255,m.KEEP,m.KEEP,m.INVERT)),q.u_alpha_discard_threshold=0,W(new Wn(n,e,255,m.KEEP,m.KEEP,m.KEEP))}else q.u_alpha_discard_threshold=M&&c&&h?.8:0,W(c?o:t.stencilModeForClipping(f))}};let z=t.depthModeForSublayer(0,Hn.ReadOnly);const O=new Hn(t.depthOcclusion?m.GREATER:m.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D);if(i.hasNonElevatedBuckets){const n=!v&&t.terrain;0!==l&&n?e.w("Occlusion opacity for layer ".concat(i.id," is supported on terrain only if the layer has line-z-offset enabled.")):n?e.w("Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ".concat(i.id,".")):L(r,P,z,Wn.disabled,!1,!0)}if(i.hasElevatedBuckets){"hd-road-markup"===c?h||(z=O,P.push("ELEVATED_ROADS")):(P.push("ELEVATED"),z=O,g&&P.push(x?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),u&&P.push("ELEVATION_REFERENCE_SEA"));const e=M?t.stencilModeFor3D():Wn.disabled;t.forceTerrainMode=!0,L(r,P,z,e,!0,!0),M&&L(r,P,z,e,!0,!1),t.forceTerrainMode=!1}M&&(t.resetStencilClippingMasks(),v&&p.clear({stencil:0})),0===l||t.depthOcclusion||v||t.layersWithOcclusionOpacity.push(t.currentLayer)},fill:function(t,n,i,r){const s=i.paint.get("fill-color"),a=i.paint.get("fill-opacity");if(0===a.constantOr(1))return;const o=i.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(o),c=i.paint.get("fill-pattern"),d=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===s.constantOr(e.am.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";let u="none";"none"!==i.layout.get("fill-elevation-reference")?u="road":0!==i.paint.get("fill-z-offset").constantOr(1)&&(u="offset");const h=!(!t.terrain||!t.terrain.enabled),p={painter:t,sourceCache:n,layer:i,coords:r,colorMode:l,elevationType:u,terrainEnabled:h,pass:d};if("shadow"!==t.renderPass)if("offset"!==u){if(Ks(p,!1),"road"===u){const e=!h&&"translucent"===t.renderPass;e&&Xs(t,n,i,r,"geometry"),Ks(p,!0,Wn.disabled),e&&function(e){const{painter:t,sourceCache:n,layer:i,coords:r,colorMode:s}=e,a=t.context.gl,o=e.painter.shadowRenderer,l=!!o&&o.enabled,c=new Hn(t.context.gl.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D);let d=[0,0,0];if(l){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(d=ui(t.style,e,n))}const u=e=>{for(const u of r){const r=n.getTile(u),h=r.getBucket(i);if(!h)continue;const p=h.elevatedStructures;if(!p)continue;let m,f;if(e?(m=p.renderableBridgeSegments,f=p.bridgeProgramConfigurations.get(i.id)):(m=p.renderableTunnelSegments,f=p.tunnelProgramConfigurations.get(i.id)),!m||0===m.segments[0].primitiveLength)continue;f.updatePaintBuffers(),t.prepareDrawTile();const g=t.isTileAffectedByFog(u),x=[];l&&x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const y=t.getOrCreateProgram("elevatedStructures",{config:f,overrideFog:g,defines:x}),v=t.translatePosMatrix(u.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));l&&o.setupShadows(r.tileID.toUnwrapped(),y,"vector-tile");const _=ds(v,d);t.uploadCommonUniforms(t.context,y,u.toUnwrapped()),y.draw(t,a.TRIANGLES,c,Wn.disabled,s,Zn.backCCW,_,i.id,p.vertexBuffer,p.indexBuffer,m,i.paint,t.transform.zoom,f,[p.vertexBufferNormal])}};u(!0),u(!1)}(p)}}else Ks(p,!1,t.stencilModeFor3D());else t.shadowRenderer&&"road"===u&&!h&&function(e){const{painter:t,sourceCache:n,layer:i,coords:r}=e,s=t.context.gl,a=e.painter.shadowRenderer;for(const o of r){const e=n.getTile(o),r=e.getBucket(i);if(!r)continue;const l=r.elevatedStructures;if(!l)continue;if(!l.shadowCasterSegments||0===l.shadowCasterSegments.segments[0].primitiveLength)continue;t.prepareDrawTile();const c=r.bufferData.programConfigurations.get(i.id),d=t.isTileAffectedByFog(o),u=t.getOrCreateProgram("elevatedStructuresDepth",{config:c,overrideFog:d}),h=a.calculateShadowPassMatrixFromTile(e.tileID.toUnwrapped());t.uploadCommonUniforms(t.context,u,o.toUnwrapped());const p={u_matrix:h,u_depth_bias:0};u.draw(t,s.TRIANGLES,a.getShadowPassDepthMode(),Wn.disabled,a.getShadowPassColorMode(),Zn.disabled,p,i.id,l.vertexBuffer,l.indexBuffer,l.shadowCasterSegments,i.paint,t.transform.zoom,c)}}(p)},"fill-extrusion":function(t,n,i,r){const s=i.paint.get("fill-extrusion-opacity"),a=t.context,o=a.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===s)return;const d=t.conflationActive&&t.style.isLayerClipped(i,n.getSource()),u=t.style.order.indexOf(i.fqid);if(d&&function(e,t,n,i,r){for(const s of i){const i=t.getTile(s).getBucket(n);i&&(i.updateReplacement(s,e.replacementSource,r),i.uploadCentroid(e.context))}}(t,n,i,r,u),l||d)for(const e of r){const r=n.getTile(e).getBucket(i);r&&ea(t.context,n,e,r,i,l,d)}if("shadow"===t.renderPass&&t.shadowRenderer){const a=t.shadowRenderer;if(l&&s<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ab)return;const o=a.getShadowPassDepthMode(),c=a.getShadowPassColorMode();Qs(t,n,i,r,o,Wn.disabled,c,d)}else if("translucent"===t.renderPass){const u=!i.paint.get("fill-extrusion-pattern").constantOr(1),h=i.paint.get("fill-extrusion-color").constantOr(e.am.white);if(!c&&0!==h.a){const e=new Hn(t.context.gl.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D);1===s&&u?Qs(t,n,i,r,e,Wn.disabled,Un.unblended,d):(Qs(t,n,i,r,e,Wn.disabled,Un.disabled,d),Qs(t,n,i,r,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),d),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&u&&(!l&&"globe"!==t.transform.projection.name||c)){const s=i.paint.get("fill-extrusion-opacity"),u=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),h=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=i.paint.get("fill-extrusion-flood-light-intensity"),m="none"===i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),f=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(m?null:i.lut).toArray01().slice(0,3),g=u>0&&h>0,x=p>0,y=(e,t,n)=>(1-n)*e+n*t,v=new Js;v.translate=i.paint.get("fill-extrusion-translate"),v.translateAnchor=i.paint.get("fill-extrusion-translate-anchor"),v.edgeRadius=i.layout.get("fill-extrusion-edge-radius"),v.cutoffFadeRange=i.paint.get("fill-extrusion-cutoff-fade-range");const _=a=>{const l=t.depthModeForSublayer(1,Hn.ReadOnly,o.LEQUAL,!0),c=i.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=y(.1,3,c),g=t._showOverdrawInspector;if(!g){const c=new Wn({func:o.ALWAYS,mask:255},255,255,o.KEEP,o.KEEP,o.REPLACE),g=new Un([o.ONE,o.ONE,o.ONE,o.ONE],e.am.transparent,[!1,!1,!1,!0],o.MIN);$s(v,t,n,i,r,l,c,g,Zn.disabled,a,"sdf",s,u,h,p,f,m,d,!1)}{const c=g?Wn.disabled:new Wn({func:o.EQUAL,mask:255},255,255,o.KEEP,o.DECR,o.DECR),x=g?t.colorModeForRenderPass():new Un([o.ONE_MINUS_DST_ALPHA,o.DST_ALPHA,o.ONE,o.ONE],e.am.transparent,[!0,!0,!0,!0]);$s(v,t,n,i,r,l,c,x,Zn.disabled,a,"color",s,u,h,p,f,m,d,!1)}};if(c){const c=(a,l,c)=>{const m=t.depthModeForSublayer(1,Hn.ReadOnly,o.LEQUAL,!1),g=i.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),x=y(.1,3,g);{const c=new Un([o.ONE,o.ONE,o.ONE,o.ONE],e.am.transparent,[!1,!1,!1,!0]);$s(v,t,n,i,r,m,Wn.disabled,c,Zn.disabled,a,"clear",s,u,h,p,f,x,d,l)}{const c=new Wn({func:o.ALWAYS,mask:255},255,255,o.KEEP,o.KEEP,o.REPLACE),g=new Un([o.ONE,o.ONE,o.ONE,o.ONE],e.am.transparent,[!1,!1,!1,!0],o.MIN);$s(v,t,n,i,r,m,c,g,Zn.disabled,a,"sdf",s,u,h,p,f,x,d,l)}{const c=a?o.ZERO:o.ONE_MINUS_DST_ALPHA,g=new Wn({func:o.EQUAL,mask:255},255,255,o.KEEP,o.DECR,o.DECR),y=new Un([c,o.DST_ALPHA,o.ONE_MINUS_DST_ALPHA,o.ZERO],e.am.transparent,[!0,!0,!0,!0]);$s(v,t,n,i,r,m,g,y,Zn.disabled,a,"color",s,u,h,p,f,x,d,l)}{const g=new Un([o.ONE,o.ONE,o.ONE,a?o.ZERO:o.ONE],e.am.transparent,[!1,!1,!1,!0],a?o.FUNC_ADD:o.MAX);$s(v,t,n,i,r,m,Wn.disabled,g,Zn.disabled,a,"clear",s,u,h,p,f,x,d,l,c)}};if(g||x){let n;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],i=l.drapeBufferSize[1];n=l.framebufferCopyTexture,n&&(!n||n.size[0]===t&&n.size[1]===i)||(n&&n.destroy(),n=l.framebufferCopyTexture=new e.T(a,new e.r({width:t,height:i}),o.RGBA8)),n.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.copyTexSubImage2D(o.TEXTURE_2D,0,0,0,0,0,t,i)}g&&c(!0,!1,n),x&&c(!1,!0,n)}}else g&&_(!0),x&&_(!1),(g||x)&&t.resetStencilClippingMasks()}}},building:function(t,n,i,r){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);const s=i.paint.get("building-ambient-occlusion-ground-intensity"),a=i.paint.get("building-ambient-occlusion-ground-radius"),o=i.paint.get("building-ambient-occlusion-ground-attenuation");let l=s>0&&a>0,c=!0;const d=i.paint.get("building-vertical-scale");d<1&&(c=!1);const u=t.conflationActive&&t.style.isLayerClipped(i,n.getSource()),h=t.style.order.indexOf(i.fqid);if(function(e,t,n,i,r,s){for(const a of s){const s=t.getTile(a).getBucket(n);s&&(r&&s.updateReplacement(a,e.replacementSource,i),s.uploadUpdatedIndexBuffer(e.context))}}(t,n,i,h,u,r),function(e,t,n,i){for(const r of i){const i=t.getTile(r).getBucket(n);i&&i.needsEvaluation(e,n)&&(i.evaluate(n),i.uploadUpdatedColorBuffer(e.context))}}(t,n,i,r),i.resetLayerRenderingStats(t),t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0),"shadow"===t.renderPass&&t.shadowRenderer){const e=t.shadowRenderer,s=[],a=e.getShadowPassDepthMode();sa({painter:t,source:n,layer:i,coords:r,defines:s,blendMode:e.getShadowPassColorMode(),depthMode:a,verticalScale:d})}else if("translucent"===t.renderPass){l&&function(t,n,i,r,s,a,o,l,c,d,u,h){const p=t.context.gl,m=t.depthModeForSublayer(1,Hn.ReadOnly,p.LEQUAL,!0),f=.1*(1-(g=u))+3*g;var g;const x=t._showOverdrawInspector,y=h,v=new Js;x||$s(v,t,n,i,r,m,new Wn({func:p.ALWAYS,mask:255},255,255,p.KEEP,p.KEEP,p.REPLACE),new Un([p.ONE,p.ONE,p.ONE,p.ONE],e.am.transparent,[!1,!1,!1,!0],p.MIN),Zn.disabled,s,"sdf",1,o,l,0,d,f,y,!1);{const a=x?Wn.disabled:new Wn({func:p.EQUAL,mask:255},255,255,p.KEEP,p.DECR,p.DECR),c=x?t.colorModeForRenderPass():new Un([p.ONE_MINUS_DST_ALPHA,p.DST_ALPHA,p.ONE,p.ONE],e.am.transparent,[!0,!0,!0,!0]);$s(v,t,n,i,r,m,a,c,Zn.disabled,s,"color",1,o,l,0,d,f,y,!1)}}(t,n,i,r,!0,0,s,a,0,[0,0,0],o,u);let h=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];c&&(h=h.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),t.shadowRenderer.useNormalOffset&&(h=h.concat("NORMAL_OFFSET"));const p=new Hn(t.context.gl.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D),m=t.colorModeForRenderPass();sa({painter:t,source:n,layer:i,coords:r,defines:h,blendMode:m,depthMode:p,verticalScale:d})}else if("light-beam"===t.renderPass){const e=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],s=new Hn(t.context.gl.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D);sa({painter:t,source:n,layer:i,coords:r,defines:e,blendMode:Un.alphaBlended,depthMode:s,verticalScale:d})}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1),t.resetStencilClippingMasks()},hillshade:function(e,t,n,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const r=e.context,s=e.terrain&&e.terrain.renderingToTexture,[a,o]="translucent"!==e.renderPass||s?[{},i]:e.stencilConfigForOverlap(i);for(const l of o){const i=t.getTile(l);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)$i(e,i,n);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Hn.ReadOnly),r=n.paint.get("hillshade-emissive-strength"),o=e.colorModeForDrapableLayerRenderPass(r),c=s&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):a[l.overscaledZ];Qi(e,l,i,n,t,c,o)}}r.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,n,i,r,s,a){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;const o="globe"===t.transform.projection.name,l=0!==i.paint.get("raster-elevation"),c=l&&o;if(t.renderElevatedRasterBackface&&!c)return;const d=t.context,u=d.gl,h=n.getSource(),p=function(t,n,i,r){const s=n.paint.get("raster-color"),a="raster-array"===t.type,o=[],l=n.paint.get("raster-resampling"),c=n.paint.get("raster-color-mix");let d=n.paint.get("raster-color-range");const u=[c[0],c[1],c[2],0],h=c[3];let p="nearest"===l?r.NEAREST:r.LINEAR;if(a&&(o.push("RASTER_ARRAY"),s||o.push("RASTER_COLOR"),"linear"===l&&o.push("RASTER_ARRAY_LINEAR"),p=r.NEAREST,!d&&t.rasterLayers)){const e=t.rasterLayers.find(e=>{let{id:t}=e;return t===n.sourceLayer});e&&e.fields&&e.fields.range&&(d=e.fields.range)}if(d=d||[0,1],s){o.push("RASTER_COLOR"),i.activeTexture.set(r.TEXTURE2),n.updateColorRamp(d);let t=n.colorRampTexture;t||(t=n.colorRampTexture=new e.T(i,n.colorRamp,r.RGBA8)),t.bind(r.LINEAR,r.CLAMP_TO_EDGE)}return{mix:u,range:d,offset:h,defines:o,resampling:p}}(h,i,d,u);if(h instanceof e.aP&&!r.length&&!o)return;const m=i.paint.get("raster-emissive-strength"),f=t.colorModeForDrapableLayerRenderPass(m),g=t.terrain&&t.terrain.renderingToTexture,x=!t.options.moving,y="nearest"===i.paint.get("raster-resampling")?u.NEAREST:u.LINEAR;if(h instanceof e.aP&&!r.length&&(h.onNorthPole||h.onSouthPole)){const e=l?t.stencilModeFor3D():Wn.disabled;return void oa(!!h.onNorthPole,null,t,n,i,m,p,Zn.disabled,e)}if(!r.length)return;const[v,_]=h instanceof e.aP||g?[{},r]:t.stencilConfigForOverlap(r),b=_[_.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(r,s,_)=>{for(const w of r){const r=w.toUnwrapped(),j=n.getTile(w);if(g&&(!j||!j.hasData()))continue;d.activeTexture.set(u.TEXTURE0);const N=ca(j,h,i,p);if(!N||!N.texture)continue;const{texture:S,mix:k,offset:T,tileSize:C,buffer:E}=N;let A,M;g?(A=Hn.disabled,M=w.projMatrix):l?(A=new Hn(u.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D),M=o?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(r,x)):(A=t.depthModeForSublayer(w.overscaledZ-b,1===i.paint.get("raster-opacity")?Hn.ReadWrite:Hn.ReadOnly,u.LESS),M=t.transform.calculateProjMatrix(r,x));const D=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(w):v[w.overscaledZ],I=a?0:i.paint.get("raster-fade-duration");j.registerFadeDuration(I);const P=n.findLoadedParent(w,0),R=Wr(j,P,n,t.transform,I);let L,z;t.terrain&&t.terrain.prepareDrawTile(),d.activeTexture.set(u.TEXTURE0),S.bind(y,u.CLAMP_TO_EDGE),d.activeTexture.set(u.TEXTURE1),P?(P.texture&&P.texture.bind(y,u.CLAMP_TO_EDGE),L=Math.pow(2,P.tileID.overscaledZ-j.tileID.overscaledZ),z=[j.tileID.canonical.x*L%1,j.tileID.canonical.y*L%1]):S.bind(y,u.CLAMP_TO_EDGE),"useMipmap"in S&&d.extTextureFilterAnisotropic&&t.transform.pitch>20&&u.texParameterf(u.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax);const O=t.transform;let F;const B=l?la(O):[0,0,0,0];let V,U,H,q,W,G=0;if(c&&h instanceof e.aP&&h.coordinates.length>3)V=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0)))),U=Float32Array.from(O.globeMatrix),H=Float32Array.from(e.dz(O)),q=[e.aD(O.center.lng),e.aH(O.center.lat)],F=h.elevatedGlobePerspectiveTransform,W=h.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.dA(w.canonical);G=e.dB(t.getCenter().lat),V=Float32Array.from(e.bh(e.dD(w.canonical))),U=Float32Array.from(O.globeMatrix),H=Float32Array.from(e.dz(O)),q=[e.aD(O.center.lng),e.aH(O.center.lat)],F=[0,0],W=Float32Array.from(e.dC(w.canonical,t,G,O.worldSize/O._pixelsPerMercatorPixel))}else F=h instanceof e.aP?h.perspectiveTransform:[0,0],V=new Float32Array(16),U=new Float32Array(9),H=new Float32Array(16),q=[0,0],W=new Float32Array(9);const Y=bs(M,V,U,H,W,z||[0,0],e.ah(t.transform.zoom),q,B,L||1,R,i,F,l?i.paint.get("raster-elevation"):0,2,k,T,p.range,C,E,m),Z=t.isTileAffectedByFog(w),X=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:Z});if(t.uploadCommonUniforms(d,X,r),h instanceof e.aP){const n=h.elevatedGlobeVertexBuffer,r=h.elevatedGlobeIndexBuffer;if(g||!o)h.boundsBuffer&&h.boundsSegments&&X.draw(t,u.TRIANGLES,A,Wn.disabled,f,Zn.disabled,Y,i.id,h.boundsBuffer,t.quadTriangleIndexBuffer,h.boundsSegments);else if(n&&r){const a=O.zoom<=e.cX?h.elevatedGlobeSegments:h.getSegmentsForLongitude(O.center.lng);a&&X.draw(t,u.TRIANGLES,A,Wn.disabled,f,s,Y,i.id,n,r,a)}}else if(c){A=new Hn(u.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[n,r,a]=e.getGridBuffers(G,!1);X.draw(t,u.TRIANGLES,A,_||D,t.colorModeForRenderPass(),s,Y,i.id,n,r,a)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:n,tileBoundsSegments:r}=t.getTileBoundsBuffers(j);X.draw(t,u.TRIANGLES,A,D,f,Zn.disabled,Y,i.id,e,n,r)}}if(!(h instanceof e.aP)&&c)for(const e of r){const r=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&oa(!0,e,t,n,i,m,p,s,_||Wn.disabled),r&&oa(!1,e,t,n,i,m,p,s===Zn.frontCW?Zn.backCW:Zn.frontCW,_||Wn.disabled)}};c?w(_,t.renderElevatedRasterBackface?Zn.backCW:Zn.frontCW,t.stencilModeFor3D()):w(_,Zn.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,n,i,r,s,a){"offscreen"===t.renderPass&&function(t,n,i,r){if(!r.length)return;const s=t.context,a=s.gl,o=n.getSource();if(!(o instanceof ot))return;const l=Math.ceil(Math.sqrt(i.paint.get("raster-particle-count")));let c=i.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,n=new Uint8Array(4*t),i=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},r=1/1.1;for(let s=0;s<t;s++){const e=r*(i(2*s+0)+js),t=r*(i(2*s+1)+js),a=255*e%1,o=255*t%1,l=a,c=t-o/255,d=o;n[4*s+0]=255*(e-a/255),n[4*s+1]=255*l,n[4*s+2]=255*c,n[4*s+3]=255*d}return n}(l);c=i.particlePositionRGBAImage=new e.r({width:l,height:l},t)}let d=i.particleFramebuffer;d?d.width!==l&&(d.destroy(),d=i.particleFramebuffer=s.createFramebuffer(l,l,!0,null)):d=i.particleFramebuffer=s.createFramebuffer(l,l,!0,null);const u=[];for(const e of r){const t=n.getTile(e);if(!(t instanceof kt))continue;const r=ha(t,o,i);if(!r)continue;const a=[t.tileSize,t.tileSize];let d=i.tileFramebuffer;d||(d=i.tileFramebuffer=s.createFramebuffer(a[0],a[1],!0,null));let h=t.rasterParticleState;h||(h=t.rasterParticleState=new ua(s,e,a,c));const p=h.update(i.lastInvalidatedAt);h.particleTextureDimension!==l&&h.updateParticleTexture(e,c);const m=h.targetColorTexture;h.targetColorTexture=h.backgroundColorTexture,h.backgroundColorTexture=m;const f=h.particleTexture0;h.particleTexture0=h.particleTexture1,h.particleTexture1=f,u.push([e,r,h,p])}if(0===u.length)return;const h=e.q.now(),p=i.previousDrawTimestamp?.001*(h-i.previousDrawTimestamp):.0167;if(i.previousDrawTimestamp=h,i.hasColorMap()){s.activeTexture.set(a.TEXTURE0+2);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(s,i.colorRamp,a.RGBA8)),t.bind(a.LINEAR,a.CLAMP_TO_EDGE)}s.bindFramebuffer.set(i.tileFramebuffer.framebuffer),function(t,n,i){const r=t.context,s=r.gl,a=n.tileFramebuffer;r.activeTexture.set(s.TEXTURE0);const o={u_texture:0,u_opacity:1.05*(c=n.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const d of i){const[,,i,c]=d;a.colorAttachment.set(i.targetColorTexture.texture),r.viewport.set([0,0,a.width,a.height]),r.clear({color:e.am.transparent}),c&&(i.backgroundColorTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),l.draw(t,s.TRIANGLES,Hn.disabled,Wn.disabled,Un.alphaBlended,Zn.disabled,o,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,i,u),function(t,n,i,r){const s=t.context,a=s.gl,o=i.tileFramebuffer,l="globe"===t.transform.projection.name,c=i.paint.get("raster-particle-max-speed");for(const d of r){const[r,u,h]=d;s.activeTexture.set(a.TEXTURE0+0),u.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.colorAttachment.set(h.targetColorTexture.texture);const p=t.getOrCreateProgram("rasterParticleDraw",{defines:u.defines,overrideFog:!1});s.activeTexture.set(a.TEXTURE0+1);const m=u.scalarData?[]:[0,1,2,3].map(t=>e.e3[t](r));m.push(r);const f=r.canonical.x,g=r.canonical.y;for(const e of m){const s=n.getTile(l?e.wrapped():e);if(!s)continue;const o=s.rasterParticleState;if(!o)continue;const d=e.canonical.x+(1<<e.canonical.z)*(e.wrap-r.wrap),h=e.canonical.y;o.particleTexture0.bind(a.NEAREST,a.CLAMP_TO_EDGE);const m=Ss(1,o.particleTexture0.size[0],[d-f,h-g],0,u.texture.size,2,c,u.textureOffset,u.scale,u.offset);p.draw(t,a.POINTS,Hn.disabled,Wn.disabled,Un.alphaBlended,Zn.disabled,m,i.id,o.particleIndexBuffer,void 0,o.particleSegment)}}}(t,n,i,u),s.bindFramebuffer.set(i.particleFramebuffer.framebuffer),function(t,n,i,r){const s=t.context,a=s.gl,o=n.paint.get("raster-particle-max-speed"),l=r*n.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*n.paint.get("raster-particle-reset-rate-factor")),d=n.particleFramebuffer;s.viewport.set([0,0,d.width,d.height]);for(const u of i){const[,i,r]=u;s.activeTexture.set(a.TEXTURE0+0),i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE0+1);const h=r.particleTexture0;h.bind(a.NEAREST,a.CLAMP_TO_EDGE);const p=ks(1,h.size[0],0,i.texture.size,o,l,c,i.textureOffset,i.scale,i.offset);d.colorAttachment.set(r.particleTexture1.texture),s.clear({color:e.am.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:i.defines}).draw(t,a.TRIANGLES,Hn.disabled,Wn.disabled,Un.unblended,Zn.disabled,p,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,i,u,p)}(t,n,i,r),"translucent"===t.renderPass&&(function(t,n,i,r){const s=t.context,a=s.gl,o=n.getSource().tileSize,l=5*(1-e.af(e.cI,e.cI+1,t.transform.zoom))*o+i.paint.get("raster-particle-elevation"),c=!t.options.moving,d="globe"===t.transform.projection.name;if(!r.length)return;const[u,h]=t.stencilConfigForOverlap(r),p=[];d&&p.push("PROJECTION_GLOBE_VIEW");const m=t.stencilModeFor3D();for(const f of h){const r=f.toUnwrapped(),o=n.getTile(f);if(!o.rasterParticleState)continue;const h=o.rasterParticleState,g=100;o.registerFadeDuration(g);const x=n.findLoadedParent(f,0),y=Wr(o,x,n,t.transform,g);let v,_;t.terrain&&t.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),h.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),x&&x.rasterParticleState?(x.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),v=Math.pow(2,x.tileID.overscaledZ-o.tileID.overscaledZ),_=[o.tileID.canonical.x*v%1,o.tileID.canonical.y*v%1]):h.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=d?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(r,c),w=t.transform,j=pa(w),N=e.dA(f.canonical),S=e.dB(N.getCenter().lat);let k,T,C,E,A;d?(k=Float32Array.from(e.bh(e.dD(f.canonical))),T=Float32Array.from(w.globeMatrix),C=Float32Array.from(e.dz(w)),E=[e.aD(w.center.lng),e.aH(w.center.lat)],A=Float32Array.from(e.dC(f.canonical,N,S,w.worldSize/w._pixelsPerMercatorPixel))):(k=new Float32Array(16),T=new Float32Array(9),C=new Float32Array(16),E=[0,0],A=new Float32Array(9));const M=Ns(b,k,T,C,A,_||[0,0],e.ah(t.transform.zoom),E,j,v||1,y,l),D=t.isTileAffectedByFog(f),I=t.getOrCreateProgram("rasterParticle",{defines:p,overrideFog:D});if(t.uploadCommonUniforms(s,I,r),d){const e=new Hn(a.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D),n=0,r=t.globeSharedBuffers;if(r){const[s,o,l]=r.getGridBuffers(S,0!==n);I.draw(t,a.TRIANGLES,e,m,Un.alphaBlended,t.renderElevatedRasterBackface?Zn.frontCCW:Zn.backCCW,M,i.id,s,o,l)}}else{const e=t.depthModeForSublayer(0,Hn.ReadOnly),n=u[f.overscaledZ],{tileBoundsBuffer:r,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=t.getTileBoundsBuffers(o);I.draw(t,a.TRIANGLES,e,n,Un.alphaBlended,Zn.disabled,M,i.id,r,s,l)}}t.resetStencilClippingMasks()}(t,n,i,r),t.style.map.triggerRepaint())},background:function(t,n,i,r){const s=i.paint.get("background-color"),a="none"===i.paint.get("background-color-use-theme").constantOr("default"),o=i.paint.get("background-opacity"),l=i.paint.get("background-emissive-strength"),c="viewport"===i.paint.get("background-pitch-alignment");if(0===o)return;const d=t.context,u=d.gl,h=t.transform,p=h.tileSize,m=i.paint.get("background-pattern");let f;if(void 0!==m){if(null===m)return;if(f=t.imageManager.getPattern(e.I.from(m.toString()),i.scope,t.style.getLut(i.scope)),!f)return}const g=!m&&1===s.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==g)return;const x=Wn.disabled,y=t.depthModeForSublayer(0,"opaque"===g?Hn.ReadWrite:Hn.ReadOnly),v=t.colorModeForDrapableLayerRenderPass(l),_=m?"backgroundPattern":"background";let b,w=r;if(w||(b=t.getBackgroundTiles(),w=Object.values(b).map(e=>e.tileID)),m&&(d.activeTexture.set(u.TEXTURE0),t.imageManager.bind(t.context,i.scope)),c){const n=t.getOrCreateProgram(_,{overrideFog:!1,overrideRtt:!0}),r=new Float32Array(e.bx([])),d=new e.aM(0,0,0,0,0),h=m?As(r,l,o,t,0,i.scope,f,c,{tileID:d,tileSize:p}):Es(r,l,o,s.toPremultipliedRenderColor(a?null:i.lut));n.draw(t,u.TRIANGLES,y,x,v,Zn.disabled,h,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}else for(const e of w){const g=t.isTileAffectedByFog(e),w=t.getOrCreateProgram(_,{overrideFog:g}),j=e.toUnwrapped(),N=r?e.projMatrix:t.transform.calculateProjMatrix(j);t.prepareDrawTile();const S=n?n.getTile(e):b?b[e.key]:new St(e,p,h.zoom,t),k=m?As(N,l,o,t,0,i.scope,f,c,{tileID:e,tileSize:p}):Es(N,l,o,s.toPremultipliedRenderColor(a?null:i.lut));t.uploadCommonUniforms(d,w,j);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:C,tileBoundsSegments:E}=t.getTileBoundsBuffers(S);w.draw(t,u.TRIANGLES,y,x,v,Zn.disabled,k,i.id,T,C,E)}},sky:function(t,n,i){const r=t._atmosphere?e.ah(t.transform.zoom):1,s=i.paint.get("sky-opacity")*r;if(0===s)return;const a=t.context,o=i.paint.get("sky-type"),l=new Hn(a.gl.LEQUAL,Hn.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===o?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,n){const i=t.context,r=i.gl;let s=n.skyboxFbo;if(!s){s=n.skyboxFbo=i.createFramebuffer(32,32,!0,null),n.skyboxGeometry=new Ta(i),n.skyboxTexture=i.gl.createTexture(),r.bindTexture(r.TEXTURE_CUBE_MAP,n.skyboxTexture),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR);for(let e=0;e<6;++e)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,r.RGBA,32,32,0,r.RGBA,r.UNSIGNED_BYTE,null)}i.bindFramebuffer.set(s.framebuffer),i.viewport.set([0,0,32,32]);const a=n.getCenter(t,!0),o=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.bx(l),e.eh(l,l,.5*-Math.PI),Ca(t,n,o,l,a,0),e.bx(l),e.eh(l,l,.5*Math.PI),Ca(t,n,o,l,a,1),e.bx(l),e.cR(l,l,.5*-Math.PI),Ca(t,n,o,l,a,2),e.bx(l),e.cR(l,l,.5*Math.PI),Ca(t,n,o,l,a,3),e.bx(l),Ca(t,n,o,l,a,4),e.bx(l),e.eh(l,l,Math.PI),Ca(t,n,o,l,a,5),i.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,n,i,r){const s=e.context,a=s.gl,o=e.transform,l=e.getOrCreateProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,n,i,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}))(o.skyboxMatrix,t.getCenter(e,!1),0,i,r);e.uploadCommonUniforms(s,l),l.draw(e,a.TRIANGLES,n,Wn.disabled,e.colorModeForRenderPass(),Zn.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,i,l,s,c):"gradient"===o&&"sky"===t.renderPass&&function(t,n,i,r,s){const a=t.context,o=a.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new Ta(a)),a.activeTexture.set(o.TEXTURE0);let d=n.colorRampTexture;d||(d=n.colorRampTexture=new e.T(a,n.colorRamp,o.RGBA8)),d.bind(o.LINEAR,o.CLAMP_TO_EDGE);const u=((t,n,i,r,s)=>({u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.al(i),u_opacity:r,u_temporal_offset:s}))(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),r,s);t.uploadCommonUniforms(a,c),c.draw(t,o.TRIANGLES,i,Wn.disabled,t.colorModeForRenderPass(),Zn.backCW,u,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,l,s,c)},custom:function(t,n,i,r){const s=t.context,a=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&i.isDraped(n)){if("offscreen"===t.renderPass){const n=a.prerender;if(n){if(t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;n.call(a,s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else n.call(a,s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const e=a.renderToTile;if(e){const n=r[0].canonical,i={x:n.x+r[0].wrap*(a.wrapTileId?0:1<<n.z),y:n.y,z:n.z};s.setDepthMode(Hn.disabled),s.setStencilMode(Wn.disabled),s.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),e.call(a,s.gl,i),s.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),s.setStencilMode(Wn.disabled);const n="3d"===a.renderingMode?new Hn(t.context.gl.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Hn.ReadOnly);if(s.setDepthMode(n),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;a.render(s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else a.render(s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState(),s.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,n,i,r){if("opaque"===t.renderPass)return;const s=i.paint.get("model-opacity").constantOr(1);if(0===s)return;const a=i.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!a)return;if(t.terrain&&s<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof e.ab)return}const o=t.shadowRenderer,l=i.paint.get("model-receive-shadows");o&&(o.useNormalOffset=!0,l||(o.enabled=!1));const c=()=>{o&&(o.useNormalOffset=!0,l||(o.enabled=!0))},d=n.getSource();if("light-beam"===t.renderPass&&"batched-model"!==d.type)return;if("vector"===d.type||"geojson"===d.type)return function(t,n,i,r,s){const a=t.transform;if("mercator"!==a.projection.name)return void e.w("Drawing 3D models for ".concat(a.projection.name," projection is not yet implemented"));const o=a.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;i.modelManager=l;const c=t.shadowRenderer;if(!i._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const d=i._unevaluatedLayout._values["model-id"],u=Object.assign({},i.layout.get("model-id").parameters),h=t.style.order.indexOf(i.fqid);for(const p of r){const r=n.getTile(p).getBucket(i);if(!r||r.projection.name!==a.projection.name)continue;const m=r.getModelUris();m&&!r.modelsRequested&&(l.addModelsFromBucket(m,s),r.modelsRequested=!0);const f=Ua(p,a);u.zoom=f;const g=d.possiblyEvaluate(u);if(Ba(t,r,p),Va.shadowUniformsInitialized=!1,Va.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(p.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const n=a.calculatePosMatrix(p.toUnwrapped(),a.worldSize);if(Va.tileMatrix.set(n),Va.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(n)),Va.aabb.min.fill(0),Va.aabb.max[0]=Va.aabb.max[1]=e.aj,Va.aabb.max[2]=0,Wa(r,Va,t,i.scope))continue}const x=1<<p.canonical.z,y=[((o.x-p.wrap)*x-p.canonical.x)*e.aj,(o.y*x-p.canonical.y)*e.aj,o.z*x*e.aj];t.conflationActive&&Object.keys(r.instancesPerModel).length>0&&t.style.isLayerClipped(i,n.getSource())&&r.updateReplacement(p,t.replacementSource,h,s)&&(r.uploaded=!1,r.upload(t.context));for(let e in r.instancesPerModel){const n=r.instancesPerModel[e];n.features.length>0&&(e=g.evaluate(n.features[0].feature,{}));const a=l.getModel(e,s);if(a||l.hasURLBeenRequested(e)||r.modelUris.includes(e)||(r.modelUris.push(e),r.modelsRequested=!1),a&&a.uploaded)for(const e of a.nodes)Ha(t,i,e,n,y,p,Va)}}}(t,n,i,r,"vector"===d.type?i.scope:""),void c();if(!d.loaded())return;if("batched-model"===d.type)return function(t,n,i,r){i.resetLayerRenderingStats(t);const s=t.context,a=t.transform,o=t.style.fog,l=t.shadowRenderer;if("mercator"!==a.projection.name)return void e.w("Drawing 3D landmark models for ".concat(a.projection.name," projection is not yet implemented"));const c=t.transform.getFreeCameraOptions().position,d=e.c1([],[c.x,c.y,c.z],t.transform.worldSize),u=e.eq([],d),h=e.bx([]),p=e.e9(a.center.lat,a.zoom),m=e.bn([],[1,1,1/p]);e.bo(h,h,u);const f=i.paint.get("model-opacity").constantOr(1),g=new Hn(s.gl.LEQUAL,Hn.ReadWrite,t.depthRangeFor3D),x=new Hn(s.gl.LEQUAL,Hn.ReadOnly,t.depthRangeFor3D),y=new e.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),v="shadow"===t.renderPass,_=v&&l?l.getCurrentCascadeFrustum():a.getFrustum(a.scaleZoom(a.worldSize)),b=i.paint.get("model-front-cutoff"),w=b[2]<1,j=ri(t,i.paint.get("model-cutoff-fade-range")),N=i.getLayerRenderingStats();(function(e,t,n,i){const r=e.terrain?e.terrain.exaggeration():0,s=e.transform.zoom;for(const a of i){const i=t.getTile(a).getBucket(n);i&&(i.setFilter(n.filter),e.conflationActive&&i.updateReplacement(a,e.replacementSource),i.evaluateTransform(e,n),e.terrain&&r>0&&i.elevationUpdate(e.terrain,r,a,n.source),i.needsReEvaluation(e,s,n)&&i.evaluate(n))}})(t,n,i,r),function(){let c,u,S;w?(c=r.length-1,u=-1,S=-1):(c=0,u=r.length,S=1);const k=new Float64Array(16),T=e.cx(),C=new e.P(0,0);for(let E=c;E!==u;E+=S){const c=r[E],u=n.getTile(c).getBucket(i);if(!u||!u.uploaded)continue;let S=!1;l&&(S=0===l.getMaxCascadeForTile(c.toUnwrapped()));const A=a.calculatePosMatrix(c.toUnwrapped(),a.worldSize),M=u.modelTraits;!v&&w&&(e.bi(k,A),e.ad(T,d,k),C.x=T[0],C.y=T[1]);const D=[];u.setFilter(i.filter);for(const n of u.getNodesInfo()){if(n.hiddenByReplacement)continue;if(!n.node.meshes)continue;const i=n.node;let r=0;t.terrain&&i.elevation&&(r=i.elevation*t.terrain.exaggeration());const s=(()=>{const t=n.aabb;return y.min=[...t.min],y.max=[...t.max],y.min[2]+=r,y.max[2]+=r,e.ad(y.min,y.min,A),e.ad(y.max,y.max,A),y})(),o=n.evaluatedScale;if(o[0]<=1&&o[1]<=1&&o[2]<=1&&0===s.intersects(_))continue;if(!v&&w){const t=1/6;n.cameraCollisionOpacity=d[0]>s.min[0]&&d[0]<s.max[0]&&d[1]>s.min[1]&&d[1]<s.max[1]&&d[2]*p<s.max[2]&&i.footprint&&e.bY(C,i.footprint)?Math.max(n.cameraCollisionOpacity-t,0):Math.min(1,n.cameraCollisionOpacity+t)}const l=[...A],u=1/e.d4(c.canonical),h=i.anchor?i.anchor[0]:0,m=i.anchor?i.anchor[1]:0;e.bo(l,l,[h*(o[0]-1)+n.evaluatedTranslation[0]*u,m*(o[1]-1)+n.evaluatedTranslation[1]*u,r+n.evaluatedTranslation[2]]),e.cn(o,e.es)||e.cP(l,l,o);const g=e.az([],l,i.matrix),x=e.az([],a.expandedFarZProjMatrix,g),N=e.az([],a.expandedFarZProjMatrix,l),S=e.aA([],[h,m,r,1],x)[2];i.hidden=!1;let k=f;v||(w&&(k*=n.cameraCollisionOpacity,k*=Ya(l,a,n.aabb,b)),k*=Ga(j,S)),0!==k?D.push({nodeInfo:n,depth:S,opacity:k,wvpForNode:x,wvpForTile:N,nodeModelMatrix:g,tileModelMatrix:l}):i.hidden=!0}v||D.sort((e,t)=>!w||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1);for(const n of D){const r=n.nodeInfo,c=r.node;let d=e.az([],m,n.tileModelMatrix);e.az(d,h,d);const u=e.bi([],d);e.ea(u,u),e.cP(u,u,qa),d=e.az(d,d,c.matrix);const p="light-beam"===t.renderPass,f="none"===i.paint.get("model-color-use-theme").constantOr("default"),y=M&e.ex.HasMapboxMeshFeatures,_=y?0:r.evaluatedRMEA[0][2];for(let e=0;e<c.meshes.length;++e){const h=c.meshes[e],m=e===c.lightMeshIndex;let b=n.wvpForNode;if(m){if(!p&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}b=n.wvpForTile}else if(p)continue;const w={defines:[]},j=[];if(!v&&l&&(l.useNormalOffset=!!h.normalBuffer),La(w.defines,j,h,t,f?null:i.lut),y||w.defines.push("DIFFUSE_SHADED"),S&&w.defines.push("SHADOWS_SINGLE_CASCADE"),N&&(v?N.numRenderedVerticesInShadowPass+=h.vertexArray.length:N.numRenderedVerticesInTransparentPass+=h.vertexArray.length),v){Fa(h,n.nodeModelMatrix,t,i);continue}let k=null;if(o){const e=Ra(n.nodeModelMatrix,t.transform);if(k=new Float32Array(e),"globe"!==a.projection.name){const t=h.aabb.min,n=h.aabb.max,[i,r]=o.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);w.overrideFog=i>=Fe||r>=Fe}}const T=h.material;let C;T.occlusionTexture&&T.occlusionTexture.offsetScale&&(C=T.occlusionTexture.offsetScale,w.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const E=t.getOrCreateProgram("model",w);!v&&l&&l.setupShadowsFromMatrix(n.tileModelMatrix,E,l.useNormalOffset),t.uploadCommonUniforms(s,E,null,k);const A=T.pbrMetallicRoughness;A.metallicFactor=.9,A.roughnessFactor=.5;const M=Ds(new Float32Array(b),new Float32Array(d),new Float32Array(u),new Float32Array(c.matrix),t,n.opacity,A.baseColorFactor,T.emissiveFactor,A.metallicFactor,A.roughnessFactor,T,_,i,[0,0,0],C);!m&&(r.hasTranslucentParts||n.opacity<1)&&E.draw(t,s.gl.TRIANGLES,g,Wn.disabled,Un.disabled,Zn.backCCW,M,i.id,h.vertexBuffer,h.indexBuffer,h.segments,i.paint,t.transform.zoom,void 0,j),E.draw(t,s.gl.TRIANGLES,m?x:g,Wn.disabled,m||n.opacity<1||r.hasTranslucentParts?Un.alphaBlended:Un.unblended,Zn.backCCW,M,i.id,h.vertexBuffer,h.indexBuffer,h.segments,i.paint,t.transform.zoom,void 0,j)}}}}()}(t,n,i,r),void c();if("model"!==d.type)return;const u=d.getModels(),h=[],p=t.transform.getFreeCameraOptions().position,m=e.c1([],[p.x,p.y,p.z],t.transform.worldSize);e.eq(m,m);const f=[],g=[];let x=0;for(const y of u){const n=i.paint.get("model-rotation").constantOr(null),r=i.paint.get("model-scale").constantOr(null),s=i.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,n,r,s,!0,!0,!1);const a=e.bx([]),o=e.e9(y.position.lat,t.transform.zoom),l=e.bn([],[1,1,1/o]);e.bo(a,a,m),h.push({zScaleMatrix:l,negCameraPosMatrix:a});for(const e of y.nodes)Oa(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,x,f,g);x++}if(f.sort((e,t)=>t.depth-e.depth),"shadow"!==t.renderPass){if(1===s)for(const e of g)za(e,t,i,h[e.modelIndex],Wn.disabled,t.colorModeForRenderPass());else{for(const e of g)za(e,t,i,h[e.modelIndex],Wn.disabled,Un.disabled);for(const e of g)za(e,t,i,h[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of f)za(e,t,i,h[e.modelIndex],Wn.disabled,t.colorModeForRenderPass());c()}else{for(const e of g)Fa(e.mesh,e.nodeModelMatrix,t,i);for(const e of f)Fa(e.mesh,e.nodeModelMatrix,t,i);c()}}},ho={line:function(e,t,n){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(t){const n=t.getVisibleCoordinates();for(const i of n){const n=t.getTile(i).getBucket(e);if(n&&("none"!==n.elevationType?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}}else e.hasNonElevatedBuckets=!0},model:function(e,t,n){const i=t.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(n.modelManager&&n.modelManager.upload(n,"vector"===i.type?e.scope:""));if("batched-model"===i.type)return;if("model"!==i.type)return;const r=i.getModels();for(const s of r)s.upload(n.context)},raster:function(e,t,n){const i=t.getSource();if(!(i instanceof ot&&i.loaded()))return;const r=e.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!r)return;const s=e.paint.get("raster-array-band")||i.getInitialBand(r);if(null==s)return;const a=t.getIds().map(e=>t.getTileByID(e));for(const o of a)o.updateNeeded(e.id,s)&&i.prepareTile(o,r,e.id,s)},"raster-particle":function(e,t,n){const i=t.getSource();if(!(i instanceof ot&&i.loaded()))return;const r=e.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!r)return;const s=e.paint.get("raster-particle-array-band")||i.getInitialBand(r);if(null==s)return;const a=t.getIds().map(e=>t.getTileByID(e));for(const o of a)o.updateNeeded(e.id,s)&&i.prepareTile(o,r,e.id,s)}},po={fill:Xs},mo={fill:function(e,t,n,i){if(!n.layout||"none"===n.layout.get("fill-elevation-reference"))return;const r=e.context.gl,s=new Hn(r.LEQUAL,Hn.ReadOnly,e.depthRangeFor3D),a=new Wn({func:r.ALWAYS,mask:255},255,255,r.KEEP,r.KEEP,r.REPLACE),o=e.transform.getFreeCameraOptions().position,l=e.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const c of i){const i=t.getTile(c),d=i.getBucket(n);if(!d)continue;const u=d.elevatedStructures;if(!u||0===u.depthSegments.segments[0].primitiveLength)continue;const h=Zs(c.toUnwrapped(),o),p=e.translatePosMatrix(c.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),m=us(p,h,0,1,0);l.draw(e,r.TRIANGLES,s,a,Un.disabled,Zn.disabled,m,n.id,u.vertexBuffer,u.indexBuffer,u.depthSegments,n.paint,e.transform.zoom)}}};class fo{constructor(t,n,i,r,s,a){this.context=new Fs(t,n),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=s,this._timeStamp=e.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const o=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const e of o)this._debugParams.enabledLayers[e]=!0;s.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),s.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),s.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),s.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),s.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),s.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of o)s.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.occlusionParams=new Ka(s),this.setup(),this.numSublayers=Et.maxUnderzooming+Et.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new li(this),this._wireframeDebugCache=new Xa,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const l=new e.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,l,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=r,this.worldview=a}updateTerrain(e,t){const n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Xr(this,e));const i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=t.getFovAdjustedRange(this.transform._fov);if(n>i)return void(this.transform.fogCullDistSq=null);const r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new Xr(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*e.q.devicePixelRatio,this.height=n*e.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,n=new e.ba;n.emplaceBack(0,0),n.emplaceBack(e.aj,0),n.emplaceBack(0,e.aj),n.emplaceBack(e.aj,e.aj),this.tileExtentBuffer=t.createVertexBuffer(n,e.bc.members),this.tileExtentSegments=e.bd.simpleSegment(0,0,4,2);const i=new e.ba;i.emplaceBack(0,0),i.emplaceBack(e.aj,0),i.emplaceBack(0,e.aj),i.emplaceBack(e.aj,e.aj),this.debugBuffer=t.createVertexBuffer(i,e.bc.members),this.debugSegments=e.bd.simpleSegment(0,0,4,5);const r=new e.ba;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.bc.members),this.viewportSegments=e.bd.simpleSegment(0,0,4,2);const s=new e.aZ;s.emplaceBack(0,0,0,0),s.emplaceBack(e.aj,0,e.aj,0),s.emplaceBack(0,e.aj,0,e.aj),s.emplaceBack(e.aj,e.aj,e.aj,e.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(s,e.bf.members),this.mercatorBoundsSegments=e.bd.simpleSegment(0,0,4,2);const a=new e.a_;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const o=new e.bb;for(const e of[0,1,3,2,0])o.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(o),this.emptyTexture=new e.T(t,new e.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=e.bz();const l=this.context.gl;this.stencilClearMode=new Wn({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Hn.disabled,this.stencilClearMode,Un.disabled,Zn.disabled,qr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,n){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const i=this.context,r=i.gl;this.nextStencilID+n.length>256&&this.clearStencil(),i.setColorMode(Un.disabled),i.setDepthMode(Hn.disabled);const s=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of n){const e=t.getTile(a),n=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,{tileBoundsBuffer:i,tileBoundsIndexBuffer:o,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);s.draw(this,r.TRIANGLES,Hn.disabled,new Wn({func:r.ALWAYS,mask:0},n,255,r.KEEP,r.KEEP,r.REPLACE),Un.disabled,Zn.disabled,qr(a.projMatrix),"$clipping",i,o,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Wn({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Wn({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let n=0;n<r;n++)e[n+i]=new Wn({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,n]}return[{[i]:Wn.disabled},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new Un([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.am(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Un.unblended:Un.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Un([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new e.am(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.depthOcclusion)return new Hn(this.context.gl.GREATER,Hn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!i)return Hn.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Hn(n||this.context.gl.LEQUAL,t,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),i=Math.ceil(this.height),r=this.context.bindFramebuffer.get(),s=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===i||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==n&&0!==i&&(this.depthFBO=new Os(this.context,n,i,!1,"texture"),this.depthTexture=new e.T(this.context,{width:n,height:i,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(r),t.bindTexture(t.TEXTURE_2D,s),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,i,0,0,n,i,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((e,t)=>e+t/this._fpsHistory.length,0))}render(t,n){const i=e.q.now();this._dt=i-this._timeStamp,this._timeStamp=i,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const r=this.style._mergedLayers,s=!(!this.terrain||!this.terrain.enabled),a=()=>this.style._getOrder(s).filter(e=>{const t=r[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]});let o=a(),l=!1,c=!1,d=null;for(const e of o){const t=r[e];"circle"===t.type?l=!0:"building"===t.type?d=t:"symbol"===t.type&&(t.hasInitialOcclusionOpacityProperties?c=!0:l=!0)}let u=o.map(e=>r[e]);const h=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.q.now()),this.imageManager.beginFrame();let p=0,m=!1;for(const e in h){const t=h[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++p)}let f=!1;for(const e of u)e.isHidden(this.transform.zoom)||("clip"===e.type&&(f=!0),this.prepareLayer(e));const g={},x={},y={},v={},_={};for(const e in h){const t=h[e];g[e]=t.getVisibleCoordinates(),x[e]=g[e].slice().reverse(),y[e]=t.getVisibleCoordinates(!0).reverse(),v[e]=t.getShadowCasterCoordinates(),_[e]=t.sortCoordinatesByDistance(g[e])}const b=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(p||f||this._clippingActiveLastFrame){const t=[],n=[];let i=0;for(const e of u)this.isSourceForClippingOrConflation(e,b(e))&&(t.push(e),n.push(i)),i++;if(t&&(f||t.length>1)||this._clippingActiveLastFrame){f=!1;const i=[];for(let r=0;r<t.length;r++){const s=t[r],a=n[r],o=this.style.getLayerSourceCache(s);if(!o||!o.used||!o.getSource().usedInConflation&&"clip"!==s.type&&"building"!==s.type)continue;let l=e.eF,c=e.bW.None;const d=[];let u=!0;if("building"===s.type)l=e.eH;else if("clip"===s.type){l=a;for(const t of s.layout.get("clip-layer-types"))c|="model"===t?e.bW.Model:"symbol"===t?e.bW.Symbol:e.bW.FillExtrusion;for(const e of s.layout.get("clip-layer-scope"))d.push(e);s.isHidden(this.transform.zoom)?u=!1:f=!0}u&&i.push({layer:s.fqid,cache:o,order:l,clipMask:c,clipScope:d})}this.replacementSource.setSources(i),m=!0}}this._clippingActiveLastFrame=f,m||this.replacementSource.clear(),this.conflationActive=m,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<u.length;e++){const t=u[e],n=t.cutoffRange();if(this.longestCutoffRange=Math.max(n,this.longestCutoffRange),n>0){const e=b(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}t.is3D(s)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}const w=this.style&&this.style.fog;w?(this._fogVisible=0!==w.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0,o=a(),u=o.map(e=>r[e]));const j=this._shadowRenderer;if(j){j.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in h)for(const t of g[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),j.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ia(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const N=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),S=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(N&&!this._snow&&(this._snow=new co(this)),!N&&this._snow&&(this._snow.destroy(),delete this._snow),S&&!this._rain&&(this._rain=new oo(this)),!S&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),d){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Pa);const e=this.style.getLayerSourceCache(d);this.buildingTileBorderManager.updateBorders(e,d)}if(!H.has(this.context.gl))return;this.renderPass="offscreen";for(const e of u){const n=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=n?x[n.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||i&&i.length)&&this.renderLayer(this,n,e,i)}this.depthRangeFor3D=[0,1-(u.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const k="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),T=(()=>{if(n.showOverdrawInspector)return e.am.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const n=this.style.getLut(t.scope);if(!k){const i="none"===t.properties.get("color-use-theme"),r=t.properties.get("color").toNonPremultipliedRenderColor(i?null:n).toArray01();return new e.am(...r)}if(k){const i="none"===t.properties.get("space-color-use-theme"),r=t.properties.get("space-color").toNonPremultipliedRenderColor(i?null:n).toArray01();return new e.am(...r)}}return e.am.transparent})();if(this.context.clear({color:T,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&k&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const e=u[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky())continue;const i=n?(e.is3D(s)?_:x)[n.id]:void 0;this._renderTileClippingMasks(e,n,i),this.renderLayer(this,n,e,i)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&k&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.ah(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const e=u[this.currentLayer],n=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,n,e,n?x[n.id]:void 0)}function C(e,t){let n;return t&&(n=("symbol"===e.type?y:e.is3D(s)?_:x)[t.id]),n}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<o.length;){const e=u[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const n=t.getLayerSourceCache(e);this.renderLayer(this,n,e,C(e,n))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let E=0;j&&(E=j.getShadowCastingLayerCount());let A=!1,M=-1;for(let e=0;e<o.length;++e){const t=u[e];t.isHidden(this.transform.zoom)||t.is3D(s)&&(M=e)}c&&-1===M&&(l=!0);let D=!1;for(;this.currentLayer<o.length;){const e=u[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!D&&e.is3D(s)&&!s){const e=this.currentLayer,t=e=>{for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const t=u[this.currentLayer];if(po[t.type]){const n=this.style.getLayerSourceCache(t);po[t.type](this,n,t,C(t,n),e)}}};t("initialize"),t("reset"),this.currentLayer=e,D=!0}if(l&&!A&&this.terrain&&!this.transform.isOrthographic&&(A=!0,this.blitDepth()),c&&-1!==M&&this.currentLayer===M+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,n,n?g[n.id]:void 0),this.renderLayer(this,n,e,C(e,n)),!this.terrain&&j&&E>0&&e.hasShadowPass()&&0==--E){{this.clearStencil(),this.resetStencilClippingMasks();const e=this.currentLayer;for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const e=u[this.currentLayer];if(mo[e.type]){const t=this.style.getLayerSourceCache(e);mo[e.type](this,t,e,C(e,t))}}this.currentLayer=e}if(j.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=u[this.currentLayer];if(!e.hasLightBeamPass())continue;const n=t.getLayerSourceCache(e);this.renderLayer(this,n,e,n?x[n.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const n of this.layersWithOcclusionOpacity){this.currentLayer=n;const e=u[this.currentLayer],i=t.getLayerSourceCache(e),r=i?x[i.id]:void 0;this.terrain||this._renderTileClippingMasks(e,i,i?g[i.id]:void 0),this.renderLayer(this,i,e,r)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let n=null;u.forEach(e=>{const i=t.getLayerSourceCache(e);i&&!e.isHidden(this.transform.zoom)&&i.getVisibleCoordinates().length&&(!n||n.getSource().maxzoom<i.getSource().maxzoom)&&(n=i)}),n&&this.options.showTileBoundaries&&va(this,n,n.getVisibleCoordinates(),e.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&va(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;ba(e,e.transform.height-(t.top||0),3,ma),ba(e,t.bottom||0,3,fa),wa(e,t.left||0,3,ga),wa(e,e.transform.width-(t.right||0),3,xa);const n=e.transform.centerPoint;!function(e,t,n,i){ja(e,t-1,n-10,2,20,i),ja(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,ya)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),m||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,n=!t||!t.includes(e.type);if(ho[e.type]&&(n||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);ho[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||"model"===n.type||"raster"===n.type||"raster-particle"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(n.type)&&(!e.terrain||"custom"!==n.type)||"clip"===n.type||uo[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,n=this.context.gl;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:n.createQuery()}),i.calls++,n.beginQuery(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,n=t.createQuery();this.deferredRenderGpuTimeQueries.push(n),t.beginQuery(e.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const n in e){const i=e[n],r=this.context.extTimerQuery,s=r.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(i.query),t[n]=s}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.gl;let n=0;for(const i of e)n+=t.getQueryParameter(i,t.QUERY_RESULT)/1e6,t.deleteQuery(i);return n}translatePosMatrix(t,n,i,r,s){if(!i[0]&&!i[1])return t;const a=s?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(a){const e=Math.sin(a),t=Math.cos(a);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}const o=[s?i[0]:e.aw(n,i[0],this.transform.zoom),s?i[1]:e.aw(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return e.bo(l,t,o),l}saveTileTexture(e){if(e.context!==this.context)return;const t=e.size[0],n=this._tileTextures[t];n?n.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,n){const i=void 0===n?this.terrain&&this.terrain.renderingToTexture:n,r=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(r.push("LIGHTING_3D_MODE"),r.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||r.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||r.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(r.push("TERRAIN"),this.linearFloatFilteringSupported()&&r.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&r.push("GLOBE"),!this._fogVisible||i||void 0!==t&&!t||r.push("FOG","FOG_DITHERING"),i&&r.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&r.push("OVERDRAW_INSPECTOR"),r}getOrCreateProgram(e,t){this.cache=this.cache||{};const n=t&&t.defines||[],i=t&&t.config,r=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(n),s=$r.cacheKey(Gi[e],e,r,i);return this.cache[s]||(this.cache[s]=new $r(this.context,e,Gi[e],i,Ps[e],r)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const i=this.style.directionalLight,r=this.style.ambientLight;if(i&&r){const s=((t,n,i)=>{const r=t.properties.get("direction"),s="none"===t.properties.get("color-use-theme"),a=t.properties.get("color").toNonPremultipliedRenderColor(s?null:i.getLut(t.scope)).toArray01(),o=t.properties.get("intensity"),l="none"===n.properties.get("color-use-theme"),c=n.properties.get("color").toNonPremultipliedRenderColor(l?null:i.getLut(n.scope)).toArray01(),d=n.properties.get("intensity"),u=[r.x,r.y,r.z],h=e.dI(c,d),p=e.dI(a,o);return{u_lighting_ambient_color:h,u_lighting_directional_dir:u,u_lighting_directional_color:p,u_ground_radiance:Kr(u,p,h)}})(i,r,this.style);n.setLightsUniformValues(t,s)}}}uploadCommonUniforms(t,n,i,r,s){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const s=a.getOpacity(this.transform.pitch),o=((t,n,i,r,s,a,o,l,c,d,u,h)=>{const p=t.transform,m="none"===n.properties.get("color-use-theme"),f=n.properties.get("color").toNonPremultipliedRenderColor(m?null:t.style.getLut(n.scope)).toArray01();f[3]=r;const g=t.frameCounter/1e3%1,[x,y]=n.properties.get("vertical-range");return{u_fog_matrix:i?p.calculateFogTileMatrix(i):h||t.identityMat,u_fog_range:n.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:n.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(x,y),y],u_fog_temporal_offset:g,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:o,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:d,u_viewport:u,u_globe_transition:e.ah(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,a,i,s,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.q.devicePixelRatio,this.transform.height*e.q.devicePixelRatio],r);n.setFogUniformValues(t,o)}s&&n.setCutoffUniformValues(t,s.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const i of n)t[i.key]=e[i.key]||new St(i,512,this.transform.tileZoom,this,void 0,this.worldview);return t}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,t){return!(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&"building"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer&&"procedural_buildings"!==e.sourceLayer)&&(!t||"batched-model"!==t.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=Fe||t[1]>=Fe}setupDepthForOcclusion(e,t,n){const i=this.context,r=i.gl,s=!!n;var a;n||(n={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),i.activeTexture.set(r.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),n.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],n.u_depth_range_unpack=[2/((a=this.depthRangeFor3D)[1]-a[0]),-1-2*a[0]/(a[1]-a[0])],n.u_occluder_half_size=.5*this.occlusionParams.occluderSize,n.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),i.activeTexture.set(r.TEXTURE0),s||t.setTerrainUniformValues(i,n)}}function go(e,t){let n=!1,i=null;const r=()=>{i=null,n&&(e(),i=setTimeout(r,t),n=!1)};return()=>(n=!0,i||r(),i)}class xo{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=go(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=yo(e);if(this._hashName){const e=this._hashName;let n=!1;const i=location.hash.slice(1).split("&").map(i=>{const r=i.split("=")[0];return r===e?(n=!0,"".concat(r,"=").concat(t)):i}).filter(e=>e);return n||i.push("".concat(e,"=").concat(t)),"#".concat(i.join("&"))}return"#".concat(t)}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some(e=>isNaN(Number(e)))){const n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function yo(e,t){const n=e.getCenter(),i=Math.round(100*e.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,r),a=Math.round(n.lng*s)/s,o=Math.round(n.lat*s)/s,l=e.getBearing(),c=e.getPitch();let d=t?"/".concat(a,"/").concat(o,"/").concat(i):"".concat(i,"/").concat(o,"/").concat(a);return(l||c)&&(d+="/"+Math.round(10*l)/10),c&&(d+="/".concat(Math.round(c))),d}const vo={linearity:.3,easing:e.eI(0,0,.3,1)},_o=e.h({deceleration:2500,maxSpeed:1400},vo),bo=e.h({deceleration:20,maxSpeed:1400},vo),wo=e.h({deceleration:1e3,maxSpeed:360},vo),jo=e.h({deceleration:1e3,maxSpeed:90},vo);class No{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=e.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const s=ko(n.pan.mag(),i,e.h({},_o,t||{}));r.offset=n.pan.mult(s.amount/n.pan.mag()),r.center=this._map.transform.center,So(r,s)}if(n.zoom){const e=ko(n.zoom,i,bo);r.zoom=this._map.transform.zoom+e.amount,So(r,e)}if(n.bearing){const t=ko(n.bearing,i,wo);r.bearing=this._map.transform.bearing+e.ay(t.amount,-179,179),So(r,t)}if(n.pitch){const e=ko(n.pitch,i,jo);r.pitch=this._map.transform.pitch+e.amount,So(r,e)}if(r.zoom||r.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function So(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function ko(t,n,i){const{maxSpeed:r,linearity:s,deceleration:a}=i,o=e.ay(t*s/(n/1e3),-r,r),l=Math.abs(o)/(a*s);return{easing:i.easing,duration:1e3*l,amount:o*(l/2)}}class To extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=_(n.getCanvasContainer(),i),a=n.unproject(s);super(t,e.h({point:s,lngLat:a,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Co extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const r="touchend"===t?i.changedTouches:i.touches,s=b(n.getCanvasContainer(),r),a=s.map(e=>n.unproject(e)),o=s.reduce((e,t,n,i)=>e.add(t.div(i.length)),new e.P(0,0));super(t,{points:s,point:o,lngLats:a,lngLat:n.unproject(o),originalEvent:i}),this._defaultPrevented=!1}}class Eo extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1}}class Ao{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new Eo(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new To(e.type,this._map,e))}mouseup(e){this._map.fire(new To(e.type,this._map,e))}preclick(t){const n=e.h({},t);n.type="preclick",this._map.fire(new To(n.type,this._map,n))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new To(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new To(e.type,this._map,e))}mouseover(e){this._map.fire(new To(e.type,this._map,e))}mouseout(e){this._map.fire(new To(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Co(e.type,this._map,e))}touchmove(e){this._map.fire(new Co(e.type,this._map,e))}touchend(e){this._map.fire(new Co(e.type,this._map,e))}touchcancel(e){this._map.fire(new Co(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mo{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new To(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new To("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new To(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Do{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(g(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t,i=this._startPos,r=this._lastPos;if(!i||!r||r.equals(n)||!this._box&&n.dist(i)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=u("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const s=Math.min(i.x,n.x),a=Math.max(i.x,n.x),o=Math.min(i.y,n.y),l=Math.max(i.y,n.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform="translate(".concat(s,"px,").concat(o,"px)"),this._box.style.width=a-s+"px",this._box.style.height=l-o+"px")})}mouseupWindow(t,n){if(!this._active)return;const i=this._startPos,r=n;if(i&&0===t.button){if(this.reset(),v(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.A("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),x(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.A(t,{originalEvent:n}))}}function Io(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class Po{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const n=new e.P(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=Io(i,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=Io(n,t);for(const r in this.touches){const e=i[r];(!e||e.dist(this.touches[r])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Ro{constructor(e){this.singleTap=new Po(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Lo{constructor(){this._zoomIn=new Ro({numTouches:1,numTaps:2}),this._zoomOut=new Ro({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zo={0:1,2:2},Oo={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Fo{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=w(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const n=zo[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&w(e)===this._eventButton&&(this._moved&&v(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bo extends Fo{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Vo extends Fo{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?Oo[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class Uo extends Fo{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?Oo[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class Ho{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),e.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(t,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!e.eJ())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,i)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const r=Io(i,n),s=new e.P(0,0),a=new e.P(0,0);let o=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(s._add(t),a._add(t.sub(n)),o++,r[e]=t)}if(this._touches=r,o<this._minTouches||!a.mag())return;const l=a.div(o);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(o),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=u("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class qo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){const i=this._firstTwoTouches;if(!i)return;e.preventDefault();const[r,s]=i,a=Wo(n,t,r),o=Wo(n,t,s);if(!a||!o)return;const l=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],l,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,s=Wo(n,t,i),a=Wo(n,t,r);s&&a||(this._active&&v(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wo(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function Go(e,t){return Math.log(e/t)/Math.LN2}class Yo extends qo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Go(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Go(this._distance,n),pinchAround:t}}}function Zo(e,t){return 180*e.angleWith(t)/Math.PI}class Xo extends qo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Zo(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;const i=Zo(e,n);return Math.abs(i)<t}}function Ko(e){return Math.abs(e.y)>Math.abs(e.x)}class Qo extends qo{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Ko(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,n,i){const r=this._lastPoints;if(!r)return;const s=t[0].sub(r[0]),a=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.eJ()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(s,a,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(s.y+a.y)/2*-.5})}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const s=e.y>0==t.y>0;return Ko(e)&&Ko(t)&&s}}const Jo={panStep:100,bearingStep:15,pitchStep:10};class $o{constructor(){const e=Jo;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,s=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),s=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:a=>{const o=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:el,zoom:t?Math.round(o)+t*(e.shiftKey?2:1):o,bearing:a.getBearing()+n*this._bearingStep,pitch:a.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-s*this._panStep],center:a.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function el(e){return e*(2-e)}const tl=4.000244140625,nl=1/450;class il{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=nl,e.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.eJ()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=e.q.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%tl==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=_(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>tl?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const r=n(),s=Math.pow(2,r),a="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(a*i))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),r=this._startZoom,s=this._easing;let a,o=!1;if("wheel"===this._type&&r&&s){const t=Math.min((e.q.now()-this._lastWheelEventTime)/200,1),n=s(t);a=e.ai(r,i,n),t<1?this._frameId||(this._frameId=!0):o=!0}else a=i,o=!0;this._active=!0,o&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let l=a-n();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!o,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.eK;if(this._prevEase){const t=this._prevEase,i=(e.q.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),s=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-s*s);n=e.eI(s,a,.25,1)}return this._prevEase={start:e.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=u("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class rl{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class al{constructor(){this._tap=new Ro({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ol{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ll{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cl{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const dl=e=>e.zoom||e.drag||e.pitch||e.rotate;class ul extends e.A{}class hl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const i=e.at([],n,t);this.radius=e.ae(i[2]<0?e.eM([],i,this.constants):[i[0],i[1],0])}projectRay(t){e.eM(t,t,this.constants),e.au(t,t),e.eN(t,t,this.constants);const n=e.c1([],t,this.radius);if(n[2]>0){const t=e.c1([],[0,0,1],e.bG(n,[0,0,1])),i=e.c1([],e.au([],[n[0],n[1],0]),this.radius),r=e.d5([],n,e.c1([],e.at([],e.d5([],i,t),n),2));n[0]=r[0],n[1]=r[1]}return n}}function pl(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class ml{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new No(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),e.aV(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,r,s]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(r,t,s)}}destroy(){for(const[e,t,n]of this._listeners){const i=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,i,n)}}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Ao(t,e));const i=t.boxZoom=new Do(t,e);this._add("boxZoom",i);const r=new Lo,s=new sl;t.doubleClickZoom=new rl(s,r),this._add("tapZoom",r),this._add("clickZoom",s);const a=new al;this._add("tapDragZoom",a);const o=t.touchPitch=new Qo(t);this._add("touchPitch",o);const l=new Vo(e),c=new Uo(e);t.dragRotate=new ll(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const d=new Bo(e),u=new Ho(t,e);t.dragPan=new ol(n,d,u),this._add("mousePan",d),this._add("touchPan",u,["touchZoom","touchRotate"]);const h=new Xo,p=new Yo;t.touchZoomRotate=new cl(n,p,h,a),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Mo(t));const m=t.scrollZoom=new il(t,this);this._add("scrollZoom",m,["mousePan"]);const f=t.keyboard=new $o;this._add("keyboard",f);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){this._updatingCamera=!0;const n="renderFrame"===e.type,i=n?void 0:e,r={needsRenderFrame:!1},s={},a={},o=e.touches?this._getMapTouches(e.touches):void 0,l=o?b(this._el,o):n?void 0:_(this._el,e);for(const{handlerName:u,handler:h,allowed:p}of this._handlers){if(!h.isEnabled())continue;let n;this._blockedByActive(a,p,u)?h.reset():h[t||e.type]&&(n=h[t||e.type](e,l,o),this.mergeHandlerResult(r,s,n,u,i),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||h.isActive())&&(a[u]=h)}const c={};for(const u in this._previousActiveHandlers)a[u]||(c[u]=i);this._previousActiveHandlers=a,(Object.keys(c).length||pl(r))&&(this._changes.push([r,s,c]),this._triggerRenderFrame()),(Object.keys(a).length||pl(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:d}=r;d&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],d(this._map))}mergeHandlerResult(t,n,i,r,s){if(!i)return;e.h(t,i);const a={handlerName:r,originalEvent:i.originalEvent||s};void 0!==i.zoomDelta&&(n.zoom=a),void 0!==i.panDelta&&(n.drag=a),void 0!==i.pitchDelta&&(n.pitch=a),void 0!==i.bearingDelta&&(n.rotate=a)}_applyChanges(){const t={},n={},i={};for(const[r,s,a]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.h(n,s),e.h(i,a);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,n,i){const r=this._map,s=r.transform,a=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!pl(t)){const e=s.zoom;s.cameraElevationReference="sea",null!=this._originalZoom&&s._orthographicProjectionAtLowPitch&&"globe"!==s.projection.name&&0===s.pitch?(s.cameraElevationReference="ground",s.zoom=this._originalZoom):(s.recenterOnTerrain(),s.cameraElevationReference="ground"),e!==s.zoom&&this._map._update(!0)}if(s._isCameraConstrained&&r._stop(!0),!pl(t))return void this._fireEvents(n,i,!0);let{panDelta:o,zoomDelta:l,bearingDelta:c,pitchDelta:d,around:u,aroundCoord:h,pinchAround:p}=t;s._isCameraConstrained&&(l>0&&(l=0),s._isCameraConstrained=!1),void 0!==p&&(u=p),(l||(e=>n[e]&&!this._eventsInProgress[e])("drag"))&&u&&(this._dragOrigin=a(s.pointCoordinate3D(u)),this._originalZoom=s.zoom,this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",r._stop(!0),u=u||r.transform.centerPoint,c&&(s.bearing+=c),d&&(s.pitch+=d),s._updateCameraState();const m=[0,0,0];if(o)if("mercator"===s.projection.name){const e=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(u).dir),t=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(u.sub(o)).dir);m[0]=t[0]-e[0],m[1]=t[1]-e[1]}else{const t=s.pointCoordinate(u);if("globe"===s.projection.name){o=o.rotate(-s.angle);const n=s._pixelsPerMercatorPixel/s.worldSize;m[0]=-o.x*e.eL(e.aY(t.y))*n,m[1]=-o.y*e.eL(s.center.lat)*n}else{const e=s.pointCoordinate(u.sub(o));t&&e&&(m[0]=e.x-t.x,m[1]=e.y-t.y)}}const f=s.zoom,g=[0,0,0];if(l){const t=a(h||s.pointCoordinate3D(u)),n={dir:e.au([],e.at([],t,s._camera.position))};if(n.dir[2]<0){const i=s.zoomDeltaToMovement(t,l);e.c1(g,n.dir,i)}}const x=e.d5(m,m,g);s._translateCameraConstrained(x),l&&Math.abs(s.zoom-f)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,i,!0)}_fireEvents(t,n,i){const r=dl(this._eventsInProgress),s=dl(t),a={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(a["".concat(e,"start")]=n),this._eventsInProgress[e]=t[e]}!r&&s&&this._fireEvent("movestart",s.originalEvent);for(const e in a)this._fireEvent(e,a[e]);s&&this._fireEvent("move",s.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const o={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=n[t]||i,o["".concat(e,"end")]=l)}for(const e in o)this._fireEvent(e,o[e]);const c=dl(this._eventsInProgress);if(i&&(r||s)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(n(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.A("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.A(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new ul("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const fl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class gl extends e.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,e.aV(["_renderFrameCallback"],this)}getCenter(){return new e.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,n,i){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.h({offset:t},n),i)}panTo(t,n,i){return this.easeTo(e.h({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,n,i){return this.easeTo(e.h({zoom:t},n),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,n,i){return this.easeTo(e.h({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,e.h({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.h({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,n){t=e.aG.convert(t);const i=n&&n.bearing||0,r=n&&n.pitch||0,s=t.getNorthWest(),a=t.getSouthEast();return this._cameraForBounds(this.transform,s,a,i,r,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return null==t?e.h({},n,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.h({},n,t)}_extendCameraOptions(t){return(t=e.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const n=t.max[0]-t.min[0],i=t.max[1]-t.min[1];return n/i>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):i/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,n,i,r,s,a){const o=t.clone(),l=this._extendCameraOptions(a);o.bearing=r,o.pitch=s;const c=e.ci.convert(n),d=e.ci.convert(i),u=.5*(c.lat+d.lat),h=.5*(c.lng+d.lng),p=e.eO(u,h),m=e.au([],p),f=e.au([],e.bF([],m,[0,1,0])),g=e.bF([],f,m),x=[f[0],f[1],f[2],0,g[0],g[1],g[2],0,m[0],m[1],m[2],0,0,0,0,1],y=[p,e.eO(c.lat,c.lng),e.eO(d.lat,c.lng),e.eO(d.lat,d.lng),e.eO(c.lat,d.lng),e.eO(u,c.lng),e.eO(u,d.lng),e.eO(c.lat,h),e.eO(d.lat,h)];let v=e.d6.fromPoints(y.map(t=>[e.bG(f,t),e.bG(g,t),e.bG(m,t)]));const _=e.ad([],v.center,x);0===e.eP(_)&&e.eQ(_,0,0,1),e.au(_,_),e.c1(_,_,e.aB),o.center=e.eR(_);const b=o.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);v=e.d6.applyTransform(v,e.az([],b,x));const j=this._extendAABB(v,o,l,r);if(!j)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=j,e.ad(_,_,b);const N=.5*(v.max[2]-v.min[2]),S=this._minimumAABBFrustumDistance(o,v),k=e.c1([],[0,0,1],N),T=e.d5(k,_,k),C=S+(0===o.pitch?0:e.bD(_,T)),E=o.globeCenterInViewSpace,A=e.at([],_,[E[0],E[1],E[2]]);e.au(A,A),e.c1(A,A,C);const M=e.d5([],_,A);e.ad(M,M,w);const D=e.eB/e.aB,I=e.ae(M),P=e.cb(Math.max(I*D-e.eB,Number.EPSILON),0),R=Math.min(o.zoomFromMercatorZAdjusted(P),l.maxZoom);return R>.5*(e.cX+e.cI)?(o.setProjection({name:"mercator"}),o.zoom=R,this._cameraForBounds(o,n,i,r,s,a)):{center:o.center,zoom:R,bearing:r,pitch:s}}_extendAABB(t,n,i,r){const s=.5*((i.padding.left||0)+(i.padding.right||0)),a=.5*((i.padding.top||0)+(i.padding.bottom||0)),o=a,l=s,c=s,d=a,u=n.width-(l+c),h=n.height-(o+d),p=e.at([],t.max,t.min),m=Math.min(u/p[0],h/p[1]),f=Math.min(n.scaleZoom(n.scale*m),i.maxZoom);if(isNaN(f))return null;const g=n.scale/n.zoomScale(f),x=new e.d6([t.min[0]-l*g,t.min[1]-d*g,t.min[2]],[t.max[0]+c*g,t.max[1]+o*g,t.max[2]]),y=("number"==typeof i.offset.x&&"number"==typeof i.offset.y?new e.P(i.offset.x,i.offset.y):e.P.convert(i.offset)).rotate(-e.al(r));return x.center[0]-=y.x*g,x.center[1]+=y.y*g,x}queryTerrainElevation(t,n){const i=this.transform.elevation;return i?(n=e.h({},{exaggerated:!0},n),i.getAtPoint(e.ac.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,i,r,s,a){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,n,i,r,s,a);const o=t.clone(),l=this._extendCameraOptions(a);o.bearing=r,o.pitch=s;const c=e.ci.convert(n),d=e.ci.convert(i),u=new e.ci(c.lng,d.lat),h=new e.ci(d.lng,c.lat),p=o.project(c),m=o.project(d),f=this.queryTerrainElevation(c),g=this.queryTerrainElevation(d),x=this.queryTerrainElevation(u),y=this.queryTerrainElevation(h),v=[[p.x,p.y,Math.min(f||0,g||0,x||0,y||0)],[m.x,m.y,Math.max(f||0,g||0,x||0,y||0)]];let _=e.d6.fromPoints(v);const b=o.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);_=e.d6.applyTransform(_,b);const j=this._extendAABB(_,o,l,r);if(!j)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_=j;const N=.5*e.at([],_.max,_.min)[2],S=this._minimumAABBFrustumDistance(o,_),k=[0,0,1,0];e.aA(k,k,b),e.eS(k,k);const T=e.c1([],k,S+N),C=e.d5([],_.center,T);e.ad(_.center,_.center,w),e.ad(C,C,w);const E=o.unproject(new e.P(_.center[0],_.center[1])),A=e.eT(o.projection,E),M=Math.pow(2,A),D=Math.min(o._zoomFromMercatorZ(C[2]*o.pixelsPerMeter*M/o.worldSize),l.maxZoom);return o.mercatorFromTransition&&D<.5*(e.cX+e.cI)?(o.setProjection({name:"globe"}),o.zoom=D,this._cameraForBounds(o,n,i,r,s,a)):{center:E,zoom:D,bearing:r,pitch:s}}fitBounds(e,t,n){const i=this.cameraForBounds(e,t);return this._fitInternal(i,t,n)}fitScreenCoordinates(t,n,i,r,s){const a=e.P.convert(t),o=e.P.convert(n),l=new e.P(Math.min(a.x,o.x),Math.min(a.y,o.y)),c=new e.P(Math.max(a.x,o.x),Math.max(a.y,o.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(a,o))return this;const d=this.transform.pointLocation3D(l),u=this.transform.pointLocation3D(c),h=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),m=[Math.min(d.lng,u.lng,h.lng,p.lng),Math.min(d.lat,u.lat,h.lat,p.lat)],f=[Math.max(d.lng,u.lng,h.lng,p.lng),Math.max(d.lat,u.lat,h.lat,p.lat)],g=r&&r.pitch?r.pitch:this.getPitch(),x=this._cameraForBounds(this.transform,m,f,i,g,r);return this._fitInternal(x,r,s)}_fitInternal(t,n,i){return t?(n=e.h(t,n)).linear?this.easeTo(n,i):this.flyTo(n,i):this}jumpTo(t,n){this.stop();const i=t.preloadOnly?this.transform.clone():this.transform;let r=!1,s=!1,a=!1;"zoom"in t&&i.zoom!==+t.zoom&&(r=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.ci.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(s=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(a=!0,i.pitch=+t.pitch);const o="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;if(null!=t.padding&&!i.isPaddingEqual(o))if(!1===t.retainPadding){const e=i.clone();e.padding=o,i.setLocationAtPoint(i.center,e.centerPoint)}else i.padding=o;return t.preloadOnly?(this._preloadTiles(i),this):(this.fire(new e.A("movestart",n)).fire(new e.A("move",n)),r&&this.fire(new e.A("zoomstart",n)).fire(new e.A("zoom",n)).fire(new e.A("zoomend",n)),s&&this.fire(new e.A("rotatestart",n)).fire(new e.A("rotate",n)).fire(new e.A("rotateend",n)),a&&this.fire(new e.A("pitchstart",n)).fire(new e.A("pitch",n)).fire(new e.A("pitchend",n)),this.fire(new e.A("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(fl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const i=this.transform;if(!i.projection.supportsFreeCamera)return e.w(fl),this;this.stop();const r=i.zoom,s=i.pitch,a=i.bearing;i.setFreeCameraOptions(t);const o=r!==i.zoom,l=s!==i.pitch,c=a!==i.bearing;return this.fire(new e.A("movestart",n)).fire(new e.A("move",n)),o&&this.fire(new e.A("zoomstart",n)).fire(new e.A("zoom",n)).fire(new e.A("zoomend",n)),c&&this.fire(new e.A("rotatestart",n)).fire(new e.A("rotate",n)).fire(new e.A("rotateend",n)),l&&this.fire(new e.A("pitchstart",n)).fire(new e.A("pitch",n)).fire(new e.A("pitchend",n)),this.fire(new e.A("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.h({offset:[0,0],duration:500,easing:e.eK},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const i=this.transform,r=this.getZoom(),s=this.getBearing(),a=this.getPitch(),o=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,d="pitch"in t?+t.pitch:a,u=this._extendPadding(t.padding),h=e.P.convert(t.offset);let p,m,f;if("globe"===i.projection.name){const n=e.ac.fromLngLat(i.center),r=h.rotate(-i.angle);n.x+=r.x/i.worldSize,n.y+=r.y/i.worldSize;const s=n.toLngLat(),a=e.ci.convert(t.center||s);this._normalizeCenter(a),p=i.centerPoint.add(r),m=new e.P(n.x,n.y).mult(i.worldSize),f=new e.P(e.aD(a.lng),e.aH(a.lat)).mult(i.worldSize).sub(m)}else{p=i.centerPoint.add(h);const n=i.pointLocation(p),r=e.ci.convert(t.center||n);this._normalizeCenter(r),m=i.project(n),f=i.project(r).sub(m)}const g=i.zoomScale(l-r);let x,y;t.around&&(x=e.ci.convert(t.around),y=i.locationPoint(x));const v=this._zooming||l!==r,_=this._rotating||s!==c,b=this._pitching||d!==a,w=!i.isPaddingEqual(u),j=!1===t.retainPadding?i.clone():i,N=i=>N=>{if(v&&(i.zoom=e.ai(r,l,N)),_&&(i.bearing=e.ai(s,c,N)),b&&(i.pitch=e.ai(a,d,N)),w&&(j.interpolatePadding(o,u,N),p=j.centerPoint.add(h)),x)i.setLocationAtPoint(x,y);else{const e=i.zoomScale(i.zoom-r),t=l>r?Math.min(2,g):Math.max(.5,g),n=Math.pow(t,1-N),s=i.unproject(m.add(f.mult(N*n)).mult(e));i.setLocationAtPoint(i.renderWorldCopies?s.wrap():s,p)}return t.preloadOnly||this._fireMoveEvents(n),i};if(t.preloadOnly){const e=this._emulate(N,t.duration,i);return this._preloadTiles(e),this}const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=_,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,S),this._ease(N(i),e=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(n,e)},t),this}_prepareEase(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new e.A("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.A("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.A("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.A("move",t)),this._zooming&&this.fire(new e.A("zoom",t)),this._rotating&&this.fire(new e.A("rotate",t)),this._pitching&&this.fire(new e.A("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,r=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new e.A("zoomend",t)),r&&this.fire(new e.A("rotateend",t)),s&&this.fire(new e.A("pitchend",t)),this.fire(new e.A("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const i=e.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(i,n)}this.stop(),t=e.h({offset:[0,0],speed:1.2,curve:1.42,easing:e.eK},t);const i=this.transform,r=this.getZoom(),s=this.getBearing(),a=this.getPitch(),o=this.getPadding(),l="zoom"in t?e.ay(+t.zoom,i.minZoom,i.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,d="pitch"in t?+t.pitch:a,u=this._extendPadding(t.padding),h=i.zoomScale(l-r),p=e.P.convert(t.offset);let m=i.centerPoint.add(p);const f=i.pointLocation(m),g=e.ci.convert(t.center||f);this._normalizeCenter(g);const x=i.project(f),y=i.project(g).sub(x);let v=t.curve;const _=Math.max(i.width,i.height),b=_/h,w=y.mag();if("minZoom"in t){const n=e.ay(Math.min(t.minZoom,r,l),i.minZoom,i.maxZoom),s=_/i.zoomScale(n-r);v=Math.sqrt(s/w*2)}const j=v*v;function N(e){const t=(b*b-_*_+(e?-1:1)*j*j*w*w)/(2*(e?b:_)*j*w);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function k(e){return(Math.exp(e)+Math.exp(-e))/2}const T=N(0);let C=function(e){return k(T)/k(T+v*e)},E=function(e){return _*((k(T)*(S(t=T+v*e)/k(t))-S(T))/j)/w;var t},A=(N(1)-T)/v;if(Math.abs(w)<1e-6||!isFinite(A)){if(Math.abs(_-b)<1e-6)return this.easeTo(t,n);const e=b<_?-1:1;A=Math.abs(Math.log(b/_))/v,E=function(){return 0},C=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*A/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const M=s!==c,D=d!==a,I=!i.isPaddingEqual(u),P=!1===t.retainPadding?i.clone():i,R=i=>h=>{const f=h*A,v=1/C(f);i.zoom=1===h?l:r+i.scaleZoom(v),M&&(i.bearing=e.ai(s,c,h)),D&&(i.pitch=e.ai(a,d,h)),I&&(P.interpolatePadding(o,u,h),m=P.centerPoint.add(p));const _=1===h?g:i.unproject(x.add(y.mult(E(f))).mult(v));return i.setLocationAtPoint(i.renderWorldCopies?_.wrap():_,m),i._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),i};if(t.preloadOnly){const e=this._emulate(R,t.duration,i);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=M,this._pitching=D,this._padding=I,this._prepareEase(n,!1),this._ease(R(i),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,n,i){!1===i.animate||0===i.duration?(t(1),n()):(this._easeStart=e.q.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=e.bQ(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,n){const i=Math.ceil(15*t/1e3),r=[],s=e(n.clone());for(let a=0;a<=i;a++){const e=s(a/i);r.push(e.clone())}return r}_preloadTiles(e,t){}}class xl{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact,n=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=u("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=u("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",n);const i=u("span","mapboxgl-ctrl-icon",this._compactButton);return i.setAttribute("aria-hidden","true"),i.setAttribute("title",n),this._innerContainer=u("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(t){const i=n.reduce((e,t,i)=>(t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(i<n.length-1?"&":"")),e),"?");t.href="".concat(e.e.FEEDBACK_URL,"/").concat(i,"#").concat(yo(this._map,!0)),t.rel="noopener nofollow"}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort((e,t)=>e.length-t.length),e=e.filter((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yl{constructor(){e.aV(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=u("div","mapboxgl-ctrl");const t=u("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class vl{constructor(){e.aV(["_onIndoorUpdate"],this)}onAdd(e){return this._map=e,this._container=u("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",e=>this._onIndoorUpdate({selectedFloorId:e.selectedFloorId,floors:e.floors})),this._container}_createButton(e,t){const n=u("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){this._map&&(e.setAttribute("aria-label",t),e.innerHTML="<strong>".concat(t,"</strong>"),e.firstElementChild&&e.firstElementChild.setAttribute("title",t))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(e){if(!e||!e.floors)return void(this._container.style.display="none");const t=this._model;this._model=e,this._container.style.display="inline-block";const n=e.floors.sort((e,t)=>e.levelOrder-t.levelOrder);t?(Array.from(this._container.children).forEach(e=>e.remove()),this.addCurrentFloors(n)):this.addCurrentFloors(n)}addCurrentFloors(e){for(const t of e){const e=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(t.id),Array.from(this._container.children).forEach(e=>{e.classList.remove("mapboxgl-ctrl-level-button-selected")}),e.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(e,t.shortName),this._model&&t.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(t.id),e.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(e)}}}class _l{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const i of n)if(i.id===e)return void(i.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class bl{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=e.dx((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const wl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class jl extends e.A{constructor(e,t,n,i){const{point:r,lngLat:s,originalEvent:a,target:o}=e;super(e.type,{point:r,lngLat:s,originalEvent:a,target:o}),this.preventDefault=()=>{e.preventDefault()},this.id=t,this.interaction=n,this.feature=i}}class Nl{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error('Interaction id "'.concat(t,'" already exists.'));const i=n.filter;let r=n.type;i&&this.filters.set(t,e.b3(i)),"mouseover"===r&&(r="mouseenter"),"mouseout"===r&&(r="mouseleave");const s=this.interactionsByType.get(r)||new Map;"mouseenter"===r||"mouseleave"===r?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):0===s.size&&this.map.on(r,this.handleType),0===s.size&&this.interactionsByType.set(r,s),s.set(t,n),this.typeById.set(t,r)}get(e){const t=this.typeById.get(e);if(!t)return;const n=this.interactionsByType.get(t);return n?n.get(e):void 0}remove(e){const t=this.typeById.get(e);if(!t)return;this.typeById.delete(e),this.filters.delete(e);const n=this.interactionsByType.get(t);n&&(n.delete(e),"mouseenter"===t||"mouseleave"===t?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===n.size&&this.map.off(t,this.handleType))}queryTargets(e,t){const n=[];for(const[i,r]of t)r.target&&n.push({targetId:i,target:r.target,filter:this.filters.get(i)});return this.map.style.queryRenderedTargets(e,n,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const t=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());t.length&&(e.type="mouseenter",this.handleType(e,t));const n=new Map;for(const[i,{feature:r}]of this.prevHoveredFeatures)this.hoveredFeatures.has(i)||n.set(r.id,r);n.size&&(e.type="mouseleave",this.handleType(e,Array.from(n.values())))}handleOut(e){const t=Array.from(this.hoveredFeatures.values()).map(e=>{let{feature:t}=e;return t});t.length&&(e.type="mouseleave",this.handleType(e,t)),this.hoveredFeatures.clear()}handleType(t,n){const i="mouseenter"===t.type;if(i&&!this.interactionsByType.has(t.type))return void e.w("mouseenter interaction required for mouseleave to work.");const r=Array.from(this.interactionsByType.get(t.type)).reverse(),s=!!n;n=n||this.queryTargets(t.point,r);let a=!1;const o=new Set;for(const l of n){for(const[n,c]of r){if(!c.target)continue;const r=l.variants?l.variants[n]:null;if(r){for(const d of r){if(ut(d,l,o,n))continue;const r=new e.dr(l,d),u=dt(d,l,n);s&&(r.state=this.map.getFeatureState(r));const h=i?this.prevHoveredFeatures.get(u):null,p=new jl(t,n,c,r),m=h?h.stop:c.handler(p);if(i&&this.hoveredFeatures.set(u,{feature:l,stop:m}),!1!==m){a=!0;break}}if(a)break}}if(a)break}if(!a)for(const[e,l]of r){const{handler:n,target:i}=l;if(!i&&!1!==n(new jl(t,e,l,null)))break}}}function Sl(t,n){if(Array.isArray(t)&&Array.isArray(n)){const e=new Set(t),i=new Set(n);return e.size===i.size&&t.every(e=>i.has(e))}return e.bv(t,n)}const kl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Tl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cl{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=n,this.mouseRotate=new Vo({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new Uo({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),g()}move(e,t){const n=this.map,i=this.mouseRotate.mousemoveWindow(e,t),r=i&&i.bearingDelta;if(r&&n.setBearing(n.getBearing()+r),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t),r=i&&i.pitchDelta;r&&n.setPitch(n.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){x(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),_(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,_(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=b(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=b(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function El(t,n,i){if(t=new e.ci(t.lng,t.lat),n){const r=new e.ci(t.lng-360,t.lat),s=new e.ci(t.lng+360,t.lat),a=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),o=i.locationPoint3D(t).distSqr(n),l=n.x<0||n.y<0||n.x>i.width||n.y>i.height;i.locationPoint3D(r).distSqr(n)<o&&(l||Math.abs(r.lng-i.center.lng)<a)?t=r:i.locationPoint3D(s).distSqr(n)<o&&(l||Math.abs(s.lng-i.center.lng)<a)&&(t=s)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationPoint3D(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const Al={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ml={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Dl extends e.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=e.h({element:t},n)),e.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:i="center",color:r="#3FB1CE",scale:s=1,draggable:a=!1,clickTolerance:o=0,rotation:l=Ml.rotation,rotationAlignment:c=Ml.rotationAlignment,pitchAlignment:d=Ml.pitchAlignment,occludedOpacity:u=Ml.occludedOpacity,altitude:h=Ml.altitude}=t||{};this._anchor=i,this._color=r,this._scale=s,this._draggable=a,this._clickTolerance=o,this._rotation=l,this._rotationAlignment=c,this._pitchAlignment=d,this._occludedOpacity=u,this._altitude=h,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const p=this._element.classList;for(const e in Al)p.remove("mapboxgl-marker-anchor-".concat(e));p.add("mapboxgl-marker-anchor-".concat(this._anchor));const m=t&&t.className?t.className.trim().split(/\s+/):[];p.add(...m),this._popup=null}_createDefaultMarker(){const e=u("div"),t=h("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){const e=h("radialGradient",{id:"shadowGradient"},h("defs",{},t));h("stop",{offset:"10%","stop-opacity":.4},e),h("stop",{offset:"100%","stop-opacity":.05},e),h("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},t)}return h("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},t),h("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},t),h("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},t),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.ci.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||Ml.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const n=e.unproject(t,this._altitude),i=e.getFreeCameraOptions();if(!i.position)return!1;const r=i.position.toLngLat();return r.distanceTo(n)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const i=t.unproject(n,this._altitude);let r;t._showingGlobe()&&e.eW(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(i),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity="".concat(r),this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(Al[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const t=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!t||"map"!==i)return"";if(!n._showingGlobe()){const e=n.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const r=e.cU(e.eX(n.transform,this._lngLat)),s=t.sub(e.eY(n.transform)),a=Math.abs(s.x)+Math.abs(s.y);if(0===a)return"";const o=r/a;return"rotateX(".concat(-s.y*o,"deg) rotateY(").concat(s.x*o,"deg)")}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let i=0;const r=this.getRotationAlignment();if("map"===r)if(n._showingGlobe()){const t=n.project(new e.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),r=n.project(new e.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(t);i=e.cU(Math.atan2(r.y,r.x))-90}else i=-n.getBearing();else if("horizon"===r){const r=e.af(4,6,n.getZoom()),s=e.eY(n.transform);s.y+=r*n.transform.height;const a=t.sub(s),o=e.cU(Math.atan2(a.y,a.x));i=(o>90?o-270:o+90)*(1-r)}return i+=this._rotation,i?"rotateZ(".concat(i,"deg)"):""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=El(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),t._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const n=this._map;if(!n)return;const i=this._pointerdownPos,r=this._positionDelta;if(i&&r){if(!this._isDragging){const e=this._clickTolerance||n._clickTolerance;if(t.point.dist(i)<e)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.A("dragstart"))),this.fire(new e.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.A("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||Ml.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||Ml.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||Ml.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||Ml.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pl={maxWidth:100,unit:"metric"},Rl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ll={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ol(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(n){case"top":return new e.P(0,t);case"top-left":return new e.P(i,i);case"top-right":return new e.P(-i,i);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(i,-i);case"bottom-right":return new e.P(-i,-i);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[n]||[0,0])}const Fl={version:t,supported:d.supported,setRTLTextPlugin:e.f0,getRTLTextPluginStatus:e.e$,Map:class extends gl{constructor(t){a.mark(n.create);const i=t;if(null!=(t=e.h({},kl,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.eU(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ii(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies,null,null),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new _l,this._domRenderTaskQueue=new _l,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.a$(),this._locale=e.h({},wl,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=t.scaleFactor,this._requestManager=new k(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Object.assign({},t.contextCreateOptions):{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error("Container '".concat(t.container.toString(),"' not found."));this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),this._spriteFormat=t.spriteFormat,e.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ja),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ml(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.e.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this.indoor=new vi(this),t.hash&&(this._hash=new xo("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const n=t.bounds;n&&(this.resize(),this.fitBounds(n,e.h({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new xl({customAttribution:t.customAttribution})),this._logoControl=new yl,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.A("".concat(t.dataType,"data"),t))}),this.on("dataloading",t=>{this.fire(new e.A("".concat(t.dataType,"dataloading"),t))}),this._interactions=new Nl(this)}_getMapId(){return this._mapId}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new e.A("movestart",t)).fire(new e.A("move",t)),this.fire(new e.A("resize",t)),n&&this.fire(new e.A("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aG.convert(t)),this._update()}setMinZoom(t){if((t=null!==t&&void 0!==t?t:-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null!==t&&void 0!==t?t:22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null!==t&&void 0!==t?t:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null!==t&&void 0!==t?t:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(e=>"symbol"===e.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?navigator.language:e):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,n=t.projection.name;let i;"globe"===n&&t.zoom>=e.cI?(t.setMercatorFromTransition(),i=!0):"mercator"===n&&t.zoom<e.cI&&(t.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let n;return n="globe"===t.name&&this.transform.zoom>=e.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t,n){return this.transform.locationPoint3D(e.ci.convert(t),n)}unproject(t,n){return this.transform.pointLocation3D(e.P.convert(t),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){const i=e=>{let n=[];if(Array.isArray(t)){const i=t.filter(e=>this.getLayer(e));n=i.length?this.queryRenderedFeatures(e,{layers:i}):[]}else n=this.queryRenderedFeatures(e,{target:t});return n};if("mouseenter"===e||"mouseover"===e){let r=!1;const s=t=>{const s=i(t.point);s.length?r||(r=!0,n.call(this,new To(e,this,t.originalEvent,{features:s}))):r=!1};return{listener:n,targets:t,delegates:{mousemove:s,mouseout:()=>{r=!1}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const s=t=>{i(t.point).length?r=!0:r&&(r=!1,n.call(this,new To(e,this,t.originalEvent)))},a=t=>{r&&(r=!1,n.call(this,new To(e,this,t.originalEvent)))};return{listener:n,targets:t,delegates:{mousemove:s,mouseout:a}}}{const r=e=>{const t=i(e.point);t.length&&(e.features=t,n.call(this,e),delete e.features)};return{listener:n,targets:t,delegates:{[e]:r}}}}on(e,t,n){if("function"==typeof t||void 0===n)return super.on(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(e,t,n){if("function"==typeof t||void 0===n)return super.once(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const i=this._createDelegatedListener(e,t,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(e,t,n){if("function"==typeof t||void 0===n)return super.off(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const i=this._delegatedListeners?this._delegatedListeners[e]:void 0;return i&&(e=>{for(let i=0;i<e.length;i++){const r=e[i];if(r.listener===n&&Sl(r.targets,t)){for(const e in r.delegates)this.off(e,r.delegates[e]);return e.splice(i,1),this}}})(i),this}queryRenderedFeatures(t,n){if(!this.style)return[];if(void 0===t||t instanceof e.P||Array.isArray(t)||void 0!==n||(n=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],!n){const e=this.style.queryRenderedFeatures(t,void 0,this.transform),n=this.style.queryRenderedFeatureset(t,void 0,this.transform);return e.concat(n)}let i=!0;if(n.target&&(i=this._isTargetValid(n.target),i&&!n.layers))return this.style.queryRenderedFeatureset(t,n,this.transform);let r=!0;if(n.layers&&Array.isArray(n.layers)){for(const e of n.layers)if(!this._isValidId(e)){r=!1;break}if(r&&!n.target)return this.style.queryRenderedFeatures(t,n,this.transform)}let s=[];return r&&(s=s.concat(this.style.queryRenderedFeatures(t,n,this.transform))),i&&(s=s.concat(this.style.queryRenderedFeatureset(t,n,this.transform))),s}querySourceFeatures(e,t){return!e||"string"==typeof e&&!this._isValidId(e)?[]:this.style.querySourceFeatures(e,t)}isPointOnSurface(t){const{name:n}=this.transform.projection;return"globe"!==n&&"mercator"!==n&&e.w("".concat(n," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(e.P.convert(t))}addInteraction(e,t){return this._interactions.add(e,t),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(t,n){return n=e.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&t&&!1!==n.diff&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(t,(i,r)=>{if(i){const r="string"==typeof i?i:i instanceof Error?i.message:i.error;e.w("Unable to perform style diff: ".concat(r,". Rebuilding the style from scratch.")),this._updateStyle(t,n)}else r&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(t,n))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(t,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const i=e.h({},n);n&&n.config&&(i.initialConfig=n.config,delete i.config),this.style=new Ei(this,i).load(t),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ei(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.z(new Error("IDs can't be empty."))),!1):!e.dk(t)||(this.fire(new e.z(new Error("IDs can't contain special symbols: \"".concat(t,'".')))),!1)}_isTargetValid(e){return"featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(const t of e)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(e)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,n){let{pixelRatio:i=1,sdf:r=!1,stretchX:s,stretchY:a,content:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._lazyInitEmptyStyle();const l=e.I.from(t);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:t,height:c,data:d}=e.q.getImageData(n);this.style.addImage(l,{data:new e.r({width:t,height:c},d),pixelRatio:i,stretchX:s,stretchY:a,content:o,sdf:r,version:0,usvg:!1})}else if(void 0===n.width||void 0===n.height)this.fire(new e.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:d}=n,u=n;this.style.addImage(l,{data:new e.r({width:c,height:d},new Uint8Array(u.data)),pixelRatio:i,stretchX:s,stretchY:a,content:o,sdf:r,usvg:!1,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,n){this._lazyInitEmptyStyle();const i=e.I.from(t),r=this.style.getImage(i);if(!r)return void this.fire(new e.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?e.q.getImageData(n):n,{width:a,height:o,data:l}=s;if(void 0===a||void 0===o)return void this.fire(new e.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==(r.usvg?r.icon.usvg_tree.width:r.data.width)||o!==(r.usvg?r.icon.usvg_tree.height:r.data.height))return void this.fire(new e.z(new Error("The width and height of the updated image (".concat(a,", ").concat(o,")\n                must be that same as the previous version of the image\n                (").concat(r.data.width,", ").concat(r.data.height,")"))));const c=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let d=!1;r.usvg?(r.data=new e.r({width:a,height:o},new Uint8Array(l)),r.usvg=!1,r.icon=void 0,d=!0):r.data.replace(l,c),this.style.updateImage(i,r,d)}hasImage(t){return t?!!this.style&&!!this.style.getImage(e.I.from(t)):(this.fire(new e.z(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(e.I.from(t))}loadImage(t,n){e.o(this._requestManager.transformRequest(t,e.R.Image),(t,i)=>{n(t,i instanceof HTMLImageElement?e.q.getImageData(i):i)})}listImages(){return this.style.listImages().map(e=>e.name)}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.z(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(t,n){return this.style.addImport(t,n).catch(t=>this.fire(new e.z(new Error("Failed to add import",t)))),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,i),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,i),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,t),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.ci.convert(t),this.transform):0}setFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,t),this._update())}removeFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,t),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_selectIndoorFloor(e){this.indoor.selectFloor(e)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new vl),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,i,r,s=this._container;for(;s&&(!i||!r);){const e=window.getComputedStyle(s).transform;e&&"none"!==e&&(n=e.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(r=n[3])),s=s.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=r?Math.abs(t/r):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=u("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=u("div","mapboxgl-canvas-container",e);this._canvas=u("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=u("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(e=>{i[e]=u("div","mapboxgl-ctrl-".concat(e),n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,n){const i=e.q.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(n),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(n,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.h({},d.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",t);n?(q(n,!0),this.painter=new fo(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),e.l.testSupport(n)):this.fire(new e.z(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.A("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new e.A("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;this.fire(new e.A("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,s=e.q.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=o.createQuery(),o.beginQuery(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=this.transform.pitch,i=e.q.now(),r=new e.aa(t,{now:i,fadeDuration:l,pitch:n,transition:this.style.transition,worldview:this._worldview});this.style.update(r)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(s),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(s);const d=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),d&&(this._placementDirty=d.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.mark(n.load),this.fire(new e.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.q.now()-s;o.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const n=o.getQueryParameter(i,o.QUERY_RESULT)/1e6;o.deleteQuery(i),this.fire(new e.A("gpu-timing-frame",{cpuTime:t,gpuTime:n}))},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{const n=this.painter.queryGpuTimers(t);this.fire(new e.A("gpu-timing-layer",{layerTimes:n}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const n=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.A("gpu-timing-deferred-render",{gpuTime:n}))},50)}const u=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(u||this._repaint)this.triggerRepaint();else{const t=this.idle();if(t&&(c=this._updateAverageElevation(s,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.A("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,a.mark(n.fullLoad),this._performanceMetricsCollection&&B(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const s=Math.abs(t-r);if(s>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(r),n(r);this._averageElevation.easeTo(r,e,300)}else if(s>1e-4)return this._averageElevation.jumpTo(r),n(r)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){U(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===S||401===t.status)){const t=this.painter.context.gl;q(t,!1),this._logoControl instanceof yl&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),L(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&O(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const r=e.length/4;for(let s=0;s<t.length;s++){const a=t[s];let o=0;for(let t=0;t<a.length;t+=4)a[t]===e[t]&&a[t+1]===e[t+1]&&a[t+2]===e[t+2]&&a[t+3]===e[t+3]&&(o+=1);i+=(n[s+2]-n[s+1])*(1-o/r)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),H.delete(this.painter.context.gl),V.remove(),R.remove(),this._removed=!0,this.fire(new e.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.q.frame(e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(t){const n=this.style?this.style.getSourceCaches():[];return e.bt(n,(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(t,n){e.eV(t,n)}get version(){return t}},NavigationControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.h({},Tl,t),this._container=u("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(e.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),u("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),u("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=u("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cl(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=u("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const n=navigator.geolocation;this.options=e.h({geolocation:n},Il,t),e.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=go(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=u("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const n=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=n,e(n)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(e=>n("denied"!==e.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.A("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("geolocate",t)),this._finish()}}_updateCamera(t){const n=new e.ci(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),s=e.h({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),s,{geolocateSource:!0})}_updateMarker(t){if(t){const n=new e.ci(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,n=e.cb(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*n);this._circleElement.style.width="".concat(i,"px"),this._circleElement.style.height="".concat(i,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=u("button","mapboxgl-ctrl-geolocate",this._container),u("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=u("div","mapboxgl-user-location"),this._dotElement.appendChild(u("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(u("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Dl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=u("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.A("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:xl,ScaleControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.h({},Pl,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,i=t._containerWidth/2-e/2,r=t.unproject([i,n]),s=t.unproject([i+e,n]),a=r.distanceTo(s);if("imperial"===this.options.unit){const t=3.2808*a;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):a>=1e3?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(e,t,n){this._map._requestDomTask(()=>{const i=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),r=i/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):"".concat(i,"&nbsp;").concat(Rl[n]),this._container.style.width=e*r+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=u("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=u("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=u("button","mapboxgl-ctrl-fullscreen",this._controlContainer);u("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:vl,Popup:class extends e.E{constructor(t){super(),this.options=e.h(Object.create(Ll),t),this._altitude=this.options.altitude,e.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.A("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.ci.convert(t),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=u("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=u("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,i=this._pos;if(!t||!n||!i)return"bottom";const r=n.offsetWidth,s=n.offsetHeight,a=i.x<r/2,o=i.x>t.transform.width-r/2;if(i.y+e<s)return a?"top-left":o?"top-right":"top";if(i.y>t.transform.height-s){if(a)return"bottom-left";if(o)return"bottom-right"}return a?"left":o?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const n=this._map,i=this._content;if(!n||!this._lngLat&&!this._trackPointer||!i)return;let r=this._container;if(r||(r=this._container=u("div","mapboxgl-popup",n.getContainer()),this._tip=u("div","mapboxgl-popup-tip",r),r.appendChild(i)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=El(this._lngLat,this._pos,n.transform)),!this._trackPointer||t){const i=this._pos=this._trackPointer&&t instanceof e.P?t:n.project(this._lngLat,this._altitude),r=Ol(this.options.offset),s=this._anchor=this._getAnchor(r.y),a=Ol(this.options.offset,s),o=i.add(a).round();n._requestDomTask(()=>{this._container&&s&&(this._container.style.transform="".concat(Al[s]," translate(").concat(o.x,"px,").concat(o.y,"px)"))})}if(!this._marker&&n._showingGlobe()){const t=e.eW(n.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(zl);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Dl,Style:Ei,LngLat:e.ci,LngLatBounds:e.aG,Point:e.P,MercatorCoordinate:e.ac,FreeCameraOptions:Jn,Evented:e.E,config:e.e,prewarm:e.e_,clearPrewarmedResources:e.eZ,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t},get workerCount(){return e.f7.workerCount},set workerCount(t){e.f7.workerCount=t},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.f6(t)},get workerUrl(){return e.f5.workerUrl},set workerUrl(t){e.f5.workerUrl=t},get workerClass(){return e.f5.workerClass},set workerClass(t){e.f5.workerClass=t},get workerParams(){return e.f5.workerParams},set workerParams(t){e.f5.workerParams=t},get dracoUrl(){return e.f4()},set dracoUrl(t){e.f3(t)},get meshoptUrl(){return e.f2()},set meshoptUrl(t){e.f1(t)},setNow:e.q.setNow,restoreNow:e.q.restoreNow};return Fl}),n}()},1032:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(7461),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,i.A)(t);return(0,r.default)(e,-n)}},1049:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var i=n(6260),r=n(1740),s=n(1104),a=n(3666);var o=6048e5;function l(e){(0,a.A)(1,arguments);var t=(0,i.default)(e),n=(0,r.A)(t).getTime()-function(e){(0,a.A)(1,arguments);var t=(0,s.A)(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),(0,r.A)(n)}(t).getTime();return Math.round(n/o)+1}},1104:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(6260),r=n(3666),s=n(1740);function a(e){(0,r.A)(1,arguments);var t=(0,i.default)(e),n=t.getUTCFullYear(),a=new Date(0);a.setUTCFullYear(n+1,0,4),a.setUTCHours(0,0,0,0);var o=(0,s.A)(a),l=new Date(0);l.setUTCFullYear(n,0,4),l.setUTCHours(0,0,0,0);var c=(0,s.A)(l);return t.getTime()>=o.getTime()?n+1:t.getTime()>=c.getTime()?n:n-1}},1153:(e,t,n)=>{"use strict";var i=n(5043),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,s={},c=null,d=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:d,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},1159:()=>{},1210:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getFullYear()}},1497:(e,t,n)=>{"use strict";var i=n(3218);function r(){}function s(){}s.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,s,a){if(a!==i){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:r};return n.PropTypes=n,n}},1555:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var i=n(2239),r=n(6260),s=n(8355),a=n(3666);function o(e,t){var n,o,l,c,d,u,h,p;(0,a.A)(1,arguments);var m=(0,i.q)(),f=(0,s.A)(null!==(n=null!==(o=null!==(l=null!==(c=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==c?c:null===t||void 0===t||null===(d=t.locale)||void 0===d||null===(u=d.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==l?l:m.weekStartsOn)&&void 0!==o?o:null===(h=m.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.weekStartsOn)&&void 0!==n?n:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,r.default)(e),x=g.getDay(),y=6+(x<f?-7:0)-(x-f);return g.setDate(g.getDate()+y),g.setHours(23,59,59,999),g}},1627:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getMonth()}},1740:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e),n=t.getUTCDay(),s=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-s),t.setUTCHours(0,0,0,0),t}},1847:(e,t,n)=>{var i=n(4893);e.exports=function(e,t){if(null==e)return{};var n,r,s=i(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s},e.exports.__esModule=!0,e.exports.default=e.exports},1899:function(e,t,n){!function(e,t,n,i,r,s,a,o,l,c,d,u,h,p,m,f,g,x,y,v,_,b,w,j,N,S,k,T,C,E,A,M,D,I,P,R,L,z,O,F,B,V,U,H,q,W,G,Y,Z,X,K,Q,J,$,ee,te,ne,ie,re,se,ae,oe,le,ce){"use strict";function de(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var ue=de(t),he=de(i),pe=de(r),me=de(s),fe=de(a),ge=de(o),xe=de(l),ye=de(c),ve=de(d),_e=de(u),be=de(h),we=de(p),je=de(m),Ne=de(f),Se=de(g),ke=de(x),Te=de(y),Ce=de(v),Ee=de(_),Ae=de(b),Me=de(w),De=de(j),Ie=de(N),Pe=de(S),Re=de(k),Le=de(T),ze=de(C),Oe=de(E),Fe=de(A),Be=de(M),Ve=de(D),Ue=de(I),He=de(P),qe=de(R),We=de(L),Ge=de(z),Ye=de(O),Ze=de(F),Xe=de(B),Ke=de(V),Qe=de(U),Je=de(H),$e=de(q),et=de(W),tt=de(Y),nt=de(Z),it=de(X),rt=de(K),st=de(Q),at=de(J),ot=de($),lt=de(ee),ct=de(te),dt=de(ne),ut=de(ie),ht=de(re),pt=de(se),mt=de(ae),ft=de(oe),gt=de(ce);function xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(n),!0).forEach(function(t){jt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function _t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Dt(i.key),i)}}function wt(e,t,n){return t&&bt(e.prototype,t),n&&bt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function jt(e,t,n){return(t=Dt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nt(){return Nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Nt.apply(this,arguments)}function St(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tt(e,t)}function kt(e){return kt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kt(e)}function Tt(e,t){return Tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tt(e,t)}function Ct(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=kt(e);if(t){var r=kt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ct(e)}(this,n)}}function At(e){return function(e){if(Array.isArray(e))return Mt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Dt(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var It=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Pt=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Rt={p:Pt,P:function(e,t){var n,i=e.match(/(P+)(p+)?/)||[],r=i[1],s=i[2];if(!s)return It(e,t);switch(r){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",It(r,t)).replace("{{time}}",Pt(s,t))}},Lt=12,zt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;function Ot(e){var t=e?"string"==typeof e||e instanceof String?pt.default(e):ut.default(e):new Date;return Ft(t)?t:null}function Ft(e,t){return t=t||new Date("1/1/1000"),me.default(e)&&!ct.default(e,t)}function Bt(e,t,n){if("en"===n)return fe.default(e,t,{awareOfUnicodeTokens:!0});var i=tn(n);return n&&!i&&console.warn('A locale object was not found for the provided string ["'.concat(n,'"].')),!i&&en()&&tn(en())&&(i=tn(en())),fe.default(e,t,{locale:i||null,awareOfUnicodeTokens:!0})}function Vt(e,t){var n=t.dateFormat,i=t.locale;return e&&Bt(e,Array.isArray(n)?n[0]:n,i)||""}function Ut(e,t){var n=t.hour,i=void 0===n?0:n,r=t.minute,s=void 0===r?0:r,a=t.second,o=void 0===a?0:a;return Be.default(Fe.default(Oe.default(e,o),s),i)}function Ht(e,t,n){var i=tn(t||en());return Ke.default(e,{locale:i,weekStartsOn:n})}function qt(e){return Qe.default(e)}function Wt(e){return $e.default(e)}function Gt(e){return Je.default(e)}function Yt(){return Xe.default(Ot())}function Zt(e,t){return e&&t?at.default(e,t):!e&&!t}function Xt(e,t){return e&&t?st.default(e,t):!e&&!t}function Kt(e,t){return e&&t?ot.default(e,t):!e&&!t}function Qt(e,t){return e&&t?rt.default(e,t):!e&&!t}function Jt(e,t){return e&&t?it.default(e,t):!e&&!t}function $t(e,t,n){var i,r=Xe.default(t),s=et.default(n);try{i=dt.default(e,{start:r,end:s})}catch(e){i=!1}return i}function en(){return("undefined"!=typeof window?window:globalThis).__localeId__}function tn(e){if("string"==typeof e){var t="undefined"!=typeof window?window:globalThis;return t.__localeData__?t.__localeData__[e]:null}return e}function nn(e,t){return Bt(Ve.default(Ot(),e),"LLLL",t)}function rn(e,t){return Bt(Ve.default(Ot(),e),"LLL",t)}function sn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.maxDate,r=t.excludeDates,s=t.excludeDateIntervals,a=t.includeDates,o=t.includeDateIntervals,l=t.filterDate;return pn(e,{minDate:n,maxDate:i})||r&&r.some(function(t){return Qt(e,t)})||s&&s.some(function(t){var n=t.start,i=t.end;return dt.default(e,{start:n,end:i})})||a&&!a.some(function(t){return Qt(e,t)})||o&&!o.some(function(t){var n=t.start,i=t.end;return dt.default(e,{start:n,end:i})})||l&&!l(Ot(e))||!1}function an(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.excludeDates,i=t.excludeDateIntervals;return i&&i.length>0?i.some(function(t){var n=t.start,i=t.end;return dt.default(e,{start:n,end:i})}):n&&n.some(function(t){return Qt(e,t)})||!1}function on(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.maxDate,r=t.excludeDates,s=t.includeDates,a=t.filterDate;return pn(e,{minDate:Qe.default(n),maxDate:tt.default(i)})||r&&r.some(function(t){return Xt(e,t)})||s&&!s.some(function(t){return Xt(e,t)})||a&&!a(Ot(e))||!1}function ln(e,t,n,i){var r=Le.default(e),s=Pe.default(e),a=Le.default(t),o=Pe.default(t),l=Le.default(i);return r===a&&r===l?s<=n&&n<=o:r<a?l===r&&s<=n||l===a&&o>=n||l<a&&l>r:void 0}function cn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.maxDate,r=t.excludeDates,s=t.includeDates,a=t.filterDate;return pn(e,{minDate:n,maxDate:i})||r&&r.some(function(t){return Kt(e,t)})||s&&!s.some(function(t){return Kt(e,t)})||a&&!a(Ot(e))||!1}function dn(e,t,n){if(!me.default(t)||!me.default(n))return!1;var i=Le.default(t),r=Le.default(n);return i<=e&&r>=e}function un(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.maxDate,r=t.excludeDates,s=t.includeDates,a=t.filterDate,o=new Date(e,0,1);return pn(o,{minDate:$e.default(n),maxDate:nt.default(i)})||r&&r.some(function(e){return Zt(o,e)})||s&&!s.some(function(e){return Zt(o,e)})||a&&!a(Ot(o))||!1}function hn(e,t,n,i){var r=Le.default(e),s=Re.default(e),a=Le.default(t),o=Re.default(t),l=Le.default(i);return r===a&&r===l?s<=n&&n<=o:r<a?l===r&&s<=n||l===a&&o>=n||l<a&&l>r:void 0}function pn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.maxDate;return n&&Ge.default(e,n)<0||i&&Ge.default(e,i)>0}function mn(e,t){return t.some(function(t){return Ae.default(t)===Ae.default(e)&&Ee.default(t)===Ee.default(e)})}function fn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.excludeTimes,i=t.includeTimes,r=t.filterTime;return n&&mn(e,n)||i&&!mn(e,i)||r&&!r(e)||!1}function gn(e,t){var n=t.minTime,i=t.maxTime;if(!n||!i)throw new Error("Both minTime and maxTime props required");var r,s=Ot(),a=Be.default(Fe.default(s,Ee.default(e)),Ae.default(e)),o=Be.default(Fe.default(s,Ee.default(n)),Ae.default(n)),l=Be.default(Fe.default(s,Ee.default(i)),Ae.default(i));try{r=!dt.default(a,{start:o,end:l})}catch(e){r=!1}return r}function xn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.includeDates,r=Se.default(e,1);return n&&Ye.default(n,r)>0||i&&i.every(function(e){return Ye.default(e,r)>0})||!1}function yn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.maxDate,i=t.includeDates,r=_e.default(e,1);return n&&Ye.default(r,n)>0||i&&i.every(function(e){return Ye.default(r,e)>0})||!1}function vn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.includeDates,r=Te.default(e,1);return n&&Ze.default(n,r)>0||i&&i.every(function(e){return Ze.default(e,r)>0})||!1}function _n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.maxDate,i=t.includeDates,r=we.default(e,1);return n&&Ze.default(r,n)>0||i&&i.every(function(e){return Ze.default(r,e)>0})||!1}function bn(e){var t=e.minDate,n=e.includeDates;if(n&&t){var i=n.filter(function(e){return Ge.default(e,t)>=0});return qe.default(i)}return n?qe.default(n):t}function wn(e){var t=e.maxDate,n=e.includeDates;if(n&&t){var i=n.filter(function(e){return Ge.default(e,t)<=0});return We.default(i)}return n?We.default(n):t}function jn(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react-datepicker__day--highlighted",n=new Map,i=0,r=e.length;i<r;i++){var s=e[i];if(pe.default(s)){var a=Bt(s,"MM.dd.yyyy"),o=n.get(a)||[];o.includes(t)||(o.push(t),n.set(a,o))}else if("object"===vt(s)){var l=Object.keys(s),c=l[0],d=s[l[0]];if("string"==typeof c&&d.constructor===Array)for(var u=0,h=d.length;u<h;u++){var p=Bt(d[u],"MM.dd.yyyy"),m=n.get(p)||[];m.includes(c)||(m.push(c),n.set(p,m))}}}return n}function Nn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react-datepicker__day--holidays",n=new Map;return e.forEach(function(e){var i=e.date,r=e.holidayName;if(pe.default(i)){var s=Bt(i,"MM.dd.yyyy"),a=n.get(s)||{};if(!("className"in a)||a.className!==t||(o=a.holidayNames,l=[r],o.length!==l.length||!o.every(function(e,t){return e===l[t]}))){var o,l;a.className=t;var c=a.holidayNames;a.holidayNames=c?[].concat(At(c),[r]):[r],n.set(s,a)}}}),n}function Sn(e,t,n,i,r){for(var s=r.length,a=[],o=0;o<s;o++){var l=ge.default(xe.default(e,Ae.default(r[o])),Ee.default(r[o])),c=ge.default(e,(n+1)*i);lt.default(l,t)&&ct.default(l,c)&&a.push(r[o])}return a}function kn(e){return e<10?"0".concat(e):"".concat(e)}function Tn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lt,n=Math.ceil(Le.default(e)/t)*t;return{startPeriod:n-(t-1),endPeriod:n}}function Cn(e){var t=e.getSeconds(),n=e.getMilliseconds();return ut.default(e.getTime()-1e3*t-n)}function En(e,t,n,i){for(var r=[],s=0;s<2*t+1;s++){var a=e+t-s,o=!0;n&&(o=Le.default(n)<=a),i&&o&&(o=Le.default(i)>=a),o&&r.push(a)}return r}var An=function(e){St(i,e);var n=Et(i);function i(e){var r;_t(this,i),jt(Ct(r=n.call(this,e)),"renderOptions",function(){var e=r.props.year,t=r.state.yearsList.map(function(t){return ue.default.createElement("div",{className:e===t?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:t,onClick:r.onChange.bind(Ct(r),t),"aria-selected":e===t?"true":void 0},e===t?ue.default.createElement("span",{className:"react-datepicker__year-option--selected"},"\u2713"):"",t)}),n=r.props.minDate?Le.default(r.props.minDate):null,i=r.props.maxDate?Le.default(r.props.maxDate):null;return i&&r.state.yearsList.find(function(e){return e===i})||t.unshift(ue.default.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:r.incrementYears},ue.default.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),n&&r.state.yearsList.find(function(e){return e===n})||t.push(ue.default.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:r.decrementYears},ue.default.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),t}),jt(Ct(r),"onChange",function(e){r.props.onChange(e)}),jt(Ct(r),"handleClickOutside",function(){r.props.onCancel()}),jt(Ct(r),"shiftYears",function(e){var t=r.state.yearsList.map(function(t){return t+e});r.setState({yearsList:t})}),jt(Ct(r),"incrementYears",function(){return r.shiftYears(1)}),jt(Ct(r),"decrementYears",function(){return r.shiftYears(-1)});var s=e.yearDropdownItemNumber,a=e.scrollableYearDropdown,o=s||(a?10:5);return r.state={yearsList:En(r.props.year,o,r.props.minDate,r.props.maxDate)},r.dropdownRef=t.createRef(),r}return wt(i,[{key:"componentDidMount",value:function(){var e=this.dropdownRef.current;if(e){var t=e.children?Array.from(e.children):null,n=t?t.find(function(e){return e.ariaSelected}):null;e.scrollTop=n?n.offsetTop+(n.clientHeight-e.clientHeight)/2:(e.scrollHeight-e.clientHeight)/2}}},{key:"render",value:function(){var e=he.default({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return ue.default.createElement("div",{className:e,ref:this.dropdownRef},this.renderOptions())}}]),i}(ue.default.Component),Mn=mt.default(An),Dn=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"state",{dropdownVisible:!1}),jt(Ct(e),"renderSelectOptions",function(){for(var t=e.props.minDate?Le.default(e.props.minDate):1900,n=e.props.maxDate?Le.default(e.props.maxDate):2100,i=[],r=t;r<=n;r++)i.push(ue.default.createElement("option",{key:r,value:r},r));return i}),jt(Ct(e),"onSelectChange",function(t){e.onChange(t.target.value)}),jt(Ct(e),"renderSelectMode",function(){return ue.default.createElement("select",{value:e.props.year,className:"react-datepicker__year-select",onChange:e.onSelectChange},e.renderSelectOptions())}),jt(Ct(e),"renderReadView",function(t){return ue.default.createElement("div",{key:"read",style:{visibility:t?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:function(t){return e.toggleDropdown(t)}},ue.default.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),ue.default.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},e.props.year))}),jt(Ct(e),"renderDropdown",function(){return ue.default.createElement(Mn,{key:"dropdown",year:e.props.year,onChange:e.onChange,onCancel:e.toggleDropdown,minDate:e.props.minDate,maxDate:e.props.maxDate,scrollableYearDropdown:e.props.scrollableYearDropdown,yearDropdownItemNumber:e.props.yearDropdownItemNumber})}),jt(Ct(e),"renderScrollMode",function(){var t=e.state.dropdownVisible,n=[e.renderReadView(!t)];return t&&n.unshift(e.renderDropdown()),n}),jt(Ct(e),"onChange",function(t){e.toggleDropdown(),t!==e.props.year&&e.props.onChange(t)}),jt(Ct(e),"toggleDropdown",function(t){e.setState({dropdownVisible:!e.state.dropdownVisible},function(){e.props.adjustDateOnChange&&e.handleYearChange(e.props.date,t)})}),jt(Ct(e),"handleYearChange",function(t,n){e.onSelect(t,n),e.setOpen()}),jt(Ct(e),"onSelect",function(t,n){e.props.onSelect&&e.props.onSelect(t,n)}),jt(Ct(e),"setOpen",function(){e.props.setOpen&&e.props.setOpen(!0)}),e}return wt(n,[{key:"render",value:function(){var e;switch(this.props.dropdownMode){case"scroll":e=this.renderScrollMode();break;case"select":e=this.renderSelectMode()}return ue.default.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},e)}}]),n}(ue.default.Component),In=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"isSelectedMonth",function(t){return e.props.month===t}),jt(Ct(e),"renderOptions",function(){return e.props.monthNames.map(function(t,n){return ue.default.createElement("div",{className:e.isSelectedMonth(n)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:t,onClick:e.onChange.bind(Ct(e),n),"aria-selected":e.isSelectedMonth(n)?"true":void 0},e.isSelectedMonth(n)?ue.default.createElement("span",{className:"react-datepicker__month-option--selected"},"\u2713"):"",t)})}),jt(Ct(e),"onChange",function(t){return e.props.onChange(t)}),jt(Ct(e),"handleClickOutside",function(){return e.props.onCancel()}),e}return wt(n,[{key:"render",value:function(){return ue.default.createElement("div",{className:"react-datepicker__month-dropdown"},this.renderOptions())}}]),n}(ue.default.Component),Pn=mt.default(In),Rn=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"state",{dropdownVisible:!1}),jt(Ct(e),"renderSelectOptions",function(e){return e.map(function(e,t){return ue.default.createElement("option",{key:t,value:t},e)})}),jt(Ct(e),"renderSelectMode",function(t){return ue.default.createElement("select",{value:e.props.month,className:"react-datepicker__month-select",onChange:function(t){return e.onChange(t.target.value)}},e.renderSelectOptions(t))}),jt(Ct(e),"renderReadView",function(t,n){return ue.default.createElement("div",{key:"read",style:{visibility:t?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:e.toggleDropdown},ue.default.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),ue.default.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},n[e.props.month]))}),jt(Ct(e),"renderDropdown",function(t){return ue.default.createElement(Pn,{key:"dropdown",month:e.props.month,monthNames:t,onChange:e.onChange,onCancel:e.toggleDropdown})}),jt(Ct(e),"renderScrollMode",function(t){var n=e.state.dropdownVisible,i=[e.renderReadView(!n,t)];return n&&i.unshift(e.renderDropdown(t)),i}),jt(Ct(e),"onChange",function(t){e.toggleDropdown(),t!==e.props.month&&e.props.onChange(t)}),jt(Ct(e),"toggleDropdown",function(){return e.setState({dropdownVisible:!e.state.dropdownVisible})}),e}return wt(n,[{key:"render",value:function(){var e,t=this,n=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(e){return rn(e,t.props.locale)}:function(e){return nn(e,t.props.locale)});switch(this.props.dropdownMode){case"scroll":e=this.renderScrollMode(n);break;case"select":e=this.renderSelectMode(n)}return ue.default.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},e)}}]),n}(ue.default.Component);function Ln(e,t){for(var n=[],i=qt(e),r=qt(t);!lt.default(i,r);)n.push(Ot(i)),i=_e.default(i,1);return n}var zn=function(e){St(n,e);var t=Et(n);function n(e){var i;return _t(this,n),jt(Ct(i=t.call(this,e)),"renderOptions",function(){return i.state.monthYearsList.map(function(e){var t=ze.default(e),n=Zt(i.props.date,e)&&Xt(i.props.date,e);return ue.default.createElement("div",{className:n?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:t,onClick:i.onChange.bind(Ct(i),t),"aria-selected":n?"true":void 0},n?ue.default.createElement("span",{className:"react-datepicker__month-year-option--selected"},"\u2713"):"",Bt(e,i.props.dateFormat,i.props.locale))})}),jt(Ct(i),"onChange",function(e){return i.props.onChange(e)}),jt(Ct(i),"handleClickOutside",function(){i.props.onCancel()}),i.state={monthYearsList:Ln(i.props.minDate,i.props.maxDate)},i}return wt(n,[{key:"render",value:function(){var e=he.default({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return ue.default.createElement("div",{className:e},this.renderOptions())}}]),n}(ue.default.Component),On=mt.default(zn),Fn=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"state",{dropdownVisible:!1}),jt(Ct(e),"renderSelectOptions",function(){for(var t=qt(e.props.minDate),n=qt(e.props.maxDate),i=[];!lt.default(t,n);){var r=ze.default(t);i.push(ue.default.createElement("option",{key:r,value:r},Bt(t,e.props.dateFormat,e.props.locale))),t=_e.default(t,1)}return i}),jt(Ct(e),"onSelectChange",function(t){e.onChange(t.target.value)}),jt(Ct(e),"renderSelectMode",function(){return ue.default.createElement("select",{value:ze.default(qt(e.props.date)),className:"react-datepicker__month-year-select",onChange:e.onSelectChange},e.renderSelectOptions())}),jt(Ct(e),"renderReadView",function(t){var n=Bt(e.props.date,e.props.dateFormat,e.props.locale);return ue.default.createElement("div",{key:"read",style:{visibility:t?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:function(t){return e.toggleDropdown(t)}},ue.default.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),ue.default.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},n))}),jt(Ct(e),"renderDropdown",function(){return ue.default.createElement(On,{key:"dropdown",date:e.props.date,dateFormat:e.props.dateFormat,onChange:e.onChange,onCancel:e.toggleDropdown,minDate:e.props.minDate,maxDate:e.props.maxDate,scrollableMonthYearDropdown:e.props.scrollableMonthYearDropdown,locale:e.props.locale})}),jt(Ct(e),"renderScrollMode",function(){var t=e.state.dropdownVisible,n=[e.renderReadView(!t)];return t&&n.unshift(e.renderDropdown()),n}),jt(Ct(e),"onChange",function(t){e.toggleDropdown();var n=Ot(parseInt(t));Zt(e.props.date,n)&&Xt(e.props.date,n)||e.props.onChange(n)}),jt(Ct(e),"toggleDropdown",function(){return e.setState({dropdownVisible:!e.state.dropdownVisible})}),e}return wt(n,[{key:"render",value:function(){var e;switch(this.props.dropdownMode){case"scroll":e=this.renderScrollMode();break;case"select":e=this.renderSelectMode()}return ue.default.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},e)}}]),n}(ue.default.Component),Bn=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"dayEl",ue.default.createRef()),jt(Ct(e),"handleClick",function(t){!e.isDisabled()&&e.props.onClick&&e.props.onClick(t)}),jt(Ct(e),"handleMouseEnter",function(t){!e.isDisabled()&&e.props.onMouseEnter&&e.props.onMouseEnter(t)}),jt(Ct(e),"handleOnKeyDown",function(t){" "===t.key&&(t.preventDefault(),t.key="Enter"),e.props.handleOnKeyDown(t)}),jt(Ct(e),"isSameDay",function(t){return Qt(e.props.day,t)}),jt(Ct(e),"isKeyboardSelected",function(){return!e.props.disabledKeyboardNavigation&&!(e.isSameDay(e.props.selected)||e.isSameWeek(e.props.selected))&&(e.isSameDay(e.props.preSelection)||e.isSameWeek(e.props.preSelection))}),jt(Ct(e),"isDisabled",function(){return sn(e.props.day,e.props)}),jt(Ct(e),"isExcluded",function(){return an(e.props.day,e.props)}),jt(Ct(e),"isStartOfWeek",function(){return Qt(e.props.day,Ht(e.props.day,e.props.locale,e.props.calendarStartDay))}),jt(Ct(e),"isSameWeek",function(t){return e.props.showWeekPicker&&Qt(t,Ht(e.props.day,e.props.locale,e.props.calendarStartDay))}),jt(Ct(e),"getHighLightedClass",function(){var t=e.props,n=t.day,i=t.highlightDates;if(!i)return!1;var r=Bt(n,"MM.dd.yyyy");return i.get(r)}),jt(Ct(e),"getHolidaysClass",function(){var t=e.props,n=t.day,i=t.holidays;if(!i)return!1;var r=Bt(n,"MM.dd.yyyy");return i.has(r)?[i.get(r).className]:void 0}),jt(Ct(e),"isInRange",function(){var t=e.props,n=t.day,i=t.startDate,r=t.endDate;return!(!i||!r)&&$t(n,i,r)}),jt(Ct(e),"isInSelectingRange",function(){var t,n=e.props,i=n.day,r=n.selectsStart,s=n.selectsEnd,a=n.selectsRange,o=n.selectsDisabledDaysInRange,l=n.startDate,c=n.endDate,d=null!==(t=e.props.selectingDate)&&void 0!==t?t:e.props.preSelection;return!(!(r||s||a)||!d||!o&&e.isDisabled())&&(r&&c&&(ct.default(d,c)||Jt(d,c))?$t(i,d,c):(s&&l&&(lt.default(d,l)||Jt(d,l))||!(!a||!l||c||!lt.default(d,l)&&!Jt(d,l)))&&$t(i,l,d))}),jt(Ct(e),"isSelectingRangeStart",function(){var t;if(!e.isInSelectingRange())return!1;var n=e.props,i=n.day,r=n.startDate,s=n.selectsStart,a=null!==(t=e.props.selectingDate)&&void 0!==t?t:e.props.preSelection;return Qt(i,s?a:r)}),jt(Ct(e),"isSelectingRangeEnd",function(){var t;if(!e.isInSelectingRange())return!1;var n=e.props,i=n.day,r=n.endDate,s=n.selectsEnd,a=n.selectsRange,o=null!==(t=e.props.selectingDate)&&void 0!==t?t:e.props.preSelection;return Qt(i,s||a?o:r)}),jt(Ct(e),"isRangeStart",function(){var t=e.props,n=t.day,i=t.startDate,r=t.endDate;return!(!i||!r)&&Qt(i,n)}),jt(Ct(e),"isRangeEnd",function(){var t=e.props,n=t.day,i=t.startDate,r=t.endDate;return!(!i||!r)&&Qt(r,n)}),jt(Ct(e),"isWeekend",function(){var t=Me.default(e.props.day);return 0===t||6===t}),jt(Ct(e),"isAfterMonth",function(){return void 0!==e.props.month&&(e.props.month+1)%12===Pe.default(e.props.day)}),jt(Ct(e),"isBeforeMonth",function(){return void 0!==e.props.month&&(Pe.default(e.props.day)+1)%12===e.props.month}),jt(Ct(e),"isCurrentDay",function(){return e.isSameDay(Ot())}),jt(Ct(e),"isSelected",function(){return e.isSameDay(e.props.selected)||e.isSameWeek(e.props.selected)}),jt(Ct(e),"getClassNames",function(t){var n,i=e.props.dayClassName?e.props.dayClassName(t):void 0;return he.default("react-datepicker__day",i,"react-datepicker__day--"+Bt(e.props.day,"ddd",n),{"react-datepicker__day--disabled":e.isDisabled(),"react-datepicker__day--excluded":e.isExcluded(),"react-datepicker__day--selected":e.isSelected(),"react-datepicker__day--keyboard-selected":e.isKeyboardSelected(),"react-datepicker__day--range-start":e.isRangeStart(),"react-datepicker__day--range-end":e.isRangeEnd(),"react-datepicker__day--in-range":e.isInRange(),"react-datepicker__day--in-selecting-range":e.isInSelectingRange(),"react-datepicker__day--selecting-range-start":e.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":e.isSelectingRangeEnd(),"react-datepicker__day--today":e.isCurrentDay(),"react-datepicker__day--weekend":e.isWeekend(),"react-datepicker__day--outside-month":e.isAfterMonth()||e.isBeforeMonth()},e.getHighLightedClass("react-datepicker__day--highlighted"),e.getHolidaysClass())}),jt(Ct(e),"getAriaLabel",function(){var t=e.props,n=t.day,i=t.ariaLabelPrefixWhenEnabled,r=void 0===i?"Choose":i,s=t.ariaLabelPrefixWhenDisabled,a=void 0===s?"Not available":s,o=e.isDisabled()||e.isExcluded()?a:r;return"".concat(o," ").concat(Bt(n,"PPPP",e.props.locale))}),jt(Ct(e),"getTitle",function(){var t=e.props,n=t.day,i=t.holidays,r=void 0===i?new Map:i,s=Bt(n,"MM.dd.yyyy");return r.has(s)&&r.get(s).holidayNames.length>0?r.get(s).holidayNames.join(", "):""}),jt(Ct(e),"getTabIndex",function(t,n){var i=t||e.props.selected,r=n||e.props.preSelection;return(!e.props.showWeekPicker||!e.props.showWeekNumber&&e.isStartOfWeek())&&(e.isKeyboardSelected()||e.isSameDay(i)&&Qt(r,i))?0:-1}),jt(Ct(e),"handleFocusDay",function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=!1;0===e.getTabIndex()&&!n.isInputFocused&&e.isSameDay(e.props.preSelection)&&(document.activeElement&&document.activeElement!==document.body||(i=!0),e.props.inline&&!e.props.shouldFocusDayInline&&(i=!1),e.props.containerRef&&e.props.containerRef.current&&e.props.containerRef.current.contains(document.activeElement)&&document.activeElement.classList.contains("react-datepicker__day")&&(i=!0),e.props.monthShowsDuplicateDaysEnd&&e.isAfterMonth()&&(i=!1),e.props.monthShowsDuplicateDaysStart&&e.isBeforeMonth()&&(i=!1)),i&&(null===(t=e.dayEl.current)||void 0===t||t.focus({preventScroll:!0}))}),jt(Ct(e),"renderDayContents",function(){return e.props.monthShowsDuplicateDaysEnd&&e.isAfterMonth()||e.props.monthShowsDuplicateDaysStart&&e.isBeforeMonth()?null:e.props.renderDayContents?e.props.renderDayContents(De.default(e.props.day),e.props.day):De.default(e.props.day)}),jt(Ct(e),"render",function(){return ue.default.createElement("div",{ref:e.dayEl,className:e.getClassNames(e.props.day),onKeyDown:e.handleOnKeyDown,onClick:e.handleClick,onMouseEnter:e.handleMouseEnter,tabIndex:e.getTabIndex(),"aria-label":e.getAriaLabel(),role:"option",title:e.getTitle(),"aria-disabled":e.isDisabled(),"aria-current":e.isCurrentDay()?"date":void 0,"aria-selected":e.isSelected()||e.isInRange()},e.renderDayContents(),""!==e.getTitle()&&ue.default.createElement("span",{className:"holiday-overlay"},e.getTitle()))}),e}return wt(n,[{key:"componentDidMount",value:function(){this.handleFocusDay()}},{key:"componentDidUpdate",value:function(e){this.handleFocusDay(e)}}]),n}(ue.default.Component),Vn=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"weekNumberEl",ue.default.createRef()),jt(Ct(e),"handleClick",function(t){e.props.onClick&&e.props.onClick(t)}),jt(Ct(e),"handleOnKeyDown",function(t){" "===t.key&&(t.preventDefault(),t.key="Enter"),e.props.handleOnKeyDown(t)}),jt(Ct(e),"isKeyboardSelected",function(){return!e.props.disabledKeyboardNavigation&&!Qt(e.props.date,e.props.selected)&&Qt(e.props.date,e.props.preSelection)}),jt(Ct(e),"getTabIndex",function(){return e.props.showWeekPicker&&e.props.showWeekNumber&&(e.isKeyboardSelected()||Qt(e.props.date,e.props.selected)&&Qt(e.props.preSelection,e.props.selected))?0:-1}),jt(Ct(e),"handleFocusWeekNumber",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1;0===e.getTabIndex()&&!t.isInputFocused&&Qt(e.props.date,e.props.preSelection)&&(document.activeElement&&document.activeElement!==document.body||(n=!0),e.props.inline&&!e.props.shouldFocusDayInline&&(n=!1),e.props.containerRef&&e.props.containerRef.current&&e.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(n=!0)),n&&e.weekNumberEl.current&&e.weekNumberEl.current.focus({preventScroll:!0})}),e}return wt(n,[{key:"componentDidMount",value:function(){this.handleFocusWeekNumber()}},{key:"componentDidUpdate",value:function(e){this.handleFocusWeekNumber(e)}},{key:"render",value:function(){var e=this.props,t=e.weekNumber,n=e.ariaLabelPrefix,i=void 0===n?"week ":n,r={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!e.onClick,"react-datepicker__week-number--selected":Qt(this.props.date,this.props.selected),"react-datepicker__week-number--keyboard-selected":this.isKeyboardSelected()};return ue.default.createElement("div",{ref:this.weekNumberEl,className:he.default(r),"aria-label":"".concat(i," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex()},t)}}],[{key:"defaultProps",get:function(){return{ariaLabelPrefix:"week "}}}]),n}(ue.default.Component),Un=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"handleDayClick",function(t,n){e.props.onDayClick&&e.props.onDayClick(t,n)}),jt(Ct(e),"handleDayMouseEnter",function(t){e.props.onDayMouseEnter&&e.props.onDayMouseEnter(t)}),jt(Ct(e),"handleWeekClick",function(t,n,i){if("function"==typeof e.props.onWeekSelect&&e.props.onWeekSelect(t,n,i),e.props.showWeekPicker){var r=Ht(t,e.props.locale,e.props.calendarStartDay);e.handleDayClick(r,i)}e.props.shouldCloseOnSelect&&e.props.setOpen(!1)}),jt(Ct(e),"formatWeekNumber",function(t){return e.props.formatWeekNumber?e.props.formatWeekNumber(t):function(e,t){var n=t&&tn(t)||en()&&tn(en());return Ie.default(e,n?{locale:n}:null)}(t)}),jt(Ct(e),"renderDays",function(){var t=Ht(e.props.day,e.props.locale,e.props.calendarStartDay),n=[],i=e.formatWeekNumber(t);if(e.props.showWeekNumber){var r=e.props.onWeekSelect||e.props.showWeekPicker?e.handleWeekClick.bind(Ct(e),t,i):void 0;n.push(ue.default.createElement(Vn,{key:"W",weekNumber:i,date:t,onClick:r,selected:e.props.selected,preSelection:e.props.preSelection,ariaLabelPrefix:e.props.ariaLabelPrefix,showWeekPicker:e.props.showWeekPicker,showWeekNumber:e.props.showWeekNumber,disabledKeyboardNavigation:e.props.disabledKeyboardNavigation,handleOnKeyDown:e.props.handleOnKeyDown,isInputFocused:e.props.isInputFocused,containerRef:e.props.containerRef}))}return n.concat([0,1,2,3,4,5,6].map(function(n){var i=ye.default(t,n);return ue.default.createElement(Bn,{ariaLabelPrefixWhenEnabled:e.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:e.props.disabledDayAriaLabelPrefix,key:i.valueOf(),day:i,month:e.props.month,onClick:e.handleDayClick.bind(Ct(e),i),onMouseEnter:e.handleDayMouseEnter.bind(Ct(e),i),minDate:e.props.minDate,maxDate:e.props.maxDate,excludeDates:e.props.excludeDates,excludeDateIntervals:e.props.excludeDateIntervals,includeDates:e.props.includeDates,includeDateIntervals:e.props.includeDateIntervals,highlightDates:e.props.highlightDates,holidays:e.props.holidays,selectingDate:e.props.selectingDate,filterDate:e.props.filterDate,preSelection:e.props.preSelection,selected:e.props.selected,selectsStart:e.props.selectsStart,selectsEnd:e.props.selectsEnd,selectsRange:e.props.selectsRange,showWeekPicker:e.props.showWeekPicker,showWeekNumber:e.props.showWeekNumber,selectsDisabledDaysInRange:e.props.selectsDisabledDaysInRange,startDate:e.props.startDate,endDate:e.props.endDate,dayClassName:e.props.dayClassName,renderDayContents:e.props.renderDayContents,disabledKeyboardNavigation:e.props.disabledKeyboardNavigation,handleOnKeyDown:e.props.handleOnKeyDown,isInputFocused:e.props.isInputFocused,containerRef:e.props.containerRef,inline:e.props.inline,shouldFocusDayInline:e.props.shouldFocusDayInline,monthShowsDuplicateDaysEnd:e.props.monthShowsDuplicateDaysEnd,monthShowsDuplicateDaysStart:e.props.monthShowsDuplicateDaysStart,locale:e.props.locale})}))}),jt(Ct(e),"startOfWeek",function(){return Ht(e.props.day,e.props.locale,e.props.calendarStartDay)}),jt(Ct(e),"isKeyboardSelected",function(){return!e.props.disabledKeyboardNavigation&&!Qt(e.startOfWeek(),e.props.selected)&&Qt(e.startOfWeek(),e.props.preSelection)}),e}return wt(n,[{key:"render",value:function(){var e={"react-datepicker__week":!0,"react-datepicker__week--selected":Qt(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()};return ue.default.createElement("div",{className:he.default(e)},this.renderDays())}}],[{key:"defaultProps",get:function(){return{shouldCloseOnSelect:!0}}}]),n}(ue.default.Component),Hn="two_columns",qn="three_columns",Wn="four_columns",Gn=jt(jt(jt({},Hn,{grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2}),qn,{grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3}),Wn,{grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4});function Yn(e,t){return e?Wn:t?Hn:qn}var Zn=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"MONTH_REFS",At(Array(12)).map(function(){return ue.default.createRef()})),jt(Ct(e),"QUARTER_REFS",At(Array(4)).map(function(){return ue.default.createRef()})),jt(Ct(e),"isDisabled",function(t){return sn(t,e.props)}),jt(Ct(e),"isExcluded",function(t){return an(t,e.props)}),jt(Ct(e),"handleDayClick",function(t,n){e.props.onDayClick&&e.props.onDayClick(t,n,e.props.orderInDisplay)}),jt(Ct(e),"handleDayMouseEnter",function(t){e.props.onDayMouseEnter&&e.props.onDayMouseEnter(t)}),jt(Ct(e),"handleMouseLeave",function(){e.props.onMouseLeave&&e.props.onMouseLeave()}),jt(Ct(e),"isRangeStartMonth",function(t){var n=e.props,i=n.day,r=n.startDate,s=n.endDate;return!(!r||!s)&&Xt(Ve.default(i,t),r)}),jt(Ct(e),"isRangeStartQuarter",function(t){var n=e.props,i=n.day,r=n.startDate,s=n.endDate;return!(!r||!s)&&Kt(Ue.default(i,t),r)}),jt(Ct(e),"isRangeEndMonth",function(t){var n=e.props,i=n.day,r=n.startDate,s=n.endDate;return!(!r||!s)&&Xt(Ve.default(i,t),s)}),jt(Ct(e),"isRangeEndQuarter",function(t){var n=e.props,i=n.day,r=n.startDate,s=n.endDate;return!(!r||!s)&&Kt(Ue.default(i,t),s)}),jt(Ct(e),"isInSelectingRangeMonth",function(t){var n,i=e.props,r=i.day,s=i.selectsStart,a=i.selectsEnd,o=i.selectsRange,l=i.startDate,c=i.endDate,d=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return!(!(s||a||o)||!d)&&(s&&c?ln(d,c,t,r):(a&&l||!(!o||!l||c))&&ln(l,d,t,r))}),jt(Ct(e),"isSelectingMonthRangeStart",function(t){var n;if(!e.isInSelectingRangeMonth(t))return!1;var i=e.props,r=i.day,s=i.startDate,a=i.selectsStart,o=Ve.default(r,t),l=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return Xt(o,a?l:s)}),jt(Ct(e),"isSelectingMonthRangeEnd",function(t){var n;if(!e.isInSelectingRangeMonth(t))return!1;var i=e.props,r=i.day,s=i.endDate,a=i.selectsEnd,o=i.selectsRange,l=Ve.default(r,t),c=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return Xt(l,a||o?c:s)}),jt(Ct(e),"isInSelectingRangeQuarter",function(t){var n,i=e.props,r=i.day,s=i.selectsStart,a=i.selectsEnd,o=i.selectsRange,l=i.startDate,c=i.endDate,d=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return!(!(s||a||o)||!d)&&(s&&c?hn(d,c,t,r):(a&&l||!(!o||!l||c))&&hn(l,d,t,r))}),jt(Ct(e),"isWeekInMonth",function(t){var n=e.props.day,i=ye.default(t,6);return Xt(t,n)||Xt(i,n)}),jt(Ct(e),"isCurrentMonth",function(e,t){return Le.default(e)===Le.default(Ot())&&t===Pe.default(Ot())}),jt(Ct(e),"isCurrentQuarter",function(e,t){return Le.default(e)===Le.default(Ot())&&t===Re.default(Ot())}),jt(Ct(e),"isSelectedMonth",function(e,t,n){return Pe.default(n)===t&&Le.default(e)===Le.default(n)}),jt(Ct(e),"isSelectedQuarter",function(e,t,n){return Re.default(e)===t&&Le.default(e)===Le.default(n)}),jt(Ct(e),"renderWeeks",function(){for(var t=[],n=e.props.fixedHeight,i=0,r=!1,s=Ht(qt(e.props.day),e.props.locale,e.props.calendarStartDay);t.push(ue.default.createElement(Un,{ariaLabelPrefix:e.props.weekAriaLabelPrefix,chooseDayAriaLabelPrefix:e.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:e.props.disabledDayAriaLabelPrefix,key:i,day:s,month:Pe.default(e.props.day),onDayClick:e.handleDayClick,onDayMouseEnter:e.handleDayMouseEnter,onWeekSelect:e.props.onWeekSelect,formatWeekNumber:e.props.formatWeekNumber,locale:e.props.locale,minDate:e.props.minDate,maxDate:e.props.maxDate,excludeDates:e.props.excludeDates,excludeDateIntervals:e.props.excludeDateIntervals,includeDates:e.props.includeDates,includeDateIntervals:e.props.includeDateIntervals,inline:e.props.inline,shouldFocusDayInline:e.props.shouldFocusDayInline,highlightDates:e.props.highlightDates,holidays:e.props.holidays,selectingDate:e.props.selectingDate,filterDate:e.props.filterDate,preSelection:e.props.preSelection,selected:e.props.selected,selectsStart:e.props.selectsStart,selectsEnd:e.props.selectsEnd,selectsRange:e.props.selectsRange,selectsDisabledDaysInRange:e.props.selectsDisabledDaysInRange,showWeekNumber:e.props.showWeekNumbers,showWeekPicker:e.props.showWeekPicker,startDate:e.props.startDate,endDate:e.props.endDate,dayClassName:e.props.dayClassName,setOpen:e.props.setOpen,shouldCloseOnSelect:e.props.shouldCloseOnSelect,disabledKeyboardNavigation:e.props.disabledKeyboardNavigation,renderDayContents:e.props.renderDayContents,handleOnKeyDown:e.props.handleOnKeyDown,isInputFocused:e.props.isInputFocused,containerRef:e.props.containerRef,calendarStartDay:e.props.calendarStartDay,monthShowsDuplicateDaysEnd:e.props.monthShowsDuplicateDaysEnd,monthShowsDuplicateDaysStart:e.props.monthShowsDuplicateDaysStart})),!r;){i++,s=ve.default(s,1);var a=n&&i>=6,o=!n&&!e.isWeekInMonth(s);if(a||o){if(!e.props.peekNextMonth)break;r=!0}}return t}),jt(Ct(e),"onMonthClick",function(t,n){e.handleDayClick(qt(Ve.default(e.props.day,n)),t)}),jt(Ct(e),"onMonthMouseEnter",function(t){e.handleDayMouseEnter(qt(Ve.default(e.props.day,t)))}),jt(Ct(e),"handleMonthNavigation",function(t,n){e.isDisabled(n)||e.isExcluded(n)||(e.props.setPreSelection(n),e.MONTH_REFS[t].current&&e.MONTH_REFS[t].current.focus())}),jt(Ct(e),"onMonthKeyDown",function(t,n){var i=e.props,r=i.selected,s=i.preSelection,a=i.disabledKeyboardNavigation,o=i.showTwoColumnMonthYearPicker,l=i.showFourColumnMonthYearPicker,c=i.setPreSelection,d=t.key;if("Tab"!==d&&t.preventDefault(),!a){var u=Yn(l,o),h=Gn[u].verticalNavigationOffset,p=Gn[u].grid;switch(d){case"Enter":e.onMonthClick(t,n),c(r);break;case"ArrowRight":e.handleMonthNavigation(11===n?0:n+1,_e.default(s,1));break;case"ArrowLeft":e.handleMonthNavigation(0===n?11:n-1,Se.default(s,1));break;case"ArrowUp":e.handleMonthNavigation(p[0].includes(n)?n+12-h:n-h,Se.default(s,h));break;case"ArrowDown":e.handleMonthNavigation(p[p.length-1].includes(n)?n-12+h:n+h,_e.default(s,h))}}}),jt(Ct(e),"onQuarterClick",function(t,n){e.handleDayClick(Gt(Ue.default(e.props.day,n)),t)}),jt(Ct(e),"onQuarterMouseEnter",function(t){e.handleDayMouseEnter(Gt(Ue.default(e.props.day,t)))}),jt(Ct(e),"handleQuarterNavigation",function(t,n){e.isDisabled(n)||e.isExcluded(n)||(e.props.setPreSelection(n),e.QUARTER_REFS[t-1].current&&e.QUARTER_REFS[t-1].current.focus())}),jt(Ct(e),"onQuarterKeyDown",function(t,n){var i=t.key;if(!e.props.disabledKeyboardNavigation)switch(i){case"Enter":e.onQuarterClick(t,n),e.props.setPreSelection(e.props.selected);break;case"ArrowRight":e.handleQuarterNavigation(4===n?1:n+1,be.default(e.props.preSelection,1));break;case"ArrowLeft":e.handleQuarterNavigation(1===n?4:n-1,ke.default(e.props.preSelection,1))}}),jt(Ct(e),"getMonthClassNames",function(t){var n=e.props,i=n.day,r=n.startDate,s=n.endDate,a=n.selected,o=n.minDate,l=n.maxDate,c=n.preSelection,d=n.monthClassName,u=n.excludeDates,h=n.includeDates,p=d?d(Ve.default(i,t)):void 0,m=Ve.default(i,t);return he.default("react-datepicker__month-text","react-datepicker__month-".concat(t),p,{"react-datepicker__month-text--disabled":(o||l||u||h)&&on(m,e.props),"react-datepicker__month-text--selected":e.isSelectedMonth(i,t,a),"react-datepicker__month-text--keyboard-selected":!e.props.disabledKeyboardNavigation&&Pe.default(c)===t,"react-datepicker__month-text--in-selecting-range":e.isInSelectingRangeMonth(t),"react-datepicker__month-text--in-range":ln(r,s,t,i),"react-datepicker__month-text--range-start":e.isRangeStartMonth(t),"react-datepicker__month-text--range-end":e.isRangeEndMonth(t),"react-datepicker__month-text--selecting-range-start":e.isSelectingMonthRangeStart(t),"react-datepicker__month-text--selecting-range-end":e.isSelectingMonthRangeEnd(t),"react-datepicker__month-text--today":e.isCurrentMonth(i,t)})}),jt(Ct(e),"getTabIndex",function(t){var n=Pe.default(e.props.preSelection);return e.props.disabledKeyboardNavigation||t!==n?"-1":"0"}),jt(Ct(e),"getQuarterTabIndex",function(t){var n=Re.default(e.props.preSelection);return e.props.disabledKeyboardNavigation||t!==n?"-1":"0"}),jt(Ct(e),"getAriaLabel",function(t){var n=e.props,i=n.chooseDayAriaLabelPrefix,r=void 0===i?"Choose":i,s=n.disabledDayAriaLabelPrefix,a=void 0===s?"Not available":s,o=n.day,l=Ve.default(o,t),c=e.isDisabled(l)||e.isExcluded(l)?a:r;return"".concat(c," ").concat(Bt(l,"MMMM yyyy"))}),jt(Ct(e),"getQuarterClassNames",function(t){var n=e.props,i=n.day,r=n.startDate,s=n.endDate,a=n.selected,o=n.minDate,l=n.maxDate,c=n.preSelection,d=n.disabledKeyboardNavigation;return he.default("react-datepicker__quarter-text","react-datepicker__quarter-".concat(t),{"react-datepicker__quarter-text--disabled":(o||l)&&cn(Ue.default(i,t),e.props),"react-datepicker__quarter-text--selected":e.isSelectedQuarter(i,t,a),"react-datepicker__quarter-text--keyboard-selected":!d&&Re.default(c)===t,"react-datepicker__quarter-text--in-selecting-range":e.isInSelectingRangeQuarter(t),"react-datepicker__quarter-text--in-range":hn(r,s,t,i),"react-datepicker__quarter-text--range-start":e.isRangeStartQuarter(t),"react-datepicker__quarter-text--range-end":e.isRangeEndQuarter(t)})}),jt(Ct(e),"getMonthContent",function(t){var n=e.props,i=n.showFullMonthYearPicker,r=n.renderMonthContent,s=n.locale,a=n.day,o=rn(t,s),l=nn(t,s);return r?r(t,o,l,a):i?l:o}),jt(Ct(e),"getQuarterContent",function(t){var n=e.props,i=n.renderQuarterContent,r=function(e,t){return Bt(Ue.default(Ot(),e),"QQQ",t)}(t,n.locale);return i?i(t,r):r}),jt(Ct(e),"renderMonths",function(){var t=e.props,n=t.showTwoColumnMonthYearPicker,i=t.showFourColumnMonthYearPicker,r=t.day,s=t.selected;return Gn[Yn(i,n)].grid.map(function(t,n){return ue.default.createElement("div",{className:"react-datepicker__month-wrapper",key:n},t.map(function(t,n){return ue.default.createElement("div",{ref:e.MONTH_REFS[t],key:n,onClick:function(n){e.onMonthClick(n,t)},onKeyDown:function(n){e.onMonthKeyDown(n,t)},onMouseEnter:function(){return e.onMonthMouseEnter(t)},tabIndex:e.getTabIndex(t),className:e.getMonthClassNames(t),role:"option","aria-label":e.getAriaLabel(t),"aria-current":e.isCurrentMonth(r,t)?"date":void 0,"aria-selected":e.isSelectedMonth(r,t,s)},e.getMonthContent(t))}))})}),jt(Ct(e),"renderQuarters",function(){var t=e.props,n=t.day,i=t.selected;return ue.default.createElement("div",{className:"react-datepicker__quarter-wrapper"},[1,2,3,4].map(function(t,r){return ue.default.createElement("div",{key:r,ref:e.QUARTER_REFS[r],role:"option",onClick:function(n){e.onQuarterClick(n,t)},onKeyDown:function(n){e.onQuarterKeyDown(n,t)},onMouseEnter:function(){return e.onQuarterMouseEnter(t)},className:e.getQuarterClassNames(t),"aria-selected":e.isSelectedQuarter(n,t,i),tabIndex:e.getQuarterTabIndex(t),"aria-current":e.isCurrentQuarter(n,t)?"date":void 0},e.getQuarterContent(t))}))}),jt(Ct(e),"getClassNames",function(){var t=e.props,n=t.selectingDate,i=t.selectsStart,r=t.selectsEnd,s=t.showMonthYearPicker,a=t.showQuarterYearPicker,o=t.showWeekPicker;return he.default("react-datepicker__month",{"react-datepicker__month--selecting-range":n&&(i||r)},{"react-datepicker__monthPicker":s},{"react-datepicker__quarterPicker":a},{"react-datepicker__weekPicker":o})}),e}return wt(n,[{key:"render",value:function(){var e=this.props,t=e.showMonthYearPicker,n=e.showQuarterYearPicker,i=e.day,r=e.ariaLabelPrefix,s=void 0===r?"month ":r;return ue.default.createElement("div",{className:this.getClassNames(),onMouseLeave:this.handleMouseLeave,"aria-label":"".concat(s," ").concat(Bt(i,"yyyy-MM")),role:"listbox"},t?this.renderMonths():n?this.renderQuarters():this.renderWeeks())}}]),n}(ue.default.Component),Xn=function(e){St(n,e);var t=Et(n);function n(){var e;_t(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return jt(Ct(e=t.call.apply(t,[this].concat(r))),"state",{height:null}),jt(Ct(e),"scrollToTheSelectedTime",function(){requestAnimationFrame(function(){e.list&&(e.list.scrollTop=e.centerLi&&n.calcCenterPosition(e.props.monthRef?e.props.monthRef.clientHeight-e.header.clientHeight:e.list.clientHeight,e.centerLi))})}),jt(Ct(e),"handleClick",function(t){(e.props.minTime||e.props.maxTime)&&gn(t,e.props)||(e.props.excludeTimes||e.props.includeTimes||e.props.filterTime)&&fn(t,e.props)||e.props.onChange(t)}),jt(Ct(e),"isSelectedTime",function(t){return e.props.selected&&(n=t,Cn(e.props.selected).getTime()===Cn(n).getTime());var n}),jt(Ct(e),"isDisabledTime",function(t){return(e.props.minTime||e.props.maxTime)&&gn(t,e.props)||(e.props.excludeTimes||e.props.includeTimes||e.props.filterTime)&&fn(t,e.props)}),jt(Ct(e),"liClasses",function(t){var n=["react-datepicker__time-list-item",e.props.timeClassName?e.props.timeClassName(t):void 0];return e.isSelectedTime(t)&&n.push("react-datepicker__time-list-item--selected"),e.isDisabledTime(t)&&n.push("react-datepicker__time-list-item--disabled"),e.props.injectTimes&&(60*Ae.default(t)+Ee.default(t))%e.props.intervals!=0&&n.push("react-datepicker__time-list-item--injected"),n.join(" ")}),jt(Ct(e),"handleOnKeyDown",function(t,n){" "===t.key&&(t.preventDefault(),t.key="Enter"),"ArrowUp"!==t.key&&"ArrowLeft"!==t.key||!t.target.previousSibling||(t.preventDefault(),t.target.previousSibling.focus()),"ArrowDown"!==t.key&&"ArrowRight"!==t.key||!t.target.nextSibling||(t.preventDefault(),t.target.nextSibling.focus()),"Enter"===t.key&&e.handleClick(n),e.props.handleOnKeyDown(t)}),jt(Ct(e),"renderTimes",function(){for(var t,n=[],i=e.props.format?e.props.format:"p",r=e.props.intervals,s=e.props.selected||e.props.openToDate||Ot(),a=(t=s,Xe.default(t)),o=e.props.injectTimes&&e.props.injectTimes.sort(function(e,t){return e-t}),l=60*function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),24);return Math.round((+n-+t)/36e5)}(s),c=l/r,d=0;d<c;d++){var u=ge.default(a,d*r);if(n.push(u),o){var h=Sn(a,u,d,r,o);n=n.concat(h)}}var p=n.reduce(function(e,t){return t.getTime()<=s.getTime()?t:e},n[0]);return n.map(function(t,n){return ue.default.createElement("li",{key:n,onClick:e.handleClick.bind(Ct(e),t),className:e.liClasses(t),ref:function(n){t===p&&(e.centerLi=n)},onKeyDown:function(n){e.handleOnKeyDown(n,t)},tabIndex:t===p?0:-1,role:"option","aria-selected":e.isSelectedTime(t)?"true":void 0,"aria-disabled":e.isDisabledTime(t)?"true":void 0},Bt(t,i,e.props.locale))})}),e}return wt(n,[{key:"componentDidMount",value:function(){this.scrollToTheSelectedTime(),this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})}},{key:"render",value:function(){var e=this,t=this.state.height;return ue.default.createElement("div",{className:"react-datepicker__time-container ".concat(this.props.todayButton?"react-datepicker__time-container--with-today-button":"")},ue.default.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(this.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(t){e.header=t}},ue.default.createElement("div",{className:"react-datepicker-time__header"},this.props.timeCaption)),ue.default.createElement("div",{className:"react-datepicker__time"},ue.default.createElement("div",{className:"react-datepicker__time-box"},ue.default.createElement("ul",{className:"react-datepicker__time-list",ref:function(t){e.list=t},style:t?{height:t}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))}}],[{key:"defaultProps",get:function(){return{intervals:30,onTimeChange:function(){},todayButton:null,timeCaption:"Time"}}}]),n}(ue.default.Component);jt(Xn,"calcCenterPosition",function(e,t){return t.offsetTop-(e/2-t.clientHeight/2)});var Kn=function(e){St(n,e);var t=Et(n);function n(e){var i;return _t(this,n),jt(Ct(i=t.call(this,e)),"YEAR_REFS",At(Array(i.props.yearItemNumber)).map(function(){return ue.default.createRef()})),jt(Ct(i),"isDisabled",function(e){return sn(e,i.props)}),jt(Ct(i),"isExcluded",function(e){return an(e,i.props)}),jt(Ct(i),"selectingDate",function(){var e;return null!==(e=i.props.selectingDate)&&void 0!==e?e:i.props.preSelection}),jt(Ct(i),"updateFocusOnPaginate",function(e){var t=function(){this.YEAR_REFS[e].current.focus()}.bind(Ct(i));window.requestAnimationFrame(t)}),jt(Ct(i),"handleYearClick",function(e,t){i.props.onDayClick&&i.props.onDayClick(e,t)}),jt(Ct(i),"handleYearNavigation",function(e,t){var n=i.props,r=n.date,s=n.yearItemNumber,a=Tn(r,s).startPeriod;i.isDisabled(t)||i.isExcluded(t)||(i.props.setPreSelection(t),e-a==-1?i.updateFocusOnPaginate(s-1):e-a===s?i.updateFocusOnPaginate(0):i.YEAR_REFS[e-a].current.focus())}),jt(Ct(i),"isSameDay",function(e,t){return Qt(e,t)}),jt(Ct(i),"isCurrentYear",function(e){return e===Le.default(Ot())}),jt(Ct(i),"isRangeStart",function(e){return i.props.startDate&&i.props.endDate&&Zt(He.default(Ot(),e),i.props.startDate)}),jt(Ct(i),"isRangeEnd",function(e){return i.props.startDate&&i.props.endDate&&Zt(He.default(Ot(),e),i.props.endDate)}),jt(Ct(i),"isInRange",function(e){return dn(e,i.props.startDate,i.props.endDate)}),jt(Ct(i),"isInSelectingRange",function(e){var t=i.props,n=t.selectsStart,r=t.selectsEnd,s=t.selectsRange,a=t.startDate,o=t.endDate;return!(!(n||r||s)||!i.selectingDate())&&(n&&o?dn(e,i.selectingDate(),o):(r&&a||!(!s||!a||o))&&dn(e,a,i.selectingDate()))}),jt(Ct(i),"isSelectingRangeStart",function(e){if(!i.isInSelectingRange(e))return!1;var t=i.props,n=t.startDate,r=t.selectsStart;return Zt(He.default(Ot(),e),r?i.selectingDate():n)}),jt(Ct(i),"isSelectingRangeEnd",function(e){if(!i.isInSelectingRange(e))return!1;var t=i.props,n=t.endDate,r=t.selectsEnd,s=t.selectsRange;return Zt(He.default(Ot(),e),r||s?i.selectingDate():n)}),jt(Ct(i),"isKeyboardSelected",function(e){var t=Wt(He.default(i.props.date,e));return!i.props.disabledKeyboardNavigation&&!i.props.inline&&!Qt(t,Wt(i.props.selected))&&Qt(t,Wt(i.props.preSelection))}),jt(Ct(i),"onYearClick",function(e,t){var n=i.props.date;i.handleYearClick(Wt(He.default(n,t)),e)}),jt(Ct(i),"onYearKeyDown",function(e,t){var n=e.key;if(!i.props.disabledKeyboardNavigation)switch(n){case"Enter":i.onYearClick(e,t),i.props.setPreSelection(i.props.selected);break;case"ArrowRight":i.handleYearNavigation(t+1,we.default(i.props.preSelection,1));break;case"ArrowLeft":i.handleYearNavigation(t-1,Te.default(i.props.preSelection,1))}}),jt(Ct(i),"getYearClassNames",function(e){var t=i.props,n=t.minDate,r=t.maxDate,s=t.selected,a=t.excludeDates,o=t.includeDates,l=t.filterDate;return he.default("react-datepicker__year-text",{"react-datepicker__year-text--selected":e===Le.default(s),"react-datepicker__year-text--disabled":(n||r||a||o||l)&&un(e,i.props),"react-datepicker__year-text--keyboard-selected":i.isKeyboardSelected(e),"react-datepicker__year-text--range-start":i.isRangeStart(e),"react-datepicker__year-text--range-end":i.isRangeEnd(e),"react-datepicker__year-text--in-range":i.isInRange(e),"react-datepicker__year-text--in-selecting-range":i.isInSelectingRange(e),"react-datepicker__year-text--selecting-range-start":i.isSelectingRangeStart(e),"react-datepicker__year-text--selecting-range-end":i.isSelectingRangeEnd(e),"react-datepicker__year-text--today":i.isCurrentYear(e)})}),jt(Ct(i),"getYearTabIndex",function(e){return i.props.disabledKeyboardNavigation?"-1":e===Le.default(i.props.preSelection)?"0":"-1"}),jt(Ct(i),"getYearContainerClassNames",function(){var e=i.props,t=e.selectingDate,n=e.selectsStart,r=e.selectsEnd,s=e.selectsRange;return he.default("react-datepicker__year",{"react-datepicker__year--selecting-range":t&&(n||r||s)})}),jt(Ct(i),"getYearContent",function(e){return i.props.renderYearContent?i.props.renderYearContent(e):e}),i}return wt(n,[{key:"render",value:function(){for(var e=this,t=[],n=this.props,i=n.date,r=n.yearItemNumber,s=n.onYearMouseEnter,a=n.onYearMouseLeave,o=Tn(i,r),l=o.startPeriod,c=o.endPeriod,d=function(n){t.push(ue.default.createElement("div",{ref:e.YEAR_REFS[n-l],onClick:function(t){e.onYearClick(t,n)},onKeyDown:function(t){e.onYearKeyDown(t,n)},tabIndex:e.getYearTabIndex(n),className:e.getYearClassNames(n),onMouseEnter:function(e){return s(e,n)},onMouseLeave:function(e){return a(e,n)},key:n,"aria-current":e.isCurrentYear(n)?"date":void 0},e.getYearContent(n)))},u=l;u<=c;u++)d(u);return ue.default.createElement("div",{className:this.getYearContainerClassNames()},ue.default.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.clearSelectingDate},t))}}]),n}(ue.default.Component),Qn=function(e){St(n,e);var t=Et(n);function n(e){var i;return _t(this,n),jt(Ct(i=t.call(this,e)),"onTimeChange",function(e){i.setState({time:e});var t=i.props.date,n=t instanceof Date&&!isNaN(t)?t:new Date;n.setHours(e.split(":")[0]),n.setMinutes(e.split(":")[1]),i.props.onChange(n)}),jt(Ct(i),"renderTimeInput",function(){var e=i.state.time,t=i.props,n=t.date,r=t.timeString,s=t.customTimeInput;return s?ue.default.cloneElement(s,{date:n,value:e,onChange:i.onTimeChange}):ue.default.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",required:!0,value:e,onChange:function(e){i.onTimeChange(e.target.value||r)}})}),i.state={time:i.props.timeString},i}return wt(n,[{key:"render",value:function(){return ue.default.createElement("div",{className:"react-datepicker__input-time-container"},ue.default.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),ue.default.createElement("div",{className:"react-datepicker-time__input-container"},ue.default.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.timeString!==t.time?{time:e.timeString}:null}}]),n}(ue.default.Component);function Jn(e){var t=e.className,n=e.children,i=e.showPopperArrow,r=e.arrowProps,s=void 0===r?{}:r;return ue.default.createElement("div",{className:t},i&&ue.default.createElement("div",Nt({className:"react-datepicker__triangle"},s)),n)}var $n=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],ei=function(e){St(n,e);var t=Et(n);function n(e){var i;return _t(this,n),jt(Ct(i=t.call(this,e)),"handleClickOutside",function(e){i.props.onClickOutside(e)}),jt(Ct(i),"setClickOutsideRef",function(){return i.containerRef.current}),jt(Ct(i),"handleDropdownFocus",function(e){(function(){var e=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).className||"").split(/\s+/);return $n.some(function(t){return e.indexOf(t)>=0})})(e.target)&&i.props.onDropdownFocus()}),jt(Ct(i),"getDateInView",function(){var e=i.props,t=e.preSelection,n=e.selected,r=e.openToDate,s=bn(i.props),a=wn(i.props),o=Ot();return r||n||t||(s&&ct.default(o,s)?s:a&&lt.default(o,a)?a:o)}),jt(Ct(i),"increaseMonth",function(){i.setState(function(e){var t=e.date;return{date:_e.default(t,1)}},function(){return i.handleMonthChange(i.state.date)})}),jt(Ct(i),"decreaseMonth",function(){i.setState(function(e){var t=e.date;return{date:Se.default(t,1)}},function(){return i.handleMonthChange(i.state.date)})}),jt(Ct(i),"handleDayClick",function(e,t,n){i.props.onSelect(e,t,n),i.props.setPreSelection&&i.props.setPreSelection(e)}),jt(Ct(i),"handleDayMouseEnter",function(e){i.setState({selectingDate:e}),i.props.onDayMouseEnter&&i.props.onDayMouseEnter(e)}),jt(Ct(i),"handleMonthMouseLeave",function(){i.setState({selectingDate:null}),i.props.onMonthMouseLeave&&i.props.onMonthMouseLeave()}),jt(Ct(i),"handleYearMouseEnter",function(e,t){i.setState({selectingDate:He.default(Ot(),t)}),i.props.onYearMouseEnter&&i.props.onYearMouseEnter(e,t)}),jt(Ct(i),"handleYearMouseLeave",function(e,t){i.props.onYearMouseLeave&&i.props.onYearMouseLeave(e,t)}),jt(Ct(i),"handleYearChange",function(e){i.props.onYearChange&&(i.props.onYearChange(e),i.setState({isRenderAriaLiveMessage:!0})),i.props.adjustDateOnChange&&(i.props.onSelect&&i.props.onSelect(e),i.props.setOpen&&i.props.setOpen(!0)),i.props.setPreSelection&&i.props.setPreSelection(e)}),jt(Ct(i),"handleMonthChange",function(e){i.handleCustomMonthChange(e),i.props.adjustDateOnChange&&(i.props.onSelect&&i.props.onSelect(e),i.props.setOpen&&i.props.setOpen(!0)),i.props.setPreSelection&&i.props.setPreSelection(e)}),jt(Ct(i),"handleCustomMonthChange",function(e){i.props.onMonthChange&&(i.props.onMonthChange(e),i.setState({isRenderAriaLiveMessage:!0}))}),jt(Ct(i),"handleMonthYearChange",function(e){i.handleYearChange(e),i.handleMonthChange(e)}),jt(Ct(i),"changeYear",function(e){i.setState(function(t){var n=t.date;return{date:He.default(n,e)}},function(){return i.handleYearChange(i.state.date)})}),jt(Ct(i),"changeMonth",function(e){i.setState(function(t){var n=t.date;return{date:Ve.default(n,e)}},function(){return i.handleMonthChange(i.state.date)})}),jt(Ct(i),"changeMonthYear",function(e){i.setState(function(t){var n=t.date;return{date:He.default(Ve.default(n,Pe.default(e)),Le.default(e))}},function(){return i.handleMonthYearChange(i.state.date)})}),jt(Ct(i),"header",function(){var e=Ht(arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.state.date,i.props.locale,i.props.calendarStartDay),t=[];return i.props.showWeekNumbers&&t.push(ue.default.createElement("div",{key:"W",className:"react-datepicker__day-name"},i.props.weekLabel||"#")),t.concat([0,1,2,3,4,5,6].map(function(t){var n=ye.default(e,t),r=i.formatWeekday(n,i.props.locale),s=i.props.weekDayClassName?i.props.weekDayClassName(n):void 0;return ue.default.createElement("div",{key:t,className:he.default("react-datepicker__day-name",s)},r)}))}),jt(Ct(i),"formatWeekday",function(e,t){return i.props.formatWeekDay?function(e,t,n){return t(Bt(e,"EEEE",n))}(e,i.props.formatWeekDay,t):i.props.useWeekdaysShort?function(e,t){return Bt(e,"EEE",t)}(e,t):function(e,t){return Bt(e,"EEEEEE",t)}(e,t)}),jt(Ct(i),"decreaseYear",function(){i.setState(function(e){var t=e.date;return{date:Te.default(t,i.props.showYearPicker?i.props.yearItemNumber:1)}},function(){return i.handleYearChange(i.state.date)})}),jt(Ct(i),"clearSelectingDate",function(){i.setState({selectingDate:null})}),jt(Ct(i),"renderPreviousButton",function(){if(!i.props.renderCustomHeader){var e;switch(!0){case i.props.showMonthYearPicker:e=vn(i.state.date,i.props);break;case i.props.showYearPicker:e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,i=t.yearItemNumber,r=void 0===i?Lt:i,s=Tn(Wt(Te.default(e,r)),r).endPeriod,a=n&&Le.default(n);return a&&a>s||!1}(i.state.date,i.props);break;default:e=xn(i.state.date,i.props)}if((i.props.forceShowMonthNavigation||i.props.showDisabledMonthNavigation||!e)&&!i.props.showTimeSelectOnly){var t=["react-datepicker__navigation","react-datepicker__navigation--previous"],n=i.decreaseMonth;(i.props.showMonthYearPicker||i.props.showQuarterYearPicker||i.props.showYearPicker)&&(n=i.decreaseYear),e&&i.props.showDisabledMonthNavigation&&(t.push("react-datepicker__navigation--previous--disabled"),n=null);var r=i.props.showMonthYearPicker||i.props.showQuarterYearPicker||i.props.showYearPicker,s=i.props,a=s.previousMonthButtonLabel,o=s.previousYearButtonLabel,l=i.props,c=l.previousMonthAriaLabel,d=void 0===c?"string"==typeof a?a:"Previous Month":c,u=l.previousYearAriaLabel,h=void 0===u?"string"==typeof o?o:"Previous Year":u;return ue.default.createElement("button",{type:"button",className:t.join(" "),onClick:n,onKeyDown:i.props.handleOnKeyDown,"aria-label":r?h:d},ue.default.createElement("span",{className:["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"].join(" ")},r?i.props.previousYearButtonLabel:i.props.previousMonthButtonLabel))}}}),jt(Ct(i),"increaseYear",function(){i.setState(function(e){var t=e.date;return{date:we.default(t,i.props.showYearPicker?i.props.yearItemNumber:1)}},function(){return i.handleYearChange(i.state.date)})}),jt(Ct(i),"renderNextButton",function(){if(!i.props.renderCustomHeader){var e;switch(!0){case i.props.showMonthYearPicker:e=_n(i.state.date,i.props);break;case i.props.showYearPicker:e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.maxDate,i=t.yearItemNumber,r=void 0===i?Lt:i,s=Tn(we.default(e,r),r).startPeriod,a=n&&Le.default(n);return a&&a<s||!1}(i.state.date,i.props);break;default:e=yn(i.state.date,i.props)}if((i.props.forceShowMonthNavigation||i.props.showDisabledMonthNavigation||!e)&&!i.props.showTimeSelectOnly){var t=["react-datepicker__navigation","react-datepicker__navigation--next"];i.props.showTimeSelect&&t.push("react-datepicker__navigation--next--with-time"),i.props.todayButton&&t.push("react-datepicker__navigation--next--with-today-button");var n=i.increaseMonth;(i.props.showMonthYearPicker||i.props.showQuarterYearPicker||i.props.showYearPicker)&&(n=i.increaseYear),e&&i.props.showDisabledMonthNavigation&&(t.push("react-datepicker__navigation--next--disabled"),n=null);var r=i.props.showMonthYearPicker||i.props.showQuarterYearPicker||i.props.showYearPicker,s=i.props,a=s.nextMonthButtonLabel,o=s.nextYearButtonLabel,l=i.props,c=l.nextMonthAriaLabel,d=void 0===c?"string"==typeof a?a:"Next Month":c,u=l.nextYearAriaLabel,h=void 0===u?"string"==typeof o?o:"Next Year":u;return ue.default.createElement("button",{type:"button",className:t.join(" "),onClick:n,onKeyDown:i.props.handleOnKeyDown,"aria-label":r?h:d},ue.default.createElement("span",{className:["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"].join(" ")},r?i.props.nextYearButtonLabel:i.props.nextMonthButtonLabel))}}}),jt(Ct(i),"renderCurrentMonth",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.state.date,t=["react-datepicker__current-month"];return i.props.showYearDropdown&&t.push("react-datepicker__current-month--hasYearDropdown"),i.props.showMonthDropdown&&t.push("react-datepicker__current-month--hasMonthDropdown"),i.props.showMonthYearDropdown&&t.push("react-datepicker__current-month--hasMonthYearDropdown"),ue.default.createElement("div",{className:t.join(" ")},Bt(e,i.props.dateFormat,i.props.locale))}),jt(Ct(i),"renderYearDropdown",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(i.props.showYearDropdown&&!e)return ue.default.createElement(Dn,{adjustDateOnChange:i.props.adjustDateOnChange,date:i.state.date,onSelect:i.props.onSelect,setOpen:i.props.setOpen,dropdownMode:i.props.dropdownMode,onChange:i.changeYear,minDate:i.props.minDate,maxDate:i.props.maxDate,year:Le.default(i.state.date),scrollableYearDropdown:i.props.scrollableYearDropdown,yearDropdownItemNumber:i.props.yearDropdownItemNumber})}),jt(Ct(i),"renderMonthDropdown",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(i.props.showMonthDropdown&&!e)return ue.default.createElement(Rn,{dropdownMode:i.props.dropdownMode,locale:i.props.locale,onChange:i.changeMonth,month:Pe.default(i.state.date),useShortMonthInDropdown:i.props.useShortMonthInDropdown})}),jt(Ct(i),"renderMonthYearDropdown",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(i.props.showMonthYearDropdown&&!e)return ue.default.createElement(Fn,{dropdownMode:i.props.dropdownMode,locale:i.props.locale,dateFormat:i.props.dateFormat,onChange:i.changeMonthYear,minDate:i.props.minDate,maxDate:i.props.maxDate,date:i.state.date,scrollableMonthYearDropdown:i.props.scrollableMonthYearDropdown})}),jt(Ct(i),"handleTodayButtonClick",function(e){i.props.onSelect(Yt(),e),i.props.setPreSelection&&i.props.setPreSelection(Yt())}),jt(Ct(i),"renderTodayButton",function(){if(i.props.todayButton&&!i.props.showTimeSelectOnly)return ue.default.createElement("div",{className:"react-datepicker__today-button",onClick:function(e){return i.handleTodayButtonClick(e)}},i.props.todayButton)}),jt(Ct(i),"renderDefaultHeader",function(e){var t=e.monthDate,n=e.i;return ue.default.createElement("div",{className:"react-datepicker__header ".concat(i.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},i.renderCurrentMonth(t),ue.default.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(i.props.dropdownMode),onFocus:i.handleDropdownFocus},i.renderMonthDropdown(0!==n),i.renderMonthYearDropdown(0!==n),i.renderYearDropdown(0!==n)),ue.default.createElement("div",{className:"react-datepicker__day-names"},i.header(t)))}),jt(Ct(i),"renderCustomHeader",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.monthDate,n=e.i;if(i.props.showTimeSelect&&!i.state.monthContainer||i.props.showTimeSelectOnly)return null;var r=xn(i.state.date,i.props),s=yn(i.state.date,i.props),a=vn(i.state.date,i.props),o=_n(i.state.date,i.props),l=!i.props.showMonthYearPicker&&!i.props.showQuarterYearPicker&&!i.props.showYearPicker;return ue.default.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:i.props.onDropdownFocus},i.props.renderCustomHeader(yt(yt({},i.state),{},{customHeaderCount:n,monthDate:t,changeMonth:i.changeMonth,changeYear:i.changeYear,decreaseMonth:i.decreaseMonth,increaseMonth:i.increaseMonth,decreaseYear:i.decreaseYear,increaseYear:i.increaseYear,prevMonthButtonDisabled:r,nextMonthButtonDisabled:s,prevYearButtonDisabled:a,nextYearButtonDisabled:o})),l&&ue.default.createElement("div",{className:"react-datepicker__day-names"},i.header(t)))}),jt(Ct(i),"renderYearHeader",function(){var e=i.state.date,t=i.props,n=t.showYearPicker,r=Tn(e,t.yearItemNumber),s=r.startPeriod,a=r.endPeriod;return ue.default.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},n?"".concat(s," - ").concat(a):Le.default(e))}),jt(Ct(i),"renderHeader",function(e){switch(!0){case void 0!==i.props.renderCustomHeader:return i.renderCustomHeader(e);case i.props.showMonthYearPicker||i.props.showQuarterYearPicker||i.props.showYearPicker:return i.renderYearHeader(e);default:return i.renderDefaultHeader(e)}}),jt(Ct(i),"renderMonths",function(){var e;if(!i.props.showTimeSelectOnly&&!i.props.showYearPicker){for(var t=[],n=i.props.showPreviousMonths?i.props.monthsShown-1:0,r=Se.default(i.state.date,n),s=null!==(e=i.props.monthSelectedIn)&&void 0!==e?e:n,a=0;a<i.props.monthsShown;++a){var o=a-s+n,l=_e.default(r,o),c="month-".concat(a),d=a<i.props.monthsShown-1,u=a>0;t.push(ue.default.createElement("div",{key:c,ref:function(e){i.monthContainer=e},className:"react-datepicker__month-container"},i.renderHeader({monthDate:l,i:a}),ue.default.createElement(Zn,{chooseDayAriaLabelPrefix:i.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:i.props.disabledDayAriaLabelPrefix,weekAriaLabelPrefix:i.props.weekAriaLabelPrefix,ariaLabelPrefix:i.props.monthAriaLabelPrefix,onChange:i.changeMonthYear,day:l,dayClassName:i.props.dayClassName,calendarStartDay:i.props.calendarStartDay,monthClassName:i.props.monthClassName,onDayClick:i.handleDayClick,handleOnKeyDown:i.props.handleOnDayKeyDown,onDayMouseEnter:i.handleDayMouseEnter,onMouseLeave:i.handleMonthMouseLeave,onWeekSelect:i.props.onWeekSelect,orderInDisplay:a,formatWeekNumber:i.props.formatWeekNumber,locale:i.props.locale,minDate:i.props.minDate,maxDate:i.props.maxDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,highlightDates:i.props.highlightDates,holidays:i.props.holidays,selectingDate:i.state.selectingDate,includeDates:i.props.includeDates,includeDateIntervals:i.props.includeDateIntervals,inline:i.props.inline,shouldFocusDayInline:i.props.shouldFocusDayInline,fixedHeight:i.props.fixedHeight,filterDate:i.props.filterDate,preSelection:i.props.preSelection,setPreSelection:i.props.setPreSelection,selected:i.props.selected,selectsStart:i.props.selectsStart,selectsEnd:i.props.selectsEnd,selectsRange:i.props.selectsRange,selectsDisabledDaysInRange:i.props.selectsDisabledDaysInRange,showWeekNumbers:i.props.showWeekNumbers,startDate:i.props.startDate,endDate:i.props.endDate,peekNextMonth:i.props.peekNextMonth,setOpen:i.props.setOpen,shouldCloseOnSelect:i.props.shouldCloseOnSelect,renderDayContents:i.props.renderDayContents,renderMonthContent:i.props.renderMonthContent,renderQuarterContent:i.props.renderQuarterContent,renderYearContent:i.props.renderYearContent,disabledKeyboardNavigation:i.props.disabledKeyboardNavigation,showMonthYearPicker:i.props.showMonthYearPicker,showFullMonthYearPicker:i.props.showFullMonthYearPicker,showTwoColumnMonthYearPicker:i.props.showTwoColumnMonthYearPicker,showFourColumnMonthYearPicker:i.props.showFourColumnMonthYearPicker,showYearPicker:i.props.showYearPicker,showQuarterYearPicker:i.props.showQuarterYearPicker,showWeekPicker:i.props.showWeekPicker,isInputFocused:i.props.isInputFocused,containerRef:i.containerRef,monthShowsDuplicateDaysEnd:d,monthShowsDuplicateDaysStart:u})))}return t}}),jt(Ct(i),"renderYears",function(){if(!i.props.showTimeSelectOnly)return i.props.showYearPicker?ue.default.createElement("div",{className:"react-datepicker__year--container"},i.renderHeader(),ue.default.createElement(Kn,Nt({onDayClick:i.handleDayClick,selectingDate:i.state.selectingDate,clearSelectingDate:i.clearSelectingDate,date:i.state.date},i.props,{onYearMouseEnter:i.handleYearMouseEnter,onYearMouseLeave:i.handleYearMouseLeave}))):void 0}),jt(Ct(i),"renderTimeSection",function(){if(i.props.showTimeSelect&&(i.state.monthContainer||i.props.showTimeSelectOnly))return ue.default.createElement(Xn,{selected:i.props.selected,openToDate:i.props.openToDate,onChange:i.props.onTimeChange,timeClassName:i.props.timeClassName,format:i.props.timeFormat,includeTimes:i.props.includeTimes,intervals:i.props.timeIntervals,minTime:i.props.minTime,maxTime:i.props.maxTime,excludeTimes:i.props.excludeTimes,filterTime:i.props.filterTime,timeCaption:i.props.timeCaption,todayButton:i.props.todayButton,showMonthDropdown:i.props.showMonthDropdown,showMonthYearDropdown:i.props.showMonthYearDropdown,showYearDropdown:i.props.showYearDropdown,withPortal:i.props.withPortal,monthRef:i.state.monthContainer,injectTimes:i.props.injectTimes,locale:i.props.locale,handleOnKeyDown:i.props.handleOnKeyDown,showTimeSelectOnly:i.props.showTimeSelectOnly})}),jt(Ct(i),"renderInputTimeSection",function(){var e=new Date(i.props.selected),t=Ft(e)&&Boolean(i.props.selected)?"".concat(kn(e.getHours()),":").concat(kn(e.getMinutes())):"";if(i.props.showTimeInput)return ue.default.createElement(Qn,{date:e,timeString:t,timeInputLabel:i.props.timeInputLabel,onChange:i.props.onTimeChange,customTimeInput:i.props.customTimeInput})}),jt(Ct(i),"renderAriaLiveRegion",function(){var e,t=Tn(i.state.date,i.props.yearItemNumber),n=t.startPeriod,r=t.endPeriod;return e=i.props.showYearPicker?"".concat(n," - ").concat(r):i.props.showMonthYearPicker||i.props.showQuarterYearPicker?Le.default(i.state.date):"".concat(nn(Pe.default(i.state.date),i.props.locale)," ").concat(Le.default(i.state.date)),ue.default.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},i.state.isRenderAriaLiveMessage&&e)}),jt(Ct(i),"renderChildren",function(){if(i.props.children)return ue.default.createElement("div",{className:"react-datepicker__children-container"},i.props.children)}),i.containerRef=ue.default.createRef(),i.state={date:i.getDateInView(),selectingDate:null,monthContainer:null,isRenderAriaLiveMessage:!1},i}return wt(n,[{key:"componentDidMount",value:function(){var e=this;this.props.showTimeSelect&&(this.assignMonthContainer=void e.setState({monthContainer:e.monthContainer}))}},{key:"componentDidUpdate",value:function(e){var t=this;if(!this.props.preSelection||Qt(this.props.preSelection,e.preSelection)&&this.props.monthSelectedIn===e.monthSelectedIn)this.props.openToDate&&!Qt(this.props.openToDate,e.openToDate)&&this.setState({date:this.props.openToDate});else{var n=!Xt(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},function(){return n&&t.handleCustomMonthChange(t.state.date)})}}},{key:"render",value:function(){var e=this.props.container||Jn;return ue.default.createElement("div",{style:{display:"contents"},ref:this.containerRef},ue.default.createElement(e,{className:he.default("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showPopperArrow:this.props.showPopperArrow,arrowProps:this.props.arrowProps},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren()))}}],[{key:"defaultProps",get:function(){return{onDropdownFocus:function(){},monthsShown:1,forceShowMonthNavigation:!1,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",customTimeInput:null,yearItemNumber:Lt}}}]),n}(ue.default.Component),ti=function(e){var t=e.icon,n=e.className,i=void 0===n?"":n,r=e.onClick,s="react-datepicker__calendar-icon";return ue.default.isValidElement(t)?ue.default.cloneElement(t,{className:"".concat(t.props.className||""," ").concat(s," ").concat(i),onClick:function(e){"function"==typeof t.props.onClick&&t.props.onClick(e),"function"==typeof r&&r(e)}}):"string"==typeof t?ue.default.createElement("i",{className:"".concat(s," ").concat(t," ").concat(i),"aria-hidden":"true",onClick:r}):ue.default.createElement("svg",{className:"".concat(s," ").concat(i),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:r},ue.default.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},ni=function(e){St(n,e);var t=Et(n);function n(e){var i;return _t(this,n),(i=t.call(this,e)).el=document.createElement("div"),i}return wt(n,[{key:"componentDidMount",value:function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)}},{key:"componentWillUnmount",value:function(){this.portalRoot.removeChild(this.el)}},{key:"render",value:function(){return ft.default.createPortal(this.props.children,this.el)}}]),n}(ue.default.Component),ii=function(e){return!e.disabled&&-1!==e.tabIndex},ri=function(e){St(n,e);var t=Et(n);function n(e){var i;return _t(this,n),jt(Ct(i=t.call(this,e)),"getTabChildren",function(){return Array.prototype.slice.call(i.tabLoopRef.current.querySelectorAll("[tabindex], a, button, input, select, textarea"),1,-1).filter(ii)}),jt(Ct(i),"handleFocusStart",function(){var e=i.getTabChildren();e&&e.length>1&&e[e.length-1].focus()}),jt(Ct(i),"handleFocusEnd",function(){var e=i.getTabChildren();e&&e.length>1&&e[0].focus()}),i.tabLoopRef=ue.default.createRef(),i}return wt(n,[{key:"render",value:function(){return this.props.enableTabLoop?ue.default.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},ue.default.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:"0",onFocus:this.handleFocusStart}),this.props.children,ue.default.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:"0",onFocus:this.handleFocusEnd})):this.props.children}}],[{key:"defaultProps",get:function(){return{enableTabLoop:!0}}}]),n}(ue.default.Component),si=function(e){St(n,e);var t=Et(n);function n(){return _t(this,n),t.apply(this,arguments)}return wt(n,[{key:"render",value:function(){var e,t=this.props,n=t.className,i=t.wrapperClassName,r=t.hidePopper,s=t.popperComponent,a=t.popperModifiers,o=t.popperPlacement,l=t.popperProps,c=t.targetComponent,d=t.enableTabLoop,u=t.popperOnKeyDown,h=t.portalId,p=t.portalHost;if(!r){var m=he.default("react-datepicker-popper",n);e=ue.default.createElement(le.Popper,Nt({modifiers:a,placement:o},l),function(e){var t=e.ref,n=e.style,i=e.placement,r=e.arrowProps;return ue.default.createElement(ri,{enableTabLoop:d},ue.default.createElement("div",{ref:t,style:n,className:m,"data-placement":i,onKeyDown:u},ue.default.cloneElement(s,{arrowProps:r})))})}this.props.popperContainer&&(e=ue.default.createElement(this.props.popperContainer,{},e)),h&&!r&&(e=ue.default.createElement(ni,{portalId:h,portalHost:p},e));var f=he.default("react-datepicker-wrapper",i);return ue.default.createElement(le.Manager,{className:"react-datepicker-manager"},ue.default.createElement(le.Reference,null,function(e){var t=e.ref;return ue.default.createElement("div",{ref:t,className:f},c)}),e)}}],[{key:"defaultProps",get:function(){return{hidePopper:!0,popperModifiers:[],popperProps:{},popperPlacement:"bottom-start"}}}]),n}(ue.default.Component),ai="react-datepicker-ignore-onclickoutside",oi=mt.default(ei),li="Date input not valid.",ci=function(e){St(n,e);var t=Et(n);function n(e){var i;return _t(this,n),jt(Ct(i=t.call(this,e)),"getPreSelection",function(){return i.props.openToDate?i.props.openToDate:i.props.selectsEnd&&i.props.startDate?i.props.startDate:i.props.selectsStart&&i.props.endDate?i.props.endDate:Ot()}),jt(Ct(i),"modifyHolidays",function(){var e;return null===(e=i.props.holidays)||void 0===e?void 0:e.reduce(function(e,t){var n=new Date(t.date);return me.default(n)?[].concat(At(e),[yt(yt({},t),{},{date:n})]):e},[])}),jt(Ct(i),"calcInitialState",function(){var e,t=i.getPreSelection(),n=bn(i.props),r=wn(i.props),s=n&&ct.default(t,Xe.default(n))?n:r&&lt.default(t,et.default(r))?r:t;return{open:i.props.startOpen||!1,preventFocus:!1,preSelection:null!==(e=i.props.selectsRange?i.props.startDate:i.props.selected)&&void 0!==e?e:s,highlightDates:jn(i.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1}}),jt(Ct(i),"clearPreventFocusTimeout",function(){i.preventFocusTimeout&&clearTimeout(i.preventFocusTimeout)}),jt(Ct(i),"setFocus",function(){i.input&&i.input.focus&&i.input.focus({preventScroll:!0})}),jt(Ct(i),"setBlur",function(){i.input&&i.input.blur&&i.input.blur(),i.cancelFocusInput()}),jt(Ct(i),"setOpen",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i.setState({open:e,preSelection:e&&i.state.open?i.state.preSelection:i.calcInitialState().preSelection,lastPreSelectChange:ui},function(){e||i.setState(function(e){return{focused:!!t&&e.focused}},function(){!t&&i.setBlur(),i.setState({inputValue:null})})})}),jt(Ct(i),"inputOk",function(){return pe.default(i.state.preSelection)}),jt(Ct(i),"isCalendarOpen",function(){return void 0===i.props.open?i.state.open&&!i.props.disabled&&!i.props.readOnly:i.props.open}),jt(Ct(i),"handleFocus",function(e){i.state.preventFocus||(i.props.onFocus(e),i.props.preventOpenOnFocus||i.props.readOnly||i.setOpen(!0)),i.setState({focused:!0})}),jt(Ct(i),"sendFocusBackToInput",function(){i.preventFocusTimeout&&i.clearPreventFocusTimeout(),i.setState({preventFocus:!0},function(){i.preventFocusTimeout=setTimeout(function(){i.setFocus(),i.setState({preventFocus:!1})})})}),jt(Ct(i),"cancelFocusInput",function(){clearTimeout(i.inputFocusTimeout),i.inputFocusTimeout=null}),jt(Ct(i),"deferFocusInput",function(){i.cancelFocusInput(),i.inputFocusTimeout=setTimeout(function(){return i.setFocus()},1)}),jt(Ct(i),"handleDropdownFocus",function(){i.cancelFocusInput()}),jt(Ct(i),"handleBlur",function(e){(!i.state.open||i.props.withPortal||i.props.showTimeInput)&&i.props.onBlur(e),i.setState({focused:!1})}),jt(Ct(i),"handleCalendarClickOutside",function(e){i.props.inline||i.setOpen(!1),i.props.onClickOutside(e),i.props.withPortal&&e.preventDefault()}),jt(Ct(i),"handleChange",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0];if(!i.props.onChangeRaw||(i.props.onChangeRaw.apply(Ct(i),t),"function"==typeof r.isDefaultPrevented&&!r.isDefaultPrevented())){i.setState({inputValue:r.target.value,lastPreSelectChange:di});var s,a,o,l,c,d,u,h,p=(s=r.target.value,a=i.props.dateFormat,o=i.props.locale,l=i.props.strictParsing,c=i.props.minDate,d=null,u=tn(o)||tn(en()),h=!0,Array.isArray(a)?(a.forEach(function(e){var t=ht.default(s,e,new Date,{locale:u});l&&(h=Ft(t,c)&&s===Bt(t,e,o)),Ft(t,c)&&h&&(d=t)}),d):(d=ht.default(s,a,new Date,{locale:u}),l?h=Ft(d)&&s===Bt(d,a,o):Ft(d)||(a=a.match(zt).map(function(e){var t=e[0];return"p"===t||"P"===t?u?(0,Rt[t])(e,u.formatLong):t:e}).join(""),s.length>0&&(d=ht.default(s,a.slice(0,s.length),new Date)),Ft(d)||(d=new Date(s))),Ft(d)&&h?d:null));i.props.showTimeSelectOnly&&i.props.selected&&p&&!Qt(p,i.props.selected)&&(p=gt.default(i.props.selected,{hours:Ae.default(p),minutes:Ee.default(p),seconds:Ce.default(p)})),!p&&r.target.value||(i.props.showWeekPicker&&(p=Ht(p,i.props.locale,i.props.calendarStartDay)),i.setSelected(p,r,!0))}}),jt(Ct(i),"handleSelect",function(e,t,n){if(i.props.shouldCloseOnSelect&&!i.props.showTimeSelect&&i.sendFocusBackToInput(),i.props.onChangeRaw&&i.props.onChangeRaw(t),i.props.showWeekPicker&&(e=Ht(e,i.props.locale,i.props.calendarStartDay)),i.setSelected(e,t,!1,n),i.props.showDateSelect&&i.setState({isRenderAriaLiveMessage:!0}),!i.props.shouldCloseOnSelect||i.props.showTimeSelect)i.setPreSelection(e);else if(!i.props.inline){i.props.selectsRange||i.setOpen(!1);var r=i.props,s=r.startDate,a=r.endDate;!s||a||ct.default(e,s)||i.setOpen(!1)}}),jt(Ct(i),"setSelected",function(e,t,n,r){var s=e;if(i.props.showYearPicker){if(null!==s&&un(Le.default(s),i.props))return}else if(i.props.showMonthYearPicker){if(null!==s&&on(s,i.props))return}else if(null!==s&&sn(s,i.props))return;var a=i.props,o=a.onChange,l=a.selectsRange,c=a.startDate,d=a.endDate;if(!Jt(i.props.selected,s)||i.props.allowSameDay||l)if(null!==s&&(!i.props.selected||n&&(i.props.showTimeSelect||i.props.showTimeSelectOnly||i.props.showTimeInput)||(s=Ut(s,{hour:Ae.default(i.props.selected),minute:Ee.default(i.props.selected),second:Ce.default(i.props.selected)})),i.props.inline||i.setState({preSelection:s}),i.props.focusSelectedMonth||i.setState({monthSelectedIn:r})),l){var u=c&&d;c||d?c&&!d&&(ct.default(s,c)?o([s,null],t):o([c,s],t)):o([s,null],t),u&&o([s,null],t)}else o(s,t);n||(i.props.onSelect(s,t),i.setState({inputValue:null}))}),jt(Ct(i),"setPreSelection",function(e){var t=void 0!==i.props.minDate,n=void 0!==i.props.maxDate,r=!0;if(e){i.props.showWeekPicker&&(e=Ht(e,i.props.locale,i.props.calendarStartDay));var s=Xe.default(e);if(t&&n)r=$t(e,i.props.minDate,i.props.maxDate);else if(t){var a=Xe.default(i.props.minDate);r=lt.default(e,a)||Jt(s,a)}else if(n){var o=et.default(i.props.maxDate);r=ct.default(e,o)||Jt(s,o)}}r&&i.setState({preSelection:e})}),jt(Ct(i),"toggleCalendar",function(){i.setOpen(!i.state.open)}),jt(Ct(i),"handleTimeChange",function(e){var t=i.props.selected?i.props.selected:i.getPreSelection(),n=i.props.selected?e:Ut(t,{hour:Ae.default(e),minute:Ee.default(e)});i.setState({preSelection:n}),i.props.onChange(n),i.props.shouldCloseOnSelect&&(i.sendFocusBackToInput(),i.setOpen(!1)),i.props.showTimeInput&&i.setOpen(!0),(i.props.showTimeSelectOnly||i.props.showTimeSelect)&&i.setState({isRenderAriaLiveMessage:!0}),i.setState({inputValue:null})}),jt(Ct(i),"onInputClick",function(){i.props.disabled||i.props.readOnly||i.setOpen(!0),i.props.onInputClick()}),jt(Ct(i),"onInputKeyDown",function(e){i.props.onKeyDown(e);var t=e.key;if(i.state.open||i.props.inline||i.props.preventOpenOnFocus){if(i.state.open){if("ArrowDown"===t||"ArrowUp"===t){e.preventDefault();var n=i.props.showWeekPicker&&i.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',r=i.calendar.componentNode&&i.calendar.componentNode.querySelector(n);return void(r&&r.focus({preventScroll:!0}))}var s=Ot(i.state.preSelection);"Enter"===t?(e.preventDefault(),i.inputOk()&&i.state.lastPreSelectChange===ui?(i.handleSelect(s,e),!i.props.shouldCloseOnSelect&&i.setPreSelection(s)):i.setOpen(!1)):"Escape"===t?(e.preventDefault(),i.sendFocusBackToInput(),i.setOpen(!1)):"Tab"===t&&i.setOpen(!1),i.inputOk()||i.props.onInputError({code:1,msg:li})}}else"ArrowDown"!==t&&"ArrowUp"!==t&&"Enter"!==t||i.onInputClick()}),jt(Ct(i),"onPortalKeyDown",function(e){"Escape"===e.key&&(e.preventDefault(),i.setState({preventFocus:!0},function(){i.setOpen(!1),setTimeout(function(){i.setFocus(),i.setState({preventFocus:!1})})}))}),jt(Ct(i),"onDayKeyDown",function(e){i.props.onKeyDown(e);var t=e.key,n=Ot(i.state.preSelection);if("Enter"===t)e.preventDefault(),i.handleSelect(n,e),!i.props.shouldCloseOnSelect&&i.setPreSelection(n);else if("Escape"===t)e.preventDefault(),i.setOpen(!1),i.inputOk()||i.props.onInputError({code:1,msg:li});else if(!i.props.disabledKeyboardNavigation){var r;switch(t){case"ArrowLeft":r=i.props.showWeekPicker?Ne.default(n,1):je.default(n,1);break;case"ArrowRight":r=i.props.showWeekPicker?ve.default(n,1):ye.default(n,1);break;case"ArrowUp":r=Ne.default(n,1);break;case"ArrowDown":r=ve.default(n,1);break;case"PageUp":r=Se.default(n,1);break;case"PageDown":r=_e.default(n,1);break;case"Home":r=Te.default(n,1);break;case"End":r=we.default(n,1);break;default:r=null}if(!r)return void(i.props.onInputError&&i.props.onInputError({code:1,msg:li}));if(e.preventDefault(),i.setState({lastPreSelectChange:ui}),i.props.adjustDateOnChange&&i.setSelected(r),i.setPreSelection(r),i.props.inline){var s=Pe.default(n),a=Pe.default(r),o=Le.default(n),l=Le.default(r);s!==a||o!==l?i.setState({shouldFocusDayInline:!0}):i.setState({shouldFocusDayInline:!1})}}}),jt(Ct(i),"onPopperKeyDown",function(e){"Escape"===e.key&&(e.preventDefault(),i.sendFocusBackToInput())}),jt(Ct(i),"onClearClick",function(e){e&&e.preventDefault&&e.preventDefault(),i.sendFocusBackToInput(),i.props.selectsRange?i.props.onChange([null,null],e):i.props.onChange(null,e),i.setState({inputValue:null})}),jt(Ct(i),"clear",function(){i.onClearClick()}),jt(Ct(i),"onScroll",function(e){"boolean"==typeof i.props.closeOnScroll&&i.props.closeOnScroll?e.target!==document&&e.target!==document.documentElement&&e.target!==document.body||i.setOpen(!1):"function"==typeof i.props.closeOnScroll&&i.props.closeOnScroll(e)&&i.setOpen(!1)}),jt(Ct(i),"renderCalendar",function(){return i.props.inline||i.isCalendarOpen()?ue.default.createElement(oi,{ref:function(e){i.calendar=e},locale:i.props.locale,calendarStartDay:i.props.calendarStartDay,chooseDayAriaLabelPrefix:i.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:i.props.disabledDayAriaLabelPrefix,weekAriaLabelPrefix:i.props.weekAriaLabelPrefix,monthAriaLabelPrefix:i.props.monthAriaLabelPrefix,adjustDateOnChange:i.props.adjustDateOnChange,setOpen:i.setOpen,shouldCloseOnSelect:i.props.shouldCloseOnSelect,dateFormat:i.props.dateFormatCalendar,useWeekdaysShort:i.props.useWeekdaysShort,formatWeekDay:i.props.formatWeekDay,dropdownMode:i.props.dropdownMode,selected:i.props.selected,preSelection:i.state.preSelection,onSelect:i.handleSelect,onWeekSelect:i.props.onWeekSelect,openToDate:i.props.openToDate,minDate:i.props.minDate,maxDate:i.props.maxDate,selectsStart:i.props.selectsStart,selectsEnd:i.props.selectsEnd,selectsRange:i.props.selectsRange,startDate:i.props.startDate,endDate:i.props.endDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,filterDate:i.props.filterDate,onClickOutside:i.handleCalendarClickOutside,formatWeekNumber:i.props.formatWeekNumber,highlightDates:i.state.highlightDates,holidays:Nn(i.modifyHolidays()),includeDates:i.props.includeDates,includeDateIntervals:i.props.includeDateIntervals,includeTimes:i.props.includeTimes,injectTimes:i.props.injectTimes,inline:i.props.inline,shouldFocusDayInline:i.state.shouldFocusDayInline,peekNextMonth:i.props.peekNextMonth,showMonthDropdown:i.props.showMonthDropdown,showPreviousMonths:i.props.showPreviousMonths,useShortMonthInDropdown:i.props.useShortMonthInDropdown,showMonthYearDropdown:i.props.showMonthYearDropdown,showWeekNumbers:i.props.showWeekNumbers,showYearDropdown:i.props.showYearDropdown,withPortal:i.props.withPortal,forceShowMonthNavigation:i.props.forceShowMonthNavigation,showDisabledMonthNavigation:i.props.showDisabledMonthNavigation,scrollableYearDropdown:i.props.scrollableYearDropdown,scrollableMonthYearDropdown:i.props.scrollableMonthYearDropdown,todayButton:i.props.todayButton,weekLabel:i.props.weekLabel,outsideClickIgnoreClass:ai,fixedHeight:i.props.fixedHeight,monthsShown:i.props.monthsShown,monthSelectedIn:i.state.monthSelectedIn,onDropdownFocus:i.handleDropdownFocus,onMonthChange:i.props.onMonthChange,onYearChange:i.props.onYearChange,dayClassName:i.props.dayClassName,weekDayClassName:i.props.weekDayClassName,monthClassName:i.props.monthClassName,timeClassName:i.props.timeClassName,showDateSelect:i.props.showDateSelect,showTimeSelect:i.props.showTimeSelect,showTimeSelectOnly:i.props.showTimeSelectOnly,onTimeChange:i.handleTimeChange,timeFormat:i.props.timeFormat,timeIntervals:i.props.timeIntervals,minTime:i.props.minTime,maxTime:i.props.maxTime,excludeTimes:i.props.excludeTimes,filterTime:i.props.filterTime,timeCaption:i.props.timeCaption,className:i.props.calendarClassName,container:i.props.calendarContainer,yearItemNumber:i.props.yearItemNumber,yearDropdownItemNumber:i.props.yearDropdownItemNumber,previousMonthAriaLabel:i.props.previousMonthAriaLabel,previousMonthButtonLabel:i.props.previousMonthButtonLabel,nextMonthAriaLabel:i.props.nextMonthAriaLabel,nextMonthButtonLabel:i.props.nextMonthButtonLabel,previousYearAriaLabel:i.props.previousYearAriaLabel,previousYearButtonLabel:i.props.previousYearButtonLabel,nextYearAriaLabel:i.props.nextYearAriaLabel,nextYearButtonLabel:i.props.nextYearButtonLabel,timeInputLabel:i.props.timeInputLabel,disabledKeyboardNavigation:i.props.disabledKeyboardNavigation,renderCustomHeader:i.props.renderCustomHeader,popperProps:i.props.popperProps,renderDayContents:i.props.renderDayContents,renderMonthContent:i.props.renderMonthContent,renderQuarterContent:i.props.renderQuarterContent,renderYearContent:i.props.renderYearContent,onDayMouseEnter:i.props.onDayMouseEnter,onMonthMouseLeave:i.props.onMonthMouseLeave,onYearMouseEnter:i.props.onYearMouseEnter,onYearMouseLeave:i.props.onYearMouseLeave,selectsDisabledDaysInRange:i.props.selectsDisabledDaysInRange,showTimeInput:i.props.showTimeInput,showMonthYearPicker:i.props.showMonthYearPicker,showFullMonthYearPicker:i.props.showFullMonthYearPicker,showTwoColumnMonthYearPicker:i.props.showTwoColumnMonthYearPicker,showFourColumnMonthYearPicker:i.props.showFourColumnMonthYearPicker,showYearPicker:i.props.showYearPicker,showQuarterYearPicker:i.props.showQuarterYearPicker,showWeekPicker:i.props.showWeekPicker,showPopperArrow:i.props.showPopperArrow,excludeScrollbar:i.props.excludeScrollbar,handleOnKeyDown:i.props.onKeyDown,handleOnDayKeyDown:i.onDayKeyDown,isInputFocused:i.state.focused,customTimeInput:i.props.customTimeInput,setPreSelection:i.setPreSelection},i.props.children):null}),jt(Ct(i),"renderAriaLiveRegion",function(){var e,t=i.props,n=t.dateFormat,r=t.locale,s=i.props.showTimeInput||i.props.showTimeSelect?"PPPPp":"PPPP";return e=i.props.selectsRange?"Selected start date: ".concat(Vt(i.props.startDate,{dateFormat:s,locale:r}),". ").concat(i.props.endDate?"End date: "+Vt(i.props.endDate,{dateFormat:s,locale:r}):""):i.props.showTimeSelectOnly?"Selected time: ".concat(Vt(i.props.selected,{dateFormat:n,locale:r})):i.props.showYearPicker?"Selected year: ".concat(Vt(i.props.selected,{dateFormat:"yyyy",locale:r})):i.props.showMonthYearPicker?"Selected month: ".concat(Vt(i.props.selected,{dateFormat:"MMMM yyyy",locale:r})):i.props.showQuarterYearPicker?"Selected quarter: ".concat(Vt(i.props.selected,{dateFormat:"yyyy, QQQ",locale:r})):"Selected date: ".concat(Vt(i.props.selected,{dateFormat:s,locale:r})),ue.default.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},e)}),jt(Ct(i),"renderDateInput",function(){var e,t=he.default(i.props.className,jt({},ai,i.state.open)),n=i.props.customInput||ue.default.createElement("input",{type:"text"}),r=i.props.customInputRef||"ref",s="string"==typeof i.props.value?i.props.value:"string"==typeof i.state.inputValue?i.state.inputValue:i.props.selectsRange?function(e,t,n){if(!e)return"";var i=Vt(e,n),r=t?Vt(t,n):"";return"".concat(i," - ").concat(r)}(i.props.startDate,i.props.endDate,i.props):Vt(i.props.selected,i.props);return ue.default.cloneElement(n,(jt(jt(jt(jt(jt(jt(jt(jt(jt(jt(e={},r,function(e){i.input=e}),"value",s),"onBlur",i.handleBlur),"onChange",i.handleChange),"onClick",i.onInputClick),"onFocus",i.handleFocus),"onKeyDown",i.onInputKeyDown),"id",i.props.id),"name",i.props.name),"form",i.props.form),jt(jt(jt(jt(jt(jt(jt(jt(jt(jt(e,"autoFocus",i.props.autoFocus),"placeholder",i.props.placeholderText),"disabled",i.props.disabled),"autoComplete",i.props.autoComplete),"className",he.default(n.props.className,t)),"title",i.props.title),"readOnly",i.props.readOnly),"required",i.props.required),"tabIndex",i.props.tabIndex),"aria-describedby",i.props.ariaDescribedBy),jt(jt(jt(e,"aria-invalid",i.props.ariaInvalid),"aria-labelledby",i.props.ariaLabelledBy),"aria-required",i.props.ariaRequired)))}),jt(Ct(i),"renderClearButton",function(){var e=i.props,t=e.isClearable,n=e.disabled,r=e.selected,s=e.startDate,a=e.endDate,o=e.clearButtonTitle,l=e.clearButtonClassName,c=void 0===l?"":l,d=e.ariaLabelClose,u=void 0===d?"Close":d;return!t||null==r&&null==s&&null==a?null:ue.default.createElement("button",{type:"button",className:he.default("react-datepicker__close-icon",c,{"react-datepicker__close-icon--disabled":n}),disabled:n,"aria-label":u,onClick:i.onClearClick,title:o,tabIndex:-1})}),i.state=i.calcInitialState(),i.preventFocusTimeout=null,i}return wt(n,[{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.onScroll,!0)}},{key:"componentDidUpdate",value:function(e,t){var n,i;e.inline&&(n=e.selected,i=this.props.selected,n&&i?Pe.default(n)!==Pe.default(i)||Le.default(n)!==Le.default(i):n!==i)&&this.setPreSelection(this.props.selected),void 0!==this.state.monthSelectedIn&&e.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),e.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:jn(this.props.highlightDates)}),t.focused||Jt(e.selected,this.props.selected)||this.setState({inputValue:null}),t.open!==this.state.open&&(!1===t.open&&!0===this.state.open&&this.props.onCalendarOpen(),!0===t.open&&!1===this.state.open&&this.props.onCalendarClose())}},{key:"componentWillUnmount",value:function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0)}},{key:"renderInputContainer",value:function(){var e=this.props,t=e.showIcon,n=e.icon,i=e.calendarIconClassname,r=e.toggleCalendarOnIconClick,s=this.state.open;return ue.default.createElement("div",{className:"react-datepicker__input-container".concat(t?" react-datepicker__view-calendar-icon":"")},t&&ue.default.createElement(ti,Nt({icon:n,className:"".concat(i," ").concat(s&&"react-datepicker-ignore-onclickoutside")},r?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())}},{key:"render",value:function(){var e=this.renderCalendar();if(this.props.inline)return e;if(this.props.withPortal){var t=this.state.open?ue.default.createElement(ri,{enableTabLoop:this.props.enableTabLoop},ue.default.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},e)):null;return this.state.open&&this.props.portalId&&(t=ue.default.createElement(ni,{portalId:this.props.portalId,portalHost:this.props.portalHost},t)),ue.default.createElement("div",null,this.renderInputContainer(),t)}return ue.default.createElement(si,{className:this.props.popperClassName,wrapperClassName:this.props.wrapperClassName,hidePopper:!this.isCalendarOpen(),portalId:this.props.portalId,portalHost:this.props.portalHost,popperModifiers:this.props.popperModifiers,targetComponent:this.renderInputContainer(),popperContainer:this.props.popperContainer,popperComponent:e,popperPlacement:this.props.popperPlacement,popperProps:this.props.popperProps,popperOnKeyDown:this.onPopperKeyDown,enableTabLoop:this.props.enableTabLoop})}}],[{key:"defaultProps",get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",onChange:function(){},disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",onFocus:function(){},onBlur:function(){},onKeyDown:function(){},onInputClick:function(){},onSelect:function(){},onClickOutside:function(){},onMonthChange:function(){},onCalendarOpen:function(){},onCalendarClose:function(){},preventOpenOnFocus:!1,onYearChange:function(){},onInputError:function(){},monthsShown:1,readOnly:!1,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:Lt,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1}}}]),n}(ue.default.Component),di="input",ui="navigate";e.CalendarContainer=Jn,e.default=ci,e.getDefaultLocale=en,e.registerLocale=function(e,t){var n="undefined"!=typeof window?window:globalThis;n.__localeData__||(n.__localeData__={}),n.__localeData__[e]=t},e.setDefaultLocale=function(e){("undefined"!=typeof window?window:globalThis).__localeId__=e},Object.defineProperty(e,"__esModule",{value:!0})}(t,n(5043),n(5173),n(8139),n(2733),n(5541),n(9993),n(129),n(5891),n(5479),n(2325),n(6819),n(7461),n(234),n(9170),n(5410),n(3498),n(1032),n(7609),n(7872),n(7400),n(4998),n(3275),n(8667),n(7447),n(1627),n(9129),n(1210),n(8150),n(4028),n(812),n(6802),n(3778),n(1949),n(2950),n(775),n(5277),n(6740),n(3764),n(9275),n(5780),n(238),n(2128),n(4122),n(4975),n(8468),n(1555),n(6255),n(3150),n(7583),n(407),n(2431),n(2382),n(5125),n(8349),n(7278),n(9519),n(6260),n(6887),n(5093),n(2547),n(7950),n(7099),n(779))},1949:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var i=n(8355),r=n(6260),s=n(3778),a=n(3666);function o(e,t){(0,a.A)(2,arguments);var n=(0,r.default)(e),o=(0,i.A)(t)-(Math.floor(n.getMonth()/3)+1);return(0,s.default)(n,n.getMonth()+3*o)}},2026:(e,t,n)=>{"use strict";n.d(t,{Cg:()=>i,_m:()=>s,s0:()=>r});Math.pow(10,8);var i=6e4,r=36e5,s=1e3},2128:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e);return t.setDate(1),t.setHours(0,0,0,0),t}},2217:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var i=n(6260),r=n(3666),s=n(9511),a=n(8355),o=n(2239);function l(e,t){var n,l,c,d,u,h,p,m;(0,r.A)(1,arguments);var f=(0,i.default)(e),g=f.getUTCFullYear(),x=(0,o.q)(),y=(0,a.A)(null!==(n=null!==(l=null!==(c=null!==(d=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==d?d:null===t||void 0===t||null===(u=t.locale)||void 0===u||null===(h=u.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==c?c:x.firstWeekContainsDate)&&void 0!==l?l:null===(p=x.locale)||void 0===p||null===(m=p.options)||void 0===m?void 0:m.firstWeekContainsDate)&&void 0!==n?n:1);if(!(y>=1&&y<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=new Date(0);v.setUTCFullYear(g+1,0,y),v.setUTCHours(0,0,0,0);var _=(0,s.A)(v,t),b=new Date(0);b.setUTCFullYear(g,0,y),b.setUTCHours(0,0,0,0);var w=(0,s.A)(b,t);return f.getTime()>=_.getTime()?g+1:f.getTime()>=w.getTime()?g:g-1}},2239:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});var i={};function r(){return i}},2284:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}n.d(t,{A:()=>i})},2325:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(5479),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=7*(0,i.A)(t);return(0,r.default)(e,n)}},2382:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getFullYear()===s.getFullYear()}},2431:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()}},2547:(e,t,n)=>{"use strict";n.r(t),n.d(t,{IGNORE_CLASS_NAME:()=>m,default:()=>g});var i=n(5043),r=n(7950);function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t,n){return e===t||(e.correspondingElement?e.correspondingElement.classList.contains(n):e.classList.contains(n))}var l,c,d=(void 0===l&&(l=0),function(){return++l}),u={},h={},p=["touchstart","touchmove"],m="ignore-react-onclickoutside";function f(e,t){var n={};return-1!==p.indexOf(t)&&c&&(n.passive=!e.props.preventDefault),n}const g=function(e,t){var n,l,p=e.displayName||e.name||"Component";return l=n=function(n){var l,m;function g(e){var i;return(i=n.call(this,e)||this).__outsideClickHandler=function(e){if("function"!==typeof i.__clickOutsideHandlerProp){var t=i.getInstance();if("function"!==typeof t.props.handleClickOutside){if("function"!==typeof t.handleClickOutside)throw new Error("WrappedComponent: "+p+" lacks a handleClickOutside(event) function for processing outside click events.");t.handleClickOutside(e)}else t.props.handleClickOutside(e)}else i.__clickOutsideHandlerProp(e)},i.__getComponentNode=function(){var e=i.getInstance();return t&&"function"===typeof t.setClickOutsideRef?t.setClickOutsideRef()(e):"function"===typeof e.setClickOutsideRef?e.setClickOutsideRef():(0,r.findDOMNode)(e)},i.enableOnClickOutside=function(){if("undefined"!==typeof document&&!h[i._uid]){"undefined"===typeof c&&(c=function(){if("undefined"!==typeof window&&"function"===typeof window.addEventListener){var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}}),n=function(){};return window.addEventListener("testPassiveEventSupport",n,t),window.removeEventListener("testPassiveEventSupport",n,t),e}}()),h[i._uid]=!0;var e=i.props.eventTypes;e.forEach||(e=[e]),u[i._uid]=function(e){var t;null!==i.componentNode&&(i.initTimeStamp>e.timeStamp||(i.props.preventDefault&&e.preventDefault(),i.props.stopPropagation&&e.stopPropagation(),i.props.excludeScrollbar&&(t=e,document.documentElement.clientWidth<=t.clientX||document.documentElement.clientHeight<=t.clientY)||function(e,t,n){if(e===t)return!0;for(;e.parentNode||e.host;){if(e.parentNode&&o(e,t,n))return!0;e=e.parentNode||e.host}return e}(e.composed&&e.composedPath&&e.composedPath().shift()||e.target,i.componentNode,i.props.outsideClickIgnoreClass)===document&&i.__outsideClickHandler(e)))},e.forEach(function(e){document.addEventListener(e,u[i._uid],f(a(i),e))})}},i.disableOnClickOutside=function(){delete h[i._uid];var e=u[i._uid];if(e&&"undefined"!==typeof document){var t=i.props.eventTypes;t.forEach||(t=[t]),t.forEach(function(t){return document.removeEventListener(t,e,f(a(i),t))}),delete u[i._uid]}},i.getRef=function(e){return i.instanceRef=e},i._uid=d(),i.initTimeStamp=performance.now(),i}m=n,(l=g).prototype=Object.create(m.prototype),l.prototype.constructor=l,s(l,m);var x=g.prototype;return x.getInstance=function(){if(e.prototype&&!e.prototype.isReactComponent)return this;var t=this.instanceRef;return t.getInstance?t.getInstance():t},x.componentDidMount=function(){if("undefined"!==typeof document&&document.createElement){var e=this.getInstance();if(t&&"function"===typeof t.handleClickOutside&&(this.__clickOutsideHandlerProp=t.handleClickOutside(e),"function"!==typeof this.__clickOutsideHandlerProp))throw new Error("WrappedComponent: "+p+" lacks a function for processing outside click events specified by the handleClickOutside config option.");this.componentNode=this.__getComponentNode(),this.props.disableOnClickOutside||this.enableOnClickOutside()}},x.componentDidUpdate=function(){this.componentNode=this.__getComponentNode()},x.componentWillUnmount=function(){this.disableOnClickOutside()},x.render=function(){var t=this.props;t.excludeScrollbar;var n=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(t,["excludeScrollbar"]);return e.prototype&&e.prototype.isReactComponent?n.ref=this.getRef:n.wrappedRef=this.getRef,n.disableOnClickOutside=this.disableOnClickOutside,n.enableOnClickOutside=this.enableOnClickOutside,(0,i.createElement)(e,n)},g}(i.Component),n.displayName="OnClickOutside("+p+")",n.defaultProps={eventTypes:["mousedown","touchstart"],excludeScrollbar:t&&t.excludeScrollbar||!1,outsideClickIgnoreClass:m,preventDefault:!1,stopPropagation:!1},n.getClass=function(){return e.getClass?e.getClass():e},l}},2730:(e,t,n)=>{"use strict";var i=n(5043),r=n(8853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,i,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var x=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(x,y);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(x,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(x,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var _=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),k=Symbol.for("react.provider"),T=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var I=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function R(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var L,z=Object.assign;function O(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var F=!1;function B(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=i.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?O(e):""}function V(e){switch(e.tag){case 5:return O(e.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case j:return"Fragment";case w:return"Portal";case S:return"Profiler";case N:return"StrictMode";case E:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case k:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return U(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function Z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function J(e,t){Q(e,t);var n=q(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Z(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function se(e,t){var n=q(t.value),i=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=fe(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var xe=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(xe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _e=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,je=null,Ne=null;function Se(e){if(e=vr(e)){if("function"!==typeof we)throw Error(s(280));var t=e.stateNode;t&&(t=br(t),we(e.stateNode,e.type,t))}}function ke(e){je?Ne?Ne.push(e):Ne=[e]:je=e}function Te(){if(je){var e=je,t=Ne;if(Ne=je=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ce(e,t){return e(t)}function Ee(){}var Ae=!1;function Me(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ce(e,t,n)}finally{Ae=!1,(null!==je||null!==Ne)&&(Ee(),Te())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Ie=!1;if(d)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){Ie=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(de){Ie=!1}function Re(e,t,n,i,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var Le=!1,ze=null,Oe=!1,Fe=null,Be={onError:function(e){Le=!0,ze=e}};function Ve(e,t,n,i,r,s,a,o,l){Le=!1,ze=null,Re.apply(Be,arguments)}function Ue(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Ue(e)!==e)throw Error(s(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return qe(r),e;if(a===i)return qe(r),t;a=a.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=a;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,i=a;break}if(l===i){o=!0,i=r,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,i=r;break}if(l===i){o=!0,i=a,n=r;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ye=r.unstable_scheduleCallback,Ze=r.unstable_cancelCallback,Xe=r.unstable_shouldYield,Ke=r.unstable_requestPaint,Qe=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~r;0!==o?i=ut(o):0!==(s&=a)&&(i=ut(s))}else 0!==(a=n&~r)?i=ut(a):0!==s&&(i=ut(s));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var vt=0;function _t(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,jt,Nt,St,kt=!1,Tt=[],Ct=null,Et=null,At=null,Mt=new Map,Dt=new Map,It=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rt(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":Et=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Mt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Lt(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=vr(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function zt(e){var t=yr(e.target);if(null!==t){var n=Ue(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void St(e.priority,function(){jt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vr(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);_e=i,n.target.dispatchEvent(i),_e=null,t.shift()}return!0}function Ft(e,t,n){Ot(e)&&n.delete(t)}function Bt(){kt=!1,null!==Ct&&Ot(Ct)&&(Ct=null),null!==Et&&Ot(Et)&&(Et=null),null!==At&&Ot(At)&&(At=null),Mt.forEach(Ft),Dt.forEach(Ft)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,kt||(kt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Bt)))}function Ut(e){function t(t){return Vt(t,e)}if(0<Tt.length){Vt(Tt[0],e);for(var n=1;n<Tt.length;n++){var i=Tt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Ct&&Vt(Ct,e),null!==Et&&Vt(Et,e),null!==At&&Vt(At,e),Mt.forEach(t),Dt.forEach(t),n=0;n<It.length;n++)(i=It[n]).blockedOn===e&&(i.blockedOn=null);for(;0<It.length&&null===(n=It[0]).blockedOn;)zt(n),null===n.blockedOn&&It.shift()}var Ht=_.ReactCurrentBatchConfig,qt=!0;function Wt(e,t,n,i){var r=vt,s=Ht.transition;Ht.transition=null;try{vt=1,Yt(e,t,n,i)}finally{vt=r,Ht.transition=s}}function Gt(e,t,n,i){var r=vt,s=Ht.transition;Ht.transition=null;try{vt=4,Yt(e,t,n,i)}finally{vt=r,Ht.transition=s}}function Yt(e,t,n,i){if(qt){var r=Xt(e,t,n,i);if(null===r)qi(e,t,i,Zt,n),Rt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Ct=Lt(Ct,e,t,n,i,r),!0;case"dragenter":return Et=Lt(Et,e,t,n,i,r),!0;case"mouseover":return At=Lt(At,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return Mt.set(s,Lt(Mt.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Dt.set(s,Lt(Dt.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Rt(e,i),4&t&&-1<Pt.indexOf(e)){for(;null!==r;){var s=vr(r);if(null!==s&&bt(s),null===(s=Xt(e,t,n,i))&&qi(e,t,i,Zt,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else qi(e,t,i,null,n)}}var Zt=null;function Xt(e,t,n,i){if(Zt=null,null!==(e=yr(e=be(i))))if(null===(t=Ue(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Qt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,i=n.length,r="value"in Qt?Qt.value:Qt.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[s-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,i,r,s){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=sn(cn),un=z({},cn,{view:0,detail:0}),hn=sn(un),pn=z({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),mn=sn(pn),fn=sn(z({},pn,{dataTransfer:0})),gn=sn(z({},un,{relatedTarget:0})),xn=sn(z({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=z({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=sn(yn),_n=sn(z({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=jn[e])&&!!t[e]}function Sn(){return Nn}var kn=z({},un,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=sn(kn),Cn=sn(z({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),En=sn(z({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),An=sn(z({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Mn=z({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=sn(Mn),In=[9,13,27,32],Pn=d&&"CompositionEvent"in window,Rn=null;d&&"documentMode"in document&&(Rn=document.documentMode);var Ln=d&&"TextEvent"in window&&!Rn,zn=d&&(!Pn||Rn&&8<Rn&&11>=Rn),On=String.fromCharCode(32),Fn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==In.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Un=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Wn(e,t,n,i){ke(i),0<(t=Gi(t,"onChange")).length&&(n=new dn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Gn=null,Yn=null;function Zn(e){Oi(e,0)}function Xn(e){if(Y(_r(e)))return e}function Kn(e,t){if("change"===e)return t}var Qn=!1;if(d){var Jn;if(d){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}Jn=$n}else Jn=!1;Qn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Gn&&(Gn.detachEvent("onpropertychange",ni),Yn=Gn=null)}function ni(e){if("value"===e.propertyName&&Xn(Yn)){var t=[];Wn(t,Yn,e,be(e)),Me(Zn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Yn=n,(Gn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Yn)}function si(e,t){if("click"===e)return Xn(t)}function ai(e,t){if("input"===e||"change"===e)return Xn(t)}var oi="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(oi(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!u.call(t,r)||!oi(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function ui(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ui(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=Z((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ui(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!e.extend&&s>i&&(r=i,i=s,s=r),r=di(n,s);var a=di(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fi=d&&"documentMode"in document&&11>=document.documentMode,gi=null,xi=null,yi=null,vi=!1;function _i(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vi||null==gi||gi!==Z(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Gi(xi,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},ji={},Ni={};function Si(e){if(ji[e])return ji[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ni)return ji[e]=n[t];return e}d&&(Ni=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var ki=Si("animationend"),Ti=Si("animationiteration"),Ci=Si("animationstart"),Ei=Si("transitionend"),Ai=new Map,Mi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(e,t){Ai.set(e,t),l(t,[e])}for(var Ii=0;Ii<Mi.length;Ii++){var Pi=Mi[Ii];Di(Pi.toLowerCase(),"on"+(Pi[0].toUpperCase()+Pi.slice(1)))}Di(ki,"onAnimationEnd"),Di(Ti,"onAnimationIteration"),Di(Ci,"onAnimationStart"),Di("dblclick","onDoubleClick"),Di("focusin","onFocus"),Di("focusout","onBlur"),Di(Ei,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ri="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Li=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ri));function zi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,o,l,c){if(Ve.apply(this,arguments),Le){if(!Le)throw Error(s(198));var d=ze;Le=!1,ze=null,Oe||(Oe=!0,Fe=d)}}(i,t,void 0,e),e.currentTarget=null}function Oi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;zi(r,o,c),s=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;zi(r,o,c),s=l}}}if(Oe)throw e=Fe,Oe=!1,Fe=null,e}function Fi(e,t){var n=t[fr];void 0===n&&(n=t[fr]=new Set);var i=e+"__bubble";n.has(i)||(Hi(t,e,2,!1),n.add(i))}function Bi(e,t,n){var i=0;t&&(i|=4),Hi(n,e,i,t)}var Vi="_reactListening"+Math.random().toString(36).slice(2);function Ui(e){if(!e[Vi]){e[Vi]=!0,a.forEach(function(t){"selectionchange"!==t&&(Li.has(t)||Bi(t,!1,e),Bi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vi]||(t[Vi]=!0,Bi("selectionchange",!1,t))}}function Hi(e,t,n,i){switch(Kt(t)){case 1:var r=Wt;break;case 4:r=Gt;break;default:r=Yt}n=r.bind(null,t,n,e),r=void 0,!Ie||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function qi(e,t,n,i,r){var s=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=yr(o)))return;if(5===(l=a.tag)||6===l){i=s=a;continue e}o=o.parentNode}}i=i.return}Me(function(){var i=s,r=be(n),a=[];e:{var o=Ai.get(e);if(void 0!==o){var l=dn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Tn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=En;break;case ki:case Ti:case Ci:l=xn;break;case Ei:l=An;break;case"scroll":l=hn;break;case"wheel":l=Dn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var p,m=i;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=De(m,h))&&d.push(Wi(m,f,p)))),u)break;m=m.return}0<d.length&&(o=new l(o,c,null,n,r),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===_e||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[mr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(u=Ue(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(d=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Cn,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==l?o:_r(l),p=null==c?o:_r(c),(o=new d(f,m+"leave",l,n,r)).target=u,o.relatedTarget=p,f=null,yr(r)===i&&((d=new d(h,m+"enter",c,n,r)).target=p,d.relatedTarget=u,f=d),u=f,l&&c)e:{for(h=c,m=0,p=d=l;p;p=Yi(p))m++;for(p=0,f=h;f;f=Yi(f))p++;for(;0<m-p;)d=Yi(d),m--;for(;0<p-m;)h=Yi(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=Yi(d),h=Yi(h)}d=null}else d=null;null!==l&&Zi(a,o,l,d,!1),null!==c&&null!==u&&Zi(a,u,c,d,!0)}if("select"===(l=(o=i?_r(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Kn;else if(qn(o))if(Qn)g=ai;else{g=ri;var x=ii}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=si);switch(g&&(g=g(e,i))?Wn(a,g,n,r):(x&&x(e,o,i),"focusout"===e&&(x=o._wrapperState)&&x.controlled&&"number"===o.type&&ee(o,"number",o.value)),x=i?_r(i):window,e){case"focusin":(qn(x)||"true"===x.contentEditable)&&(gi=x,xi=i,yi=null);break;case"focusout":yi=xi=gi=null;break;case"mousedown":vi=!0;break;case"contextmenu":case"mouseup":case"dragend":vi=!1,_i(a,n,r);break;case"selectionchange":if(fi)break;case"keydown":case"keyup":_i(a,n,r)}var y;if(Pn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Un?Bn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(zn&&"ko"!==n.locale&&(Un||"onCompositionStart"!==v?"onCompositionEnd"===v&&Un&&(y=en()):(Jt="value"in(Qt=r)?Qt.value:Qt.textContent,Un=!0)),0<(x=Gi(i,v)).length&&(v=new _n(v,e,null,n,r),a.push({event:v,listeners:x}),y?v.data=y:null!==(y=Vn(n))&&(v.data=y))),(y=Ln?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Fn=!0,On);case"textInput":return(e=t.data)===On&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Un)return"compositionend"===e||!Pn&&Bn(e,t)?(e=en(),$t=Jt=Qt=null,Un=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Gi(i,"onBeforeInput")).length&&(r=new _n("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=y))}Oi(a,t)})}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=De(e,n))&&i.unshift(Wi(e,s,r)),null!=(s=De(e,t))&&i.push(Wi(e,s,r))),e=e.return}return i}function Yi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Zi(e,t,n,i,r){for(var s=t._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=De(n,s))&&a.unshift(Wi(n,l,o)):r||null!=(l=De(n,s))&&a.push(Wi(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Xi=/\r\n?/g,Ki=/\u0000|\uFFFD/g;function Qi(e){return("string"===typeof e?e:""+e).replace(Xi,"\n").replace(Ki,"")}function Ji(e,t,n){if(t=Qi(t),Qi(e)!==t&&n)throw Error(s(425))}function $i(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(or)}:ir;function or(e){setTimeout(function(){throw e})}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Ut(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Ut(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ur=Math.random().toString(36).slice(2),hr="__reactFiber$"+ur,pr="__reactProps$"+ur,mr="__reactContainer$"+ur,fr="__reactEvents$"+ur,gr="__reactListeners$"+ur,xr="__reactHandles$"+ur;function yr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=dr(e);null!==e;){if(n=e[hr])return n;e=dr(e)}return t}n=(e=n).parentNode}return null}function vr(e){return!(e=e[hr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function _r(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function br(e){return e[pr]||null}var wr=[],jr=-1;function Nr(e){return{current:e}}function Sr(e){0>jr||(e.current=wr[jr],wr[jr]=null,jr--)}function kr(e,t){jr++,wr[jr]=e.current,e.current=t}var Tr={},Cr=Nr(Tr),Er=Nr(!1),Ar=Tr;function Mr(e,t){var n=e.type.contextTypes;if(!n)return Tr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Dr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ir(){Sr(Er),Sr(Cr)}function Pr(e,t,n){if(Cr.current!==Tr)throw Error(s(168));kr(Cr,t),kr(Er,n)}function Rr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(s(108,H(e)||"Unknown",r));return z({},n,i)}function Lr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Tr,Ar=Cr.current,kr(Cr,e),kr(Er,Er.current),!0}function zr(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=Rr(e,t,Ar),i.__reactInternalMemoizedMergedChildContext=e,Sr(Er),Sr(Cr),kr(Cr,e)):Sr(Er),kr(Er,n)}var Or=null,Fr=!1,Br=!1;function Vr(e){null===Or?Or=[e]:Or.push(e)}function Ur(){if(!Br&&null!==Or){Br=!0;var e=0,t=vt;try{var n=Or;for(vt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Or=null,Fr=!1}catch(r){throw null!==Or&&(Or=Or.slice(e+1)),Ye($e,Ur),r}finally{vt=t,Br=!1}}return null}var Hr=[],qr=0,Wr=null,Gr=0,Yr=[],Zr=0,Xr=null,Kr=1,Qr="";function Jr(e,t){Hr[qr++]=Gr,Hr[qr++]=Wr,Wr=e,Gr=t}function $r(e,t,n){Yr[Zr++]=Kr,Yr[Zr++]=Qr,Yr[Zr++]=Xr,Xr=e;var i=Kr;e=Qr;var r=32-at(i)-1;i&=~(1<<r),n+=1;var s=32-at(t)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Kr=1<<32-at(t)+r|n<<r|i,Qr=s+e}else Kr=1<<s|n<<r|i,Qr=e}function es(e){null!==e.return&&(Jr(e,1),$r(e,1,0))}function ts(e){for(;e===Wr;)Wr=Hr[--qr],Hr[qr]=null,Gr=Hr[--qr],Hr[qr]=null;for(;e===Xr;)Xr=Yr[--Zr],Yr[Zr]=null,Qr=Yr[--Zr],Yr[Zr]=null,Kr=Yr[--Zr],Yr[Zr]=null}var ns=null,is=null,rs=!1,ss=null;function as(e,t){var n=Mc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function os(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,is=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,is=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xr?{id:Kr,overflow:Qr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Mc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,is=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(rs){var t=is;if(t){var n=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=cr(n.nextSibling);var i=ns;t&&os(e,t)?as(i,n):(e.flags=-4097&e.flags|2,rs=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,ns=e}}}function ds(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function us(e){if(e!==ns)return!1;if(!rs)return ds(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=is)){if(ls(e))throw hs(),Error(s(418));for(;t;)as(e,t),t=cr(t.nextSibling)}if(ds(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){is=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}is=null}}else is=ns?cr(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=is;e;)e=cr(e.nextSibling)}function ps(){is=ns=null,rs=!1}function ms(e){null===ss?ss=[e]:ss.push(e)}var fs=_.ReactCurrentBatchConfig;function gs(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function xs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ys(e){return(0,e._init)(e._payload)}function vs(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Ic(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=zc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var s=n.type;return s===j?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===D&&ys(s)===t.type)?((i=r(t,n.props)).ref=gs(e,t,n),i.return=e,i):((i=Pc(n.type,n.key,n.props,null,e.mode,i)).ref=gs(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Oc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,i,s){return null===t||7!==t.tag?((t=Rc(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Pc(t.type,t.key,t.props,null,e.mode,n)).ref=gs(e,null,t),n.return=e,n;case w:return(t=Oc(t,e.mode,n)).return=e,t;case D:return h(e,(0,t._init)(t._payload),n)}if(te(t)||R(t))return(t=Rc(t,e.mode,n,null)).return=e,t;xs(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?c(e,t,n,i):null;case w:return n.key===r?d(e,t,n,i):null;case D:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||R(n))return null!==r?null:u(e,t,n,i,null);xs(e,n)}return null}function m(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case D:return m(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||R(i))return u(t,e=e.get(n)||null,i,r,null);xs(t,i)}return null}function f(r,s,o,l){for(var c=null,d=null,u=s,f=s=0,g=null;null!==u&&f<o.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var x=p(r,u,o[f],l);if(null===x){null===u&&(u=g);break}e&&u&&null===x.alternate&&t(r,u),s=a(x,s,f),null===d?c=x:d.sibling=x,d=x,u=g}if(f===o.length)return n(r,u),rs&&Jr(r,f),c;if(null===u){for(;f<o.length;f++)null!==(u=h(r,o[f],l))&&(s=a(u,s,f),null===d?c=u:d.sibling=u,d=u);return rs&&Jr(r,f),c}for(u=i(r,u);f<o.length;f++)null!==(g=m(u,r,f,o[f],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),s=a(g,s,f),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(r,e)}),rs&&Jr(r,f),c}function g(r,o,l,c){var d=R(l);if("function"!==typeof d)throw Error(s(150));if(null==(l=d.call(l)))throw Error(s(151));for(var u=d=null,f=o,g=o=0,x=null,y=l.next();null!==f&&!y.done;g++,y=l.next()){f.index>g?(x=f,f=null):x=f.sibling;var v=p(r,f,y.value,c);if(null===v){null===f&&(f=x);break}e&&f&&null===v.alternate&&t(r,f),o=a(v,o,g),null===u?d=v:u.sibling=v,u=v,f=x}if(y.done)return n(r,f),rs&&Jr(r,g),d;if(null===f){for(;!y.done;g++,y=l.next())null!==(y=h(r,y.value,c))&&(o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return rs&&Jr(r,g),d}for(f=i(r,f);!y.done;g++,y=l.next())null!==(y=m(f,r,g,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return e&&f.forEach(function(e){return t(r,e)}),rs&&Jr(r,g),d}return function e(i,s,a,l){if("object"===typeof a&&null!==a&&a.type===j&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case b:e:{for(var c=a.key,d=s;null!==d;){if(d.key===c){if((c=a.type)===j){if(7===d.tag){n(i,d.sibling),(s=r(d,a.props.children)).return=i,i=s;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&ys(c)===d.type){n(i,d.sibling),(s=r(d,a.props)).ref=gs(i,d,a),s.return=i,i=s;break e}n(i,d);break}t(i,d),d=d.sibling}a.type===j?((s=Rc(a.props.children,i.mode,l,a.key)).return=i,i=s):((l=Pc(a.type,a.key,a.props,null,i.mode,l)).ref=gs(i,s,a),l.return=i,i=l)}return o(i);case w:e:{for(d=a.key;null!==s;){if(s.key===d){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(i,s.sibling),(s=r(s,a.children||[])).return=i,i=s;break e}n(i,s);break}t(i,s),s=s.sibling}(s=Oc(a,i.mode,l)).return=i,i=s}return o(i);case D:return e(i,s,(d=a._init)(a._payload),l)}if(te(a))return f(i,s,a,l);if(R(a))return g(i,s,a,l);xs(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,a)).return=i,i=s):(n(i,s),(s=zc(a,i.mode,l)).return=i,i=s),o(i)):n(i,s)}}var _s=vs(!0),bs=vs(!1),ws=Nr(null),js=null,Ns=null,Ss=null;function ks(){Ss=Ns=js=null}function Ts(e){var t=ws.current;Sr(ws),e._currentValue=t}function Cs(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Es(e,t){js=e,Ss=Ns=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(vo=!0),e.firstContext=null)}function As(e){var t=e._currentValue;if(Ss!==e)if(e={context:e,memoizedValue:t,next:null},null===Ns){if(null===js)throw Error(s(308));Ns=e,js.dependencies={lanes:0,firstContext:e}}else Ns=Ns.next=e;return t}var Ms=null;function Ds(e){null===Ms?Ms=[e]:Ms.push(e)}function Is(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ds(t)):(n.next=r.next,r.next=n),t.interleaved=n,Ps(e,i)}function Ps(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Rs=!1;function Ls(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Os(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fs(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Cl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Ps(e,n)}return null===(r=i.interleaved)?(t.next=t,Ds(i)):(t.next=r.next,r.next=t),i.interleaved=t,Ps(e,n)}function Bs(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Vs(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Us(e,t,n,i){var r=e.updateQueue;Rs=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(null!==s){var u=r.baseState;for(a=0,d=c=l=null,o=s;;){var h=o.lane,p=o.eventTime;if((i&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,f=o;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=z({},u,h);break e;case 2:Rs=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=p,l=u):d=d.next=p,a|=h;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(h=o).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===d&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Ll|=a,e.lanes=a,e.memoizedState=u}}function Hs(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(s(191,r));r.call(i)}}}var qs={},Ws=Nr(qs),Gs=Nr(qs),Ys=Nr(qs);function Zs(e){if(e===qs)throw Error(s(174));return e}function Xs(e,t){switch(kr(Ys,t),kr(Gs,e),kr(Ws,qs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Sr(Ws),kr(Ws,t)}function Ks(){Sr(Ws),Sr(Gs),Sr(Ys)}function Qs(e){Zs(Ys.current);var t=Zs(Ws.current),n=le(t,e.type);t!==n&&(kr(Gs,e),kr(Ws,n))}function Js(e){Gs.current===e&&(Sr(Ws),Sr(Gs))}var $s=Nr(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ia=_.ReactCurrentDispatcher,ra=_.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,da=!1,ua=0,ha=0;function pa(){throw Error(s(321))}function ma(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!oi(e[n],t[n]))return!1;return!0}function fa(e,t,n,i,r,a){if(sa=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ia.current=null===e||null===e.memoizedState?Ja:$a,e=n(i,r),da){a=0;do{if(da=!1,ua=0,25<=a)throw Error(s(301));a+=1,la=oa=null,t.updateQueue=null,ia.current=eo,e=n(i,r)}while(da)}if(ia.current=Qa,t=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,t)throw Error(s(300));return e}function ga(){var e=0!==ua;return ua=0,e}function xa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function va(e,t){return"function"===typeof t?t(e):t}function _a(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=oa,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=o=null,c=null,d=a;do{var u=d.lane;if((sa&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:e(i,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,o=i):c=c.next=h,aa.lanes|=u,Ll|=u}d=d.next}while(null!==d&&d!==a);null===c?o=i:c.next=l,oi(i,t.memoizedState)||(vo=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,aa.lanes|=a,Ll|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ba(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);oi(a,t.memoizedState)||(vo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function wa(){}function ja(e,t){var n=aa,i=ya(),r=t(),a=!oi(i.memoizedState,r);if(a&&(i.memoizedState=r,vo=!0),i=i.queue,Ra(ka.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Aa(9,Sa.bind(null,n,i,r,t),void 0,null),null===El)throw Error(s(349));0!==(30&sa)||Na(n,t,r)}return r}function Na(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Sa(e,t,n,i){t.value=n,t.getSnapshot=i,Ta(t)&&Ca(e)}function ka(e,t,n){return n(function(){Ta(t)&&Ca(e)})}function Ta(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!oi(e,n)}catch(i){return!0}}function Ca(e){var t=Ps(e,1);null!==t&&nc(t,e,1,-1)}function Ea(e){var t=xa();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t.queue=e,e=e.dispatch=Ya.bind(null,aa,e),[t.memoizedState,e]}function Aa(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ma(){return ya().memoizedState}function Da(e,t,n,i){var r=xa();aa.flags|=e,r.memoizedState=Aa(1|t,n,void 0,void 0===i?null:i)}function Ia(e,t,n,i){var r=ya();i=void 0===i?null:i;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==i&&ma(i,a.deps))return void(r.memoizedState=Aa(t,n,s,i))}aa.flags|=e,r.memoizedState=Aa(1|t,n,s,i)}function Pa(e,t){return Da(8390656,8,e,t)}function Ra(e,t){return Ia(2048,8,e,t)}function La(e,t){return Ia(4,2,e,t)}function za(e,t){return Ia(4,4,e,t)}function Oa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Fa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ia(4,4,Oa.bind(null,t,e),n)}function Ba(){}function Va(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ma(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ua(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ma(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ha(e,t,n){return 0===(21&sa)?(e.baseState&&(e.baseState=!1,vo=!0),e.memoizedState=n):(oi(n,t)||(n=ft(),aa.lanes|=n,Ll|=n,e.baseState=!0),t)}function qa(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var i=ra.transition;ra.transition={};try{e(!1),t()}finally{vt=n,ra.transition=i}}function Wa(){return ya().memoizedState}function Ga(e,t,n){var i=tc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Za(e))Xa(t,n);else if(null!==(n=Is(e,t,n,i))){nc(n,e,i,ec()),Ka(n,t,i)}}function Ya(e,t,n){var i=tc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Za(e))Xa(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(r.hasEagerState=!0,r.eagerState=o,oi(o,a)){var l=t.interleaved;return null===l?(r.next=r,Ds(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Is(e,t,r,i))&&(nc(n,e,i,r=ec()),Ka(n,t,i))}}function Za(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Xa(e,t){da=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ka(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Qa={readContext:As,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},Ja={readContext:As,useCallback:function(e,t){return xa().memoizedState=[e,void 0===t?null:t],e},useContext:As,useEffect:Pa,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Da(4194308,4,Oa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Da(4194308,4,e,t)},useInsertionEffect:function(e,t){return Da(4,2,e,t)},useMemo:function(e,t){var n=xa();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=xa();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ga.bind(null,aa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},xa().memoizedState=e},useState:Ea,useDebugValue:Ba,useDeferredValue:function(e){return xa().memoizedState=e},useTransition:function(){var e=Ea(!1),t=e[0];return e=qa.bind(null,e[1]),xa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=aa,r=xa();if(rs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===El)throw Error(s(349));0!==(30&sa)||Na(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Pa(ka.bind(null,i,a,e),[e]),i.flags|=2048,Aa(9,Sa.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=xa(),t=El.identifierPrefix;if(rs){var n=Qr;t=":"+t+"R"+(n=(Kr&~(1<<32-at(Kr)-1)).toString(32)+n),0<(n=ua++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$a={readContext:As,useCallback:Va,useContext:As,useEffect:Ra,useImperativeHandle:Fa,useInsertionEffect:La,useLayoutEffect:za,useMemo:Ua,useReducer:_a,useRef:Ma,useState:function(){return _a(va)},useDebugValue:Ba,useDeferredValue:function(e){return Ha(ya(),oa.memoizedState,e)},useTransition:function(){return[_a(va)[0],ya().memoizedState]},useMutableSource:wa,useSyncExternalStore:ja,useId:Wa,unstable_isNewReconciler:!1},eo={readContext:As,useCallback:Va,useContext:As,useEffect:Ra,useImperativeHandle:Fa,useInsertionEffect:La,useLayoutEffect:za,useMemo:Ua,useReducer:ba,useRef:Ma,useState:function(){return ba(va)},useDebugValue:Ba,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:Ha(t,oa.memoizedState,e)},useTransition:function(){return[ba(va)[0],ya().memoizedState]},useMutableSource:wa,useSyncExternalStore:ja,useId:Wa,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var io={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),s=Os(i,r);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Fs(e,s,r))&&(nc(t,e,r,i),Bs(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),s=Os(i,r);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Fs(e,s,r))&&(nc(t,e,r,i),Bs(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),i=tc(e),r=Os(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Fs(e,r,i))&&(nc(t,e,i,n),Bs(t,e,i))}};function ro(e,t,n,i,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,s))}function so(e,t,n){var i=!1,r=Tr,s=t.contextType;return"object"===typeof s&&null!==s?s=As(s):(r=Dr(t)?Ar:Cr.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?Mr(e,r):Tr),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=io,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function ao(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&io.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Ls(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=As(s):(s=Dr(t)?Ar:Cr.current,r.context=Mr(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(no(e,t,s,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&io.enqueueReplaceState(r,r.state,null),Us(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",i=t;do{n+=V(i),i=i.return}while(i);var r=n}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function po(e,t,n){(n=Os(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){ql||(ql=!0,Wl=i),uo(0,t)},n}function mo(e,t,n){(n=Os(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){uo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof i&&(null===Gl?Gl=new Set([this]):Gl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fo(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ho;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Sc.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function xo(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Os(-1,1)).tag=2,Fs(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var yo=_.ReactCurrentOwner,vo=!1;function _o(e,t,n,i){t.child=null===e?bs(t,null,n,i):_s(t,e.child,n,i)}function bo(e,t,n,i,r){n=n.render;var s=t.ref;return Es(t,r),i=fa(e,t,n,i,s,r),n=ga(),null===e||vo?(rs&&n&&es(t),t.flags|=1,_o(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qo(e,t,r))}function wo(e,t,n,i,r){if(null===e){var s=n.type;return"function"!==typeof s||Dc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Pc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,jo(e,t,s,i,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return qo(e,t,r)}return t.flags|=1,(e=Ic(s,i)).ref=t.ref,e.return=t,t.child=e}function jo(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(li(s,i)&&e.ref===t.ref){if(vo=!1,t.pendingProps=i=s,0===(e.lanes&r))return t.lanes=e.lanes,qo(e,t,r);0!==(131072&e.flags)&&(vo=!0)}}return ko(e,t,n,i,r)}function No(e,t,n){var i=t.pendingProps,r=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},kr(Il,Dl),Dl|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,kr(Il,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,kr(Il,Dl),Dl|=i}else null!==s?(i=s.baseLanes|n,t.memoizedState=null):i=n,kr(Il,Dl),Dl|=i;return _o(e,t,r,n),t.child}function So(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function ko(e,t,n,i,r){var s=Dr(n)?Ar:Cr.current;return s=Mr(t,s),Es(t,r),n=fa(e,t,n,i,s,r),i=ga(),null===e||vo?(rs&&i&&es(t),t.flags|=1,_o(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qo(e,t,r))}function To(e,t,n,i,r){if(Dr(n)){var s=!0;Lr(t)}else s=!1;if(Es(t,r),null===t.stateNode)Ho(e,t),so(t,n,i),oo(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=As(c):c=Mr(t,c=Dr(n)?Ar:Cr.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||l!==c)&&ao(t,a,i,c),Rs=!1;var h=t.memoizedState;a.state=h,Us(t,i,a,r),l=t.memoizedState,o!==i||h!==l||Er.current||Rs?("function"===typeof d&&(no(t,n,d,i),l=t.memoizedState),(o=Rs||ro(t,n,o,i,h,l,c))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,zs(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,u=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=As(l):l=Mr(t,l=Dr(n)?Ar:Cr.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==l)&&ao(t,a,i,l),Rs=!1,h=t.memoizedState,a.state=h,Us(t,i,a,r);var m=t.memoizedState;o!==u||h!==m||Er.current||Rs?("function"===typeof p&&(no(t,n,p,i),m=t.memoizedState),(c=Rs||ro(t,n,c,i,h,m,l)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,m,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,m,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),a.props=i,a.state=m,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Co(e,t,n,i,s,r)}function Co(e,t,n,i,r,s){So(e,t);var a=0!==(128&t.flags);if(!i&&!a)return r&&zr(t,n,!1),qo(e,t,s);i=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=_s(t,e.child,null,s),t.child=_s(t,null,o,s)):_o(e,t,o,s),t.memoizedState=i.state,r&&zr(t,n,!0),t.child}function Eo(e){var t=e.stateNode;t.pendingContext?Pr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pr(0,t.context,!1),Xs(e,t.containerInfo)}function Ao(e,t,n,i,r){return ps(),ms(r),t.flags|=256,_o(e,t,n,i),t.child}var Mo,Do,Io,Po,Ro={dehydrated:null,treeContext:null,retryLane:0};function Lo(e){return{baseLanes:e,cachePool:null,transitions:null}}function zo(e,t,n){var i,r=t.pendingProps,a=$s.current,o=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),kr($s,1&a),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Lc(l,r,0,null),e=Rc(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Lo(n),t.memoizedState=Ro,e):Oo(t,l));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,o){if(n)return 256&t.flags?(t.flags&=-257,Fo(e,t,o,i=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Lc({mode:"visible",children:i.children},r,0,null),(a=Rc(a,r,o,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&_s(t,e.child,null,o),t.child.memoizedState=Lo(o),t.memoizedState=Ro,a);if(0===(1&t.mode))return Fo(e,t,o,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Fo(e,t,o,i=co(a=Error(s(419)),i,void 0))}if(l=0!==(o&e.childLanes),vo||l){if(null!==(i=El)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Ps(e,r),nc(i,e,r,-1))}return fc(),Fo(e,t,o,i=co(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Tc.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,is=cr(r.nextSibling),ns=t,rs=!0,ss=null,null!==e&&(Yr[Zr++]=Kr,Yr[Zr++]=Qr,Yr[Zr++]=Xr,Kr=e.id,Qr=e.overflow,Xr=t),t=Oo(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,a,n);if(o){o=r.fallback,l=t.mode,i=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Ic(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==i?o=Ic(i,o):(o=Rc(o,l,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?Lo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Ro,r}return e=(o=e.child).sibling,r=Ic(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Oo(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fo(e,t,n,i){return null!==i&&ms(i),_s(t,e.child,null,n),(e=Oo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bo(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Cs(e.return,t,n)}function Vo(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Uo(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(_o(e,t,i.children,n),0!==(2&(i=$s.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bo(e,n,t);else if(19===e.tag)Bo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(kr($s,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Vo(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ea(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Vo(t,!0,n,null,s);break;case"together":Vo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ll|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Ic(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ic(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wo(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Go(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Yo(e,t,n){var i=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Go(t),null;case 1:case 17:return Dr(t.type)&&Ir(),Go(t),null;case 3:return i=t.stateNode,Ks(),Sr(Er),Sr(Cr),na(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(us(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Do(e,t),Go(t),null;case 5:Js(t);var r=Zs(Ys.current);if(n=t.type,null!==e&&null!=t.stateNode)Io(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return Go(t),null}if(e=Zs(Ws.current),us(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[hr]=t,i[pr]=a,e=0!==(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(r=0;r<Ri.length;r++)Fi(Ri[r],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":K(i,a),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Fi("invalid",i);break;case"textarea":re(i,a),Fi("invalid",i)}for(var l in ye(n,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fi("scroll",i)}switch(n){case"input":G(i),$(i,a,!0);break;case"textarea":G(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=$i)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[hr]=t,e[pr]=i,Mo(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),r=i;break;case"iframe":case"object":case"embed":Fi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Ri.length;r++)Fi(Ri[r],e);r=i;break;case"source":Fi("error",e),r=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),r=i;break;case"details":Fi("toggle",e),r=i;break;case"input":K(e,i),r=X(e,i),Fi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=z({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Fi("invalid",e)}for(a in ye(n,r),c=r)if(c.hasOwnProperty(a)){var d=c[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Fi("scroll",e):null!=d&&v(e,a,d,l))}switch(n){case"input":G(e),$(e,i,!1);break;case"textarea":G(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+q(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Go(t),null;case 6:if(e&&null!=t.stateNode)Po(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(n=Zs(Ys.current),Zs(Ws.current),us(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(a=i.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Go(t),null;case 13:if(Sr($s),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==is&&0!==(1&t.mode)&&0===(128&t.flags))hs(),ps(),t.flags|=98560,a=!1;else if(a=us(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[hr]=t}else ps(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Go(t),a=!1}else null!==ss&&(ac(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$s.current)?0===Pl&&(Pl=3):fc())),null!==t.updateQueue&&(t.flags|=4),Go(t),null);case 4:return Ks(),Do(e,t),null===e&&Ui(t.stateNode.containerInfo),Go(t),null;case 10:return Ts(t.type._context),Go(t),null;case 19:if(Sr($s),null===(a=t.memoizedState))return Go(t),null;if(i=0!==(128&t.flags),null===(l=a.rendering))if(i)Wo(a,!1);else{if(0!==Pl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Wo(a,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return kr($s,1&$s.current|2),t.child}e=e.sibling}null!==a.tail&&Qe()>Ul&&(t.flags|=128,i=!0,Wo(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ea(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!rs)return Go(t),null}else 2*Qe()-a.renderingStartTime>Ul&&1073741824!==n&&(t.flags|=128,i=!0,Wo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Qe(),t.sibling=null,n=$s.current,kr($s,i?1&n|2:1&n),t):(Go(t),null);case 22:case 23:return uc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(Go(t),6&t.subtreeFlags&&(t.flags|=8192)):Go(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Zo(e,t){switch(ts(t),t.tag){case 1:return Dr(t.type)&&Ir(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ks(),Sr(Er),Sr(Cr),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Js(t),null;case 13:if(Sr($s),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Sr($s),null;case 4:return Ks(),null;case 10:return Ts(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Mo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Do=function(){},Io=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Zs(Ws.current);var s,a=null;switch(n){case"input":r=X(e,r),i=X(e,i),a=[];break;case"select":r=z({},r,{value:void 0}),i=z({},i,{value:void 0}),a=[];break;case"textarea":r=ie(e,r),i=ie(e,i),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(d in ye(n,i),n=null,r)if(!i.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var l=r[d];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in i){var c=i[d];if(l=null!=r?r[d]:void 0,i.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(a||(a=[]),a.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Fi("scroll",e),a||l===c||(a=[])):(a=a||[]).push(d,c))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Po=function(e,t,n,i){n!==i&&(t.flags|=4)};var Xo=!1,Ko=!1,Qo="function"===typeof WeakSet?WeakSet:Set,Jo=null;function $o(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Nc(e,t,i)}else n.current=null}function el(e,t,n){try{n()}catch(i){Nc(e,t,i)}}var tl=!1;function nl(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&el(t,n,s)}r=r.next}while(r!==i)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[fr],delete t[gr],delete t[xr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var dl=null,ul=!1;function hl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,n)}catch(o){}switch(n.tag){case 5:Ko||$o(n,t);case 6:var i=dl,r=ul;dl=null,hl(e,t,n),ul=r,null!==(dl=i)&&(ul?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(ul?(e=dl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),Ut(e)):lr(dl,n.stateNode));break;case 4:i=dl,r=ul,dl=n.stateNode.containerInfo,ul=!0,hl(e,t,n),dl=i,ul=r;break;case 0:case 11:case 14:case 15:if(!Ko&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&el(n,t,a),r=r.next}while(r!==i)}hl(e,t,n);break;case 1:if(!Ko&&($o(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(o){Nc(n,t,o)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Ko=(i=Ko)||null!==n.memoizedState,hl(e,t,n),Ko=i):hl(e,t,n);break;default:hl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qo),t.forEach(function(t){var i=Cc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function fl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,ul=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===dl)throw Error(s(160));pl(a,o,r),dl=null,ul=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(d){Nc(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),xl(e),4&i){try{nl(3,e,e.return),il(3,e)}catch(g){Nc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Nc(e,e.return,g)}}break;case 1:fl(t,e),xl(e),512&i&&null!==n&&$o(n,n.return);break;case 5:if(fl(t,e),xl(e),512&i&&null!==n&&$o(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){Nc(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&Q(r,a),ve(l,o);var d=ve(l,a);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];"style"===u?ge(r,h):"dangerouslySetInnerHTML"===u?ue(r,h):"children"===u?he(r,h):v(r,u,h,d)}switch(l){case"input":J(r,a);break;case"textarea":se(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ne(r,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(g){Nc(e,e.return,g)}}break;case 6:if(fl(t,e),xl(e),4&i){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){Nc(e,e.return,g)}}break;case 3:if(fl(t,e),xl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(g){Nc(e,e.return,g)}break;case 4:default:fl(t,e),xl(e);break;case 13:fl(t,e),xl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Vl=Qe())),4&i&&ml(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Ko=(d=Ko)||u,fl(t,e),Ko=d):fl(t,e),xl(e),8192&i){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Jo=e,u=e.child;null!==u;){for(h=Jo=u;null!==Jo;){switch(m=(p=Jo).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:$o(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){i=p,n=p.return;try{t=i,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Nc(i,n,g)}}break;case 5:$o(p,p.return);break;case 22:if(null!==p.memoizedState){bl(h);continue}}null!==m?(m.return=p,Jo=m):bl(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{r=h.stateNode,d?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=fe("display",o))}catch(g){Nc(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Nc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:fl(t,e),xl(e),4&i&&ml(e);case 21:}}function xl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(s(161))}}catch(o){Nc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Jo=e,vl(e,t,n)}function vl(e,t,n){for(var i=0!==(1&e.mode);null!==Jo;){var r=Jo,s=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Xo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Ko;o=Xo;var c=Ko;if(Xo=a,(Ko=l)&&!c)for(Jo=r;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?wl(r):null!==l?(l.return=a,Jo=l):wl(r);for(;null!==s;)Jo=s,vl(s,t,n),s=s.sibling;Jo=r,Xo=o,Ko=c}_l(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,Jo=s):_l(e)}}function _l(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ko||il(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ko)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Hs(t,a,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Hs(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Ut(h)}}}break;default:throw Error(s(163))}Ko||512&t.flags&&rl(t)}catch(p){Nc(t,t.return,p)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function bl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jo=n;break}Jo=t.return}}function wl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){Nc(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Nc(t,r,l)}}var s=t.return;try{rl(t)}catch(l){Nc(t,s,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){Nc(t,a,l)}}}catch(l){Nc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var jl,Nl=Math.ceil,Sl=_.ReactCurrentDispatcher,kl=_.ReactCurrentOwner,Tl=_.ReactCurrentBatchConfig,Cl=0,El=null,Al=null,Ml=0,Dl=0,Il=Nr(0),Pl=0,Rl=null,Ll=0,zl=0,Ol=0,Fl=null,Bl=null,Vl=0,Ul=1/0,Hl=null,ql=!1,Wl=null,Gl=null,Yl=!1,Zl=null,Xl=0,Kl=0,Ql=null,Jl=-1,$l=0;function ec(){return 0!==(6&Cl)?Qe():-1!==Jl?Jl:Jl=Qe()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Cl)&&0!==Ml?Ml&-Ml:null!==fs.transition?(0===$l&&($l=ft()),$l):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function nc(e,t,n,i){if(50<Kl)throw Kl=0,Ql=null,Error(s(185));xt(e,n,i),0!==(2&Cl)&&e===El||(e===El&&(0===(2&Cl)&&(zl|=n),4===Pl&&oc(e,Ml)),ic(e,i),1===n&&0===Cl&&0===(1&t.mode)&&(Ul=Qe()+500,Fr&&Ur()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,l=r[a];-1===l?0!==(o&n)&&0===(o&i)||(r[a]=pt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var i=ht(e,e===El?Ml:0);if(0===i)null!==n&&Ze(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ze(n),1===t)0===e.tag?function(e){Fr=!0,Vr(e)}(lc.bind(null,e)):Vr(lc.bind(null,e)),ar(function(){0===(6&Cl)&&Ur()}),n=null;else{switch(_t(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Ec(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Jl=-1,$l=0,0!==(6&Cl))throw Error(s(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var i=ht(e,e===El?Ml:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gc(e,i);else{t=i;var r=Cl;Cl|=2;var a=mc();for(El===e&&Ml===t||(Hl=null,Ul=Qe()+500,hc(e,t));;)try{yc();break}catch(l){pc(e,l)}ks(),Sl.current=a,Cl=r,null!==Al?t=0:(El=null,Ml=0,t=Pl)}if(0!==t){if(2===t&&(0!==(r=mt(e))&&(i=r,t=sc(e,r))),1===t)throw n=Rl,hc(e,0),oc(e,i),ic(e,Qe()),n;if(6===t)oc(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!oi(s(),r))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,i))&&(0!==(a=mt(e))&&(i=a,t=sc(e,a))),1===t))throw n=Rl,hc(e,0),oc(e,i),ic(e,Qe()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:bc(e,Bl,Hl);break;case 3:if(oc(e,i),(130023424&i)===i&&10<(t=Vl+500-Qe())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(bc.bind(null,e,Bl,Hl),t);break}bc(e,Bl,Hl);break;case 4:if(oc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var o=31-at(i);a=1<<o,(o=t[o])>r&&(r=o),i&=~a}if(i=r,10<(i=(120>(i=Qe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Nl(i/1960))-i)){e.timeoutHandle=ir(bc.bind(null,e,Bl,Hl),i);break}bc(e,Bl,Hl);break;default:throw Error(s(329))}}}return ic(e,Qe()),e.callbackNode===n?rc.bind(null,e):null}function sc(e,t){var n=Fl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Bl,Bl=n,null!==t&&ac(t)),e}function ac(e){null===Bl?Bl=e:Bl.push.apply(Bl,e)}function oc(e,t){for(t&=~Ol,t&=~zl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function lc(e){if(0!==(6&Cl))throw Error(s(327));wc();var t=ht(e,0);if(0===(1&t))return ic(e,Qe()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var i=mt(e);0!==i&&(t=i,n=sc(e,i))}if(1===n)throw n=Rl,hc(e,0),oc(e,t),ic(e,Qe()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bc(e,Bl,Hl),ic(e,Qe()),null}function cc(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&(Ul=Qe()+500,Fr&&Ur())}}function dc(e){null!==Zl&&0===Zl.tag&&0===(6&Cl)&&wc();var t=Cl;Cl|=1;var n=Tl.transition,i=vt;try{if(Tl.transition=null,vt=1,e)return e()}finally{vt=i,Tl.transition=n,0===(6&(Cl=t))&&Ur()}}function uc(){Dl=Il.current,Sr(Il)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Al)for(n=Al.return;null!==n;){var i=n;switch(ts(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Ir();break;case 3:Ks(),Sr(Er),Sr(Cr),na();break;case 5:Js(i);break;case 4:Ks();break;case 13:case 19:Sr($s);break;case 10:Ts(i.type._context);break;case 22:case 23:uc()}n=n.return}if(El=e,Al=e=Ic(e.current,null),Ml=Dl=t,Pl=0,Rl=null,Ol=zl=Ll=0,Bl=Fl=null,null!==Ms){for(t=0;t<Ms.length;t++)if(null!==(i=(n=Ms[t]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var a=s.next;s.next=r,i.next=a}n.pending=i}Ms=null}return e}function pc(e,t){for(;;){var n=Al;try{if(ks(),ia.current=Qa,ca){for(var i=aa.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ca=!1}if(sa=0,la=oa=aa=null,da=!1,ua=0,kl.current=null,null===n||null===n.return){Pl=1,Rl=t,Al=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Ml,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=go(o);if(null!==m){m.flags&=-257,xo(m,o,l,0,t),1&m.mode&&fo(a,d,t),c=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(c),t.updateQueue=g}else f.add(c);break e}if(0===(1&t)){fo(a,d,t),fc();break e}c=Error(s(426))}else if(rs&&1&l.mode){var x=go(o);if(null!==x){0===(65536&x.flags)&&(x.flags|=256),xo(x,o,l,0,t),ms(lo(c,l));break e}}a=c=lo(c,l),4!==Pl&&(Pl=2),null===Fl?Fl=[a]:Fl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Vs(a,po(0,c,t));break e;case 1:l=c;var y=a.type,v=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Gl||!Gl.has(v)))){a.flags|=65536,t&=-t,a.lanes|=t,Vs(a,mo(a,l,t));break e}}a=a.return}while(null!==a)}_c(n)}catch(_){t=_,Al===n&&null!==n&&(Al=n=n.return);continue}break}}function mc(){var e=Sl.current;return Sl.current=Qa,null===e?Qa:e}function fc(){0!==Pl&&3!==Pl&&2!==Pl||(Pl=4),null===El||0===(268435455&Ll)&&0===(268435455&zl)||oc(El,Ml)}function gc(e,t){var n=Cl;Cl|=2;var i=mc();for(El===e&&Ml===t||(Hl=null,hc(e,t));;)try{xc();break}catch(r){pc(e,r)}if(ks(),Cl=n,Sl.current=i,null!==Al)throw Error(s(261));return El=null,Ml=0,Pl}function xc(){for(;null!==Al;)vc(Al)}function yc(){for(;null!==Al&&!Xe();)vc(Al)}function vc(e){var t=jl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?_c(e):Al=t,kl.current=null}function _c(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yo(n,t,Dl)))return void(Al=n)}else{if(null!==(n=Zo(n,t)))return n.flags&=32767,void(Al=n);if(null===e)return Pl=6,void(Al=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Al=t);Al=t=e}while(null!==t);0===Pl&&(Pl=5)}function bc(e,t,n){var i=vt,r=Tl.transition;try{Tl.transition=null,vt=1,function(e,t,n,i){do{wc()}while(null!==Zl);if(0!==(6&Cl))throw Error(s(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),s=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~s}}(e,a),e===El&&(Al=El=null,Ml=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yl||(Yl=!0,Ec(tt,function(){return wc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Tl.transition,Tl.transition=null;var o=vt;vt=1;var l=Cl;Cl|=4,kl.current=null,function(e,t){if(er=qt,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(b){n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==r&&3!==h.nodeType||(l=o+r),h!==a||0!==i&&3!==h.nodeType||(c=o+i),3===h.nodeType&&(o+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===r&&(l=o),p===a&&++u===i&&(c=o),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},qt=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,x=f.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),x);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(s(163))}}catch(b){Nc(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}f=tl,tl=!1}(e,n),gl(n,e),mi(tr),qt=!!er,tr=er=null,e.current=n,yl(n,e,r),Ke(),Cl=l,vt=o,Tl.transition=a}else e.current=n;if(Yl&&(Yl=!1,Zl=e,Xl=r),a=e.pendingLanes,0===a&&(Gl=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Qe()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ql)throw ql=!1,e=Wl,Wl=null,e;0!==(1&Xl)&&0!==e.tag&&wc(),a=e.pendingLanes,0!==(1&a)?e===Ql?Kl++:(Kl=0,Ql=e):Kl=0,Ur()}(e,t,n,i)}finally{Tl.transition=r,vt=i}return null}function wc(){if(null!==Zl){var e=_t(Xl),t=Tl.transition,n=vt;try{if(Tl.transition=null,vt=16>e?16:e,null===Zl)var i=!1;else{if(e=Zl,Zl=null,Xl=0,0!==(6&Cl))throw Error(s(331));var r=Cl;for(Cl|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(Jo=d;null!==Jo;){var u=Jo;switch(u.tag){case 0:case 11:case 15:nl(8,u,a)}var h=u.child;if(null!==h)h.return=u,Jo=h;else for(;null!==Jo;){var p=(u=Jo).sibling,m=u.return;if(sl(u),u===d){Jo=null;break}if(null!==p){p.return=m,Jo=p;break}Jo=m}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var x=g.sibling;g.sibling=null,g=x}while(null!==g)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Jo=y;break e}Jo=a.return}}var v=e.current;for(Jo=v;null!==Jo;){var _=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==_)_.return=o,Jo=_;else e:for(o=v;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(w){Nc(l,l.return,w)}if(l===o){Jo=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Jo=b;break e}Jo=l.return}}if(Cl=r,Ur(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{vt=n,Tl.transition=t}}return!1}function jc(e,t,n){e=Fs(e,t=po(0,t=lo(n,t),1),1),t=ec(),null!==e&&(xt(e,1,t),ic(e,t))}function Nc(e,t,n){if(3===e.tag)jc(e,e,n);else for(;null!==t;){if(3===t.tag){jc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Gl||!Gl.has(i))){t=Fs(t,e=mo(t,e=lo(n,e),1),1),e=ec(),null!==t&&(xt(t,1,e),ic(t,e));break}}t=t.return}}function Sc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,El===e&&(Ml&n)===n&&(4===Pl||3===Pl&&(130023424&Ml)===Ml&&500>Qe()-Vl?hc(e,0):Ol|=n),ic(e,t)}function kc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=ec();null!==(e=Ps(e,t))&&(xt(e,t,n),ic(e,n))}function Tc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),kc(e,n)}function Cc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),kc(e,n)}function Ec(e,t){return Ye(e,t)}function Ac(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mc(e,t,n,i){return new Ac(e,t,n,i)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ic(e,t){var n=e.alternate;return null===n?((n=Mc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Pc(e,t,n,i,r,a){var o=2;if(i=e,"function"===typeof e)Dc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case j:return Rc(n.children,r,a,t);case N:o=8,r|=8;break;case S:return(e=Mc(12,n,t,2|r)).elementType=S,e.lanes=a,e;case E:return(e=Mc(13,n,t,r)).elementType=E,e.lanes=a,e;case A:return(e=Mc(19,n,t,r)).elementType=A,e.lanes=a,e;case I:return Lc(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case k:o=10;break e;case T:o=9;break e;case C:o=11;break e;case M:o=14;break e;case D:o=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Mc(o,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Rc(e,t,n,i){return(e=Mc(7,e,i,t)).lanes=n,e}function Lc(e,t,n,i){return(e=Mc(22,e,i,t)).elementType=I,e.lanes=n,e.stateNode={isHidden:!1},e}function zc(e,t,n){return(e=Mc(6,e,null,t)).lanes=n,e}function Oc(e,t,n){return(t=Mc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bc(e,t,n,i,r,s,a,o,l){return e=new Fc(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Mc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ls(s),e}function Vc(e){if(!e)return Tr;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Dr(n))return Rr(e,n,t)}return t}function Uc(e,t,n,i,r,s,a,o,l){return(e=Bc(n,i,!0,e,0,s,0,o,l)).context=Vc(null),n=e.current,(s=Os(i=ec(),r=tc(n))).callback=void 0!==t&&null!==t?t:null,Fs(n,s,r),e.current.lanes=r,xt(e,r,i),ic(e,i),e}function Hc(e,t,n,i){var r=t.current,s=ec(),a=tc(r);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Os(s,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Fs(r,t,a))&&(nc(e,r,a,s),Bs(e,r,a)),a}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}jl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Er.current)vo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return vo=!1,function(e,t,n){switch(t.tag){case 3:Eo(t),ps();break;case 5:Qs(t);break;case 1:Dr(t.type)&&Lr(t);break;case 4:Xs(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;kr(ws,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(kr($s,1&$s.current),t.flags|=128,null):0!==(n&t.child.childLanes)?zo(e,t,n):(kr($s,1&$s.current),null!==(e=qo(e,t,n))?e.sibling:null);kr($s,1&$s.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Uo(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),kr($s,$s.current),i)break;return null;case 22:case 23:return t.lanes=0,No(e,t,n)}return qo(e,t,n)}(e,t,n);vo=0!==(131072&e.flags)}else vo=!1,rs&&0!==(1048576&t.flags)&&$r(t,Gr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ho(e,t),e=t.pendingProps;var r=Mr(t,Cr.current);Es(t,n),r=fa(null,t,i,e,r,n);var a=ga();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dr(i)?(a=!0,Lr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ls(t),r.updater=io,t.stateNode=r,r._reactInternals=t,oo(t,i,e,n),t=Co(null,t,i,!0,a,n)):(t.tag=0,rs&&a&&es(t),_o(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===M)return 14}return 2}(i),e=to(i,e),r){case 0:t=ko(null,t,i,e,n);break e;case 1:t=To(null,t,i,e,n);break e;case 11:t=bo(null,t,i,e,n);break e;case 14:t=wo(null,t,i,to(i.type,e),n);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,ko(e,t,i,r=t.elementType===i?r:to(i,r),n);case 1:return i=t.type,r=t.pendingProps,To(e,t,i,r=t.elementType===i?r:to(i,r),n);case 3:e:{if(Eo(t),null===e)throw Error(s(387));i=t.pendingProps,r=(a=t.memoizedState).element,zs(e,t),Us(t,i,null,n);var o=t.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ao(e,t,i,n,r=lo(Error(s(423)),t));break e}if(i!==r){t=Ao(e,t,i,n,r=lo(Error(s(424)),t));break e}for(is=cr(t.stateNode.containerInfo.firstChild),ns=t,rs=!0,ss=null,n=bs(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),i===r){t=qo(e,t,n);break e}_o(e,t,i,n)}t=t.child}return t;case 5:return Qs(t),null===e&&cs(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,nr(i,r)?o=null:null!==a&&nr(i,a)&&(t.flags|=32),So(e,t),_o(e,t,o,n),t.child;case 6:return null===e&&cs(t),null;case 13:return zo(e,t,n);case 4:return Xs(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=_s(t,null,i,n):_o(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,bo(e,t,i,r=t.elementType===i?r:to(i,r),n);case 7:return _o(e,t,t.pendingProps,n),t.child;case 8:case 12:return _o(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,kr(ws,i._currentValue),i._currentValue=o,null!==a)if(oi(a.value,o)){if(a.children===r.children&&!Er.current){t=qo(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=Os(-1,n&-n)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Cs(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Cs(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}_o(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Es(t,n),i=i(r=As(r)),t.flags|=1,_o(e,t,i,n),t.child;case 14:return r=to(i=t.type,t.pendingProps),wo(e,t,i,r=to(i.type,r),n);case 15:return jo(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:to(i,r),Ho(e,t),t.tag=1,Dr(i)?(e=!0,Lr(t)):e=!1,Es(t,n),so(t,i,r),oo(t,i,r,n),Co(null,t,i,!0,e,n);case 19:return Uo(e,t,n);case 22:return No(e,t,n)}throw Error(s(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function Zc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function $c(e,t,n,i,r){var s=n._reactRootContainer;if(s){var a=s;if("function"===typeof r){var o=r;r=function(){var e=qc(a);o.call(e)}}Hc(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"===typeof i){var s=i;i=function(){var e=qc(a);s.call(e)}}var a=Uc(t,i,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[mr]=a.current,Ui(8===e.nodeType?e.parentNode:e),dc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var o=i;i=function(){var e=qc(l);o.call(e)}}var l=Bc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[mr]=l.current,Ui(8===e.nodeType?e.parentNode:e),dc(function(){Hc(t,l,n,i)}),l}(n,t,e,r,i);return qc(a)}Xc.prototype.render=Zc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Hc(e,t,null,null)},Xc.prototype.unmount=Zc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc(function(){Hc(null,e,null,null)}),t[mr]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<It.length&&0!==t&&t<It[n].priority;n++);It.splice(n,0,e),0===n&&zt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(yt(t,1|n),ic(t,Qe()),0===(6&Cl)&&(Ul=Qe()+500,Ur()))}break;case 13:dc(function(){var t=Ps(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Gc(e,1)}},wt=function(e){if(13===e.tag){var t=Ps(e,134217728);if(null!==t)nc(t,e,134217728,ec());Gc(e,134217728)}},jt=function(e){if(13===e.tag){var t=tc(e),n=Ps(e,t);if(null!==n)nc(n,e,t,ec());Gc(e,t)}},Nt=function(){return vt},St=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(s(90));Y(i),J(i,r)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ce=cc,Ee=dc;var ed={usingClientEntryPoint:!1,Events:[vr,_r,br,ke,Te,cc]},td={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var id=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!id.isDisabled&&id.supportsFiber)try{rt=id.inject(nd),st=id}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(s(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(s(299));var n=!1,i="",r=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bc(e,1,!1,null,0,n,0,i,r),e[mr]=t.current,Ui(8===e.nodeType?e.parentNode:e),new Zc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Qc(t))throw Error(s(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",o=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Uc(t,null,e,1,null!=n?n:null,r,0,a,o),e[mr]=t.current,Ui(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Xc(t)},t.render=function(e,t,n){if(!Qc(t))throw Error(s(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(s(40));return!!e._reactRootContainer&&(dc(function(){$c(null,null,e,!1,function(){e._reactRootContainer=null,e[mr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Qc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return $c(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},2733:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(2284),r=n(3666);function s(e){return(0,r.A)(1,arguments),e instanceof Date||"object"===(0,i.A)(e)&&"[object Date]"===Object.prototype.toString.call(e)}},2950:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),a=(0,i.A)(t);return isNaN(n.getTime())?new Date(NaN):(n.setFullYear(a),n)}},3150:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e),n=t.getFullYear();return t.setFullYear(n+1,0,0),t.setHours(23,59,59,999),t}},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3275:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getDay()}},3498:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6819),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,i.A)(t);return(0,r.default)(e,-n)}},3666:(e,t,n)=>{"use strict";function i(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}n.d(t,{A:()=>i})},3764:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return 12*(n.getFullYear()-s.getFullYear())+(n.getMonth()-s.getMonth())}},3778:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),a=(0,i.A)(t),o=n.getFullYear(),l=n.getDate(),c=new Date(0);c.setFullYear(o,a,15),c.setHours(0,0,0,0);var d=function(e){(0,s.A)(1,arguments);var t=(0,r.default)(e),n=t.getFullYear(),i=t.getMonth(),a=new Date(0);return a.setFullYear(n,i+1,0),a.setHours(0,0,0,0),a.getDate()}(c);return n.setMonth(a,Math.min(l,d)),n}},4028:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),a=(0,i.A)(t);return n.setSeconds(a),n}},4122:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e),n=t.getMonth(),s=n-n%3;return t.setMonth(s,1),t.setHours(0,0,0,0),t}},4123:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var i=n(6260),r=n(9511),s=n(2217),a=n(3666),o=n(8355),l=n(2239);var c=6048e5;function d(e,t){(0,a.A)(1,arguments);var n=(0,i.default)(e),d=(0,r.A)(n,t).getTime()-function(e,t){var n,i,c,d,u,h,p,m;(0,a.A)(1,arguments);var f=(0,l.q)(),g=(0,o.A)(null!==(n=null!==(i=null!==(c=null!==(d=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==d?d:null===t||void 0===t||null===(u=t.locale)||void 0===u||null===(h=u.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==c?c:f.firstWeekContainsDate)&&void 0!==i?i:null===(p=f.locale)||void 0===p||null===(m=p.options)||void 0===m?void 0:m.firstWeekContainsDate)&&void 0!==n?n:1),x=(0,s.A)(e,t),y=new Date(0);return y.setUTCFullYear(x,0,g),y.setUTCHours(0,0,0,0),(0,r.A)(y,t)}(n,t).getTime();return Math.round(d/c)+1}},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function x(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=x.prototype;var _=v.prototype=new y;_.constructor=v,f(_,x.prototype),_.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,j={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,i){var r,s={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)w.call(t,r)&&!N.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:e,key:a,ref:o,props:s,_owner:j.current}}function k(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function E(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=e),e=""===s?"."+C(l,0):s,b(a)?(r="",null!=e&&(r=e.replace(T,"$&/")+"/"),E(a,t,r,"",function(e){return e})):null!=a&&(k(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(T,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",b(e))for(var c=0;c<e.length;c++){var d=s+C(o=e[c],c);l+=E(o,t,r,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)l+=E(o=o.value,t,r,d=s+C(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function A(e,t,n){if(null==e)return e;var i=[],r=0;return E(e,i,"","",function(e){return t.call(n,e,r++)}),i}function M(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},I={transition:null},P={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:I,ReactCurrentOwner:j};function R(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!k(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=x,t.Fragment=r,t.Profiler=a,t.PureComponent=v,t.StrictMode=s,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.act=R,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=f({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=j.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!N.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:n,type:e.type,key:s,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=I.transition;I.transition={};try{e()}finally{I.transition=t}},t.unstable_act=R,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},4391:(e,t,n)=>{"use strict";var i=n(7950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},4410:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e).getTime(),a=(0,i.A)(t);return new Date(n+a)}},4467:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(816);function r(e,t,n){return(t=(0,i.A)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},4893:e=>{e.exports=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},4967:(e,t,n)=>{"use strict";function i(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}n.d(t,{A:()=>i})},4975:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e),n=new Date(0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}},4998:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getHours()}},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5093:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(2026),r=n(3666),s=n(8355);function a(e,t){var n;(0,r.A)(1,arguments);var a=(0,s.A)(null!==(n=null===t||void 0===t?void 0:t.additionalDigits)&&void 0!==n?n:2);if(2!==a&&1!==a&&0!==a)throw new RangeError("additionalDigits must be 0, 1 or 2");if("string"!==typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var f,g=function(e){var t,n={},i=e.split(o.dateTimeDelimiter);if(i.length>2)return n;/:/.test(i[0])?t=i[0]:(n.date=i[0],t=i[1],o.timeZoneDelimiter.test(n.date)&&(n.date=e.split(o.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length)));if(t){var r=o.timezone.exec(t);r?(n.time=t.replace(r[1],""),n.timezone=r[1]):n.time=t}return n}(e);if(g.date){var x=function(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),i=e.match(n);if(!i)return{year:NaN,restDateString:""};var r=i[1]?parseInt(i[1]):null,s=i[2]?parseInt(i[2]):null;return{year:null===s?r:100*s,restDateString:e.slice((i[1]||i[2]).length)}}(g.date,a);f=function(e,t){if(null===t)return new Date(NaN);var n=e.match(l);if(!n)return new Date(NaN);var i=!!n[4],r=u(n[1]),s=u(n[2])-1,a=u(n[3]),o=u(n[4]),c=u(n[5])-1;if(i)return function(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}(0,o,c)?function(e,t,n){var i=new Date(0);i.setUTCFullYear(e,0,4);var r=i.getUTCDay()||7,s=7*(t-1)+n+1-r;return i.setUTCDate(i.getUTCDate()+s),i}(t,o,c):new Date(NaN);var d=new Date(0);return function(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(p[t]||(m(e)?29:28))}(t,s,a)&&function(e,t){return t>=1&&t<=(m(e)?366:365)}(t,r)?(d.setUTCFullYear(t,s,Math.max(r,a)),d):new Date(NaN)}(x.restDateString,x.year)}if(!f||isNaN(f.getTime()))return new Date(NaN);var y,v=f.getTime(),_=0;if(g.time&&(_=function(e){var t=e.match(c);if(!t)return NaN;var n=h(t[1]),r=h(t[2]),s=h(t[3]);if(!function(e,t,n){if(24===e)return 0===t&&0===n;return n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}(n,r,s))return NaN;return n*i.s0+r*i.Cg+1e3*s}(g.time),isNaN(_)))return new Date(NaN);if(!g.timezone){var b=new Date(v+_),w=new Date(0);return w.setFullYear(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()),w.setHours(b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),b.getUTCMilliseconds()),w}return y=function(e){if("Z"===e)return 0;var t=e.match(d);if(!t)return 0;var n="+"===t[1]?-1:1,r=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;if(!function(e,t){return t>=0&&t<=59}(0,s))return NaN;return n*(r*i.s0+s*i.Cg)}(g.timezone),isNaN(y)?new Date(NaN):new Date(v+_+y)}var o={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},l=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,c=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,d=/^([+-])(\d{2})(?::?(\d{2}))?$/;function u(e){return e?parseInt(e):1}function h(e){return e&&parseFloat(e.replace(",","."))||0}var p=[31,null,31,30,31,30,31,31,30,31,30,31];function m(e){return e%400===0||e%4===0&&e%100!==0}},5125:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(4122),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getTime()===s.getTime()}},5173:(e,t,n)=>{e.exports=n(1497)()},5277:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(2284),r=n(6260),s=n(3666);function a(e){var t,n;if((0,s.A)(1,arguments),e&&"function"===typeof e.forEach)t=e;else{if("object"!==(0,i.A)(e)||null===e)return new Date(NaN);t=Array.prototype.slice.call(e)}return t.forEach(function(e){var t=(0,r.default)(e);(void 0===n||n<t||isNaN(Number(t)))&&(n=t)}),n||new Date(NaN)}},5410:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(2325),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,i.A)(t);return(0,r.default)(e,-n)}},5479:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),a=(0,i.A)(t);return isNaN(a)?new Date(NaN):a?(n.setDate(n.getDate()+a),n):n}},5541:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(2733),r=n(6260),s=n(3666);function a(e){if((0,s.A)(1,arguments),!(0,i.default)(e)&&"number"!==typeof e)return!1;var t=(0,r.default)(e);return!isNaN(Number(t))}},5780:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e);return t.setHours(0,0,0,0),t}},5891:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var i=n(8355),r=n(4410),s=n(3666),a=36e5;function o(e,t){(0,s.A)(2,arguments);var n=(0,i.A)(t);return(0,r.A)(e,n*a)}},6087:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},r=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}};const s={p:r,P:function(e,t){var n,s=e.match(/(P+)(p+)?/)||[],a=s[1],o=s[2];if(!o)return i(e,t);switch(a){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",i(a,t)).replace("{{time}}",r(o,t))}}},6255:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}},6260:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(2284),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,i.A)(e)&&"[object Date]"===t?new Date(e.getTime()):"number"===typeof e||"[object Number]"===t?new Date(e):("string"!==typeof e&&"[object String]"!==t||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}},6366:e=>{var t="undefined"!==typeof Element,n="function"===typeof Map,i="function"===typeof Set,r="function"===typeof ArrayBuffer&&!!ArrayBuffer.isView;function s(e,a){if(e===a)return!0;if(e&&a&&"object"==typeof e&&"object"==typeof a){if(e.constructor!==a.constructor)return!1;var o,l,c,d;if(Array.isArray(e)){if((o=e.length)!=a.length)return!1;for(l=o;0!==l--;)if(!s(e[l],a[l]))return!1;return!0}if(n&&e instanceof Map&&a instanceof Map){if(e.size!==a.size)return!1;for(d=e.entries();!(l=d.next()).done;)if(!a.has(l.value[0]))return!1;for(d=e.entries();!(l=d.next()).done;)if(!s(l.value[1],a.get(l.value[0])))return!1;return!0}if(i&&e instanceof Set&&a instanceof Set){if(e.size!==a.size)return!1;for(d=e.entries();!(l=d.next()).done;)if(!a.has(l.value[0]))return!1;return!0}if(r&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(a)){if((o=e.length)!=a.length)return!1;for(l=o;0!==l--;)if(e[l]!==a[l])return!1;return!0}if(e.constructor===RegExp)return e.source===a.source&&e.flags===a.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"===typeof e.valueOf&&"function"===typeof a.valueOf)return e.valueOf()===a.valueOf();if(e.toString!==Object.prototype.toString&&"function"===typeof e.toString&&"function"===typeof a.toString)return e.toString()===a.toString();if((o=(c=Object.keys(e)).length)!==Object.keys(a).length)return!1;for(l=o;0!==l--;)if(!Object.prototype.hasOwnProperty.call(a,c[l]))return!1;if(t&&e instanceof Element)return!1;for(l=o;0!==l--;)if(("_owner"!==c[l]&&"__v"!==c[l]&&"__o"!==c[l]||!e.$$typeof)&&!s(e[c[l]],a[c[l]]))return!1;return!0}return e!==e&&a!==a}e.exports=function(e,t){try{return s(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}},6440:e=>{"use strict";var t=function(){};e.exports=t},6740:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var i=n(4967),r=n(5780),s=n(3666),a=864e5;function o(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),o=(0,r.default)(t),l=n.getTime()-(0,i.A)(n),c=o.getTime()-(0,i.A)(o);return Math.round((l-c)/a)}},6802:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),a=(0,i.A)(t);return n.setHours(a),n}},6819:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6260),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,r.default)(e),a=(0,i.A)(t);if(isNaN(a))return new Date(NaN);if(!a)return n;var o=n.getDate(),l=new Date(n.getTime());return l.setMonth(n.getMonth()+a+1,0),o>=l.getDate()?l:(n.setFullYear(l.getFullYear(),l.getMonth(),o),n)}},6887:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>it});var i=n(2284);function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}var a=n(8763),o=n(67),l=n(6260);function c(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}var d=n(6087),u=n(4967),h=n(8982),p=n(8355),m=n(3666);function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}function _(e){var t=v();return function(){var n,r=y(e);if(t){var s=y(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==(0,i.A)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}(this,n)}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var w=n(816);function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(0,w.A)(i.key),i)}}function N(e,t,n){return t&&j(e.prototype,t),n&&j(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var S=n(4467),k=function(){function e(){b(this,e),(0,S.A)(this,"priority",void 0),(0,S.A)(this,"subPriority",0)}return N(e,[{key:"validate",value:function(e,t){return!0}}]),e}(),T=function(e){x(n,e);var t=_(n);function n(e,i,r,s,a){var o;return b(this,n),(o=t.call(this)).value=e,o.validateValue=i,o.setValue=r,o.priority=s,a&&(o.subPriority=a),o}return N(n,[{key:"validate",value:function(e,t){return this.validateValue(e,this.value,t)}},{key:"set",value:function(e,t,n){return this.setValue(e,t,this.value,n)}}]),n}(k),C=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",10),(0,S.A)(f(e),"subPriority",-1),e}return N(n,[{key:"set",value:function(e,t){if(t.timestampIsSet)return e;var n=new Date(0);return n.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),n.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),n}}]),n}(k),E=function(){function e(){b(this,e),(0,S.A)(this,"incompatibleTokens",void 0),(0,S.A)(this,"priority",void 0),(0,S.A)(this,"subPriority",void 0)}return N(e,[{key:"run",value:function(e,t,n,i){var r=this.parse(e,t,n,i);return r?{setter:new T(r.value,this.validate,this.set,this.priority,this.subPriority),rest:r.rest}:null}},{key:"validate",value:function(e,t,n){return!0}}]),e}(),A=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",140),(0,S.A)(f(e),"incompatibleTokens",["R","u","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}}},{key:"set",value:function(e,t,n){return t.era=n,e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(E),M=n(2026),D=/^(1[0-2]|0?\d)/,I=/^(3[0-1]|[0-2]?\d)/,P=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,R=/^(5[0-3]|[0-4]?\d)/,L=/^(2[0-3]|[0-1]?\d)/,z=/^(2[0-4]|[0-1]?\d)/,O=/^(1[0-1]|0?\d)/,F=/^(1[0-2]|0?\d)/,B=/^[0-5]?\d/,V=/^[0-5]?\d/,U=/^\d/,H=/^\d{1,2}/,q=/^\d{1,3}/,W=/^\d{1,4}/,G=/^-?\d+/,Y=/^-?\d/,Z=/^-?\d{1,2}/,X=/^-?\d{1,3}/,K=/^-?\d{1,4}/,Q=/^([+-])(\d{2})(\d{2})?|Z/,J=/^([+-])(\d{2})(\d{2})|Z/,$=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,ee=/^([+-])(\d{2}):(\d{2})|Z/,te=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function ne(e,t){return e?{value:t(e.value),rest:e.rest}:e}function ie(e,t){var n=t.match(e);return n?{value:parseInt(n[0],10),rest:t.slice(n[0].length)}:null}function re(e,t){var n=t.match(e);if(!n)return null;if("Z"===n[0])return{value:0,rest:t.slice(1)};var i="+"===n[1]?1:-1,r=n[2]?parseInt(n[2],10):0,s=n[3]?parseInt(n[3],10):0,a=n[5]?parseInt(n[5],10):0;return{value:i*(r*M.s0+s*M.Cg+a*M._m),rest:t.slice(n[0].length)}}function se(e){return ie(G,e)}function ae(e,t){switch(e){case 1:return ie(U,t);case 2:return ie(H,t);case 3:return ie(q,t);case 4:return ie(W,t);default:return ie(new RegExp("^\\d{1,"+e+"}"),t)}}function oe(e,t){switch(e){case 1:return ie(Y,t);case 2:return ie(Z,t);case 3:return ie(X,t);case 4:return ie(K,t);default:return ie(new RegExp("^-?\\d{1,"+e+"}"),t)}}function le(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function ce(e,t){var n,i=t>0,r=i?t:1-t;if(r<=50)n=e||100;else{var s=r+50;n=e+100*Math.floor(s/100)-(e>=s%100?100:0)}return i?n:1-n}function de(e){return e%400===0||e%4===0&&e%100!==0}var ue=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",130),(0,S.A)(f(e),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){var i=function(e){return{year:e,isTwoDigitYear:"yy"===t}};switch(t){case"y":return ne(ae(4,e),i);case"yo":return ne(n.ordinalNumber(e,{unit:"year"}),i);default:return ne(ae(t.length,e),i)}}},{key:"validate",value:function(e,t){return t.isTwoDigitYear||t.year>0}},{key:"set",value:function(e,t,n){var i=e.getUTCFullYear();if(n.isTwoDigitYear){var r=ce(n.year,i);return e.setUTCFullYear(r,0,1),e.setUTCHours(0,0,0,0),e}var s="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(s,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(E),he=n(2217),pe=n(9511),me=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",130),(0,S.A)(f(e),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){var i=function(e){return{year:e,isTwoDigitYear:"YY"===t}};switch(t){case"Y":return ne(ae(4,e),i);case"Yo":return ne(n.ordinalNumber(e,{unit:"year"}),i);default:return ne(ae(t.length,e),i)}}},{key:"validate",value:function(e,t){return t.isTwoDigitYear||t.year>0}},{key:"set",value:function(e,t,n,i){var r=(0,he.A)(e,i);if(n.isTwoDigitYear){var s=ce(n.year,r);return e.setUTCFullYear(s,0,i.firstWeekContainsDate),e.setUTCHours(0,0,0,0),(0,pe.A)(e,i)}var a="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(a,0,i.firstWeekContainsDate),e.setUTCHours(0,0,0,0),(0,pe.A)(e,i)}}]),n}(E),fe=n(1740),ge=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",130),(0,S.A)(f(e),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t){return oe("R"===t?4:t.length,e)}},{key:"set",value:function(e,t,n){var i=new Date(0);return i.setUTCFullYear(n,0,4),i.setUTCHours(0,0,0,0),(0,fe.A)(i)}}]),n}(E),xe=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",130),(0,S.A)(f(e),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t){return oe("u"===t?4:t.length,e)}},{key:"set",value:function(e,t,n){return e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(E),ye=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",120),(0,S.A)(f(e),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"Q":case"QQ":return ae(t.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=1&&t<=4}},{key:"set",value:function(e,t,n){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e}}]),n}(E),ve=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",120),(0,S.A)(f(e),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"q":case"qq":return ae(t.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=1&&t<=4}},{key:"set",value:function(e,t,n){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e}}]),n}(E),_e=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),(0,S.A)(f(e),"priority",110),e}return N(n,[{key:"parse",value:function(e,t,n){var i=function(e){return e-1};switch(t){case"M":return ne(ie(D,e),i);case"MM":return ne(ae(2,e),i);case"Mo":return ne(n.ordinalNumber(e,{unit:"month"}),i);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e}}]),n}(E),be=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",110),(0,S.A)(f(e),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){var i=function(e){return e-1};switch(t){case"L":return ne(ie(D,e),i);case"LL":return ne(ae(2,e),i);case"Lo":return ne(n.ordinalNumber(e,{unit:"month"}),i);case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e}}]),n}(E),we=n(4123);var je=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",100),(0,S.A)(f(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"w":return ie(R,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=53}},{key:"set",value:function(e,t,n,i){return(0,pe.A)(function(e,t,n){(0,m.A)(2,arguments);var i=(0,l.default)(e),r=(0,p.A)(t),s=(0,we.A)(i,n)-r;return i.setUTCDate(i.getUTCDate()-7*s),i}(e,n,i),i)}}]),n}(E),Ne=n(1049);var Se=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",100),(0,S.A)(f(e),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"I":return ie(R,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=53}},{key:"set",value:function(e,t,n){return(0,fe.A)(function(e,t){(0,m.A)(2,arguments);var n=(0,l.default)(e),i=(0,p.A)(t),r=(0,Ne.A)(n)-i;return n.setUTCDate(n.getUTCDate()-7*r),n}(e,n))}}]),n}(E),ke=[31,28,31,30,31,30,31,31,30,31,30,31],Te=[31,29,31,30,31,30,31,31,30,31,30,31],Ce=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",90),(0,S.A)(f(e),"subPriority",1),(0,S.A)(f(e),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"d":return ie(I,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){var n=de(e.getUTCFullYear()),i=e.getUTCMonth();return n?t>=1&&t<=Te[i]:t>=1&&t<=ke[i]}},{key:"set",value:function(e,t,n){return e.setUTCDate(n),e.setUTCHours(0,0,0,0),e}}]),n}(E),Ee=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",90),(0,S.A)(f(e),"subpriority",1),(0,S.A)(f(e),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"D":case"DD":return ie(P,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return de(e.getUTCFullYear())?t>=1&&t<=366:t>=1&&t<=365}},{key:"set",value:function(e,t,n){return e.setUTCMonth(0,n),e.setUTCHours(0,0,0,0),e}}]),n}(E),Ae=n(2239);function Me(e,t,n){var i,r,s,a,o,c,d,u;(0,m.A)(2,arguments);var h=(0,Ae.q)(),f=(0,p.A)(null!==(i=null!==(r=null!==(s=null!==(a=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==a?a:null===n||void 0===n||null===(o=n.locale)||void 0===o||null===(c=o.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==s?s:h.weekStartsOn)&&void 0!==r?r:null===(d=h.locale)||void 0===d||null===(u=d.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==i?i:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,l.default)(e),x=(0,p.A)(t),y=((x%7+7)%7<f?7:0)+x-g.getUTCDay();return g.setUTCDate(g.getUTCDate()+y),g}var De=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",90),(0,S.A)(f(e),"incompatibleTokens",["D","i","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,i){return(e=Me(e,n,i)).setUTCHours(0,0,0,0),e}}]),n}(E),Ie=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",90),(0,S.A)(f(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n,i){var r=function(e){var t=7*Math.floor((e-1)/7);return(e+i.weekStartsOn+6)%7+t};switch(t){case"e":case"ee":return ne(ae(t.length,e),r);case"eo":return ne(n.ordinalNumber(e,{unit:"day"}),r);case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,i){return(e=Me(e,n,i)).setUTCHours(0,0,0,0),e}}]),n}(E),Pe=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",90),(0,S.A)(f(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n,i){var r=function(e){var t=7*Math.floor((e-1)/7);return(e+i.weekStartsOn+6)%7+t};switch(t){case"c":case"cc":return ne(ae(t.length,e),r);case"co":return ne(n.ordinalNumber(e,{unit:"day"}),r);case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,i){return(e=Me(e,n,i)).setUTCHours(0,0,0,0),e}}]),n}(E);var Re=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",90),(0,S.A)(f(e),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){var i=function(e){return 0===e?7:e};switch(t){case"i":case"ii":return ae(t.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return ne(n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),i);case"iiiii":return ne(n.day(e,{width:"narrow",context:"formatting"}),i);case"iiiiii":return ne(n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),i);default:return ne(n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),i)}}},{key:"validate",value:function(e,t){return t>=1&&t<=7}},{key:"set",value:function(e,t,n){return e=function(e,t){(0,m.A)(2,arguments);var n=(0,p.A)(t);n%7===0&&(n-=7);var i=(0,l.default)(e),r=((n%7+7)%7<1?7:0)+n-i.getUTCDay();return i.setUTCDate(i.getUTCDate()+r),i}(e,n),e.setUTCHours(0,0,0,0),e}}]),n}(E),Le=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",80),(0,S.A)(f(e),"incompatibleTokens",["b","B","H","k","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(le(n),0,0,0),e}}]),n}(E),ze=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",80),(0,S.A)(f(e),"incompatibleTokens",["a","B","H","k","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(le(n),0,0,0),e}}]),n}(E),Oe=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",80),(0,S.A)(f(e),"incompatibleTokens",["a","b","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(le(n),0,0,0),e}}]),n}(E),Fe=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",70),(0,S.A)(f(e),"incompatibleTokens",["H","K","k","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"h":return ie(F,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=12}},{key:"set",value:function(e,t,n){var i=e.getUTCHours()>=12;return i&&n<12?e.setUTCHours(n+12,0,0,0):i||12!==n?e.setUTCHours(n,0,0,0):e.setUTCHours(0,0,0,0),e}}]),n}(E),Be=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",70),(0,S.A)(f(e),"incompatibleTokens",["a","b","h","K","k","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"H":return ie(L,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=23}},{key:"set",value:function(e,t,n){return e.setUTCHours(n,0,0,0),e}}]),n}(E),Ve=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",70),(0,S.A)(f(e),"incompatibleTokens",["h","H","k","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"K":return ie(O,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.getUTCHours()>=12&&n<12?e.setUTCHours(n+12,0,0,0):e.setUTCHours(n,0,0,0),e}}]),n}(E),Ue=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",70),(0,S.A)(f(e),"incompatibleTokens",["a","b","h","H","K","t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"k":return ie(z,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=24}},{key:"set",value:function(e,t,n){var i=n<=24?n%24:n;return e.setUTCHours(i,0,0,0),e}}]),n}(E),He=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",60),(0,S.A)(f(e),"incompatibleTokens",["t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"m":return ie(B,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=59}},{key:"set",value:function(e,t,n){return e.setUTCMinutes(n,0,0),e}}]),n}(E),qe=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",50),(0,S.A)(f(e),"incompatibleTokens",["t","T"]),e}return N(n,[{key:"parse",value:function(e,t,n){switch(t){case"s":return ie(V,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return ae(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=59}},{key:"set",value:function(e,t,n){return e.setUTCSeconds(n,0),e}}]),n}(E),We=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",30),(0,S.A)(f(e),"incompatibleTokens",["t","T"]),e}return N(n,[{key:"parse",value:function(e,t){return ne(ae(t.length,e),function(e){return Math.floor(e*Math.pow(10,3-t.length))})}},{key:"set",value:function(e,t,n){return e.setUTCMilliseconds(n),e}}]),n}(E),Ge=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",10),(0,S.A)(f(e),"incompatibleTokens",["t","T","x"]),e}return N(n,[{key:"parse",value:function(e,t){switch(t){case"X":return re(Q,e);case"XX":return re(J,e);case"XXXX":return re($,e);case"XXXXX":return re(te,e);default:return re(ee,e)}}},{key:"set",value:function(e,t,n){return t.timestampIsSet?e:new Date(e.getTime()-n)}}]),n}(E),Ye=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",10),(0,S.A)(f(e),"incompatibleTokens",["t","T","X"]),e}return N(n,[{key:"parse",value:function(e,t){switch(t){case"x":return re(Q,e);case"xx":return re(J,e);case"xxxx":return re($,e);case"xxxxx":return re(te,e);default:return re(ee,e)}}},{key:"set",value:function(e,t,n){return t.timestampIsSet?e:new Date(e.getTime()-n)}}]),n}(E),Ze=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",40),(0,S.A)(f(e),"incompatibleTokens","*"),e}return N(n,[{key:"parse",value:function(e){return se(e)}},{key:"set",value:function(e,t,n){return[new Date(1e3*n),{timestampIsSet:!0}]}}]),n}(E),Xe=function(e){x(n,e);var t=_(n);function n(){var e;b(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,S.A)(f(e),"priority",20),(0,S.A)(f(e),"incompatibleTokens","*"),e}return N(n,[{key:"parse",value:function(e){return se(e)}},{key:"set",value:function(e,t,n){return[new Date(n),{timestampIsSet:!0}]}}]),n}(E),Ke={G:new A,y:new ue,Y:new me,R:new ge,u:new xe,Q:new ye,q:new ve,M:new _e,L:new be,w:new je,I:new Se,d:new Ce,D:new Ee,E:new De,e:new Ie,c:new Pe,i:new Re,a:new Le,b:new ze,B:new Oe,h:new Fe,H:new Be,K:new Ve,k:new Ue,m:new He,s:new qe,S:new We,X:new Ge,x:new Ye,t:new Ze,T:new Xe},Qe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Je=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,$e=/^'([^]*?)'?$/,et=/''/g,tt=/\S/,nt=/[a-zA-Z]/;function it(e,t,n,r){var f,g,x,y,v,_,b,w,j,N,S,k,T,E,A,M,D,I;(0,m.A)(3,arguments);var P=String(e),R=String(t),L=(0,Ae.q)(),z=null!==(f=null!==(g=null===r||void 0===r?void 0:r.locale)&&void 0!==g?g:L.locale)&&void 0!==f?f:a.A;if(!z.match)throw new RangeError("locale must contain match property");var O=(0,p.A)(null!==(x=null!==(y=null!==(v=null!==(_=null===r||void 0===r?void 0:r.firstWeekContainsDate)&&void 0!==_?_:null===r||void 0===r||null===(b=r.locale)||void 0===b||null===(w=b.options)||void 0===w?void 0:w.firstWeekContainsDate)&&void 0!==v?v:L.firstWeekContainsDate)&&void 0!==y?y:null===(j=L.locale)||void 0===j||null===(N=j.options)||void 0===N?void 0:N.firstWeekContainsDate)&&void 0!==x?x:1);if(!(O>=1&&O<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var F=(0,p.A)(null!==(S=null!==(k=null!==(T=null!==(E=null===r||void 0===r?void 0:r.weekStartsOn)&&void 0!==E?E:null===r||void 0===r||null===(A=r.locale)||void 0===A||null===(M=A.options)||void 0===M?void 0:M.weekStartsOn)&&void 0!==T?T:L.weekStartsOn)&&void 0!==k?k:null===(D=L.locale)||void 0===D||null===(I=D.options)||void 0===I?void 0:I.weekStartsOn)&&void 0!==S?S:0);if(!(F>=0&&F<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(""===R)return""===P?(0,l.default)(n):new Date(NaN);var B,V={firstWeekContainsDate:O,weekStartsOn:F,locale:z},U=[new C],H=R.match(Je).map(function(e){var t=e[0];return t in d.A?(0,d.A[t])(e,z.formatLong):e}).join("").match(Qe),q=[],W=s(H);try{var G=function(){var t=B.value;null!==r&&void 0!==r&&r.useAdditionalWeekYearTokens||!(0,h.xM)(t)||(0,h.lJ)(t,R,e),null!==r&&void 0!==r&&r.useAdditionalDayOfYearTokens||!(0,h.ef)(t)||(0,h.lJ)(t,R,e);var n=t[0],i=Ke[n];if(i){var s=i.incompatibleTokens;if(Array.isArray(s)){var a=q.find(function(e){return s.includes(e.token)||e.token===n});if(a)throw new RangeError("The format string mustn't contain `".concat(a.fullToken,"` and `").concat(t,"` at the same time"))}else if("*"===i.incompatibleTokens&&q.length>0)throw new RangeError("The format string mustn't contain `".concat(t,"` and any other token at the same time"));q.push({token:n,fullToken:t});var o=i.run(P,t,z.match,V);if(!o)return{v:new Date(NaN)};U.push(o.setter),P=o.rest}else{if(n.match(nt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+n+"`");if("''"===t?t="'":"'"===n&&(t=t.match($e)[1].replace(et,"'")),0!==P.indexOf(t))return{v:new Date(NaN)};P=P.slice(t.length)}};for(W.s();!(B=W.n()).done;){var Y=G();if("object"===(0,i.A)(Y))return Y.v}}catch(ne){W.e(ne)}finally{W.f()}if(P.length>0&&tt.test(P))return new Date(NaN);var Z=U.map(function(e){return e.priority}).sort(function(e,t){return t-e}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return U.filter(function(t){return t.priority===e}).sort(function(e,t){return t.subPriority-e.subPriority})}).map(function(e){return e[0]}),X=(0,l.default)(n);if(isNaN(X.getTime()))return new Date(NaN);var K,Q=(0,o.A)(X,(0,u.A)(X)),J={},$=s(Z);try{for($.s();!(K=$.n()).done;){var ee=K.value;if(!ee.validate(Q,V))return new Date(NaN);var te=ee.set(Q,J,V);Array.isArray(te)?(Q=te[0],c(J,te[1])):Q=te}}catch(ne){$.e(ne)}finally{$.f()}return Q}},7099:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Manager:()=>a,Popper:()=>Ie,Reference:()=>Le,usePopper:()=>Ee});var i=n(5043),r=i.createContext(),s=i.createContext();function a(e){var t=e.children,n=i.useState(null),a=n[0],o=n[1],l=i.useRef(!1);i.useEffect(function(){return function(){l.current=!0}},[]);var c=i.useCallback(function(e){l.current||o(e)},[]);return i.createElement(r.Provider,{value:a},i.createElement(s.Provider,{value:c},t))}var o=function(e){return Array.isArray(e)?e[0]:e},l=function(e){if("function"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(void 0,n)}},c=function(e,t){if("function"===typeof e)return l(e,t);null!=e&&(e.current=t)},d=function(e){return e.reduce(function(e,t){var n=t[0],i=t[1];return e[n]=i,e},{})},u="undefined"!==typeof window&&window.document&&window.document.createElement?i.useLayoutEffect:i.useEffect,h=n(7950);function p(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function m(e){return e instanceof p(e).Element||e instanceof Element}function f(e){return e instanceof p(e).HTMLElement||e instanceof HTMLElement}function g(e){return"undefined"!==typeof ShadowRoot&&(e instanceof p(e).ShadowRoot||e instanceof ShadowRoot)}var x=Math.max,y=Math.min,v=Math.round;function _(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function b(){return!/^((?!chrome|android).)*safari/i.test(_())}function w(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=e.getBoundingClientRect(),r=1,s=1;t&&f(e)&&(r=e.offsetWidth>0&&v(i.width)/e.offsetWidth||1,s=e.offsetHeight>0&&v(i.height)/e.offsetHeight||1);var a=(m(e)?p(e):window).visualViewport,o=!b()&&n,l=(i.left+(o&&a?a.offsetLeft:0))/r,c=(i.top+(o&&a?a.offsetTop:0))/s,d=i.width/r,u=i.height/s;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l,x:l,y:c}}function j(e){var t=p(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function N(e){return e?(e.nodeName||"").toLowerCase():null}function S(e){return((m(e)?e.ownerDocument:e.document)||window.document).documentElement}function k(e){return w(S(e)).left+j(e).scrollLeft}function T(e){return p(e).getComputedStyle(e)}function C(e){var t=T(e),n=t.overflow,i=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function E(e,t,n){void 0===n&&(n=!1);var i=f(t),r=f(t)&&function(e){var t=e.getBoundingClientRect(),n=v(t.width)/e.offsetWidth||1,i=v(t.height)/e.offsetHeight||1;return 1!==n||1!==i}(t),s=S(t),a=w(e,r,n),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!n)&&(("body"!==N(t)||C(s))&&(o=function(e){return e!==p(e)&&f(e)?{scrollLeft:(t=e).scrollLeft,scrollTop:t.scrollTop}:j(e);var t}(t)),f(t)?((l=w(t,!0)).x+=t.clientLeft,l.y+=t.clientTop):s&&(l.x=k(s))),{x:a.left+o.scrollLeft-l.x,y:a.top+o.scrollTop-l.y,width:a.width,height:a.height}}function A(e){var t=w(e),n=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:i}}function M(e){return"html"===N(e)?e:e.assignedSlot||e.parentNode||(g(e)?e.host:null)||S(e)}function D(e){return["html","body","#document"].indexOf(N(e))>=0?e.ownerDocument.body:f(e)&&C(e)?e:D(M(e))}function I(e,t){var n;void 0===t&&(t=[]);var i=D(e),r=i===(null==(n=e.ownerDocument)?void 0:n.body),s=p(i),a=r?[s].concat(s.visualViewport||[],C(i)?i:[]):i,o=t.concat(a);return r?o:o.concat(I(M(a)))}function P(e){return["table","td","th"].indexOf(N(e))>=0}function R(e){return f(e)&&"fixed"!==T(e).position?e.offsetParent:null}function L(e){for(var t=p(e),n=R(e);n&&P(n)&&"static"===T(n).position;)n=R(n);return n&&("html"===N(n)||"body"===N(n)&&"static"===T(n).position)?t:n||function(e){var t=/firefox/i.test(_());if(/Trident/i.test(_())&&f(e)&&"fixed"===T(e).position)return null;var n=M(e);for(g(n)&&(n=n.host);f(n)&&["html","body"].indexOf(N(n))<0;){var i=T(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}return null}(e)||t}var z="top",O="bottom",F="right",B="left",V="auto",U=[z,O,F,B],H="start",q="end",W="viewport",G="popper",Y=U.reduce(function(e,t){return e.concat([t+"-"+H,t+"-"+q])},[]),Z=[].concat(U,[V]).reduce(function(e,t){return e.concat([t,t+"-"+H,t+"-"+q])},[]),X=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function K(e){var t=new Map,n=new Set,i=[];function r(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var i=t.get(e);i&&r(i)}}),i.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||r(e)}),i}function Q(e){var t;return function(){return t||(t=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(e())})})),t}}var J={placement:"bottom",modifiers:[],strategy:"absolute"};function $(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(e){return!(e&&"function"===typeof e.getBoundingClientRect)})}function ee(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,i=void 0===n?[]:n,r=t.defaultOptions,s=void 0===r?J:r;return function(e,t,n){void 0===n&&(n=s);var r={placement:"bottom",orderedModifiers:[],options:Object.assign({},J,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},a=[],o=!1,l={state:r,setOptions:function(n){var o="function"===typeof n?n(r.options):n;c(),r.options=Object.assign({},s,r.options,o),r.scrollParents={reference:m(e)?I(e):e.contextElement?I(e.contextElement):[],popper:I(t)};var d=function(e){var t=K(e);return X.reduce(function(e,n){return e.concat(t.filter(function(e){return e.phase===n}))},[])}(function(e){var t=e.reduce(function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{});return Object.keys(t).map(function(e){return t[e]})}([].concat(i,r.options.modifiers)));return r.orderedModifiers=d.filter(function(e){return e.enabled}),r.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,i=void 0===n?{}:n,s=e.effect;if("function"===typeof s){var o=s({state:r,name:t,instance:l,options:i}),c=function(){};a.push(o||c)}}),l.update()},forceUpdate:function(){if(!o){var e=r.elements,t=e.reference,n=e.popper;if($(t,n)){r.rects={reference:E(t,L(n),"fixed"===r.options.strategy),popper:A(n)},r.reset=!1,r.placement=r.options.placement,r.orderedModifiers.forEach(function(e){return r.modifiersData[e.name]=Object.assign({},e.data)});for(var i=0;i<r.orderedModifiers.length;i++)if(!0!==r.reset){var s=r.orderedModifiers[i],a=s.fn,c=s.options,d=void 0===c?{}:c,u=s.name;"function"===typeof a&&(r=a({state:r,options:d,name:u,instance:l})||r)}else r.reset=!1,i=-1}}},update:Q(function(){return new Promise(function(e){l.forceUpdate(),e(r)})}),destroy:function(){c(),o=!0}};if(!$(e,t))return l;function c(){a.forEach(function(e){return e()}),a=[]}return l.setOptions(n).then(function(e){!o&&n.onFirstUpdate&&n.onFirstUpdate(e)}),l}}var te={passive:!0};function ne(e){return e.split("-")[0]}function ie(e){return e.split("-")[1]}function re(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function se(e){var t,n=e.reference,i=e.element,r=e.placement,s=r?ne(r):null,a=r?ie(r):null,o=n.x+n.width/2-i.width/2,l=n.y+n.height/2-i.height/2;switch(s){case z:t={x:o,y:n.y-i.height};break;case O:t={x:o,y:n.y+n.height};break;case F:t={x:n.x+n.width,y:l};break;case B:t={x:n.x-i.width,y:l};break;default:t={x:n.x,y:n.y}}var c=s?re(s):null;if(null!=c){var d="y"===c?"height":"width";switch(a){case H:t[c]=t[c]-(n[d]/2-i[d]/2);break;case q:t[c]=t[c]+(n[d]/2-i[d]/2)}}return t}var ae={top:"auto",right:"auto",bottom:"auto",left:"auto"};function oe(e){var t,n=e.popper,i=e.popperRect,r=e.placement,s=e.variation,a=e.offsets,o=e.position,l=e.gpuAcceleration,c=e.adaptive,d=e.roundOffsets,u=e.isFixed,h=a.x,m=void 0===h?0:h,f=a.y,g=void 0===f?0:f,x="function"===typeof d?d({x:m,y:g}):{x:m,y:g};m=x.x,g=x.y;var y=a.hasOwnProperty("x"),_=a.hasOwnProperty("y"),b=B,w=z,j=window;if(c){var N=L(n),k="clientHeight",C="clientWidth";if(N===p(n)&&"static"!==T(N=S(n)).position&&"absolute"===o&&(k="scrollHeight",C="scrollWidth"),r===z||(r===B||r===F)&&s===q)w=O,g-=(u&&N===j&&j.visualViewport?j.visualViewport.height:N[k])-i.height,g*=l?1:-1;if(r===B||(r===z||r===O)&&s===q)b=F,m-=(u&&N===j&&j.visualViewport?j.visualViewport.width:N[C])-i.width,m*=l?1:-1}var E,A=Object.assign({position:o},c&&ae),M=!0===d?function(e,t){var n=e.x,i=e.y,r=t.devicePixelRatio||1;return{x:v(n*r)/r||0,y:v(i*r)/r||0}}({x:m,y:g},p(n)):{x:m,y:g};return m=M.x,g=M.y,l?Object.assign({},A,((E={})[w]=_?"0":"",E[b]=y?"0":"",E.transform=(j.devicePixelRatio||1)<=1?"translate("+m+"px, "+g+"px)":"translate3d("+m+"px, "+g+"px, 0)",E)):Object.assign({},A,((t={})[w]=_?g+"px":"",t[b]=y?m+"px":"",t.transform="",t))}const le={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.offset,s=void 0===r?[0,0]:r,a=Z.reduce(function(e,n){return e[n]=function(e,t,n){var i=ne(e),r=[B,z].indexOf(i)>=0?-1:1,s="function"===typeof n?n(Object.assign({},t,{placement:e})):n,a=s[0],o=s[1];return a=a||0,o=(o||0)*r,[B,F].indexOf(i)>=0?{x:o,y:a}:{x:a,y:o}}(n,t.rects,s),e},{}),o=a[t.placement],l=o.x,c=o.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=a}};var ce={left:"right",right:"left",bottom:"top",top:"bottom"};function de(e){return e.replace(/left|right|bottom|top/g,function(e){return ce[e]})}var ue={start:"end",end:"start"};function he(e){return e.replace(/start|end/g,function(e){return ue[e]})}function pe(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&g(n)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function me(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function fe(e,t,n){return t===W?me(function(e,t){var n=p(e),i=S(e),r=n.visualViewport,s=i.clientWidth,a=i.clientHeight,o=0,l=0;if(r){s=r.width,a=r.height;var c=b();(c||!c&&"fixed"===t)&&(o=r.offsetLeft,l=r.offsetTop)}return{width:s,height:a,x:o+k(e),y:l}}(e,n)):m(t)?function(e,t){var n=w(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):me(function(e){var t,n=S(e),i=j(e),r=null==(t=e.ownerDocument)?void 0:t.body,s=x(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),a=x(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),o=-i.scrollLeft+k(e),l=-i.scrollTop;return"rtl"===T(r||n).direction&&(o+=x(n.clientWidth,r?r.clientWidth:0)-s),{width:s,height:a,x:o,y:l}}(S(e)))}function ge(e,t,n,i){var r="clippingParents"===t?function(e){var t=I(M(e)),n=["absolute","fixed"].indexOf(T(e).position)>=0&&f(e)?L(e):e;return m(n)?t.filter(function(e){return m(e)&&pe(e,n)&&"body"!==N(e)}):[]}(e):[].concat(t),s=[].concat(r,[n]),a=s[0],o=s.reduce(function(t,n){var r=fe(e,n,i);return t.top=x(r.top,t.top),t.right=y(r.right,t.right),t.bottom=y(r.bottom,t.bottom),t.left=x(r.left,t.left),t},fe(e,a,i));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function xe(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function ye(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}function ve(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=void 0===i?e.placement:i,s=n.strategy,a=void 0===s?e.strategy:s,o=n.boundary,l=void 0===o?"clippingParents":o,c=n.rootBoundary,d=void 0===c?W:c,u=n.elementContext,h=void 0===u?G:u,p=n.altBoundary,f=void 0!==p&&p,g=n.padding,x=void 0===g?0:g,y=xe("number"!==typeof x?x:ye(x,U)),v=h===G?"reference":G,_=e.rects.popper,b=e.elements[f?v:h],j=ge(m(b)?b:b.contextElement||S(e.elements.popper),l,d,a),N=w(e.elements.reference),k=se({reference:N,element:_,strategy:"absolute",placement:r}),T=me(Object.assign({},_,k)),C=h===G?T:N,E={top:j.top-C.top+y.top,bottom:C.bottom-j.bottom+y.bottom,left:j.left-C.left+y.left,right:C.right-j.right+y.right},A=e.modifiersData.offset;if(h===G&&A){var M=A[r];Object.keys(E).forEach(function(e){var t=[F,O].indexOf(e)>=0?1:-1,n=[z,O].indexOf(e)>=0?"y":"x";E[e]+=M[n]*t})}return E}function _e(e,t,n){return x(e,y(t,n))}const be={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.mainAxis,s=void 0===r||r,a=n.altAxis,o=void 0!==a&&a,l=n.boundary,c=n.rootBoundary,d=n.altBoundary,u=n.padding,h=n.tether,p=void 0===h||h,m=n.tetherOffset,f=void 0===m?0:m,g=ve(t,{boundary:l,rootBoundary:c,padding:u,altBoundary:d}),v=ne(t.placement),_=ie(t.placement),b=!_,w=re(v),j="x"===w?"y":"x",N=t.modifiersData.popperOffsets,S=t.rects.reference,k=t.rects.popper,T="function"===typeof f?f(Object.assign({},t.rects,{placement:t.placement})):f,C="number"===typeof T?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),E=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,M={x:0,y:0};if(N){if(s){var D,I="y"===w?z:B,P="y"===w?O:F,R="y"===w?"height":"width",V=N[w],U=V+g[I],q=V-g[P],W=p?-k[R]/2:0,G=_===H?S[R]:k[R],Y=_===H?-k[R]:-S[R],Z=t.elements.arrow,X=p&&Z?A(Z):{width:0,height:0},K=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Q=K[I],J=K[P],$=_e(0,S[R],X[R]),ee=b?S[R]/2-W-$-Q-C.mainAxis:G-$-Q-C.mainAxis,te=b?-S[R]/2+W+$+J+C.mainAxis:Y+$+J+C.mainAxis,se=t.elements.arrow&&L(t.elements.arrow),ae=se?"y"===w?se.clientTop||0:se.clientLeft||0:0,oe=null!=(D=null==E?void 0:E[w])?D:0,le=V+te-oe,ce=_e(p?y(U,V+ee-oe-ae):U,V,p?x(q,le):q);N[w]=ce,M[w]=ce-V}if(o){var de,ue="x"===w?z:B,he="x"===w?O:F,pe=N[j],me="y"===j?"height":"width",fe=pe+g[ue],ge=pe-g[he],xe=-1!==[z,B].indexOf(v),ye=null!=(de=null==E?void 0:E[j])?de:0,be=xe?fe:pe-S[me]-k[me]-ye+C.altAxis,we=xe?pe+S[me]+k[me]-ye-C.altAxis:ge,je=p&&xe?function(e,t,n){var i=_e(e,t,n);return i>n?n:i}(be,pe,we):_e(p?be:fe,pe,p?we:ge);N[j]=je,M[j]=je-pe}t.modifiersData[i]=M}},requiresIfExists:["offset"]};const we={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,i=e.name,r=e.options,s=n.elements.arrow,a=n.modifiersData.popperOffsets,o=ne(n.placement),l=re(o),c=[B,F].indexOf(o)>=0?"height":"width";if(s&&a){var d=function(e,t){return xe("number"!==typeof(e="function"===typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:ye(e,U))}(r.padding,n),u=A(s),h="y"===l?z:B,p="y"===l?O:F,m=n.rects.reference[c]+n.rects.reference[l]-a[l]-n.rects.popper[c],f=a[l]-n.rects.reference[l],g=L(s),x=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,y=m/2-f/2,v=d[h],_=x-u[c]-d[p],b=x/2-u[c]/2+y,w=_e(v,b,_),j=l;n.modifiersData[i]=((t={})[j]=w,t.centerOffset=w-b,t)}},effect:function(e){var t=e.state,n=e.options.element,i=void 0===n?"[data-popper-arrow]":n;null!=i&&("string"!==typeof i||(i=t.elements.popper.querySelector(i)))&&pe(t.elements.popper,i)&&(t.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function je(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Ne(e){return[z,F,O,B].some(function(t){return e[t]>=0})}var Se=ee({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,i=e.options,r=i.scroll,s=void 0===r||r,a=i.resize,o=void 0===a||a,l=p(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach(function(e){e.addEventListener("scroll",n.update,te)}),o&&l.addEventListener("resize",n.update,te),function(){s&&c.forEach(function(e){e.removeEventListener("scroll",n.update,te)}),o&&l.removeEventListener("resize",n.update,te)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=se({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,i=n.gpuAcceleration,r=void 0===i||i,s=n.adaptive,a=void 0===s||s,o=n.roundOffsets,l=void 0===o||o,c={placement:ne(t.placement),variation:ie(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,oe(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,oe(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var n=t.styles[e]||{},i=t.attributes[e]||{},r=t.elements[e];f(r)&&N(r)&&(Object.assign(r.style,n),Object.keys(i).forEach(function(e){var t=i[e];!1===t?r.removeAttribute(e):r.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(e){var i=t.elements[e],r=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce(function(e,t){return e[t]="",e},{});f(i)&&N(i)&&(Object.assign(i.style,s),Object.keys(r).forEach(function(e){i.removeAttribute(e)}))})}},requires:["computeStyles"]},le,{name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var r=n.mainAxis,s=void 0===r||r,a=n.altAxis,o=void 0===a||a,l=n.fallbackPlacements,c=n.padding,d=n.boundary,u=n.rootBoundary,h=n.altBoundary,p=n.flipVariations,m=void 0===p||p,f=n.allowedAutoPlacements,g=t.options.placement,x=ne(g),y=l||(x===g||!m?[de(g)]:function(e){if(ne(e)===V)return[];var t=de(e);return[he(e),t,he(t)]}(g)),v=[g].concat(y).reduce(function(e,n){return e.concat(ne(n)===V?function(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=n.boundary,s=n.rootBoundary,a=n.padding,o=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?Z:l,d=ie(i),u=d?o?Y:Y.filter(function(e){return ie(e)===d}):U,h=u.filter(function(e){return c.indexOf(e)>=0});0===h.length&&(h=u);var p=h.reduce(function(t,n){return t[n]=ve(e,{placement:n,boundary:r,rootBoundary:s,padding:a})[ne(n)],t},{});return Object.keys(p).sort(function(e,t){return p[e]-p[t]})}(t,{placement:n,boundary:d,rootBoundary:u,padding:c,flipVariations:m,allowedAutoPlacements:f}):n)},[]),_=t.rects.reference,b=t.rects.popper,w=new Map,j=!0,N=v[0],S=0;S<v.length;S++){var k=v[S],T=ne(k),C=ie(k)===H,E=[z,O].indexOf(T)>=0,A=E?"width":"height",M=ve(t,{placement:k,boundary:d,rootBoundary:u,altBoundary:h,padding:c}),D=E?C?F:B:C?O:z;_[A]>b[A]&&(D=de(D));var I=de(D),P=[];if(s&&P.push(M[T]<=0),o&&P.push(M[D]<=0,M[I]<=0),P.every(function(e){return e})){N=k,j=!1;break}w.set(k,P)}if(j)for(var R=function(e){var t=v.find(function(t){var n=w.get(t);if(n)return n.slice(0,e).every(function(e){return e})});if(t)return N=t,"break"},L=m?3:1;L>0;L--){if("break"===R(L))break}t.placement!==N&&(t.modifiersData[i]._skip=!0,t.placement=N,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},be,we,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,i=t.rects.reference,r=t.rects.popper,s=t.modifiersData.preventOverflow,a=ve(t,{elementContext:"reference"}),o=ve(t,{altBoundary:!0}),l=je(a,i),c=je(o,r,s),d=Ne(l),u=Ne(c);t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}}]}),ke=n(6366),Te=n.n(ke),Ce=[],Ee=function(e,t,n){void 0===n&&(n={});var r=i.useRef(null),s={onFirstUpdate:n.onFirstUpdate,placement:n.placement||"bottom",strategy:n.strategy||"absolute",modifiers:n.modifiers||Ce},a=i.useState({styles:{popper:{position:s.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),o=a[0],l=a[1],c=i.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(e){var t=e.state,n=Object.keys(t.elements);h.flushSync(function(){l({styles:d(n.map(function(e){return[e,t.styles[e]||{}]})),attributes:d(n.map(function(e){return[e,t.attributes[e]]}))})})},requires:["computeStyles"]}},[]),p=i.useMemo(function(){var e={onFirstUpdate:s.onFirstUpdate,placement:s.placement,strategy:s.strategy,modifiers:[].concat(s.modifiers,[c,{name:"applyStyles",enabled:!1}])};return Te()(r.current,e)?r.current||e:(r.current=e,e)},[s.onFirstUpdate,s.placement,s.strategy,s.modifiers,c]),m=i.useRef();return u(function(){m.current&&m.current.setOptions(p)},[p]),u(function(){if(null!=e&&null!=t){var i=(n.createPopper||Se)(e,t,p);return m.current=i,function(){i.destroy(),m.current=null}}},[e,t,n.createPopper]),{state:m.current?m.current.state:null,styles:o.styles,attributes:o.attributes,update:m.current?m.current.update:null,forceUpdate:m.current?m.current.forceUpdate:null}},Ae=function(){},Me=function(){return Promise.resolve(null)},De=[];function Ie(e){var t=e.placement,n=void 0===t?"bottom":t,s=e.strategy,a=void 0===s?"absolute":s,l=e.modifiers,d=void 0===l?De:l,u=e.referenceElement,h=e.onFirstUpdate,p=e.innerRef,m=e.children,f=i.useContext(r),g=i.useState(null),x=g[0],y=g[1],v=i.useState(null),_=v[0],b=v[1];i.useEffect(function(){c(p,x)},[p,x]);var w=i.useMemo(function(){return{placement:n,strategy:a,onFirstUpdate:h,modifiers:[].concat(d,[{name:"arrow",enabled:null!=_,options:{element:_}}])}},[n,a,h,d,_]),j=Ee(u||f,x,w),N=j.state,S=j.styles,k=j.forceUpdate,T=j.update,C=i.useMemo(function(){return{ref:y,style:S.popper,placement:N?N.placement:n,hasPopperEscaped:N&&N.modifiersData.hide?N.modifiersData.hide.hasPopperEscaped:null,isReferenceHidden:N&&N.modifiersData.hide?N.modifiersData.hide.isReferenceHidden:null,arrowProps:{style:S.arrow,ref:b},forceUpdate:k||Ae,update:T||Me}},[y,b,n,N,S,T,k]);return o(m)(C)}var Pe=n(6440),Re=n.n(Pe);function Le(e){var t=e.children,n=e.innerRef,r=i.useContext(s),a=i.useCallback(function(e){c(n,e),l(r,e)},[n,r]);return i.useEffect(function(){return function(){return c(n,null)}},[]),i.useEffect(function(){Re()(Boolean(r),"`Reference` should not be used outside of a `Manager` component.")},[r]),o(t)({ref:a})}},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,d=e[c];if(0>s(l,n))c<r&&0>s(d,l)?(e[i]=d,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<r&&0>s(d,n)))break e;e[i]=d,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,x="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function _(e){for(var t=i(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,n(c,t)}t=i(d)}}function b(e){if(g=!1,_(e),!f)if(null!==i(c))f=!0,I(w);else{var t=i(d);null!==t&&P(b,t.startTime-e)}}function w(e,n){f=!1,g&&(g=!1,y(k),k=-1),m=!0;var s=p;try{for(_(n),h=i(c);null!==h&&(!(h.expirationTime>n)||e&&!E());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===i(c)&&r(c),_(n)}else r(c);h=i(c)}if(null!==h)var l=!0;else{var u=i(d);null!==u&&P(b,u.startTime-n),l=!1}return l}finally{h=null,p=s,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var j,N=!1,S=null,k=-1,T=5,C=-1;function E(){return!(t.unstable_now()-C<T)}function A(){if(null!==S){var e=t.unstable_now();C=e;var n=!0;try{n=S(!0,e)}finally{n?j():(N=!1,S=null)}}else N=!1}if("function"===typeof v)j=function(){v(A)};else if("undefined"!==typeof MessageChannel){var M=new MessageChannel,D=M.port2;M.port1.onmessage=A,j=function(){D.postMessage(null)}}else j=function(){x(A,0)};function I(e){S=e,N||(N=!0,j())}function P(e,n){k=x(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,I(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(d,e),null===i(c)&&e===i(d)&&(g?(y(k),k=-1):g=!0,P(b,s-a))):(e.sortIndex=o,n(c,e),f||m||(f=!0,I(w))),e},t.unstable_shouldYield=E,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},7278:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getTime()<s.getTime()}},7400:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getMinutes()}},7447:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var i=n(6260),r=n(238),s=n(3666);function a(e){return(0,s.A)(1,arguments),(0,r.default)(e,{weekStartsOn:1})}function o(e){(0,s.A)(1,arguments);var t=function(e){(0,s.A)(1,arguments);var t=(0,i.default)(e),n=t.getFullYear(),r=new Date(0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);var o=a(r),l=new Date(0);l.setFullYear(n,0,4),l.setHours(0,0,0,0);var c=a(l);return t.getTime()>=o.getTime()?n+1:t.getTime()>=c.getTime()?n:n-1}(e),n=new Date(0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),a(n)}var l=6048e5;function c(e){(0,s.A)(1,arguments);var t=(0,i.default)(e),n=a(t).getTime()-o(t).getTime();return Math.round(n/l)+1}},7461:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(6819),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=3*(0,i.A)(t);return(0,r.default)(e,n)}},7583:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getTime()===s.getTime()}},7609:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(8355),r=n(234),s=n(3666);function a(e,t){(0,s.A)(2,arguments);var n=(0,i.A)(t);return(0,r.default)(e,-n)}},7823:()=>{},7872:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getSeconds()}},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},8139:(e,t)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=a(e,s(n)))}return e}function s(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return r.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)i.call(e,n)&&e[n]&&(t=a(t,n));return t}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},8150:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getTime()}},8190:()=>{},8349:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getTime()>s.getTime()}},8355:(e,t,n)=>{"use strict";function i(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}n.d(t,{A:()=>i})},8468:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e);return t.setHours(23,59,59,999),t}},8667:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){return(0,r.A)(1,arguments),(0,i.default)(e).getDate()}},8763:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var i={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const r=function(e,t,n){var r,s=i[e];return r="string"===typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function s(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}var a={date:s({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:s({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:s({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var o={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function l(e){return function(t,n){var i;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){var r=e.defaultFormattingWidth||e.defaultWidth,s=null!==n&&void 0!==n&&n.width?String(n.width):r;i=e.formattingValues[s]||e.formattingValues[r]}else{var a=e.defaultWidth,o=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;i=e.values[o]||e.values[a]}return i[e.argumentCallback?e.argumentCallback(t):t]}}function c(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.width,r=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],s=t.match(r);if(!s)return null;var a,o=s[0],l=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return}(l,function(e){return e.test(o)}):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n;return}(l,function(e){return e.test(o)});return a=e.valueCallback?e.valueCallback(c):c,{value:a=n.valueCallback?n.valueCallback(a):a,rest:t.slice(o.length)}}}var d;const u={code:"en-US",formatDistance:r,formatLong:a,formatRelative:function(e,t,n,i){return o[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:l({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:l({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:l({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:l({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:l({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(d={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(d.matchPattern);if(!n)return null;var i=n[0],r=e.match(d.parsePattern);if(!r)return null;var s=d.valueCallback?d.valueCallback(r[0]):r[0];return{value:s=t.valueCallback?t.valueCallback(s):s,rest:e.slice(i.length)}}),era:c({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:c({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:c({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:c({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:c({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},8982:(e,t,n)=>{"use strict";n.d(t,{ef:()=>s,lJ:()=>o,xM:()=>a});var i=["D","DD"],r=["YY","YYYY"];function s(e){return-1!==i.indexOf(e)}function a(e){return-1!==r.indexOf(e)}function o(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}},9129:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e){(0,r.A)(1,arguments);var t=(0,i.default)(e);return Math.floor(t.getMonth()/3)+1}},9170:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(5479),r=n(3666),s=n(8355);function a(e,t){(0,r.A)(2,arguments);var n=(0,s.A)(t);return(0,i.default)(e,-n)}},9275:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t);return n.getFullYear()-s.getFullYear()}},9511:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(6260),r=n(3666),s=n(8355),a=n(2239);function o(e,t){var n,o,l,c,d,u,h,p;(0,r.A)(1,arguments);var m=(0,a.q)(),f=(0,s.A)(null!==(n=null!==(o=null!==(l=null!==(c=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==c?c:null===t||void 0===t||null===(d=t.locale)||void 0===d||null===(u=d.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==l?l:m.weekStartsOn)&&void 0!==o?o:null===(h=m.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.weekStartsOn)&&void 0!==n?n:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,i.default)(e),x=g.getUTCDay(),y=(x<f?7:0)+x-f;return g.setUTCDate(g.getUTCDate()-y),g.setUTCHours(0,0,0,0),g}},9519:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(6260),r=n(3666);function s(e,t){(0,r.A)(2,arguments);var n=(0,i.default)(e).getTime(),s=(0,i.default)(t.start).getTime(),a=(0,i.default)(t.end).getTime();if(!(s<=a))throw new RangeError("Invalid interval");return n>=s&&n<=a}},9993:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P});var i=n(5541),r=n(67),s=n(6260),a=n(3666);var o=n(1049),l=n(1104),c=n(4123),d=n(2217);function u(e,t){for(var n=e<0?"-":"",i=Math.abs(e).toString();i.length<t;)i="0"+i;return n+i}const h={y:function(e,t){var n=e.getUTCFullYear(),i=n>0?n:1-n;return u("yy"===t?i%100:i,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):u(n+1,2)},d:function(e,t){return u(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return u(e.getUTCHours()%12||12,t.length)},H:function(e,t){return u(e.getUTCHours(),t.length)},m:function(e,t){return u(e.getUTCMinutes(),t.length)},s:function(e,t){return u(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,i=e.getUTCMilliseconds();return u(Math.floor(i*Math.pow(10,n-3)),t.length)}};var p="midnight",m="noon",f="morning",g="afternoon",x="evening",y="night";function v(e,t){var n=e>0?"-":"+",i=Math.abs(e),r=Math.floor(i/60),s=i%60;if(0===s)return n+String(r);var a=t||"";return n+String(r)+a+u(s,2)}function _(e,t){return e%60===0?(e>0?"-":"+")+u(Math.abs(e)/60,2):b(e,t)}function b(e,t){var n=t||"",i=e>0?"-":"+",r=Math.abs(e);return i+u(Math.floor(r/60),2)+n+u(r%60,2)}const w={G:function(e,t,n){var i=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(i,{width:"abbreviated"});case"GGGGG":return n.era(i,{width:"narrow"});default:return n.era(i,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var i=e.getUTCFullYear(),r=i>0?i:1-i;return n.ordinalNumber(r,{unit:"year"})}return h.y(e,t)},Y:function(e,t,n,i){var r=(0,d.A)(e,i),s=r>0?r:1-r;return"YY"===t?u(s%100,2):"Yo"===t?n.ordinalNumber(s,{unit:"year"}):u(s,t.length)},R:function(e,t){return u((0,l.A)(e),t.length)},u:function(e,t){return u(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(i);case"QQ":return u(i,2);case"Qo":return n.ordinalNumber(i,{unit:"quarter"});case"QQQ":return n.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(i,{width:"narrow",context:"formatting"});default:return n.quarter(i,{width:"wide",context:"formatting"})}},q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(i);case"qq":return u(i,2);case"qo":return n.ordinalNumber(i,{unit:"quarter"});case"qqq":return n.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(i,{width:"narrow",context:"standalone"});default:return n.quarter(i,{width:"wide",context:"standalone"})}},M:function(e,t,n){var i=e.getUTCMonth();switch(t){case"M":case"MM":return h.M(e,t);case"Mo":return n.ordinalNumber(i+1,{unit:"month"});case"MMM":return n.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(i,{width:"narrow",context:"formatting"});default:return n.month(i,{width:"wide",context:"formatting"})}},L:function(e,t,n){var i=e.getUTCMonth();switch(t){case"L":return String(i+1);case"LL":return u(i+1,2);case"Lo":return n.ordinalNumber(i+1,{unit:"month"});case"LLL":return n.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(i,{width:"narrow",context:"standalone"});default:return n.month(i,{width:"wide",context:"standalone"})}},w:function(e,t,n,i){var r=(0,c.A)(e,i);return"wo"===t?n.ordinalNumber(r,{unit:"week"}):u(r,t.length)},I:function(e,t,n){var i=(0,o.A)(e);return"Io"===t?n.ordinalNumber(i,{unit:"week"}):u(i,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):h.d(e,t)},D:function(e,t,n){var i=function(e){(0,a.A)(1,arguments);var t=(0,s.default)(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var i=n-t.getTime();return Math.floor(i/864e5)+1}(e);return"Do"===t?n.ordinalNumber(i,{unit:"dayOfYear"}):u(i,t.length)},E:function(e,t,n){var i=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},e:function(e,t,n,i){var r=e.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return u(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},c:function(e,t,n,i){var r=e.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return u(s,t.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"});default:return n.day(r,{width:"wide",context:"standalone"})}},i:function(e,t,n){var i=e.getUTCDay(),r=0===i?7:i;switch(t){case"i":return String(r);case"ii":return u(r,t.length);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return n.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},a:function(e,t,n){var i=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var i,r=e.getUTCHours();switch(i=12===r?m:0===r?p:r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var i,r=e.getUTCHours();switch(i=r>=17?x:r>=12?g:r>=4?f:y,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var i=e.getUTCHours()%12;return 0===i&&(i=12),n.ordinalNumber(i,{unit:"hour"})}return h.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):h.H(e,t)},K:function(e,t,n){var i=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(i,{unit:"hour"}):u(i,t.length)},k:function(e,t,n){var i=e.getUTCHours();return 0===i&&(i=24),"ko"===t?n.ordinalNumber(i,{unit:"hour"}):u(i,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):h.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):h.s(e,t)},S:function(e,t){return h.S(e,t)},X:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return _(r);case"XXXX":case"XX":return b(r);default:return b(r,":")}},x:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"x":return _(r);case"xxxx":case"xx":return b(r);default:return b(r,":")}},O:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+v(r,":");default:return"GMT"+b(r,":")}},z:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+v(r,":");default:return"GMT"+b(r,":")}},t:function(e,t,n,i){var r=i._originalDate||e;return u(Math.floor(r.getTime()/1e3),t.length)},T:function(e,t,n,i){return u((i._originalDate||e).getTime(),t.length)}};var j=n(6087),N=n(4967),S=n(8982),k=n(8355),T=n(2239),C=n(8763),E=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,A=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,M=/^'([^]*?)'?$/,D=/''/g,I=/[a-zA-Z]/;function P(e,t,n){var o,l,c,d,u,h,p,m,f,g,x,y,v,_,b,P,R,L;(0,a.A)(2,arguments);var z=String(t),O=(0,T.q)(),F=null!==(o=null!==(l=null===n||void 0===n?void 0:n.locale)&&void 0!==l?l:O.locale)&&void 0!==o?o:C.A,B=(0,k.A)(null!==(c=null!==(d=null!==(u=null!==(h=null===n||void 0===n?void 0:n.firstWeekContainsDate)&&void 0!==h?h:null===n||void 0===n||null===(p=n.locale)||void 0===p||null===(m=p.options)||void 0===m?void 0:m.firstWeekContainsDate)&&void 0!==u?u:O.firstWeekContainsDate)&&void 0!==d?d:null===(f=O.locale)||void 0===f||null===(g=f.options)||void 0===g?void 0:g.firstWeekContainsDate)&&void 0!==c?c:1);if(!(B>=1&&B<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var V=(0,k.A)(null!==(x=null!==(y=null!==(v=null!==(_=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==_?_:null===n||void 0===n||null===(b=n.locale)||void 0===b||null===(P=b.options)||void 0===P?void 0:P.weekStartsOn)&&void 0!==v?v:O.weekStartsOn)&&void 0!==y?y:null===(R=O.locale)||void 0===R||null===(L=R.options)||void 0===L?void 0:L.weekStartsOn)&&void 0!==x?x:0);if(!(V>=0&&V<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!F.localize)throw new RangeError("locale must contain localize property");if(!F.formatLong)throw new RangeError("locale must contain formatLong property");var U=(0,s.default)(e);if(!(0,i.default)(U))throw new RangeError("Invalid time value");var H=(0,N.A)(U),q=(0,r.A)(U,H),W={firstWeekContainsDate:B,weekStartsOn:V,locale:F,_originalDate:U};return z.match(A).map(function(e){var t=e[0];return"p"===t||"P"===t?(0,j.A[t])(e,F.formatLong):e}).join("").match(E).map(function(i){if("''"===i)return"'";var r=i[0];if("'"===r)return function(e){var t=e.match(M);if(!t)return e;return t[1].replace(D,"'")}(i);var s=w[r];if(s)return null!==n&&void 0!==n&&n.useAdditionalWeekYearTokens||!(0,S.xM)(i)||(0,S.lJ)(i,t,String(e)),null!==n&&void 0!==n&&n.useAdditionalDayOfYearTokens||!(0,S.ef)(i)||(0,S.lJ)(i,t,String(e)),s(q,i,F.localize,W);if(r.match(I))throw new RangeError("Format string contains an unescaped latin alphabet character `"+r+"`");return i}).join("")}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var s=Object.create(null);n.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&i;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>i[e]);return a.default=()=>i,n.d(s,a),s}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,i)=>(n.f[i](e,t),t),[])),n.u=e=>"static/js/"+e+".c297c937.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="yatrik-erp-frontend:";n.l=(i,r,s,a)=>{if(e[i])e[i].push(r);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+s){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+s),o.src=i),e[i]=[r];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach(e=>e(n)),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var s=new Promise((n,i)=>r=e[t]=[n,i]);i.push(r[2]=s);var a=n.p+n.u(t),o=new Error;n.l(a,i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,r[1](o)}},"chunk-"+t,t)}};var t=(t,i)=>{var r,s,a=i[0],o=i[1],l=i[2],c=0;if(a.some(t=>0!==e[t])){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(l)l(n)}for(t&&t(i);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.webpackChunkyatrik_erp_frontend=self.webpackChunkyatrik_erp_frontend||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{Decoder:()=>rm,Encoder:()=>nm,PacketType:()=>tm,protocol:()=>em});var t,i=n(5043),r=n.t(i,2),s=n(4391),a=n(7950),o=n.t(a,2);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(t||(t={}));const c="popstate";function d(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function u(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(wd){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function p(e,t,n,i){return void 0===n&&(n=null),l({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?f(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function m(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function f(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function g(e,n,i,r){void 0===r&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,o=s.history,u=t.Pop,f=null,g=x();function x(){return(o.state||{idx:null}).idx}function y(){u=t.Pop;let e=x(),n=null==e?null:e-g;g=e,f&&f({action:u,location:_.location,delta:n})}function v(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,n="string"===typeof e?e:m(e);return n=n.replace(/ $/,"%20"),d(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,o.replaceState(l({},o.state,{idx:g}),""));let _={get action(){return u},get location(){return e(s,o)},listen(e){if(f)throw new Error("A history only accepts one active listener");return s.addEventListener(c,y),f=e,()=>{s.removeEventListener(c,y),f=null}},createHref:e=>n(s,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,n){u=t.Push;let r=p(_.location,e,n);i&&i(r,e),g=x()+1;let l=h(r,g),c=_.createHref(r);try{o.pushState(l,"",c)}catch(d){if(d instanceof DOMException&&"DataCloneError"===d.name)throw d;s.location.assign(c)}a&&f&&f({action:u,location:_.location,delta:1})},replace:function(e,n){u=t.Replace;let r=p(_.location,e,n);i&&i(r,e),g=x();let s=h(r,g),l=_.createHref(r);o.replaceState(s,"",l),a&&f&&f({action:u,location:_.location,delta:0})},go:e=>o.go(e)};return _}var x;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(x||(x={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(e,t,n){return void 0===n&&(n="/"),v(e,t,n,!1)}function v(e,t,n,i){let r=I(("string"===typeof t?f(t):t).pathname||"/",n);if(null==r)return null;let s=_(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(s);let a=null;for(let o=0;null==a&&o<s.length;++o){let e=D(r);a=A(s[o],e,i)}return a}function _(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(e,r,s)=>{let a={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(d(a.relativePath.startsWith(i),'Absolute route path "'+a.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(i.length));let o=O([i,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(d(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),_(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:E(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of b(e.path))r(e,t,i);else r(e,t)}),t}function b(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===i.length)return r?[s,""]:[s];let a=b(i.join("/")),o=[];return o.push(...a.map(e=>""===e?s:[s,e].join("/"))),r&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const w=/^:[\w-]+$/,j=3,N=2,S=1,k=10,T=-2,C=e=>"*"===e;function E(e,t){let n=e.split("/"),i=n.length;return n.some(C)&&(i+=T),t&&(i+=N),n.filter(e=>!C(e)).reduce((e,t)=>e+(w.test(t)?j:""===t?S:k),i)}function A(e,t,n){void 0===n&&(n=!1);let{routesMeta:i}=e,r={},s="/",a=[];for(let o=0;o<i.length;++o){let e=i[o],l=o===i.length-1,c="/"===s?t:t.slice(s.length)||"/",d=M({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!d&&l&&n&&!i[i.length-1].route.index&&(d=M({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!d)return null;Object.assign(r,d.params),a.push({params:r,pathname:O([s,d.pathname]),pathnameBase:F(O([s,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(s=O([s,d.pathnameBase]))}return a}function M(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);u("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(i.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let s=new RegExp(r,t?void 0:"i");return[s,i]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1),l=i.reduce((e,t,n)=>{let{paramName:i,isOptional:r}=t;if("*"===i){let e=o[n]||"";a=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[i]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{});return{params:l,pathname:s,pathnameBase:a,pattern:e}}function D(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return u(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function I(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}function P(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function R(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function L(e,t){let n=R(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function z(e,t,n,i){let r;void 0===i&&(i=!1),"string"===typeof e?r=f(e):(r=l({},e),d(!r.pathname||!r.pathname.includes("?"),P("?","pathname","search",r)),d(!r.pathname||!r.pathname.includes("#"),P("#","pathname","hash",r)),d(!r.search||!r.search.includes("#"),P("#","search","hash",r)));let s,a=""===e||""===r.pathname,o=a?"/":r.pathname;if(null==o)s=n;else{let e=t.length-1;if(!i&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}s=e>=0?t[e]:"/"}let c=function(e,t){void 0===t&&(t="/");let{pathname:n,search:i="",hash:r=""}="string"===typeof e?f(e):e,s=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:s,search:B(i),hash:V(r)}}(r,s),u=o&&"/"!==o&&o.endsWith("/"),h=(a||"."===o)&&n.endsWith("/");return c.pathname.endsWith("/")||!u&&!h||(c.pathname+="/"),c}const O=e=>e.join("/").replace(/\/\/+/g,"/"),F=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),B=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",V=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function U(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const H=["post","put","patch","delete"],q=(new Set(H),["get",...H]);new Set(q),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},W.apply(this,arguments)}const G=i.createContext(null);const Y=i.createContext(null);const Z=i.createContext(null);const X=i.createContext(null);const K=i.createContext({outlet:null,matches:[],isDataRoute:!1});const Q=i.createContext(null);function J(){return null!=i.useContext(X)}function $(){return J()||d(!1),i.useContext(X).location}function ee(e){i.useContext(Z).static||i.useLayoutEffect(e)}function te(){let{isDataRoute:e}=i.useContext(K);return e?function(){let{router:e}=he(de.UseNavigateStable),t=me(ue.UseNavigateStable),n=i.useRef(!1);ee(()=>{n.current=!0});let r=i.useCallback(function(i,r){void 0===r&&(r={}),n.current&&("number"===typeof i?e.navigate(i):e.navigate(i,W({fromRouteId:t},r)))},[e,t]);return r}():function(){J()||d(!1);let e=i.useContext(G),{basename:t,future:n,navigator:r}=i.useContext(Z),{matches:s}=i.useContext(K),{pathname:a}=$(),o=JSON.stringify(L(s,n.v7_relativeSplatPath)),l=i.useRef(!1);ee(()=>{l.current=!0});let c=i.useCallback(function(n,i){if(void 0===i&&(i={}),!l.current)return;if("number"===typeof n)return void r.go(n);let s=z(n,JSON.parse(o),a,"path"===i.relative);null==e&&"/"!==t&&(s.pathname="/"===s.pathname?t:O([t,s.pathname])),(i.replace?r.replace:r.push)(s,i.state,i)},[t,r,o,a,e]);return c}()}function ne(){let{matches:e}=i.useContext(K),t=e[e.length-1];return t?t.params:{}}function ie(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=i.useContext(Z),{matches:s}=i.useContext(K),{pathname:a}=$(),o=JSON.stringify(L(s,r.v7_relativeSplatPath));return i.useMemo(()=>z(e,JSON.parse(o),a,"path"===n),[e,o,a,n])}function re(e,n,r,s){J()||d(!1);let{navigator:a}=i.useContext(Z),{matches:o}=i.useContext(K),l=o[o.length-1],c=l?l.params:{},u=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let h,p=$();if(n){var m;let e="string"===typeof n?f(n):n;"/"===u||(null==(m=e.pathname)?void 0:m.startsWith(u))||d(!1),h=e}else h=p;let g=h.pathname||"/",x=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=y(e,{pathname:x});let _=ce(v&&v.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:O([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:O([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,r,s);return n&&_?i.createElement(X.Provider,{value:{location:W({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:t.Pop}},_):_}function se(){let e=function(){var e;let t=i.useContext(Q),n=pe(ue.UseRouteError),r=me(ue.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=U(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r};return i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},t),n?i.createElement("pre",{style:s},n):null,null)}const ae=i.createElement(se,null);class oe extends i.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?i.createElement(K.Provider,{value:this.props.routeContext},i.createElement(Q.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function le(e){let{routeContext:t,match:n,children:r}=e,s=i.useContext(G);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),i.createElement(K.Provider,{value:t},r)}function ce(e,t,n,r){var s;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var a;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(a=r)&&a.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let o=e,l=null==(s=n)?void 0:s.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||d(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let i=0;i<o.length;i++){let e=o[i];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=i),e.route.id){let{loaderData:t,errors:i}=n,r=e.route.loader&&void 0===t[e.route.id]&&(!i||void 0===i[e.route.id]);if(e.route.lazy||r){c=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,r,s)=>{let a,d=!1,h=null,p=null;var m;n&&(a=l&&r.route.id?l[r.route.id]:void 0,h=r.route.errorElement||ae,c&&(u<0&&0===s?(m="route-fallback",!1||fe[m]||(fe[m]=!0),d=!0,p=null):u===s&&(d=!0,p=r.route.hydrateFallbackElement||null)));let f=t.concat(o.slice(0,s+1)),g=()=>{let t;return t=a?h:d?p:r.route.Component?i.createElement(r.route.Component,null):r.route.element?r.route.element:e,i.createElement(le,{match:r,routeContext:{outlet:e,matches:f,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===s)?i.createElement(oe,{location:n.location,revalidation:n.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):g()},null)}var de=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(de||{}),ue=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ue||{});function he(e){let t=i.useContext(G);return t||d(!1),t}function pe(e){let t=i.useContext(Y);return t||d(!1),t}function me(e){let t=function(){let e=i.useContext(K);return e||d(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||d(!1),n.route.id}const fe={};function ge(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function xe(e){let{to:t,replace:n,state:r,relative:s}=e;J()||d(!1);let{future:a,static:o}=i.useContext(Z),{matches:l}=i.useContext(K),{pathname:c}=$(),u=te(),h=z(t,L(l,a.v7_relativeSplatPath),c,"path"===s),p=JSON.stringify(h);return i.useEffect(()=>u(JSON.parse(p),{replace:n,state:r,relative:s}),[u,p,s,n,r]),null}function ye(e){d(!1)}function ve(e){let{basename:n="/",children:r=null,location:s,navigationType:a=t.Pop,navigator:o,static:l=!1,future:c}=e;J()&&d(!1);let u=n.replace(/^\/*/,"/"),h=i.useMemo(()=>({basename:u,navigator:o,static:l,future:W({v7_relativeSplatPath:!1},c)}),[u,c,o,l]);"string"===typeof s&&(s=f(s));let{pathname:p="/",search:m="",hash:g="",state:x=null,key:y="default"}=s,v=i.useMemo(()=>{let e=I(p,u);return null==e?null:{location:{pathname:e,search:m,hash:g,state:x,key:y},navigationType:a}},[u,p,m,g,x,y,a]);return null==v?null:i.createElement(Z.Provider,{value:h},i.createElement(X.Provider,{children:r,value:v}))}function _e(e){let{children:t,location:n}=e;return re(be(t),n)}new Promise(()=>{});i.Component;function be(e,t){void 0===t&&(t=[]);let n=[];return i.Children.forEach(e,(e,r)=>{if(!i.isValidElement(e))return;let s=[...t,r];if(e.type===i.Fragment)return void n.push.apply(n,be(e.props.children,s));e.type!==ye&&d(!1),e.props.index&&e.props.children&&d(!1);let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=be(e.props.children,s)),n.push(a)}),n}function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},we.apply(this,arguments)}function je(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function Ne(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let i=e[n];return t.concat(Array.isArray(i)?i.map(e=>[n,e]):[[n,i]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Se=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(wd){}new Map;const ke=r.startTransition;o.flushSync,r.useId;function Te(e){let{basename:t,children:n,future:r,window:s}=e,a=i.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:s,v5Compat:!0})&&(o={}),g(function(e,t){let{pathname:n,search:i,hash:r}=e.location;return p("",{pathname:n,search:i,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:m(t)},null,o)));let l=a.current,[c,d]=i.useState({action:l.action,location:l.location}),{v7_startTransition:u}=r||{},h=i.useCallback(e=>{u&&ke?ke(()=>d(e)):d(e)},[d,u]);return i.useLayoutEffect(()=>l.listen(h),[l,h]),i.useEffect(()=>ge(r),[r]),i.createElement(ve,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:l,future:r})}const Ce="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ae=i.forwardRef(function(e,t){let n,{onClick:r,relative:s,reloadDocument:a,replace:o,state:l,target:c,to:u,preventScrollReset:h,viewTransition:p}=e,f=je(e,Se),{basename:g}=i.useContext(Z),x=!1;if("string"===typeof u&&Ee.test(u)&&(n=u,Ce))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=I(t.pathname,g);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:x=!0}catch(wd){}let y=function(e,t){let{relative:n}=void 0===t?{}:t;J()||d(!1);let{basename:r,navigator:s}=i.useContext(Z),{hash:a,pathname:o,search:l}=ie(e,{relative:n}),c=o;return"/"!==r&&(c="/"===o?r:O([r,o])),s.createHref({pathname:c,search:l,hash:a})}(u,{relative:s}),v=function(e,t){let{target:n,replace:r,state:s,preventScrollReset:a,relative:o,viewTransition:l}=void 0===t?{}:t,c=te(),d=$(),u=ie(e,{relative:o});return i.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:m(d)===m(u);c(e,{replace:n,state:s,preventScrollReset:a,relative:o,viewTransition:l})}},[d,c,u,r,s,n,e,a,o,l])}(u,{replace:o,state:l,target:c,preventScrollReset:h,relative:s,viewTransition:p});return i.createElement("a",we({},f,{href:n||y,onClick:x||a?r:function(e){r&&r(e),e.defaultPrevented||v(e)},ref:t,target:c}))});var Me,De;function Ie(e){let t=i.useRef(Ne(e)),n=i.useRef(!1),r=$(),s=i.useMemo(()=>function(e,t){let n=Ne(e);return t&&t.forEach((e,i)=>{n.has(i)||t.getAll(i).forEach(e=>{n.append(i,e)})}),n}(r.search,n.current?null:t.current),[r.search]),a=te(),o=i.useCallback((e,t)=>{const i=Ne("function"===typeof e?e(s):e);n.current=!0,a("?"+i,t)},[a,s]);return[s,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Me||(Me={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(De||(De={}));var Pe=n(4467);function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach(function(t){(0,Pe.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ze=n(579);const Oe=(0,i.createContext)(),Fe=()=>{const e=(0,i.useContext)(Oe);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Be=e=>{let{children:t}=e;const[n,r]=(0,i.useState)(null),[s,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>{const e=localStorage.getItem("token"),t=localStorage.getItem("user"),n=localStorage.getItem("depotToken"),i=localStorage.getItem("depotUser");if(n&&i)try{const e=JSON.parse(i);e&&e._id&&e.role?r(e):(localStorage.removeItem("depotToken"),localStorage.removeItem("depotUser"),localStorage.removeItem("depotInfo"))}catch(s){console.error("Error parsing depot user data:",s),localStorage.removeItem("depotToken"),localStorage.removeItem("depotUser"),localStorage.removeItem("depotInfo")}else if(e&&t)try{const e=JSON.parse(t);e&&e._id&&e.role?r(e):(localStorage.removeItem("token"),localStorage.removeItem("user"))}catch(s){console.error("Error parsing user data:",s),localStorage.removeItem("token"),localStorage.removeItem("user")}a(!1)},[]);const u={user:n,login:(0,i.useCallback)(async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!c){d(!0),console.log("AuthContext.login called:",{userData:e,token:t,isDepotUser:n});try{if(!e||!e._id||!e.role)throw new Error("Invalid user data");let i=e.role;"string"===typeof i&&(i=i.toLowerCase().trim(),"administrator"===i&&(i="admin"),"depot-manager"!==i&&"depotmanager"!==i||(i="depot_manager"));const s=Le(Le({},e),{},{role:i});console.log("AuthContext - Normalized user data:",{originalRole:e.role,normalizedRole:s.role,userId:s._id,userName:s.name,userEmail:s.email,isDepotUser:n}),r(s),n?await Promise.all([localStorage.setItem("depotToken",t),localStorage.setItem("depotUser",JSON.stringify(s))]):await Promise.all([localStorage.setItem("token",t),localStorage.setItem("user",JSON.stringify(s))]),console.log("AuthContext.login completed, user state updated:",s)}catch(i){throw console.error("Login error:",i),i}finally{d(!1)}}},[c]),logout:(0,i.useCallback)(async()=>{o||(l(!0),r(null),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("depotToken"),localStorage.removeItem("depotUser"),localStorage.removeItem("depotInfo"),l(!1))},[o]),loading:s,isLoggingOut:o,isLoggingIn:c};return(0,ze.jsx)(Oe.Provider,{value:u,children:t})};function Ve(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ue(e,t,n){Ve(e,t),t.set(e,n)}function He(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function qe(e,t){return e.get(He(e,t))}function We(e,t,n){return e.set(He(e,t),n),n}var Ge="undefined"===typeof window||"Deno"in window;function Ye(){}function Ze(e){return"number"===typeof e&&e>=0&&e!==1/0}function Xe(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Ke(e,t){const{type:n="all",exact:i,fetchStatus:r,predicate:s,queryKey:a,stale:o}=e;if(a)if(i){if(t.queryHash!==Je(a,t.options))return!1}else if(!et(t.queryKey,a))return!1;if("all"!==n){const e=t.isActive();if("active"===n&&!e)return!1;if("inactive"===n&&e)return!1}return("boolean"!==typeof o||t.isStale()===o)&&(("undefined"===typeof r||r===t.state.fetchStatus)&&!(s&&!s(t)))}function Qe(e,t){const{exact:n,status:i,predicate:r,mutationKey:s}=e;if(s){if(!t.options.mutationKey)return!1;if(n){if($e(t.options.mutationKey)!==$e(s))return!1}else if(!et(t.options.mutationKey,s))return!1}return(!i||t.state.status===i)&&!(r&&!r(t))}function Je(e,t){return((null===t||void 0===t?void 0:t.queryKeyHashFn)||$e)(e)}function $e(e){return JSON.stringify(e,(e,t)=>rt(t)?Object.keys(t).sort().reduce((e,n)=>(e[n]=t[n],e),{}):t)}function et(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&!Object.keys(t).some(n=>!et(e[n],t[n])))}function tt(e,t){if(e===t)return e;const n=it(e)&&it(t);if(n||rt(e)&&rt(t)){const i=n?e.length:Object.keys(e).length,r=n?t:Object.keys(t),s=r.length,a=n?[]:{};let o=0;for(let l=0;l<s;l++){const i=n?l:r[l];a[i]=tt(e[i],t[i]),a[i]===e[i]&&o++}return i===s&&o===i?e:a}return t}function nt(e,t){if(e&&!t||t&&!e)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function it(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function rt(e){if(!st(e))return!1;const t=e.constructor;if("undefined"===typeof t)return!0;const n=t.prototype;return!!st(n)&&!!n.hasOwnProperty("isPrototypeOf")}function st(e){return"[object Object]"===Object.prototype.toString.call(e)}function at(e,t,n){return"function"===typeof n.structuralSharing?n.structuralSharing(e,t):!1!==n.structuralSharing?tt(e,t):t}function ot(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=[...e,t];return n&&i.length>n?i.slice(1):i}function lt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=[t,...e];return n&&i.length>n?i.slice(0,-1):i}function ct(e,t){Ve(e,t),t.add(e)}var dt,ut,ht,pt,mt,ft,gt=function(){let e=[],t=0,n=e=>{e()},i=e=>{e()},r=e=>setTimeout(e,0);const s=i=>{t?e.push(i):r(()=>{n(i)})},a=()=>{const t=e;e=[],t.length&&r(()=>{i(()=>{t.forEach(e=>{n(e)})})})};return{batch:e=>{let n;t++;try{n=e()}finally{t--,t||a()}return n},batchCalls:e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];s(()=>{e(...n)})},schedule:s,setNotifyFunction:e=>{n=e},setBatchNotifyFunction:e=>{i=e},setScheduler:e=>{r=e}}}(),xt=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},yt=new(dt=new WeakMap,ut=new WeakMap,ht=new WeakMap,class extends xt{constructor(){super(),Ue(this,dt,void 0),Ue(this,ut,void 0),Ue(this,ht,void 0),We(ht,this,e=>{if(!Ge&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){qe(ut,this)||this.setEventListener(qe(ht,this))}onUnsubscribe(){var e;this.hasListeners()||(null===(e=qe(ut,this))||void 0===e||e.call(this),We(ut,this,void 0))}setEventListener(e){var t;We(ht,this,e),null===(t=qe(ut,this))||void 0===t||t.call(this),We(ut,this,e(e=>{"boolean"===typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){qe(dt,this)!==e&&(We(dt,this,e),this.onFocus())}onFocus(){this.listeners.forEach(e=>{e()})}isFocused(){var e;return"boolean"===typeof qe(dt,this)?qe(dt,this):"hidden"!==(null===(e=globalThis.document)||void 0===e?void 0:e.visibilityState)}}),vt=new(pt=new WeakMap,mt=new WeakMap,ft=new WeakMap,class extends xt{constructor(){super(),Ue(this,pt,!0),Ue(this,mt,void 0),Ue(this,ft,void 0),We(ft,this,e=>{if(!Ge&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}})}onSubscribe(){qe(mt,this)||this.setEventListener(qe(ft,this))}onUnsubscribe(){var e;this.hasListeners()||(null===(e=qe(mt,this))||void 0===e||e.call(this),We(mt,this,void 0))}setEventListener(e){var t;We(ft,this,e),null===(t=qe(mt,this))||void 0===t||t.call(this),We(mt,this,e(this.setOnline.bind(this)))}setOnline(e){qe(pt,this)!==e&&(We(pt,this,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return qe(pt,this)}});function _t(e){return Math.min(1e3*2**e,3e4)}function bt(e){return"online"!==(null!==e&&void 0!==e?e:"online")||vt.isOnline()}var wt,jt=class{constructor(e){this.revert=null===e||void 0===e?void 0:e.revert,this.silent=null===e||void 0===e?void 0:e.silent}};function Nt(e){return e instanceof jt}function St(e){let t,n,i,r=!1,s=0,a=!1;const o=new Promise((e,t)=>{n=e,i=t}),l=()=>!yt.isFocused()||"always"!==e.networkMode&&!vt.isOnline(),c=i=>{var r,s;a||(a=!0,null===(r=e.onSuccess)||void 0===r||r.call(e,i),null===(s=t)||void 0===s||s(),n(i))},d=n=>{var r,s;a||(a=!0,null===(r=e.onError)||void 0===r||r.call(e,n),null===(s=t)||void 0===s||s(),i(n))},u=()=>new Promise(n=>{var i;t=e=>{const t=a||!l();return t&&n(e),t},null===(i=e.onPause)||void 0===i||i.call(e)}).then(()=>{var n;(t=void 0,a)||(null===(n=e.onContinue)||void 0===n||n.call(e))}),h=()=>{if(a)return;let t;try{t=e.fn()}catch(n){t=Promise.reject(n)}Promise.resolve(t).then(c).catch(t=>{var n,i,o;if(a)return;const c=null!==(n=e.retry)&&void 0!==n?n:Ge?0:3,p=null!==(i=e.retryDelay)&&void 0!==i?i:_t,m="function"===typeof p?p(s,t):p,f=!0===c||"number"===typeof c&&s<c||"function"===typeof c&&c(s,t);var g;!r&&f?(s++,null===(o=e.onFail)||void 0===o||o.call(e,s,t),(g=m,new Promise(e=>{setTimeout(e,g)})).then(()=>{if(l())return u()}).then(()=>{r?d(t):h()})):d(t)})};return bt(e.networkMode)?h():u().then(h),{promise:o,cancel:t=>{var n;a||(d(new jt(t)),null===(n=e.abort)||void 0===n||n.call(e))},continue:()=>{var e;return(null===(e=t)||void 0===e?void 0:e())?o:Promise.resolve()},cancelRetry:()=>{r=!0},continueRetry:()=>{r=!1}}}var kt,Tt,Ct,Et,At,Mt,Dt,It,Pt,Rt,Lt=(wt=new WeakMap,class{constructor(){Ue(this,wt,void 0)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Ze(this.gcTime)&&We(wt,this,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,null!==e&&void 0!==e?e:Ge?1/0:3e5)}clearGcTimeout(){qe(wt,this)&&(clearTimeout(qe(wt,this)),We(wt,this,void 0))}}),zt=(kt=new WeakMap,Tt=new WeakMap,Ct=new WeakMap,Et=new WeakMap,At=new WeakMap,Mt=new WeakMap,Dt=new WeakMap,It=new WeakMap,Pt=new WeakSet,class extends Lt{constructor(e){super(),ct(this,Pt),Ue(this,kt,void 0),Ue(this,Tt,void 0),Ue(this,Ct,void 0),Ue(this,Et,void 0),Ue(this,At,void 0),Ue(this,Mt,void 0),Ue(this,Dt,void 0),Ue(this,It,void 0),We(It,this,!1),We(Dt,this,e.defaultOptions),He(Pt,this,Ot).call(this,e.options),We(Mt,this,[]),We(Ct,this,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,We(kt,this,e.state||function(e){const t="function"===typeof e.initialData?e.initialData():e.initialData,n="undefined"!==typeof t,i=n?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?null!==i&&void 0!==i?i:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}(this.options)),this.state=qe(kt,this),this.scheduleGc()}get meta(){return this.options.meta}optionalRemove(){qe(Mt,this).length||"idle"!==this.state.fetchStatus||qe(Ct,this).remove(this)}setData(e,t){const n=at(this.state.data,e,this.options);return He(Pt,this,Ft).call(this,{data:n,type:"success",dataUpdatedAt:null===t||void 0===t?void 0:t.updatedAt,manual:null===t||void 0===t?void 0:t.manual}),n}setState(e,t){He(Pt,this,Ft).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var t;const n=qe(Et,this);return null===(t=qe(At,this))||void 0===t||t.cancel(e),n?n.then(Ye).catch(Ye):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(qe(kt,this))}isActive(){return qe(Mt,this).some(e=>!1!==e.options.enabled)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||qe(Mt,this).some(e=>e.getCurrentResult().isStale)}isStaleByTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.state.isInvalidated||!this.state.dataUpdatedAt||!Xe(this.state.dataUpdatedAt,e)}onFocus(){var e;const t=qe(Mt,this).find(e=>e.shouldFetchOnWindowFocus());null===t||void 0===t||t.refetch({cancelRefetch:!1}),null===(e=qe(At,this))||void 0===e||e.continue()}onOnline(){var e;const t=qe(Mt,this).find(e=>e.shouldFetchOnReconnect());null===t||void 0===t||t.refetch({cancelRefetch:!1}),null===(e=qe(At,this))||void 0===e||e.continue()}addObserver(e){qe(Mt,this).includes(e)||(qe(Mt,this).push(e),this.clearGcTimeout(),qe(Ct,this).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){qe(Mt,this).includes(e)&&(We(Mt,this,qe(Mt,this).filter(t=>t!==e)),qe(Mt,this).length||(qe(At,this)&&(qe(It,this)?qe(At,this).cancel({revert:!0}):qe(At,this).cancelRetry()),this.scheduleGc()),qe(Ct,this).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return qe(Mt,this).length}invalidate(){this.state.isInvalidated||He(Pt,this,Ft).call(this,{type:"invalidate"})}fetch(e,t){var n,i;if("idle"!==this.state.fetchStatus)if(this.state.dataUpdatedAt&&null!==t&&void 0!==t&&t.cancelRefetch)this.cancel({silent:!0});else if(qe(Et,this)){var r;return null===(r=qe(At,this))||void 0===r||r.continueRetry(),qe(Et,this)}if(e&&He(Pt,this,Ot).call(this,e),!this.options.queryFn){const e=qe(Mt,this).find(e=>e.options.queryFn);e&&He(Pt,this,Ot).call(this,e.options)}const s=new AbortController,a={queryKey:this.queryKey,meta:this.meta},o=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(We(It,this,!0),s.signal)})};o(a);const l={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:()=>this.options.queryFn?(We(It,this,!1),this.options.persister?this.options.persister(this.options.queryFn,a,this):this.options.queryFn(a)):Promise.reject(new Error("Missing queryFn: '".concat(this.options.queryHash,"'")))};var c;(o(l),null===(n=this.options.behavior)||void 0===n||n.onFetch(l,this),We(Tt,this,this.state),"idle"===this.state.fetchStatus||this.state.fetchMeta!==(null===(i=l.fetchOptions)||void 0===i?void 0:i.meta))&&He(Pt,this,Ft).call(this,{type:"fetch",meta:null===(c=l.fetchOptions)||void 0===c?void 0:c.meta});const d=e=>{var t,n,i,r;(Nt(e)&&e.silent||He(Pt,this,Ft).call(this,{type:"error",error:e}),Nt(e))||(null===(t=(n=qe(Ct,this).config).onError)||void 0===t||t.call(n,e,this),null===(i=(r=qe(Ct,this).config).onSettled)||void 0===i||i.call(r,this.state.data,e,this));this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return We(At,this,St({fn:l.fetchFn,abort:s.abort.bind(s),onSuccess:e=>{var t,n,i,r;"undefined"!==typeof e?(this.setData(e),null===(t=(n=qe(Ct,this).config).onSuccess)||void 0===t||t.call(n,e,this),null===(i=(r=qe(Ct,this).config).onSettled)||void 0===i||i.call(r,e,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1):d(new Error("".concat(this.queryHash," data is undefined")))},onError:d,onFail:(e,t)=>{He(Pt,this,Ft).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{He(Pt,this,Ft).call(this,{type:"pause"})},onContinue:()=>{He(Pt,this,Ft).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode})),We(Et,this,qe(At,this).promise),qe(Et,this)}});function Ot(e){this.options=Le(Le({},qe(Dt,this)),e),this.updateGcTime(this.options.gcTime)}function Ft(e){this.state=(t=>{var n,i;switch(e.type){case"failed":return Le(Le({},t),{},{fetchFailureCount:e.failureCount,fetchFailureReason:e.error});case"pause":return Le(Le({},t),{},{fetchStatus:"paused"});case"continue":return Le(Le({},t),{},{fetchStatus:"fetching"});case"fetch":return Le(Le({},t),{},{fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null!==(n=e.meta)&&void 0!==n?n:null,fetchStatus:bt(this.options.networkMode)?"fetching":"paused"},!t.dataUpdatedAt&&{error:null,status:"pending"});case"success":return Le(Le({},t),{},{data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:null!==(i=e.dataUpdatedAt)&&void 0!==i?i:Date.now(),error:null,isInvalidated:!1,status:"success"},!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null});case"error":const r=e.error;return Nt(r)&&r.revert&&qe(Tt,this)?Le(Le({},qe(Tt,this)),{},{fetchStatus:"idle"}):Le(Le({},t),{},{error:r,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"});case"invalidate":return Le(Le({},t),{},{isInvalidated:!0});case"setState":return Le(Le({},t),e.state)}})(this.state),gt.batch(()=>{qe(Mt,this).forEach(e=>{e.onQueryUpdate()}),qe(Ct,this).notify({query:this,type:"updated",action:e})})}var Bt,Vt,Ut,Ht,qt,Wt,Gt,Yt,Zt=(Rt=new WeakMap,class extends xt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),Ue(this,Rt,void 0),this.config=e,We(Rt,this,new Map)}build(e,t,n){var i;const r=t.queryKey,s=null!==(i=t.queryHash)&&void 0!==i?i:Je(r,t);let a=this.get(s);return a||(a=new zt({cache:this,queryKey:r,queryHash:s,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r)}),this.add(a)),a}add(e){qe(Rt,this).has(e.queryHash)||(qe(Rt,this).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=qe(Rt,this).get(e.queryHash);t&&(e.destroy(),t===e&&qe(Rt,this).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){gt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return qe(Rt,this).get(e)}getAll(){return[...qe(Rt,this).values()]}find(e){const t=Le({exact:!0},e);return this.getAll().find(e=>Ke(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>Ke(e,t)):t}notify(e){gt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){gt.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){gt.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}}),Xt=(Bt=new WeakMap,Vt=new WeakMap,Ut=new WeakMap,Ht=new WeakMap,qt=new WeakSet,class extends Lt{constructor(e){super(),ct(this,qt),Ue(this,Bt,void 0),Ue(this,Vt,void 0),Ue(this,Ut,void 0),Ue(this,Ht,void 0),this.mutationId=e.mutationId,We(Vt,this,e.defaultOptions),We(Ut,this,e.mutationCache),We(Bt,this,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=Le(Le({},qe(Vt,this)),e),this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){qe(Bt,this).includes(e)||(qe(Bt,this).push(e),this.clearGcTimeout(),qe(Ut,this).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){We(Bt,this,qe(Bt,this).filter(t=>t!==e)),this.scheduleGc(),qe(Ut,this).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){qe(Bt,this).length||("pending"===this.state.status?this.scheduleGc():qe(Ut,this).remove(this))}continue(){var e,t;return null!==(e=null===(t=qe(Ht,this))||void 0===t?void 0:t.continue())&&void 0!==e?e:this.execute(this.state.variables)}async execute(e){const t=()=>{var t;return We(Ht,this,St({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{He(qt,this,Kt).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{He(qt,this,Kt).call(this,{type:"pause"})},onContinue:()=>{He(qt,this,Kt).call(this,{type:"continue"})},retry:null!==(t=this.options.retry)&&void 0!==t?t:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode})),qe(Ht,this).promise},n="pending"===this.state.status;try{var i,r,s,a,o,l,c,d;if(!n){var u,h,p,m;He(qt,this,Kt).call(this,{type:"pending",variables:e}),await(null===(u=(h=qe(Ut,this).config).onMutate)||void 0===u?void 0:u.call(h,e,this));const t=await(null===(p=(m=this.options).onMutate)||void 0===p?void 0:p.call(m,e));t!==this.state.context&&He(qt,this,Kt).call(this,{type:"pending",context:t,variables:e})}const f=await t();return await(null===(i=(r=qe(Ut,this).config).onSuccess)||void 0===i?void 0:i.call(r,f,e,this.state.context,this)),await(null===(s=(a=this.options).onSuccess)||void 0===s?void 0:s.call(a,f,e,this.state.context)),await(null===(o=(l=qe(Ut,this).config).onSettled)||void 0===o?void 0:o.call(l,f,null,this.state.variables,this.state.context,this)),await(null===(c=(d=this.options).onSettled)||void 0===c?void 0:c.call(d,f,null,e,this.state.context)),He(qt,this,Kt).call(this,{type:"success",data:f}),f}catch(j){try{var f,g,x,y,v,_,b,w;throw await(null===(f=(g=qe(Ut,this).config).onError)||void 0===f?void 0:f.call(g,j,e,this.state.context,this)),await(null===(x=(y=this.options).onError)||void 0===x?void 0:x.call(y,j,e,this.state.context)),await(null===(v=(_=qe(Ut,this).config).onSettled)||void 0===v?void 0:v.call(_,void 0,j,this.state.variables,this.state.context,this)),await(null===(b=(w=this.options).onSettled)||void 0===b?void 0:b.call(w,void 0,j,e,this.state.context)),j}finally{He(qt,this,Kt).call(this,{type:"error",error:j})}}}});function Kt(e){this.state=(t=>{switch(e.type){case"failed":return Le(Le({},t),{},{failureCount:e.failureCount,failureReason:e.error});case"pause":return Le(Le({},t),{},{isPaused:!0});case"continue":return Le(Le({},t),{},{isPaused:!1});case"pending":return Le(Le({},t),{},{context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!bt(this.options.networkMode),status:"pending",variables:e.variables,submittedAt:Date.now()});case"success":return Le(Le({},t),{},{data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1});case"error":return Le(Le({},t),{},{data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"})}})(this.state),gt.batch(()=>{qe(Bt,this).forEach(t=>{t.onMutationUpdate(e)}),qe(Ut,this).notify({mutation:this,type:"updated",action:e})})}var Qt,Jt,$t,en,tn,nn,rn,sn,an=(Wt=new WeakMap,Gt=new WeakMap,Yt=new WeakMap,class extends xt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),Ue(this,Wt,void 0),Ue(this,Gt,void 0),Ue(this,Yt,void 0),this.config=e,We(Wt,this,[]),We(Gt,this,0)}build(e,t,n){var i;const r=new Xt({mutationCache:this,mutationId:We(Gt,this,(i=qe(Gt,this),++i)),options:e.defaultMutationOptions(t),state:n});return this.add(r),r}add(e){qe(Wt,this).push(e),this.notify({type:"added",mutation:e})}remove(e){We(Wt,this,qe(Wt,this).filter(t=>t!==e)),this.notify({type:"removed",mutation:e})}clear(){gt.batch(()=>{qe(Wt,this).forEach(e=>{this.remove(e)})})}getAll(){return qe(Wt,this)}find(e){const t=Le({exact:!0},e);return qe(Wt,this).find(e=>Qe(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return qe(Wt,this).filter(t=>Qe(e,t))}notify(e){gt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){var e;return We(Yt,this,(null!==(e=qe(Yt,this))&&void 0!==e?e:Promise.resolve()).then(()=>{const e=qe(Wt,this).filter(e=>e.state.isPaused);return gt.batch(()=>e.reduce((e,t)=>e.then(()=>t.continue().catch(Ye)),Promise.resolve()))}).then(()=>{We(Yt,this,void 0)})),qe(Yt,this)}});function on(e){return{onFetch:(t,n)=>{const i=async()=>{var n,i,r;const s=t.options,a=null===(n=t.fetchOptions)||void 0===n||null===(n=n.meta)||void 0===n||null===(n=n.fetchMore)||void 0===n?void 0:n.direction,o=(null===(i=t.state.data)||void 0===i?void 0:i.pages)||[],l=(null===(r=t.state.data)||void 0===r?void 0:r.pageParams)||[],c={pages:[],pageParams:[]};let d=!1;const u=t.options.queryFn||(()=>Promise.reject(new Error("Missing queryFn: '".concat(t.options.queryHash,"'")))),h=async(e,n,i)=>{if(d)return Promise.reject();if(null==n&&e.pages.length)return Promise.resolve(e);const r={queryKey:t.queryKey,pageParam:n,direction:i?"backward":"forward",meta:t.options.meta};var s;s=r,Object.defineProperty(s,"signal",{enumerable:!0,get:()=>(t.signal.aborted?d=!0:t.signal.addEventListener("abort",()=>{d=!0}),t.signal)});const a=await u(r),{maxPages:o}=t.options,l=i?lt:ot;return{pages:l(e.pages,a,o),pageParams:l(e.pageParams,n,o)}};let p;if(a&&o.length){const e="backward"===a,t={pages:o,pageParams:l},n=(e?cn:ln)(s,t);p=await h(t,n,e)}else{var m;p=await h(c,null!==(m=l[0])&&void 0!==m?m:s.initialPageParam);const t=null!==e&&void 0!==e?e:o.length;for(let e=1;e<t;e++){const e=ln(s,p);p=await h(p,e)}}return p};t.options.persister?t.fetchFn=()=>{var e,r;return null===(e=(r=t.options).persister)||void 0===e?void 0:e.call(r,i,{queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=i}}}function ln(e,t){let{pages:n,pageParams:i}=t;const r=n.length-1;return e.getNextPageParam(n[r],n,i[r],i)}function cn(e,t){var n;let{pages:i,pageParams:r}=t;return null===(n=e.getPreviousPageParam)||void 0===n?void 0:n.call(e,i[0],i,r[0],r)}var dn=(Qt=new WeakMap,Jt=new WeakMap,$t=new WeakMap,en=new WeakMap,tn=new WeakMap,nn=new WeakMap,rn=new WeakMap,sn=new WeakMap,class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ue(this,Qt,void 0),Ue(this,Jt,void 0),Ue(this,$t,void 0),Ue(this,en,void 0),Ue(this,tn,void 0),Ue(this,nn,void 0),Ue(this,rn,void 0),Ue(this,sn,void 0),We(Qt,this,e.queryCache||new Zt),We(Jt,this,e.mutationCache||new an),We($t,this,e.defaultOptions||{}),We(en,this,new Map),We(tn,this,new Map),We(nn,this,0)}mount(){var e;We(nn,this,(e=qe(nn,this),e++,e)),1===qe(nn,this)&&(We(rn,this,yt.subscribe(()=>{yt.isFocused()&&(this.resumePausedMutations(),qe(Qt,this).onFocus())})),We(sn,this,vt.subscribe(()=>{vt.isOnline()&&(this.resumePausedMutations(),qe(Qt,this).onOnline())})))}unmount(){var e,t,n;We(nn,this,(e=qe(nn,this),e--,e)),0===qe(nn,this)&&(null===(t=qe(rn,this))||void 0===t||t.call(this),We(rn,this,void 0),null===(n=qe(sn,this))||void 0===n||n.call(this),We(sn,this,void 0))}isFetching(e){return qe(Qt,this).findAll(Le(Le({},e),{},{fetchStatus:"fetching"})).length}isMutating(e){return qe(Jt,this).findAll(Le(Le({},e),{},{status:"pending"})).length}getQueryData(e){var t;return null===(t=qe(Qt,this).find({queryKey:e}))||void 0===t?void 0:t.state.data}ensureQueryData(e){const t=this.getQueryData(e.queryKey);return void 0!==t?Promise.resolve(t):this.fetchQuery(e)}getQueriesData(e){return this.getQueryCache().findAll(e).map(e=>{let{queryKey:t,state:n}=e;return[t,n.data]})}setQueryData(e,t,n){const i=qe(Qt,this).find({queryKey:e}),r=function(e,t){return"function"===typeof e?e(t):e}(t,null===i||void 0===i?void 0:i.state.data);if("undefined"===typeof r)return;const s=this.defaultQueryOptions({queryKey:e});return qe(Qt,this).build(this,s).setData(r,Le(Le({},n),{},{manual:!0}))}setQueriesData(e,t,n){return gt.batch(()=>this.getQueryCache().findAll(e).map(e=>{let{queryKey:i}=e;return[i,this.setQueryData(i,t,n)]}))}getQueryState(e){var t;return null===(t=qe(Qt,this).find({queryKey:e}))||void 0===t?void 0:t.state}removeQueries(e){const t=qe(Qt,this);gt.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const n=qe(Qt,this),i=Le({type:"active"},e);return gt.batch(()=>(n.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries(i,t)))}cancelQueries(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Le({revert:!0},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=gt.batch(()=>qe(Qt,this).findAll(e).map(e=>e.cancel(t)));return Promise.all(n).then(Ye).catch(Ye)}invalidateQueries(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return gt.batch(()=>{var n,i;if(qe(Qt,this).findAll(e).forEach(e=>{e.invalidate()}),"none"===e.refetchType)return Promise.resolve();const r=Le(Le({},e),{},{type:null!==(n=null!==(i=e.refetchType)&&void 0!==i?i:e.type)&&void 0!==n?n:"active"});return this.refetchQueries(r,t)})}refetchQueries(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;const i=Le(Le({},n),{},{cancelRefetch:null===(e=null===n||void 0===n?void 0:n.cancelRefetch)||void 0===e||e}),r=gt.batch(()=>qe(Qt,this).findAll(t).filter(e=>!e.isDisabled()).map(e=>{let t=e.fetch(void 0,i);return i.throwOnError||(t=t.catch(Ye)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(r).then(Ye)}fetchQuery(e){const t=this.defaultQueryOptions(e);"undefined"===typeof t.retry&&(t.retry=!1);const n=qe(Qt,this).build(this,t);return n.isStaleByTime(t.staleTime)?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Ye).catch(Ye)}fetchInfiniteQuery(e){return e.behavior=on(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Ye).catch(Ye)}resumePausedMutations(){return qe(Jt,this).resumePausedMutations()}getQueryCache(){return qe(Qt,this)}getMutationCache(){return qe(Jt,this)}getDefaultOptions(){return qe($t,this)}setDefaultOptions(e){We($t,this,e)}setQueryDefaults(e,t){qe(en,this).set($e(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...qe(en,this).values()];let n={};return t.forEach(t=>{et(e,t.queryKey)&&(n=Le(Le({},n),t.defaultOptions))}),n}setMutationDefaults(e,t){qe(tn,this).set($e(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...qe(tn,this).values()];let n={};return t.forEach(t=>{et(e,t.mutationKey)&&(n=Le(Le({},n),t.defaultOptions))}),n}defaultQueryOptions(e){if(null!==e&&void 0!==e&&e._defaulted)return e;const t=Le(Le(Le(Le({},qe($t,this).queries),(null===e||void 0===e?void 0:e.queryKey)&&this.getQueryDefaults(e.queryKey)),e),{},{_defaulted:!0});return t.queryHash||(t.queryHash=Je(t.queryKey,t)),"undefined"===typeof t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),"undefined"===typeof t.throwOnError&&(t.throwOnError=!!t.suspense),"undefined"===typeof t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t}defaultMutationOptions(e){return null!==e&&void 0!==e&&e._defaulted?e:Le(Le(Le(Le({},qe($t,this).mutations),(null===e||void 0===e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey)),e),{},{_defaulted:!0})}clear(){qe(Qt,this).clear(),qe(Jt,this).clear()}}),un=i.createContext(void 0),hn=e=>{const t=i.useContext(un);if(e)return e;if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},pn=e=>{let{client:t,children:n}=e;return i.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),i.createElement(un.Provider,{value:t},n)};const mn=new dn({defaultOptions:{queries:{staleTime:3e4,gcTime:3e5,retry:(e,t)=>!(t.status>=400&&t.status<500)&&e<3,retryDelay:e=>Math.min(1e3*2**e,3e4),refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:1,retryDelay:1e3}}}),fn=e=>{let{children:t}=e;return(0,ze.jsxs)(pn,{client:mn,children:[t,!1]})},gn=e=>{let{size:t="md",color:n="blue",text:i="Loading...",fullScreen:r=!1,className:s=""}=e;const a=(0,ze.jsx)("div",{className:"animate-spin rounded-full border-2 border-gray-200 ".concat({sm:"h-6 w-6",md:"h-12 w-12",lg:"h-16 w-16",xl:"h-24 w-24"}[t]," ").concat({blue:"border-blue-600",green:"border-green-600",red:"border-red-600",purple:"border-purple-600",gray:"border-gray-600"}[n]," border-t-transparent ").concat(s)});return r?(0,ze.jsx)("div",{className:"fixed inset-0 bg-gray-50 bg-opacity-90 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[a,i&&(0,ze.jsx)("p",{className:"text-gray-600 mt-4 text-sm",children:i})]})}):(0,ze.jsx)("div",{className:"flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[a,i&&(0,ze.jsx)("p",{className:"text-gray-600 mt-2 text-sm",children:i})]})})};function xn(e){let{children:t,roles:n}=e;const{user:r,loading:s,isLoggingOut:a,isLoggingIn:o}=Fe(),l=$(),c=(0,i.useMemo)(()=>{if(s||a||o)return!0;if(!r)return!1;if(!n||0===n.length)return!0;const e=(r.role||"").toLowerCase().trim(),t=n.map(e=>(e||"").toLowerCase().trim());console.log("RequireAuth - Role check:",{userRole:e,allowedRoles:t,userId:r._id,userName:r.name,userEmail:r.email});const i=t.some(t=>"admin"===t&&("admin"===e||"administrator"===e)||("depot_manager"===t&&("depot_manager"===e||"depot-manager"===e||"depotmanager"===e)||("conductor"===t&&"conductor"===e||("driver"===t&&"driver"===e||("passenger"===t&&"passenger"===e||e===t)))));return i?console.log('Access granted: User role "'.concat(e,'" matches allowed roles [').concat(t.join(", "),"]")):console.log('Access denied: User role "'.concat(e,'" not in allowed roles [').concat(t.join(", "),"]")),i},[r,n,s,a,o]);return s||a||o?(0,ze.jsx)(gn,{fullScreen:!0,text:s?"Loading...":o?"Signing in...":a?"Signing out...":"Authenticating..."}):r?c?(0,ze.jsx)("div",{className:"fade-in",children:t}):(0,ze.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6 bg-gray-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center max-w-md fade-in",children:[(0,ze.jsx)("h1",{className:"text-xl font-bold mb-2 text-red-600",children:"403 \u2013 Access Denied"}),(0,ze.jsx)("p",{className:"text-gray-600 mb-4",children:"You do not have permission to access this page."}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500 mb-4",children:[(0,ze.jsxs)("p",{children:["Your role: ",(0,ze.jsx)("strong",{className:"text-gray-700",children:(null===(d=r.role)||void 0===d?void 0:d.toUpperCase())||"None"})]}),(0,ze.jsxs)("p",{children:["Required roles: ",(0,ze.jsx)("strong",{className:"text-gray-700",children:null===n||void 0===n?void 0:n.join(", ").toUpperCase()})]})]}),(0,ze.jsx)("button",{onClick:()=>window.location.href="/dashboard",className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors btn-transition",children:"Go to Dashboard"})]})}):(console.log("User not authenticated, redirecting to login"),(0,ze.jsx)(xe,{to:"/login",state:{from:l},replace:!0}));var d}const yn=e=>{let{children:t}=e;return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("header",{className:"bg-white border-b",children:(0,ze.jsxs)("div",{className:"max-w-7xl mx-auto p-4 flex items-center gap-4",children:[(0,ze.jsx)("div",{className:"font-bold",children:"YATRIK ERP"}),(0,ze.jsx)("nav",{className:"flex items-center gap-3 text-sm text-gray-600",children:[].map(e=>(0,ze.jsxs)(Ae,{to:e.to,className:"px-2 py-1 rounded hover:bg-gray-100 flex items-center gap-1",children:[(0,ze.jsx)(e.icon,{className:"w-4 h-4"})," ",e.label]},e.to))})]})}),(0,ze.jsx)("main",{className:"max-w-7xl mx-auto p-4",children:t})]})};function vn(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var _n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const bn=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],wn=(e,t)=>{const n=(0,i.forwardRef)((n,r)=>{let{color:s="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:c="",children:d}=n,u=vn(n,bn);return(0,i.createElement)("svg",Le(Le({ref:r},_n),{},{width:a,height:a,stroke:s,strokeWidth:l?24*Number(o)/Number(a):o,className:["lucide","lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),c].join(" ")},u),[...t.map(e=>{let[t,n]=e;return(0,i.createElement)(t,n)}),...Array.isArray(d)?d:[d]]);var h});return n.displayName="".concat(e),n},jn=wn("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Nn=wn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Sn=wn("Bus",[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]]),kn=wn("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),Tn=wn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),Cn=wn("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),En=wn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),An=wn("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),Mn=wn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Dn=wn("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),In=wn("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),Pn=wn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Rn=wn("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Ln=wn("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),zn=wn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),On=wn("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),Fn=wn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Bn=wn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Vn=wn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Un=wn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Hn=wn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),qn=e=>{var t,n,r,s,a,o;let{children:l}=e;const[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)([]),[p,m]=(0,i.useState)(""),f=$(),g=te(),{user:x,logout:y,isLoggingOut:v}=Fe(),_=[{name:"Dashboard",href:"/admin",icon:jn,current:"/admin"===f.pathname},{name:"User Management",href:"/admin/users",icon:Nn,current:"/admin/users"===f.pathname},{name:"Bus Management",href:"/admin/buses",icon:Sn,current:"/admin/buses"===f.pathname},{name:"Route Management",href:"/admin/routes",icon:kn,current:"/admin/routes"===f.pathname},{name:"Trip Management",href:"/admin/trips",icon:Tn,current:"/admin/trips"===f.pathname},{name:"Depot Management",href:"/admin/depots",icon:Cn,current:"/admin/depots"===f.pathname},{name:"Driver Management",href:"/admin/drivers",icon:En,current:"/admin/drivers"===f.pathname},{name:"Conductor Management",href:"/admin/conductors",icon:An,current:"/admin/conductors"===f.pathname},{name:"Fare Policy",href:"/admin/fare-policy",icon:Mn,current:"/admin/fare-policy"===f.pathname},{name:"System Status",href:"/admin/system-status",icon:Dn,current:"/admin/system-status"===f.pathname},{name:"RBAC",href:"/admin/rbac",icon:An,current:"/admin/rbac"===f.pathname},{name:"Reports",href:"/admin/reports",icon:In,current:"/admin/reports"===f.pathname},{name:"Settings",href:"/admin/settings",icon:Pn,current:"/admin/settings"===f.pathname}],b=[{name:"Add User",href:"/admin/users",icon:Nn,color:"bg-blue-500"},{name:"Schedule Trip",href:"/admin/trips",icon:Tn,color:"bg-green-500"},{name:"View Reports",href:"/admin/reports",icon:jn,color:"bg-purple-500"},{name:"System Status",href:"/admin/system-status",icon:Dn,color:"bg-orange-500"}],w=[{name:"Database",status:"healthy",icon:Rn,color:"text-green-500"},{name:"API Server",status:"healthy",icon:Ln,color:"text-green-500"},{name:"Frontend",status:"healthy",icon:zn,color:"text-green-500"},{name:"Mobile App",status:"warning",icon:On,color:"text-yellow-500"}];return v?(0,ze.jsx)(gn,{fullScreen:!0,text:"Logging out..."}):(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50 layout-stable",children:[(0,ze.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden transition-all duration-300 ease-in-out ".concat(c?"block":"hidden"),children:[(0,ze.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 transition-opacity duration-300",onClick:()=>d(!1)}),(0,ze.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white shadow-xl transform transition-transform duration-300 ease-in-out ".concat(c?"translate-x-0":"-translate-x-full"),children:[(0,ze.jsx)("div",{className:"flex h-16 items-center justify-end px-6 border-b border-gray-200",children:(0,ze.jsx)("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600",children:(0,ze.jsx)(Fn,{className:"w-6 h-6"})})}),(0,ze.jsx)("nav",{className:"flex-1 space-y-1 px-4 py-4",children:_.map(e=>(0,ze.jsxs)(Ae,{to:e.href,className:"group flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(e.current?"bg-blue-50 text-blue-700 border-r-2 border-blue-700":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"),onClick:()=>d(!1),children:[(0,ze.jsx)(e.icon,{className:"mr-3 h-5 w-5 ".concat(e.current?"text-blue-700":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name))})]})]}),(0,ze.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,ze.jsxs)("div",{className:"flex flex-col flex-grow bg-white shadow-xl border-r border-gray-200",children:[(0,ze.jsx)("div",{className:"flex h-16 items-center px-6 border-b border-gray-200",children:(0,ze.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Admin Panel"})}),(0,ze.jsx)("nav",{className:"flex-1 space-y-1 px-4 py-4",children:_.map(e=>(0,ze.jsxs)(Ae,{to:e.href,className:"group flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(e.current?"bg-blue-50 text-blue-700 border-r-2 border-blue-700":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"),children:[(0,ze.jsx)(e.icon,{className:"mr-3 h-5 w-5 ".concat(e.current?"text-blue-700":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name))}),(0,ze.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-semibold text-sm",children:(null===x||void 0===x||null===(t=x.name)||void 0===t||null===(n=t.charAt(0))||void 0===n?void 0:n.toUpperCase())||"E"})}),(0,ze.jsxs)("div",{className:"ml-3 flex-1",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null===x||void 0===x?void 0:x.name)||"ERP Admin"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:(null===x||void 0===x?void 0:x.role)||"admin"})]}),(0,ze.jsx)("button",{onClick:async()=>{try{await y(),g("/login",{replace:!0})}catch(e){console.error("Logout error:",e),g("/login",{replace:!0})}},className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-all duration-200 ease-in-out hover:bg-gray-100 btn-transition",title:"Logout",disabled:v,children:v?(0,ze.jsx)("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-gray-600 rounded-full animate-spin"}):(0,ze.jsx)(Bn,{className:"w-4 h-4"})})]})})]})}),(0,ze.jsxs)("div",{className:"lg:pl-64",children:[(0,ze.jsx)("div",{className:"sticky top-0 z-40 bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsxs)("div",{className:"flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8",children:[(0,ze.jsx)("div",{className:"flex items-center space-x-4",children:(0,ze.jsx)("button",{onClick:()=>d(!0),className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",children:(0,ze.jsx)(Vn,{className:"w-6 h-6"})})}),(0,ze.jsx)("div",{className:"flex-1 max-w-lg mx-4 lg:mx-8",children:(0,ze.jsxs)("form",{onSubmit:e=>{e.preventDefault(),p.trim()&&console.log("Searching for:",p)},className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search users, trips, routes...",value:p,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsx)("div",{className:"hidden md:flex items-center space-x-2",children:w.map(e=>(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)(e.icon,{className:"w-4 h-4 ".concat(e.color)}),(0,ze.jsx)("span",{className:"text-xs text-gray-600",children:e.name})]},e.name))}),(0,ze.jsxs)("button",{className:"relative p-2 text-gray-400 hover:text-gray-500 hover:bg-gray-100 rounded-lg",children:[(0,ze.jsx)(Hn,{className:"w-5 h-5"}),u.length>0&&(0,ze.jsx)("span",{className:"absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-400 ring-2 ring-white"})]}),(0,ze.jsx)("div",{className:"relative",children:(0,ze.jsxs)("button",{className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-all duration-200 ease-in-out btn-transition",disabled:v,children:[(0,ze.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-semibold text-sm",children:(null===x||void 0===x||null===(r=x.name)||void 0===r||null===(s=r.charAt(0))||void 0===s?void 0:s.toUpperCase())||"E"})}),(0,ze.jsx)("span",{className:"hidden md:block text-sm font-medium text-gray-900",children:(null===x||void 0===x?void 0:x.name)||"ERP Admin"})]})})]})]})}),(0,ze.jsx)("div",{className:"bg-white border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:(null===(a=_.find(e=>e.current))||void 0===a?void 0:a.name)||"Admin Dashboard"}),(0,ze.jsx)("nav",{className:"flex mt-2","aria-label":"Breadcrumb",children:(0,ze.jsxs)("ol",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("li",{children:(0,ze.jsx)(Ae,{to:"/admin",className:"text-gray-500 hover:text-gray-700 text-sm",children:"Dashboard"})}),"/admin"!==f.pathname&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)("li",{children:(0,ze.jsx)("span",{className:"text-gray-400 mx-2",children:"/"})}),(0,ze.jsx)("li",{children:(0,ze.jsx)("span",{className:"text-gray-900 text-sm",children:(null===(o=_.find(e=>e.current))||void 0===o?void 0:o.name)||"Page"})})]})]})})]}),(0,ze.jsx)("div",{className:"hidden md:flex items-center space-x-2",children:b.map(e=>(0,ze.jsxs)(Ae,{to:e.href,className:"".concat(e.color," text-white px-3 py-2 rounded-lg text-sm font-medium hover:opacity-90 transition-opacity flex items-center space-x-2"),children:[(0,ze.jsx)(e.icon,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:e.name})]},e.name))})]})}),(0,ze.jsx)("main",{className:"px-4 sm:px-6 lg:px-8 py-6",children:l})]})]})},Wn=(0,i.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),Gn=(0,i.createContext)({}),Yn=(0,i.createContext)(null),Zn="undefined"!==typeof document,Xn=Zn?i.useLayoutEffect:i.useEffect,Kn=(0,i.createContext)({strict:!1}),Qn=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Jn="data-"+Qn("framerAppearId");function $n(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function ei(e){return"string"===typeof e||Array.isArray(e)}function ti(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}const ni=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ii=["initial",...ni];function ri(e){return ti(e.animate)||ii.some(t=>ei(e[t]))}function si(e){return Boolean(ri(e)||e.variants)}function ai(e){const{initial:t,animate:n}=function(e,t){if(ri(e)){const{initial:t,animate:n}=e;return{initial:!1===t||ei(t)?t:void 0,animate:ei(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,i.useContext)(Gn));return(0,i.useMemo)(()=>({initial:t,animate:n}),[oi(t),oi(n)])}function oi(e){return Array.isArray(e)?e.join(" "):e}const li={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ci={};for(const n in li)ci[n]={isEnabled:e=>li[n].some(t=>!!e[t])};const di=(0,i.createContext)({}),ui=(0,i.createContext)({}),hi=Symbol.for("motionComponentSymbol");function pi(e){let{preloadedFeatures:t,createVisualElement:n,useRender:r,useVisualState:s,Component:a}=e;t&&function(e){for(const t in e)ci[t]=Le(Le({},ci[t]),e[t])}(t);const o=(0,i.forwardRef)(function(e,o){let l;const c=Le(Le(Le({},(0,i.useContext)(Wn)),e),{},{layoutId:mi(e)}),{isStatic:d}=c,u=ai(e),h=s(e,d);if(!d&&Zn){u.visualElement=function(e,t,n,r){const{visualElement:s}=(0,i.useContext)(Gn),a=(0,i.useContext)(Kn),o=(0,i.useContext)(Yn),l=(0,i.useContext)(Wn).reducedMotion,c=(0,i.useRef)();r=r||a.renderer,!c.current&&r&&(c.current=r(e,{visualState:t,parent:s,props:n,presenceContext:o,blockInitialAnimation:!!o&&!1===o.initial,reducedMotionConfig:l}));const d=c.current;(0,i.useInsertionEffect)(()=>{d&&d.update(n,o)});const u=(0,i.useRef)(Boolean(n[Jn]&&!window.HandoffComplete));return Xn(()=>{d&&(d.render(),u.current&&d.animationState&&d.animationState.animateChanges())}),(0,i.useEffect)(()=>{d&&(d.updateFeatures(),!u.current&&d.animationState&&d.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),d}(a,h,c,n);const e=(0,i.useContext)(ui),r=(0,i.useContext)(Kn).strict;u.visualElement&&(l=u.visualElement.loadFeatures(c,r,t,e))}return i.createElement(Gn.Provider,{value:u},l&&u.visualElement?i.createElement(l,Le({visualElement:u.visualElement},c)):null,r(a,e,function(e,t,n){return(0,i.useCallback)(i=>{i&&e.mount&&e.mount(i),t&&(i?t.mount(i):t.unmount()),n&&("function"===typeof n?n(i):$n(n)&&(n.current=i))},[t])}(h,u.visualElement,o),h,d,u.visualElement))});return o[hi]=a,o}function mi(e){let{layoutId:t}=e;const n=(0,i.useContext)(di).id;return n&&void 0!==t?n+"-"+t:t}function fi(e){function t(t){return pi(e(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}if("undefined"===typeof Proxy)return t;const n=new Map;return new Proxy(t,{get:(e,i)=>(n.has(i)||n.set(i,t(i)),n.get(i))})}const gi=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function xi(e){return"string"===typeof e&&!e.includes("-")&&!!(gi.indexOf(e)>-1||/[A-Z]/.test(e))}const yi={};const vi=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],_i=new Set(vi);function bi(e,t){let{layout:n,layoutId:i}=t;return _i.has(e)||e.startsWith("origin")||(n||void 0!==i)&&(!!yi[e]||"opacity"===e)}const wi=e=>Boolean(e&&e.getVelocity),ji={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Ni=vi.length;const Si=e=>t=>"string"===typeof t&&t.startsWith(e),ki=Si("--"),Ti=Si("var(--"),Ci=(e,t)=>t&&"number"===typeof e?t.transform(e):e,Ei=(e,t,n)=>Math.min(Math.max(n,e),t),Ai={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},Mi=Le(Le({},Ai),{},{transform:e=>Ei(0,1,e)}),Di=Le(Le({},Ai),{},{default:1}),Ii=e=>Math.round(1e5*e)/1e5,Pi=/(-)?([\d]*\.?[\d])+/g,Ri=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Li=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function zi(e){return"string"===typeof e}const Oi=e=>({test:t=>zi(t)&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>"".concat(t).concat(e)}),Fi=Oi("deg"),Bi=Oi("%"),Vi=Oi("px"),Ui=Oi("vh"),Hi=Oi("vw"),qi=Le(Le({},Bi),{},{parse:e=>Bi.parse(e)/100,transform:e=>Bi.transform(100*e)}),Wi=Le(Le({},Ai),{},{transform:Math.round}),Gi={borderWidth:Vi,borderTopWidth:Vi,borderRightWidth:Vi,borderBottomWidth:Vi,borderLeftWidth:Vi,borderRadius:Vi,radius:Vi,borderTopLeftRadius:Vi,borderTopRightRadius:Vi,borderBottomRightRadius:Vi,borderBottomLeftRadius:Vi,width:Vi,maxWidth:Vi,height:Vi,maxHeight:Vi,size:Vi,top:Vi,right:Vi,bottom:Vi,left:Vi,padding:Vi,paddingTop:Vi,paddingRight:Vi,paddingBottom:Vi,paddingLeft:Vi,margin:Vi,marginTop:Vi,marginRight:Vi,marginBottom:Vi,marginLeft:Vi,rotate:Fi,rotateX:Fi,rotateY:Fi,rotateZ:Fi,scale:Di,scaleX:Di,scaleY:Di,scaleZ:Di,skew:Fi,skewX:Fi,skewY:Fi,distance:Vi,translateX:Vi,translateY:Vi,translateZ:Vi,x:Vi,y:Vi,z:Vi,perspective:Vi,transformPerspective:Vi,opacity:Mi,originX:qi,originY:qi,originZ:Vi,zIndex:Wi,fillOpacity:Mi,strokeOpacity:Mi,numOctaves:Wi};function Yi(e,t,n,i){const{style:r,vars:s,transform:a,transformOrigin:o}=e;let l=!1,c=!1,d=!0;for(const u in t){const e=t[u];if(ki(u)){s[u]=e;continue}const n=Gi[u],i=Ci(e,n);if(_i.has(u)){if(l=!0,a[u]=i,!d)continue;e!==(n.default||0)&&(d=!1)}else u.startsWith("origin")?(c=!0,o[u]=i):r[u]=i}if(t.transform||(l||i?r.transform=function(e,t,n,i){let{enableHardwareAcceleration:r=!0,allowTransformNone:s=!0}=t,a="";for(let o=0;o<Ni;o++){const t=vi[o];void 0!==e[t]&&(a+="".concat(ji[t]||t,"(").concat(e[t],") "))}return r&&!e.z&&(a+="translateZ(0)"),a=a.trim(),i?a=i(e,n?"":a):s&&n&&(a="none"),a}(e.transform,n,d,i):r.transform&&(r.transform="none")),c){const{originX:e="50%",originY:t="50%",originZ:n=0}=o;r.transformOrigin="".concat(e," ").concat(t," ").concat(n)}}const Zi=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Xi(e,t,n){for(const i in t)wi(t[i])||bi(i,n)||(e[i]=t[i])}function Ki(e,t,n){const r={};return Xi(r,e.style||{},e),Object.assign(r,function(e,t,n){let{transformTemplate:r}=e;return(0,i.useMemo)(()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return Yi(e,t,{enableHardwareAcceleration:!n},r),Object.assign({},e.vars,e.style)},[t])}(e,t,n)),e.transformValues?e.transformValues(r):r}function Qi(e,t,n){const i={},r=Ki(e,t,n);return e.drag&&!1!==e.dragListener&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-".concat("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=r,i}const Ji=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function $i(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Ji.has(e)}let er=e=>!$i(e);try{(tr=require("@emotion/is-prop-valid").default)&&(er=e=>e.startsWith("on")?!$i(e):tr(e))}catch(FS){}var tr;function nr(e,t,n){return"string"===typeof e?e:Vi.transform(t+n*e)}const ir={offset:"stroke-dashoffset",array:"stroke-dasharray"},rr={offset:"strokeDashoffset",array:"strokeDasharray"};const sr=["attrX","attrY","attrScale","originX","originY","pathLength","pathSpacing","pathOffset"];function ar(e,t,n,i,r){let{attrX:s,attrY:a,attrScale:o,originX:l,originY:c,pathLength:d,pathSpacing:u=1,pathOffset:h=0}=t;if(Yi(e,vn(t,sr),n,r),i)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:p,style:m,dimensions:f}=e;p.transform&&(f&&(m.transform=p.transform),delete p.transform),f&&(void 0!==l||void 0!==c||m.transform)&&(m.transformOrigin=function(e,t,n){const i=nr(t,e.x,e.width),r=nr(n,e.y,e.height);return"".concat(i," ").concat(r)}(f,void 0!==l?l:.5,void 0!==c?c:.5)),void 0!==s&&(p.x=s),void 0!==a&&(p.y=a),void 0!==o&&(p.scale=o),void 0!==d&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const s=r?ir:rr;e[s.offset]=Vi.transform(-i);const a=Vi.transform(t),o=Vi.transform(n);e[s.array]="".concat(a," ").concat(o)}(p,d,u,h,!1)}const or=()=>Le(Le({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}}),lr=e=>"string"===typeof e&&"svg"===e.toLowerCase();function cr(e,t,n,r){const s=(0,i.useMemo)(()=>{const n=or();return ar(n,t,{enableHardwareAcceleration:!1},lr(r),e.transformTemplate),Le(Le({},n.attrs),{},{style:Le({},n.style)})},[t]);if(e.style){const t={};Xi(t,e.style,e),s.style=Le(Le({},t),s.style)}return s}function dr(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(t,n,r,s,a)=>{let{latestValues:o}=s;const l=(xi(t)?cr:Qi)(n,o,a,t),c=function(e,t,n){const i={};for(const r in e)"values"===r&&"object"===typeof e.values||(er(r)||!0===n&&$i(r)||!t&&!$i(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(n,"string"===typeof t,e),d=Le(Le(Le({},c),l),{},{ref:r}),{children:u}=n,h=(0,i.useMemo)(()=>wi(u)?u.get():u,[u]);return(0,i.createElement)(t,Le(Le({},d),{},{children:h}))}}function ur(e,t,n,i){let{style:r,vars:s}=t;Object.assign(e.style,r,i&&i.getProjectionStyles(n));for(const a in s)e.style.setProperty(a,s[a])}const hr=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function pr(e,t,n,i){ur(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(hr.has(r)?r:Qn(r),t.attrs[r])}function mr(e,t){const{style:n}=e,i={};for(const r in n)(wi(n[r])||t.style&&wi(t.style[r])||bi(r,e))&&(i[r]=n[r]);return i}function fr(e,t){const n=mr(e,t);for(const i in e)if(wi(e[i])||wi(t[i])){n[-1!==vi.indexOf(i)?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i]=e[i]}return n}function gr(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return"function"===typeof t&&(t=t(void 0!==n?n:e.custom,i,r)),"string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t&&(t=t(void 0!==n?n:e.custom,i,r)),t}function xr(e){const t=(0,i.useRef)(null);return null===t.current&&(t.current=e()),t.current}const yr=e=>Array.isArray(e),vr=e=>yr(e)?e[e.length-1]||0:e;function _r(e){const t=wi(e)?e.get():e;return n=t,Boolean(n&&"object"===typeof n&&n.mix&&n.toValue)?t.toValue():t;var n}const br=["transitionEnd","transition"];const wr=e=>(t,n)=>{const r=(0,i.useContext)(Gn),s=(0,i.useContext)(Yn),a=()=>function(e,t,n,i){let{scrapeMotionValuesFromProps:r,createRenderState:s,onMount:a}=e;const o={latestValues:jr(t,n,i,r),renderState:s()};return a&&(o.mount=e=>a(t,e,o)),o}(e,t,r,s);return n?a():xr(a)};function jr(e,t,n,i){const r={},s=i(e,{});for(const h in s)r[h]=_r(s[h]);let{initial:a,animate:o}=e;const l=ri(e),c=si(e);t&&c&&!l&&!1!==e.inherit&&(void 0===a&&(a=t.initial),void 0===o&&(o=t.animate));let d=!!n&&!1===n.initial;d=d||!1===a;const u=d?o:a;if(u&&"boolean"!==typeof u&&!ti(u)){(Array.isArray(u)?u:[u]).forEach(t=>{const n=gr(e,t);if(!n)return;const{transitionEnd:i,transition:s}=n,a=vn(n,br);for(const e in a){let t=a[e];if(Array.isArray(t)){t=t[d?t.length-1:0]}null!==t&&(r[e]=t)}for(const e in i)r[e]=i[e]})}return r}const Nr=e=>e;class Sr{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);-1!==t&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}const kr=["prepare","read","update","preRender","render","postRender"];const{schedule:Tr,cancel:Cr,state:Er,steps:Ar}=function(e,t){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=kr.reduce((e,t)=>(e[t]=function(e){let t=new Sr,n=new Sr,i=0,r=!1,s=!1;const a=new WeakSet,o={schedule:function(e){const s=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r,o=s?t:n;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&a.add(e),o.add(e)&&s&&r&&(i=t.order.length),e},cancel:e=>{n.remove(e),a.delete(e)},process:l=>{if(r)s=!0;else{if(r=!0,[t,n]=[n,t],n.clear(),i=t.order.length,i)for(let n=0;n<i;n++){const i=t.order[n];i(l),a.has(i)&&(o.schedule(i),e())}r=!1,s&&(s=!1,o.process(l))}}};return o}(()=>n=!0),e),{}),a=e=>s[e].process(r),o=()=>{const s=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(s-r.timestamp,40),1),r.timestamp=s,r.isProcessing=!0,kr.forEach(a),r.isProcessing=!1,n&&t&&(i=!1,e(o))},l=kr.reduce((t,a)=>{const l=s[a];return t[a]=function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,i=!0,r.isProcessing||e(o)),l.schedule(t,s,a)},t},{});return{schedule:l,cancel:e=>kr.forEach(t=>s[t].cancel(e)),state:r,steps:s}}("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:Nr,!0),Mr={useVisualState:wr({scrapeMotionValuesFromProps:fr,createRenderState:or,onMount:(e,t,n)=>{let{renderState:i,latestValues:r}=n;Tr.read(()=>{try{i.dimensions="function"===typeof t.getBBox?t.getBBox():t.getBoundingClientRect()}catch(wd){i.dimensions={x:0,y:0,width:0,height:0}}}),Tr.render(()=>{ar(i,r,{enableHardwareAcceleration:!1},lr(t.tagName),e.transformTemplate),pr(t,i)})}})},Dr={useVisualState:wr({scrapeMotionValuesFromProps:mr,createRenderState:Zi})};function Ir(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}const Pr=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary;function Rr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"page";return{point:{x:e[t+"X"],y:e[t+"Y"]}}}function Lr(e,t,n,i){return Ir(e,t,(e=>t=>Pr(t)&&e(t,Rr(t)))(n),i)}const zr=(e,t)=>n=>t(e(n)),Or=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(zr)};function Fr(e){let t=null;return()=>{const n=()=>{t=null};return null===t&&(t=e,n)}}const Br=Fr("dragHorizontal"),Vr=Fr("dragVertical");function Ur(e){let t=!1;if("y"===e)t=Vr();else if("x"===e)t=Br();else{const e=Br(),n=Vr();e&&n?t=()=>{e(),n()}:(e&&e(),n&&n())}return t}function Hr(){const e=Ur(!0);return!e||(e(),!1)}class qr{constructor(e){this.isMounted=!1,this.node=e}update(){}}function Wr(e,t){const n="pointer"+(t?"enter":"leave"),i="onHover"+(t?"Start":"End");return Lr(e.current,n,(n,r)=>{if("touch"===n.pointerType||Hr())return;const s=e.getProps();e.animationState&&s.whileHover&&e.animationState.setActive("whileHover",t),s[i]&&Tr.update(()=>s[i](n,r))},{passive:!e.getProps()[i]})}const Gr=(e,t)=>!!t&&(e===t||Gr(e,t.parentElement));function Yr(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,Rr(n))}const Zr=["root"],Xr=new WeakMap,Kr=new WeakMap,Qr=e=>{const t=Xr.get(e.target);t&&t(e)},Jr=e=>{e.forEach(Qr)};function $r(e,t,n){const i=function(e){let{root:t}=e,n=vn(e,Zr);const i=t||document;Kr.has(i)||Kr.set(i,{});const r=Kr.get(i),s=JSON.stringify(n);return r[s]||(r[s]=new IntersectionObserver(Jr,Le({root:t},n))),r[s]}(t);return Xr.set(e,n),i.observe(e),()=>{Xr.delete(e),i.unobserve(e)}}const es={some:0,all:1};const ts={inView:{Feature:class extends qr{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:i="some",once:r}=e,s={root:t?t.current:void 0,rootMargin:n,threshold:"number"===typeof i?i:es[i]};return $r(this.node.current,s,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:i}=this.node.getProps(),s=t?n:i;s&&s(e)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,n=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==n[e]}(e,t));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends qr{constructor(){super(...arguments),this.removeStartListeners=Nr,this.removeEndListeners=Nr,this.removeAccessibleListeners=Nr,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),i=Lr(window,"pointerup",(e,t)=>{if(!this.checkPressEnd())return;const{onTap:n,onTapCancel:i,globalTapTarget:r}=this.node.getProps();Tr.update(()=>{r||Gr(this.node.current,e.target)?n&&n(e,t):i&&i(e,t)})},{passive:!(n.onTap||n.onPointerUp)}),r=Lr(window,"pointercancel",(e,t)=>this.cancelPress(e,t),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=Or(i,r),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=Ir(this.node.current,"keydown",e=>{if("Enter"!==e.key||this.isPressing)return;this.removeEndListeners(),this.removeEndListeners=Ir(this.node.current,"keyup",e=>{"Enter"===e.key&&this.checkPressEnd()&&Yr("up",(e,t)=>{const{onTap:n}=this.node.getProps();n&&Tr.update(()=>n(e,t))})}),Yr("down",(e,t)=>{this.startPress(e,t)})}),t=Ir(this.node.current,"blur",()=>{this.isPressing&&Yr("cancel",(e,t)=>this.cancelPress(e,t))});this.removeAccessibleListeners=Or(e,t)}}startPress(e,t){this.isPressing=!0;const{onTapStart:n,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&Tr.update(()=>n(e,t))}checkPressEnd(){this.removeEndListeners(),this.isPressing=!1;return this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!Hr()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&Tr.update(()=>n(e,t))}mount(){const e=this.node.getProps(),t=Lr(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),n=Ir(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Or(t,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}},focus:{Feature:class extends qr{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(wd){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Or(Ir(this.node.current,"focus",()=>this.onFocus()),Ir(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends qr{mount(){this.unmount=Or(Wr(this.node,!0),Wr(this.node,!1))}unmount(){}}}};function ns(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function is(e,t,n){const i=e.getProps();return gr(i,t,void 0!==n?n:i.custom,function(e){const t={};return e.values.forEach((e,n)=>t[n]=e.get()),t}(e),function(e){const t={};return e.values.forEach((e,n)=>t[n]=e.getVelocity()),t}(e))}let rs=Nr,ss=Nr;const as=e=>1e3*e,os=e=>e/1e3,ls=!1,cs=e=>Array.isArray(e)&&"number"===typeof e[0];function ds(e){return Boolean(!e||"string"===typeof e&&hs[e]||cs(e)||Array.isArray(e)&&e.every(ds))}const us=e=>{let[t,n,i,r]=e;return"cubic-bezier(".concat(t,", ").concat(n,", ").concat(i,", ").concat(r,")")},hs={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:us([0,.65,.55,1]),circOut:us([.55,0,1,.45]),backIn:us([.31,.01,.66,-.59]),backOut:us([.33,1.53,.69,.99])};function ps(e){if(e)return cs(e)?us(e):Array.isArray(e)?e.map(ps):hs[e]}const ms=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function fs(e,t,n,i){if(e===t&&n===i)return Nr;const r=t=>function(e,t,n,i,r){let s,a,o=0;do{a=t+(n-t)/2,s=ms(a,i,r)-e,s>0?n=a:t=a}while(Math.abs(s)>1e-7&&++o<12);return a}(t,0,1,e,n);return e=>0===e||1===e?e:ms(r(e),t,i)}const gs=fs(.42,0,1,1),xs=fs(0,0,.58,1),ys=fs(.42,0,.58,1),vs=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,_s=e=>t=>1-e(1-t),bs=e=>1-Math.sin(Math.acos(e)),ws=_s(bs),js=vs(bs),Ns=fs(.33,1.53,.69,.99),Ss=_s(Ns),ks=vs(Ss),Ts={linear:Nr,easeIn:gs,easeInOut:ys,easeOut:xs,circIn:bs,circInOut:js,circOut:ws,backIn:Ss,backInOut:ks,backOut:Ns,anticipate:e=>(e*=2)<1?.5*Ss(e):.5*(2-Math.pow(2,-10*(e-1)))},Cs=e=>{if(Array.isArray(e)){ss(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[t,n,i,r]=e;return fs(t,n,i,r)}return"string"===typeof e?(ss(void 0!==Ts[e],"Invalid easing type '".concat(e,"'")),Ts[e]):e},Es=(e,t)=>n=>Boolean(zi(n)&&Li.test(n)&&n.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(n,t)),As=(e,t,n)=>i=>{if(!zi(i))return i;const[r,s,a,o]=i.match(Pi);return{[e]:parseFloat(r),[t]:parseFloat(s),[n]:parseFloat(a),alpha:void 0!==o?parseFloat(o):1}},Ms=Le(Le({},Ai),{},{transform:e=>Math.round((e=>Ei(0,255,e))(e))}),Ds={test:Es("rgb","red"),parse:As("red","green","blue"),transform:e=>{let{red:t,green:n,blue:i,alpha:r=1}=e;return"rgba("+Ms.transform(t)+", "+Ms.transform(n)+", "+Ms.transform(i)+", "+Ii(Mi.transform(r))+")"}};const Is={test:Es("#"),parse:function(e){let t="",n="",i="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:Ds.transform},Ps={test:Es("hsl","hue"),parse:As("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:n,lightness:i,alpha:r=1}=e;return"hsla("+Math.round(t)+", "+Bi.transform(Ii(n))+", "+Bi.transform(Ii(i))+", "+Ii(Mi.transform(r))+")"}},Rs={test:e=>Ds.test(e)||Is.test(e)||Ps.test(e),parse:e=>Ds.test(e)?Ds.parse(e):Ps.test(e)?Ps.parse(e):Is.parse(e),transform:e=>zi(e)?e:e.hasOwnProperty("red")?Ds.transform(e):Ps.transform(e)},Ls=(e,t,n)=>-n*e+n*t+e;function zs(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}const Os=(e,t,n)=>{const i=e*e;return Math.sqrt(Math.max(0,n*(t*t-i)+i))},Fs=[Is,Ds,Ps];function Bs(e){const t=(n=e,Fs.find(e=>e.test(n)));var n;ss(Boolean(t),"'".concat(e,"' is not an animatable color. Use the equivalent color code instead."));let i=t.parse(e);return t===Ps&&(i=function(e){let{hue:t,saturation:n,lightness:i,alpha:r}=e;t/=360,n/=100,i/=100;let s=0,a=0,o=0;if(n){const e=i<.5?i*(1+n):i+n-i*n,r=2*i-e;s=zs(r,e,t+1/3),a=zs(r,e,t),o=zs(r,e,t-1/3)}else s=a=o=i;return{red:Math.round(255*s),green:Math.round(255*a),blue:Math.round(255*o),alpha:r}}(i)),i}const Vs=(e,t)=>{const n=Bs(e),i=Bs(t),r=Le({},n);return e=>(r.red=Os(n.red,i.red,e),r.green=Os(n.green,i.green,e),r.blue=Os(n.blue,i.blue,e),r.alpha=Ls(n.alpha,i.alpha,e),Ds.transform(r))};const Us={regex:/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,countKey:"Vars",token:"${v}",parse:Nr},Hs={regex:Ri,countKey:"Colors",token:"${c}",parse:Rs.parse},qs={regex:Pi,countKey:"Numbers",token:"${n}",parse:Ai.parse};function Ws(e,t){let{regex:n,countKey:i,token:r,parse:s}=t;const a=e.tokenised.match(n);a&&(e["num"+i]=a.length,e.tokenised=e.tokenised.replace(n,r),e.values.push(...a.map(s)))}function Gs(e){const t=e.toString(),n={value:t,tokenised:t,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&Ws(n,Us),Ws(n,Hs),Ws(n,qs),n}function Ys(e){return Gs(e).values}function Zs(e){const{values:t,numColors:n,numVars:i,tokenised:r}=Gs(e),s=t.length;return e=>{let t=r;for(let r=0;r<s;r++)t=r<i?t.replace(Us.token,e[r]):r<i+n?t.replace(Hs.token,Rs.transform(e[r])):t.replace(qs.token,Ii(e[r]));return t}}const Xs=e=>"number"===typeof e?0:e;const Ks={test:function(e){var t,n;return isNaN(e)&&zi(e)&&((null===(t=e.match(Pi))||void 0===t?void 0:t.length)||0)+((null===(n=e.match(Ri))||void 0===n?void 0:n.length)||0)>0},parse:Ys,createTransformer:Zs,getAnimatableNone:function(e){const t=Ys(e);return Zs(e)(t.map(Xs))}},Qs=(e,t)=>n=>"".concat(n>0?t:e);function Js(e,t){return"number"===typeof e?n=>Ls(e,t,n):Rs.test(e)?Vs(e,t):e.startsWith("var(")?Qs(e,t):ta(e,t)}const $s=(e,t)=>{const n=[...e],i=n.length,r=e.map((e,n)=>Js(e,t[n]));return e=>{for(let t=0;t<i;t++)n[t]=r[t](e);return n}},ea=(e,t)=>{const n=Le(Le({},e),t),i={};for(const r in n)void 0!==e[r]&&void 0!==t[r]&&(i[r]=Js(e[r],t[r]));return e=>{for(const t in i)n[t]=i[t](e);return n}},ta=(e,t)=>{const n=Ks.createTransformer(t),i=Gs(e),r=Gs(t);return i.numVars===r.numVars&&i.numColors===r.numColors&&i.numNumbers>=r.numNumbers?Or($s(i.values,r.values),n):(rs(!0,"Complex values '".concat(e,"' and '").concat(t,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.")),Qs(e,t))},na=(e,t,n)=>{const i=t-e;return 0===i?1:(n-e)/i},ia=(e,t)=>n=>Ls(e,t,n);function ra(e,t,n){const i=[],r=n||("number"===typeof(s=e[0])?ia:"string"===typeof s?Rs.test(s)?Vs:ta:Array.isArray(s)?$s:"object"===typeof s?ea:ia);var s;const a=e.length-1;for(let o=0;o<a;o++){let n=r(e[o],e[o+1]);if(t){const e=Array.isArray(t)?t[o]||Nr:t;n=Or(e,n)}i.push(n)}return i}function sa(e,t){let{clamp:n=!0,ease:i,mixer:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=e.length;if(ss(s===t.length,"Both input and output ranges must be the same length"),1===s)return()=>t[0];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=ra(t,i,r),o=a.length,l=t=>{let n=0;if(o>1)for(;n<e.length-2&&!(t<e[n+1]);n++);const i=na(e[n],e[n+1],t);return a[n](i)};return n?t=>l(Ei(e[0],e[s-1],t)):l}function aa(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let i=1;i<=t;i++){const r=na(0,t,i);e.push(Ls(n,1,r))}}(t,e.length-1),t}function oa(e){let{duration:t=300,keyframes:n,times:i,ease:r="easeInOut"}=e;const s=(e=>Array.isArray(e)&&"number"!==typeof e[0])(r)?r.map(Cs):Cs(r),a={done:!1,value:n[0]},o=function(e,t){return e.map(e=>e*t)}(i&&i.length===n.length?i:aa(n),t),l=sa(o,n,{ease:Array.isArray(s)?s:(c=n,d=s,c.map(()=>d||ys).splice(0,c.length-1))});var c,d;return{calculatedDuration:t,next:e=>(a.value=l(e),a.done=e>=t,a)}}function la(e,t){return t?e*(1e3/t):0}function ca(e,t,n){const i=Math.max(t-5,0);return la(n-e(i),t-i)}const da=.001;function ua(e){let t,n,{duration:i=800,bounce:r=.25,velocity:s=0,mass:a=1}=e;rs(i<=as(10),"Spring duration must be 10 seconds or less");let o=1-r;o=Ei(.05,1,o),i=Ei(.01,10,os(i)),o<1?(t=e=>{const t=e*o,n=t*i,r=t-s,a=pa(e,o),l=Math.exp(-n);return da-r/a*l},n=e=>{const n=e*o*i,r=n*s+s,a=Math.pow(o,2)*Math.pow(e,2)*i,l=Math.exp(-n),c=pa(Math.pow(e,2),o);return(-t(e)+da>0?-1:1)*((r-a)*l)/c}):(t=e=>Math.exp(-e*i)*((e-s)*i+1)-.001,n=e=>Math.exp(-e*i)*(i*i*(s-e)));const l=function(e,t,n){let i=n;for(let r=1;r<ha;r++)i-=e(i)/t(i);return i}(t,n,5/i);if(i=as(i),isNaN(l))return{stiffness:100,damping:10,duration:i};{const e=Math.pow(l,2)*a;return{stiffness:e,damping:2*o*Math.sqrt(a*e),duration:i}}}const ha=12;function pa(e,t){return e*Math.sqrt(1-t*t)}const ma=["keyframes","restDelta","restSpeed"],fa=["duration","bounce"],ga=["stiffness","damping","mass"];function xa(e,t){return t.some(t=>void 0!==e[t])}function ya(e){let{keyframes:t,restDelta:n,restSpeed:i}=e,r=vn(e,ma);const s=t[0],a=t[t.length-1],o={done:!1,value:s},{stiffness:l,damping:c,mass:d,duration:u,velocity:h,isResolvedFromDuration:p}=function(e){let t=Le({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},e);if(!xa(e,ga)&&xa(e,fa)){const n=ua(e);t=Le(Le(Le({},t),n),{},{mass:1}),t.isResolvedFromDuration=!0}return t}(Le(Le({},r),{},{velocity:-os(r.velocity||0)})),m=h||0,f=c/(2*Math.sqrt(l*d)),g=a-s,x=os(Math.sqrt(l/d)),y=Math.abs(g)<5;let v;if(i||(i=y?.01:2),n||(n=y?.005:.5),f<1){const e=pa(x,f);v=t=>{const n=Math.exp(-f*x*t);return a-n*((m+f*x*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===f)v=e=>a-Math.exp(-x*e)*(g+(m+x*g)*e);else{const e=x*Math.sqrt(f*f-1);v=t=>{const n=Math.exp(-f*x*t),i=Math.min(e*t,300);return a-n*((m+f*x*g)*Math.sinh(i)+e*g*Math.cosh(i))/e}}return{calculatedDuration:p&&u||null,next:e=>{const t=v(e);if(p)o.done=e>=u;else{let r=m;0!==e&&(r=f<1?ca(v,e,t):0);const s=Math.abs(r)<=i,l=Math.abs(a-t)<=n;o.done=s&&l}return o.value=o.done?a:t,o}}}function va(e){let{keyframes:t,velocity:n=0,power:i=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:a=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:u}=e;const h=t[0],p={done:!1,value:h},m=e=>void 0===l?c:void 0===c||Math.abs(l-e)<Math.abs(c-e)?l:c;let f=i*n;const g=h+f,x=void 0===o?g:o(g);x!==g&&(f=x-h);const y=e=>-f*Math.exp(-e/r),v=e=>x+y(e),_=e=>{const t=y(e),n=v(e);p.done=Math.abs(t)<=d,p.value=p.done?x:n};let b,w;const j=e=>{var t;(t=p.value,void 0!==l&&t<l||void 0!==c&&t>c)&&(b=e,w=ya({keyframes:[p.value,m(p.value)],velocity:ca(v,e,p.value),damping:s,stiffness:a,restDelta:d,restSpeed:u}))};return j(0),{calculatedDuration:null,next:e=>{let t=!1;return w||void 0!==b||(t=!0,_(e),j(e)),void 0!==b&&e>b?w.next(e-b):(!t&&_(e),p)}}}const _a=e=>{const t=t=>{let{timestamp:n}=t;return e(n)};return{start:()=>Tr.update(t,!0),stop:()=>Cr(t),now:()=>Er.isProcessing?Er.timestamp:performance.now()}};function ba(e){let t=0;let n=e.next(t);for(;!n.done&&t<2e4;)t+=50,n=e.next(t);return t>=2e4?1/0:t}const wa=["autoplay","delay","driver","keyframes","type","repeat","repeatDelay","repeatType","onPlay","onStop","onComplete","onUpdate"],ja={decay:va,inertia:va,tween:oa,keyframes:oa,spring:ya};function Na(e){let t,n,{autoplay:i=!0,delay:r=0,driver:s=_a,keyframes:a,type:o="keyframes",repeat:l=0,repeatDelay:c=0,repeatType:d="loop",onPlay:u,onStop:h,onComplete:p,onUpdate:m}=e,f=vn(e,wa),g=1,x=!1;const y=()=>{n=new Promise(e=>{t=e})};let v;y();const _=ja[o]||oa;let b;_!==oa&&"number"!==typeof a[0]&&(b=sa([0,100],a,{clamp:!1}),a=[0,100]);const w=_(Le(Le({},f),{},{keyframes:a}));let j;"mirror"===d&&(j=_(Le(Le({},f),{},{keyframes:[...a].reverse(),velocity:-(f.velocity||0)})));let N="idle",S=null,k=null,T=null;null===w.calculatedDuration&&l&&(w.calculatedDuration=ba(w));const{calculatedDuration:C}=w;let E=1/0,A=1/0;null!==C&&(E=C+c,A=E*(l+1)-c);let M=0;const D=e=>{if(null===k)return;g>0&&(k=Math.min(k,e)),g<0&&(k=Math.min(e-A/g,k)),M=null!==S?S:Math.round(e-k)*g;const t=M-r*(g>=0?1:-1),n=g>=0?t<0:t>A;M=Math.max(t,0),"finished"===N&&null===S&&(M=A);let i=M,s=w;if(l){const e=Math.min(M,A)/E;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,l+1);Boolean(t%2)&&("reverse"===d?(n=1-n,c&&(n-=c/E)):"mirror"===d&&(s=j)),i=Ei(0,1,n)*E}const o=n?{done:!1,value:a[0]}:s.next(i);b&&(o.value=b(o.value));let{done:u}=o;n||null===C||(u=g>=0?M>=A:M<=0);const h=null===S&&("finished"===N||"running"===N&&u);return m&&m(o.value),h&&R(),o},I=()=>{v&&v.stop(),v=void 0},P=()=>{N="idle",I(),t(),y(),k=T=null},R=()=>{N="finished",p&&p(),I(),t()},L=()=>{if(x)return;v||(v=s(D));const e=v.now();u&&u(),null!==S?k=e-S:k&&"finished"!==N||(k=e),"finished"===N&&y(),T=k,S=null,N="running",v.start()};i&&L();const z={then:(e,t)=>n.then(e,t),get time(){return os(M)},set time(e){e=as(e),M=e,null===S&&v&&0!==g?k=v.now()-e/g:S=e},get duration(){const e=null===w.calculatedDuration?ba(w):w.calculatedDuration;return os(e)},get speed(){return g},set speed(e){e!==g&&v&&(g=e,z.time=os(M))},get state(){return N},play:L,pause:()=>{N="paused",S=M},stop:()=>{x=!0,"idle"!==N&&(N="idle",h&&h(),P())},cancel:()=>{null!==T&&D(T),P()},complete:()=>{N="finished"},sample:e=>(k=0,D(e))};return z}const Sa=["onUpdate","onComplete"],ka=function(e){let t;return()=>(void 0===t&&(t=e()),t)}(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Ta=new Set(["opacity","clipPath","filter","transform","backgroundColor"]);function Ca(e,t,n){let{onUpdate:i,onComplete:r}=n,s=vn(n,Sa);if(!(ka()&&Ta.has(t)&&!s.repeatDelay&&"mirror"!==s.repeatType&&0!==s.damping&&"inertia"!==s.type))return!1;let a,o,l=!1,c=!1;const d=()=>{o=new Promise(e=>{a=e})};d();let{keyframes:u,duration:h=300,ease:p,times:m}=s;if(((e,t)=>"spring"===t.type||"backgroundColor"===e||!ds(t.ease))(t,s)){const e=Na(Le(Le({},s),{},{repeat:0,delay:0}));let t={done:!1,value:u[0]};const n=[];let i=0;for(;!t.done&&i<2e4;)t=e.sample(i),n.push(t.value),i+=10;m=void 0,u=n,h=i-10,p="linear"}const f=function(e,t,n){let{delay:i=0,duration:r,repeat:s=0,repeatType:a="loop",ease:o,times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={[t]:n};l&&(c.offset=l);const d=ps(o);return Array.isArray(d)&&(c.easing=d),e.animate(c,{delay:i,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:s+1,direction:"reverse"===a?"alternate":"normal"})}(e.owner.current,t,u,Le(Le({},s),{},{duration:h,ease:p,times:m})),g=()=>{c=!1,f.cancel()},x=()=>{c=!0,Tr.update(g),a(),d()};f.onfinish=()=>{c||(e.set(function(e,t){let{repeat:n,repeatType:i="loop"}=t;return e[n&&"loop"!==i&&n%2===1?0:e.length-1]}(u,s)),r&&r(),x())};const y={then:(e,t)=>o.then(e,t),attachTimeline:e=>(f.timeline=e,f.onfinish=null,Nr),get time(){return os(f.currentTime||0)},set time(e){f.currentTime=as(e)},get speed(){return f.playbackRate},set speed(e){f.playbackRate=e},get duration(){return os(h)},play:()=>{l||(f.play(),Cr(g))},pause:()=>f.pause(),stop:()=>{if(l=!0,"idle"===f.playState)return;const{currentTime:t}=f;if(t){const n=Na(Le(Le({},s),{},{autoplay:!1}));e.setWithVelocity(n.sample(t-10).value,n.sample(t).value,10)}x()},complete:()=>{c||f.finish()},cancel:x};return y}const Ea={type:"spring",stiffness:500,damping:25,restSpeed:10},Aa={type:"keyframes",duration:.8},Ma={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Da=(e,t)=>{let{keyframes:n}=t;return n.length>2?Aa:_i.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:Ea:Ma},Ia=(e,t)=>"zIndex"!==e&&(!("number"!==typeof t&&!Array.isArray(t))||!("string"!==typeof t||!Ks.test(t)&&"0"!==t||t.startsWith("url("))),Pa=new Set(["brightness","contrast","saturate","opacity"]);function Ra(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[i]=n.match(Pi)||[];if(!i)return e;const r=n.replace(i,"");let s=Pa.has(t)?1:0;return i!==n&&(s*=100),t+"("+s+r+")"}const La=/([a-z-]*)\(.*?\)/g,za=Le(Le({},Ks),{},{getAnimatableNone:e=>{const t=e.match(La);return t?t.map(Ra).join(" "):e}}),Oa=Le(Le({},Gi),{},{color:Rs,backgroundColor:Rs,outlineColor:Rs,fill:Rs,stroke:Rs,borderColor:Rs,borderTopColor:Rs,borderRightColor:Rs,borderBottomColor:Rs,borderLeftColor:Rs,filter:za,WebkitFilter:za}),Fa=e=>Oa[e];function Ba(e,t){let n=Fa(e);return n!==za&&(n=Ks),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const Va=e=>/^0[^.\s]+$/.test(e);function Ua(e){return"number"===typeof e?0===e:null!==e?"none"===e||"0"===e||Va(e):void 0}const Ha=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];function qa(e,t){return e[t]||e.default||e}const Wa=!1,Ga=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r=>{const s=qa(i,e)||{},a=s.delay||i.delay||0;let{elapsed:o=0}=i;o-=as(a);const l=function(e,t,n,i){const r=Ia(t,n);let s;s=Array.isArray(n)?[...n]:[null,n];const a=void 0!==i.from?i.from:e.get();let o;const l=[];for(let c=0;c<s.length;c++)null===s[c]&&(s[c]=0===c?a:s[c-1]),Ua(s[c])&&l.push(c),"string"===typeof s[c]&&"none"!==s[c]&&"0"!==s[c]&&(o=s[c]);if(r&&l.length&&o)for(let c=0;c<l.length;c++)s[l[c]]=Ba(t,o);return s}(t,e,n,s),c=l[0],d=l[l.length-1],u=Ia(e,c),h=Ia(e,d);rs(u===h,"You are trying to animate ".concat(e,' from "').concat(c,'" to "').concat(d,'". ').concat(c," is not an animatable value - to enable this animation set ").concat(c," to a value animatable to ").concat(d," via the `style` property."));let p=Le(Le({keyframes:l,velocity:t.getVelocity(),ease:"easeOut"},s),{},{delay:-o,onUpdate:e=>{t.set(e),s.onUpdate&&s.onUpdate(e)},onComplete:()=>{r(),s.onComplete&&s.onComplete()}});if(function(e){let{when:t,delay:n,delayChildren:i,staggerChildren:r,staggerDirection:s,repeat:a,repeatType:o,repeatDelay:l,from:c,elapsed:d}=e,u=vn(e,Ha);return!!Object.keys(u).length}(s)||(p=Le(Le({},p),Da(e,p))),p.duration&&(p.duration=as(p.duration)),p.repeatDelay&&(p.repeatDelay=as(p.repeatDelay)),!u||!h||ls||!1===s.type||Wa)return function(e){let{keyframes:t,delay:n,onUpdate:i,onComplete:r}=e;const s=()=>(i&&i(t[t.length-1]),r&&r(),{time:0,speed:1,duration:0,play:Nr,pause:Nr,stop:Nr,then:e=>(e(),Promise.resolve()),cancel:Nr,complete:Nr});return n?Na({keyframes:[0,1],duration:0,delay:n,onComplete:s}):s()}(ls?Le(Le({},p),{},{delay:0}):p);if(!i.isHandoff&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const n=Ca(t,e,p);if(n)return n}return Na(p)}};function Ya(e){return Boolean(wi(e)&&e.add)}const Za=e=>/^\-?\d*\.?\d+$/.test(e);function Xa(e,t){-1===e.indexOf(t)&&e.push(t)}function Ka(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Qa{constructor(){this.subscriptions=[]}add(e){return Xa(this.subscriptions,e),()=>Ka(this.subscriptions,e)}notify(e,t,n){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,n);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ja={current:void 0};class $a{constructor(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.prev=t.current,t.current=e;const{delta:i,timestamp:r}=Er;t.lastUpdated!==r&&(t.timeDelta=i,t.lastUpdated=r,Tr.postRender(t.scheduleVelocityCheck)),t.prev!==t.current&&t.events.change&&t.events.change.notify(t.current),t.events.velocityChange&&t.events.velocityChange.notify(t.getVelocity()),n&&t.events.renderRequest&&t.events.renderRequest.notify(t.current)},this.scheduleVelocityCheck=()=>Tr.postRender(this.velocityCheck),this.velocityCheck=e=>{let{timestamp:t}=e;t!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=(e=>!isNaN(parseFloat(e)))(this.current),this.owner=n.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Qa);const n=this.events[e].add(t);return"change"===e?()=>{n(),Tr.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,n){this.set(t),this.prev=e,this.timeDelta=n}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Ja.current&&Ja.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?la(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function eo(e,t){return new $a(e,t)}const to=e=>t=>t.test(e),no=[Ai,Vi,Bi,Fi,Hi,Ui,{test:e=>"auto"===e,parse:e=>e}],io=e=>no.find(to(e)),ro=[...no,Rs,Ks],so=e=>ro.find(to(e)),ao=["transitionEnd","transition"];function oo(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,eo(n))}function lo(e,t){const n=is(e,t);let i=n?e.makeTargetAnimatable(n,!1):{},{transitionEnd:r={},transition:s={}}=i,a=vn(i,ao);a=Le(Le({},a),r);for(const o in a){oo(e,o,vr(a[o]))}}function co(e,t){if(!t)return;return(t[e]||t.default||t).from}const uo=["transition","transitionEnd"];function ho(e,t){let{protectedKeys:n,needsAnimating:i}=e;const r=n.hasOwnProperty(t)&&!0!==i[t];return i[t]=!1,r}function po(e,t){const n=e.get();if(!Array.isArray(t))return n!==t;for(let i=0;i<t.length;i++)if(t[i]!==n)return!0}function mo(e,t){let{delay:n=0,transitionOverride:i,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=e.makeTargetAnimatable(t),{transition:a=e.getDefaultTransition(),transitionEnd:o}=s,l=vn(s,uo);const c=e.getValue("willChange");i&&(a=i);const d=[],u=r&&e.animationState&&e.animationState.getState()[r];for(const h in l){const t=e.getValue(h),i=l[h];if(!t||void 0===i||u&&ho(u,h))continue;const r=Le({delay:n,elapsed:0},qa(a||{},h));if(window.HandoffAppearAnimations){const n=e.getProps()[Jn];if(n){const e=window.HandoffAppearAnimations(n,h,t,Tr);null!==e&&(r.elapsed=e,r.isHandoff=!0)}}let s=!r.isHandoff&&!po(t,i);if("spring"===r.type&&(t.getVelocity()||r.velocity)&&(s=!1),t.animation&&(s=!1),s)continue;t.start(Ga(h,t,i,e.shouldReduceMotion&&_i.has(h)?{type:!1}:r));const o=t.animation;Ya(c)&&(c.add(h),o.then(()=>c.remove(h))),d.push(o)}return o&&Promise.all(d).then(()=>{o&&lo(e,o)}),d}function fo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=is(e,t,n.custom);let{transition:r=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const s=i?()=>Promise.all(mo(e,i,n)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:s=0,staggerChildren:a,staggerDirection:o}=r;return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5?arguments[5]:void 0;const a=[],o=(e.variantChildren.size-1)*i,l=1===r?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i}:function(){return o-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i};return Array.from(e.variantChildren).sort(go).forEach((e,i)=>{e.notify("AnimationStart",t),a.push(fo(e,t,Le(Le({},s),{},{delay:n+l(i)})).then(()=>e.notify("AnimationComplete",t)))}),Promise.all(a)}(e,t,s+i,a,o,n)}:()=>Promise.resolve(),{when:o}=r;if(o){const[e,t]="beforeChildren"===o?[s,a]:[a,s];return e().then(()=>t())}return Promise.all([s(),a(n.delay)])}function go(e,t){return e.sortNodePosition(t)}const xo=["transition","transitionEnd"],yo=[...ni].reverse(),vo=ni.length;function _o(e){return t=>Promise.all(t.map(t=>{let{animation:n,options:i}=t;return function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map(t=>fo(e,t,i));n=Promise.all(r)}else if("string"===typeof t)n=fo(e,t,i);else{const r="function"===typeof t?is(e,t,i.custom):t;n=Promise.all(mo(e,r,i))}return n.then(()=>e.notify("AnimationComplete",t))}(e,n,i)}))}function bo(e){let t=_o(e);const n={animate:jo(!0),whileInView:jo(),whileHover:jo(),whileTap:jo(),whileDrag:jo(),whileFocus:jo(),exit:jo()};let i=!0;const r=(t,n)=>{const i=is(e,n);if(i){const{transition:e,transitionEnd:n}=i,r=vn(i,xo);t=Le(Le(Le({},t),r),n)}return t};function s(s,a){const o=e.getProps(),l=e.getVariantContext(!0)||{},c=[],d=new Set;let u={},h=1/0;for(let t=0;t<vo;t++){const p=yo[t],m=n[p],f=void 0!==o[p]?o[p]:l[p],g=ei(f),x=p===a?m.isActive:null;!1===x&&(h=t);let y=f===l[p]&&f!==o[p]&&g;if(y&&i&&e.manuallyAnimateOnMount&&(y=!1),m.protectedKeys=Le({},u),!m.isActive&&null===x||!f&&!m.prevProp||ti(f)||"boolean"===typeof f)continue;let v=wo(m.prevProp,f)||p===a&&m.isActive&&!y&&g||t>h&&g,_=!1;const b=Array.isArray(f)?f:[f];let w=b.reduce(r,{});!1===x&&(w={});const{prevResolvedValues:j={}}=m,N=Le(Le({},j),w),S=e=>{v=!0,d.has(e)&&(_=!0,d.delete(e)),m.needsAnimating[e]=!0};for(const e in N){const t=w[e],n=j[e];if(u.hasOwnProperty(e))continue;let i=!1;i=yr(t)&&yr(n)?!ns(t,n):t!==n,i?void 0!==t?S(e):d.add(e):void 0!==t&&d.has(e)?S(e):m.protectedKeys[e]=!0}m.prevProp=f,m.prevResolvedValues=w,m.isActive&&(u=Le(Le({},u),w)),i&&e.blockInitialAnimation&&(v=!1),!v||y&&!_||c.push(...b.map(e=>({animation:e,options:Le({type:p},s)})))}if(d.size){const t={};d.forEach(n=>{const i=e.getBaseTarget(n);void 0!==i&&(t[n]=i)}),c.push({animation:t})}let p=Boolean(c.length);return!i||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(p=!1),i=!1,p?t(c):Promise.resolve()}return{animateChanges:s,setActive:function(t,i,r){var a;if(n[t].isActive===i)return Promise.resolve();null===(a=e.variantChildren)||void 0===a||a.forEach(e=>{var n;return null===(n=e.animationState)||void 0===n?void 0:n.setActive(t,i)}),n[t].isActive=i;const o=s(r,t);for(const e in n)n[e].protectedKeys={};return o},setAnimateFunction:function(n){t=n(e)},getState:()=>n}}function wo(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!ns(t,e)}function jo(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}let No=0;const So={animation:{Feature:class extends qr{constructor(e){super(e),e.animationState||(e.animationState=bo(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),ti(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}},exit:{Feature:class extends qr{constructor(){super(...arguments),this.id=No++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e,{custom:null!==n&&void 0!==n?n:this.node.getProps().custom});t&&!e&&r.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},ko=(e,t)=>Math.abs(e-t);class To{constructor(e,t){let{transformPagePoint:n,contextWindow:i,dragSnapToOrigin:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Ao(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=ko(e.x,t.x),i=ko(e.y,t.y);return Math.sqrt(n**2+i**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!n)return;const{point:i}=e,{timestamp:r}=Er;this.history.push(Le(Le({},i),{},{timestamp:r}));const{onStart:s,onMove:a}=this.handlers;t||(s&&s(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),a&&a(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Co(t,this.transformPagePoint),Tr.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const s=Ao("pointercancel"===e.type?this.lastMoveEventInfo:Co(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,s),i&&i(e,s)},!Pr(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=n,this.contextWindow=i||window;const s=Co(Rr(e),this.transformPagePoint),{point:a}=s,{timestamp:o}=Er;this.history=[Le(Le({},a),{},{timestamp:o})];const{onSessionStart:l}=t;l&&l(e,Ao(s,this.history)),this.removeListeners=Or(Lr(this.contextWindow,"pointermove",this.handlePointerMove),Lr(this.contextWindow,"pointerup",this.handlePointerUp),Lr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Cr(this.updatePoint)}}function Co(e,t){return t?{point:t(e.point)}:e}function Eo(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ao(e,t){let{point:n}=e;return{point:n,delta:Eo(n,Do(t)),offset:Eo(n,Mo(t)),velocity:Io(t,.1)}}function Mo(e){return e[0]}function Do(e){return e[e.length-1]}function Io(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null;const r=Do(e);for(;n>=0&&(i=e[n],!(r.timestamp-i.timestamp>as(t)));)n--;if(!i)return{x:0,y:0};const s=os(r.timestamp-i.timestamp);if(0===s)return{x:0,y:0};const a={x:(r.x-i.x)/s,y:(r.y-i.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Po(e){return e.max-e.min}function Ro(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;return Math.abs(e-t)<=n}function Lo(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=i,e.originPoint=Ls(t.min,t.max,e.origin),e.scale=Po(n)/Po(t),(Ro(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=Ls(n.min,n.max,e.origin)-e.originPoint,(Ro(e.translate)||isNaN(e.translate))&&(e.translate=0)}function zo(e,t,n,i){Lo(e.x,t.x,n.x,i?i.originX:void 0),Lo(e.y,t.y,n.y,i?i.originY:void 0)}function Oo(e,t,n){e.min=n.min+t.min,e.max=e.min+Po(t)}function Fo(e,t,n){e.min=t.min-n.min,e.max=e.min+Po(t)}function Bo(e,t,n){Fo(e.x,t.x,n.x),Fo(e.y,t.y,n.y)}function Vo(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function Uo(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}const Ho=.35;function qo(e,t,n){return{min:Wo(e,t),max:Wo(e,n)}}function Wo(e,t){return"number"===typeof e?e:e[t]||0}const Go=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Yo(e){return[e("x"),e("y")]}function Zo(e){let{top:t,left:n,right:i,bottom:r}=e;return{x:{min:n,max:i},y:{min:t,max:r}}}function Xo(e){return void 0===e||1===e}function Ko(e){let{scale:t,scaleX:n,scaleY:i}=e;return!Xo(t)||!Xo(n)||!Xo(i)}function Qo(e){return Ko(e)||Jo(e)||e.z||e.rotate||e.rotateX||e.rotateY}function Jo(e){return $o(e.x)||$o(e.y)}function $o(e){return e&&"0%"!==e}function el(e,t,n){return n+t*(e-n)}function tl(e,t,n,i,r){return void 0!==r&&(e=el(e,r,i)),el(e,n,i)+t}function nl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;e.min=tl(e.min,t,n,i,r),e.max=tl(e.max,t,n,i,r)}function il(e,t){let{x:n,y:i}=t;nl(e.x,n.translate,n.scale,n.originPoint),nl(e.y,i.translate,i.scale,i.originPoint)}function rl(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function sl(e,t){e.min=e.min+t,e.max=e.max+t}function al(e,t,n){let[i,r,s]=n;const a=void 0!==t[s]?t[s]:.5,o=Ls(e.min,e.max,a);nl(e,t[i],t[r],o,t.scale)}const ol=["x","scaleX","originX"],ll=["y","scaleY","originY"];function cl(e,t){al(e.x,t,ol),al(e.y,t,ll)}function dl(e,t){return Zo(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}const ul=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null},hl=new WeakMap;class pl{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e){let{snapToCursor:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new To(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Rr(e,"page").point)},onStart:(e,t)=>{const{drag:n,dragPropagation:i,onDragStart:r}=this.getProps();if(n&&!i&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=Ur(n),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Yo(e=>{let t=this.getAxisMotionValue(e).get()||0;if(Bi.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const i=n.layout.layoutBox[e];if(i){t=Po(i)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),r&&Tr.update(()=>r(e,t),!1,!0);const{animationState:s}=this.visualElement;s&&s.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:n,dragDirectionLock:i,onDirectionLock:r,onDrag:s}=this.getProps();if(!n&&!this.openGlobalLock)return;const{offset:a}=t;if(i&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(a),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,a),this.updateAxis("y",t.point,a),this.visualElement.render(),s&&s(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>Yo(e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:ul(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:i}=t;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Tr.update(()=>r(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:i}=this.getProps();if(!n||!ml(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let s=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(s=function(e,t,n){let{min:i,max:r}=t;return void 0!==i&&e<i?e=n?Ls(i,e,n.min):Math.max(e,i):void 0!==r&&e>r&&(e=n?Ls(r,e,n.max):Math.min(e,r)),e}(s,this.constraints[e],this.elastic[e])),r.set(s)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;t&&$n(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!i)&&function(e,t){let{top:n,left:i,bottom:r,right:s}=t;return{x:Vo(e.x,i,s),y:Vo(e.y,n,r)}}(i.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ho;return!1===e?e=0:!0===e&&(e=Ho),{x:qo(e,"left","right"),y:qo(e,"top","bottom")}}(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Yo(e=>{this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(i.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!$n(e))return!1;const n=e.current;ss(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,t,n){const i=dl(e,n),{scroll:r}=t;return r&&(sl(i.x,r.offset.x),sl(i.y,r.offset.y)),i}(n,i.root,this.visualElement.getTransformPagePoint());let s=function(e,t){return{x:Uo(e.x,t.x),y:Uo(e.y,t.y)}}(i.layout.layoutBox,r);if(t){const e=t(function(e){let{x:t,y:n}=e;return{top:n.min,right:t.max,bottom:n.max,left:t.min}}(s));this.hasMutatedConstraints=!!e,e&&(s=Zo(e))}return s}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:s,onDragTransitionEnd:a}=this.getProps(),o=this.constraints||{},l=Yo(a=>{if(!ml(a,t,this.currentDirection))return;let l=o&&o[a]||{};s&&(l={min:0,max:0});const c=i?200:1e6,d=i?40:1e7,u=Le(Le({type:"inertia",velocity:n?e[a]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10},r),l);return this.startAxisValueAnimation(a,u)});return Promise.all(l).then(a)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return n.start(Ga(e,n,0,t))}stopAnimation(){Yo(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Yo(e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()})}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),n=this.visualElement.getProps(),i=n[t];return i||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){Yo(t=>{const{drag:n}=this.getProps();if(!ml(t,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:n,max:s}=i.layout.layoutBox[t];r.set(e[t]-Ls(n,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!$n(t)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Yo(e=>{const t=this.getAxisMotionValue(e);if(t){const n=t.get();i[e]=function(e,t){let n=.5;const i=Po(e),r=Po(t);return r>i?n=na(t.min,t.max-i,e.min):i>r&&(n=na(e.min,e.max-r,t.min)),Ei(0,1,n)}({min:n,max:n},this.constraints[e])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Yo(t=>{if(!ml(t,e,null))return;const n=this.getAxisMotionValue(t),{min:r,max:s}=this.constraints[t];n.set(Ls(r,s,i[t]))})}addListeners(){if(!this.visualElement.current)return;hl.set(this.visualElement,this);const e=Lr(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();$n(e)&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),t();const r=Ir(window,"resize",()=>this.scalePositionWithinConstraints()),s=n.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:n}=e;this.isDragging&&n&&(Yo(e=>{const n=this.getAxisMotionValue(e);n&&(this.originPoint[e]+=t[e].translate,n.set(n.get()+t[e].translate))}),this.visualElement.render())});return()=>{r(),e(),i(),s&&s()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:s=Ho,dragMomentum:a=!0}=e;return Le(Le({},e),{},{drag:t,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:s,dragMomentum:a})}}function ml(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}const fl=e=>(t,n)=>{e&&Tr.update(()=>e(t,n))};const gl={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function xl(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const yl={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!Vi.test(e))return e;e=parseFloat(e)}const n=xl(e,t.target.x),i=xl(e,t.target.y);return"".concat(n,"% ").concat(i,"%")}},vl={correct:(e,t)=>{let{treeScale:n,projectionDelta:i}=t;const r=e,s=Ks.parse(e);if(s.length>5)return r;const a=Ks.createTransformer(e),o="number"!==typeof s[0]?1:0,l=i.x.scale*n.x,c=i.y.scale*n.y;s[0+o]/=l,s[1+o]/=c;const d=Ls(l,c,.5);return"number"===typeof s[2+o]&&(s[2+o]/=d),"number"===typeof s[3+o]&&(s[3+o]/=d),a(s)}};class _l extends i.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=e;var s;s=wl,Object.assign(yi,s),r&&(t.group&&t.group.add(r),n&&n.register&&i&&n.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions(Le(Le({},r.options),{},{onExitComplete:()=>this.safeToRemove()}))),gl.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:i,isPresent:r}=this.props,s=n.projection;return s?(s.isPresent=r,i||e.layoutDependency!==t||void 0===t?s.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?s.promote():s.relegate()||Tr.postRender(()=>{const e=s.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function bl(e){const[t,n]=function(){const e=(0,i.useContext)(Yn);if(null===e)return[!0,null];const{isPresent:t,onExitComplete:n,register:r}=e,s=(0,i.useId)();return(0,i.useEffect)(()=>r(s),[]),!t&&n?[!1,()=>n&&n(s)]:[!0]}(),r=(0,i.useContext)(di);return i.createElement(_l,Le(Le({},e),{},{layoutGroup:r,switchLayoutGroup:(0,i.useContext)(ui),isPresent:t,safeToRemove:n}))}const wl={borderRadius:Le(Le({},yl),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:yl,borderTopRightRadius:yl,borderBottomLeftRadius:yl,borderBottomRightRadius:yl,boxShadow:vl},jl=["TopLeft","TopRight","BottomLeft","BottomRight"],Nl=jl.length,Sl=e=>"string"===typeof e?parseFloat(e):e,kl=e=>"number"===typeof e||Vi.test(e);function Tl(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Cl=Al(0,.5,ws),El=Al(.5,.95,Nr);function Al(e,t,n){return i=>i<e?0:i>t?1:n(na(e,t,i))}function Ml(e,t){e.min=t.min,e.max=t.max}function Dl(e,t){Ml(e.x,t.x),Ml(e.y,t.y)}function Il(e,t,n,i,r){return e=el(e-=t,1/n,i),void 0!==r&&(e=el(e,1/r,i)),e}function Pl(e,t,n,i,r){let[s,a,o]=n;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;Bi.test(t)&&(t=parseFloat(t),t=Ls(a.min,a.max,t/100)-a.min);if("number"!==typeof t)return;let o=Ls(s.min,s.max,i);e===s&&(o-=t),e.min=Il(e.min,t,n,o,r),e.max=Il(e.max,t,n,o,r)}(e,t[s],t[a],t[o],t.scale,i,r)}const Rl=["x","scaleX","originX"],Ll=["y","scaleY","originY"];function zl(e,t,n,i){Pl(e.x,t,Rl,n?n.x:void 0,i?i.x:void 0),Pl(e.y,t,Ll,n?n.y:void 0,i?i.y:void 0)}function Ol(e){return 0===e.translate&&1===e.scale}function Fl(e){return Ol(e.x)&&Ol(e.y)}function Bl(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function Vl(e){return Po(e.x)/Po(e.y)}class Ul{constructor(){this.members=[]}add(e){Xa(this.members,e),e.scheduleRender()}remove(e){if(Ka(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let n;for(let i=t;i>=0;i--){const e=this.members[i];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Hl(e,t,n){let i="";const r=e.x.translate/t.x,s=e.y.translate/t.y;if((r||s)&&(i="translate3d(".concat(r,"px, ").concat(s,"px, 0) ")),1===t.x&&1===t.y||(i+="scale(".concat(1/t.x,", ").concat(1/t.y,") ")),n){const{rotate:e,rotateX:t,rotateY:r}=n;e&&(i+="rotate(".concat(e,"deg) ")),t&&(i+="rotateX(".concat(t,"deg) ")),r&&(i+="rotateY(".concat(r,"deg) "))}const a=e.x.scale*t.x,o=e.y.scale*t.y;return 1===a&&1===o||(i+="scale(".concat(a,", ").concat(o,")")),i||"none"}const ql=(e,t)=>e.depth-t.depth;class Wl{constructor(){this.children=[],this.isDirty=!1}add(e){Xa(this.children,e),this.isDirty=!0}remove(e){Ka(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(ql),this.isDirty=!1,this.children.forEach(e)}}const Gl=["","X","Y","Z"],Yl={visibility:"hidden"};let Zl=0;const Xl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function Kl(e){let{attachResizeListener:t,defaultParent:n,measureScroll:i,checkIsScrollRoot:r,resetTransform:s}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===n||void 0===n?void 0:n();this.id=Zl++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Xl.totalNodes=Xl.resolvedTargetDeltas=Xl.recalculatedProjection=0,this.nodes.forEach($l),this.nodes.forEach(ac),this.nodes.forEach(oc),this.nodes.forEach(ec),function(e){window.MotionDebug&&window.MotionDebug.record(e)}(Xl)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new Wl)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Qa),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t&&t.notify(...i)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var i;this.isSVG=(i=e)instanceof SVGElement&&"svg"!==i.tagName,this.instance=e;const{layoutId:r,layout:s,visualElement:a}=this.options;if(a&&!a.current&&a.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),n&&(s||r)&&(this.isLayoutDirty=!0),t){let n;const i=()=>this.root.updateBlockedByResize=!1;t(e,()=>{this.root.updateBlockedByResize=!0,n&&n(),n=function(e,t){const n=performance.now(),i=r=>{let{timestamp:s}=r;const a=s-n;a>=t&&(Cr(i),e(a-t))};return Tr.read(i,!0),()=>Cr(i)}(i,250),gl.hasAnimatedSinceResize&&(gl.hasAnimatedSinceResize=!1,this.nodes.forEach(sc))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&a&&(r||s)&&this.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:n,hasRelativeTargetChanged:i,layout:r}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const s=this.options.transition||a.getDefaultTransition()||pc,{onLayoutAnimationStart:o,onLayoutAnimationComplete:l}=a.getProps(),c=!this.targetLayout||!Bl(this.targetLayout,r)||i,d=!n&&i;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||d||n&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(t,d);const e=Le(Le({},qa(s,"layout")),{},{onPlay:o,onComplete:l});(a.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e)}else n||sc(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Cr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(lc),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(nc);this.isUpdating||this.nodes.forEach(ic),this.isUpdating=!1,this.nodes.forEach(rc),this.nodes.forEach(Ql),this.nodes.forEach(Jl),this.clearAllSnapshots();const e=performance.now();Er.delta=Ei(0,1e3/60,e-Er.timestamp),Er.timestamp=e,Er.isProcessing=!0,Ar.update.process(Er),Ar.preRender.process(Er),Ar.render.process(Er),Er.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(tc),this.sharedNodes.forEach(cc)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Tr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Tr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&(this.scroll={animationId:this.root.animationId,phase:e,isRoot:r(this.instance),offset:i(this.instance)})}resetTransform(){if(!s)return;const e=this.isLayoutDirty||this.shouldResetTransform,t=this.projectionDelta&&!Fl(this.projectionDelta),n=this.getTransformTemplate(),i=n?n(this.latestValues,""):void 0,r=i!==this.prevTransformTemplateValue;e&&(t||Qo(this.latestValues)||r)&&(s(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let n=this.removeElementScroll(t);var i;return e&&(n=this.removeTransform(n)),gc((i=n).x),gc(i.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox(),{scroll:n}=this.root;return n&&(sl(t.x,n.offset.x),sl(t.y,n.offset.y)),t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Dl(t,e);for(let n=0;n<this.path.length;n++){const i=this.path[n],{scroll:r,options:s}=i;if(i!==this.root&&r&&s.layoutScroll){if(r.isRoot){Dl(t,e);const{scroll:n}=this.root;n&&(sl(t.x,-n.offset.x),sl(t.y,-n.offset.y))}sl(t.x,r.offset.x),sl(t.y,r.offset.y)}}return t}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={x:{min:0,max:0},y:{min:0,max:0}};Dl(n,e);for(let i=0;i<this.path.length;i++){const e=this.path[i];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&cl(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),Qo(e.latestValues)&&cl(n,e.latestValues)}return Qo(this.latestValues)&&cl(n,this.latestValues),n}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Dl(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!Qo(e.latestValues))continue;Ko(e.latestValues)&&e.updateSnapshot();const i=Go();Dl(i,e.measurePageBox()),zl(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,i)}return Qo(this.latestValues)&&zl(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options=Le(Le(Le({},this.options),e),{},{crossfade:void 0===e.crossfade||e.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Er.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==n;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget))return;const{layout:r,layoutId:s}=this.options;if(this.layout&&(r||s)){if(this.resolvedRelativeTargetAt=Er.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Bo(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Dl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),function(e,t,n){Oo(e.x,t.x,n.x),Oo(e.y,t.y,n.y)}(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Dl(this.target,this.layout.layoutBox),il(this.target,this.targetDelta)):Dl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Bo(this.relativeTargetOrigin,this.target,e.target),Dl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Xl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Ko(this.parent.latestValues)&&!Jo(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let i=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(i=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===Er.timestamp&&(i=!1),i)return;const{layout:r,layoutId:s}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!s)return;Dl(this.layoutCorrected,this.layout.layoutBox);const a=this.treeScale.x,o=this.treeScale.y;!function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n.length;if(!r)return;let s,a;t.x=t.y=1;for(let o=0;o<r;o++){s=n[o],a=s.projectionDelta;const r=s.instance;r&&r.style&&"contents"===r.style.display||(i&&s.options.layoutScroll&&s.scroll&&s!==s.root&&cl(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,il(e,a)),i&&Qo(s.latestValues)&&cl(e,s.latestValues))}t.x=rl(t.x),t.y=rl(t.y)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox);const{target:l}=t;if(!l)return void(this.projectionTransform&&(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionTransform="none",this.scheduleRender()));this.projectionDelta||(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}});const c=this.projectionTransform;zo(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.projectionTransform=Hl(this.projectionDelta,this.treeScale),this.projectionTransform===c&&this.treeScale.x===a&&this.treeScale.y===o||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Xl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.options.scheduleRender&&this.options.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,i=n?n.latestValues:{},r=Le({},this.latestValues),s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const a={x:{min:0,max:0},y:{min:0,max:0}},o=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(hc));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;dc(s.x,e.x,n),dc(s.y,e.y,n),this.setTargetDelta(s),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Bo(a,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,i){uc(e.x,t.x,n.x,i),uc(e.y,t.y,n.y,i)}(this.relativeTarget,this.relativeTargetOrigin,a,n),u&&function(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}(this.relativeTarget,u)&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),Dl(u,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,n,i,r,s){r?(e.opacity=Ls(0,void 0!==n.opacity?n.opacity:1,Cl(i)),e.opacityExit=Ls(void 0!==t.opacity?t.opacity:1,0,El(i))):s&&(e.opacity=Ls(void 0!==t.opacity?t.opacity:1,void 0!==n.opacity?n.opacity:1,i));for(let a=0;a<Nl;a++){const r="border".concat(jl[a],"Radius");let s=Tl(t,r),o=Tl(n,r);void 0===s&&void 0===o||(s||(s=0),o||(o=0),0===s||0===o||kl(s)===kl(o)?(e[r]=Math.max(Ls(Sl(s),Sl(o),i),0),(Bi.test(o)||Bi.test(s))&&(e[r]+="%")):e[r]=o)}(t.rotate||n.rotate)&&(e.rotate=Ls(t.rotate||0,n.rotate||0,i))}(r,i,this.latestValues,n,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Cr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Tr.update(()=>{gl.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,n){const i=wi(e)?e:eo(e);return i.start(Ga("",i,t,n)),i.animation}(0,1e3,Le(Le({},e),{},{onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:i,latestValues:r}=e;if(t&&n&&i){if(this!==e&&this.layout&&i&&xc(this.options.animationType,this.layout.layoutBox,i.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Po(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const i=Po(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+i}Dl(t,n),cl(t,r),zo(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Ul);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=this.getStack();i&&i.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.rotate||n.rotateX||n.rotateY||n.rotateZ)&&(t=!0),!t)return;const i={};for(let r=0;r<Gl.length;r++){const t="rotate"+Gl[r];n[t]&&(i[t]=n[t],e.setStaticValue(t,0))}e.render();for(const r in i)e.setStaticValue(r,i[r]);e.scheduleRender()}getProjectionStyles(e){var t,n;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Yl;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=_r(null===e||void 0===e?void 0:e.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const s=this.getLead();if(!this.projectionDelta||!this.layout||!s.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=_r(null===e||void 0===e?void 0:e.pointerEvents)||""),this.hasProjected&&!Qo(this.latestValues)&&(t.transform=r?r({},""):"none",this.hasProjected=!1),t}const a=s.animationValues||s.latestValues;this.applyTransformsToTarget(),i.transform=Hl(this.projectionDeltaWithTransform,this.treeScale,a),r&&(i.transform=r(a,i.transform));const{x:o,y:l}=this.projectionDelta;i.transformOrigin="".concat(100*o.origin,"% ").concat(100*l.origin,"% 0"),s.animationValues?i.opacity=s===this?null!==(n=null!==(t=a.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==n?n:1:this.preserveOpacity?this.latestValues.opacity:a.opacityExit:i.opacity=s===this?void 0!==a.opacity?a.opacity:"":void 0!==a.opacityExit?a.opacityExit:0;for(const c in yi){if(void 0===a[c])continue;const{correct:e,applyTo:t}=yi[c],n="none"===i.transform?a[c]:e(a[c],s);if(t){const e=t.length;for(let r=0;r<e;r++)i[t[r]]=n}else i[c]=n}return this.options.layoutId&&(i.pointerEvents=s===this?_r(null===e||void 0===e?void 0:e.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()}),this.root.nodes.forEach(nc),this.root.sharedNodes.clear()}}}function Ql(e){e.updateLayout()}function Jl(e){var t;const n=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=e.layout,{animationType:r}=e.options,s=n.source!==e.layout.source;"size"===r?Yo(e=>{const i=s?n.measuredBox[e]:n.layoutBox[e],r=Po(i);i.min=t[e].min,i.max=i.min+r}):xc(r,n.layoutBox,t)&&Yo(i=>{const r=s?n.measuredBox[i]:n.layoutBox[i],a=Po(t[i]);r.max=r.min+a,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+a)});const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};zo(a,t,n.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};s?zo(o,e.applyTransform(i,!0),n.measuredBox):zo(o,t,n.layoutBox);const l=!Fl(a);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:s}=i;if(r&&s){const a={x:{min:0,max:0},y:{min:0,max:0}};Bo(a,n.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};Bo(o,t,s.layoutBox),Bl(a,o)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=a,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function $l(e){Xl.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function ec(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function tc(e){e.clearSnapshot()}function nc(e){e.clearMeasurements()}function ic(e){e.isLayoutDirty=!1}function rc(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function sc(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function ac(e){e.resolveTargetDelta()}function oc(e){e.calcProjection()}function lc(e){e.resetRotation()}function cc(e){e.removeLeadSnapshot()}function dc(e,t,n){e.translate=Ls(t.translate,0,n),e.scale=Ls(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function uc(e,t,n,i){e.min=Ls(t.min,n.min,i),e.max=Ls(t.max,n.max,i)}function hc(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const pc={duration:.45,ease:[.4,0,.1,1]},mc=e=>"undefined"!==typeof navigator&&navigator.userAgent.toLowerCase().includes(e),fc=mc("applewebkit/")&&!mc("chrome/")?Math.round:Nr;function gc(e){e.min=fc(e.min),e.max=fc(e.max)}function xc(e,t,n){return"position"===e||"preserve-aspect"===e&&!Ro(Vl(t),Vl(n),.2)}const yc=Kl({attachResizeListener:(e,t)=>Ir(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),vc={current:void 0},_c=Kl({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!vc.current){const e=new yc({});e.mount(window),e.setOptions({layoutScroll:!0}),vc.current=e}return vc.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),bc={pan:{Feature:class extends qr{constructor(){super(...arguments),this.removePointerDownListener=Nr}onPointerDown(e){this.session=new To(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ul(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:fl(e),onStart:fl(t),onMove:n,onEnd:(e,t)=>{delete this.session,i&&Tr.update(()=>i(e,t))}}}mount(){this.removePointerDownListener=Lr(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends qr{constructor(e){super(e),this.removeGroupControls=Nr,this.removeListeners=Nr,this.controls=new pl(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Nr}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:_c,MeasureLayout:bl}};function wc(e){if(null==e)throw new TypeError("Cannot destructure "+e)}const jc=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Nc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;ss(n<=4,'Max CSS variable fallback depth detected in property "'.concat(e,'". This may indicate a circular fallback dependency.'));const[i,r]=function(e){const t=jc.exec(e);if(!t)return[,];const[,n,i]=t;return[n,i]}(e);if(!i)return;const s=window.getComputedStyle(t).getPropertyValue(i);if(s){const e=s.trim();return Za(e)?parseFloat(e):e}return Ti(r)?Nc(r,t,n+1):r}const Sc=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),kc=e=>Sc.has(e),Tc=e=>e===Ai||e===Vi,Cc=(e,t)=>parseFloat(e.split(", ")[t]),Ec=(e,t)=>(n,i)=>{let{transform:r}=i;if("none"===r||!r)return 0;const s=r.match(/^matrix3d\((.+)\)$/);if(s)return Cc(s[1],t);{const t=r.match(/^matrix\((.+)\)$/);return t?Cc(t[1],e):0}},Ac=new Set(["x","y","z"]),Mc=vi.filter(e=>!Ac.has(e));const Dc={width:(e,t)=>{let{x:n}=e,{paddingLeft:i="0",paddingRight:r="0"}=t;return n.max-n.min-parseFloat(i)-parseFloat(r)},height:(e,t)=>{let{y:n}=e,{paddingTop:i="0",paddingBottom:r="0"}=t;return n.max-n.min-parseFloat(i)-parseFloat(r)},top:(e,t)=>{let{top:n}=t;return parseFloat(n)},left:(e,t)=>{let{left:n}=t;return parseFloat(n)},bottom:(e,t)=>{let{y:n}=e,{top:i}=t;return parseFloat(i)+(n.max-n.min)},right:(e,t)=>{let{x:n}=e,{left:i}=t;return parseFloat(i)+(n.max-n.min)},x:Ec(4,13),y:Ec(5,14)};Dc.translateX=Dc.x,Dc.translateY=Dc.y;const Ic=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t=Le({},t),i=Le({},i);const r=Object.keys(t).filter(kc);let s=[],a=!1;const o=[];if(r.forEach(r=>{const l=e.getValue(r);if(!e.hasValue(r))return;let c=n[r],d=io(c);const u=t[r];let h;if(yr(u)){const e=u.length,t=null===u[0]?1:0;c=u[t],d=io(c);for(let n=t;n<e&&null!==u[n];n++)h?ss(io(u[n])===h,"All keyframes must be of the same type"):(h=io(u[n]),ss(h===d||Tc(d)&&Tc(h),"Keyframes must be of the same dimension as the current value"))}else h=io(u);if(d!==h)if(Tc(d)&&Tc(h)){const e=l.get();"string"===typeof e&&l.set(parseFloat(e)),"string"===typeof u?t[r]=parseFloat(u):Array.isArray(u)&&h===Vi&&(t[r]=u.map(parseFloat))}else(null===d||void 0===d?void 0:d.transform)&&(null===h||void 0===h?void 0:h.transform)&&(0===c||0===u)?0===c?l.set(h.transform(c)):t[r]=d.transform(u):(a||(s=function(e){const t=[];return Mc.forEach(n=>{const i=e.getValue(n);void 0!==i&&(t.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),t.length&&e.render(),t}(e),a=!0),o.push(r),i[r]=void 0!==i[r]?i[r]:t[r],l.jump(u))}),o.length){const n=o.indexOf("height")>=0?window.pageYOffset:null,r=((e,t,n)=>{const i=t.measureViewportBox(),r=t.current,s=getComputedStyle(r),{display:a}=s,o={};"none"===a&&t.setStaticValue("display",e.display||"block"),n.forEach(e=>{o[e]=Dc[e](i,s)}),t.render();const l=t.measureViewportBox();return n.forEach(n=>{const i=t.getValue(n);i&&i.jump(o[n]),e[n]=Dc[n](l,s)}),e})(t,e,o);return s.length&&s.forEach(t=>{let[n,i]=t;e.getValue(n).set(i)}),e.render(),Zn&&null!==n&&window.scrollTo({top:n}),{target:r,transitionEnd:i}}return{target:t,transitionEnd:i}};function Pc(e,t,n,i){return(e=>Object.keys(e).some(kc))(t)?Ic(e,t,n,i):{target:t,transitionEnd:i}}const Rc=(e,t,n,i)=>{const r=function(e,t,n){let i=Object.assign({},(wc(t),t));const r=e.current;if(!(r instanceof Element))return{target:i,transitionEnd:n};n&&(n=Le({},n)),e.values.forEach(e=>{const t=e.get();if(!Ti(t))return;const n=Nc(t,r);n&&e.set(n)});for(const s in i){const e=i[s];if(!Ti(e))continue;const t=Nc(e,r);t&&(i[s]=t,n||(n={}),void 0===n[s]&&(n[s]=e))}return{target:i,transitionEnd:n}}(e,t,i);return Pc(e,t=r.target,n,i=r.transitionEnd)},Lc={current:null},zc={current:!1};const Oc=new WeakMap,Fc=["willChange"],Bc=["children"],Vc=Object.keys(ci),Uc=Vc.length,Hc=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],qc=ii.length;class Wc{constructor(e){let{parent:t,props:n,presenceContext:i,reducedMotionConfig:r,visualState:s}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Tr.render(this.render,!1,!0);const{latestValues:o,renderState:l}=s;this.latestValues=o,this.baseTarget=Le({},o),this.initialValues=n.initial?Le({},o):{},this.renderState=l,this.parent=t,this.props=n,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.isControllingVariants=ri(n),this.isVariantNode=si(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const c=this.scrapeMotionValuesFromProps(n,{}),{willChange:d}=c,u=vn(c,Fc);for(const h in u){const e=u[h];void 0!==o[h]&&wi(e)&&(e.set(o[h],!1),Ya(d)&&d.add(h))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,Oc.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),zc.current||function(){if(zc.current=!0,Zn)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Lc.current=e.matches;e.addListener(t),t()}else Lc.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Lc.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Oc.delete(this.current),this.projection&&this.projection.unmount(),Cr(this.notifyUpdate),Cr(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const n=_i.has(e),i=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&Tr.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),r=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{i(),r()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}loadFeatures(e,t,n,i){let r,s,{children:a}=e,o=vn(e,Bc);for(let l=0;l<Uc;l++){const e=Vc[l],{isEnabled:t,Feature:n,ProjectionNode:i,MeasureLayout:a}=ci[e];i&&(r=i),t(o)&&(!this.features[e]&&n&&(this.features[e]=new n(this)),a&&(s=a))}if(("html"===this.type||"svg"===this.type)&&!this.projection&&r){this.projection=new r(this.latestValues,this.parent&&this.parent.projection);const{layoutId:e,layout:t,drag:n,dragConstraints:s,layoutScroll:a,layoutRoot:l}=o;this.projection.setOptions({layoutId:e,layout:t,alwaysMeasureLayout:Boolean(n)||s&&$n(s),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:"string"===typeof t?t:"both",initialPromotionConfig:i,layoutScroll:a,layoutRoot:l})}return s}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<Hc.length;n++){const t=Hc[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,t,n){const{willChange:i}=t;for(const r in t){const s=t[r],a=n[r];if(wi(s))e.addValue(r,s),Ya(i)&&i.add(r);else if(wi(a))e.addValue(r,eo(s,{owner:e})),Ya(i)&&i.remove(r);else if(a!==s)if(e.hasValue(r)){const t=e.getValue(r);!t.hasAnimated&&t.set(s)}else{const t=e.getStaticValue(r);e.addValue(r,eo(void 0!==t?t:s,{owner:e}))}}for(const r in n)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const e=this.parent&&this.parent.getVariantContext()||{};return void 0!==this.props.initial&&(e.initial=this.props.initial),e}const e={};for(let t=0;t<qc;t++){const n=ii[t],i=this.props[n];(ei(i)||!1===i)&&(e[n]=i)}return e}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=eo(t,{owner:this}),this.addValue(e,n)),n}readValue(e){var t;return void 0===this.latestValues[e]&&this.current?null!==(t=this.getBaseTargetFromProps(this.props,e))&&void 0!==t?t:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e]}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props,i="string"===typeof n||"object"===typeof n?null===(t=gr(this.props,n))||void 0===t?void 0:t[e]:void 0;if(n&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||wi(r)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new Qa),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.events[e].notify(...n)}}}const Gc=["transition","transitionEnd"];class Yc extends Wc{sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:n,style:i}=t;delete n[e],delete i[e]}makeTargetAnimatableFromInstance(e,t,n){let{transition:i,transitionEnd:r}=e,s=vn(e,Gc),{transformValues:a}=t,o=function(e,t,n){const i={};for(const r in e){const e=co(r,t);if(void 0!==e)i[r]=e;else{const e=n.getValue(r);e&&(i[r]=e.get())}}return i}(s,i||{},this);if(a&&(r&&(r=a(r)),s&&(s=a(s)),o&&(o=a(o))),n){!function(e,t,n){var i,r;const s=Object.keys(t).filter(t=>!e.hasValue(t)),a=s.length;if(a)for(let o=0;o<a;o++){const a=s[o],l=t[a];let c=null;Array.isArray(l)&&(c=l[0]),null===c&&(c=null!==(r=null!==(i=n[a])&&void 0!==i?i:e.readValue(a))&&void 0!==r?r:t[a]),void 0!==c&&null!==c&&("string"===typeof c&&(Za(c)||Va(c))?c=parseFloat(c):!so(c)&&Ks.test(l)&&(c=Ba(a,l)),e.addValue(a,eo(c,{owner:e})),void 0===n[a]&&(n[a]=c),null!==c&&e.setBaseTarget(a,c))}}(this,s,o);const e=Rc(this,s,o,r);r=e.transitionEnd,s=e.target}return Le({transition:i,transitionEnd:r},s)}}class Zc extends Yc{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(_i.has(t)){const e=Fa(t);return e&&e.default||0}{const i=(n=e,window.getComputedStyle(n)),r=(ki(t)?i.getPropertyValue(t):i[t])||0;return"string"===typeof r?r.trim():r}var n}measureInstanceViewportBox(e,t){let{transformPagePoint:n}=t;return dl(e,n)}build(e,t,n,i){Yi(e,t,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,t){return mr(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;wi(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent="".concat(e))}))}renderInstance(e,t,n,i){ur(e,t,n,i)}}class Xc extends Yc{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(_i.has(t)){const e=Fa(t);return e&&e.default||0}return t=hr.has(t)?t:Qn(t),e.getAttribute(t)}measureInstanceViewportBox(){return{x:{min:0,max:0},y:{min:0,max:0}}}scrapeMotionValuesFromProps(e,t){return fr(e,t)}build(e,t,n,i){ar(e,t,n,this.isSVGTag,i.transformTemplate)}renderInstance(e,t,n,i){pr(e,t,0,i)}mount(e){this.isSVGTag=lr(e.tagName),super.mount(e)}}const Kc=(e,t)=>xi(e)?new Xc(t,{enableHardwareAcceleration:!1}):new Zc(t,{enableHardwareAcceleration:!0}),Qc={layout:{ProjectionNode:_c,MeasureLayout:bl}},Jc=Le(Le(Le(Le({},So),ts),bc),Qc),$c=fi((e,t)=>function(e,t,n,i){let{forwardMotionProps:r=!1}=t;return Le(Le({},xi(e)?Mr:Dr),{},{preloadedFeatures:n,useRender:dr(r),createVisualElement:i,Component:e})}(e,t,Jc,Kc));const ed=wn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),td=wn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),nd=wn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),id=wn("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),rd=wn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),sd=e=>{let{size:t=36,showSubtitle:n=!0}=e;const i="#0D1B2A",r="#00ACC1",s="#00838F",a="#E91E63",o="#FF8A00",l="#FFFFFF",c=t+8;return(0,ze.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},"aria-label":"YATRIK ERP",children:[(0,ze.jsxs)("svg",{width:c,height:c,viewBox:"0 0 96 96",role:"img",focusable:"false","aria-hidden":"true",style:{display:"block"},children:[(0,ze.jsxs)("defs",{children:[(0,ze.jsxs)("linearGradient",{id:"tealGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,ze.jsx)("stop",{offset:"0%",stopColor:r}),(0,ze.jsx)("stop",{offset:"100%",stopColor:s})]}),(0,ze.jsxs)("radialGradient",{id:"headlight",cx:"70%",cy:"58%",r:"30%",children:[(0,ze.jsx)("stop",{offset:"0%",stopColor:o,stopOpacity:"1"}),(0,ze.jsx)("stop",{offset:"100%",stopColor:o,stopOpacity:"0"})]})]}),(0,ze.jsx)("circle",{cx:"48",cy:"48",r:"44",fill:"url(#tealGradient)"}),(0,ze.jsx)("path",{d:"M12 66c18-10 36-12 72-4",stroke:l,strokeOpacity:"0.9",strokeWidth:"3.2",fill:"none",strokeLinecap:"round"}),(0,ze.jsxs)("g",{transform:"translate(18,26)",children:[(0,ze.jsx)("rect",{x:"0",y:"14",width:"60",height:"26",rx:"6",fill:l,opacity:"0.96"}),(0,ze.jsx)("rect",{x:"6",y:"18",width:"36",height:"10",rx:"3",fill:"#CFD8DC"}),(0,ze.jsx)("rect",{x:"44",y:"18",width:"8",height:"10",rx:"2",fill:"#CFD8DC"}),(0,ze.jsx)("rect",{x:"4",y:"33",width:"52",height:"3.5",rx:"1.75",fill:a}),(0,ze.jsx)("circle",{cx:"12",cy:"44",r:"4.8",fill:i}),(0,ze.jsx)("circle",{cx:"48",cy:"44",r:"4.8",fill:i}),(0,ze.jsx)("circle",{cx:"12",cy:"44",r:"2",fill:"#B0BEC5"}),(0,ze.jsx)("circle",{cx:"48",cy:"44",r:"2",fill:"#B0BEC5"}),(0,ze.jsx)("circle",{cx:"56",cy:"30",r:"10",fill:"url(#headlight)"}),(0,ze.jsx)("circle",{cx:"56",cy:"30",r:"3",fill:o})]})]}),(0,ze.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:8,lineHeight:1},children:[(0,ze.jsx)("span",{style:{fontWeight:900,fontSize:t,letterSpacing:"0.5px",color:i},children:"YATRIK"}),n&&(0,ze.jsx)("span",{style:{display:"inline-block",background:a,color:l,padding:"4px 8px",borderRadius:999,fontWeight:800,fontSize:Math.max(12,Math.round(.45*t)),lineHeight:1,letterSpacing:"0.6px"},children:"ERP"})]})]})},ad=e=>{let{isMobileMenuOpen:t,setIsMobileMenuOpen:n}=e;const[r,s]=(0,i.useState)(!1),{user:a}=Fe(),o=te(),l=e=>{o(a?"/pax#".concat(e):"/login?next=/pax#".concat(e))},c=[{name:"Contact Us",slug:"contact"},{name:"Cancellation",slug:"cancellation"},{name:"Feedback",slug:"feedback"},{name:"Manage Booking",slug:"manage"},{name:"Gallery",href:"/gallery"},{name:"Status Check",slug:"status"}];return(0,ze.jsx)("nav",{className:"bg-white/90 backdrop-blur border-b border-gray-100 shadow-sm",children:(0,ze.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between gap-4 py-4",children:[(0,ze.jsx)(Ae,{to:"/",className:"flex items-center hover:opacity-80 transition-opacity duration-200 shrink-0",children:(0,ze.jsx)(sd,{size:28})}),(0,ze.jsx)("div",{className:"hidden md:flex items-center justify-center gap-6 flex-1",children:c.map(e=>e.slug?(0,ze.jsx)("button",{onClick:()=>l(e.slug),className:"text-gray-800 hover:text-pink-600 transition-colors font-semibold text-base px-2 py-1 rounded-md hover:bg-gray-100",children:e.name},e.name):(0,ze.jsx)(Ae,{to:e.href,className:"text-gray-800 hover:text-pink-600 transition-colors font-semibold text-base px-2 py-1 rounded-md hover:bg-gray-100",children:e.name},e.name))}),(0,ze.jsxs)("div",{className:"hidden md:flex items-center gap-3 shrink-0",children:[(0,ze.jsxs)(Ae,{to:"/login",className:"flex items-center space-x-2 border border-pink-500 text-pink-600 hover:bg-pink-50 transition-colors font-semibold text-base px-3 py-2 rounded-md",children:[(0,ze.jsx)(ed,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Login"})]}),(0,ze.jsx)(Ae,{to:"/signup",className:"signup-cta",children:"Sign Up"})]}),(0,ze.jsx)("button",{onClick:()=>{s(!r)},className:"md:hidden p-2 rounded-md text-gray-700 hover:text-pink-600 hover:bg-gray-100 transition-colors",children:r?(0,ze.jsx)(Fn,{className:"w-6 h-6"}):(0,ze.jsx)(Vn,{className:"w-6 h-6"})})]}),r&&(0,ze.jsx)("div",{className:"md:hidden py-4 border-t bg-gradient-to-b from-white/80 to-white",children:(0,ze.jsxs)("div",{className:"flex flex-col space-y-4",children:[c.map(e=>e.slug?(0,ze.jsx)("button",{onClick:()=>{l(e.slug),s(!1)},className:"text-gray-800 hover:text-pink-600 transition-colors font-medium text-base px-4 py-2 rounded-md hover:bg-gray-100 w-full text-left",children:e.name},e.name):(0,ze.jsx)(Ae,{to:e.href,className:"text-gray-800 hover:text-pink-600 transition-colors font-medium text-base px-4 py-2 rounded-md hover:bg-gray-100",onClick:()=>s(!1),children:e.name},e.name)),(0,ze.jsxs)("div",{className:"pt-4 border-t",children:[(0,ze.jsxs)(Ae,{to:"/login",className:"flex items-center space-x-2 border border-pink-500 text-pink-600 hover:bg-pink-50 transition-colors font-semibold text-base px-4 py-2 rounded-md mb-2",onClick:()=>s(!1),children:[(0,ze.jsx)(ed,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Login"})]}),(0,ze.jsx)(Ae,{to:"/signup",className:"bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition-colors font-semibold inline-block",onClick:()=>s(!1),children:"Sign Up"})]})]})})]})})},od=wn("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]),ld=wn("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]),cd=wn("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]),dd=wn("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]),ud=()=>(0,ze.jsx)("div",{className:"support-bar",children:(0,ze.jsxs)("div",{className:"support-inner",children:[(0,ze.jsxs)("div",{className:"support-left",children:[(0,ze.jsxs)("div",{className:"support-item",children:[(0,ze.jsx)(rd,{className:"support-icon"}),(0,ze.jsx)("span",{className:"support-text",children:"1800-123-4567"})]}),(0,ze.jsxs)("div",{className:"support-item",children:[(0,ze.jsx)(td,{className:"support-icon"}),(0,ze.jsx)("span",{className:"support-text",children:"24/7 Support"})]})]}),(0,ze.jsxs)("div",{className:"support-right",children:[(0,ze.jsx)("a",{href:"#","aria-label":"Facebook",className:"support-link",children:(0,ze.jsx)(od,{className:"support-icon"})}),(0,ze.jsx)("a",{href:"#","aria-label":"Twitter",className:"support-link",children:(0,ze.jsx)(ld,{className:"support-icon"})}),(0,ze.jsx)("a",{href:"#","aria-label":"Instagram",className:"support-link",children:(0,ze.jsx)(cd,{className:"support-icon"})}),(0,ze.jsx)("a",{href:"#","aria-label":"YouTube",className:"support-link",children:(0,ze.jsx)(dd,{className:"support-icon"})})]})]})}),hd=wn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),pd=()=>(0,ze.jsx)("section",{className:"app-banner",children:(0,ze.jsx)("div",{className:"container",children:(0,ze.jsxs)("div",{className:"app-banner__grid",children:[(0,ze.jsxs)("div",{className:"app-banner__content",children:[(0,ze.jsx)("h2",{className:"app-banner__title",children:"Get the YATRIK ERP App"}),(0,ze.jsx)("p",{className:"app-banner__subtitle",children:"Book tickets, track buses, and manage your travel on the go with our mobile app."}),(0,ze.jsxs)("div",{className:"app-banner__rating",children:[(0,ze.jsx)("div",{className:"app-banner__stars",children:[...Array(5)].map((e,t)=>(0,ze.jsx)(nd,{className:"star"},t))}),(0,ze.jsx)("span",{className:"app-banner__rating-text",children:"4.8/5 from 10,000+ users"})]}),(0,ze.jsxs)("div",{className:"app-banner__buttons",children:[(0,ze.jsxs)("button",{className:"app-btn",children:[(0,ze.jsx)(hd,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"App Store"})]}),(0,ze.jsxs)("button",{className:"app-btn",children:[(0,ze.jsx)(hd,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Google Play"})]})]})]}),(0,ze.jsx)("div",{className:"app-banner__mockup",children:(0,ze.jsx)("div",{className:"phone-mockup",children:(0,ze.jsxs)("div",{className:"phone-mockup__screen",children:[(0,ze.jsx)(On,{className:"phone-mockup__icon"}),(0,ze.jsxs)("div",{className:"phone-mockup__content",children:[(0,ze.jsx)("div",{className:"phone-mockup__logo",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,ze.jsx)(sd,{size:20})}),(0,ze.jsx)("p",{className:"phone-mockup__label",children:"Smart Travel App"})]})]})})})]})})}),md=e=>{let{routes:t}=e;return(0,ze.jsxs)("div",{className:"popular-routes",children:[(0,ze.jsx)("h3",{className:"popular-routes__title",children:"Popular Routes"}),(0,ze.jsx)("div",{className:"popular-routes__list",children:t.map((e,t)=>(0,ze.jsxs)("div",{className:"route-card",children:[(0,ze.jsxs)("div",{className:"route-card__content",children:[(0,ze.jsx)("div",{className:"route-card__icon",children:(0,ze.jsx)(Sn,{className:"w-5 h-5"})}),(0,ze.jsxs)("div",{className:"route-card__info",children:[(0,ze.jsxs)("div",{className:"route-card__route",children:[e.from," ",(0,ze.jsx)(ed,{className:"inline w-3 h-3 mx-1"})," ",e.to]}),(0,ze.jsxs)("div",{className:"route-card__details",children:[(0,ze.jsxs)("span",{className:"route-card__frequency",children:[(0,ze.jsx)(td,{className:"w-3 h-3"}),e.frequency]}),(0,ze.jsx)("span",{className:"route-card__fare",children:e.fare})]})]})]}),(0,ze.jsx)("button",{className:"route-card__cta",children:"Book"})]},t))})]})},fd=wn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),gd=wn("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),xd=wn("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),yd=wn("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),vd=e=>{let{alerts:t}=e;const n=e=>{switch(e){case"info":return(0,ze.jsx)(fd,{className:"alert__icon alert__icon--info"});case"warning":return(0,ze.jsx)(gd,{className:"alert__icon alert__icon--warning"});case"success":return(0,ze.jsx)(xd,{className:"alert__icon alert__icon--success"});default:return(0,ze.jsx)(yd,{className:"alert__icon alert__icon--default"})}};return(0,ze.jsxs)("div",{className:"service-alerts",children:[(0,ze.jsx)("h3",{className:"service-alerts__title",children:"Service Updates"}),(0,ze.jsx)("div",{className:"service-alerts__list",children:t.map((e,t)=>(0,ze.jsx)("div",{className:"alert alert--".concat(e.type),children:(0,ze.jsxs)("div",{className:"alert__content",children:[n(e.type),(0,ze.jsx)("p",{className:"alert__message",children:e.message})]})},t))})]})},_d=wn("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);function bd(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}let wd={data:""},jd=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||wd,Nd=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Sd=/\/\*[^]*?\*\/|  +/g,kd=/\n+/g,Td=(e,t)=>{let n="",i="",r="";for(let s in e){let a=e[s];"@"==s[0]?"i"==s[1]?n=s+" "+a+";":i+="f"==s[1]?Td(a,s):s+"{"+Td(a,"k"==s[1]?"":t)+"}":"object"==typeof a?i+=Td(a,t?t.replace(/([^,])+/g,e=>s.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):s):null!=a&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),r+=Td.p?Td.p(s,a):s+":"+a+";")}return n+(t&&r?t+"{"+r+"}":r)+i},Cd={},Ed=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+Ed(e[n]);return t}return e},Ad=(e,t,n,i,r)=>{let s=Ed(e),a=Cd[s]||(Cd[s]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(s));if(!Cd[a]){let t=s!==e?e:(e=>{let t,n,i=[{}];for(;t=Nd.exec(e.replace(Sd,""));)t[4]?i.shift():t[3]?(n=t[3].replace(kd," ").trim(),i.unshift(i[0][n]=i[0][n]||{})):i[0][t[1]]=t[2].replace(kd," ").trim();return i[0]})(e);Cd[a]=Td(r?{["@keyframes "+a]:t}:t,n?"":"."+a)}let o=n&&Cd.g?Cd.g:null;return n&&(Cd.g=Cd[a]),((e,t,n,i)=>{i?t.data=t.data.replace(i,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(Cd[a],t,i,o),a};function Md(e){let t=this||{},n=e.call?e(t.p):e;return Ad(n.unshift?n.raw?((e,t,n)=>e.reduce((e,i,r)=>{let s=t[r];if(s&&s.call){let e=s(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;s=t?"."+t:e&&"object"==typeof e?e.props?"":Td(e,""):!1===e?"":e}return e+i+(null==s?"":s)},""))(n,[].slice.call(arguments,1),t.p):n.reduce((e,n)=>Object.assign(e,n&&n.call?n(t.p):n),{}):n,jd(t.target),t.g,t.o,t.k)}Md.bind({g:1});let Dd,Id,Pd,Rd=Md.bind({k:1});function Ld(e,t){let n=this||{};return function(){let i=arguments;function r(s,a){let o=Object.assign({},s),l=o.className||r.className;n.p=Object.assign({theme:Id&&Id()},o),n.o=/ *go\d+/.test(l),o.className=Md.apply(n,i)+(l?" "+l:""),t&&(o.ref=a);let c=e;return e[0]&&(c=o.as||e,delete o.as),Pd&&c[0]&&Pd(o),Dd(c,o)}return t?t(r):r}}var zd,Od,Fd,Bd,Vd,Ud,Hd,qd,Wd,Gd,Yd,Zd,Xd,Kd,Qd,Jd,$d=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,eu=(()=>{let e=0;return()=>(++e).toString()})(),tu=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),nu=(e,t)=>{switch(t.type){case 0:return Le(Le({},e),{},{toasts:[t.toast,...e.toasts].slice(0,20)});case 1:return Le(Le({},e),{},{toasts:e.toasts.map(e=>e.id===t.toast.id?Le(Le({},e),t.toast):e)});case 2:let{toast:n}=t;return nu(e,{type:e.toasts.find(e=>e.id===n.id)?1:0,toast:n});case 3:let{toastId:i}=t;return Le(Le({},e),{},{toasts:e.toasts.map(e=>e.id===i||void 0===i?Le(Le({},e),{},{dismissed:!0,visible:!1}):e)});case 4:return void 0===t.toastId?Le(Le({},e),{},{toasts:[]}):Le(Le({},e),{},{toasts:e.toasts.filter(e=>e.id!==t.toastId)});case 5:return Le(Le({},e),{},{pausedAt:t.time});case 6:let r=t.time-(e.pausedAt||0);return Le(Le({},e),{},{pausedAt:void 0,toasts:e.toasts.map(e=>Le(Le({},e),{},{pauseDuration:e.pauseDuration+r}))})}},iu=[],ru={toasts:[],pausedAt:void 0},su=e=>{ru=nu(ru,e),iu.forEach(e=>{e(ru)})},au=e=>(t,n)=>{let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",n=arguments.length>2?arguments[2]:void 0;return Le(Le({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0},n),{},{id:(null==n?void 0:n.id)||eu()})}(t,e,n);return su({type:2,toast:i}),i.id},ou=(e,t)=>au("blank")(e,t);ou.error=au("error"),ou.success=au("success"),ou.loading=au("loading"),ou.custom=au("custom"),ou.dismiss=e=>{su({type:3,toastId:e})},ou.remove=e=>su({type:4,toastId:e}),ou.promise=(e,t,n)=>{let i=ou.loading(t.loading,Le(Le({},n),null==n?void 0:n.loading));return"function"==typeof e&&(e=e()),e.then(e=>{let r=t.success?$d(t.success,e):void 0;return r?ou.success(r,Le(Le({id:i},n),null==n?void 0:n.success)):ou.dismiss(i),e}).catch(e=>{let r=t.error?$d(t.error,e):void 0;r?ou.error(r,Le(Le({id:i},n),null==n?void 0:n.error)):ou.dismiss(i)}),e};new Map;var lu=Rd(zd||(zd=bd(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]))),cu=Rd(Od||(Od=bd(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),du=Rd(Fd||(Fd=bd(["\nfrom {\n  transform: scale(0) rotate(90deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n\topacity: 1;\n}"]))),uu=Ld("div")(Bd||(Bd=bd(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"])),e=>e.primary||"#ff4b4b",lu,cu,e=>e.secondary||"#fff",du),hu=Rd(Vd||(Vd=bd(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),pu=Ld("div")(Ud||(Ud=bd(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"])),e=>e.secondary||"#e0e0e0",e=>e.primary||"#616161",hu),mu=Rd(Hd||(Hd=bd(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n\topacity: 1;\n}"]))),fu=Rd(qd||(qd=bd(["\n0% {\n\theight: 0;\n\twidth: 0;\n\topacity: 0;\n}\n40% {\n  height: 0;\n\twidth: 6px;\n\topacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]))),gu=Ld("div")(Wd||(Wd=bd(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"])),e=>e.primary||"#61d345",mu,fu,e=>e.secondary||"#fff"),xu=Ld("div")(Gd||(Gd=bd(["\n  position: absolute;\n"]))),yu=Ld("div")(Yd||(Yd=bd(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]))),vu=Rd(Zd||(Zd=bd(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),_u=Ld("div")(Xd||(Xd=bd(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"])),vu),bu=e=>{let{toast:t}=e,{icon:n,type:r,iconTheme:s}=t;return void 0!==n?"string"==typeof n?i.createElement(_u,null,n):n:"blank"===r?null:i.createElement(yu,null,i.createElement(pu,Le({},s)),"loading"!==r&&i.createElement(xu,null,"error"===r?i.createElement(uu,Le({},s)):i.createElement(gu,Le({},s))))},wu=e=>"\n0% {transform: translate3d(0,".concat(-200*e,"%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n"),ju=e=>"\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,".concat(-150*e,"%,-1px) scale(.6); opacity:0;}\n"),Nu=Ld("div")(Kd||(Kd=bd(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]))),Su=Ld("div")(Qd||(Qd=bd(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"])));i.memo(e=>{let{toast:t,position:n,style:r,children:s}=e,a=t.height?((e,t)=>{let n=e.includes("top")?1:-1,[i,r]=tu()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[wu(n),ju(n)];return{animation:t?"".concat(Rd(i)," 0.35s cubic-bezier(.21,1.02,.73,1) forwards"):"".concat(Rd(r)," 0.4s forwards cubic-bezier(.06,.71,.55,1)")}})(t.position||n||"top-center",t.visible):{opacity:0},o=i.createElement(bu,{toast:t}),l=i.createElement(Su,Le({},t.ariaProps),$d(t.message,t));return i.createElement(Nu,{className:t.className,style:Le(Le(Le({},a),r),t.style)},"function"==typeof s?s({icon:o,message:l}):i.createElement(i.Fragment,null,o,l))});!function(e,t,n,i){Td.p=t,Dd=e,Id=n,Pd=i}(i.createElement);Md(Jd||(Jd=bd(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"])));var ku=ou;const Tu=e=>{let{onSearchResults:t,showResults:n=!1}=e;const[r,s]=(0,i.useState)("book"),[a,o]=(0,i.useState)("oneWay"),[l,c]=(0,i.useState)({from:"",to:"",journeyDate:"",returnDate:""}),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)([]),m=te();(0,i.useEffect)(()=>{f()},[]);const f=async()=>{try{const e=await fetch("/api/booking/cities");if(e.ok){const t=await e.json();p(t.data.cities||[])}}catch(e){console.error("Failed to load cities:",e)}};return(0,ze.jsxs)("div",{className:"searchCard",children:[(0,ze.jsxs)("div",{className:"tabs",children:[(0,ze.jsxs)("button",{onClick:()=>s("book"),className:"tab ".concat("book"===r?"tab--active":""),children:[(0,ze.jsx)(Sn,{className:"tab__icon"}),(0,ze.jsx)("span",{className:"hide-sm",children:"Book Bus Ticket"}),(0,ze.jsx)("span",{className:"show-sm",children:"Book"})]}),(0,ze.jsxs)("button",{onClick:()=>s("link"),className:"tab ".concat("link"===r?"tab--active":""),children:[(0,ze.jsx)(_d,{className:"tab__icon"}),(0,ze.jsx)("span",{className:"hide-sm",children:"Link Ticket"}),(0,ze.jsx)("span",{className:"show-sm",children:"Link"})]})]}),(0,ze.jsxs)("div",{className:"toggle",children:[(0,ze.jsx)("button",{onClick:()=>o("oneWay"),className:"toggle__btn ".concat("oneWay"===a?"is-active":""),children:"One Way"}),(0,ze.jsx)("button",{onClick:()=>o("roundTrip"),className:"toggle__btn ".concat("roundTrip"===a?"is-active":""),children:"Round Trip"})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l.from&&l.to&&l.journeyDate){u(!0);try{const e=new URLSearchParams({from:l.from,to:l.to,date:l.journeyDate,tripType:a});"roundTrip"===a&&l.returnDate&&e.append("returnDate",l.returnDate),m("/search-results?".concat(e.toString()))}catch(t){console.error("Search error:",t),ou.error("Search failed. Please try again.")}finally{u(!1)}}else ou.error("Please fill all required fields")},className:"form",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"label",children:"From"}),(0,ze.jsxs)("div",{className:"field",children:[(0,ze.jsx)(id,{className:"field__icon"}),(0,ze.jsx)("input",{type:"text",value:l.from,onChange:e=>c(Le(Le({},l),{},{from:e.target.value})),placeholder:"Enter departure location",className:"input",required:!0,list:"cities-from"}),(0,ze.jsx)("datalist",{id:"cities-from",children:h.map((e,t)=>(0,ze.jsx)("option",{value:e},t))})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"label",children:"To"}),(0,ze.jsxs)("div",{className:"field",children:[(0,ze.jsx)(id,{className:"field__icon"}),(0,ze.jsx)("input",{type:"text",value:l.to,onChange:e=>c(Le(Le({},l),{},{to:e.target.value})),placeholder:"Enter destination location",className:"input",required:!0,list:"cities-to"}),(0,ze.jsx)("datalist",{id:"cities-to",children:h.map((e,t)=>(0,ze.jsx)("option",{value:e},t))})]})]}),(0,ze.jsxs)("div",{className:"row-2",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"label",children:"Journey Date"}),(0,ze.jsxs)("div",{className:"field",children:[(0,ze.jsx)(Tn,{className:"field__icon"}),(0,ze.jsx)("input",{type:"date",value:l.journeyDate,onChange:e=>c(Le(Le({},l),{},{journeyDate:e.target.value})),min:(new Date).toISOString().split("T")[0],className:"input",required:!0})]})]}),"roundTrip"===a&&(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"label",children:"Return Date"}),(0,ze.jsxs)("div",{className:"field",children:[(0,ze.jsx)(Tn,{className:"field__icon"}),(0,ze.jsx)("input",{type:"date",value:l.returnDate,onChange:e=>c(Le(Le({},l),{},{returnDate:e.target.value})),min:l.journeyDate||(new Date).toISOString().split("T")[0],className:"input",required:!0})]})]})]}),(0,ze.jsx)("button",{type:"submit",className:"btnSearch",disabled:d,children:d?(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Searching..."]}):(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(Un,{className:"btnSearch__icon"}),"Search buses"]})})]})]})},Cu=n.p+"static/media/hero-bus.7cb677ed76bcc5c368c8.png",Eu=()=>{const[e,t]=(0,i.useState)(!1),n=te(),{user:r}=Fe();return(0,ze.jsxs)("div",{className:"landing-root",children:[(0,ze.jsx)(ud,{}),(0,ze.jsx)(ad,{isMobileMenuOpen:e,setIsMobileMenuOpen:t}),(0,ze.jsxs)("section",{className:"hero",children:[(0,ze.jsx)("img",{src:Cu,alt:"",className:"hero__bus","aria-hidden":"true"}),(0,ze.jsx)("div",{className:"hero__overlay"}),(0,ze.jsx)("div",{className:"container hero__container",children:(0,ze.jsxs)("div",{className:"hero__grid",children:[(0,ze.jsxs)($c.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},transition:{duration:.6},className:"hero__left",children:[(0,ze.jsxs)("h1",{className:"hero__title",children:["Travel Smart,",(0,ze.jsx)("span",{children:"Travel Safe"})]}),(0,ze.jsx)("p",{className:"hero__subtitle",children:"Book your bus tickets with YATRIK ERP. Experience comfortable, reliable, and affordable bus travel across India."}),(0,ze.jsxs)("div",{className:"hero__ctas",children:[(0,ze.jsxs)($c.button,{whileHover:{scale:1.03},whileTap:{scale:.98},onClick:()=>{if(console.log("handleBookNow called:",{user:r,hasUser:!!r}),!r)return console.log("No user, redirecting to login"),void n("/login?next=/pax");const e=(r.role||"passenger").toUpperCase();console.log("User role:",e),"PASSENGER"===e?(console.log("Redirecting to /pax"),n("/pax")):"ADMIN"===e?(console.log("Redirecting to /admin"),n("/admin")):"CONDUCTOR"===e?(console.log("Redirecting to /conductor"),n("/conductor")):"DRIVER"===e?(console.log("Redirecting to /driver"),n("/driver")):"DEPOT_MANAGER"===e?(console.log("Redirecting to /depot"),n("/depot")):(console.log("Redirecting to /dashboard"),n("/dashboard"))},className:"btn btn--accent",children:["Book Now ",(0,ze.jsx)(ed,{size:16})]}),(0,ze.jsxs)($c.button,{whileHover:{scale:1.03},whileTap:{scale:.98},className:"btn btn--secondary",children:[(0,ze.jsx)(Sn,{size:16})," Track Bus"]})]})]}),(0,ze.jsx)($c.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},transition:{duration:.6,delay:.1},className:"hero__right",children:(0,ze.jsx)(Tu,{})})]})})]}),(0,ze.jsx)("section",{className:"section",children:(0,ze.jsx)("div",{className:"container",children:(0,ze.jsxs)("div",{className:"grid-3",children:[(0,ze.jsx)("div",{className:"lg:col-span-2",children:(0,ze.jsx)(md,{routes:[{from:"Kochi",to:"Thiruvananthapuram",frequency:"Every 2 hours",fare:"\u20b9350"},{from:"Kozhikode",to:"Kochi",frequency:"Every 3 hours",fare:"\u20b9280"},{from:"Bangalore",to:"Mysore",frequency:"Every 45 mins",fare:"\u20b9180"},{from:"Chennai",to:"Pondicherry",frequency:"Every 2 hours",fare:"\u20b9120"},{from:"Hyderabad",to:"Warangal",frequency:"Every 1 hour",fare:"\u20b9100"}]})}),(0,ze.jsx)("div",{children:(0,ze.jsx)(vd,{alerts:[{type:"info",message:"New Kerala routes added: Kochi to Thiruvananthapuram, Kozhikode to Kochi"},{type:"warning",message:"Monsoon season - expect delays on coastal routes"},{type:"success",message:"All buses now equipped with free WiFi and charging ports"}]})})]})})}),(0,ze.jsx)(pd,{}),(0,ze.jsx)("section",{className:"section section--muted",children:(0,ze.jsxs)("div",{className:"container",children:[(0,ze.jsxs)($c.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.6},viewport:{once:!0},className:"section__intro",children:[(0,ze.jsx)("h2",{className:"section__title",children:"Why Choose YATRIK ERP?"}),(0,ze.jsx)("p",{className:"section__subtitle",children:"We're committed to providing the best bus travel experience with modern technology and excellent service."})]}),(0,ze.jsx)("div",{className:"features",children:[{icon:(0,ze.jsx)(Sn,{className:"feature__icon"}),title:"Wide Network",description:"Connect to 500+ cities across India with our extensive bus network."},{icon:(0,ze.jsx)(td,{className:"feature__icon"}),title:"Real-time Updates",description:"Get live tracking, delays, and status updates for your journey."},{icon:(0,ze.jsx)(nd,{className:"feature__icon"}),title:"Premium Service",description:"Enjoy comfortable seating, WiFi, and entertainment on premium routes."},{icon:(0,ze.jsx)(id,{className:"feature__icon"}),title:"Smart Routes",description:"AI-powered route optimization for faster and efficient travel."}].map((e,t)=>(0,ze.jsxs)($c.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.6,delay:.1*t},viewport:{once:!0},className:"feature",children:[(0,ze.jsx)("div",{className:"feature__iconWrap",children:e.icon}),(0,ze.jsx)("h3",{className:"feature__title",children:e.title}),(0,ze.jsx)("p",{className:"feature__desc",children:e.description})]},t))})]})}),(0,ze.jsx)("footer",{className:"footer",children:(0,ze.jsxs)("div",{className:"container",children:[(0,ze.jsxs)("div",{className:"footer__grid",children:[(0,ze.jsxs)("div",{className:"footer__brand",children:[(0,ze.jsx)("h3",{children:"YATRIK ERP"}),(0,ze.jsx)("p",{children:"Your trusted partner for safe, comfortable, and affordable bus travel across India. Experience the future of transportation with our smart booking system."}),(0,ze.jsx)("div",{className:"footer__socials",children:[{icon:"Facebook",href:"#"},{icon:"Twitter",href:"#"},{icon:"Instagram",href:"#"},{icon:"YouTube",href:"#"}].map((e,t)=>(0,ze.jsx)("a",{href:e.href,className:"social","aria-label":e.icon,children:(0,ze.jsx)("span",{children:e.icon[0]})},t))})]}),(0,ze.jsxs)("div",{className:"footer__col",children:[(0,ze.jsx)("h4",{children:"Quick Links"}),(0,ze.jsx)("ul",{children:["About Us","Contact","Terms & Conditions","Privacy Policy","FAQ"].map((e,t)=>(0,ze.jsx)("li",{children:(0,ze.jsx)("a",{href:"#",children:e})},t))})]}),(0,ze.jsxs)("div",{className:"footer__col",children:[(0,ze.jsx)("h4",{children:"Support"}),(0,ze.jsxs)("ul",{children:[(0,ze.jsxs)("li",{className:"footer__support",children:[(0,ze.jsx)(rd,{size:12}),(0,ze.jsx)("span",{children:"1800-123-4567"})]}),(0,ze.jsx)("li",{children:"support@yatrikerp.com"}),(0,ze.jsx)("li",{children:"24/7 Customer Support"})]})]})]}),(0,ze.jsx)("div",{className:"footer__bottom",children:"\xa9 2024 YATRIK ERP. All rights reserved."})]})})]})},Au=wn("Snowflake",[["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"m20 16-4-4 4-4",key:"rquw4f"}],["path",{d:"m4 8 4 4-4 4",key:"12s3z9"}],["path",{d:"m16 4-4 4-4-4",key:"1tumq1"}],["path",{d:"m8 20 4-4 4 4",key:"9p200w"}]]),Mu=wn("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Du=wn("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Iu=wn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Pu=wn("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),Ru=wn("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),Lu=wn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),zu=wn("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),Ou=wn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Fu=()=>{const[e]=Ie(),t=te(),{user:n}=Fe(),[r,s]=(0,i.useState)([]),[a,o]=(0,i.useState)(!0),[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)("departure"),[h,p]=(0,i.useState)("grid"),[m,f]=(0,i.useState)({busType:[],departureTime:[],amenities:[],rating:0,priceRange:[0,1e3]}),g=e.get("from"),x=e.get("to"),y=e.get("date"),v=e.get("tripType")||"oneWay",_=(0,i.useMemo)(()=>[{id:"KL001_001",routeName:"Kochi - Thiruvananthapuram Express",routeNumber:"KL001",from:"Kochi",to:"Thiruvananthapuram",departure:"08:00",arrival:"12:00",duration:"4h 00m",fare:350,busType:"AC Sleeper",operator:"Kerala State Road Transport Corporation (KSRTC)",rating:4.5,reviews:234,availableSeats:12,totalSeats:45,amenities:["WiFi","USB Charging","AC","Water Bottle"],features:["Live Tracking","Premium Service","New Bus"],busNumber:"KL-BUS-001",status:"available",popular:!0},{id:"KL001_002",routeName:"Kochi - Thiruvananthapuram Express",routeNumber:"KL001",from:"Kochi",to:"Thiruvananthapuram",departure:"14:00",arrival:"18:00",duration:"4h 00m",fare:350,busType:"AC Seater",operator:"Kerala Express",rating:4.3,reviews:189,availableSeats:8,totalSeats:40,amenities:["WiFi","AC","Entertainment"],features:["Live Tracking","High Rated"],busNumber:"KL-BUS-002",status:"available",popular:!1},{id:"KL001_003",routeName:"Kochi - Thiruvananthapuram Express",routeNumber:"KL001",from:"Kochi",to:"Thiruvananthapuram",departure:"20:00",arrival:"00:00",duration:"4h 00m",fare:380,busType:"AC Sleeper",operator:"Kerala Fast Track",rating:4.7,reviews:156,availableSeats:15,totalSeats:45,amenities:["WiFi","USB Charging","AC","Blanket","Pillow"],features:["Live Tracking","Premium Service","Single Seats"],busNumber:"KL-BUS-003",status:"available",popular:!0}],[]);(0,i.useEffect)(()=>{b()},[g,x,y,v]);const b=async()=>{try{o(!0),c(""),await new Promise(e=>setTimeout(e,1e3));((null===g||void 0===g?void 0:g.toLowerCase().includes("kochi"))||(null===g||void 0===g?void 0:g.toLowerCase().includes("thiruvananthapuram")))&&((null===x||void 0===x?void 0:x.toLowerCase().includes("kochi"))||(null===x||void 0===x?void 0:x.toLowerCase().includes("thiruvananthapuram")))?(s(_),c("")):(s([]),c("No routes found for the specified cities. Please try different cities or dates."))}catch(l){console.error("Search error:",l),c("Failed to search trips. Please try again."),s([])}finally{o(!1)}},w=(0,i.useMemo)(()=>{let e=[...r];switch(m.busType.length>0&&(e=e.filter(e=>m.busType.some(t=>e.busType.toLowerCase().includes(t.toLowerCase())))),m.departureTime.length>0&&(e=e.filter(e=>{const t=parseInt(e.departure.split(":")[0]);return m.departureTime.some(e=>"06:00 - 12:00"===e?t>=6&&t<12:"18:00 - 24:00"!==e||t>=18&&t<24)})),m.amenities.length>0&&(e=e.filter(e=>m.amenities.some(t=>e.amenities.some(e=>e.toLowerCase().includes(t.toLowerCase()))))),d){case"departure":e.sort((e,t)=>e.departure.localeCompare(t.departure));break;case"price":e.sort((e,t)=>e.fare-t.fare);break;case"rating":e.sort((e,t)=>t.rating-e.rating);break;case"duration":e.sort((e,t)=>parseInt(e.duration.split("h")[0])-parseInt(t.duration.split("h")[0]))}return e},[r,m,d]),j=e=>{switch(e.toLowerCase()){case"wifi":return(0,ze.jsx)(Mu,{className:"w-3 h-3"});case"ac":return(0,ze.jsx)(Au,{className:"w-3 h-3"});case"usb charging":return(0,ze.jsx)(Du,{className:"w-3 h-3"});default:return(0,ze.jsx)(xd,{className:"w-3 h-3"})}};return a?(0,ze.jsx)("div",{className:"trip-results-container",children:(0,ze.jsxs)("div",{className:"loading-container",children:[(0,ze.jsx)(gn,{}),(0,ze.jsx)("p",{children:"Searching for the best routes..."})]})}):(0,ze.jsxs)("div",{className:"trip-results-container",children:[(0,ze.jsxs)("div",{className:"results-header",children:[(0,ze.jsxs)("div",{className:"header-left",children:[(0,ze.jsxs)("button",{onClick:()=>t(-1),className:"back-button",children:[(0,ze.jsx)(Iu,{className:"w-4 h-4"}),"Back"]}),(0,ze.jsxs)("div",{className:"search-info",children:[(0,ze.jsx)("h1",{children:"Search Results"}),(0,ze.jsxs)("div",{className:"route-info",children:[(0,ze.jsx)(id,{className:"w-4 h-4"}),(0,ze.jsxs)("span",{children:[g," \u2192 ",x]}),(0,ze.jsx)(Tn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:new Date(y).toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]}),(0,ze.jsx)("div",{className:"header-right",children:(0,ze.jsxs)("div",{className:"view-toggle",children:[(0,ze.jsx)("button",{className:"grid"===h?"active":"",onClick:()=>p("grid"),children:(0,ze.jsx)(Pu,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{className:"list"===h?"active":"",onClick:()=>p("list"),children:(0,ze.jsx)(Ru,{className:"w-4 h-4"})})]})})]}),l&&(0,ze.jsxs)("div",{className:"error-container",children:[(0,ze.jsx)(yd,{className:"w-8 h-8 text-red-500"}),(0,ze.jsxs)("div",{className:"error-content",children:[(0,ze.jsx)("h3",{children:"No buses found"}),(0,ze.jsx)("p",{children:l}),(0,ze.jsxs)("button",{onClick:()=>{b()},className:"retry-button",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),"Try Again"]})]})]}),!l&&w.length>0&&(0,ze.jsxs)("div",{className:"results-content",children:[(0,ze.jsxs)("div",{className:"filters-section",children:[(0,ze.jsx)("div",{className:"filters-left",children:(0,ze.jsxs)("div",{className:"filter-group",children:[(0,ze.jsx)("label",{children:"Bus Type:"}),(0,ze.jsx)("div",{className:"filter-options",children:["AC","Sleeper","Seater"].map(e=>(0,ze.jsxs)("label",{className:"filter-option",children:[(0,ze.jsx)("input",{type:"checkbox",checked:m.busType.includes(e),onChange:t=>{t.target.checked?f(t=>Le(Le({},t),{},{busType:[...t.busType,e]})):f(t=>Le(Le({},t),{},{busType:t.busType.filter(t=>t!==e)}))}}),e]},e))})]})}),(0,ze.jsx)("div",{className:"filters-right",children:(0,ze.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"sort-select",children:[(0,ze.jsx)("option",{value:"departure",children:"Sort by Departure"}),(0,ze.jsx)("option",{value:"price",children:"Sort by Price"}),(0,ze.jsx)("option",{value:"rating",children:"Sort by Rating"}),(0,ze.jsx)("option",{value:"duration",children:"Sort by Duration"})]})})]}),(0,ze.jsxs)("div",{className:"results-count",children:[(0,ze.jsxs)("p",{children:[w.length," buses found"]}),(0,ze.jsx)("span",{className:"search-stats",children:"50,000+ searches on this route last month"})]}),(0,ze.jsx)("div",{className:"trips-grid ".concat(h),children:w.map(i=>{return(0,ze.jsxs)("div",{className:"trip-card",children:[(0,ze.jsxs)("div",{className:"trip-header",children:[(0,ze.jsxs)("div",{className:"trip-route",children:[(0,ze.jsx)("h3",{children:i.routeName}),(0,ze.jsx)("span",{className:"route-number",children:i.routeNumber})]}),(0,ze.jsxs)("div",{className:"trip-rating",children:[(0,ze.jsx)(nd,{className:"w-4 h-4 fill-current"}),(0,ze.jsx)("span",{children:i.rating}),(0,ze.jsxs)("span",{className:"reviews",children:["(",i.reviews,")"]})]})]}),(0,ze.jsxs)("div",{className:"trip-details",children:[(0,ze.jsxs)("div",{className:"time-details",children:[(0,ze.jsxs)("div",{className:"departure",children:[(0,ze.jsx)("span",{className:"time",children:i.departure}),(0,ze.jsx)("span",{className:"city",children:i.from})]}),(0,ze.jsxs)("div",{className:"duration",children:[(0,ze.jsx)(kn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:i.duration})]}),(0,ze.jsxs)("div",{className:"arrival",children:[(0,ze.jsx)("span",{className:"time",children:i.arrival}),(0,ze.jsx)("span",{className:"city",children:i.to})]})]}),(0,ze.jsxs)("div",{className:"bus-info",children:[(0,ze.jsxs)("div",{className:"bus-type",children:[(r=i.busType,r.includes("Sleeper")?(0,ze.jsx)(Nn,{className:"w-4 h-4"}):r.includes("AC")?(0,ze.jsx)(Au,{className:"w-4 h-4"}):(0,ze.jsx)(Sn,{className:"w-4 h-4"})),(0,ze.jsx)("span",{children:i.busType})]}),(0,ze.jsx)("div",{className:"operator",children:i.operator})]}),(0,ze.jsx)("div",{className:"amenities",children:i.amenities.slice(0,3).map((e,t)=>(0,ze.jsxs)("span",{className:"amenity",children:[j(e),e]},t))}),(0,ze.jsx)("div",{className:"features",children:i.features.map((e,t)=>(0,ze.jsx)("span",{className:"feature-badge",children:e},t))})]}),(0,ze.jsxs)("div",{className:"trip-footer",children:[(0,ze.jsxs)("div",{className:"price-section",children:[(0,ze.jsxs)("span",{className:"price",children:["\u20b9",i.fare]}),(0,ze.jsxs)("span",{className:"seats",children:[i.availableSeats," seats left"]})]}),(0,ze.jsxs)("button",{onClick:()=>(i=>{t(n?"/booking?tripId=".concat(i.id,"&from=").concat(i.from,"&to=").concat(i.to,"&date=").concat(y):"/login?next=/search-results?".concat(e.toString()))})(i),className:"book-button",children:[(0,ze.jsx)(zu,{className:"w-4 h-4"}),"Book Now"]})]}),i.popular&&(0,ze.jsxs)("div",{className:"popular-badge",children:[(0,ze.jsx)(Ou,{className:"w-3 h-3"}),"Popular"]})]},i.id);var r})})]})]})},Bu=wn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Vu=()=>{const[e,t]=(0,i.useState)({from:"",to:"",date:"",passengers:1,tripType:"oneWay"}),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)({from:[],to:[]}),[c,d]=(0,i.useState)({from:!1,to:!1}),[u,h]=(0,i.useState)({priceRange:[0,2e3],busType:"all",departureTime:"all",amenities:[]}),p=(0,i.useRef)(null),m=(0,i.useRef)(null);(0,i.useEffect)(()=>{const e=new Date;e.setDate(e.getDate()+1),t(t=>Le(Le({},t),{},{date:e.toISOString().split("T")[0]}))},[]);const f=(e,n)=>{t(t=>Le(Le({},t),{},{[e]:n})),("from"===e||"to"===e)&&n.length>=1?(g(e,n),d(t=>Le(Le({},t),{},{[e]:!0}))):"from"!==e&&"to"!==e||0!==n.length||d(t=>Le(Le({},t),{},{[e]:!1}))},g=async(e,t)=>{try{const n=await fetch("/api/booking/autocomplete?query=".concat(t,"&type=").concat(e)),i=await n.json();i.ok&&l(t=>Le(Le({},t),{},{[e]:i.data.suggestions.slice(0,5)}))}catch(n){console.error("Error fetching suggestions:",n)}},x=(e,n)=>{var i;(t(t=>Le(Le({},t),{},{[e]:n.city})),d(t=>Le(Le({},t),{},{[e]:!1})),"from"===e)&&(null===(i=m.current)||void 0===i||i.focus())},y=n.filter(e=>!(e.fare.current<u.priceRange[0]||e.fare.current>u.priceRange[1])&&(("all"===u.busType||e.bus.type===u.busType)&&!(u.amenities.length>0&&!u.amenities.every(t=>e.bus.amenities.includes(t)))));const v=(e,n)=>{t(t=>Le(Le({},t),{},{[e]:n})),d(t=>Le(Le({},t),{},{[e]:!1}))};return(0,ze.jsxs)("div",{className:"trip-search-container",children:[(0,ze.jsxs)("div",{className:"search-form",children:[(0,ze.jsxs)("div",{className:"search-header",children:[(0,ze.jsx)("h2",{children:"Search Bus Tickets"}),(0,ze.jsx)("p",{children:"Find and book your perfect journey"})]}),(0,ze.jsxs)("div",{className:"search-inputs",children:[(0,ze.jsxs)("div",{className:"input-group",children:[(0,ze.jsx)("label",{htmlFor:"from",children:"From"}),(0,ze.jsxs)("div",{className:"input-with-suggestions",children:[(0,ze.jsxs)("div",{className:"input-wrapper",children:[(0,ze.jsx)(id,{className:"input-icon"}),(0,ze.jsx)("input",{ref:p,type:"text",id:"from",placeholder:"Enter departure city",value:e.from,onChange:e=>f("from",e.target.value),onFocus:()=>d(e=>Le(Le({},e),{},{from:!0}))})]}),c.from&&(0,ze.jsx)("div",{className:"suggestions-dropdown",children:o.from.length>0?o.from.map((e,t)=>(0,ze.jsxs)("div",{className:"suggestion-item",onClick:()=>x("from",e),children:[(0,ze.jsx)(id,{className:"suggestion-icon"}),(0,ze.jsxs)("div",{className:"suggestion-content",children:[(0,ze.jsx)("div",{className:"suggestion-city",children:e.city}),(0,ze.jsx)("div",{className:"suggestion-location",children:e.location}),(0,ze.jsxs)("div",{className:"suggestion-routes",children:[e.totalRoutes," routes available"]})]})]},t)):(0,ze.jsx)("div",{className:"suggestion-item no-results",children:(0,ze.jsx)("div",{children:"No suggestions found"})})})]})]}),(0,ze.jsxs)("div",{className:"input-group",children:[(0,ze.jsx)("label",{htmlFor:"to",children:"To"}),(0,ze.jsxs)("div",{className:"input-with-suggestions",children:[(0,ze.jsxs)("div",{className:"input-wrapper",children:[(0,ze.jsx)(id,{className:"input-icon"}),(0,ze.jsx)("input",{ref:m,type:"text",id:"to",placeholder:"Enter destination city",value:e.to,onChange:e=>f("to",e.target.value),onFocus:()=>d(e=>Le(Le({},e),{},{to:!0}))})]}),c.to&&(0,ze.jsx)("div",{className:"suggestions-dropdown",children:o.to.length>0?o.to.map((e,t)=>(0,ze.jsxs)("div",{className:"suggestion-item",onClick:()=>x("to",e),children:[(0,ze.jsx)(id,{className:"suggestion-icon"}),(0,ze.jsxs)("div",{className:"suggestion-content",children:[(0,ze.jsx)("div",{className:"suggestion-city",children:e.city}),(0,ze.jsx)("div",{className:"suggestion-location",children:e.location}),(0,ze.jsxs)("div",{className:"suggestion-routes",children:[e.totalRoutes," routes available"]})]})]},t)):(0,ze.jsx)("div",{className:"suggestion-item no-results",children:(0,ze.jsx)("div",{children:"No suggestions found"})})})]})]}),(0,ze.jsxs)("div",{className:"input-group",children:[(0,ze.jsx)("label",{htmlFor:"date",children:"Date of Journey"}),(0,ze.jsxs)("div",{className:"input-wrapper",children:[(0,ze.jsx)(Tn,{className:"input-icon"}),(0,ze.jsx)("input",{type:"date",id:"date",value:e.date,onChange:e=>f("date",e.target.value),min:(new Date).toISOString().split("T")[0]})]})]}),(0,ze.jsxs)("div",{className:"input-group",children:[(0,ze.jsx)("label",{htmlFor:"passengers",children:"Passengers"}),(0,ze.jsxs)("div",{className:"input-wrapper",children:[(0,ze.jsx)(Nn,{className:"input-icon"}),(0,ze.jsx)("select",{id:"passengers",value:e.passengers,onChange:e=>f("passengers",parseInt(e.target.value)),children:[1,2,3,4,5,6].map(e=>(0,ze.jsxs)("option",{value:e,children:[e," ",1===e?"Passenger":"Passengers"]},e))})]})]})]}),(0,ze.jsxs)("div",{className:"quick-cities",children:[(0,ze.jsx)("label",{children:"Quick Select:"}),(0,ze.jsx)("div",{className:"city-buttons",children:["Kochi","Thiruvananthapuram","Kozhikode","Alappuzha","Kollam","Thrissur","Kottayam","Palakkad"].map(t=>(0,ze.jsx)("button",{type:"button",className:"city-btn",onClick:()=>{e.from?e.to||v("to",t):v("from",t)},children:t},t))})]}),(0,ze.jsx)("button",{className:"search-btn",onClick:async()=>{if(e.from&&e.to&&e.date){a(!0);try{const t=await fetch("/api/booking/search?".concat(new URLSearchParams({from:e.from,to:e.to,date:e.date,tripType:e.tripType}))),n=await t.json();n.ok?r(n.data.trips||[]):(r([]),alert(n.message||"No trips found"))}catch(t){console.error("Search error:",t),alert("Failed to search trips")}finally{a(!1)}}else alert("Please fill in all required fields")},disabled:s||!e.from||!e.to||!e.date,children:s?(0,ze.jsx)("div",{className:"loading-spinner"}):(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(Un,{className:"search-icon"}),"Search Buses"]})})]}),n.length>0&&(0,ze.jsxs)("div",{className:"search-filters",children:[(0,ze.jsxs)("div",{className:"filters-header",children:[(0,ze.jsx)(Bu,{className:"filter-icon"}),(0,ze.jsx)("h3",{children:"Filters"})]}),(0,ze.jsxs)("div",{className:"filters-content",children:[(0,ze.jsxs)("div",{className:"filter-group",children:[(0,ze.jsx)("label",{children:"Price Range (\u20b9)"}),(0,ze.jsxs)("div",{className:"price-range",children:[(0,ze.jsx)("input",{type:"number",placeholder:"Min",value:u.priceRange[0],onChange:e=>h(t=>Le(Le({},t),{},{priceRange:[parseInt(e.target.value)||0,t.priceRange[1]]}))}),(0,ze.jsx)("span",{children:"to"}),(0,ze.jsx)("input",{type:"number",placeholder:"Max",value:u.priceRange[1],onChange:e=>h(t=>Le(Le({},t),{},{priceRange:[t.priceRange[0],parseInt(e.target.value)||2e3]}))})]})]}),(0,ze.jsxs)("div",{className:"filter-group",children:[(0,ze.jsx)("label",{children:"Bus Type"}),(0,ze.jsx)("select",{value:u.busType,onChange:e=>h(t=>Le(Le({},t),{},{busType:e.target.value})),children:[{value:"all",label:"All Types"},{value:"ac_sleeper",label:"AC Sleeper"},{value:"ac_seater",label:"AC Seater"},{value:"non_ac_sleeper",label:"Non-AC Sleeper"},{value:"non_ac_seater",label:"Non-AC Seater"}].map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{className:"filter-group",children:[(0,ze.jsx)("label",{children:"Amenities"}),(0,ze.jsx)("div",{className:"amenities-checkboxes",children:["wifi","charging","ac","refreshments","toilet","entertainment"].map(e=>(0,ze.jsxs)("label",{className:"amenity-checkbox",children:[(0,ze.jsx)("input",{type:"checkbox",checked:u.amenities.includes(e),onChange:t=>{t.target.checked?h(t=>Le(Le({},t),{},{amenities:[...t.amenities,e]})):h(t=>Le(Le({},t),{},{amenities:t.amenities.filter(t=>t!==e)}))}}),(0,ze.jsx)("span",{className:"amenity-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]})]})]}),n.length>0&&(0,ze.jsxs)("div",{className:"search-results",children:[(0,ze.jsxs)("div",{className:"results-header",children:[(0,ze.jsxs)("h3",{children:["Found ",y.length," trips"]}),(0,ze.jsxs)("div",{className:"results-summary",children:[(0,ze.jsxs)("span",{children:["From: ",e.from]}),(0,ze.jsxs)("span",{children:["To: ",e.to]}),(0,ze.jsxs)("span",{children:["Date: ",new Date(e.date).toLocaleDateString()]})]})]}),(0,ze.jsx)("div",{className:"trips-list",children:y.map((e,t)=>(0,ze.jsxs)("div",{className:"trip-card",children:[(0,ze.jsxs)("div",{className:"trip-header",children:[(0,ze.jsxs)("div",{className:"trip-route",children:[(0,ze.jsx)("h4",{children:e.route.name}),(0,ze.jsx)("span",{className:"trip-number",children:e.tripNumber})]}),(0,ze.jsxs)("div",{className:"trip-price",children:[(0,ze.jsxs)("span",{className:"price-amount",children:["\u20b9",e.fare.current]}),e.fare.discount>0&&(0,ze.jsxs)("span",{className:"price-discount",children:["Save \u20b9",e.fare.discount]})]})]}),(0,ze.jsxs)("div",{className:"trip-details",children:[(0,ze.jsxs)("div",{className:"trip-timing",children:[(0,ze.jsxs)("div",{className:"departure",children:[(0,ze.jsx)(td,{className:"timing-icon"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"time",children:e.departure}),(0,ze.jsx)("span",{className:"city",children:e.from})]})]}),(0,ze.jsxs)("div",{className:"journey-info",children:[(0,ze.jsx)("div",{className:"duration",children:e.duration}),(0,ze.jsxs)("div",{className:"distance",children:[e.distance," km"]})]}),(0,ze.jsxs)("div",{className:"arrival",children:[(0,ze.jsx)(td,{className:"timing-icon"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"time",children:e.arrival}),(0,ze.jsx)("span",{className:"city",children:e.to})]})]})]}),(0,ze.jsxs)("div",{className:"trip-bus-info",children:[(0,ze.jsxs)("div",{className:"bus-details",children:[(0,ze.jsx)(Sn,{className:"bus-icon"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"bus-number",children:e.bus.number}),(0,ze.jsx)("span",{className:"bus-type",children:e.bus.type})]})]}),(0,ze.jsxs)("div",{className:"seat-availability",children:[(0,ze.jsxs)("span",{className:"available-seats",children:[e.seatAvailability.available," seats available"]}),(0,ze.jsxs)("span",{className:"total-seats",children:["out of ",e.seatAvailability.total]})]})]}),(0,ze.jsx)("div",{className:"trip-amenities",children:e.bus.amenities.map((e,t)=>(0,ze.jsx)("span",{className:"amenity-tag",children:e},t))})]}),(0,ze.jsxs)("div",{className:"trip-actions",children:[(0,ze.jsx)("button",{className:"view-seats-btn",children:"View Seats"}),(0,ze.jsx)("button",{className:"book-now-btn",children:"Book Now"})]})]},t))}),0===y.length&&(0,ze.jsx)("div",{className:"no-results",children:(0,ze.jsx)("p",{children:"No trips match your current filters. Try adjusting your search criteria."})})]}),0===n.length&&!s&&(0,ze.jsxs)("div",{className:"no-search-results",children:[(0,ze.jsx)("div",{className:"no-results-icon",children:"\ud83d\ude8c"}),(0,ze.jsx)("h3",{children:"Ready to Search?"}),(0,ze.jsx)("p",{children:"Enter your journey details above to find available bus trips"})]})]})},Uu=n.p+"static/media/login.d12f956a2bd94717dd0a.png",Hu=()=>(0,ze.jsx)("div",{className:"left-panel",children:(0,ze.jsx)("div",{className:"content-area",children:(0,ze.jsxs)("div",{className:"text-center relative",children:[(0,ze.jsx)("img",{src:Uu,alt:"Yatrik ERP Smart Transport Network",className:"w-96 h-96 rounded-full shadow-xl object-cover",onError:e=>{console.error("Image failed to load:",e.target.src),e.target.style.display="none"},onLoad:()=>console.log("Image loaded successfully")}),(0,ze.jsx)("div",{className:"route-overlay",children:(0,ze.jsxs)("svg",{viewBox:"0 0 600 600",className:"route-svg",preserveAspectRatio:"xMidYMid meet",children:[(0,ze.jsx)("defs",{children:(0,ze.jsxs)("linearGradient",{id:"routeGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,ze.jsx)("stop",{offset:"0%",stopColor:"#FFC0CB",stopOpacity:"0.8"}),(0,ze.jsx)("stop",{offset:"50%",stopColor:"#FFB6C1",stopOpacity:"0.7"}),(0,ze.jsx)("stop",{offset:"100%",stopColor:"#FFC0CB",stopOpacity:"0.8"})]})}),(0,ze.jsx)("circle",{cx:"300",cy:"300",r:"280",fill:"none",stroke:"url(#routeGradient)",strokeWidth:"6",strokeDasharray:"25,20",className:"main-route"}),(0,ze.jsxs)("g",{className:"location-pins-inside",children:[(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(300, 108)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]}),(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(492, 300)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]}),(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(300, 492)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]}),(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(108, 300)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]}),(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(420, 180)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]}),(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(180, 420)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]}),(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(180, 180)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]}),(0,ze.jsxs)("g",{className:"location-pin-inside",transform:"translate(420, 420)",children:[(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"10",fill:"#00BCD4"}),(0,ze.jsx)("circle",{cx:"0",cy:"0",r:"5",fill:"#FFFFFF"}),(0,ze.jsx)("path",{d:"M 0 -10 L -7 0 L 7 0 Z",fill:"#00BCD4"})]})]}),(0,ze.jsxs)("g",{className:"direction-arrows",children:[(0,ze.jsx)("path",{d:"M 580 300 L 565 285 L 565 315 Z",fill:"#E91E63",className:"direction-arrow"}),(0,ze.jsx)("path",{d:"M 300 20 L 285 35 L 315 35 Z",fill:"#E91E63",className:"direction-arrow"}),(0,ze.jsx)("path",{d:"M 20 300 L 35 285 L 35 315 Z",fill:"#E91E63",className:"direction-arrow"}),(0,ze.jsx)("path",{d:"M 300 580 L 285 565 L 315 565 Z",fill:"#E91E63",className:"direction-arrow"})]})]})})]})})}),qu=e=>{let{title:t,subtitle:n,children:i}=e;return(0,ze.jsxs)("div",{className:"auth-page",children:[(0,ze.jsx)("div",{className:"auth-col auth-left",children:(0,ze.jsx)(Hu,{})}),(0,ze.jsx)("div",{className:"auth-divider","aria-hidden":"true"}),(0,ze.jsx)("div",{className:"auth-col auth-right",children:(0,ze.jsxs)("div",{className:"auth-form-wrap",children:[(0,ze.jsx)("div",{className:"auth-header-bar",children:(0,ze.jsxs)("div",{className:"auth-header-content",children:[(0,ze.jsx)("div",{className:"auth-header-left",children:(0,ze.jsxs)("div",{className:"auth-logo-container",onClick:()=>window.location.href="/",style:{cursor:"pointer"},children:[(0,ze.jsx)("div",{className:"auth-logo-icon",children:"\ud83d\ude8c"}),(0,ze.jsx)("span",{className:"auth-logo-text",children:"YATRIK"}),(0,ze.jsx)("div",{className:"auth-erp-badge",children:"ERP"})]})}),(0,ze.jsx)("div",{className:"auth-header-right",children:(0,ze.jsx)("a",{href:"#",className:"auth-help-link",children:"Help"})})]})}),(0,ze.jsx)("div",{className:"auth-header",children:(0,ze.jsxs)("div",{className:"auth-title",children:[(0,ze.jsx)("h1",{children:t}),n&&(0,ze.jsx)("p",{children:n})]})}),(0,ze.jsx)("div",{className:"auth-card",children:i})]})}),(0,ze.jsx)("style",{children:"\n        /* Full-page layout */\n        .auth-page {\n          min-height: 100vh;\n          display: flex;\n          flex-direction: row;\n          background: linear-gradient(160deg, #eef6ff 0%, #ffffff 100%);\n          overflow: hidden;\n        }\n\n        .auth-col {\n          flex: 1 1 0;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .auth-left { padding: 2rem 1rem; }\n\n        .auth-right { padding: 2rem 1rem; }\n\n        .auth-divider {\n          width: 1px;\n          background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.06) 15%, rgba(0,0,0,0.08) 50%, rgba(0,0,0,0.06) 85%, rgba(0,0,0,0) 100%);\n          box-shadow: 0 0 24px rgba(0,0,0,0.05);\n        }\n\n        .auth-form-wrap {\n          width: 100%;\n          max-width: 420px;\n          margin-top: 80px;\n        }\n\n        /* Header Bar - Full Page Width */\n        .auth-header-bar {\n          height: 60px;\n          width: 100vw;\n          background: #FFFFFF;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n          border-bottom: 1px solid #DDDDDD;\n          position: fixed;\n          top: 0;\n          left: 0;\n          z-index: 1000;\n        }\n\n        .auth-header-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          height: 100%;\n          padding: 0 2rem;\n          width: 100%;\n        }\n\n        .auth-header-left {\n          display: flex;\n          align-items: center;\n        }\n\n        .auth-logo-container {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n          transition: all 0.2s ease;\n        }\n\n        .auth-logo-container:hover {\n          transform: scale(1.05);\n        }\n\n        .auth-logo-icon {\n          font-size: 1.25rem;\n          width: 28px;\n          height: 28px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: linear-gradient(135deg, #00BCD4, #00BCD4);\n          border-radius: 50%;\n          color: white;\n          flex-shrink: 0;\n        }\n\n        .auth-logo-text {\n          font-size: 1.125rem;\n          font-weight: 700;\n          color: #1F2937;\n          letter-spacing: 0.025em;\n          flex-shrink: 0;\n        }\n\n        .auth-erp-badge {\n          background: #E91E63;\n          color: white;\n          padding: 0.25rem 0.75rem;\n          border-radius: 20px;\n          font-size: 0.875rem;\n          font-weight: 700;\n          letter-spacing: 0.025em;\n          flex-shrink: 0;\n        }\n\n        .auth-header-right {\n          display: flex;\n          align-items: center;\n        }\n\n        .auth-help-link {\n          color: #555555;\n          text-decoration: none;\n          font-size: 0.875rem;\n          font-weight: 500;\n          padding: 0.5rem 1rem;\n          border-radius: 6px;\n          transition: all 0.2s ease;\n        }\n\n        .auth-help-link:hover {\n          color: #E91E63;\n          background: rgba(233, 30, 99, 0.05);\n        }\n          margin-bottom: 1rem;\n          border-radius: 12px 12px 0 0;\n        }\n\n        .auth-header-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          height: 100%;\n          padding: 0 1.5rem;\n        }\n\n        .auth-header-left {\n          display: flex;\n          align-items: center;\n        }\n\n        .auth-logo-container {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n          transition: all 0.2s ease;\n        }\n\n        .auth-logo-container:hover {\n          transform: scale(1.05);\n        }\n\n        .auth-logo-icon {\n          font-size: 1.25rem;\n          width: 28px;\n          height: 28px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: linear-gradient(135deg, #00BCD4, #00BCD4);\n          border-radius: 50%;\n          color: white;\n          flex-shrink: 0;\n        }\n\n        .auth-logo-text {\n          font-size: 1.125rem;\n          font-weight: 700;\n          color: #1F2937;\n          letter-spacing: 0.025em;\n          flex-shrink: 0;\n        }\n\n        .auth-erp-badge {\n          background: #E91E63;\n          color: white;\n          padding: 0.25rem 0.75rem;\n          border-radius: 20px;\n          font-size: 0.875rem;\n          font-weight: 700;\n          letter-spacing: 0.025em;\n          flex-shrink: 0;\n        }\n\n        .auth-header-right {\n          display: flex;\n          align-items: center;\n        }\n\n        .auth-help-link {\n          color: #555555;\n          text-decoration: none;\n          font-size: 0.875rem;\n          font-weight: 500;\n          padding: 0.5rem 1rem;\n          border-radius: 6px;\n          transition: all 0.2s ease;\n        }\n\n        .auth-help-link:hover {\n          color: #E91E63;\n          background: rgba(233, 30, 99, 0.05);\n        }\n\n        .auth-header { margin-bottom: 1rem; text-align: left; }\n\n        .auth-brand {\n          display: inline-block;\n          font-weight: 800;\n          letter-spacing: 0.5px;\n          color: #ff3366;\n          text-decoration: none;\n          margin-bottom: 0.5rem;\n        }\n\n        .auth-title h1 {\n          margin: 0 0 0.25rem 0;\n          font-size: 1.75rem;\n          line-height: 1.2;\n          color: #0f172a;\n        }\n\n        .auth-title p {\n          margin: 0;\n          color: #475569;\n          font-size: 0.95rem;\n        }\n\n        .auth-card {\n          background: #ffffff;\n          border-radius: 16px;\n          box-shadow: 0 10px 30px rgba(2, 6, 23, 0.06);\n          padding: 1.25rem;\n        }\n\n        /* Responsiveness */\n        @media (max-width: 1024px) {\n          .auth-form-wrap { max-width: 400px; }\n        }\n\n        @media (max-width: 768px) {\n          .auth-page { flex-direction: column; }\n          .auth-divider { height: 1px; width: 100%; }\n          .auth-left { padding-bottom: 0.5rem; }\n          .auth-right { padding-top: 0.5rem; }\n        }\n\n        .login-hero-circle {\n          width: clamp(280px, 60vw, 560px);\n          height: clamp(280px, 60vw, 560px);\n          position: relative;\n        }\n        \n        .login-circle-bg {\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          background: linear-gradient(135deg, rgba(255, 51, 102, 0.1) 0%, rgba(225, 29, 72, 0.05) 100%);\n          backdrop-filter: blur(20px);\n          border: 1px solid rgba(255, 255, 255, 0.14);\n          box-shadow: \n            0 25px 50px -12px rgba(0, 0, 0, 0.25),\n            0 0 0 1px rgba(255, 255, 255, 0.1),\n            inset 0 1px 0 rgba(255, 255, 255, 0.2);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          position: relative;\n          overflow: hidden;\n        }\n        \n        .login-route-svg {\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          z-index: 1;\n        }\n        \n        .route-line {\n          stroke: #22C55E;\n          stroke-width: clamp(2px, 0.4vw, 3px);\n          fill: none;\n          stroke-linecap: round;\n          stroke-dasharray: 8 10;\n          animation: routeDash 7s linear infinite;\n        }\n        \n        .route-line--h,\n        .route-line--v {\n          stroke: url(#routeGradient);\n          stroke-width: clamp(3px, 0.6vw, 4px);\n          fill: none;\n          stroke-linecap: round;\n          stroke-dasharray: 12 16;\n          animation: routeDash 7s linear infinite;\n          filter: drop-shadow(0 2px 4px rgba(34, 197, 94, 0.2));\n        }\n        \n        /* Responsive stroke width adjustments */\n        @media (max-width: 1023px) {\n          .route-line--h,\n          .route-line--v {\n            stroke-width: clamp(3px, 0.8vw, 4px);\n          }\n        }\n        \n        @media (max-width: 639px) {\n          .route-line--h,\n          .route-line--v {\n            stroke-width: clamp(3px, 1vw, 4px);\n          }\n        }\n        \n        .route-line--h { stroke-dashoffset: 0; }\n        .route-line--v { stroke-dashoffset: 0; }\n        \n        .route-pin { /* No animation for pins */ }\n        .route-marker { will-change: transform; }\n        \n        /* Responsive pin and marker sizing */\n        @media (max-width: 1023px) {\n          .route-pin circle { r: clamp(6px, 1.2vw, 8px); }\n          .route-pin circle:last-child { r: clamp(3px, 0.6vw, 4px); }\n          .route-marker circle { r: clamp(3px, 0.6vw, 4px); }\n        }\n        @media (max-width: 639px) {\n          .route-pin circle { r: clamp(5px, 1.5vw, 7px); }\n          .route-pin circle:last-child { r: clamp(2.5px, 0.75vw, 3.5px); }\n          .route-marker circle { r: clamp(2.5px, 0.75vw, 3.5px); }\n        }\n        \n        .route-marker--h1 { transform-origin: 120px 300px; }\n        .route-marker--h2 { transform-origin: 480px 300px; }\n        .route-marker--v1 { transform-origin: 300px 120px; }\n        .route-marker--v2 { transform-origin: 300px 480px; }\n        \n        /* Animations */\n        @keyframes routeDash { to { stroke-dashoffset: -18; } }\n        .animated-icon { will-change: transform; animation: iconFloat 4s ease-in-out infinite; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1)); }\n        .icon-bus-center { animation: busCenterFloat 4s ease-in-out infinite; filter: drop-shadow(0 8px 16px rgba(34, 197, 94, 0.3)); will-change: transform; }\n        .icon-bus-center:hover { filter: drop-shadow(0 12px 24px rgba(34, 197, 94, 0.5)); transform: scale(1.05); transition: all 0.4s ease; }\n        @keyframes busCenterFloat { 0%, 100% { transform: translateY(0px) scale(1); opacity: 0.95; } 50% { transform: translateY(-6px) scale(1.02); opacity: 1; } }\n        \n        /* Motion Preferences */\n        @media (prefers-reduced-motion: reduce) {\n          .route-line, .route-pin, .route-marker, .animated-icon, .icon-bus-center { animation: none !important; transform: none !important; }\n        }\n        \n        /* Header Responsive Styling */\n        @media (max-width: 768px) {\n          header .flex { flex-direction: column; gap: 1rem; text-align: center; }\n          header .space-x-6 { gap: 1rem; }\n        }\n      "})]})};var Wu={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Gu=i.createContext&&i.createContext(Wu),Yu=function(){return Yu=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Yu.apply(this,arguments)},Zu=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function Xu(e){return e&&e.map(function(e,t){return i.createElement(e.tag,Yu({key:t},e.attr),Xu(e.child))})}function Ku(e){return function(t){return i.createElement(Qu,Yu({attr:Yu({},e.attr)},t),Xu(e.child))}}function Qu(e){var t=function(t){var n,r=e.attr,s=e.size,a=e.title,o=Zu(e,["attr","size","title"]),l=s||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),i.createElement("svg",Yu({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:n,style:Yu(Yu({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&i.createElement("title",null,a),e.children)};return void 0!==Gu?i.createElement(Gu.Consumer,null,function(e){return t(e)}):t(Wu)}function Ju(e){return Ku({tag:"svg",attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"}}]})(e)}const $u=e=>{let{id:t,label:n,type:i="text",value:r,onChange:s,autoComplete:a,icon:o=null,required:l=!0,placeholder:c,className:d=""}=e;return(0,ze.jsxs)("div",{className:d,children:[n&&(0,ze.jsx)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-2",children:n}),(0,ze.jsxs)("div",{className:"relative",children:[o&&(0,ze.jsx)("span",{className:"pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400",children:o}),(0,ze.jsx)("input",{id:t,name:t,type:i,autoComplete:a,required:l,value:r,onChange:s,placeholder:c,className:"appearance-none block w-full ".concat(o?"pl-10":"pl-3"," pr-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm transition-colors")})]})]})},eh=e=>{let{id:t="password",label:n="Password",value:r,onChange:s,autoComplete:a="current-password",required:o=!0,placeholder:l,className:c=""}=e;const[d,u]=(0,i.useState)(!1);return(0,ze.jsxs)("div",{className:c,children:[n&&(0,ze.jsx)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-2",children:n}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("input",{id:t,name:t,type:d?"text":"password",autoComplete:a,required:o,value:r,onChange:s,placeholder:l,className:"appearance-none block w-full pl-3 pr-10 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm transition-colors"}),(0,ze.jsx)("button",{type:"button",onClick:()=>u(e=>!e),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors","aria-label":d?"Hide password":"Show password",children:d?(0,ze.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,ze.jsx)("path",{d:"M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.83-1.83A10.284 10.284 0 0019 10s-3-7-9-7a9.955 9.955 0 00-5.393 1.61L3.707 2.293z"}),(0,ze.jsx)("path",{d:"M6.576 5.162A8.012 8.012 0 0110 4c4 0 6.882 3.182 7.71 5-.251.477-.642 1.111-1.177 1.79l-2.4-2.4A3 3 0 009.61 6.157l-3.034-2.995z"}),(0,ze.jsx)("path",{d:"M13.132 14.27l-1.64-1.64a3 3 0 01-4.122-4.122L5.1 5.34A10.28 10.28 0 001 10s3 7 9 7a9.957 9.957 0 004.132-.73z"})]}):(0,ze.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,ze.jsx)("path",{d:"M10 3c-6 0-9 7-9 7s3 7 9 7 9-7 9-7-3-7-9-7zm0 12a5 5 0 110-10 5 5 0 010 10z"})})})]})]})},th=e=>{let{href:t,provider:n="google",icon:r,children:s,ariaLabel:a,onClick:o,className:l="",disabled:c=!1}=e;const[d,u]=(0,i.useState)(!1),h="w-full inline-flex items-center justify-center gap-3 py-3 px-5 rounded-full border border-gray-300 bg-white text-sm font-semibold text-gray-700 hover:bg-gray-50 transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 oauth-button disabled:opacity-50 disabled:cursor-not-allowed",p="google"===n?(0,ze.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,ze.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,ze.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,ze.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,ze.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}):r,m=async e=>{if(!c&&!d)if(u(!0),o)try{await o(e)}finally{u(!1)}else t&&setTimeout(()=>{window.location.href=t},100)};return o?(0,ze.jsxs)("button",{onClick:m,"aria-label":a,className:"".concat(h," ").concat(l),disabled:c||d,children:[d?(0,ze.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-600"}):p,(0,ze.jsx)("span",{children:d?"Processing...":s})]}):(0,ze.jsxs)("a",{href:t,"aria-label":a,className:"".concat(h," ").concat(l),onClick:m,children:[d?(0,ze.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-600"}):p,(0,ze.jsx)("span",{children:d?"Processing...":s})]})},nh=new Map,ih=3e5;async function rh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=localStorage.getItem("depotToken")||localStorage.getItem("token"),i="".concat(t.method||"GET",":").concat(e,":").concat(JSON.stringify(t.body||{}));if("GET"===t.method||!t.method){const e=nh.get(i);if(e&&Date.now()-e.timestamp<ih)return e.data}const r=new Headers(t.headers||{});r.has("Content-Type")||!t.body||t.body instanceof FormData||r.set("Content-Type","application/json"),n&&r.set("Authorization","Bearer ".concat(n)),r.set("X-Requested-With","XMLHttpRequest");try{const n=new AbortController,a=setTimeout(()=>n.abort(),1e4),o=await fetch("http://localhost:5000"+e,Le(Le({},t),{},{headers:r,signal:n.signal}));clearTimeout(a);let l=null;try{l=await o.json()}catch(gu){}if(!o.ok){const e=l&&(l.message||l.error)||o.statusText;if(401===o.status||403===o.status){try{localStorage.removeItem("depotToken"),localStorage.removeItem("depotUser"),localStorage.removeItem("token"),localStorage.removeItem("user")}catch(s){}"undefined"!==typeof window&&(window.location.href="/login")}return{ok:!1,status:o.status,message:e,data:l}}const c={ok:!0,status:o.status,data:l};return"GET"!==t.method&&t.method||nh.set(i,{data:c,timestamp:Date.now()}),c}catch(a){return"AbortError"===a.name?{ok:!1,status:408,message:"Request timeout",data:null}:{ok:!1,status:0,message:"Network error",data:null}}}function sh(){nh.clear()}setInterval(function(){const e=Date.now();for(const[t,n]of nh.entries())e-n.timestamp>ih&&nh.delete(t)},6e4);const ah=e=>{let{initialMode:t="login"}=e;const[n,r]=(0,i.useState)("signup"===t?"signup":"login"),{login:s,user:a}=Fe(),o=te(),[l]=Ie(),c=l.get("next")||"/pax",[d,u]=(0,i.useState)({email:"",password:""}),[h,p]=(0,i.useState)({name:"",email:"",phone:"",password:"",confirmPassword:""}),[m,f]=(0,i.useState)({email:""}),[g,x]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),[_,b]=(0,i.useState)(!1),[w,j]=(0,i.useState)({}),[N,S]=(0,i.useState)({}),[k,T]=(0,i.useState)({}),[C,E]=(0,i.useState)(!1),[A,M]=(0,i.useState)(!1),D=async(e,t)=>{try{try{localStorage.setItem("token",t)}catch(i){}const r=((null===e||void 0===e?void 0:e.email)||"").toLowerCase(),a=((null===e||void 0===e?void 0:e.role)||"").toLowerCase(),o="depot_manager"===a||/-depot@yatrik\.com$/.test(r)||/^depot-/.test(r);let l=e;if(!o){const e=await rh("/api/auth/me");var n;if(null!==e&&void 0!==e&&e.ok&&e.data)l=(null===(n=e.data.data)||void 0===n?void 0:n.user)||e.data.user||e.data}l&&"object"===typeof l||(l=e);const c=Le(Le({},l),{},{_id:l._id||l.id,role:l.role||a||"passenger",email:l.email||r,name:l.name||l.username||"User"});c._id&&c.role||(console.warn("Missing required user fields, using fallback:",c),c._id=c._id||"temp_"+Date.now(),c.role=c.role||"passenger"),s(c,t)}catch(r){console.warn("Profile fetch failed, using login data:",r);const n=Le(Le({},e),{},{_id:e._id||e.id||"temp_"+Date.now(),role:e.role||"passenger",email:e.email||"",name:e.name||e.username||"User"});s(n,t)}};(0,i.useEffect)(()=>{if(a){const e=(a.role||"passenger").toUpperCase(),t="ADMIN"===e?"/admin":"CONDUCTOR"===e?"/conductor":"DRIVER"===e?"/driver":"DEPOT_MANAGER"===e?"/depot":c;console.log("[Auth] existing session redirect:",{role:e,dest:t}),o(t,{replace:!0})}},[a,o,c]),(0,i.useEffect)(()=>{const e=setTimeout(()=>{const e="http://localhost:5000",t="".concat(e,"/api/auth/google?next=").concat(encodeURIComponent(c)),n=document.createElement("link");n.rel="prefetch",n.href=t,document.head.appendChild(n);const i="".concat(e,"/api/depot-auth/login"),r=document.createElement("link");r.rel="prefetch",r.href=i,document.head.appendChild(r);const s="".concat(e,"/api/auth/login"),a=document.createElement("link");a.rel="prefetch",a.href=s,document.head.appendChild(a);const o=document.createElement("link");o.rel="prefetch",o.href="/oauth/callback",document.head.appendChild(o)},500);return()=>clearTimeout(e)},[c]);const I=(0,i.useCallback)(()=>{const e={};return d.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email.trim())||(e.email="Please enter a valid email address"):e.email="Email is required",d.password?d.password.length<6&&(e.password="Password must be at least 6 characters"):e.password="Password is required",j(e),0===Object.keys(e).length},[d]),P=(0,i.useCallback)(()=>{const e={};return h.name.trim()?h.name.trim().length<2?e.name="Name must be at least 2 characters":/^[a-zA-Z\s]+$/.test(h.name.trim())||(e.name="Name can only contain letters and spaces"):e.name="Full name is required",h.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h.email.trim())||(e.email="Please enter a valid email address"):e.email="Email is required",h.phone.trim()?/^[\+]?[^\s]{7,16}$/.test(h.phone.trim())||(e.phone="Please enter a valid phone number"):e.phone="Phone number is required",h.password?h.password.length<8&&(e.password="Password must be at least 8 characters"):e.password="Password is required",h.confirmPassword?h.password!==h.confirmPassword&&(e.confirmPassword="Passwords do not match"):e.confirmPassword="Please confirm your password",S(e),0===Object.keys(e).length},[h]),R=(0,i.useCallback)(()=>{const e={};return m.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.email.trim())||(e.email="Please enter a valid email address"):e.email="Email is required",T(e),0===Object.keys(e).length},[m]),L=(0,i.useCallback)((e,t)=>{u(n=>Le(Le({},n),{},{[e]:t})),w[e]&&j(t=>Le(Le({},t),{},{[e]:""})),"email"===e&&t.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.trim())&&j(e=>Le(Le({},e),{},{email:"Please enter a valid email address"})),"password"===e&&t&&t.length<6&&j(e=>Le(Le({},e),{},{password:"Password must be at least 6 characters"}))},[w]),z=(0,i.useCallback)((e,t)=>{p(n=>Le(Le({},n),{},{[e]:t})),N[e]&&S(t=>Le(Le({},t),{},{[e]:""}))},[N]),O=(0,i.useCallback)((e,t)=>{f(n=>Le(Le({},n),{},{[e]:t})),k[e]&&T(t=>Le(Le({},t),{},{[e]:""}))},[k]),F="login"===n?(0,ze.jsxs)("span",{children:["New here? ",(0,ze.jsx)("button",{type:"button",onClick:()=>r("signup"),className:"font-medium text-primary-600 hover:text-primary-500 transition-colors",disabled:g||y,children:"Create an account"})]}):(0,ze.jsxs)("span",{children:["Already with us? ",(0,ze.jsx)("button",{type:"button",onClick:()=>r("login"),className:"font-medium text-primary-600 hover:text-primary-500 transition-colors",disabled:g||y,children:"Sign in"})]});return(0,ze.jsx)(qu,{title:"Yatrik Account",subtitle:F,children:(0,ze.jsxs)("div",{className:"fade-in",children:[(0,ze.jsxs)("div",{className:"mb-6 grid grid-cols-2 rounded-lg border border-gray-200 overflow-hidden",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>r("login"),className:"py-2.5 text-sm font-medium transition-all duration-200 ".concat("login"===n?"bg-primary-50 text-primary-700":"bg-white text-neutral-600 hover:bg-gray-50"),disabled:g||y,children:"Sign in"}),(0,ze.jsx)("button",{type:"button",onClick:()=>r("signup"),className:"py-2.5 text-sm font-medium transition-all duration-200 ".concat("signup"===n?"bg-primary-50 text-primary-700":"bg-white text-neutral-600 hover:bg-gray-50"),disabled:g||y,children:"Create account"})]}),"login"===n?(0,ze.jsx)("div",{children:A?(0,ze.jsx)("div",{children:C?(0,ze.jsxs)("div",{className:"text-center py-8",children:[(0,ze.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,ze.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Check your email"}),(0,ze.jsxs)("p",{className:"text-sm text-gray-600 mb-6",children:["We've sent a password reset link to ",(0,ze.jsx)("strong",{children:m.email})]}),(0,ze.jsx)("button",{type:"button",onClick:()=>{M(!1),E(!1),f({email:""})},className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:"Back to Sign in"})]}):(0,ze.jsxs)("form",{className:"space-y-6",onSubmit:async e=>{if(e.preventDefault(),R()){b(!0);try{const e=await rh("/api/auth/forgot-password",{method:"POST",body:JSON.stringify({email:m.email})});e.ok?(E(!0),ku.success("Password reset email sent! Check your inbox.")):ku.error(e.message||"Failed to send reset email")}catch(t){ku.error("Network error. Please try again.")}finally{b(!1)}}},children:[(0,ze.jsxs)("div",{className:"text-center mb-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Reset your password"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Enter your email address and we'll send you a link to reset your password."})]}),(0,ze.jsx)($u,{id:"email",label:"Email address",type:"email",autoComplete:"email",value:m.email,onChange:e=>O("email",e.target.value),error:k.email,disabled:_}),(0,ze.jsxs)("div",{className:"flex gap-3",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>M(!1),className:"flex-1 py-2 px-4 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Back to Sign in"}),(0,ze.jsx)("button",{type:"submit",className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200",disabled:_,children:_?(0,ze.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,ze.jsx)(gn,{size:"sm",color:"white"}),(0,ze.jsx)("span",{children:"Sending..."})]}):"Send reset link"})]})]})}):(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("form",{className:"space-y-6 login-form-compact",onSubmit:async e=>{if(e.preventDefault(),I()){x(!0),ku.success("Signing in...",{duration:1e3});try{var t,n,i,r,s,a;const e=d.email.trim().toLowerCase(),o=/^([a-z0-9]+-depot|depot-[a-z0-9]+)@yatrik\.com$/i.test(e),l=o?"/api/depot-auth/login":"/api/auth/login",c=o?{username:e,password:d.password}:{email:e,password:d.password};console.log("[Auth] Login attempt:",{email:e,isDepotEmail:o,url:l,body:c});const u=await rh(l,{method:"POST",body:JSON.stringify(c)});if(console.log("[Auth] Login response:",u),!u.ok)return console.error("[Auth] Login failed:",u.message),void ku.error(u.message||"Login failed");const h=(null===(t=u.data)||void 0===t?void 0:t.user)||(null===(n=u.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.user),p=(null===(r=u.data)||void 0===r?void 0:r.token)||(null===(s=u.data)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.token);console.log("[Auth] Extracted user and token:",{user:h,token:p}),h&&p?await D(h,p):(console.error("[Auth] Invalid response structure:",u.data),ku.error("Invalid response from server"))}catch(o){console.error("[Auth] Login error:",o),ku.error("Network error. Please try again.")}finally{x(!1)}}},children:[(0,ze.jsx)($u,{id:"email",label:"Email address",type:"email",autoComplete:"email",value:d.email,onChange:e=>L("email",e.target.value),error:w.email,disabled:g}),(0,ze.jsx)(eh,{id:"password",label:"Password",autoComplete:"current-password",value:d.password,onChange:e=>L("password",e.target.value),error:w.password,disabled:g}),(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("label",{className:"flex items-center gap-2 text-sm text-neutral-600",children:[(0,ze.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"})," Remember me"]}),(0,ze.jsx)("button",{type:"button",onClick:()=>M(!0),className:"text-sm font-medium text-primary-600 hover:text-primary-500",children:"Forgot password?"})]}),(0,ze.jsx)("div",{children:(0,ze.jsx)("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 btn-transition login-form-compact",disabled:g,children:g?(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(gn,{size:"sm",color:"white"}),(0,ze.jsx)("span",{children:"Signing in..."})]}):"Sign in"})})]}),(0,ze.jsxs)("div",{className:"mt-6 login-form-compact",children:[(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,ze.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,ze.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,ze.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"or"})})]}),(0,ze.jsx)("div",{className:"mt-6",children:(0,ze.jsx)(th,{href:"".concat("http://localhost:5000","/api/auth/google?next=").concat(encodeURIComponent(c)),ariaLabel:"Sign in with Google",icon:(0,ze.jsx)(Ju,{className:"text-red-500"}),disabled:g||y,className:"transform hover:scale-105 active:scale-95 transition-transform duration-100",children:"Sign in with Google"})})]})]})}):(0,ze.jsx)("div",{children:(0,ze.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,ze.jsxs)("form",{className:"space-y-2 login-form-compact",onSubmit:async e=>{if(e.preventDefault(),P()){v(!0);try{var t,n;const e={name:h.name,email:h.email,phone:h.phone,password:h.password},i=await rh("/api/auth/register",{method:"POST",body:JSON.stringify(e)});if(!i.ok)return void ku.error(i.message||"Registration failed");const r=(null===(t=i.data.data)||void 0===t?void 0:t.user)||i.data.user,s=(null===(n=i.data.data)||void 0===n?void 0:n.token)||i.data.token;r&&s?(ku.success("Account created successfully!"),await D(r,s)):ku.error("Invalid response from server")}catch(i){ku.error("Network error. Please try again.")}finally{v(!1)}}},children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,ze.jsx)($u,{id:"name",label:"Full Name",type:"text",autoComplete:"name",value:h.name,onChange:e=>z("name",e.target.value),error:N.name,disabled:y}),(0,ze.jsx)($u,{id:"email",label:"Email address",type:"email",autoComplete:"email",value:h.email,onChange:e=>z("email",e.target.value),error:N.email,disabled:y}),(0,ze.jsx)($u,{id:"phone",label:"Phone Number",type:"tel",autoComplete:"tel",value:h.phone,onChange:e=>z("phone",e.target.value),error:N.phone,disabled:y}),(0,ze.jsx)(eh,{id:"password",label:"Password",autoComplete:"new-password",value:h.password,onChange:e=>z("password",e.target.value),error:N.password,disabled:y})]}),(0,ze.jsx)(eh,{id:"confirmPassword",label:"Confirm Password",autoComplete:"new-password",value:h.confirmPassword,onChange:e=>z("confirmPassword",e.target.value),error:N.confirmPassword,disabled:y}),(0,ze.jsx)("div",{children:(0,ze.jsx)("button",{type:"submit",className:"w-full flex justify-center py-1.5 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 btn-transition login-form-compact",disabled:y,children:y?(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(gn,{size:"sm",color:"white"}),(0,ze.jsx)("span",{children:"Creating account..."})]}):"Create Account"})})]}),(0,ze.jsxs)("div",{className:"mt-4",children:[(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,ze.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,ze.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,ze.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"or"})})]}),(0,ze.jsx)("div",{className:"mt-6",children:(0,ze.jsx)(th,{href:"".concat("http://localhost:5000","/api/auth/google?next=").concat(encodeURIComponent(c),"&mode=signup"),ariaLabel:"Sign up with Google",icon:(0,ze.jsx)(Ju,{className:"text-red-500"}),className:"py-2 transform hover:scale-105 active:scale-95 transition-transform duration-100",disabled:g||y,children:"Sign up with Google"})})]})]})})]})})},oh=()=>{const e=te(),[t]=Ie(),{login:n}=Fe(),[r,s]=(0,i.useState)(!0),[a,o]=(0,i.useState)(null);return(0,i.useEffect)(()=>{const i=e=>{switch(e){case"ADMIN":return"/admin";case"CONDUCTOR":return"/conductor";case"DRIVER":return"/driver";case"DEPOT_MANAGER":return"/depot";default:return"/pax"}};(async()=>{try{if(t.get("error"))return o("Authentication failed. Please try again."),void setTimeout(()=>e("/login"),2e3);const s=t.get("user"),a=t.get("token"),l=t.get("next");if(s&&a)try{const t=JSON.parse(decodeURIComponent(s));n(t,a);const r=(t.role||"passenger").toUpperCase();let o;if(l&&l.startsWith("/")){o=l.startsWith("/pax")&&"PASSENGER"===r||l.startsWith("/admin")&&"ADMIN"===r||l.startsWith("/conductor")&&"CONDUCTOR"===r||l.startsWith("/driver")&&"DRIVER"===r||l.startsWith("/depot")&&"DEPOT_MANAGER"===r?l:i(r)}else o=i(r);return void e(o,{replace:!0})}catch(r){return o("Invalid user data received. Please try again."),void setTimeout(()=>e("/login"),2e3)}o("Authentication incomplete. Please try signing in again."),setTimeout(()=>e("/login"),2e3)}catch(a){o("Authentication failed. Please try again."),setTimeout(()=>e("/login"),2e3)}finally{s(!1)}})()},[t,n,e]),a?(0,ze.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,ze.jsxs)("div",{className:"text-center p-8 bg-white rounded-2xl shadow-lg border border-gray-200",children:[(0,ze.jsxs)("div",{className:"text-red-500 text-xl mb-4",children:["\u274c ",a]}),(0,ze.jsx)("div",{className:"text-gray-600",children:"Redirecting to login page..."})]})}):(0,ze.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,ze.jsxs)("div",{className:"text-center p-8 bg-white rounded-2xl shadow-lg border border-gray-200",children:[(0,ze.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-900 font-medium",children:"Completing Google sign-in..."}),(0,ze.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Please wait while we authenticate you"})]})})},lh=()=>{const e=te(),[t]=Ie(),[n,r]=(0,i.useState)({password:"",confirmPassword:""}),[s,a]=(0,i.useState)({}),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!0),p=t.get("token");(0,i.useEffect)(()=>{if(!p)return ku.error("Invalid reset link. Please request a new password reset."),void e("/login");d(!0),h(!1)},[p,e]);const m=(e,t)=>{r(n=>Le(Le({},n),{},{[e]:t})),s[e]&&a(t=>Le(Le({},t),{},{[e]:""}))};return u?(0,ze.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,ze.jsxs)("div",{className:"text-center p-8 bg-white rounded-2xl shadow-lg border border-gray-200",children:[(0,ze.jsx)(gn,{size:"lg"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-4",children:"Verifying reset link..."})]})}):c?(0,ze.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Reset Password"}),(0,ze.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Enter your new password below"})]}),(0,ze.jsxs)("div",{className:"bg-white py-8 px-6 shadow-lg rounded-lg",children:[(0,ze.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return n.password?n.password.length<8&&(e.password="Password must be at least 8 characters"):e.password="Password is required",n.confirmPassword?n.password!==n.confirmPassword&&(e.confirmPassword="Passwords do not match"):e.confirmPassword="Please confirm your password",a(e),0===Object.keys(e).length})()){l(!0);try{const t=await rh("/api/auth/reset-password",{method:"POST",body:JSON.stringify({token:p,newPassword:n.password})});t.ok?(ku.success("Password reset successfully! You can now sign in with your new password."),e("/login")):ku.error(t.message||"Failed to reset password. The link may have expired.")}catch(i){ku.error("Network error. Please try again.")}finally{l(!1)}}},children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,ze.jsx)("input",{id:"password",name:"password",type:"password",required:!0,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(s.password?"border-red-300":"border-gray-300"),placeholder:"Enter new password",value:n.password,onChange:e=>m("password",e.target.value),disabled:o}),s.password&&(0,ze.jsx)("p",{className:"mt-1 text-sm text-red-600",children:s.password})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),(0,ze.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(s.confirmPassword?"border-red-300":"border-gray-300"),placeholder:"Confirm new password",value:n.confirmPassword,onChange:e=>m("confirmPassword",e.target.value),disabled:o}),s.confirmPassword&&(0,ze.jsx)("p",{className:"mt-1 text-sm text-red-600",children:s.confirmPassword})]}),(0,ze.jsx)("div",{children:(0,ze.jsx)("button",{type:"submit",disabled:o,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(gn,{size:"sm",color:"white"}),(0,ze.jsx)("span",{children:"Resetting Password..."})]}):"Reset Password"})})]}),(0,ze.jsx)("div",{className:"mt-6 text-center",children:(0,ze.jsx)("button",{onClick:()=>e("/login"),className:"text-sm text-blue-600 hover:text-blue-500 transition-colors",children:"Back to Sign In"})})]})]})}):null},ch=()=>(0,ze.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Profile"}),(0,ze.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,ze.jsx)("p",{className:"text-gray-600",children:"Profile management functionality will be implemented here."})})]});const dh=class{static initializeRazorpay(){if("undefined"!==typeof window&&window.Razorpay)return window.Razorpay;throw new Error("Razorpay not loaded")}static async createOrder(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"INR";try{const r=await rh("/api/payments/create-order",{method:"POST",body:JSON.stringify({amount:e,currency:i,bookingId:t,passengerId:n})});if(!r.ok)throw new Error(r.message||"Failed to create payment order");return r.data}catch(r){throw console.error("Error creating payment order:",r),r}}static async processPayment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=this.initializeRazorpay(),i=new n({key:"rzp_test_cAb1OjW2zX8866",amount:e.amount,currency:e.currency||"INR",name:"YATRIK ERP",description:"Bus Ticket Booking",order_id:e.orderId,handler:async t=>{try{return await this.verifyPayment(t,e.bookingId),ku.success("Payment successful!"),{success:!0,paymentId:t.razorpay_payment_id}}catch(n){throw ku.error("Payment verification failed"),n}},prefill:{name:t.name||"",email:t.email||"",contact:t.phone||""},theme:{color:"#E91E63"},modal:{ondismiss:()=>{ku.error("Payment cancelled")}}});return i.open(),new Promise((e,t)=>{i.on("payment.failed",e=>{ku.error("Payment failed"),t(new Error("Payment failed"))})})}catch(n){throw console.error("Error processing payment:",n),n}}static async verifyPayment(e,t){try{const n=await rh("/api/payments/verify-payment",{method:"POST",body:JSON.stringify({razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature,bookingId:t})});if(!n.ok)throw new Error(n.message||"Payment verification failed");return n.data}catch(n){throw console.error("Error verifying payment:",n),n}}static async getPaymentStatus(e){try{const t=await rh("/api/payments/status/".concat(e));if(!t.ok)throw new Error(t.message||"Failed to get payment status");return t.data}catch(t){throw console.error("Error getting payment status:",t),t}}static async getPaymentHistory(){try{const e=await rh("/api/payments/history");if(!e.ok)throw new Error(e.message||"Failed to get payment history");return e.data}catch(e){throw console.error("Error getting payment history:",e),e}}static async addMoneyToWallet(e){try{const t=await this.createOrder(e,"wallet_".concat(Date.now()),"wallet");return this.processPayment(t)}catch(t){throw console.error("Error adding money to wallet:",t),t}}static formatCurrency(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(e)}},uh=wn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),hh=wn("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]),ph=wn("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),mh=wn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),fh=wn("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),gh=wn("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),xh=wn("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),yh=wn("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),vh=()=>{const{user:e}=Fe(),[t,n]=(0,i.useState)(0),[r,s]=(0,i.useState)(!0),[a,o]=(0,i.useState)([]),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)("overview"),[h,p]=(0,i.useState)(!1),[m,f]=(0,i.useState)(""),[g,x]=(0,i.useState)(!1);(0,i.useEffect)(()=>{y()},[]);const y=async()=>{if(e){c(!0);try{const e=await rh("/api/wallet/balance");e.ok&&n(e.data.balance||0);const t=await rh("/api/wallet/transactions");t.ok&&o(t.data.transactions||[])}catch(t){console.error("Error fetching wallet data:",t),ku.error("Failed to load wallet data")}finally{c(!1)}}},v=e=>{switch(e){case"transport":return(0,ze.jsx)(Ou,{className:"w-5 h-5 text-blue-600"});case"bonus":return(0,ze.jsx)(uh,{className:"w-5 h-5 text-green-600"});case"refund":return(0,ze.jsx)(hh,{className:"w-5 h-5 text-purple-600"});default:return(0,ze.jsx)(ph,{className:"w-5 h-5 text-gray-600"})}},_=e=>{switch(e){case"completed":return"text-green-600 bg-green-100";case"pending":return"text-yellow-600 bg-yellow-100";case"failed":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},b=[{icon:(0,ze.jsx)(mh,{className:"w-6 h-6"}),label:"Add Money",action:()=>x(!0)},{icon:(0,ze.jsx)(ph,{className:"w-6 h-6"}),label:"Cards",action:()=>console.log("Cards")},{icon:(0,ze.jsx)(fh,{className:"w-6 h-6"}),label:"History",action:()=>console.log("History")},{icon:(0,ze.jsx)(uh,{className:"w-6 h-6"}),label:"Rewards",action:()=>console.log("Rewards")}];return l?(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Loading wallet..."})]})}):(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,ze.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,ze.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Wallet"}),(0,ze.jsxs)("button",{onClick:()=>s(!r),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[r?(0,ze.jsx)(gh,{className:"w-5 h-5"}):(0,ze.jsx)(xh,{className:"w-5 h-5"}),(0,ze.jsxs)("span",{children:[r?"Hide":"Show"," Balance"]})]})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-gray-600 mb-2",children:"Available Balance"}),(0,ze.jsx)("div",{className:"text-4xl font-bold text-gray-900 mb-4",children:r?(w=t,new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(w)):"****"}),(0,ze.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,ze.jsx)("button",{onClick:()=>x(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Add Money"}),(0,ze.jsx)("button",{className:"bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"Withdraw"})]})]})]}),(0,ze.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:b.map((e,t)=>(0,ze.jsxs)("button",{onClick:e.action,className:"bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow text-center",children:[(0,ze.jsx)("div",{className:"text-blue-600 mb-2",children:e.icon}),(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-700",children:e.label})]},t))}),(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[{label:"Total Spent",value:"\u20b98,500",change:"+12%",trend:"up",color:"text-blue-600"},{label:"Savings",value:"\u20b93,200",change:"+8%",trend:"up",color:"text-green-600"},{label:"Rewards",value:"\u20b91,800",change:"+25%",trend:"up",color:"text-purple-600"}].map((e,t)=>(0,ze.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:e.label}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value})]}),(0,ze.jsxs)("div",{className:"text-right ".concat(e.color),children:[(0,ze.jsx)("p",{className:"text-sm font-medium",children:e.change}),(0,ze.jsx)("p",{className:"text-xs",children:"This month"})]})]})},t))}),(0,ze.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Transactions"}),(0,ze.jsx)("button",{className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"View All"})]}),0===a.length?(0,ze.jsxs)("div",{className:"text-center py-8",children:[(0,ze.jsx)(ph,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"No transactions yet"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400",children:"Your transaction history will appear here"})]}):(0,ze.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-100 rounded-lg",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:v(e.category)}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"font-medium text-gray-900",children:e.description}),(0,ze.jsxs)("p",{className:"text-sm text-gray-500",children:[e.date," \u2022 ",e.time]})]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsxs)("p",{className:"font-medium ".concat("credit"===e.type?"text-green-600":"text-red-600"),children:["credit"===e.type?"+":"-","\u20b9",e.amount]}),(0,ze.jsx)("span",{className:"inline-block px-2 py-1 text-xs rounded-full ".concat(_(e.status)),children:e.status})]})]},e.id))})]})]}),g&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add Money to Wallet"}),(0,ze.jsxs)("div",{className:"mb-4",children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (\u20b9)"}),(0,ze.jsx)("input",{type:"number",value:m,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter amount",min:"1",step:"1"})]}),(0,ze.jsxs)("div",{className:"flex space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>x(!1),className:"flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,ze.jsx)("button",{onClick:async()=>{if(!m||m<=0)ku.error("Please enter a valid amount");else{p(!0);try{await dh.addMoneyToWallet(parseFloat(m)),x(!1),f(""),y(),ku.success("Money added successfully!")}catch(e){console.error("Error adding money:",e),ku.error("Failed to add money. Please try again.")}finally{p(!1)}}},disabled:h||!m,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):"Add Money"})]})]})})]});var w},_h=()=>(0,ze.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Trip Planner"}),(0,ze.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,ze.jsx)("p",{className:"text-gray-600",children:"Trip planning functionality will be implemented here."})})]}),bh=()=>{var e,t;const{user:n}=Fe(),r=$(),s=te(),[a,o]=(0,i.useState)((null===(e=r.state)||void 0===e?void 0:e.selectedRoute)||null),[l,c]=(0,i.useState)((null===(t=r.state)||void 0===t?void 0:t.selectedDate)||""),[d,u]=(0,i.useState)([]),[h,p]=(0,i.useState)(null),[m,f]=(0,i.useState)([]),[g,x]=(0,i.useState)([]),[y,v]=(0,i.useState)({name:(null===n||void 0===n?void 0:n.name)||"",email:(null===n||void 0===n?void 0:n.email)||"",phone:(null===n||void 0===n?void 0:n.phone)||"",age:"",gender:"male"}),[_,b]=(0,i.useState)(!1),[w,j]=(0,i.useState)(1),[N,S]=(0,i.useState)(null),[k,T]=(0,i.useState)([]);(0,i.useEffect)(()=>{a?l&&C():s("/kerala-routes")},[a,l]);const C=async()=>{try{const e=await rh("/api/booking/route/".concat(a.id,"/trips?date=").concat(l));e.ok?u(e.data):ku.error("Failed to fetch trips")}catch(e){console.error("Error fetching trips:",e),ku.error("Failed to fetch trips")}},E=async e=>{await(async e=>{try{const t=await rh("/api/booking/trip/".concat(e,"/seats"));t.ok?(f(t.data.seats),p(t.data.trip)):ku.error("Failed to fetch seat availability")}catch(t){console.error("Error fetching seats:",t),ku.error("Failed to fetch seat availability")}})(e.id),j(2)},A=(e,t)=>{v(n=>Le(Le({},n),{},{[e]:t}))},M=()=>h&&0!==g.length?h.baseFare*g.length:0,D=async()=>{if(null!==N&&void 0!==N&&N.paymentOrder)try{await dh.processPayment(N.paymentOrder,y);const e=await rh("/api/booking/".concat(N.booking.id,"/confirm"),{method:"POST",body:JSON.stringify({paymentId:"test_payment_id",paymentSignature:"test_signature"})});e.ok?(T(e.data.tickets),j(5),ku.success("Booking confirmed! Payment successful.")):ku.error("Failed to confirm booking")}catch(e){console.error("Payment error:",e),ku.error("Payment failed. Please try again.")}else ku.error("No payment order available")};return(0,ze.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Book Tickets"}),(0,ze.jsx)("div",{className:"flex items-center justify-center mb-8",children:(0,ze.jsx)("div",{className:"flex items-center space-x-4",children:[1,2,3,4,5].map(e=>(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(w>=e?"bg-pink-500 text-white":"bg-gray-200 text-gray-600"),children:e}),e<5&&(0,ze.jsx)("div",{className:"w-16 h-1 mx-2 ".concat(w>e?"bg-pink-500":"bg-gray-200")})]},e))})}),(0,ze.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[1===w&&(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Select Your Trip"}),(0,ze.jsxs)("button",{onClick:()=>s("/kerala-routes"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800",children:[(0,ze.jsx)(Iu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Back to Routes"})]})]}),a&&(0,ze.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[(0,ze.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:a.routeName}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-blue-700",children:[(0,ze.jsxs)("span",{children:[a.from," \u2192 ",a.to]}),(0,ze.jsx)("span",{children:"\u2022"}),(0,ze.jsxs)("span",{children:[a.distance," km"]}),(0,ze.jsx)("span",{children:"\u2022"}),(0,ze.jsxs)("span",{children:["\u20b9",a.baseFare," starting fare"]})]})]}),(0,ze.jsx)("div",{className:"grid gap-4",children:d.map(e=>(0,ze.jsx)("div",{className:"border rounded-lg p-4 hover:border-pink-500 cursor-pointer transition-colors",onClick:()=>E(e),children:(0,ze.jsxs)("div",{className:"flex justify-between items-start",children:[(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,ze.jsx)(Sn,{className:"w-5 h-5 text-pink-500"}),(0,ze.jsx)("span",{className:"font-semibold",children:e.busType}),(0,ze.jsx)("span",{className:"text-sm bg-green-100 text-green-800 px-2 py-1 rounded",children:e.status})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-1",children:[(0,ze.jsx)(id,{className:"w-4 h-4"}),(0,ze.jsxs)("span",{children:[e.from," \u2192 ",e.to]})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-1",children:[(0,ze.jsx)(Tn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:new Date(e.date).toLocaleDateString()})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-1",children:[(0,ze.jsx)(td,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:e.time})]})]}),(0,ze.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Bus: ",e.busNumber," \u2022 Capacity: ",e.capacity," seats"]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsxs)("div",{className:"text-2xl font-bold text-pink-600",children:["\u20b9",e.baseFare]}),(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:"per seat"})]})]})},e.id))}),0===d.length&&(0,ze.jsxs)("div",{className:"text-center py-8",children:[(0,ze.jsx)(Sn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No trips available"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"No trips found for the selected date."})]})]}),2===w&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Select Seats"}),(0,ze.jsxs)("button",{onClick:()=>j(1),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800",children:[(0,ze.jsx)(Iu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Back to Trips"})]})]}),h&&(0,ze.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg mb-6",children:[(0,ze.jsx)("h3",{className:"font-semibold text-green-900 mb-2",children:h.routeName}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-green-700",children:[(0,ze.jsxs)("span",{children:[h.from," \u2192 ",h.to]}),(0,ze.jsx)("span",{children:"\u2022"}),(0,ze.jsx)("span",{children:new Date(h.date).toLocaleDateString()}),(0,ze.jsx)("span",{children:"\u2022"}),(0,ze.jsx)("span",{children:h.time}),(0,ze.jsx)("span",{children:"\u2022"}),(0,ze.jsxs)("span",{children:["Bus: ",h.busNumber]})]})]}),(0,ze.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg",children:(0,ze.jsx)("div",{className:"grid grid-cols-4 gap-2 max-w-md mx-auto",children:m.map(e=>(0,ze.jsx)("button",{disabled:e.isBooked,className:"p-2 rounded text-sm font-medium transition-colors ".concat(e.isBooked?"bg-red-500 text-white cursor-not-allowed":g.includes(e.seatNumber)?"bg-pink-500 text-white":"bg-white text-gray-700 hover:bg-pink-100"),onClick:()=>{return t=e.seatNumber,void x(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},children:e.seatNumber},e.seatNumber))})}),(0,ze.jsxs)("div",{className:"text-center space-y-2",children:[(0,ze.jsxs)("p",{className:"text-sm text-gray-600",children:["Selected seats: ",g.join(", ")||"None"]}),(0,ze.jsxs)("div",{className:"flex justify-center space-x-4 text-xs",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-white rounded"}),(0,ze.jsx)("span",{children:"Available"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-pink-500 rounded"}),(0,ze.jsx)("span",{children:"Selected"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded"}),(0,ze.jsx)("span",{children:"Booked"})]})]})]})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("button",{onClick:()=>j(1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"\u2190 Back"}),(0,ze.jsx)("button",{onClick:()=>j(3),disabled:0===g.length,className:"px-6 py-2 bg-pink-600 text-white rounded-lg disabled:opacity-50",children:"Continue \u2192"})]})]}),3===w&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Passenger Details"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,ze.jsx)("input",{type:"text",value:y.name,onChange:e=>A("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter full name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,ze.jsx)("input",{type:"email",value:y.email,onChange:e=>A("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter email"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,ze.jsx)("input",{type:"tel",value:y.phone,onChange:e=>A("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter phone number"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Age"}),(0,ze.jsx)("input",{type:"number",value:y.age,onChange:e=>A("age",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter age"})]})]})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("button",{onClick:()=>j(2),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"\u2190 Back"}),(0,ze.jsx)("button",{onClick:async()=>{if(h&&0!==g.length)if(y.name&&y.email&&y.phone){b(!0);try{const e=await rh("/api/booking/create",{method:"POST",body:JSON.stringify({tripId:h.id,seatNumbers:g,passengerDetails:y,paymentMethod:"razorpay"})});e.ok?(S(e.data),j(4)):ku.error(e.message||"Failed to create booking")}catch(e){console.error("Booking error:",e),ku.error("Failed to create booking")}finally{b(!1)}}else ku.error("Please fill in all passenger details");else ku.error("Please select a trip and seats")},disabled:_,className:"px-6 py-2 bg-pink-600 text-white rounded-lg disabled:opacity-50",children:_?"Creating Booking...":"Create Booking"})]})]}),4===w&&(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Payment"}),(0,ze.jsxs)("button",{onClick:()=>j(3),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800",children:[(0,ze.jsx)(Iu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Back to Details"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Payment Summary"}),(0,ze.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,ze.jsxs)("div",{className:"space-y-2",children:[(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{children:"From:"}),(0,ze.jsx)("span",{className:"font-medium",children:null===h||void 0===h?void 0:h.from})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{children:"To:"}),(0,ze.jsx)("span",{className:"font-medium",children:null===h||void 0===h?void 0:h.to})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{children:"Date:"}),(0,ze.jsx)("span",{className:"font-medium",children:h?new Date(h.departure).toLocaleDateString():""})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{children:"Seats:"}),(0,ze.jsx)("span",{className:"font-medium",children:g.join(", ")})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{children:"Price per seat:"}),(0,ze.jsxs)("span",{className:"font-medium",children:["\u20b9",null===h||void 0===h?void 0:h.price]})]}),(0,ze.jsx)("hr",{className:"my-2"}),(0,ze.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,ze.jsx)("span",{children:"Total Amount:"}),(0,ze.jsxs)("span",{className:"text-pink-600",children:["\u20b9",M()]})]})]})}),(0,ze.jsx)("button",{onClick:D,disabled:_,className:"w-full bg-pink-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(yh,{className:"w-5 h-5 animate-spin"}),"Processing Payment..."]}):(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(ph,{className:"w-5 h-5"}),"Pay \u20b9",M()]})})]}),(0,ze.jsx)("button",{onClick:D,disabled:_,className:"w-full bg-pink-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(yh,{className:"w-5 h-5 animate-spin"}),"Processing Payment..."]}):(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(ph,{className:"w-5 h-5"}),"Pay \u20b9",M()]})})]}),5===w&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(xd,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,ze.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Booking Confirmed!"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Your payment has been processed successfully. Your tickets are ready!"})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Your Tickets"}),k.map((e,t)=>(0,ze.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("h4",{className:"font-semibold text-gray-900",children:["Ticket #",e.ticketNumber]}),(0,ze.jsxs)("p",{className:"text-sm text-gray-600",children:["PNR: ",e.pnr]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsxs)("p",{className:"text-lg font-bold text-pink-600",children:["\u20b9",e.fareAmount]}),(0,ze.jsxs)("p",{className:"text-sm text-gray-500",children:["Seat ",e.seatNumber]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"bg-gray-100 p-2 rounded",children:(0,ze.jsx)("img",{src:e.qrCode,alt:"QR Code",className:"w-16 h-16"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Scan QR code for validation"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Valid until trip completion"})]})]}),(0,ze.jsxs)("button",{onClick:()=>(async e=>{try{const t=await fetch("/api/booking/tickets/".concat(e,"/pdf"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok){const n=await t.blob(),i=window.URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download="ticket_".concat(e,".pdf"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r)}else ku.error("Failed to download ticket")}catch(t){console.error("Error downloading ticket:",t),ku.error("Failed to download ticket")}})(e.id),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Download PDF"})]})]})]},e.id))]}),(0,ze.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,ze.jsx)("h4",{className:"font-semibold text-green-900 mb-2",children:"What's Next?"}),(0,ze.jsxs)("ul",{className:"text-sm text-green-800 space-y-1",children:[(0,ze.jsx)("li",{children:"\u2022 Present your QR code at boarding"}),(0,ze.jsx)("li",{children:"\u2022 Keep your ticket safe during the journey"}),(0,ze.jsx)("li",{children:"\u2022 You can view your tickets anytime in your dashboard"})]})]}),(0,ze.jsxs)("div",{className:"flex space-x-4",children:[(0,ze.jsx)("button",{onClick:()=>s("/dashboard"),className:"flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700",children:"Go to Dashboard"}),(0,ze.jsx)("button",{onClick:()=>s("/kerala-routes"),className:"flex-1 bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700",children:"Book Another Trip"})]})]})]})]})};var wh,jh=Object.defineProperty,Nh=Object.getOwnPropertySymbols,Sh=Object.prototype.hasOwnProperty,kh=Object.prototype.propertyIsEnumerable,Th=(e,t,n)=>t in e?jh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ch=(e,t)=>{for(var n in t||(t={}))Sh.call(t,n)&&Th(e,n,t[n]);if(Nh)for(var n of Nh(t))kh.call(t,n)&&Th(e,n,t[n]);return e},Eh=(e,t)=>{var n={};for(var i in e)Sh.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&Nh)for(var i of Nh(e))t.indexOf(i)<0&&kh.call(e,i)&&(n[i]=e[i]);return n};(e=>{const t=class{constructor(e,n,i,r){if(this.version=e,this.errorCorrectionLevel=n,this.modules=[],this.isFunction=[],e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version value out of range");if(r<-1||r>7)throw new RangeError("Mask value out of range");this.size=4*e+17;let a=[];for(let t=0;t<this.size;t++)a.push(!1);for(let t=0;t<this.size;t++)this.modules.push(a.slice()),this.isFunction.push(a.slice());this.drawFunctionPatterns();const o=this.addEccAndInterleave(i);if(this.drawCodewords(o),-1==r){let e=1e9;for(let t=0;t<8;t++){this.applyMask(t),this.drawFormatBits(t);const n=this.getPenaltyScore();n<e&&(r=t,e=n),this.applyMask(t)}}s(0<=r&&r<=7),this.mask=r,this.applyMask(r),this.drawFormatBits(r),this.isFunction=[]}static encodeText(n,i){const r=e.QrSegment.makeSegments(n);return t.encodeSegments(r,i)}static encodeBinary(n,i){const r=e.QrSegment.makeBytes(n);return t.encodeSegments([r],i)}static encodeSegments(e,n){let r,a,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(t.MIN_VERSION<=l&&l<=c&&c<=t.MAX_VERSION)||d<-1||d>7)throw new RangeError("Invalid value");for(r=l;;r++){const i=8*t.getNumDataCodewords(r,n),s=o.getTotalBits(e,r);if(s<=i){a=s;break}if(r>=c)throw new RangeError("Data too long")}for(const i of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])u&&a<=8*t.getNumDataCodewords(r,i)&&(n=i);let h=[];for(const t of e){i(t.mode.modeBits,4,h),i(t.numChars,t.mode.numCharCountBits(r),h);for(const e of t.getData())h.push(e)}s(h.length==a);const p=8*t.getNumDataCodewords(r,n);s(h.length<=p),i(0,Math.min(4,p-h.length),h),i(0,(8-h.length%8)%8,h),s(h.length%8==0);for(let t=236;h.length<p;t^=253)i(t,8,h);let m=[];for(;8*m.length<h.length;)m.push(0);return h.forEach((e,t)=>m[t>>>3]|=e<<7-(7&t)),new t(r,n,m,d)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2==0),this.setFunctionModule(n,6,n%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let n=0;n<t;n++)for(let i=0;i<t;i++)0==n&&0==i||0==n&&i==t-1||n==t-1&&0==i||this.drawAlignmentPattern(e[n],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.errorCorrectionLevel.formatBits<<3|e;let n=t;for(let r=0;r<10;r++)n=n<<1^1335*(n>>>9);const i=21522^(t<<10|n);s(i>>>15==0);for(let s=0;s<=5;s++)this.setFunctionModule(8,s,r(i,s));this.setFunctionModule(8,7,r(i,6)),this.setFunctionModule(8,8,r(i,7)),this.setFunctionModule(7,8,r(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,r(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,r(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,r(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let n=0;n<12;n++)e=e<<1^7973*(e>>>11);const t=this.version<<12|e;s(t>>>18==0);for(let n=0;n<18;n++){const e=r(t,n),i=this.size-11+n%3,s=Math.floor(n/3);this.setFunctionModule(i,s,e),this.setFunctionModule(s,i,e)}}drawFinderPattern(e,t){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const r=Math.max(Math.abs(i),Math.abs(n)),s=e+i,a=t+n;0<=s&&s<this.size&&0<=a&&a<this.size&&this.setFunctionModule(s,a,2!=r&&4!=r)}}drawAlignmentPattern(e,t){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,t+n,1!=Math.max(Math.abs(i),Math.abs(n)))}setFunctionModule(e,t,n){this.modules[t][e]=n,this.isFunction[t][e]=!0}addEccAndInterleave(e){const n=this.version,i=this.errorCorrectionLevel;if(e.length!=t.getNumDataCodewords(n,i))throw new RangeError("Invalid argument");const r=t.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][n],a=t.ECC_CODEWORDS_PER_BLOCK[i.ordinal][n],o=Math.floor(t.getNumRawDataModules(n)/8),l=r-o%r,c=Math.floor(o/r);let d=[];const u=t.reedSolomonComputeDivisor(a);for(let s=0,p=0;s<r;s++){let n=e.slice(p,p+c-a+(s<l?0:1));p+=n.length;const i=t.reedSolomonComputeRemainder(n,u);s<l&&n.push(0),d.push(n.concat(i))}let h=[];for(let t=0;t<d[0].length;t++)d.forEach((e,n)=>{(t!=c-a||n>=l)&&h.push(e[t])});return s(h.length==o),h}drawCodewords(e){if(e.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let t=this.size-1;t>=1;t-=2){6==t&&(t=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const a=t-s,o=0==(t+1&2)?this.size-1-i:i;!this.isFunction[o][a]&&n<8*e.length&&(this.modules[o][a]=r(e[n>>>3],7-(7&n)),n++)}}s(n==8*e.length)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let n=0;n<this.size;n++){let i;switch(e){case 0:i=(n+t)%2==0;break;case 1:i=t%2==0;break;case 2:i=n%3==0;break;case 3:i=(n+t)%3==0;break;case 4:i=(Math.floor(n/3)+Math.floor(t/2))%2==0;break;case 5:i=n*t%2+n*t%3==0;break;case 6:i=(n*t%2+n*t%3)%2==0;break;case 7:i=((n+t)%2+n*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][n]&&i&&(this.modules[t][n]=!this.modules[t][n])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let n=!1,i=0,r=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[s][a]==n?(i++,5==i?e+=t.PENALTY_N1:i>5&&e++):(this.finderPenaltyAddHistory(i,r),n||(e+=this.finderPenaltyCountPatterns(r)*t.PENALTY_N3),n=this.modules[s][a],i=1);e+=this.finderPenaltyTerminateAndCount(n,i,r)*t.PENALTY_N3}for(let s=0;s<this.size;s++){let n=!1,i=0,r=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[a][s]==n?(i++,5==i?e+=t.PENALTY_N1:i>5&&e++):(this.finderPenaltyAddHistory(i,r),n||(e+=this.finderPenaltyCountPatterns(r)*t.PENALTY_N3),n=this.modules[a][s],i=1);e+=this.finderPenaltyTerminateAndCount(n,i,r)*t.PENALTY_N3}for(let s=0;s<this.size-1;s++)for(let n=0;n<this.size-1;n++){const i=this.modules[s][n];i==this.modules[s][n+1]&&i==this.modules[s+1][n]&&i==this.modules[s+1][n+1]&&(e+=t.PENALTY_N2)}let n=0;for(const t of this.modules)n=t.reduce((e,t)=>e+(t?1:0),n);const i=this.size*this.size,r=Math.ceil(Math.abs(20*n-10*i)/i)-1;return s(0<=r&&r<=9),e+=r*t.PENALTY_N4,s(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(1==this.version)return[];{const e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*e-2));let n=[6];for(let i=this.size-7;n.length<e;i-=t)n.splice(1,0,i);return n}}static getNumRawDataModules(e){if(e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version number out of range");let n=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;n-=(25*t-10)*t-55,e>=7&&(n-=36)}return s(208<=n&&n<=29648),n}static getNumDataCodewords(e,n){return Math.floor(t.getNumRawDataModules(e)/8)-t.ECC_CODEWORDS_PER_BLOCK[n.ordinal][e]*t.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let n=[];for(let t=0;t<e-1;t++)n.push(0);n.push(1);let i=1;for(let r=0;r<e;r++){for(let e=0;e<n.length;e++)n[e]=t.reedSolomonMultiply(n[e],i),e+1<n.length&&(n[e]^=n[e+1]);i=t.reedSolomonMultiply(i,2)}return n}static reedSolomonComputeRemainder(e,n){let i=n.map(e=>0);for(const r of e){const e=r^i.shift();i.push(0),n.forEach((n,r)=>i[r]^=t.reedSolomonMultiply(n,e))}return i}static reedSolomonMultiply(e,t){if(e>>>8!=0||t>>>8!=0)throw new RangeError("Byte out of range");let n=0;for(let i=7;i>=0;i--)n=n<<1^285*(n>>>7),n^=(t>>>i&1)*e;return s(n>>>8==0),n}finderPenaltyCountPatterns(e){const t=e[1];s(t<=3*this.size);const n=t>0&&e[2]==t&&e[3]==3*t&&e[4]==t&&e[5]==t;return(n&&e[0]>=4*t&&e[6]>=t?1:0)+(n&&e[6]>=4*t&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,n){return e&&(this.finderPenaltyAddHistory(t,n),t=0),t+=this.size,this.finderPenaltyAddHistory(t,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,t){0==t[0]&&(e+=this.size),t.pop(),t.unshift(e)}};let n=t;function i(e,t,n){if(t<0||t>31||e>>>t!=0)throw new RangeError("Value out of range");for(let i=t-1;i>=0;i--)n.push(e>>>i&1)}function r(e,t){return 0!=(e>>>t&1)}function s(e){if(!e)throw new Error("Assertion error")}n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=n;const a=class{constructor(e,t,n){if(this.mode=e,this.numChars=t,this.bitData=n,t<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}static makeBytes(e){let t=[];for(const n of e)i(n,8,t);return new a(a.Mode.BYTE,e.length,t)}static makeNumeric(e){if(!a.isNumeric(e))throw new RangeError("String contains non-numeric characters");let t=[];for(let n=0;n<e.length;){const r=Math.min(e.length-n,3);i(parseInt(e.substr(n,r),10),3*r+1,t),n+=r}return new a(a.Mode.NUMERIC,e.length,t)}static makeAlphanumeric(e){if(!a.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let t,n=[];for(t=0;t+2<=e.length;t+=2){let r=45*a.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t));r+=a.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),i(r,11,n)}return t<e.length&&i(a.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,n),new a(a.Mode.ALPHANUMERIC,e.length,n)}static makeSegments(e){return""==e?[]:a.isNumeric(e)?[a.makeNumeric(e)]:a.isAlphanumeric(e)?[a.makeAlphanumeric(e)]:[a.makeBytes(a.toUtf8ByteArray(e))]}static makeEci(e){let t=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)i(e,8,t);else if(e<16384)i(2,2,t),i(e,14,t);else{if(!(e<1e6))throw new RangeError("ECI assignment value out of range");i(6,3,t),i(e,21,t)}return new a(a.Mode.ECI,0,t)}static isNumeric(e){return a.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return a.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let n=0;for(const i of e){const e=i.mode.numCharCountBits(t);if(i.numChars>=1<<e)return 1/0;n+=4+e+i.bitData.length}return n}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let n=0;n<e.length;n++)"%"!=e.charAt(n)?t.push(e.charCodeAt(n)):(t.push(parseInt(e.substr(n+1,2),16)),n+=2);return t}};let o=a;o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e.QrSegment=o})(wh||(wh={})),(e=>{let t;(e=>{const t=class{constructor(e,t){this.ordinal=e,this.formatBits=t}};let n=t;n.LOW=new t(0,1),n.MEDIUM=new t(1,0),n.QUARTILE=new t(2,3),n.HIGH=new t(3,2),e.Ecc=n})(t=e.QrCode||(e.QrCode={}))})(wh||(wh={})),(e=>{let t;(e=>{const t=class{constructor(e,t){this.modeBits=e,this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}};let n=t;n.NUMERIC=new t(1,[10,12,14]),n.ALPHANUMERIC=new t(2,[9,11,13]),n.BYTE=new t(4,[8,16,16]),n.KANJI=new t(8,[8,10,12]),n.ECI=new t(7,[0,0,0]),e.Mode=n})(t=e.QrSegment||(e.QrSegment={}))})(wh||(wh={}));var Ah=wh,Mh={L:Ah.QrCode.Ecc.LOW,M:Ah.QrCode.Ecc.MEDIUM,Q:Ah.QrCode.Ecc.QUARTILE,H:Ah.QrCode.Ecc.HIGH},Dh=128,Ih="L",Ph="#FFFFFF",Rh="#000000",Lh=!1;function zh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=[];return e.forEach(function(e,i){let r=null;e.forEach(function(s,a){if(!s&&null!==r)return n.push("M".concat(r+t," ").concat(i+t,"h").concat(a-r,"v1H").concat(r+t,"z")),void(r=null);if(a!==e.length-1)s&&null===r&&(r=a);else{if(!s)return;null===r?n.push("M".concat(a+t,",").concat(i+t," h1v1H").concat(a+t,"z")):n.push("M".concat(r+t,",").concat(i+t," h").concat(a+1-r,"v1H").concat(r+t,"z"))}})}),n.join("")}function Oh(e,t){return e.slice().map((e,n)=>n<t.y||n>=t.y+t.h?e:e.map((e,n)=>(n<t.x||n>=t.x+t.w)&&e))}function Fh(e,t,n,i){if(null==i)return null;const r=n?4:0,s=e.length+2*r,a=Math.floor(.1*t),o=s/t,l=(i.width||a)*o,c=(i.height||a)*o,d=null==i.x?e.length/2-l/2:i.x*o,u=null==i.y?e.length/2-c/2:i.y*o;let h=null;if(i.excavate){let e=Math.floor(d),t=Math.floor(u);h={x:e,y:t,w:Math.ceil(l+d-e),h:Math.ceil(c+u-t)}}return{x:d,y:u,h:c,w:l,excavation:h}}var Bh=function(){try{(new Path2D).addPath(new Path2D)}catch(wd){return!1}return!0}();function Vh(e){const t=e,{value:n,size:r=Dh,level:s=Ih,bgColor:a=Ph,fgColor:o=Rh,includeMargin:l=Lh,style:c,imageSettings:d}=t,u=Eh(t,["value","size","level","bgColor","fgColor","includeMargin","style","imageSettings"]),h=null==d?void 0:d.src,p=i.useRef(null),m=i.useRef(null),[f,g]=i.useState(!1);i.useEffect(()=>{if(null!=p.current){const e=p.current,t=e.getContext("2d");if(!t)return;let i=Ah.QrCode.encodeText(n,Mh[s]).getModules();const c=l?4:0,u=i.length+2*c,h=Fh(i,r,l,d),f=m.current,g=null!=h&&null!==f&&f.complete&&0!==f.naturalHeight&&0!==f.naturalWidth;g&&null!=h.excavation&&(i=Oh(i,h.excavation));const x=window.devicePixelRatio||1;e.height=e.width=r*x;const y=r/u*x;t.scale(y,y),t.fillStyle=a,t.fillRect(0,0,u,u),t.fillStyle=o,Bh?t.fill(new Path2D(zh(i,c))):i.forEach(function(e,n){e.forEach(function(e,i){e&&t.fillRect(i+c,n+c,1,1)})}),g&&t.drawImage(f,h.x+c,h.y+c,h.w,h.h)}}),i.useEffect(()=>{g(!1)},[h]);const x=Ch({height:r,width:r},c);let y=null;return null!=h&&(y=i.createElement("img",{src:h,key:h,style:{display:"none"},onLoad:()=>{g(!0)},ref:m})),i.createElement(i.Fragment,null,i.createElement("canvas",Ch({style:x,height:r,width:r,ref:p},u)),y)}function Uh(e){const t=e,{value:n,size:r=Dh,level:s=Ih,bgColor:a=Ph,fgColor:o=Rh,includeMargin:l=Lh,imageSettings:c}=t,d=Eh(t,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let u=Ah.QrCode.encodeText(n,Mh[s]).getModules();const h=l?4:0,p=u.length+2*h,m=Fh(u,r,l,c);let f=null;null!=c&&null!=m&&(null!=m.excavation&&(u=Oh(u,m.excavation)),f=i.createElement("image",{xlinkHref:c.src,height:m.h,width:m.w,x:m.x+h,y:m.y+h,preserveAspectRatio:"none"}));const g=zh(u,h);return i.createElement("svg",Ch({height:r,width:r,viewBox:"0 0 ".concat(p," ").concat(p)},d),i.createElement("path",{fill:a,d:"M0,0 h".concat(p,"v").concat(p,"H0z"),shapeRendering:"crispEdges"}),i.createElement("path",{fill:o,d:g,shapeRendering:"crispEdges"}),f)}var Hh=e=>{const t=e,{renderAs:n}=t,r=Eh(t,["renderAs"]);return"svg"===n?i.createElement(Uh,Ch({},r)):i.createElement(Vh,Ch({},r))};const qh=Object.create(null);qh.open="0",qh.close="1",qh.ping="2",qh.pong="3",qh.message="4",qh.upgrade="5",qh.noop="6";const Wh=Object.create(null);Object.keys(qh).forEach(e=>{Wh[qh[e]]=e});const Gh={type:"error",data:"parser error"},Yh="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Zh="function"===typeof ArrayBuffer,Xh=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Kh=(e,t,n)=>{let{type:i,data:r}=e;return Yh&&r instanceof Blob?t?n(r):Qh(r,n):Zh&&(r instanceof ArrayBuffer||Xh(r))?t?n(r):Qh(new Blob([r]),n):n(qh[i]+(r||""))},Qh=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Jh(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let $h;const ep="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tp="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let n=0;n<64;n++)tp[ep.charCodeAt(n)]=n;const np="function"===typeof ArrayBuffer,ip=(e,t)=>{if("string"!==typeof e)return{type:"message",data:sp(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:rp(e.substring(1),t)};return Wh[n]?e.length>1?{type:Wh[n],data:e.substring(1)}:{type:Wh[n]}:Gh},rp=(e,t)=>{if(np){const n=(e=>{let t,n,i,r,s,a=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);const c=new ArrayBuffer(a),d=new Uint8Array(c);for(t=0;t<o;t+=4)n=tp[e.charCodeAt(t)],i=tp[e.charCodeAt(t+1)],r=tp[e.charCodeAt(t+2)],s=tp[e.charCodeAt(t+3)],d[l++]=n<<2|i>>4,d[l++]=(15&i)<<4|r>>2,d[l++]=(3&r)<<6|63&s;return c})(e);return sp(n,t)}return{base64:!0,data:e}},sp=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,ap=String.fromCharCode(30);function op(){return new TransformStream({transform(e,t){!function(e,t){Yh&&e.data instanceof Blob?e.data.arrayBuffer().then(Jh).then(t):Zh&&(e.data instanceof ArrayBuffer||Xh(e.data))?t(Jh(e.data)):Kh(e,!1,e=>{$h||($h=new TextEncoder),t($h.encode(e))})}(e,n=>{const i=n.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const e=new DataView(r.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{r=new Uint8Array(9);const e=new DataView(r.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!==typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)})}})}let lp;function cp(e){return e.reduce((e,t)=>e+t.length,0)}function dp(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let i=0;for(let r=0;r<t;r++)n[r]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}function up(e){if(e)return function(e){for(var t in up.prototype)e[t]=up.prototype[t];return e}(e)}up.prototype.on=up.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},up.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},up.prototype.off=up.prototype.removeListener=up.prototype.removeAllListeners=up.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<i.length;r++)if((n=i[r])===t||n.fn===t){i.splice(r,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},up.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t)}return this},up.prototype.emitReserved=up.prototype.emit,up.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},up.prototype.hasListeners=function(e){return!!this.listeners(e).length};const hp="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),pp="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function mp(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.reduce((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t),{})}const fp=pp.setTimeout,gp=pp.clearTimeout;function xp(e,t){t.useNativeTimers?(e.setTimeoutFn=fp.bind(pp),e.clearTimeoutFn=gp.bind(pp)):(e.setTimeoutFn=pp.setTimeout.bind(pp),e.clearTimeoutFn=pp.clearTimeout.bind(pp))}function yp(e){return"string"===typeof e?function(e){let t=0,n=0;for(let i=0,r=e.length;i<r;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))}function vp(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class _p extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class bp extends up{constructor(e){super(),this.writable=!1,xp(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new _p(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=ip(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}class wp extends bp{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(ap),i=[];for(let r=0;r<n.length;r++){const e=ip(n[r],t);if(i.push(e),"error"===e.type)break}return i})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,i=new Array(n);let r=0;e.forEach((e,s)=>{Kh(e,!1,e=>{i[s]=e,++r===n&&t(i.join(ap))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=vp()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let jp=!1;try{jp="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(BS){}const Np=jp;function Sp(){}class kp extends wp{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class Tp extends up{constructor(e,t,n){super(),this.createRequest=e,xp(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=mp(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(wd){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(wd){}try{n.setRequestHeader("Accept","*/*")}catch(wd){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"===typeof n.status?n.status:0)},0))},n.send(this._data)}catch(wd){return void this.setTimeoutFn(()=>{this._onError(wd)},0)}"undefined"!==typeof document&&(this._index=Tp.requestsCount++,Tp.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=Sp,e)try{this._xhr.abort()}catch(wd){}"undefined"!==typeof document&&delete Tp.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(Tp.requestsCount=0,Tp.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",Cp);else if("function"===typeof addEventListener){addEventListener("onpagehide"in pp?"pagehide":"unload",Cp,!1)}function Cp(){for(let e in Tp.requests)Tp.requests.hasOwnProperty(e)&&Tp.requests[e].abort()}const Ep=function(){const e=Ap({xdomain:!1});return e&&null!==e.responseType}();function Ap(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||Np))return new XMLHttpRequest}catch(wd){}if(!t)try{return new(pp[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(wd){}}const Mp="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Dp extends bp{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=Mp?{}:mp(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(BS){return this.emitReserved("error",BS)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Kh(n,this.supportsBinary,e=>{try{this.doWrite(n,e)}catch(wd){}i&&hp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=vp()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Ip=pp.WebSocket||pp.MozWebSocket;const Pp={websocket:class extends Dp{createSocket(e,t,n){return Mp?new Ip(e,t,n):t?new Ip(e,t):new Ip(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends bp{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(BS){return this.emitReserved("error",BS)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){lp||(lp=new TextDecoder);const n=[];let i=0,r=-1,s=!1;return new TransformStream({transform(a,o){for(n.push(a);;){if(0===i){if(cp(n)<1)break;const e=dp(n,1);s=128===(128&e[0]),r=127&e[0],i=r<126?3:126===r?1:2}else if(1===i){if(cp(n)<2)break;const e=dp(n,2);r=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(cp(n)<8)break;const e=dp(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){o.enqueue(Gh);break}r=s*Math.pow(2,32)+t.getUint32(4),i=3}else{if(cp(n)<r)break;const e=dp(n,r);o.enqueue(ip(s?e:lp.decode(e),t)),i=0}if(0===r||r>e){o.enqueue(Gh);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=op();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const r=()=>{n.read().then(e=>{let{done:t,value:n}=e;t||(this.onPacket(n),r())}).catch(e=>{})};r();const s={type:"open"};this.query.sid&&(s.data='{"sid":"'.concat(this.query.sid,'"}')),this._writer.write(s).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this._writer.write(n).then(()=>{i&&hp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends kp{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Ep&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new Tp(Ap,this.uri(),e)}}},Rp=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Lp=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function zp(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));let r=Rp.exec(e||""),s={},a=14;for(;a--;)s[Lp[a]]=r[a]||"";return-1!=n&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const n=/\/{2,9}/g,i=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||i.splice(0,1);"/"==t.slice(-1)&&i.splice(i.length-1,1);return i}(0,s.path),s.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,i){t&&(n[t]=i)}),n}(0,s.query),s}const Op="function"===typeof addEventListener&&"function"===typeof removeEventListener,Fp=[];Op&&addEventListener("offline",()=>{Fp.forEach(e=>e())},!1);class Bp extends up{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const n=zp(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=zp(t.host).host);xp(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let i=0,r=n.length;i<r;i++){let e=n[i].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),Op&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Fp.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&Bp.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",Bp.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const n=this.writeBuffer[t].data;if(n&&(e+=yp(n)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,hp(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,i){if("function"===typeof t&&(i=t,t=void 0),"function"===typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(Bp.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Op&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=Fp.indexOf(this._offlineEventListener);-1!==e&&Fp.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Bp.protocol=4;class Vp extends Bp{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;Bp.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Bp.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{n||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function r(){n||(n=!0,c(),t.close(),t=null)}const s=e=>{const n=new Error("probe error: "+e);n.transport=t.name,r(),this.emitReserved("upgradeError",n)};function a(){s("transport closed")}function o(){s("socket closed")}function l(e){t&&e.name!==t.name&&r()}const c=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",o),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",o),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}class Up extends Vp{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(e=>Pp[e]).filter(e=>!!e)),super(e,t)}}const Hp="function"===typeof ArrayBuffer,qp=Object.prototype.toString,Wp="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===qp.call(Blob),Gp="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===qp.call(File);function Yp(e){return Hp&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||Wp&&e instanceof Blob||Gp&&e instanceof File}function Zp(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Zp(e[t]))return!0;return!1}if(Yp(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Zp(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Zp(e[n]))return!0;return!1}function Xp(e){const t=[],n=e.data,i=e;return i.data=Kp(n,t),i.attachments=t.length,{packet:i,buffers:t}}function Kp(e,t){if(!e)return e;if(Yp(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=Kp(e[i],t);return n}if("object"===typeof e&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=Kp(e[i],t));return n}return e}function Qp(e,t){return e.data=Jp(e.data,t),delete e.attachments,e}function Jp(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Jp(e[n],t);else if("object"===typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Jp(e[n],t));return e}const $p=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],em=5;var tm;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(tm||(tm={}));class nm{constructor(e){this.replacer=e}encode(e){return e.type!==tm.EVENT&&e.type!==tm.ACK||!Zp(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===tm.EVENT?tm.BINARY_EVENT:tm.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==tm.BINARY_EVENT&&e.type!==tm.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Xp(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}function im(e){return"[object Object]"===Object.prototype.toString.call(e)}class rm extends up{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===tm.BINARY_EVENT;n||t.type===tm.BINARY_ACK?(t.type=n?tm.EVENT:tm.ACK,this.reconstructor=new sm(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Yp(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===tm[n.type])throw new Error("unknown packet type "+n.type);if(n.type===tm.BINARY_EVENT||n.type===tm.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const r=e.substring(i,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(i,t)}else n.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!rm.isPayloadValid(n.type,i))throw new Error("invalid payload");n.data=i}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(wd){return!1}}static isPayloadValid(e,t){switch(e){case tm.CONNECT:return im(t);case tm.DISCONNECT:return void 0===t;case tm.CONNECT_ERROR:return"string"===typeof t||im(t);case tm.EVENT:case tm.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===$p.indexOf(t[0]));case tm.ACK:case tm.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class sm{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Qp(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function am(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const om=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class lm extends up{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[am(e,"open",this.onopen.bind(this)),am(e,"packet",this.onpacket.bind(this)),am(e,"error",this.onerror.bind(this)),am(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,n,i;if(om.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const o={type:tm.EVENT,data:s,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"===typeof s[s.length-1]){const e=this.ids++,t=s.pop();this._registerAckCallback(e,t),o.id=e}const l=null===(n=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===n?void 0:n.writable,c=this.connected&&!(null===(i=this.io.engine)||void 0===i?void 0:i._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var n,i=this;const r=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===r)return void(this.acks[e]=t);const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},r),a=function(){i.io.clearTimeoutFn(s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(i,n)};a.withError=!0,this.acks[e]=a}emitWithAck(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new Promise((t,i)=>{const r=(e,n)=>e?i(e):t(n);r.withError=!0,n.push(r),this.emit(e,...n)})}_addToQueue(e){var t=this;let n;"function"===typeof e[e.length-1]&&(n=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(function(e){if(i!==t._queue[0])return;if(null!==e)i.tryCount>t._opts.retries&&(t._queue.shift(),n&&n(e));else if(t._queue.shift(),n){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];n(null,...s)}return i.pending=!1,t._drainQueue()}),this._queue.push(i),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:tm.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case tm.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case tm.EVENT:case tm.BINARY_EVENT:this.onevent(e);break;case tm.ACK:case tm.BINARY_ACK:this.onack(e);break;case tm.DISCONNECT:this.ondisconnect();break;case tm.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(){if(!n){n=!0;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];t.packet({type:tm.ACK,id:e,data:r})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:tm.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function cm(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}cm.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},cm.prototype.reset=function(){this.attempts=0},cm.prototype.setMin=function(e){this.ms=e},cm.prototype.setMax=function(e){this.max=e},cm.prototype.setJitter=function(e){this.jitter=e};class dm extends up{constructor(t,n){var i;super(),this.nsps={},this.subs=[],t&&"object"===typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,xp(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(i=n.randomizationFactor)&&void 0!==i?i:.5),this.backoff=new cm({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const r=n.parser||e;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Up(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=am(t,"open",function(){n.onopen(),e&&e()}),r=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=am(t,"error",r);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),t.close()},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(am(e,"ping",this.onping.bind(this)),am(e,"data",this.ondata.bind(this)),am(e,"error",this.onerror.bind(this)),am(e,"close",this.onclose.bind(this)),am(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(wd){this.onclose("parse error",wd)}}ondecoded(e){hp(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new lm(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const um={};function hm(e,t){"object"===typeof e&&(t=e,e=void 0);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),i=zp(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(n&&n.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),i=n.source,r=n.id,s=n.path,a=um[r]&&s in um[r].nsps;let o;return t.forceNew||t["force new connection"]||!1===t.multiplex||a?o=new dm(i,t):(um[r]||(um[r]=new dm(i,t)),o=um[r]),n.query&&!t.query&&(t.query=n.queryKey),o.socket(n.path,t)}Object.assign(hm,{Manager:dm,Socket:lm,io:hm,connect:hm});let pm=null;const mm=()=>{const{pnr:e}=ne(),[t]=Ie(),n=e||t.get("pnr"),[r,s]=(0,i.useState)(null),[a,o]=(0,i.useState)(null),l=(null===r||void 0===r?void 0:r.tripId)||null,c=(e=>{const[t,n]=(0,i.useState)([]),[r,s]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(!pm||!e)return;const t="trip:".concat(e);return pm.emit("join",t),pm.on("position_update",e=>{n(t=>[...t,e])}),s(pm.connected),pm.on("connect",()=>s(!0)),pm.on("disconnect",()=>s(!1)),()=>{pm.emit("leave",t),pm.off("position_update"),pm.off("connect"),pm.off("disconnect")}},[e]),{positions:t,status:r}})(l);(0,i.useEffect)(()=>{let e=!0;return async function(){}(),()=>{e=!1}},[n]),(0,i.useEffect)(()=>{let e;async function t(){if(!l||null===r||void 0===r||!r.stopId)return;const e=await rh("/api/eta?tripId=".concat(l,"&stopId=").concat(r.stopId));e.ok&&o(e.data)}return t(),e=setInterval(t,2e4),()=>clearInterval(e)},[l,null===r||void 0===r?void 0:r.stopId]);const d=(0,i.useMemo)(()=>(0,ze.jsx)("span",{className:"inline-flex items-center",children:(0,ze.jsx)("span",{className:"h-2 w-2 rounded-full ".concat(c?"bg-green-500 animate-pulse":"bg-gray-300")})}),[c]);return(0,ze.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Ticket"}),(0,ze.jsx)("div",{className:"bg-white rounded-lg shadow p-5",children:n?(0,ze.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"PNR"}),(0,ze.jsx)("p",{className:"text-xl font-semibold",children:n}),(0,ze.jsxs)("div",{className:"mt-2 text-sm text-gray-600 flex items-center gap-2",children:["Live position ",d]}),a&&(0,ze.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["ETA: ",a.etaMinutes," min"]})]}),(0,ze.jsx)("div",{className:"shrink-0",children:(0,ze.jsx)(Hh,{value:"GoBus|PNR:".concat(n),size:140,includeMargin:!1})})]}):(0,ze.jsx)("p",{className:"text-gray-600",children:"No PNR provided."})})]})},fm=wn("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]),gm=wn("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),xm=wn("Accessibility",[["circle",{cx:"16",cy:"4",r:"1",key:"1grugj"}],["path",{d:"m18 19 1-7-6 1",key:"r0i19z"}],["path",{d:"m5 8 3-3 5.5 3-2.36 3.5",key:"9ptxx2"}],["path",{d:"M4.24 14.5a5 5 0 0 0 6.88 6",key:"10kmtu"}],["path",{d:"M13.76 17.5a5 5 0 0 0-6.88-6",key:"2qq6rc"}]]),ym=()=>{const{user:e}=Fe(),t=te(),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)("");(0,i.useEffect)(()=>{c();const e=new Date;e.setDate(e.getDate()+1),l(e.toISOString().split("T")[0])},[]);const c=async()=>{try{const e=await rh("/api/booking/routes");console.log("Routes API response:",e),e.ok&&e.data?(console.log("Setting routes:",e.data),r(e.data||[])):(console.error("Failed to fetch routes:",e),ku.error("Failed to fetch routes"),r([]))}catch(e){console.error("Error fetching routes:",e),ku.error("Failed to fetch routes"),r([])}finally{a(!1)}},d=e=>{switch(e){case"WiFi":return(0,ze.jsx)(Mu,{className:"w-4 h-4"});case"USB_Charging":return(0,ze.jsx)(Du,{className:"w-4 h-4"});case"Refreshments":return(0,ze.jsx)(fm,{className:"w-4 h-4"});case"Entertainment":return(0,ze.jsx)(gm,{className:"w-4 h-4"});case"Wheelchair_Accessible":return(0,ze.jsx)(xm,{className:"w-4 h-4"});default:return(0,ze.jsx)(nd,{className:"w-4 h-4"})}},u=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,"h ").concat(n,"m")};return s?(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-600 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Loading Kerala routes..."})]})}):(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-gradient-to-r from-pink-600 to-pink-700 text-white py-8",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Kerala Bus Routes"}),(0,ze.jsx)("p",{className:"text-xl opacity-90",children:"Explore the beautiful state of Kerala with our premium bus services"})]})})}),(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,ze.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Travel Date:"}),(0,ze.jsx)("input",{type:"date",value:o,onChange:e=>l(e.target.value),min:(new Date).toISOString().split("T")[0],className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500"})]})})}),(0,ze.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,ze.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Array.isArray(n)&&n.map(n=>(0,ze.jsxs)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden",children:[(0,ze.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold",children:n.routeNumber}),(0,ze.jsxs)("span",{className:"text-sm bg-white bg-opacity-20 px-2 py-1 rounded",children:[n.buses.length," buses"]})]}),(0,ze.jsx)("p",{className:"text-sm opacity-90",children:n.routeName})]}),(0,ze.jsxs)("div",{className:"p-4",children:[(0,ze.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(id,{className:"w-4 h-4 text-gray-500"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"From"}),(0,ze.jsx)("p",{className:"font-medium",children:n.from}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:n.fromLocation})]})]}),(0,ze.jsx)("div",{className:"flex justify-center",children:(0,ze.jsx)(ed,{className:"w-5 h-5 text-gray-400"})}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(id,{className:"w-4 h-4 text-gray-500"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"To"}),(0,ze.jsx)("p",{className:"font-medium",children:n.to}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:n.toLocation})]})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(td,{className:"w-5 h-5 text-gray-500 mx-auto mb-1"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Duration"}),(0,ze.jsx)("p",{className:"font-medium",children:u(n.duration)})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(Sn,{className:"w-5 h-5 text-gray-500 mx-auto mb-1"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Distance"}),(0,ze.jsxs)("p",{className:"font-medium",children:[n.distance," km"]})]})]}),n.features&&n.features.length>0&&(0,ze.jsxs)("div",{className:"mb-4",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Features:"}),(0,ze.jsx)("div",{className:"flex flex-wrap gap-2",children:n.features.map((e,t)=>(0,ze.jsxs)("span",{className:"inline-flex items-center space-x-1 bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:[d(e),(0,ze.jsx)("span",{children:e.replace("_"," ")})]},t))})]}),(0,ze.jsxs)("div",{className:"border-t pt-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Starting from"}),(0,ze.jsxs)("p",{className:"text-2xl font-bold text-pink-600",children:["\u20b9",n.baseFare]})]}),(0,ze.jsxs)("button",{onClick:()=>(n=>{if(!e)return ku.error("Please login to book tickets"),void t("/login",{state:{from:"/kerala-routes"}});t("/booking",{state:{selectedRoute:n,selectedDate:o}})})(n),className:"bg-pink-600 text-white px-6 py-2 rounded-lg hover:bg-pink-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)("span",{children:"Book Now"}),(0,ze.jsx)(ed,{className:"w-4 h-4"})]})]}),(0,ze.jsxs)("p",{className:"text-xs text-gray-500 text-center",children:[n.depot," \u2022 Multiple departures daily"]})]})]})]},n.id))}),(!Array.isArray(n)||0===n.length)&&(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(Sn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No routes available"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"Please check back later for available routes."})]})]}),(0,ze.jsx)("div",{className:"bg-gray-100 py-8",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Why Choose YATRIK ERP?"}),(0,ze.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mt-6",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,ze.jsx)(nd,{className:"w-6 h-6 text-pink-600"})}),(0,ze.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"Premium Service"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Luxury buses with modern amenities"})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,ze.jsx)(td,{className:"w-6 h-6 text-pink-600"})}),(0,ze.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"Punctual"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"On-time departures and arrivals"})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,ze.jsx)(Nn,{className:"w-6 h-6 text-pink-600"})}),(0,ze.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"Safe Travel"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Experienced drivers and well-maintained buses"})]})]})]})})})]})},vm=()=>{const{user:e,logout:t}=Fe(),n=te();return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,ze.jsx)("div",{className:"flex items-center space-x-4",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)(An,{className:"h-8 w-8 text-green-600"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Conductor Dashboard"}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Manage your duties and trips"})]})]})}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-700",children:[(0,ze.jsx)(En,{className:"h-4 w-4"}),(0,ze.jsx)("span",{className:"font-medium",children:(null===e||void 0===e?void 0:e.name)||"Conductor"}),(0,ze.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:(null===e||void 0===e?void 0:e.role)||"CONDUCTOR"})]}),(0,ze.jsxs)("button",{onClick:async()=>{try{await t(),n("/login")}catch(e){console.error("Logout error:",e)}},className:"flex items-center space-x-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors duration-200",children:[(0,ze.jsx)(Bn,{className:"h-4 w-4"}),(0,ze.jsx)("span",{children:"Logout"})]})]})]})})}),(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,ze.jsxs)("div",{className:"bg-white rounded-2xl shadow p-6",children:[(0,ze.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Conductor \u2013 Duties"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Phase-0 placeholder. Use ETM module when implemented."}),(0,ze.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,ze.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,ze.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:"0"}),(0,ze.jsx)("div",{className:"text-sm text-blue-600",children:"Active Trips"})]}),(0,ze.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,ze.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"0"}),(0,ze.jsx)("div",{className:"text-sm text-green-600",children:"Completed Today"})]}),(0,ze.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,ze.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:"0"}),(0,ze.jsx)("div",{className:"text-sm text-yellow-600",children:"Pending Duties"})]})]})]})})]})},_m=()=>{const{user:e,logout:t}=Fe(),n=te();return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,ze.jsx)("div",{className:"flex items-center space-x-4",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)(Sn,{className:"h-8 w-8 text-blue-600"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Driver Dashboard"}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Manage your trips and routes"})]})]})}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-700",children:[(0,ze.jsx)(En,{className:"h-4 w-4"}),(0,ze.jsx)("span",{className:"font-medium",children:(null===e||void 0===e?void 0:e.name)||"Driver"}),(0,ze.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full",children:(null===e||void 0===e?void 0:e.role)||"DRIVER"})]}),(0,ze.jsxs)("button",{onClick:async()=>{try{await t(),n("/login")}catch(e){console.error("Logout error:",e)}},className:"flex items-center space-x-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors duration-200",children:[(0,ze.jsx)(Bn,{className:"h-4 w-4"}),(0,ze.jsx)("span",{children:"Logout"})]})]})]})})}),(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,ze.jsxs)("div",{className:"bg-white rounded-2xl shadow p-6",children:[(0,ze.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Driver \u2013 Trips"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Phase-0 placeholder. Driver run flow will appear here."}),(0,ze.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,ze.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,ze.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:"0"}),(0,ze.jsx)("div",{className:"text-sm text-blue-600",children:"Active Trips"})]}),(0,ze.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,ze.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"0"}),(0,ze.jsx)("div",{className:"text-sm text-green-600",children:"Completed Today"})]}),(0,ze.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,ze.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:"0"}),(0,ze.jsx)("div",{className:"text-sm text-yellow-600",children:"Scheduled Routes"})]})]})]})})]})},bm=e=>{let{userRole:t="passenger"}=e;const[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)(0);(0,i.useEffect)(()=>{c();const e=setInterval(()=>{c()},3e4);return()=>clearInterval(e)},[t]);const c=async()=>{try{const t=localStorage.getItem("token");if(!t)return;const n=await fetch("/api/notifications",{headers:{Authorization:"Bearer ".concat(t)}});if(n.ok){var e;const t=await n.json();r(t.notifications||[]),l((null===(e=t.notifications)||void 0===e?void 0:e.filter(e=>!e.read).length)||0)}}catch(t){console.log("Failed to fetch notifications:",t)}},d=e=>{switch(e){case"warning":case"delay":return(0,ze.jsx)(gd,{className:"notification-icon warning"});case"success":case"completed":return(0,ze.jsx)(xd,{className:"notification-icon success"});case"info":case"update":default:return(0,ze.jsx)(fd,{className:"notification-icon info"});case"schedule":return(0,ze.jsx)(td,{className:"notification-icon schedule"})}},u=e=>{const t=new Date,n=new Date(e),i=Math.floor((t-n)/6e4);return i<1?"Now":i<60?"".concat(i,"m"):i<1440?"".concat(Math.floor(i/60),"h"):"".concat(Math.floor(i/1440),"d")};return(0,ze.jsxs)("div",{className:"smart-notifications",children:[(0,ze.jsxs)("div",{className:"notification-bell",onClick:()=>a(!s),children:[(0,ze.jsx)(Hn,{className:"bell-icon"}),o>0&&(0,ze.jsx)("span",{className:"notification-badge",children:o})]}),s&&(0,ze.jsxs)("div",{className:"notifications-panel",children:[(0,ze.jsxs)("div",{className:"notifications-header",children:[(0,ze.jsx)("h3",{children:"Notifications"}),(0,ze.jsx)("button",{className:"close-btn",onClick:()=>a(!1),children:(0,ze.jsx)(Fn,{className:"close-icon"})})]}),(0,ze.jsx)("div",{className:"notifications-list",children:0===n.length?(0,ze.jsxs)("div",{className:"no-notifications",children:[(0,ze.jsx)(Hn,{className:"no-notifications-icon"}),(0,ze.jsx)("p",{children:"No notifications"})]}):n.map(e=>(0,ze.jsxs)("div",{className:"notification-item ".concat(e.read?"":"unread"),onClick:()=>(async e=>{try{const t=localStorage.getItem("token");if(!t)return;(await fetch("/api/notifications/".concat(e,"/read"),{method:"PUT",headers:{Authorization:"Bearer ".concat(t)}})).ok&&(r(t=>t.map(t=>t.id===e?Le(Le({},t),{},{read:!0}):t)),l(e=>Math.max(0,e-1)))}catch(t){console.log("Failed to mark notification as read:",t)}})(e.id),children:[(0,ze.jsx)("div",{className:"notification-icon-container",children:d(e.type)}),(0,ze.jsxs)("div",{className:"notification-content",children:[(0,ze.jsx)("div",{className:"notification-title",children:e.title}),(0,ze.jsx)("div",{className:"notification-message",children:e.message}),(0,ze.jsxs)("div",{className:"notification-meta",children:[(0,ze.jsx)("span",{className:"notification-time",children:u(e.timestamp)}),e.priority&&(0,ze.jsx)("span",{className:"notification-priority ".concat(e.priority),children:e.priority})]})]}),!e.read&&(0,ze.jsx)("div",{className:"unread-indicator"})]},e.id))}),n.length>0&&(0,ze.jsx)("div",{className:"notifications-footer",children:(0,ze.jsx)("button",{className:"mark-all-read-btn",children:"Mark all read"})})]})]})},wm=()=>{const{user:e}=Fe(),[t,n]=(0,i.useState)([]),[r,s]=(0,i.useState)(!0),[a,o]=(0,i.useState)(!1),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),[m,f]=(0,i.useState)(""),[g,x]=(0,i.useState)("all"),[y,v]=(0,i.useState)("all"),[_,b]=(0,i.useState)({totalBuses:0,availableBuses:0,maintenanceBuses:0,activeBuses:0}),[w,j]=(0,i.useState)([]),[N,S]=(0,i.useState)([]),[k,T]=(0,i.useState)(!1),[C,E]=(0,i.useState)({busNumber:"",registrationNumber:"",busType:"ac_seater",capacity:{total:0,sleeper:0,seater:0,ladies:0,disabled:0},amenities:[],specifications:{manufacturer:"",model:"",year:(new Date).getFullYear(),engine:"",fuelType:"diesel",mileage:0,maxSpeed:0,length:0,width:0,height:0},assignedDriver:"",assignedConductor:"",notes:""}),A=[{value:"ac_sleeper",label:"AC Sleeper"},{value:"ac_seater",label:"AC Seater"},{value:"non_ac_sleeper",label:"Non-AC Sleeper"},{value:"non_ac_seater",label:"Non-AC Seater"},{value:"volvo",label:"Volvo"},{value:"mini",label:"Mini Bus"}],M=[{value:"wifi",label:"WiFi"},{value:"charging",label:"Charging Points"},{value:"entertainment",label:"Entertainment"},{value:"refreshments",label:"Refreshments"},{value:"toilet",label:"Toilet"},{value:"ac",label:"Air Conditioning"},{value:"heating",label:"Heating"}],D=[{value:"diesel",label:"Diesel"},{value:"petrol",label:"Petrol"},{value:"cng",label:"CNG"},{value:"electric",label:"Electric"},{value:"hybrid",label:"Hybrid"}];(0,i.useEffect)(()=>{P(),I()},[]);const I=async()=>{T(!0);try{const[e,t]=await Promise.all([rh("/api/admin/all-drivers"),rh("/api/admin/conductors")]);e&&Array.isArray(e)?j(e):null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)&&j(e.data),t&&Array.isArray(t)?S(t):null!==t&&void 0!==t&&t.data&&Array.isArray(t.data)&&S(t.data)}catch(e){console.error("Error fetching staff data:",e)}finally{T(!1)}},P=async()=>{try{s(!0);const a=await rh("/api/depot/buses");var e,t,i,r;if(a.ok)n((null===(e=a.data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.buses)||[]),b((null===(i=a.data)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.stats)||{});else console.error("Failed to load buses:",a.status,a.message)}catch(a){console.error("Error fetching buses:",a)}finally{s(!1)}},R=()=>{E({busNumber:"",registrationNumber:"",busType:"ac_seater",capacity:{total:0,sleeper:0,seater:0,ladies:0,disabled:0},amenities:[],specifications:{manufacturer:"",model:"",year:(new Date).getFullYear(),engine:"",fuelType:"diesel",mileage:0,maxSpeed:0,length:0,width:0,height:0},assignedDriver:"",assignedConductor:"",notes:""})},L=t.filter(e=>{const t=e.busNumber.toLowerCase().includes(m.toLowerCase())||e.registrationNumber.toLowerCase().includes(m.toLowerCase()),n="all"===g||e.status===g,i="all"===y||e.busType===y;return t&&n&&i}),z=e=>{switch(e){case"active":return"green";case"maintenance":return"orange";case"retired":return"red";default:return"gray"}},O=e=>{var t;return(null===(t=A.find(t=>t.value===e))||void 0===t?void 0:t.label)||e};return r?(0,ze.jsxs)("div",{className:"fleet-loading",children:[(0,ze.jsx)("div",{className:"loading-spinner"}),(0,ze.jsx)("h3",{children:"Loading Fleet Management..."})]}):(0,ze.jsxs)("div",{className:"fleet-management",children:[(0,ze.jsxs)("div",{className:"dashboard-header",children:[(0,ze.jsxs)("div",{className:"header-left",children:[(0,ze.jsx)("h1",{children:"Fleet Management"}),(0,ze.jsx)("p",{children:"Manage your depot's bus fleet, track maintenance, and monitor vehicle status"})]}),(0,ze.jsx)("div",{className:"header-actions",children:(0,ze.jsxs)("button",{className:"action-btn",onClick:()=>o(!0),children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Add New Bus"]})})]}),(0,ze.jsx)("div",{className:"kpi-section",children:(0,ze.jsxs)("div",{className:"kpi-grid",children:[(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsxs)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),(0,ze.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:_.totalBuses}),(0,ze.jsx)("div",{className:"kpi-label",children:"Total Buses"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:_.availableBuses}),(0,ze.jsx)("div",{className:"kpi-label",children:"Available"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:_.maintenanceBuses}),(0,ze.jsx)("div",{className:"kpi-label",children:"In Maintenance"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:_.activeBuses}),(0,ze.jsx)("div",{className:"kpi-label",children:"Active Trips"})]})]})]})}),(0,ze.jsxs)("div",{className:"search-section",children:[(0,ze.jsxs)("div",{className:"search-input-wrapper",children:[(0,ze.jsx)("svg",{className:"search-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414L10.89 9.89A6 6 0 012 8z",clipRule:"evenodd"})}),(0,ze.jsx)("input",{type:"text",placeholder:"Search by bus number or registration...",value:m,onChange:e=>f(e.target.value),className:"search-input"})]}),(0,ze.jsxs)("div",{className:"filter-controls",children:[(0,ze.jsxs)("select",{value:g,onChange:e=>x(e.target.value),className:"filter-select",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"retired",children:"Retired"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]}),(0,ze.jsxs)("select",{value:y,onChange:e=>v(e.target.value),className:"filter-select",children:[(0,ze.jsx)("option",{value:"all",children:"All Types"}),A.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))]})]})]}),(0,ze.jsx)("div",{className:"table-section",children:(0,ze.jsxs)("div",{className:"table-container",children:[(0,ze.jsxs)("table",{className:"data-table",children:[(0,ze.jsx)("thead",{children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{children:"Bus Number"}),(0,ze.jsx)("th",{children:"Registration"}),(0,ze.jsx)("th",{children:"Type"}),(0,ze.jsx)("th",{children:"Capacity"}),(0,ze.jsx)("th",{children:"Status"}),(0,ze.jsx)("th",{children:"Last Maintenance"}),(0,ze.jsx)("th",{children:"Actions"})]})}),(0,ze.jsx)("tbody",{children:L.map(e=>{var t,n,i;return(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"bus-info",children:[(0,ze.jsx)("div",{className:"bus-number",children:e.busNumber}),(0,ze.jsxs)("div",{className:"bus-id",children:["ID: ",e._id.slice(-6)]})]})}),(0,ze.jsx)("td",{children:e.registrationNumber}),(0,ze.jsx)("td",{children:(0,ze.jsx)("span",{className:"bus-type-badge",children:O(e.busType)})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"capacity-info",children:[(0,ze.jsx)("span",{className:"capacity-total",children:(null===(t=e.capacity)||void 0===t?void 0:t.total)||0}),(0,ze.jsxs)("span",{className:"capacity-detail",children:[(null===(n=e.capacity)||void 0===n?void 0:n.seater)||0,"S / ",(null===(i=e.capacity)||void 0===i?void 0:i.sleeper)||0,"SL"]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("span",{className:"status-badge ".concat(z(e.status)),children:e.status})}),(0,ze.jsx)("td",{children:e.lastMaintenance?new Date(e.lastMaintenance).toLocaleDateString():"N/A"}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"action-buttons",children:[(0,ze.jsx)("button",{className:"action-btn view",onClick:()=>(e=>{p(e),E({busNumber:e.busNumber,registrationNumber:e.registrationNumber,busType:e.busType,capacity:e.capacity||{total:0,sleeper:0,seater:0,ladies:0,disabled:0},amenities:e.amenities||[],specifications:e.specifications||{manufacturer:"",model:"",year:(new Date).getFullYear(),engine:"",fuelType:"diesel",mileage:0,maxSpeed:0,length:0,width:0,height:0},notes:e.notes||""}),c(!0)})(e),title:"View/Edit",children:(0,ze.jsxs)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,ze.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})}),(0,ze.jsx)("button",{className:"action-btn delete",onClick:()=>(e=>{p(e),u(!0)})(e),title:"Delete",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})]},e._id)})})]}),0===L.length&&(0,ze.jsxs)("div",{className:"no-data",children:[(0,ze.jsxs)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),(0,ze.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]}),(0,ze.jsx)("h3",{children:"No buses found"}),(0,ze.jsx)("p",{children:"Try adjusting your search or filters"})]})]})}),a&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"Add New Bus"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{o(!1),R()},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),C.busNumber&&C.registrationNumber&&C.busType&&C.capacity.total)try{const e=await rh("/api/depot/buses",{method:"POST",body:JSON.stringify(C)});if(e.ok)o(!1),R(),P(),alert("Bus added successfully!");else{const t=e.message||"Failed to add bus";alert(t)}}catch(t){console.error("Error adding bus:",t),alert("Failed to add bus")}else alert("Please fill in all required fields: Bus Number, Registration Number, Bus Type, and Total Capacity")},className:"bus-form",children:[(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Bus Number *"}),(0,ze.jsx)("input",{type:"text",value:C.busNumber,onChange:e=>E(Le(Le({},C),{},{busNumber:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Registration Number *"}),(0,ze.jsx)("input",{type:"text",value:C.registrationNumber,onChange:e=>E(Le(Le({},C),{},{registrationNumber:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Bus Type *"}),(0,ze.jsx)("select",{value:C.busType,onChange:e=>E(Le(Le({},C),{},{busType:e.target.value})),required:!0,children:A.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Total Capacity *"}),(0,ze.jsx)("input",{type:"number",value:C.capacity.total,onChange:e=>E(Le(Le({},C),{},{capacity:Le(Le({},C.capacity),{},{total:parseInt(e.target.value)})})),required:!0,min:"1"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Seater Capacity"}),(0,ze.jsx)("input",{type:"number",value:C.capacity.seater,onChange:e=>E(Le(Le({},C),{},{capacity:Le(Le({},C.capacity),{},{seater:parseInt(e.target.value)})})),min:"0"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Sleeper Capacity"}),(0,ze.jsx)("input",{type:"number",value:C.capacity.sleeper,onChange:e=>E(Le(Le({},C),{},{capacity:Le(Le({},C.capacity),{},{sleeper:parseInt(e.target.value)})})),min:"0"})]})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsx)("h3",{children:"Amenities"}),(0,ze.jsx)("div",{className:"amenities-grid",children:M.map(e=>(0,ze.jsxs)("label",{className:"checkbox-label",children:[(0,ze.jsx)("input",{type:"checkbox",checked:C.amenities.includes(e.value),onChange:t=>{t.target.checked?E(Le(Le({},C),{},{amenities:[...C.amenities,e.value]})):E(Le(Le({},C),{},{amenities:C.amenities.filter(t=>t!==e.value)}))}}),(0,ze.jsx)("span",{children:e.label})]},e.value))})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsx)("h3",{children:"Specifications"}),(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Manufacturer"}),(0,ze.jsx)("input",{type:"text",value:C.specifications.manufacturer,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{manufacturer:e.target.value})}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Model"}),(0,ze.jsx)("input",{type:"text",value:C.specifications.model,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{model:e.target.value})}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Year"}),(0,ze.jsx)("input",{type:"number",value:C.specifications.year,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{year:parseInt(e.target.value)})})),min:"1900",max:(new Date).getFullYear()+1})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Fuel Type"}),(0,ze.jsx)("select",{value:C.specifications.fuelType,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{fuelType:e.target.value})})),children:D.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]})]})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsx)("h3",{children:"Staff Assignment"}),(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Assigned Driver"}),(0,ze.jsxs)("select",{value:C.assignedDriver,onChange:e=>E(Le(Le({},C),{},{assignedDriver:e.target.value})),disabled:k,children:[(0,ze.jsx)("option",{value:"",children:"Select Driver"}),w.map(e=>{var t;return(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.driverId,") - ",(null===(t=e.drivingLicense)||void 0===t?void 0:t.licenseType)||"N/A"]},e._id)})]}),k&&(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:"Loading drivers..."})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Assigned Conductor"}),(0,ze.jsxs)("select",{value:C.assignedConductor,onChange:e=>E(Le(Le({},C),{},{assignedConductor:e.target.value})),disabled:k,children:[(0,ze.jsx)("option",{value:"",children:"Select Conductor"}),N.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.conductorId,") - ",e.badgeNumber||"N/A"]},e._id))]}),k&&(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:"Loading conductors..."})]})]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes"}),(0,ze.jsx)("textarea",{value:C.notes,onChange:e=>E(Le(Le({},C),{},{notes:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{o(!1),R()},children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Add Bus"})]})]})]})}),l&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsxs)("h2",{children:["Edit Bus - ",null===h||void 0===h?void 0:h.busNumber]}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{c(!1),R()},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await rh("/api/depot/buses/".concat(h._id),{method:"PUT",body:JSON.stringify(C)});e.ok?(c(!1),R(),P()):alert(e.message||"Failed to update bus")}catch(t){console.error("Error updating bus:",t),alert("Failed to update bus")}},className:"bus-form",children:[(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Bus Number *"}),(0,ze.jsx)("input",{type:"text",value:C.busNumber,onChange:e=>E(Le(Le({},C),{},{busNumber:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Registration Number *"}),(0,ze.jsx)("input",{type:"text",value:C.registrationNumber,onChange:e=>E(Le(Le({},C),{},{registrationNumber:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Bus Type *"}),(0,ze.jsx)("select",{value:C.busType,onChange:e=>E(Le(Le({},C),{},{busType:e.target.value})),required:!0,children:A.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Total Capacity *"}),(0,ze.jsx)("input",{type:"number",value:C.capacity.total,onChange:e=>E(Le(Le({},C),{},{capacity:Le(Le({},C.capacity),{},{total:parseInt(e.target.value)})})),required:!0,min:"1"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Seater Capacity"}),(0,ze.jsx)("input",{type:"number",value:C.capacity.seater,onChange:e=>E(Le(Le({},C),{},{capacity:Le(Le({},C.capacity),{},{seater:parseInt(e.target.value)})})),min:"0"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Sleeper Capacity"}),(0,ze.jsx)("input",{type:"number",value:C.capacity.sleeper,onChange:e=>E(Le(Le({},C),{},{capacity:Le(Le({},C.capacity),{},{sleeper:parseInt(e.target.value)})})),min:"0"})]})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsx)("h3",{children:"Amenities"}),(0,ze.jsx)("div",{className:"amenities-grid",children:M.map(e=>(0,ze.jsxs)("label",{className:"checkbox-label",children:[(0,ze.jsx)("input",{type:"checkbox",checked:C.amenities.includes(e.value),onChange:t=>{t.target.checked?E(Le(Le({},C),{},{amenities:[...C.amenities,e.value]})):E(Le(Le({},C),{},{amenities:C.amenities.filter(t=>t!==e.value)}))}}),(0,ze.jsx)("span",{children:e.label})]},e.value))})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsx)("h3",{children:"Specifications"}),(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Manufacturer"}),(0,ze.jsx)("input",{type:"text",value:C.specifications.manufacturer,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{manufacturer:e.target.value})}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Model"}),(0,ze.jsx)("input",{type:"text",value:C.specifications.model,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{model:e.target.value})}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Year"}),(0,ze.jsx)("input",{type:"number",value:C.specifications.year,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{year:parseInt(e.target.value)})})),min:"1900",max:(new Date).getFullYear()+1})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Fuel Type"}),(0,ze.jsx)("select",{value:C.specifications.fuelType,onChange:e=>E(Le(Le({},C),{},{specifications:Le(Le({},C.specifications),{},{fuelType:e.target.value})})),children:D.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]})]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes"}),(0,ze.jsx)("textarea",{value:C.notes,onChange:e=>E(Le(Le({},C),{},{notes:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{c(!1),R()},children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Update Bus"})]})]})]})}),d&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content delete-modal",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"Delete Bus"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>u(!1),children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("div",{className:"delete-content",children:[(0,ze.jsx)("div",{className:"delete-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,ze.jsx)("h3",{children:"Are you sure you want to delete this bus?"}),(0,ze.jsxs)("p",{children:['This action cannot be undone. The bus "',null===h||void 0===h?void 0:h.busNumber,'" will be permanently removed from your fleet.']}),(0,ze.jsxs)("div",{className:"bus-details",children:[(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Bus Number:"}),(0,ze.jsx)("span",{className:"value",children:null===h||void 0===h?void 0:h.busNumber})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Registration:"}),(0,ze.jsx)("span",{className:"value",children:null===h||void 0===h?void 0:h.registrationNumber})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Type:"}),(0,ze.jsx)("span",{className:"value",children:O(null===h||void 0===h?void 0:h.busType)})]})]})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>u(!1),children:"Cancel"}),(0,ze.jsx)("button",{type:"button",className:"btn-danger",onClick:async()=>{try{const e=await rh("/api/depot/buses/".concat(h._id),{method:"DELETE"});e.ok?(u(!1),p(null),P()):alert(e.message||"Failed to delete bus")}catch(e){console.error("Error deleting bus:",e),alert("Failed to delete bus")}},children:"Delete Bus"})]})]})})]})},jm=()=>{const{user:e}=Fe(),[t,n]=(0,i.useState)([]),[r,s]=(0,i.useState)(!0),[a,o]=(0,i.useState)(!1),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),[m,f]=(0,i.useState)(""),[g,x]=(0,i.useState)("all"),[y,v]=(0,i.useState)({totalRoutes:0,activeRoutes:0,inactiveRoutes:0,totalDistance:0}),[_,b]=(0,i.useState)({routeNumber:"",routeName:"",startingPoint:"",endingPoint:"",totalDistance:0,estimatedDuration:0,intermediateStops:[],baseFare:0,features:[],notes:""}),w=[{value:"ac",label:"Air Conditioned"},{value:"express",label:"Express Service"},{value:"night",label:"Night Service"},{value:"premium",label:"Premium Service"},{value:"accessible",label:"Wheelchair Accessible"},{value:"wifi",label:"WiFi Available"}];(0,i.useEffect)(()=>{j()},[]);const j=async()=>{try{s(!0);const t=await rh("/api/depot/routes");if(t.ok){var e;const i=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data,r=Array.isArray(i)?i:null===i||void 0===i?void 0:i.routes,s=Array.isArray(i)?{}:(null===i||void 0===i?void 0:i.stats)||{};n(r||[]),v(s)}}catch(t){console.error("Error fetching routes:",t)}finally{s(!1)}},N=()=>{b({routeNumber:"",routeName:"",startingPoint:"",endingPoint:"",totalDistance:0,estimatedDuration:0,intermediateStops:[],baseFare:0,features:[],notes:""})},S=()=>{b(Le(Le({},_),{},{intermediateStops:[..._.intermediateStops,{name:"",distance:0}]}))},k=e=>{const t=_.intermediateStops.filter((t,n)=>n!==e);b(Le(Le({},_),{},{intermediateStops:t}))},T=(e,t,n)=>{const i=[..._.intermediateStops];i[e]=Le(Le({},i[e]),{},{[t]:n}),b(Le(Le({},_),{},{intermediateStops:i}))},C=t.filter(e=>{const t=e.routeNumber.toLowerCase().includes(m.toLowerCase())||e.routeName.toLowerCase().includes(m.toLowerCase())||e.startingPoint.toLowerCase().includes(m.toLowerCase())||e.endingPoint.toLowerCase().includes(m.toLowerCase()),n="all"===g||e.status===g;return t&&n}),E=e=>{switch(e){case"active":return"green";case"inactive":return"red";case"maintenance":return"orange";default:return"gray"}},A=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,"h ").concat(n,"m")};return r?(0,ze.jsxs)("div",{className:"route-loading",children:[(0,ze.jsx)("div",{className:"loading-spinner"}),(0,ze.jsx)("h3",{children:"Loading Route Network..."})]}):(0,ze.jsxs)("div",{className:"route-network",children:[(0,ze.jsxs)("div",{className:"dashboard-header",children:[(0,ze.jsxs)("div",{className:"header-left",children:[(0,ze.jsx)("h1",{children:"Route Network"}),(0,ze.jsx)("p",{children:"Manage your depot's route network, stops, and fare structures"})]}),(0,ze.jsx)("div",{className:"header-actions",children:(0,ze.jsxs)("button",{className:"action-btn",onClick:()=>o(!0),children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Add New Route"]})})]}),(0,ze.jsx)("div",{className:"kpi-section",children:(0,ze.jsxs)("div",{className:"kpi-grid",children:[(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:y.totalRoutes}),(0,ze.jsx)("div",{className:"kpi-label",children:"Total Routes"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:y.activeRoutes}),(0,ze.jsx)("div",{className:"kpi-label",children:"Active Routes"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:y.inactiveRoutes}),(0,ze.jsx)("div",{className:"kpi-label",children:"Inactive Routes"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-value",children:[y.totalDistance," km"]}),(0,ze.jsx)("div",{className:"kpi-label",children:"Total Distance"})]})]})]})}),(0,ze.jsxs)("div",{className:"search-section",children:[(0,ze.jsxs)("div",{className:"search-input-wrapper",children:[(0,ze.jsx)("svg",{className:"search-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414L10.89 9.89A6 6 0 012 8z",clipRule:"evenodd"})}),(0,ze.jsx)("input",{type:"text",placeholder:"Search routes, stops, or destinations...",value:m,onChange:e=>f(e.target.value),className:"search-input"})]}),(0,ze.jsx)("div",{className:"filter-controls",children:(0,ze.jsxs)("select",{value:g,onChange:e=>x(e.target.value),className:"filter-select",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"})]})})]}),(0,ze.jsx)("div",{className:"table-section",children:(0,ze.jsxs)("div",{className:"table-container",children:[(0,ze.jsxs)("table",{className:"data-table",children:[(0,ze.jsx)("thead",{children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{children:"Route Number"}),(0,ze.jsx)("th",{children:"Route Name"}),(0,ze.jsx)("th",{children:"Start - End"}),(0,ze.jsx)("th",{children:"Distance"}),(0,ze.jsx)("th",{children:"Duration"}),(0,ze.jsx)("th",{children:"Base Fare"}),(0,ze.jsx)("th",{children:"Status"}),(0,ze.jsx)("th",{children:"Actions"})]})}),(0,ze.jsx)("tbody",{children:C.map(e=>{var t,n,i,r;return(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"route-info",children:[(0,ze.jsx)("div",{className:"route-number",children:e.routeNumber}),(0,ze.jsxs)("div",{className:"route-id",children:["ID: ",e._id.slice(-6)]})]})}),(0,ze.jsxs)("td",{children:[(0,ze.jsx)("div",{className:"route-name",children:e.routeName}),(0,ze.jsx)("div",{className:"route-features",children:null===(t=e.features)||void 0===t?void 0:t.slice(0,2).map(e=>(0,ze.jsx)("span",{className:"feature-badge",children:e},e))})]}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"route-endpoints",children:[(0,ze.jsx)("div",{className:"start-point",children:null===(n=e.startingPoint)||void 0===n?void 0:n.city}),(0,ze.jsx)("div",{className:"end-point",children:null===(i=e.endingPoint)||void 0===i?void 0:i.city})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"distance-info",children:[(0,ze.jsxs)("span",{className:"distance-value",children:[e.totalDistance,"km"]}),(0,ze.jsxs)("span",{className:"stops-count",children:[(null===(r=e.intermediateStops)||void 0===r?void 0:r.length)||0," stops"]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("div",{className:"duration-info",children:A(e.estimatedDuration)})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"fare-info",children:["\u20b9",e.baseFare]})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("span",{className:"status-badge ".concat(E(e.status)),children:e.status})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"action-buttons",children:[(0,ze.jsx)("button",{className:"action-btn view",onClick:()=>(e=>{p(e),b({routeNumber:e.routeNumber,routeName:e.routeName,startingPoint:e.startingPoint,endingPoint:e.endingPoint,totalDistance:e.totalDistance,estimatedDuration:e.estimatedDuration,intermediateStops:e.intermediateStops||[],baseFare:e.baseFare,features:e.features||[],notes:e.notes||""}),c(!0)})(e),title:"View/Edit",children:(0,ze.jsxs)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,ze.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})}),(0,ze.jsx)("button",{className:"action-btn delete",onClick:()=>(e=>{p(e),u(!0)})(e),title:"Delete",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})]},e._id)})})]}),0===C.length&&(0,ze.jsxs)("div",{className:"no-data",children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,ze.jsx)("h3",{children:"No routes found"}),(0,ze.jsx)("p",{children:"Try adjusting your search or filters"})]})]})}),a&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"Add New Route"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{o(!1),N()},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await rh("/api/depot/routes",{method:"POST",body:JSON.stringify(_)});e.ok?(o(!1),N(),j()):alert(e.message||"Failed to add route")}catch(t){console.error("Error adding route:",t),alert("Failed to add route")}},className:"route-form",children:[(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Route Number *"}),(0,ze.jsx)("input",{type:"text",value:_.routeNumber,onChange:e=>b(Le(Le({},_),{},{routeNumber:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Route Name *"}),(0,ze.jsx)("input",{type:"text",value:_.routeName,onChange:e=>b(Le(Le({},_),{},{routeName:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Starting Point *"}),(0,ze.jsx)("input",{type:"text",value:_.startingPoint,onChange:e=>b(Le(Le({},_),{},{startingPoint:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Ending Point *"}),(0,ze.jsx)("input",{type:"text",value:_.endingPoint,onChange:e=>b(Le(Le({},_),{},{endingPoint:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Total Distance (km) *"}),(0,ze.jsx)("input",{type:"number",value:_.totalDistance,onChange:e=>{const t=e.target.value,n=""===t?0:Number(t);b(Le(Le({},_),{},{totalDistance:Number.isFinite(n)?n:0}))},required:!0,min:"0",step:"0.1"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Estimated Duration (minutes) *"}),(0,ze.jsx)("input",{type:"number",value:_.estimatedDuration,onChange:e=>{const t=e.target.value,n=""===t?0:parseInt(t,10);b(Le(Le({},_),{},{estimatedDuration:Number.isFinite(n)?n:0}))},required:!0,min:"0"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Base Fare (\u20b9) *"}),(0,ze.jsx)("input",{type:"number",value:_.baseFare,onChange:e=>{const t=e.target.value,n=""===t?0:Number(t);b(Le(Le({},_),{},{baseFare:Number.isFinite(n)?n:0}))},required:!0,min:"0",step:"0.01"})]})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsx)("h3",{children:"Route Features"}),(0,ze.jsx)("div",{className:"features-grid",children:w.map(e=>(0,ze.jsxs)("label",{className:"checkbox-label",children:[(0,ze.jsx)("input",{type:"checkbox",checked:_.features.includes(e.value),onChange:t=>{t.target.checked?b(Le(Le({},_),{},{features:[..._.features,e.value]})):b(Le(Le({},_),{},{features:_.features.filter(t=>t!==e.value)}))}}),(0,ze.jsx)("span",{children:e.label})]},e.value))})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsxs)("div",{className:"section-header",children:[(0,ze.jsx)("h3",{children:"Intermediate Stops"}),(0,ze.jsxs)("button",{type:"button",className:"add-stop-btn",onClick:S,children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Add Stop"]})]}),_.intermediateStops.map((e,t)=>(0,ze.jsxs)("div",{className:"stop-item",children:[(0,ze.jsxs)("div",{className:"stop-inputs",children:[(0,ze.jsx)("input",{type:"text",placeholder:"Stop name",value:e.name,onChange:e=>T(t,"name",e.target.value)}),(0,ze.jsx)("input",{type:"number",placeholder:"Distance from start (km)",value:e.distance,onChange:e=>{const n=e.target.value,i=""===n?0:Number(n);T(t,"distance",Number.isFinite(i)?i:0)},min:"0",step:"0.1"})]}),(0,ze.jsx)("button",{type:"button",className:"remove-stop-btn",onClick:()=>k(t),children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t))]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes"}),(0,ze.jsx)("textarea",{value:_.notes,onChange:e=>b(Le(Le({},_),{},{notes:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{o(!1),N()},children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Add Route"})]})]})]})}),l&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsxs)("h2",{children:["Edit Route - ",null===h||void 0===h?void 0:h.routeNumber]}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{c(!1),N()},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await rh("/api/depot/routes/".concat(h._id),{method:"PUT",body:JSON.stringify(_)});e.ok?(c(!1),N(),j()):alert(e.message||"Failed to update route")}catch(t){console.error("Error updating route:",t),alert("Failed to update route")}},className:"route-form",children:[(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Route Number *"}),(0,ze.jsx)("input",{type:"text",value:_.routeNumber,onChange:e=>b(Le(Le({},_),{},{routeNumber:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Route Name *"}),(0,ze.jsx)("input",{type:"text",value:_.routeName,onChange:e=>b(Le(Le({},_),{},{routeName:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Starting Point *"}),(0,ze.jsx)("input",{type:"text",value:_.startingPoint,onChange:e=>b(Le(Le({},_),{},{startingPoint:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Ending Point *"}),(0,ze.jsx)("input",{type:"text",value:_.endingPoint,onChange:e=>b(Le(Le({},_),{},{endingPoint:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Total Distance (km) *"}),(0,ze.jsx)("input",{type:"number",value:_.totalDistance,onChange:e=>{const t=e.target.value,n=""===t?0:Number(t);b(Le(Le({},_),{},{totalDistance:Number.isFinite(n)?n:0}))},required:!0,min:"0",step:"0.1"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Estimated Duration (minutes) *"}),(0,ze.jsx)("input",{type:"number",value:_.estimatedDuration,onChange:e=>{const t=e.target.value,n=""===t?0:parseInt(t,10);b(Le(Le({},_),{},{estimatedDuration:Number.isFinite(n)?n:0}))},required:!0,min:"0"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Base Fare (\u20b9) *"}),(0,ze.jsx)("input",{type:"number",value:_.baseFare,onChange:e=>{const t=e.target.value,n=""===t?0:Number(t);b(Le(Le({},_),{},{baseFare:Number.isFinite(n)?n:0}))},required:!0,min:"0",step:"0.01"})]})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsx)("h3",{children:"Route Features"}),(0,ze.jsx)("div",{className:"features-grid",children:w.map(e=>(0,ze.jsxs)("label",{className:"checkbox-label",children:[(0,ze.jsx)("input",{type:"checkbox",checked:_.features.includes(e.value),onChange:t=>{t.target.checked?b(Le(Le({},_),{},{features:[..._.features,e.value]})):b(Le(Le({},_),{},{features:_.features.filter(t=>t!==e.value)}))}}),(0,ze.jsx)("span",{children:e.label})]},e.value))})]}),(0,ze.jsxs)("div",{className:"form-section",children:[(0,ze.jsxs)("div",{className:"section-header",children:[(0,ze.jsx)("h3",{children:"Intermediate Stops"}),(0,ze.jsxs)("button",{type:"button",className:"add-stop-btn",onClick:S,children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Add Stop"]})]}),_.intermediateStops.map((e,t)=>(0,ze.jsxs)("div",{className:"stop-item",children:[(0,ze.jsxs)("div",{className:"stop-inputs",children:[(0,ze.jsx)("input",{type:"text",placeholder:"Stop name",value:e.name,onChange:e=>T(t,"name",e.target.value)}),(0,ze.jsx)("input",{type:"number",placeholder:"Distance from start (km)",value:e.distance,onChange:e=>{const n=e.target.value,i=""===n?0:Number(n);T(t,"distance",Number.isFinite(i)?i:0)},min:"0",step:"0.1"})]}),(0,ze.jsx)("button",{type:"button",className:"remove-stop-btn",onClick:()=>k(t),children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t))]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes"}),(0,ze.jsx)("textarea",{value:_.notes,onChange:e=>b(Le(Le({},_),{},{notes:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{c(!1),N()},children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Update Route"})]})]})]})}),d&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content delete-modal",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"Delete Route"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>u(!1),children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("div",{className:"delete-content",children:[(0,ze.jsx)("div",{className:"delete-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,ze.jsx)("h3",{children:"Are you sure you want to delete this route?"}),(0,ze.jsxs)("p",{children:['This action cannot be undone. The route "',null===h||void 0===h?void 0:h.routeNumber,'" will be permanently removed from your network.']}),(0,ze.jsxs)("div",{className:"route-details",children:[(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Route Number:"}),(0,ze.jsx)("span",{className:"value",children:null===h||void 0===h?void 0:h.routeNumber})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Route Name:"}),(0,ze.jsx)("span",{className:"value",children:null===h||void 0===h?void 0:h.routeName})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Distance:"}),(0,ze.jsxs)("span",{className:"value",children:[null===h||void 0===h?void 0:h.totalDistance,"km"]})]})]})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>u(!1),children:"Cancel"}),(0,ze.jsx)("button",{type:"button",className:"btn-danger",onClick:async()=>{try{const e=await rh("/api/depot/routes/".concat(h._id),{method:"DELETE"});e.ok?(u(!1),p(null),j()):alert(e.message||"Failed to delete route")}catch(e){console.error("Error deleting route:",e),alert("Failed to delete route")}},children:"Delete Route"})]})]})})]})};var Nm=n(1899),Sm=n.n(Nm);const km=()=>{var e,t,n,r,s,a,o,l,c,d,u,h,p;const{user:m}=Fe(),f=(0,i.useRef)(null),[g,x]=(0,i.useState)([]),[y,v]=(0,i.useState)([]),[_,b]=(0,i.useState)([]),[w,j]=(0,i.useState)([]),[N,S]=(0,i.useState)([]),[k,T]=(0,i.useState)(!0),[C,E]=(0,i.useState)(!1),[A,M]=(0,i.useState)(!1),[D,I]=(0,i.useState)(!1),[P,R]=(0,i.useState)(null),[L,z]=(0,i.useState)(""),[O,F]=(0,i.useState)("all"),[B,V]=(0,i.useState)("all"),[U,H]=(0,i.useState)([null,null]),[q,W]=U,[G,Y]=(0,i.useState)([]),[Z,X]=(0,i.useState)(null),[K,Q]=(0,i.useState)(null),[J,$]=(0,i.useState)(1),[ee,te]=(0,i.useState)(""),[ne,ie]=(0,i.useState)([]),[re,se]=(0,i.useState)({totalTrips:0,activeTrips:0,completedTrips:0,cancelledTrips:0,totalRevenue:0,onTimePercentage:0,busUtilizationRate:0}),[ae,oe]=(0,i.useState)({routeId:"",busId:"",driverId:"",conductorId:"",departureTime:"",arrivalTime:"",fare:0,notes:""}),le=[{value:"scheduled",label:"Scheduled"},{value:"running",label:"Running"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"},{value:"delayed",label:"Delayed"}];(0,i.useEffect)(()=>{ce(),f.current=hm("http://localhost:5000"),f.current.on("tripStatusUpdate",e=>{x(t=>t.map(t=>t._id===e.tripId?Le(Le({},t),{},{status:e.status}):t))}),f.current.on("tripCreated",e=>{x(t=>[e,...t])}),f.current.on("tripUpdated",e=>{x(t=>t.map(t=>t._id===e._id?e:t))}),f.current.on("tripDeleted",e=>{x(t=>t.filter(t=>t._id!==e))});const e=setInterval(ce,3e4);return()=>{clearInterval(e),f.current&&f.current.disconnect()}},[]),(0,i.useEffect)(()=>{ie(ee?_.filter(e=>e.routeName.toLowerCase().includes(ee.toLowerCase())||e.routeNumber.toLowerCase().includes(ee.toLowerCase())):_)},[ee,_]);const ce=async()=>{try{T(!0);const[n,i,r,s,a]=await Promise.all([fetch("/api/depot/trips",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch("/api/depot/buses",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch("/api/depot/routes",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch("/api/driver/all",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch("/api/conductor/all",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})]);if(n.ok){const e=await n.json(),t=(e.data.trips||[]).filter(e=>e&&e._id&&e.status&&!["deleted","archived"].includes(e.status.toLowerCase()));x(t),se(e.data.stats||{})}if(i.ok){const e=await i.json();v(e.data.buses||[])}if(r.ok){const e=await r.json();b(e.data.routes||[])}if(s.ok){var e;const t=await s.json();j(Array.isArray(t.data)?t.data:(null===(e=t.data)||void 0===e?void 0:e.drivers)||[])}if(a.ok){var t;const e=await a.json();S(Array.isArray(e.data)?e.data:(null===(t=e.data)||void 0===t?void 0:t.conductors)||[])}}catch(n){console.error("Error fetching data:",n)}finally{T(!1)}},de=()=>{oe({routeId:"",busId:"",driverId:"",conductorId:"",departureTime:"",arrivalTime:"",fare:0,notes:""})},ue=g.filter(e=>{var t,n,i,r,s,a,o;const l=(null===(t=e.tripNumber)||void 0===t?void 0:t.toLowerCase().includes(L.toLowerCase()))||(null===(n=e.routeId)||void 0===n||null===(i=n.routeNumber)||void 0===i?void 0:i.toLowerCase().includes(L.toLowerCase()))||(null===(r=e.busId)||void 0===r||null===(s=r.busNumber)||void 0===s?void 0:s.toLowerCase().includes(L.toLowerCase()))||(null===(a=e.driverId)||void 0===a||null===(o=a.name)||void 0===o?void 0:o.toLowerCase().includes(L.toLowerCase())),c="all"===O||e.status===O,d="all"===B||(()=>{if(!e.departureTime)return!1;const t=new Date(e.departureTime);if(isNaN(t.getTime()))return!1;const n=t.toDateString(),i=(new Date).toDateString(),r=new Date(Date.now()+864e5).toDateString();switch(B){case"today":return n===i;case"tomorrow":return n===r;case"this-week":return t>=new Date(Date.now()-6048e5);default:return!0}})(),u=!q||!W||(()=>{if(!e.departureTime)return!1;const t=new Date(e.departureTime);return!isNaN(t.getTime())&&(t>=q&&t<=W)})();return l&&c&&d&&u}),he=e=>{switch(e){case"scheduled":return"blue";case"running":return"green";case"completed":return"purple";case"cancelled":return"red";case"delayed":return"orange";default:return"gray"}},pe=e=>{if(!e)return"Not set";const t=new Date(e);return isNaN(t.getTime())?"Invalid date":t.toLocaleString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},me=e=>{var t;return(null===(t=le.find(t=>t.value===e))||void 0===t?void 0:t.label)||e},fe=(e,t)=>{X(e),Q(t)},ge=async(e,t,n)=>{try{if("fare"===t&&(n<=0||isNaN(n)))return void alert("Please enter a valid fare amount");if("departureTime"===t||"arrivalTime"===t){if(!n)return void alert("Please select a valid date and time");const i=g.find(t=>t._id===e);if(i){const e="departureTime"===t?n:i.departureTime,r="arrivalTime"===t?n:i.arrivalTime;if(e&&r&&new Date(e)>=new Date(r))return void alert("Arrival time must be after departure time")}}let i=n;"departureTime"===t||"arrivalTime"===t?i=n.toISOString():"fare"===t&&(i=parseFloat(n));const r=await fetch("/api/depot/trips/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({[t]:i})});if(r.ok){const t=await r.json();x(n=>n.map(n=>n._id===e?t.data||t:n)),X(null),Q(null),f.current&&f.current.emit("tripUpdated",t.data||t)}else{const e=await r.json();alert(e.message||"Failed to update trip")}}catch(i){console.error("Error updating trip:",i),alert("Failed to update trip")}},xe=()=>{const e=g.filter(e=>["scheduled","running"].includes(e.status)).map(e=>{var t;return null===(t=e.busId)||void 0===t?void 0:t._id});return y.filter(t=>!e.includes(t._id)&&"active"===t.status)},ye=()=>{const e=g.filter(e=>["scheduled","running"].includes(e.status)).map(e=>{var t;return null===(t=e.driverId)||void 0===t?void 0:t._id});return w.filter(t=>!e.includes(t._id)&&"active"===t.status)},ve=()=>{const e=g.filter(e=>["scheduled","running"].includes(e.status)).map(e=>{var t;return null===(t=e.conductorId)||void 0===t?void 0:t._id});return N.filter(t=>!e.includes(t._id)&&"active"===t.status)},_e=e=>{if(!e.departureTime||!e.arrivalTime)return 0;const t=new Date,n=new Date(e.departureTime),i=new Date(e.arrivalTime);if(isNaN(n.getTime())||isNaN(i.getTime()))return 0;if(t<n)return 0;if(t>i)return 100;const r=i-n,s=t-n;return Math.round(s/r*100)};return k?(0,ze.jsxs)("div",{className:"trip-loading",children:[(0,ze.jsx)("div",{className:"loading-spinner"}),(0,ze.jsx)("h3",{children:"Loading Trip Management..."})]}):(0,ze.jsxs)("div",{className:"trip-management",children:[(0,ze.jsxs)("div",{className:"dashboard-header",children:[(0,ze.jsxs)("div",{className:"header-left",children:[(0,ze.jsx)("h1",{children:"Trip Management"}),(0,ze.jsx)("p",{children:"Schedule, monitor, and manage all depot trips in real-time"})]}),(0,ze.jsxs)("div",{className:"header-actions",children:[(0,ze.jsxs)("button",{className:"action-btn refresh",onClick:ce,title:"Refresh Data",children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"Refresh"]}),(0,ze.jsxs)("button",{className:"action-btn",onClick:()=>E(!0),children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Schedule New Trip"]})]})]}),(0,ze.jsxs)("div",{className:"search-section",children:[(0,ze.jsxs)("div",{className:"search-input-wrapper",children:[(0,ze.jsx)("svg",{className:"search-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414L10.89 9.89A6 6 0 012 8z",clipRule:"evenodd"})}),(0,ze.jsx)("input",{type:"text",placeholder:"Search trips, routes, buses, or drivers...",value:L,onChange:e=>z(e.target.value),className:"search-input"})]}),(0,ze.jsxs)("div",{className:"filter-controls",children:[(0,ze.jsxs)("select",{value:O,onChange:e=>F(e.target.value),className:"filter-select",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),le.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,ze.jsxs)("select",{value:B,onChange:e=>V(e.target.value),className:"filter-select",children:[(0,ze.jsx)("option",{value:"all",children:"All Dates"}),(0,ze.jsx)("option",{value:"today",children:"Today"}),(0,ze.jsx)("option",{value:"tomorrow",children:"Tomorrow"}),(0,ze.jsx)("option",{value:"this-week",children:"This Week"})]}),(0,ze.jsx)(Sm(),{selectsRange:!0,startDate:q,endDate:W,onChange:e=>{H(e)},isClearable:!0,placeholderText:"Select date range",className:"date-range-picker"}),(0,ze.jsxs)("div",{className:"export-buttons",children:[(0,ze.jsxs)("button",{onClick:()=>{const e=ue.map(e=>{var t,n,i,r;return{"Trip Number":e.tripNumber,Route:null===(t=e.routeId)||void 0===t?void 0:t.routeName,Bus:null===(n=e.busId)||void 0===n?void 0:n.busNumber,Driver:null===(i=e.driverId)||void 0===i?void 0:i.name,Conductor:null===(r=e.conductorId)||void 0===r?void 0:r.name,Departure:pe(e.departureTime),Arrival:pe(e.arrivalTime),Fare:e.fare,Status:me(e.status)}}),t=[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).join(","))].join("\n"),n=new Blob([t],{type:"text/csv"}),i=window.URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download="trips-export.csv",r.click(),window.URL.revokeObjectURL(i)},className:"export-btn excel",children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Excel"]}),(0,ze.jsxs)("button",{onClick:()=>{window.print()},className:"export-btn pdf",children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}),"PDF"]})]})]})]}),G.length>0&&(0,ze.jsxs)("div",{className:"bulk-actions",children:[(0,ze.jsx)("div",{className:"bulk-info",children:(0,ze.jsxs)("span",{children:[G.length," trips selected"]})}),(0,ze.jsxs)("div",{className:"bulk-controls",children:[(0,ze.jsxs)("select",{onChange:e=>(async e=>{try{const t=G.map(t=>fetch("/api/depot/trips/".concat(t,"/status"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({status:e})}));await Promise.all(t),Y([]),ce()}catch(t){console.error("Error updating bulk status:",t)}})(e.target.value),className:"bulk-select",children:[(0,ze.jsx)("option",{value:"",children:"Change Status"}),le.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,ze.jsx)("button",{onClick:()=>Y([]),className:"clear-selection-btn",children:"Clear Selection"})]})]}),(0,ze.jsx)("div",{className:"table-section",children:(0,ze.jsxs)("div",{className:"table-container",children:[(0,ze.jsxs)("table",{className:"data-table",id:"trips-table",children:[(0,ze.jsx)("thead",{children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{children:(0,ze.jsx)("input",{type:"checkbox",checked:G.length===ue.length&&ue.length>0,onChange:e=>{e.target.checked?Y(ue.map(e=>e._id)):Y([])}})}),(0,ze.jsx)("th",{children:"Trip Number"}),(0,ze.jsx)("th",{children:"Route"}),(0,ze.jsx)("th",{children:"Bus"}),(0,ze.jsx)("th",{children:"Crew"}),(0,ze.jsx)("th",{children:"Schedule"}),(0,ze.jsx)("th",{children:"Status"}),(0,ze.jsx)("th",{children:"Progress"}),(0,ze.jsx)("th",{children:"Actions"})]})}),(0,ze.jsx)("tbody",{children:ue.map(e=>{var t,n,i,r,s,a,o,l,c,d,u,h,p,m,g;return(0,ze.jsxs)("tr",{className:G.includes(e._id)?"selected":"",children:[(0,ze.jsx)("td",{children:(0,ze.jsx)("input",{type:"checkbox",checked:G.includes(e._id),onChange:()=>{return t=e._id,void Y(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"trip-info",children:[(0,ze.jsx)("div",{className:"trip-number",children:e.tripNumber}),(0,ze.jsxs)("div",{className:"trip-id",children:["ID: ",e._id.slice(-6)]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"route-info",children:[(0,ze.jsx)("div",{className:"route-number",children:null===(t=e.routeId)||void 0===t?void 0:t.routeNumber}),(0,ze.jsx)("div",{className:"route-name",children:null===(n=e.routeId)||void 0===n?void 0:n.routeName}),(0,ze.jsxs)("div",{className:"route-endpoints",children:[null===(i=e.routeId)||void 0===i||null===(r=i.startingPoint)||void 0===r?void 0:r.city," \u2192 ",null===(s=e.routeId)||void 0===s||null===(a=s.endingPoint)||void 0===a?void 0:a.city]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("div",{className:"bus-info",children:Z===e._id&&"busId"===K?(0,ze.jsx)("select",{value:(null===(o=e.busId)||void 0===o?void 0:o._id)||"",onChange:t=>ge(e._id,"busId",t.target.value),onBlur:()=>X(null),autoFocus:!0,children:xe().map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.busNumber," - ",e.busType]},e._id))}):(0,ze.jsxs)("div",{onClick:()=>fe(e._id,"busId"),className:"editable",children:[(0,ze.jsx)("div",{className:"bus-number",children:null===(l=e.busId)||void 0===l?void 0:l.busNumber}),(0,ze.jsx)("div",{className:"bus-type",children:null===(c=e.busId)||void 0===c?void 0:c.busType}),(0,ze.jsxs)("div",{className:"bus-capacity",children:[null===(d=e.busId)||void 0===d||null===(u=d.capacity)||void 0===u?void 0:u.total," seats"]})]})})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"crew-info",children:[(0,ze.jsxs)("div",{className:"crew-driver",children:[(0,ze.jsx)("span",{className:"crew-label",children:"Driver:"}),Z===e._id&&"driverId"===K?(0,ze.jsxs)("select",{value:(null===(h=e.driverId)||void 0===h?void 0:h._id)||"",onChange:t=>ge(e._id,"driverId",t.target.value),onBlur:()=>X(null),autoFocus:!0,children:[(0,ze.jsx)("option",{value:"",children:"No Driver"}),ye().map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," - ",e.licenseNumber]},e._id))]}):(0,ze.jsx)("span",{className:"crew-name editable",onClick:()=>fe(e._id,"driverId"),children:(null===(p=e.driverId)||void 0===p?void 0:p.name)||"Not Assigned"})]}),(0,ze.jsxs)("div",{className:"crew-conductor",children:[(0,ze.jsx)("span",{className:"crew-label",children:"Conductor:"}),Z===e._id&&"conductorId"===K?(0,ze.jsxs)("select",{value:(null===(m=e.conductorId)||void 0===m?void 0:m._id)||"",onChange:t=>ge(e._id,"conductorId",t.target.value),onBlur:()=>X(null),autoFocus:!0,children:[(0,ze.jsx)("option",{value:"",children:"No Conductor"}),ve().map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," - ",e.employeeId]},e._id))]}):(0,ze.jsx)("span",{className:"crew-name editable",onClick:()=>fe(e._id,"conductorId"),children:(null===(g=e.conductorId)||void 0===g?void 0:g.name)||"Not Assigned"})]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"schedule-info",children:[(0,ze.jsxs)("div",{className:"departure-time",children:[(0,ze.jsx)("span",{className:"time-label",children:"Depart:"}),Z===e._id&&"departureTime"===K?(0,ze.jsx)(Sm(),{selected:e.departureTime?new Date(e.departureTime):null,onChange:t=>ge(e._id,"departureTime",t),showTimeSelect:!0,dateFormat:"Pp",onBlur:()=>X(null),autoFocus:!0}):(0,ze.jsx)("span",{className:"time-value editable",onClick:()=>fe(e._id,"departureTime"),children:e.departureTime?pe(e.departureTime):"Not set"})]}),(0,ze.jsxs)("div",{className:"arrival-time",children:[(0,ze.jsx)("span",{className:"time-label",children:"Arrive:"}),Z===e._id&&"arrivalTime"===K?(0,ze.jsx)(Sm(),{selected:e.arrivalTime?new Date(e.arrivalTime):null,onChange:t=>ge(e._id,"arrivalTime",t),showTimeSelect:!0,dateFormat:"Pp",onBlur:()=>X(null),autoFocus:!0}):(0,ze.jsx)("span",{className:"time-value editable",onClick:()=>fe(e._id,"arrivalTime"),children:e.arrivalTime?pe(e.arrivalTime):"Not set"})]}),(0,ze.jsx)("div",{className:"fare-info",children:Z===e._id&&"fare"===K?(0,ze.jsx)("input",{type:"number",value:e.fare,onChange:t=>ge(e._id,"fare",parseFloat(t.target.value)),onBlur:()=>X(null),autoFocus:!0}):(0,ze.jsxs)("span",{className:"editable",onClick:()=>fe(e._id,"fare"),children:["\u20b9",e.fare]})})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"status-section",children:[(0,ze.jsx)("span",{className:"status-badge ".concat(he(e.status)),children:me(e.status)}),(0,ze.jsx)("select",{value:e.status,onChange:t=>(async(e,t)=>{try{const n=await fetch("/api/depot/trips/".concat(e,"/status"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({status:t})});if(n.ok)ce();else{const e=await n.json();alert(e.message||"Failed to update trip status")}}catch(n){console.error("Error updating trip status:",n),alert("Failed to update trip status")}})(e._id,t.target.value),className:"status-select",children:le.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"progress-section",children:["running"===e.status&&(0,ze.jsxs)("div",{className:"progress-bar",children:[(0,ze.jsx)("div",{className:"progress-fill",style:{width:"".concat(_e(e),"%")}}),(0,ze.jsxs)("span",{className:"progress-text",children:[_e(e),"%"]})]}),"scheduled"===e.status&&(0,ze.jsxs)("div",{className:"progress-bar scheduled",children:[(0,ze.jsx)("div",{className:"progress-fill scheduled"}),(0,ze.jsx)("span",{className:"progress-text",children:"Scheduled"})]}),"completed"===e.status&&(0,ze.jsxs)("div",{className:"progress-bar completed",children:[(0,ze.jsx)("div",{className:"progress-fill completed"}),(0,ze.jsx)("span",{className:"progress-text",children:"Completed"})]}),"cancelled"===e.status&&(0,ze.jsxs)("div",{className:"progress-bar cancelled",children:[(0,ze.jsx)("div",{className:"progress-fill cancelled"}),(0,ze.jsx)("span",{className:"progress-text",children:"Cancelled"})]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"action-buttons",children:[(0,ze.jsx)("button",{className:"action-btn view",onClick:()=>(e=>{var t,n,i,r;R(e),oe({routeId:(null===(t=e.routeId)||void 0===t?void 0:t._id)||"",busId:(null===(n=e.busId)||void 0===n?void 0:n._id)||"",driverId:(null===(i=e.driverId)||void 0===i?void 0:i._id)||"",conductorId:(null===(r=e.conductorId)||void 0===r?void 0:r._id)||"",departureTime:e.departureTime?new Date(e.departureTime).toISOString().slice(0,16):"",arrivalTime:e.arrivalTime?new Date(e.arrivalTime).toISOString().slice(0,16):"",fare:e.fare||0,notes:e.notes||""}),M(!0)})(e),title:"View/Edit",children:(0,ze.jsxs)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,ze.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})}),(0,ze.jsx)("button",{className:"action-btn track",title:"Track Trip",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})}),("scheduled"===e.status||"running"===e.status)&&(0,ze.jsx)("button",{className:"action-btn cancel",onClick:()=>{window.confirm("Are you sure you want to cancel this trip?")&&(async e=>{try{const t=await fetch("/api/depot/trips/".concat(e,"/status"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({status:"cancelled"})});if(t.ok)x(t=>t.map(t=>t._id===e?Le(Le({},t),{},{status:"cancelled"}):t)),alert("Trip cancelled successfully!"),f.current&&f.current.emit("tripStatusUpdate",{tripId:e,status:"cancelled"});else{const e=await t.json();alert(e.message||"Failed to cancel trip")}}catch(t){console.error("Error cancelling trip:",t),alert("Failed to cancel trip")}})(e._id)},title:"Cancel Trip",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),(0,ze.jsx)("button",{className:"action-btn delete",onClick:()=>(e=>{R(e),I(!0)})(e),title:"Delete Trip",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})]},e._id)})})]}),0===ue.length&&(0,ze.jsxs)("div",{className:"no-data",children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),(0,ze.jsx)("h3",{children:"No trips found"}),(0,ze.jsx)("p",{children:"Try adjusting your search or filters"})]})]})}),(0,ze.jsx)("div",{className:"kpi-section",children:(0,ze.jsxs)("div",{className:"kpi-grid",children:[(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:re.totalTrips}),(0,ze.jsx)("div",{className:"kpi-label",children:"Total Trips"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:re.activeTrips}),(0,ze.jsx)("div",{className:"kpi-label",children:"Active Trips"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:re.completedTrips}),(0,ze.jsx)("div",{className:"kpi-label",children:"Completed"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsx)("div",{className:"kpi-value",children:re.cancelledTrips}),(0,ze.jsx)("div",{className:"kpi-label",children:"Cancelled"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-value",children:["\u20b9",null===(e=re.totalRevenue)||void 0===e?void 0:e.toLocaleString()]}),(0,ze.jsx)("div",{className:"kpi-label",children:"Total Revenue"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-value",children:[re.onTimePercentage,"%"]}),(0,ze.jsx)("div",{className:"kpi-label",children:"On-Time %"})]})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsx)("div",{className:"kpi-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-value",children:[re.busUtilizationRate,"%"]}),(0,ze.jsx)("div",{className:"kpi-label",children:"Bus Utilization"})]})]})]})}),(0,ze.jsx)("div",{className:"analytics-section",children:(0,ze.jsxs)("div",{className:"analytics-summary",children:[(0,ze.jsxs)("div",{className:"summary-card",children:[(0,ze.jsx)("h3",{children:"Trip Status Summary"}),(0,ze.jsxs)("div",{className:"status-summary",children:[(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("div",{className:"status-dot blue"}),(0,ze.jsxs)("span",{children:["Scheduled: ",re.totalTrips-re.activeTrips-re.completedTrips-re.cancelledTrips]})]}),(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("div",{className:"status-dot green"}),(0,ze.jsxs)("span",{children:["Active: ",re.activeTrips]})]}),(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("div",{className:"status-dot purple"}),(0,ze.jsxs)("span",{children:["Completed: ",re.completedTrips]})]}),(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("div",{className:"status-dot red"}),(0,ze.jsxs)("span",{children:["Cancelled: ",re.cancelledTrips]})]})]})]}),(0,ze.jsxs)("div",{className:"summary-card",children:[(0,ze.jsx)("h3",{children:"Performance Metrics"}),(0,ze.jsxs)("div",{className:"metrics-grid",children:[(0,ze.jsxs)("div",{className:"metric-item",children:[(0,ze.jsxs)("div",{className:"metric-value",children:[re.onTimePercentage,"%"]}),(0,ze.jsx)("div",{className:"metric-label",children:"On-Time Performance"})]}),(0,ze.jsxs)("div",{className:"metric-item",children:[(0,ze.jsxs)("div",{className:"metric-value",children:[re.busUtilizationRate,"%"]}),(0,ze.jsx)("div",{className:"metric-label",children:"Bus Utilization"})]})]})]})]})}),C&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"Schedule New Trip"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{E(!1),de(),$(1)},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("div",{className:"modal-step-indicator",children:[(0,ze.jsxs)("div",{className:"step ".concat(J>=1?1===J?"active":"completed":"pending"),children:[(0,ze.jsx)("div",{className:"step-number",children:"1"}),(0,ze.jsx)("span",{children:"Route"})]}),(0,ze.jsxs)("div",{className:"step ".concat(J>=2?2===J?"active":"completed":"pending"),children:[(0,ze.jsx)("div",{className:"step-number",children:"2"}),(0,ze.jsx)("span",{children:"Resources"})]}),(0,ze.jsxs)("div",{className:"step ".concat(J>=3?3===J?"active":"completed":"pending"),children:[(0,ze.jsx)("div",{className:"step-number",children:"3"}),(0,ze.jsx)("span",{children:"Schedule"})]}),(0,ze.jsxs)("div",{className:"step ".concat(J>=4?4===J?"active":"completed":"pending"),children:[(0,ze.jsx)("div",{className:"step-number",children:"4"}),(0,ze.jsx)("span",{children:"Fare"})]}),(0,ze.jsxs)("div",{className:"step ".concat(J>=5?5===J?"active":"completed":"pending"),children:[(0,ze.jsx)("div",{className:"step-number",children:"5"}),(0,ze.jsx)("span",{children:"Confirm"})]})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),ae.routeId)if(ae.busId)if(ae.driverId)if(ae.conductorId)if(ae.departureTime)if(ae.arrivalTime)if(ae.fare<=0)alert("Please enter a valid fare amount");else if(new Date(ae.departureTime)>=new Date(ae.arrivalTime))alert("Arrival time must be after departure time");else try{T(!0);const e=ae.departureTime?new Date(ae.departureTime):null,t=ae.arrivalTime?new Date(ae.arrivalTime):null,n=e=>e?"".concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0")):void 0,i=e=>e?"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0")):void 0,r={routeId:ae.routeId,busId:ae.busId,driverId:ae.driverId&&""!==ae.driverId.trim()?ae.driverId:void 0,conductorId:ae.conductorId&&""!==ae.conductorId.trim()?ae.conductorId:void 0,serviceDate:i(e),startTime:n(e),endTime:n(t),fare:ae.fare,notes:ae.notes,status:"scheduled"},s=await fetch("/api/depot/trips",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(r)});if(s.ok){const e=await s.json();x(t=>[e.data||e,...t]),E(!1),de(),$(1),alert("Trip created successfully!"),f.current&&f.current.emit("tripCreated",e.data||e)}else{const e=await s.json();console.error("Trip creation error:",e),alert("Failed to create trip: ".concat(e.message||"Unknown error"))}}catch(t){console.error("Error creating trip:",t),alert("Failed to create trip: ".concat(t.message))}finally{T(!1)}else alert("Please select arrival time");else alert("Please select departure time");else alert("Please select a conductor");else alert("Please select a driver");else alert("Please select a bus");else alert("Please select a route")},className:"trip-form",children:[1===J&&(0,ze.jsxs)("div",{className:"step-content",children:[(0,ze.jsx)("h3",{children:"Select Route"}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Search Route"}),(0,ze.jsxs)("div",{className:"route-search-container",children:[(0,ze.jsx)("input",{type:"text",placeholder:"Search routes by name or number...",value:ee,onChange:e=>te(e.target.value),className:"search-input"}),ee&&(0,ze.jsx)("div",{className:"route-suggestions",children:ne.slice(0,5).map(e=>{var t,n;return(0,ze.jsxs)("div",{className:"route-suggestion",onClick:()=>{oe(Le(Le({},ae),{},{routeId:e._id})),te(""),$(2)},children:[(0,ze.jsx)("div",{className:"route-number",children:e.routeNumber}),(0,ze.jsx)("div",{className:"route-name",children:e.routeName}),(0,ze.jsxs)("div",{className:"route-endpoints",children:[null===(t=e.startingPoint)||void 0===t?void 0:t.city," \u2192 ",null===(n=e.endingPoint)||void 0===n?void 0:n.city]})]},e._id)})})]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Or select from list"}),(0,ze.jsxs)("select",{value:ae.routeId,onChange:e=>oe(Le(Le({},ae),{},{routeId:e.target.value})),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Route"}),_.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.routeNumber," - ",e.routeName]},e._id))]})]})]}),2===J&&(0,ze.jsxs)("div",{className:"step-content",children:[(0,ze.jsx)("h3",{children:"Assign Resources"}),(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Available Bus *"}),(0,ze.jsxs)("select",{value:ae.busId,onChange:e=>oe(Le(Le({},ae),{},{busId:e.target.value})),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Bus"}),xe().map(e=>{var t;return(0,ze.jsxs)("option",{value:e._id,children:[e.busNumber," - ",e.busType," (",null===(t=e.capacity)||void 0===t?void 0:t.total," seats)"]},e._id)})]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Available Driver *"}),(0,ze.jsxs)("select",{value:ae.driverId,onChange:e=>oe(Le(Le({},ae),{},{driverId:e.target.value})),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Driver"}),ye().map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," - ",e.licenseNumber]},e._id))]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Available Conductor *"}),(0,ze.jsxs)("select",{value:ae.conductorId,onChange:e=>oe(Le(Le({},ae),{},{conductorId:e.target.value})),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Conductor"}),ve().map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," - ",e.employeeId]},e._id))]})]})]})]}),3===J&&(0,ze.jsxs)("div",{className:"step-content",children:[(0,ze.jsx)("h3",{children:"Set Schedule"}),(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Departure Date & Time *"}),(0,ze.jsx)(Sm(),{selected:ae.departureTime?new Date(ae.departureTime):null,onChange:e=>oe(Le(Le({},ae),{},{departureTime:e})),showTimeSelect:!0,dateFormat:"Pp",placeholderText:"Select departure time",minDate:new Date,required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Arrival Date & Time *"}),(0,ze.jsx)(Sm(),{selected:ae.arrivalTime?new Date(ae.arrivalTime):null,onChange:e=>oe(Le(Le({},ae),{},{arrivalTime:e})),showTimeSelect:!0,dateFormat:"Pp",placeholderText:"Select arrival time",minDate:ae.departureTime?new Date(ae.departureTime):new Date,required:!0})]})]})]}),4===J&&(0,ze.jsxs)("div",{className:"step-content",children:[(0,ze.jsx)("h3",{children:"Set Fare"}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Fare (\u20b9) *"}),(0,ze.jsx)("input",{type:"number",value:ae.fare,onChange:e=>oe(Le(Le({},ae),{},{fare:parseFloat(e.target.value)})),required:!0,min:"0",step:"0.01",placeholder:"Enter fare amount"}),(0,ze.jsx)("small",{children:"Fare is auto-filled based on route. You can modify if needed."})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes (Optional)"}),(0,ze.jsx)("textarea",{value:ae.notes,onChange:e=>oe(Le(Le({},ae),{},{notes:e.target.value})),rows:"3",placeholder:"Add any special notes or instructions..."})]})]}),5===J&&(0,ze.jsxs)("div",{className:"step-content",children:[(0,ze.jsx)("h3",{children:"Confirm Trip Details"}),(0,ze.jsxs)("div",{className:"confirmation-details",children:[(0,ze.jsxs)("div",{className:"detail-section",children:[(0,ze.jsx)("h4",{children:"Route Information"}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Route:"})," ",null===(t=_.find(e=>e._id===ae.routeId))||void 0===t?void 0:t.routeNumber," - ",null===(n=_.find(e=>e._id===ae.routeId))||void 0===n?void 0:n.routeName]}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"From:"})," ",null===(r=_.find(e=>e._id===ae.routeId))||void 0===r||null===(s=r.startingPoint)||void 0===s?void 0:s.city]}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"To:"})," ",null===(a=_.find(e=>e._id===ae.routeId))||void 0===a||null===(o=a.endingPoint)||void 0===o?void 0:o.city]})]}),(0,ze.jsxs)("div",{className:"detail-section",children:[(0,ze.jsx)("h4",{children:"Resources"}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Bus:"})," ",null===(l=y.find(e=>e._id===ae.busId))||void 0===l?void 0:l.busNumber," - ",null===(c=y.find(e=>e._id===ae.busId))||void 0===c?void 0:c.busType]}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Driver:"})," ",null===(d=w.find(e=>e._id===ae.driverId))||void 0===d?void 0:d.name]}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Conductor:"})," ",null===(u=N.find(e=>e._id===ae.conductorId))||void 0===u?void 0:u.name]})]}),(0,ze.jsxs)("div",{className:"detail-section",children:[(0,ze.jsx)("h4",{children:"Schedule & Fare"}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Departure:"})," ",ae.departureTime?new Date(ae.departureTime).toLocaleString():"Not set"]}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Arrival:"})," ",ae.arrivalTime?new Date(ae.arrivalTime).toLocaleString():"Not set"]}),(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Fare:"})," \u20b9",ae.fare]}),ae.notes&&(0,ze.jsxs)("p",{children:[(0,ze.jsx)("strong",{children:"Notes:"})," ",ae.notes]})]})]})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{J>1?$(J-1):(E(!1),de(),$(1))},children:J>1?"Previous":"Cancel"}),J<5?(0,ze.jsx)("button",{type:"button",className:"btn-primary",onClick:()=>{1===J&&ae.routeId?$(2):2===J&&ae.busId&&ae.driverId&&ae.conductorId?$(3):3===J&&ae.departureTime&&ae.arrivalTime?$(4):4===J&&ae.fare>0&&$(5)},children:"Next"}):(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Schedule Trip"})]})]})]})}),A&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsxs)("h2",{children:["Edit Trip - ",null===P||void 0===P?void 0:P.tripNumber]}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{M(!1),de()},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),ae.routeId)if(ae.busId)if(ae.departureTime)if(ae.arrivalTime)if(ae.fare<=0)alert("Please enter a valid fare amount");else if(new Date(ae.departureTime)>=new Date(ae.arrivalTime))alert("Arrival time must be after departure time");else try{T(!0);const e=ae.departureTime?new Date(ae.departureTime):null,t=ae.arrivalTime?new Date(ae.arrivalTime):null,n=e=>e?"".concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0")):void 0,i=e=>e?"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0")):void 0,r={routeId:ae.routeId,busId:ae.busId,driverId:ae.driverId&&""!==ae.driverId.trim()?ae.driverId:void 0,conductorId:ae.conductorId&&""!==ae.conductorId.trim()?ae.conductorId:void 0,serviceDate:i(e),startTime:n(e),endTime:n(t),fare:ae.fare,notes:ae.notes},s=await fetch("/api/depot/trips/".concat(P._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(r)});if(s.ok){const e=await s.json();x(t=>t.map(t=>t._id===P._id?e.data||e:t)),M(!1),de(),R(null),alert("Trip updated successfully!"),f.current&&f.current.emit("tripUpdated",e.data||e)}else{const e=await s.json();alert(e.message||"Failed to update trip")}}catch(t){console.error("Error updating trip:",t),alert("Failed to update trip")}finally{T(!1)}else alert("Please select arrival time");else alert("Please select departure time");else alert("Please select a bus");else alert("Please select a route")},className:"trip-form",children:[(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Route *"}),(0,ze.jsxs)("select",{value:ae.routeId,onChange:e=>oe(Le(Le({},ae),{},{routeId:e.target.value})),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Route"}),_.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.routeNumber," - ",e.routeName]},e._id))]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Bus *"}),(0,ze.jsxs)("select",{value:ae.busId,onChange:e=>oe(Le(Le({},ae),{},{busId:e.target.value})),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Bus"}),y.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.busNumber," - ",e.busType]},e._id))]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Driver (Optional)"}),(0,ze.jsxs)("select",{value:ae.driverId,onChange:e=>oe(Le(Le({},ae),{},{driverId:e.target.value})),children:[(0,ze.jsx)("option",{value:"",children:"No Driver Assigned"}),w.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," - ",e.licenseNumber]},e._id))]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Conductor (Optional)"}),(0,ze.jsxs)("select",{value:ae.conductorId,onChange:e=>oe(Le(Le({},ae),{},{conductorId:e.target.value})),children:[(0,ze.jsx)("option",{value:"",children:"No Conductor Assigned"}),N.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," - ",e.employeeId]},e._id))]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Departure Time *"}),(0,ze.jsx)("input",{type:"datetime-local",value:ae.departureTime,onChange:e=>oe(Le(Le({},ae),{},{departureTime:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Arrival Time *"}),(0,ze.jsx)("input",{type:"datetime-local",value:ae.arrivalTime,onChange:e=>oe(Le(Le({},ae),{},{arrivalTime:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Fare (\u20b9) *"}),(0,ze.jsx)("input",{type:"number",value:ae.fare,onChange:e=>oe(Le(Le({},ae),{},{fare:parseFloat(e.target.value)})),required:!0,min:"0",step:"0.01"})]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes"}),(0,ze.jsx)("textarea",{value:ae.notes,onChange:e=>oe(Le(Le({},ae),{},{notes:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{M(!1),de()},children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Update Trip"})]})]})]})}),D&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content delete-modal",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"\u26a0\ufe0f Permanent Delete Trip"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>I(!1),children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("div",{className:"delete-content",children:[(0,ze.jsx)("div",{className:"delete-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,ze.jsx)("h3",{children:"\u26a0\ufe0f WARNING: This action cannot be undone!"}),(0,ze.jsx)("p",{children:(0,ze.jsx)("strong",{children:"You are about to permanently delete this trip from the system."})}),(0,ze.jsxs)("p",{children:['The trip "',null===P||void 0===P?void 0:P.tripNumber,'" will be completely removed and cannot be recovered.']}),(0,ze.jsxs)("div",{className:"trip-details",children:[(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Trip Number:"}),(0,ze.jsx)("span",{className:"value",children:null===P||void 0===P?void 0:P.tripNumber})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Route:"}),(0,ze.jsx)("span",{className:"value",children:null===P||void 0===P||null===(h=P.routeId)||void 0===h?void 0:h.routeNumber})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Bus:"}),(0,ze.jsx)("span",{className:"value",children:null===P||void 0===P||null===(p=P.busId)||void 0===p?void 0:p.busNumber})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Status:"}),(0,ze.jsx)("span",{className:"value",children:me(null===P||void 0===P?void 0:P.status)})]})]})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>I(!1),children:"Cancel"}),(0,ze.jsx)("button",{type:"button",className:"btn-danger permanent-delete-btn",onClick:async()=>{var e,t,n,i;if(!P)return;if("running"===P.status)return void alert("Cannot delete a trip that is currently running. Please cancel it first.");if(window.confirm("Are you sure you want to PERMANENTLY DELETE this trip?\n\n"+"Route: ".concat(null===(e=P.routeId)||void 0===e||null===(t=e.startingPoint)||void 0===t?void 0:t.city," \u2192 ").concat(null===(n=P.routeId)||void 0===n||null===(i=n.endingPoint)||void 0===i?void 0:i.city,"\n")+"Date: ".concat(pe(P.departureTime),"\n\n")+"This action cannot be undone!"))try{T(!0);const e=await fetch("/api/depot/trips/".concat(P._id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok)x(e=>e.filter(e=>e._id!==P._id)),I(!1),R(null),alert("Trip permanently deleted!"),f.current&&f.current.emit("tripDeleted",P._id),setTimeout(()=>{ce()},1e3);else{const t=await e.json();alert(t.message||"Failed to delete trip")}}catch(r){console.error("Error deleting trip:",r),alert("Failed to delete trip")}finally{T(!1)}},children:"\ud83d\uddd1\ufe0f Delete Permanently"})]})]})})]})},Tm=()=>{const{user:e}=Fe(),[t,n]=(0,i.useState)([]),[,r]=(0,i.useState)([]),[,s]=(0,i.useState)([]),[a,o]=(0,i.useState)(!0),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!1),[m,f]=(0,i.useState)(null),[g,x]=(0,i.useState)(""),[y,v]=(0,i.useState)("all"),[_,b]=(0,i.useState)("all"),[w,j]=(0,i.useState)("drivers"),[N,S]=(0,i.useState)({totalDrivers:0,activeDrivers:0,totalConductors:0,activeConductors:0}),[k,T]=(0,i.useState)({name:"",email:"",phone:"",role:"driver",employeeId:"",licenseNumber:"",licenseExpiry:"",address:"",emergencyContact:"",joiningDate:"",salary:0,status:"active",notes:""}),C=[{value:"driver",label:"Driver"},{value:"conductor",label:"Conductor"}],E=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"suspended",label:"Suspended"},{value:"on_leave",label:"On Leave"}];(0,i.useEffect)(()=>{A()},[]);const A=async()=>{try{var t,i;o(!0);const l=JSON.parse(localStorage.getItem("user")||"{}").role;console.log("User role:",l);const c="/api/driver/all",d="/api/conductor/all";console.log("Using endpoints:",{driverEndpoint:c,conductorEndpoint:d});const[u,h]=await Promise.all([fetch(c,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch(d,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})]);u.ok||console.error("Driver fetch failed:",u.status,await u.text()),h.ok||console.error("Conductor fetch failed:",h.status,await h.text());const p=u.ok?await u.json():{data:[]},m=h.ok?await h.json():{data:[]},f=Array.isArray(p.data)?p.data:(null===(t=p.data)||void 0===t?void 0:t.drivers)||[],g=Array.isArray(m.data)?m.data:(null===(i=m.data)||void 0===i?void 0:i.conductors)||[],x=f.map(e=>{var t,n;return Le(Le({},e),{},{role:"driver",employeeId:e.employeeCode||e.employeeId||e.driverId||"",licenseNumber:(null===(t=e.drivingLicense)||void 0===t?void 0:t.licenseNumber)||e.licenseNumber||"",licenseExpiry:(null===(n=e.drivingLicense)||void 0===n?void 0:n.expiryDate)||e.licenseExpiry||"",joiningDate:e.joiningDate||e.createdAt})}),y=g.map(e=>Le(Le({},e),{},{role:"conductor",employeeId:e.employeeCode||e.employeeId||e.conductorId||"",licenseNumber:e.licenseNumber||"",licenseExpiry:e.licenseExpiry||"",joiningDate:e.joiningDate||e.createdAt}));r(x),s(y);const v=new Date,_=v.getFullYear(),b=String(v.getMonth()+1).padStart(2,"0"),w=String(v.getDate()).padStart(2,"0"),j="".concat(_,"-").concat(b,"-").concat(w);let N=0,k=0;try{const t=new URLSearchParams({date:j}),n=JSON.parse(localStorage.getItem("user")||"{}").depotId||(null===e||void 0===e?void 0:e.depotId);n&&t.append("depotId",n);const i=await fetch("/api/depot/trips?".concat(t.toString()),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(i.ok){var a;const e=await i.json(),t=Array.isArray(null===(a=e.data)||void 0===a?void 0:a.trips)?e.data.trips:Array.isArray(e.data)?e.data:[],n=new Set(["scheduled","running","in-progress","on-break","assigned","started"]),r=new Set(t.filter(e=>n.has(e.status)).map(e=>{const t=e.driverId;return t?"string"===typeof t?t:"object"===typeof t&&(t._id||t.id)||null:null}).filter(Boolean));N=r.size;const s=new Set(t.filter(e=>n.has(e.status)).map(e=>{const t=e.conductorId;return t?"string"===typeof t?t:"object"===typeof t&&(t._id||t.id)||null:null}).filter(Boolean));k=s.size}}catch(wd){console.warn("Failed to fetch duties for active drivers calc:",wd)}S(e=>Le(Le({},e),{},{totalDrivers:f.length,activeDrivers:N,totalConductors:g.length,activeConductors:k})),n([...x,...y])}catch(l){console.error("Error fetching staff:",l)}finally{o(!1)}},M=()=>{T({name:"",email:"",phone:"",role:"driver",employeeId:"",licenseNumber:"",licenseExpiry:"",address:"",emergencyContact:"",joiningDate:"",salary:0,status:"active",notes:""})},D=t.filter(e=>{var t,n,i,r;const s=(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(g.toLowerCase()))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(g.toLowerCase()))||(null===(i=e.employeeId)||void 0===i?void 0:i.toLowerCase().includes(g.toLowerCase()))||(null===(r=e.licenseNumber)||void 0===r?void 0:r.toLowerCase().includes(g.toLowerCase())),a="all"===y||e.status===y,o="all"===_||e.role===_;return s&&a&&o}),I=e=>{switch(e){case"active":return"green";case"inactive":return"red";case"suspended":return"orange";case"on_leave":return"blue";default:return"gray"}},P=e=>{var t;return(null===(t=E.find(t=>t.value===e))||void 0===t?void 0:t.label)||e},R=e=>{var t;return(null===(t=C.find(t=>t.value===e))||void 0===t?void 0:t.label)||e},L=e=>new Date(e).toLocaleDateString("en-IN");return a?(0,ze.jsxs)("div",{className:"staff-loading",children:[(0,ze.jsx)("div",{className:"loading-spinner"}),(0,ze.jsx)("h3",{children:"Loading Staff Management..."})]}):(0,ze.jsxs)("div",{className:"staff-management",children:[(0,ze.jsxs)("div",{className:"staff-header",children:[(0,ze.jsxs)("div",{className:"header-left",children:[(0,ze.jsx)("h1",{children:"Staff Management"}),(0,ze.jsx)("p",{children:"Manage drivers, conductors, and depot personnel"})]}),(0,ze.jsx)("div",{className:"header-right",children:(0,ze.jsxs)("button",{className:"add-staff-btn",onClick:()=>c(!0),children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Add Staff"]})})]}),(0,ze.jsxs)("div",{className:"staff-stats",children:[(0,ze.jsxs)("div",{className:"stat-card",children:[(0,ze.jsx)("div",{className:"stat-icon blue",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})}),(0,ze.jsxs)("div",{className:"stat-content",children:[(0,ze.jsx)("h3",{children:N.totalDrivers}),(0,ze.jsx)("p",{children:"Total Drivers"})]})]}),(0,ze.jsxs)("div",{className:"stat-card",children:[(0,ze.jsx)("div",{className:"stat-icon green",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"stat-content",children:[(0,ze.jsx)("h3",{children:N.activeDrivers}),(0,ze.jsx)("p",{children:"Active Drivers"})]})]}),(0,ze.jsxs)("div",{className:"stat-card",children:[(0,ze.jsx)("div",{className:"stat-icon orange",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})}),(0,ze.jsxs)("div",{className:"stat-content",children:[(0,ze.jsx)("h3",{children:N.totalConductors}),(0,ze.jsx)("p",{children:"Total Conductors"})]})]}),(0,ze.jsxs)("div",{className:"stat-card",children:[(0,ze.jsx)("div",{className:"stat-icon purple",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,ze.jsxs)("div",{className:"stat-content",children:[(0,ze.jsx)("h3",{children:N.activeConductors}),(0,ze.jsx)("p",{children:"Active Conductors"})]})]})]}),(0,ze.jsxs)("div",{className:"staff-tabs",children:[(0,ze.jsx)("button",{className:"tab-btn ".concat("all"===w?"active":""),onClick:()=>j("all"),children:"All Staff"}),(0,ze.jsx)("button",{className:"tab-btn ".concat("drivers"===w?"active":""),onClick:()=>j("drivers"),children:"Drivers"}),(0,ze.jsx)("button",{className:"tab-btn ".concat("conductors"===w?"active":""),onClick:()=>j("conductors"),children:"Conductors"})]}),(0,ze.jsxs)("div",{className:"staff-controls",children:[(0,ze.jsx)("div",{className:"search-section",children:(0,ze.jsxs)("div",{className:"search-input-wrapper",children:[(0,ze.jsx)("svg",{className:"search-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414L10.89 9.89A6 6 0 012 8z",clipRule:"evenodd"})}),(0,ze.jsx)("input",{type:"text",placeholder:"Search staff by name, email, or ID...",value:g,onChange:e=>x(e.target.value),className:"search-input"})]})}),(0,ze.jsxs)("div",{className:"filter-section",children:[(0,ze.jsxs)("select",{value:y,onChange:e=>v(e.target.value),className:"filter-select",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),E.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,ze.jsxs)("select",{value:_,onChange:e=>b(e.target.value),className:"filter-select",children:[(0,ze.jsx)("option",{value:"all",children:"All Roles"}),C.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))]})]})]}),(0,ze.jsxs)("div",{className:"staff-table-container",children:[(0,ze.jsxs)("table",{className:"staff-table",children:[(0,ze.jsx)("thead",{children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{children:"Staff Member"}),(0,ze.jsx)("th",{children:"Role"}),(0,ze.jsx)("th",{children:"Contact"}),(0,ze.jsx)("th",{children:"License/ID"}),(0,ze.jsx)("th",{children:"Joining Date"}),(0,ze.jsx)("th",{children:"Status"}),(0,ze.jsx)("th",{children:"Actions"})]})}),(0,ze.jsx)("tbody",{children:D.map(e=>{var t;return(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"staff-info",children:[(0,ze.jsx)("div",{className:"staff-avatar",children:(null===(t=e.name)||void 0===t?void 0:t.charAt(0))||"S"}),(0,ze.jsxs)("div",{className:"staff-details",children:[(0,ze.jsx)("div",{className:"staff-name",children:e.name}),(0,ze.jsxs)("div",{className:"staff-id",children:["ID: ",e.employeeId]})]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("span",{className:"role-badge ".concat(e.role),children:R(e.role)})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"contact-info",children:[(0,ze.jsx)("div",{className:"contact-email",children:e.email}),(0,ze.jsx)("div",{className:"contact-phone",children:e.phone})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"license-info",children:[(0,ze.jsxs)("div",{className:"license-number",children:["driver"===e.role?"License: ":"ID: ",e.licenseNumber||e.employeeId]}),e.licenseExpiry&&(0,ze.jsxs)("div",{className:"license-expiry",children:["Expires: ",L(e.licenseExpiry)]})]})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("div",{className:"joining-info",children:e.joiningDate?L(e.joiningDate):"N/A"})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("span",{className:"status-badge ".concat(I(e.status)),children:P(e.status)})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("div",{className:"action-buttons",children:"admin"===JSON.parse(localStorage.getItem("user")||"{}").role&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)("button",{className:"action-btn view",onClick:()=>(e=>{f(e),T({name:e.name||"",email:e.email||"",phone:e.phone||"",role:e.role||"driver",employeeId:e.employeeId||"",licenseNumber:e.licenseNumber||"",licenseExpiry:e.licenseExpiry?new Date(e.licenseExpiry).toISOString().slice(0,10):"",address:e.address||"",emergencyContact:e.emergencyContact||"",joiningDate:e.joiningDate?new Date(e.joiningDate).toISOString().slice(0,10):"",salary:e.salary||0,status:e.status||"active",notes:e.notes||""}),u(!0)})(e),title:"View/Edit",children:(0,ze.jsxs)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,ze.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})}),(0,ze.jsx)("button",{className:"action-btn delete",onClick:()=>(e=>{f(e),p(!0)})(e),title:"Delete",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})})]},e._id)})})]}),0===D.length&&(0,ze.jsxs)("div",{className:"no-staff",children:[(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}),(0,ze.jsx)("h3",{children:"No staff members found"}),(0,ze.jsx)("p",{children:"Try adjusting your search or filters"})]})]}),l&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"Add New Staff Member"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{c(!1),M()},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{const t="driver"===k.role?"/api/driver":"/api/conductor",i=JSON.parse(localStorage.getItem("user")||"{}").depotId||(null===e||void 0===e?void 0:e.depotId),r=(k.email||k.phone||"".concat(k.name)).toLowerCase().replace(/[^a-z0-9_]/g,"_").slice(0,20),s=k.password&&k.password.length>=8?k.password:"TempPass@123",a=e=>{if(!e||"string"!==typeof e)return;const t=e.match(/([6-9]\d{9})/),n=t?t[1]:"",i=e.replace(/([6-9]\d{9})/g,"").replace(/[,-]/g," ").replace(/\s+/g," ").trim()||"";return i.length>=2&&/^[6-9]\d{9}$/.test(n)?{name:i,phone:n,relationship:""}:void 0},o=Le(Le({name:k.name,phone:String(k.phone||"").replace(/\D/g,""),email:k.email,employeeCode:k.employeeId||k.employeeCode||void 0,username:k.username||r,password:s,depotId:i,address:k.address},"object"===typeof k.emergencyContact&&k.emergencyContact?{emergencyContact:k.emergencyContact}:(()=>{const e=a(k.emergencyContact);return e?{emergencyContact:e}:{}})()),{},{salary:"object"===typeof k.salary?k.salary:{basic:Number(k.salary)||0,allowances:0,bonus:0},status:k.status||"active",notes:k.notes||""}),l="driver"===k.role?Le(Le({},o),{},{drivingLicense:{licenseNumber:k.licenseNumber||"TEMP000000",type:k.licenseType||"LMV",issueDate:k.licenseIssueDate||(new Date).toISOString().slice(0,10),expiryDate:k.licenseExpiry||new Date(Date.now()+31536e6).toISOString().slice(0,10),issuingAuthority:k.issuingAuthority||"RTO"}}):o,d=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(l)});if(d.ok)c(!1),M(),A();else{let e;try{e=await d.json()}catch(n){e={}}const t=Array.isArray(e.errors)?e.errors.map(e=>"".concat(e.path||e.param||"field",": ").concat(e.msg)).join("\n"):"";alert(e.message+(t?"\n".concat(t):"")||"Failed to add staff member")}}catch(i){console.error("Error adding staff:",i),alert("Failed to add staff member")}},className:"staff-form",children:[(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Full Name *"}),(0,ze.jsx)("input",{type:"text",value:k.name,onChange:e=>T(Le(Le({},k),{},{name:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Email *"}),(0,ze.jsx)("input",{type:"email",value:k.email,onChange:e=>T(Le(Le({},k),{},{email:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Phone *"}),(0,ze.jsx)("input",{type:"tel",value:k.phone,onChange:e=>T(Le(Le({},k),{},{phone:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Role *"}),(0,ze.jsx)("select",{value:k.role,onChange:e=>T(Le(Le({},k),{},{role:e.target.value})),required:!0,children:C.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Employee ID *"}),(0,ze.jsx)("input",{type:"text",value:k.employeeId,onChange:e=>T(Le(Le({},k),{},{employeeId:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsxs)("label",{children:["driver"===k.role?"License Number":"ID Number"," *"]}),(0,ze.jsx)("input",{type:"text",value:k.licenseNumber,onChange:e=>T(Le(Le({},k),{},{licenseNumber:e.target.value})),required:!0})]}),"driver"===k.role&&(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"License Expiry Date"}),(0,ze.jsx)("input",{type:"date",value:k.licenseExpiry,onChange:e=>T(Le(Le({},k),{},{licenseExpiry:e.target.value}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Joining Date"}),(0,ze.jsx)("input",{type:"date",value:k.joiningDate,onChange:e=>T(Le(Le({},k),{},{joiningDate:e.target.value}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Salary (\u20b9)"}),(0,ze.jsx)("input",{type:"number",value:k.salary,onChange:e=>T(Le(Le({},k),{},{salary:parseFloat(e.target.value)})),min:"0",step:"0.01"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Status"}),(0,ze.jsx)("select",{value:k.status,onChange:e=>T(Le(Le({},k),{},{status:e.target.value})),children:E.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Address"}),(0,ze.jsx)("textarea",{value:k.address,onChange:e=>T(Le(Le({},k),{},{address:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Emergency Contact"}),(0,ze.jsx)("input",{type:"tel",value:k.emergencyContact,onChange:e=>T(Le(Le({},k),{},{emergencyContact:e.target.value}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes"}),(0,ze.jsx)("textarea",{value:k.notes,onChange:e=>T(Le(Le({},k),{},{notes:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{c(!1),M()},children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Add Staff Member"})]})]})]})}),d&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsxs)("h2",{children:["Edit Staff Member - ",null===m||void 0===m?void 0:m.name]}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>{u(!1),M()},children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{if("admin"!==JSON.parse(localStorage.getItem("user")||"{}").role)return void alert("Only administrators can edit staff members");const e="driver"===m.role?"/api/driver/".concat(m._id):"/api/conductor/".concat(m._id),t=await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(k)});if(t.ok)u(!1),M(),A();else{const e=await t.json();alert(e.message||"Failed to update staff member")}}catch(t){console.error("Error updating staff:",t),alert("Failed to update staff member")}},className:"staff-form",children:[(0,ze.jsxs)("div",{className:"form-grid",children:[(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Full Name *"}),(0,ze.jsx)("input",{type:"text",value:k.name,onChange:e=>T(Le(Le({},k),{},{name:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Email *"}),(0,ze.jsx)("input",{type:"email",value:k.email,onChange:e=>T(Le(Le({},k),{},{email:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Phone *"}),(0,ze.jsx)("input",{type:"tel",value:k.phone,onChange:e=>T(Le(Le({},k),{},{phone:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Role *"}),(0,ze.jsx)("select",{value:k.role,onChange:e=>T(Le(Le({},k),{},{role:e.target.value})),required:!0,children:C.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Employee ID *"}),(0,ze.jsx)("input",{type:"text",value:k.employeeId,onChange:e=>T(Le(Le({},k),{},{employeeId:e.target.value})),required:!0})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsxs)("label",{children:["driver"===k.role?"License Number":"ID Number"," *"]}),(0,ze.jsx)("input",{type:"text",value:k.licenseNumber,onChange:e=>T(Le(Le({},k),{},{licenseNumber:e.target.value})),required:!0})]}),"driver"===k.role&&(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"License Expiry Date"}),(0,ze.jsx)("input",{type:"date",value:k.licenseExpiry,onChange:e=>T(Le(Le({},k),{},{licenseExpiry:e.target.value}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Joining Date"}),(0,ze.jsx)("input",{type:"date",value:k.joiningDate,onChange:e=>T(Le(Le({},k),{},{joiningDate:e.target.value}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Salary (\u20b9)"}),(0,ze.jsx)("input",{type:"number",value:k.salary,onChange:e=>T(Le(Le({},k),{},{salary:parseFloat(e.target.value)})),min:"0",step:"0.01"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Status"}),(0,ze.jsx)("select",{value:k.status,onChange:e=>T(Le(Le({},k),{},{status:e.target.value})),children:E.map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Address"}),(0,ze.jsx)("textarea",{value:k.address,onChange:e=>T(Le(Le({},k),{},{address:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Emergency Contact"}),(0,ze.jsx)("input",{type:"tel",value:k.emergencyContact,onChange:e=>T(Le(Le({},k),{},{emergencyContact:e.target.value}))})]}),(0,ze.jsxs)("div",{className:"form-group",children:[(0,ze.jsx)("label",{children:"Notes"}),(0,ze.jsx)("textarea",{value:k.notes,onChange:e=>T(Le(Le({},k),{},{notes:e.target.value})),rows:"3"})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{u(!1),M()},children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"btn-primary",children:"Update Staff Member"})]})]})]})}),h&&(0,ze.jsx)("div",{className:"modal-overlay",children:(0,ze.jsxs)("div",{className:"modal-content delete-modal",children:[(0,ze.jsxs)("div",{className:"modal-header",children:[(0,ze.jsx)("h2",{children:"Delete Staff Member"}),(0,ze.jsx)("button",{className:"modal-close",onClick:()=>p(!1),children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("div",{className:"delete-content",children:[(0,ze.jsx)("div",{className:"delete-icon",children:(0,ze.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,ze.jsx)("h3",{children:"Are you sure you want to delete this staff member?"}),(0,ze.jsxs)("p",{children:['This action cannot be undone. The staff member "',null===m||void 0===m?void 0:m.name,'" will be permanently removed.']}),(0,ze.jsxs)("div",{className:"staff-details",children:[(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Name:"}),(0,ze.jsx)("span",{className:"value",children:null===m||void 0===m?void 0:m.name})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Role:"}),(0,ze.jsx)("span",{className:"value",children:R(null===m||void 0===m?void 0:m.role)})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Employee ID:"}),(0,ze.jsx)("span",{className:"value",children:null===m||void 0===m?void 0:m.employeeId})]}),(0,ze.jsxs)("div",{className:"detail-item",children:[(0,ze.jsx)("span",{className:"label",children:"Status:"}),(0,ze.jsx)("span",{className:"value",children:P(null===m||void 0===m?void 0:m.status)})]})]})]}),(0,ze.jsxs)("div",{className:"modal-actions",children:[(0,ze.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>p(!1),children:"Cancel"}),(0,ze.jsx)("button",{type:"button",className:"btn-danger",onClick:async()=>{try{if("admin"!==JSON.parse(localStorage.getItem("user")||"{}").role)return void alert("Only administrators can delete staff members");const e="driver"===m.role?"/api/driver/".concat(m._id):"/api/conductor/".concat(m._id),t=await fetch(e,{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok)p(!1),f(null),A();else{const e=await t.json();alert(e.message||"Failed to delete staff member")}}catch(e){console.error("Error deleting staff:",e),alert("Failed to delete staff member")}},children:"Delete Staff Member"})]})]})})]})},Cm=()=>{var e,t,n;const{user:r,logout:s}=Fe(),a=te(),[o,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)({totalBuses:0,activeTrips:0,todayRevenue:0,totalRoutes:0}),[u,h]=(0,i.useState)({name:"",location:"",manager:""}),[p,m]=(0,i.useState)(!1),[f,g]=(0,i.useState)([]),[x,y]=(0,i.useState)([]),[v,_]=(0,i.useState)({database:"unknown",api:"unknown",frontend:"unknown"}),[b,w]=(0,i.useState)(""),[j,N]=(0,i.useState)(!1),[S,k]=(0,i.useState)("dashboard"),T=async()=>{try{await s(),a("/login")}catch(e){console.error("Logout error:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("depotToken"),localStorage.removeItem("depotUser"),localStorage.removeItem("depotInfo"),a("/login")}},C=(0,i.useCallback)(async()=>{try{const e=localStorage.getItem("depotToken")||localStorage.getItem("token");if(!e)return;const t=await fetch("/api/depot/info",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(t.ok){const e=await t.json();console.log("Depot info received:",e);const n={name:e.name||e.depotName||"Yatrik Depot",location:e.location||e.address||"Kerala, India",manager:e.manager||e.managerName||(null===r||void 0===r?void 0:r.name)||"Depot Manager"};h(n),localStorage.setItem("depotInfo",JSON.stringify(n))}}catch(e){console.error("Error fetching depot info:",e)}},[r]),E=(0,i.useCallback)(async()=>{try{if(l(!0),!r)return;const i=localStorage.getItem("depotInfo");if(i)try{const e=JSON.parse(i);h(e)}catch(wd){console.log("Failed to parse stored depot info")}const s=localStorage.getItem("depotToken")||localStorage.getItem("token");if(!s)return console.error("No authentication token found"),void l(!1);const a=await fetch("/api/depot/dashboard",{headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(a.ok){var e,t,n;const i=await a.json();console.log("Dashboard data received:",i),d(e=>{var t,n,r,s,a,o,l,c,d,u,h,p,m,f;return Le(Le({},e),{},{totalBuses:(null===(t=i.data)||void 0===t||null===(n=t.stats)||void 0===n?void 0:n.totalBuses)||0,activeBuses:(null===(r=i.data)||void 0===r||null===(s=r.stats)||void 0===s?void 0:s.activeBuses)||0,totalRoutes:(null===(a=i.data)||void 0===a||null===(o=a.stats)||void 0===o?void 0:o.totalRoutes)||0,activeRoutes:(null===(l=i.data)||void 0===l||null===(c=l.stats)||void 0===c?void 0:c.activeRoutes)||0,totalDrivers:(null===(d=i.data)||void 0===d||null===(u=d.stats)||void 0===u?void 0:u.totalDrivers)||0,activeDrivers:(null===(h=i.data)||void 0===h||null===(p=h.stats)||void 0===p?void 0:p.activeDrivers)||0,todayRevenue:(null===(m=i.data)||void 0===m||null===(f=m.stats)||void 0===f?void 0:f.todayRevenue)||0})}),g((null===(e=i.data)||void 0===e?void 0:e.recentTrips)||[]),y((null===(t=i.data)||void 0===t?void 0:t.liveTracking)||[]);const s=(null===(n=i.data)||void 0===n?void 0:n.depot)||{},o={name:s.name||"Yatrik Depot",location:s.location||"Kerala, India",manager:s.manager||(null===r||void 0===r?void 0:r.name)||"Depot Manager"};h(o),localStorage.setItem("depotInfo",JSON.stringify(o))}else{console.error("Failed to fetch dashboard data:",a.status,a.statusText);const e={name:"Yatrik Depot",location:"Kerala, India",manager:(null===r||void 0===r?void 0:r.name)||"Depot Manager"};h(e),localStorage.setItem("depotInfo",JSON.stringify(e))}l(!1)}catch(i){console.error("Error fetching dashboard data:",i);const e={name:"Yatrik Depot",location:"Kerala, India",manager:(null===r||void 0===r?void 0:r.name)||"Depot Manager"};h(e),localStorage.setItem("depotInfo",JSON.stringify(e)),l(!1)}},[r]);return(0,i.useEffect)(()=>{E(),C();const e=setInterval(async()=>{w((new Date).toLocaleTimeString());try{const e=await fetch("/api/health");if(e.ok){const t=await e.json();_({database:t.database||"unknown",api:t.api||"unknown",frontend:t.frontend||"unknown"})}}catch(n){_({database:"disconnected",api:"error",frontend:"unknown"})}if(r)try{const n=localStorage.getItem("depotToken")||localStorage.getItem("token"),i=await fetch("/api/depot/dashboard",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(i.ok){var e,t;const n=await i.json();if(y((null===(e=n.data)||void 0===e?void 0:e.liveTracking)||[]),d(e=>{var t,i,r;return Le(Le(Le({},e),(null===(t=n.data)||void 0===t?void 0:t.stats)||{}),{},{todayRevenue:(null===(i=n.data)||void 0===i||null===(r=i.stats)||void 0===r?void 0:r.todayRevenue)||e.todayRevenue||0})}),null!==(t=n.data)&&void 0!==t&&t.depot){const e=n.data.depot,t={name:e.name||u.name,location:e.location||u.location,manager:e.manager||u.manager};h(t),localStorage.setItem("depotInfo",JSON.stringify(t))}}}catch(n){console.log("Tracking refresh failed:",n)}},3e4);return()=>clearInterval(e)},[r,E,C]),o?(0,ze.jsxs)("div",{className:"admin-loading",children:[(0,ze.jsx)("div",{className:"loading-spinner"}),(0,ze.jsx)("h3",{children:"Loading Depot Dashboard..."})]}):(0,ze.jsxs)("div",{className:"admin-dashboard",children:[(0,ze.jsxs)("div",{className:"admin-sidebar ".concat(j?"collapsed":""),children:[(0,ze.jsxs)("div",{className:"sidebar-header",children:[(0,ze.jsx)("h2",{children:"Depot Panel"}),(0,ze.jsxs)("div",{className:"depot-info",children:[(0,ze.jsx)("div",{className:"depot-name",children:u.name||"Yatrik Depot"}),(0,ze.jsxs)("div",{className:"depot-location",children:["\ud83d\udccd ",u.location||"Kerala, India"]}),(0,ze.jsxs)("div",{className:"depot-manager",children:["\ud83d\udc64 ",u.manager||(null===r||void 0===r?void 0:r.name)||"Depot Manager"]})]})]}),(0,ze.jsx)("nav",{className:"sidebar-nav",children:(0,ze.jsxs)("ul",{className:"nav-menu",children:[(0,ze.jsxs)("li",{className:"nav-item ".concat("dashboard"===S?"active":""),onClick:()=>k("dashboard"),children:[(0,ze.jsx)("svg",{className:"nav-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"})}),(0,ze.jsx)("span",{children:"Dashboard"})]}),(0,ze.jsxs)("li",{className:"nav-item ".concat("buses"===S?"active":""),onClick:()=>k("buses"),children:[(0,ze.jsxs)("svg",{className:"nav-icon",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),(0,ze.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]}),(0,ze.jsx)("span",{children:"Fleet Management"})]}),(0,ze.jsxs)("li",{className:"nav-item ".concat("routes"===S?"active":""),onClick:()=>k("routes"),children:[(0,ze.jsx)("svg",{className:"nav-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Route Network"})]}),(0,ze.jsxs)("li",{className:"nav-item ".concat("trips"===S?"active":""),onClick:()=>k("trips"),children:[(0,ze.jsx)("svg",{className:"nav-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Trip Management"})]}),(0,ze.jsxs)("li",{className:"nav-item ".concat("crew"===S?"active":""),onClick:()=>k("crew"),children:[(0,ze.jsx)("svg",{className:"nav-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}),(0,ze.jsx)("span",{children:"Staff Management"})]}),(0,ze.jsxs)("li",{className:"nav-item ".concat("reports"===S?"active":""),onClick:()=>k("reports"),children:[(0,ze.jsx)("svg",{className:"nav-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Reports"})]}),(0,ze.jsxs)("li",{className:"nav-item ".concat("monitoring"===S?"active":""),onClick:()=>k("monitoring"),children:[(0,ze.jsx)("svg",{className:"nav-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Live Monitoring"})]})]})}),(0,ze.jsxs)("div",{className:"sidebar-footer",children:[(0,ze.jsxs)("div",{className:"user-profile",children:[(0,ze.jsx)("div",{className:"user-avatar",children:(null===r||void 0===r||null===(e=r.name)||void 0===e?void 0:e.charAt(0))||"D"}),(0,ze.jsxs)("div",{className:"user-info",children:[(0,ze.jsx)("div",{className:"user-name",children:u.manager||(null===r||void 0===r?void 0:r.name)||"Depot Manager"}),(0,ze.jsx)("div",{className:"user-role",children:"Manager"})]})]}),(0,ze.jsx)("button",{className:"logout-btn",onClick:T,children:(0,ze.jsx)("svg",{className:"logout-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 001 1h12a1 1 0 001-1V4a1 1 0 00-1-1H3zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})]}),(0,ze.jsxs)("div",{className:"main-content",children:[(0,ze.jsxs)("div",{className:"top-bar",children:[(0,ze.jsx)("div",{className:"top-bar-left",children:(0,ze.jsxs)("div",{className:"search-section",children:[(0,ze.jsx)("svg",{className:"search-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414L10.89 9.89A6 6 0 012 8z",clipRule:"evenodd"})}),(0,ze.jsx)("input",{type:"text",className:"search-input",placeholder:"Search users, trips, routes..."})]})}),(0,ze.jsx)("div",{className:"top-bar-center",children:(0,ze.jsxs)("div",{className:"status-indicators",children:[(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("svg",{className:"status-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})}),(0,ze.jsx)("span",{children:"Database"})]}),(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("svg",{className:"status-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"API Server"})]}),(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("svg",{className:"status-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Frontend"})]}),(0,ze.jsxs)("div",{className:"status-item",children:[(0,ze.jsx)("svg",{className:"status-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 14a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Mobile App"})]})]})}),(0,ze.jsxs)("div",{className:"top-bar-right",children:[(0,ze.jsx)(bm,{}),(0,ze.jsxs)("div",{className:"user-profile-top",onClick:()=>m(!p),children:[(0,ze.jsx)("div",{className:"user-avatar-top",children:(null===r||void 0===r||null===(t=r.name)||void 0===t?void 0:t.charAt(0))||"D"}),(0,ze.jsx)("div",{className:"user-info-top",children:(0,ze.jsx)("div",{className:"user-name-top",children:u.manager||(null===r||void 0===r?void 0:r.name)||"Depot Manager"})}),(0,ze.jsx)("svg",{className:"dropdown-arrow",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),p&&(0,ze.jsxs)("div",{className:"profile-dropdown",children:[(0,ze.jsxs)("div",{className:"dropdown-header",children:[(0,ze.jsx)("div",{className:"dropdown-avatar",children:(null===r||void 0===r||null===(n=r.name)||void 0===n?void 0:n.charAt(0))||"D"}),(0,ze.jsxs)("div",{className:"dropdown-user-info",children:[(0,ze.jsx)("div",{className:"dropdown-name",children:u.manager||(null===r||void 0===r?void 0:r.name)||"Depot Manager"}),(0,ze.jsx)("div",{className:"dropdown-role",children:"Depot Manager"})]})]}),(0,ze.jsx)("div",{className:"dropdown-divider"}),(0,ze.jsxs)("div",{className:"dropdown-menu",children:[(0,ze.jsxs)("div",{className:"dropdown-item",onClick:()=>{m(!1),console.log("View Profile clicked")},children:[(0,ze.jsx)("svg",{className:"dropdown-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"View Profile"})]}),(0,ze.jsxs)("div",{className:"dropdown-item",onClick:()=>{m(!1);const e=prompt("Enter new depot name:",u.name);if(e&&""!==e.trim()){const t=Le(Le({},u),{},{name:e.trim()});h(t),localStorage.setItem("depotInfo",JSON.stringify(t)),console.log("Depot name changed to:",e)}},children:[(0,ze.jsx)("svg",{className:"dropdown-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})}),(0,ze.jsx)("span",{children:"Change Depot Name"})]}),(0,ze.jsxs)("div",{className:"dropdown-item",onClick:()=>{m(!1),console.log("Change Password clicked")},children:[(0,ze.jsx)("svg",{className:"dropdown-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Change Password"})]}),(0,ze.jsxs)("div",{className:"dropdown-item",onClick:()=>{m(!1),console.log("Depot Settings clicked")},children:[(0,ze.jsx)("svg",{className:"dropdown-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Depot Settings"})]}),(0,ze.jsx)("div",{className:"dropdown-divider"}),(0,ze.jsxs)("div",{className:"dropdown-item logout-item",onClick:T,children:[(0,ze.jsx)("svg",{className:"dropdown-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"Logout"})]})]})]})]})]}),(0,ze.jsxs)("div",{className:"dashboard-content",children:["dashboard"===S&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"dashboard-header",children:[(0,ze.jsxs)("div",{className:"header-left",children:[(0,ze.jsxs)("h1",{children:[u.name||"Yatrik Depot"," Dashboard"]}),(0,ze.jsxs)("p",{children:["Welcome back, ",u.manager||(null===r||void 0===r?void 0:r.name)||"Depot Manager","! Here's your depot overview."]})]}),(0,ze.jsxs)("div",{className:"action-buttons-container",children:[(0,ze.jsxs)("button",{className:"action-btn blue",onClick:()=>k("buses"),children:[(0,ze.jsxs)("svg",{className:"action-icon",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),(0,ze.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]}),"Fleet"]}),(0,ze.jsxs)("button",{className:"action-btn green",onClick:()=>k("routes"),children:[(0,ze.jsx)("svg",{className:"action-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),"Routes"]}),(0,ze.jsxs)("button",{className:"action-btn purple",onClick:()=>k("trips"),children:[(0,ze.jsx)("svg",{className:"action-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),"Trips"]}),(0,ze.jsxs)("button",{className:"action-btn orange",onClick:()=>k("reports"),children:[(0,ze.jsx)("svg",{className:"action-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"})}),"Reports"]})]})]}),(0,ze.jsx)("div",{className:"kpi-section",children:(0,ze.jsxs)("div",{className:"kpi-grid",children:[(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-header",children:[(0,ze.jsx)("h3",{children:c.totalBuses}),(0,ze.jsxs)("div",{className:"kpi-trend",children:[(0,ze.jsx)("svg",{className:"trend-icon up",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"12% from last month"})]})]}),(0,ze.jsx)("p",{className:"kpi-label",children:"Total Buses"})]}),(0,ze.jsx)("div",{className:"kpi-icon blue",children:(0,ze.jsxs)("svg",{className:"icon",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,ze.jsx)("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),(0,ze.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]})})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-header",children:[(0,ze.jsx)("h3",{children:c.activeTrips}),(0,ze.jsxs)("div",{className:"kpi-trend",children:[(0,ze.jsx)("svg",{className:"trend-icon up",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"8% from last month"})]})]}),(0,ze.jsx)("p",{className:"kpi-label",children:"Running Trips"})]}),(0,ze.jsx)("div",{className:"kpi-icon green",children:(0,ze.jsx)("svg",{className:"icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-header",children:[(0,ze.jsxs)("h3",{children:["\u20b9",Number(c.todayRevenue||0).toLocaleString()]}),(0,ze.jsxs)("div",{className:"kpi-trend",children:[(0,ze.jsx)("svg",{className:"trend-icon up",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"15% from last month"})]})]}),(0,ze.jsx)("p",{className:"kpi-label",children:"Today's Revenue"})]}),(0,ze.jsx)("div",{className:"kpi-icon yellow",children:(0,ze.jsx)("svg",{className:"icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{d:"M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"})})})]}),(0,ze.jsxs)("div",{className:"kpi-card",children:[(0,ze.jsxs)("div",{className:"kpi-content",children:[(0,ze.jsxs)("div",{className:"kpi-header",children:[(0,ze.jsx)("h3",{children:c.totalRoutes}),(0,ze.jsxs)("div",{className:"kpi-trend",children:[(0,ze.jsx)("svg",{className:"trend-icon down",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M12 13a1 1 0 100 2h5a1 1 0 001-1v-5a1 1 0 10-2 0v2.586l-4.293-4.293a1 1 0 00-1.414 0L8 9.586l-4.293-4.293a1 1 0 00-1.414 1.414l5 5a1 1 0 001.414 0L11 9.414 14.586 13H12z",clipRule:"evenodd"})}),(0,ze.jsx)("span",{children:"5% from last month"})]})]}),(0,ze.jsx)("p",{className:"kpi-label",children:"Total Routes"})]}),(0,ze.jsx)("div",{className:"kpi-icon red",children:(0,ze.jsx)("svg",{className:"icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,ze.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})]})]})}),(0,ze.jsxs)("div",{className:"live-tracking-section",children:[(0,ze.jsxs)("div",{className:"section-header",children:[(0,ze.jsx)("h3",{children:"Live Tracking"}),(0,ze.jsxs)("div",{className:"live-indicator",children:[(0,ze.jsx)("div",{className:"live-dot"}),(0,ze.jsx)("span",{children:"Live"})]})]}),(0,ze.jsxs)("div",{className:"live-tracking-container",children:[(0,ze.jsx)("div",{className:"map-area",children:(0,ze.jsx)("div",{className:"map-container",children:(0,ze.jsxs)("div",{className:"map-overlay",children:[(0,ze.jsx)("div",{className:"map-type-indicator",children:"Basic Map View"}),(0,ze.jsx)("div",{className:"map-background"}),x.map((e,t)=>{var n,i,r;return(0,ze.jsxs)("div",{className:"trip-marker",style:{left:"".concat(20+15*t%80,"%"),top:"".concat(30+20*t%60,"%")},children:[(0,ze.jsx)("div",{className:"marker-pulse"}),(0,ze.jsx)("div",{className:"marker-icon ".concat("running"===e.status?"bg-green-500":"completed"===e.status?"bg-blue-500":"bg-orange-500"),children:(null===(n=e.busId)||void 0===n||null===(i=n.busNumber)||void 0===i?void 0:i.charAt(0))||"B"}),(0,ze.jsxs)("div",{className:"marker-info",children:[(0,ze.jsx)("div",{className:"marker-bus",children:(null===(r=e.busId)||void 0===r?void 0:r.busNumber)||"N/A"}),(0,ze.jsx)("div",{className:"marker-status",children:e.status||"unknown"})]})]},e._id||t)})]})})}),(0,ze.jsxs)("div",{className:"trip-info-panel",children:[(0,ze.jsxs)("div",{className:"panel-header",children:[(0,ze.jsx)("h4",{children:"Active Trips"}),(0,ze.jsx)("div",{className:"trip-count",children:x.length})]}),(0,ze.jsx)("div",{className:"trips-list",children:x.slice(0,5).map((e,t)=>{var n,i,r;return(0,ze.jsxs)("div",{className:"trip-card",children:[(0,ze.jsxs)("div",{className:"trip-header",children:[(0,ze.jsxs)("div",{className:"trip-id",children:["Trip ",(null===(n=e._id)||void 0===n?void 0:n.slice(-6))||t+1]}),(0,ze.jsx)("div",{className:"trip-status-badge ".concat("running"===e.status?"bg-green-500":"completed"===e.status?"bg-blue-500":"bg-orange-500"),children:e.status||"unknown"})]}),(0,ze.jsxs)("div",{className:"trip-details",children:[(0,ze.jsxs)("div",{className:"trip-info",children:[(0,ze.jsx)("span",{className:"info-label",children:"Route:"}),(0,ze.jsx)("span",{className:"info-value",children:(null===(i=e.routeId)||void 0===i?void 0:i.name)||"N/A"})]}),(0,ze.jsxs)("div",{className:"trip-info",children:[(0,ze.jsx)("span",{className:"info-label",children:"Bus:"}),(0,ze.jsx)("span",{className:"info-value",children:(null===(r=e.busId)||void 0===r?void 0:r.busNumber)||"N/A"})]}),(0,ze.jsxs)("div",{className:"trip-info",children:[(0,ze.jsx)("span",{className:"info-label",children:"Driver:"}),(0,ze.jsx)("span",{className:"info-value",children:e.driver||"N/A"})]})]})]},e._id||t)})})]})]})]}),(0,ze.jsxs)("div",{className:"reports-section",children:[(0,ze.jsxs)("div",{className:"section-header",children:[(0,ze.jsx)("h3",{children:"Recent Trips"}),(0,ze.jsx)("div",{className:"reports-filter",children:(0,ze.jsxs)("select",{className:"filter-select",children:[(0,ze.jsx)("option",{children:"All Trips"}),(0,ze.jsx)("option",{children:"Today's Trips"}),(0,ze.jsx)("option",{children:"This Week"}),(0,ze.jsx)("option",{children:"This Month"})]})})]}),(0,ze.jsx)("div",{className:"reports-table",children:(0,ze.jsxs)("table",{className:"trips-table",children:[(0,ze.jsx)("thead",{children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{children:"Trip ID"}),(0,ze.jsx)("th",{children:"Route"}),(0,ze.jsx)("th",{children:"Bus"}),(0,ze.jsx)("th",{children:"Crew"}),(0,ze.jsx)("th",{children:"Status"}),(0,ze.jsx)("th",{children:"Actions"})]})}),(0,ze.jsx)("tbody",{children:f.map((e,t)=>{var n,i,r,s,a;return(0,ze.jsxs)("tr",{children:[(0,ze.jsxs)("td",{children:["Trip ",(null===(n=e._id)||void 0===n?void 0:n.slice(-6))||t+1]}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"route-info",children:[(0,ze.jsx)("div",{className:"route-name",children:(null===(i=e.routeId)||void 0===i?void 0:i.name)||"N/A"}),(0,ze.jsx)("div",{className:"route-code",children:(null===(r=e.routeId)||void 0===r?void 0:r.code)||"N/A"})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"bus-info",children:[(0,ze.jsx)("div",{className:"bus-number",children:(null===(s=e.busId)||void 0===s?void 0:s.busNumber)||"N/A"}),(0,ze.jsx)("div",{className:"bus-type",children:(null===(a=e.busId)||void 0===a?void 0:a.type)||"N/A"})]})}),(0,ze.jsx)("td",{children:(0,ze.jsxs)("div",{className:"crew-info",children:[(0,ze.jsx)("div",{className:"crew-driver",children:e.driver||"N/A"}),(0,ze.jsx)("div",{className:"crew-conductor",children:e.conductor||"N/A"})]})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("div",{className:"status-badge ".concat("running"===e.status?"bg-green-500":"completed"===e.status?"bg-blue-500":"bg-orange-500"),children:e.status||"unknown"})}),(0,ze.jsx)("td",{children:(0,ze.jsx)("button",{className:"action-btn-small",children:"View"})})]},e._id||t)})})]})})]})]}),"buses"===S&&(0,ze.jsx)(wm,{}),"routes"===S&&(0,ze.jsx)(jm,{}),"trips"===S&&(0,ze.jsx)(km,{}),"crew"===S&&(0,ze.jsx)(Tm,{})]})]})]})},Em=wn("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Am=wn("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),Mm=wn("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),Dm=()=>{const[e,t]=(0,i.useState)({totalUsers:0,activeUsers:0,totalTrips:0,runningTrips:0,totalRevenue:0,todayRevenue:0,totalBookings:0,pendingBookings:0}),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)({database:"healthy",api:"healthy",frontend:"healthy",lastCheck:new Date}),[o,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)("all"),[u,h]=(0,i.useState)(!0);(0,i.useEffect)(()=>{if(p(),m(),u){const e=setInterval(()=>{p(),m()},15e3);return()=>clearInterval(e)}},[u]);const p=async()=>{try{l(!0);const h=await fetch("http://localhost:5000/api/admin/dashboard",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(h.ok){var e,n,i,s,a,o,c,d,u;const l=await h.json();t({totalUsers:(null===(e=l.kpis)||void 0===e?void 0:e.users)||0,activeUsers:(null===(n=l.kpis)||void 0===n?void 0:n.users)||0,totalTrips:(null===(i=l.kpis)||void 0===i?void 0:i.tripsToday)||0,runningTrips:(null===(s=l.kpis)||void 0===s?void 0:s.runningTrips)||0,totalRevenue:(null===(a=l.kpis)||void 0===a?void 0:a.totalRevenue)||0,todayRevenue:(null===(o=l.kpis)||void 0===o?void 0:o.todayRevenue)||0,totalBookings:(null===(c=l.kpis)||void 0===c?void 0:c.totalBookings)||0,pendingBookings:(null===(d=l.kpis)||void 0===d?void 0:d.pendingBookings)||0}),r((null===(u=l.top5Recent)||void 0===u?void 0:u.bookings)||[])}}catch(h){console.error("Error fetching dashboard data:",h)}finally{l(!1)}},m=async()=>{try{console.log("\ud83d\udd04 Fetching recent activities...");const t=await fetch("http://localhost:5000/api/admin/recent-activities",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 Recent activities response status:",t.status),t.ok){var e;const n=await t.json();console.log("\ud83d\udcca Recent activities data:",n),r(n.activities||[]),console.log("\u2705 Recent activities updated:",(null===(e=n.activities)||void 0===e?void 0:e.length)||0,"activities")}else{console.error("\u274c Recent activities failed:",t.status);const e=await t.text();console.error("Error response:",e)}}catch(t){console.error("\ud83d\udca5 Error fetching recent activities:",t)}},f=e=>{let{title:t,value:n,icon:i,color:r,change:s,subtitle:a}=e;return(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-600",children:t}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:n}),a&&(0,ze.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:a}),s&&(0,ze.jsxs)("div",{className:"flex items-center mt-2 text-sm ".concat(s>0?"text-green-600":"text-red-600"),children:[s>0?(0,ze.jsx)(Ou,{className:"w-4 h-4 mr-1"}):(0,ze.jsx)(Ou,{className:"w-4 h-4 mr-1 rotate-180"}),Math.abs(s),"% from last month"]})]}),(0,ze.jsx)("div",{className:"p-3 rounded-lg ".concat(r),children:(0,ze.jsx)(i,{className:"w-6 h-6 text-white"})})]})})},g=e=>{let{title:t,description:n,icon:i,action:r,color:s}=e;return(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-all hover:scale-105 cursor-pointer",children:[(0,ze.jsx)("div",{className:"p-3 rounded-lg ".concat(s," w-fit mb-4"),children:(0,ze.jsx)(i,{className:"w-6 h-6 text-white"})}),(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),(0,ze.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:n}),(0,ze.jsxs)("button",{onClick:r,className:"text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center",children:[t," ",(0,ze.jsx)(mh,{className:"w-4 h-4 ml-1"})]})]})};return o?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"text-center lg:text-left",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Yatrik Admin Dashboard"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Welcome back! Here's what's happening with your system today."})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:()=>{console.log("=== TESTING RECENT ACTIVITIES API ==="),m()},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Dn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Test Activities"})]}),(0,ze.jsxs)("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})]}),(0,ze.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)(Dn,{className:"w-6 h-6 text-blue-600"}),(0,ze.jsx)("h2",{className:"text-xl font-semibold text-blue-900",children:"System Health"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("healthy"===s.database?"bg-green-500":"bg-red-500")}),(0,ze.jsx)("span",{className:"text-sm text-gray-700",children:"Database"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("healthy"===s.api?"bg-green-500":"bg-red-500")}),(0,ze.jsx)("span",{className:"text-sm text-gray-700",children:"API"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("healthy"===s.frontend?"bg-green-500":"bg-red-500")}),(0,ze.jsx)("span",{className:"text-sm text-gray-700",children:"Frontend"})]})]})]})}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,ze.jsx)(f,{title:"Total Users",value:e.totalUsers.toLocaleString(),icon:Nn,color:"bg-blue-500",change:12,subtitle:"Active accounts"}),(0,ze.jsx)(f,{title:"Running Trips",value:e.runningTrips,icon:Sn,color:"bg-green-500",change:8,subtitle:"Currently active"}),(0,ze.jsx)(f,{title:"Today's Revenue",value:"\u20b9".concat(e.todayRevenue.toLocaleString()),icon:Mn,color:"bg-yellow-500",change:15,subtitle:"Daily earnings"}),(0,ze.jsx)(f,{title:"Pending Bookings",value:e.pendingBookings,icon:gd,color:"bg-red-500",change:-5,subtitle:"Awaiting confirmation"})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Revenue Overview"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(jn,{className:"w-5 h-5 text-gray-400"}),(0,ze.jsx)("span",{className:"text-sm text-gray-500",children:"Last 7 days"})]})]}),(0,ze.jsx)("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(jn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"Revenue chart will be displayed here"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400",children:"Integration with chart library required"})]})})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"User Activity"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(Mm,{className:"w-5 h-5 text-gray-400"}),(0,ze.jsx)("span",{className:"text-sm text-gray-500",children:"Real-time"})]})]}),(0,ze.jsx)("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(Mm,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"User activity chart will be displayed here"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400",children:"Integration with chart library required"})]})})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Quick Actions"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,ze.jsx)(g,{title:"Add User",description:"Create new user accounts with specific roles and permissions",icon:Nn,color:"bg-blue-500",action:()=>window.location.href="/admin/users"}),(0,ze.jsx)(g,{title:"Manage Routes",description:"Add, edit, or remove bus routes and schedules",icon:kn,color:"bg-green-500",action:()=>window.location.href="/admin/routes-management"}),(0,ze.jsx)(g,{title:"Schedule Trip",description:"Create new trips with specific buses and conductors",icon:Tn,color:"bg-purple-500",action:()=>window.location.href="/admin/trips"}),(0,ze.jsx)(g,{title:"Bus Management",description:"Manage fleet, maintenance, and real-time monitoring",icon:Sn,color:"bg-indigo-500",action:()=>window.location.href="/admin/buses"}),(0,ze.jsx)(g,{title:"Manage Depots",description:"Manage bus depots, capacity, and facilities",icon:id,color:"bg-purple-500",action:()=>window.location.href="/admin/depot-management"}),(0,ze.jsx)(g,{title:"View Reports",description:"Access detailed analytics and performance reports",icon:jn,color:"bg-orange-500",action:()=>window.location.href="/admin/reports"})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Activities"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(u?"bg-green-500 animate-pulse":"bg-gray-400")}),(0,ze.jsx)("span",{className:"text-xs text-gray-500",children:u?"Live":"Paused"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Activities"}),(0,ze.jsx)("option",{value:"bookings",children:"Bookings"}),(0,ze.jsx)("option",{value:"trips",children:"Trips"}),(0,ze.jsx)("option",{value:"users",children:"Users"}),(0,ze.jsx)("option",{value:"system",children:"System"}),(0,ze.jsx)("option",{value:"payments",children:"Payments"})]}),(0,ze.jsx)("button",{onClick:()=>h(!u),className:"px-3 py-1 text-sm rounded-lg transition-colors ".concat(u?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:u?"Live":"Paused"}),(0,ze.jsxs)("button",{onClick:m,className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]})]})]}),(0,ze.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:n.length>0?n.filter(e=>"all"===c||e.category===c).map((e,t)=>{const n=(i=e.type,{booking_created:Nn,trip_started:Sn,trip_completed:xd,user_registered:mh,driver_assigned:Em,conductor_assigned:Am,route_created:kn,depot_created:id,payment_received:Mn,system_alert:gd,backup_completed:Dn,maintenance_scheduled:td}[i]||Dn);var i;const r=(e=>({booking_created:"bg-blue-100 text-blue-600",trip_started:"bg-green-100 text-green-600",trip_completed:"bg-green-100 text-green-600",user_registered:"bg-purple-100 text-purple-600",driver_assigned:"bg-indigo-100 text-indigo-600",conductor_assigned:"bg-indigo-100 text-indigo-600",route_created:"bg-orange-100 text-orange-600",depot_created:"bg-teal-100 text-teal-600",payment_received:"bg-green-100 text-green-600",system_alert:"bg-red-100 text-red-600",backup_completed:"bg-blue-100 text-blue-600",maintenance_scheduled:"bg-yellow-100 text-yellow-600"}[e]||"bg-gray-100 text-gray-600"))(e.type);return(0,ze.jsxs)("div",{className:"flex items-start space-x-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,ze.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(r),children:(0,ze.jsx)(n,{className:"w-5 h-5"})}),(0,ze.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.title||e.description||"System Activity"}),(0,ze.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.details||e.message||"No additional details"}),(0,ze.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,ze.jsx)("span",{className:"text-xs text-gray-400",children:e.user||e.actor||"System"}),(0,ze.jsx)("span",{className:"text-xs text-gray-400",children:e.timestamp?new Date(e.timestamp).toLocaleString():e.createdAt?new Date(e.createdAt).toLocaleString():"Just now"})]})]}),"high"===e.priority&&(0,ze.jsx)("div",{className:"flex-shrink-0",children:(0,ze.jsx)(gd,{className:"w-4 h-4 text-red-500"})})]},e._id||t)}):(0,ze.jsxs)("div",{className:"text-center py-8",children:[(0,ze.jsx)(td,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"No recent activities"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400",children:"Activities will appear here as they happen"})]})}),(0,ze.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:(0,ze.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-lg font-bold text-blue-600",children:n.filter(e=>"bookings"===e.category).length}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:"Bookings"})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-lg font-bold text-green-600",children:n.filter(e=>"trips"===e.category).length}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:"Trips"})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-lg font-bold text-purple-600",children:n.filter(e=>"users"===e.category).length}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:"Users"})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-lg font-bold text-orange-600",children:n.filter(e=>"system"===e.category).length}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:"System"})]})]})})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"System Alerts"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(gd,{className:"w-5 h-5 text-yellow-500"}),(0,ze.jsx)("span",{className:"text-sm text-yellow-600 font-medium",children:"2 Active Alerts"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,ze.jsx)(gd,{className:"w-5 h-5 text-yellow-600"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-yellow-800",children:"High CPU Usage"}),(0,ze.jsx)("p",{className:"text-sm text-yellow-700",children:"Server CPU usage is at 85% - consider scaling"})]}),(0,ze.jsx)("span",{className:"text-sm text-yellow-600",children:"2 min ago"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4 p-4 bg-red-50 rounded-lg border border-red-200",children:[(0,ze.jsx)(gd,{className:"w-5 h-5 text-red-600"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-red-800",children:"Database Connection Issues"}),(0,ze.jsx)("p",{className:"text-sm text-red-700",children:"Multiple failed connection attempts detected"})]}),(0,ze.jsx)("span",{className:"text-sm text-red-600",children:"15 min ago"})]})]})]})]})},Im=wn("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Pm=()=>{var e,t,n,r,s,a,o;const[l,c]=(0,i.useState)(null),[d,u]=(0,i.useState)(!0),[h,p]=(0,i.useState)(!1),[m,f]=(0,i.useState)(!1),[g,x]=(0,i.useState)(null);(0,i.useEffect)(()=>{y()},[]);const y=async()=>{try{u(!0);const e=await rh("/api/admin/config");c(e),x(JSON.parse(JSON.stringify(e)))}catch(e){console.error("Failed to fetch config:",e)}finally{u(!1)}},v=()=>!(!g||!l)&&JSON.stringify(g)!==JSON.stringify(l),_=(e,t)=>{const n=e.split(".");c(e=>{const i=Le({},e);let r=i;for(let t=0;t<n.length-1;t++)r=r[n[t]];return r[n[n.length-1]]=t,i})};return d?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-accent"})}):(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,ze.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,ze.jsx)($c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"System Configuration"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage global system settings and features"})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[v()&&(0,ze.jsxs)("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-800 rounded-xl hover:bg-yellow-200 transition-colors",children:[(0,ze.jsx)(gd,{className:"w-4 h-4"}),"View Changes"]}),(0,ze.jsxs)("button",{onClick:()=>{c(JSON.parse(JSON.stringify(g))),f(!1)},disabled:!v(),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),"Reset"]}),(0,ze.jsxs)("button",{onClick:async()=>{try{p(!0),await rh("/api/admin/config",{method:"PUT",body:JSON.stringify(l)}),x(JSON.parse(JSON.stringify(l))),f(!1),alert("Configuration saved successfully!")}catch(e){console.error("Failed to save config:",e),alert("Failed to save configuration")}finally{p(!1)}},disabled:!v()||h,className:"flex items-center gap-2 px-4 py-2 bg-accent text-white rounded-xl hover:bg-accent-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[h?(0,ze.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,ze.jsx)(Im,{className:"w-4 h-4"}),h?"Saving...":"Save Changes"]})]})]})}),(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,ze.jsx)(An,{className:"w-5 h-5 text-accent"}),"Authentication Settings"]}),(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"JWT Expiry (minutes)"}),(0,ze.jsx)("input",{type:"number",min:"5",max:"1440",value:(null===l||void 0===l?void 0:l.jwtExpiryMinutes)||30,onChange:e=>_("jwtExpiryMinutes",parseInt(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-accent focus:border-transparent"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Token validity period in minutes (5-1440)"})]})})]}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,ze.jsx)(Mu,{className:"w-5 h-5 text-accent"}),"CORS Origins"]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allowed Origins (one per line)"}),(0,ze.jsx)("textarea",{value:(null===l||void 0===l||null===(e=l.corsOrigins)||void 0===e?void 0:e.join("\n"))||"",onChange:e=>_("corsOrigins",e.target.value.split("\n").filter(e=>e.trim())),rows:4,placeholder:"http://localhost:3000\nhttps://yourdomain.com",className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-accent focus:border-transparent"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"One origin per line. Leave empty to allow all origins."})]})]}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,ze.jsx)(Pn,{className:"w-5 h-5 text-accent"}),"Feature Toggles"]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)(En,{className:"w-5 h-5 text-blue-600"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Passenger Module"})]}),(0,ze.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:(null===l||void 0===l||null===(t=l.features)||void 0===t?void 0:t.pax)||!1,onChange:e=>_("features.pax",e.target.checked),className:"sr-only peer"}),(0,ze.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)(Sn,{className:"w-5 h-5 text-green-600"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Driver Module"})]}),(0,ze.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:(null===l||void 0===l||null===(n=l.features)||void 0===n?void 0:n.driver)||!1,onChange:e=>_("features.driver",e.target.checked),className:"sr-only peer"}),(0,ze.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"})]})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)(En,{className:"w-5 h-5 text-purple-600"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Conductor Module"})]}),(0,ze.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:(null===l||void 0===l||null===(r=l.features)||void 0===r?void 0:r.occ)||!1,onChange:e=>_("features.occ",e.target.checked),className:"sr-only peer"}),(0,ze.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)(Cn,{className:"w-5 h-5 text-orange-600"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"ETM Module"})]}),(0,ze.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:(null===l||void 0===l||null===(s=l.features)||void 0===s?void 0:s.etm)||!1,onChange:e=>_("features.etm",e.target.checked),className:"sr-only peer"}),(0,ze.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"})]})]})]})]})]}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,ze.jsx)(gd,{className:"w-5 h-5 text-accent"}),"Maintenance Mode"]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Enable Maintenance Mode"}),(0,ze.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:(null===l||void 0===l||null===(a=l.maintenance)||void 0===a?void 0:a.enabled)||!1,onChange:e=>_("maintenance.enabled",e.target.checked),className:"sr-only peer"}),(0,ze.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maintenance Message"}),(0,ze.jsx)("textarea",{value:(null===l||void 0===l||null===(o=l.maintenance)||void 0===o?void 0:o.message)||"",onChange:e=>_("maintenance.message",e.target.value),rows:3,placeholder:"System is under maintenance. Please try again later.",className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-accent focus:border-transparent"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Message displayed to users when maintenance mode is enabled"})]})]})]})]})]}),m&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Configuration Changes"}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,ze.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Before:"}),(0,ze.jsx)("pre",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:JSON.stringify(g,null,2)})]}),(0,ze.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,ze.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"After:"}),(0,ze.jsx)("pre",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:JSON.stringify(l,null,2)})]})]}),(0,ze.jsx)("div",{className:"flex justify-end gap-3 mt-6",children:(0,ze.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors",children:"Close"})})]})})]})},Rm=wn("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Lm=wn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),zm=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(""),[u,h]=(0,i.useState)("all"),[p,m]=(0,i.useState)("all"),[f,g]=(0,i.useState)(!1),[x,y]=(0,i.useState)(null),[v,_]=(0,i.useState)(!1),[b,w]=(0,i.useState)([]),[j,N]=(0,i.useState)({name:"",description:"",routeId:"",depotId:"",baseFare:"",distanceFare:"",timeFare:"",peakHourMultiplier:1.2,weekendMultiplier:1.1,holidayMultiplier:1.3,studentDiscount:.1,seniorDiscount:.15,groupDiscount:.05,advanceBookingDiscount:.05,cancellationFee:.1,refundPolicy:"partial",validityStart:"",validityEnd:"",isActive:!0,conditions:[]});(0,i.useEffect)(()=>{S(),k(),T()},[]);const S=async()=>{try{l(!0),console.log("\ud83d\udcb0 Fetching fare policies...");const e=await fetch("/api/admin/fare-policies",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 Fare policies response:",e.status),e.ok){const n=await e.json();console.log("\ud83d\udcca Fare policies data:",n),t(n.policies||[])}else console.error("\u274c Fare policies failed:",e.status),t([{_id:"1",name:"City Center to Airport",description:"Standard fare policy for city to airport route",routeId:"route1",routeName:"City Center - Airport",depotId:"depot1",depotName:"Central Depot",baseFare:150,distanceFare:5,timeFare:2,peakHourMultiplier:1.2,weekendMultiplier:1.1,holidayMultiplier:1.3,studentDiscount:.1,seniorDiscount:.15,groupDiscount:.05,advanceBookingDiscount:.05,cancellationFee:.1,refundPolicy:"partial",validityStart:"2024-01-01",validityEnd:"2024-12-31",isActive:!0,conditions:["Valid ID required for discounts","Advance booking 24 hours"],createdAt:new Date,updatedAt:new Date},{_id:"2",name:"Intercity Express",description:"Premium fare policy for intercity routes",routeId:"route2",routeName:"City A - City B",depotId:"depot2",depotName:"North Depot",baseFare:300,distanceFare:8,timeFare:3,peakHourMultiplier:1.3,weekendMultiplier:1.2,holidayMultiplier:1.5,studentDiscount:.15,seniorDiscount:.2,groupDiscount:.1,advanceBookingDiscount:.08,cancellationFee:.15,refundPolicy:"full",validityStart:"2024-01-01",validityEnd:"2024-12-31",isActive:!0,conditions:["Minimum 2 passengers for group discount","Refund within 2 hours"],createdAt:new Date,updatedAt:new Date}])}catch(e){console.error("\ud83d\udca5 Error fetching fare policies:",e)}finally{l(!1)}},k=async()=>{try{const e=await fetch("/api/routes",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();r(t.data||[])}else r([{_id:"route1",routeNumber:"R001",startingPoint:{city:"City Center"},endingPoint:{city:"Airport"}},{_id:"route2",routeNumber:"R002",startingPoint:{city:"City A"},endingPoint:{city:"City B"}}])}catch(e){console.error("Error fetching routes:",e)}},T=async()=>{try{const e=await fetch("/api/admin/depots",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();a(t.depots||[])}else a([{_id:"depot1",depotName:"Central Depot",depotCode:"CD"},{_id:"depot2",depotName:"North Depot",depotCode:"ND"}])}catch(e){console.error("Error fetching depots:",e)}},C=()=>{N({name:"",description:"",routeId:"",depotId:"",baseFare:"",distanceFare:"",timeFare:"",peakHourMultiplier:1.2,weekendMultiplier:1.1,holidayMultiplier:1.3,studentDiscount:.1,seniorDiscount:.15,groupDiscount:.05,advanceBookingDiscount:.05,cancellationFee:.1,refundPolicy:"partial",validityStart:"",validityEnd:"",isActive:!0,conditions:[]})},E=e.filter(e=>{const t=e.name.toLowerCase().includes(c.toLowerCase())||e.description.toLowerCase().includes(c.toLowerCase()),n="all"===u||e.depotId===u,i="all"===p||"active"===p&&e.isActive||"inactive"===p&&!e.isActive;return t&&n&&i}),A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=parseFloat(e.baseFare)+parseFloat(e.distanceFare)*t;return n&&(s*=e.peakHourMultiplier),i&&(s*=e.weekendMultiplier),r&&(s*=e.holidayMultiplier),Math.round(s)};return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsx)("div",{className:"px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Fare Policy Management"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage pricing rules and fare policies for all routes"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("button",{onClick:S,className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:(0,ze.jsx)(Lu,{className:"w-5 h-5"})}),(0,ze.jsxs)("button",{onClick:async()=>{try{console.log("\ud83e\uddea Testing Fare Policy API...");const t=await fetch("/api/admin/fare-policies",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 Fare Policy API response:",t.status),t.ok){var e;const n=await t.json();console.log("\ud83d\udcca Fare Policy data:",n),alert("Fare Policy API working! Found ".concat((null===(e=n.policies)||void 0===e?void 0:e.length)||0," policies."))}else alert("Fare Policy API failed: ".concat(t.status))}catch(t){console.error("\u274c Fare Policy API error:",t),alert("Fare Policy API error: "+t.message)}},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Mn,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Test API"})]}),(0,ze.jsxs)("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mh,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"New Policy"})]})]})]})})}),(0,ze.jsxs)("div",{className:"px-6 py-6 space-y-6",children:[(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search policies...",value:c,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Depots"}),s.map(e=>(0,ze.jsx)("option",{value:e._id,children:e.depotName},e._id))]}),(0,ze.jsxs)("select",{value:p,onChange:e=>m(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,ze.jsxs)("button",{onClick:()=>_(!v),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center space-x-2",children:[(0,ze.jsx)(Pn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Bulk Edit"})]})]})}),(0,ze.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:E.map(n=>(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[(0,ze.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:n.name}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:n.description}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,ze.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:n.routeName||"Route"}),(0,ze.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:n.depotName||"Depot"}),(0,ze.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(n.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:n.isActive?"Active":"Inactive"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)("button",{onClick:()=>(e=>{y(e),N({name:e.name,description:e.description,routeId:e.routeId,depotId:e.depotId,baseFare:e.baseFare,distanceFare:e.distanceFare,timeFare:e.timeFare,peakHourMultiplier:e.peakHourMultiplier,weekendMultiplier:e.weekendMultiplier,holidayMultiplier:e.holidayMultiplier,studentDiscount:e.studentDiscount,seniorDiscount:e.seniorDiscount,groupDiscount:e.groupDiscount,advanceBookingDiscount:e.advanceBookingDiscount,cancellationFee:e.cancellationFee,refundPolicy:e.refundPolicy,validityStart:e.validityStart,validityEnd:e.validityEnd,isActive:e.isActive,conditions:e.conditions||[]})})(n),className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(async n=>{if(window.confirm("Are you sure you want to delete this fare policy?"))try{l(!0),console.log("\ud83d\udcb0 Deleting fare policy:",n);const i=await fetch("/api/admin/fare-policies/".concat(n),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});i.ok?(console.log("\u2705 Fare policy deleted"),t(e.filter(e=>e._id!==n)),alert("Fare policy deleted successfully!")):(console.error("\u274c Delete failed:",i.status),alert("Failed to delete fare policy"))}catch(i){console.error("\ud83d\udca5 Delete error:",i),alert("Error deleting fare policy: "+i.message)}finally{l(!1)}})(n._id),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})})]})]}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Base Fare"}),(0,ze.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["\u20b9",n.baseFare]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Distance Rate"}),(0,ze.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["\u20b9",n.distanceFare,"/km"]})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Peak Hour"}),(0,ze.jsxs)("p",{className:"text-sm font-medium text-orange-600",children:["+",Math.round(100*(n.peakHourMultiplier-1)),"%"]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Weekend"}),(0,ze.jsxs)("p",{className:"text-sm font-medium text-blue-600",children:["+",Math.round(100*(n.weekendMultiplier-1)),"%"]})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Student Discount"}),(0,ze.jsxs)("p",{className:"text-sm font-medium text-green-600",children:["-",Math.round(100*n.studentDiscount),"%"]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Senior Discount"}),(0,ze.jsxs)("p",{className:"text-sm font-medium text-green-600",children:["-",Math.round(100*n.seniorDiscount),"%"]})]})]}),(0,ze.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,ze.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Sample Fare (10km, Peak Hour)"}),(0,ze.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["\u20b9",A(n,10,!0,!1,!1)]})]})]}),(0,ze.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,ze.jsxs)("span",{children:["Valid From: ",new Date(n.validityStart).toLocaleDateString()]}),(0,ze.jsxs)("span",{children:["To: ",new Date(n.validityEnd).toLocaleDateString()]})]})})]},n._id))}),0===E.length&&(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(Mn,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No fare policies found"}),(0,ze.jsx)("p",{className:"text-gray-600 mb-4",children:"Create your first fare policy to get started"}),(0,ze.jsx)("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Fare Policy"})]})]}),(f||x)&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,ze.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:x?"Edit Fare Policy":"Create New Fare Policy"}),(0,ze.jsx)("button",{onClick:()=>{g(!1),y(null),C()},className:"text-gray-400 hover:text-gray-600",children:(0,ze.jsx)(Fn,{className:"w-6 h-6"})})]})}),(0,ze.jsxs)("div",{className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Name"}),(0,ze.jsx)("input",{type:"text",value:j.name,onChange:e=>N(Le(Le({},j),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter policy name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route"}),(0,ze.jsxs)("select",{value:j.routeId,onChange:e=>N(Le(Le({},j),{},{routeId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Select Route"}),n.map(e=>{var t,n;return(0,ze.jsxs)("option",{value:e._id,children:[e.routeNumber," - ",null===(t=e.startingPoint)||void 0===t?void 0:t.city," to ",null===(n=e.endingPoint)||void 0===n?void 0:n.city]},e._id)})]})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,ze.jsx)("textarea",{value:j.description,onChange:e=>N(Le(Le({},j),{},{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Enter policy description"})]}),(0,ze.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Fare Structure"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Base Fare (\u20b9)"}),(0,ze.jsx)("input",{type:"number",value:j.baseFare,onChange:e=>N(Le(Le({},j),{},{baseFare:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Distance Rate (\u20b9/km)"}),(0,ze.jsx)("input",{type:"number",value:j.distanceFare,onChange:e=>N(Le(Le({},j),{},{distanceFare:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Rate (\u20b9/min)"}),(0,ze.jsx)("input",{type:"number",value:j.timeFare,onChange:e=>N(Le(Le({},j),{},{timeFare:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0"})]})]})]}),(0,ze.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Fare Multipliers"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Peak Hour Multiplier"}),(0,ze.jsx)("input",{type:"number",step:"0.1",value:j.peakHourMultiplier,onChange:e=>N(Le(Le({},j),{},{peakHourMultiplier:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weekend Multiplier"}),(0,ze.jsx)("input",{type:"number",step:"0.1",value:j.weekendMultiplier,onChange:e=>N(Le(Le({},j),{},{weekendMultiplier:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Holiday Multiplier"}),(0,ze.jsx)("input",{type:"number",step:"0.1",value:j.holidayMultiplier,onChange:e=>N(Le(Le({},j),{},{holidayMultiplier:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),(0,ze.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Discounts"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student Discount (%)"}),(0,ze.jsx)("input",{type:"number",step:"0.01",value:100*j.studentDiscount,onChange:e=>N(Le(Le({},j),{},{studentDiscount:parseFloat(e.target.value)/100})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senior Discount (%)"}),(0,ze.jsx)("input",{type:"number",step:"0.01",value:100*j.seniorDiscount,onChange:e=>N(Le(Le({},j),{},{seniorDiscount:parseFloat(e.target.value)/100})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Group Discount (%)"}),(0,ze.jsx)("input",{type:"number",step:"0.01",value:100*j.groupDiscount,onChange:e=>N(Le(Le({},j),{},{groupDiscount:parseFloat(e.target.value)/100})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Advance Booking Discount (%)"}),(0,ze.jsx)("input",{type:"number",step:"0.01",value:100*j.advanceBookingDiscount,onChange:e=>N(Le(Le({},j),{},{advanceBookingDiscount:parseFloat(e.target.value)/100})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valid From"}),(0,ze.jsx)("input",{type:"date",value:j.validityStart,onChange:e=>N(Le(Le({},j),{},{validityStart:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valid Until"}),(0,ze.jsx)("input",{type:"date",value:j.validityEnd,onChange:e=>N(Le(Le({},j),{},{validityEnd:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(0,ze.jsx)("div",{className:"flex items-center space-x-4",children:(0,ze.jsxs)("label",{className:"flex items-center",children:[(0,ze.jsx)("input",{type:"checkbox",checked:j.isActive,onChange:e=>N(Le(Le({},j),{},{isActive:e.target.checked})),className:"mr-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Active Policy"})]})})]}),(0,ze.jsxs)("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>{g(!1),y(null),C()},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsxs)("button",{onClick:x?async()=>{try{l(!0),console.log("\ud83d\udcb0 Updating fare policy:",x._id,j);const n=await fetch("/api/admin/fare-policies/".concat(x._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(j)});if(n.ok){const i=await n.json();console.log("\u2705 Fare policy updated:",i),t(e.map(e=>e._id===x._id?i.policy:e)),y(null),C(),alert("Fare policy updated successfully!")}else console.error("\u274c Update failed:",n.status),alert("Failed to update fare policy")}catch(n){console.error("\ud83d\udca5 Update error:",n),alert("Error updating fare policy: "+n.message)}finally{l(!1)}}:async()=>{try{l(!0),console.log("\ud83d\udcb0 Creating fare policy:",j);const n=await fetch("/api/admin/fare-policies",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(j)});if(n.ok){const i=await n.json();console.log("\u2705 Fare policy created:",i),t([...e,i.policy]),g(!1),C(),alert("Fare policy created successfully!")}else console.error("\u274c Create failed:",n.status),alert("Failed to create fare policy")}catch(n){console.error("\ud83d\udca5 Create error:",n),alert("Error creating fare policy: "+n.message)}finally{l(!1)}},disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[o?(0,ze.jsx)(Lu,{className:"w-4 h-4 animate-spin"}):(0,ze.jsx)(Im,{className:"w-4 h-4"}),(0,ze.jsxs)("span",{children:[x?"Update":"Create"," Policy"]})]})]})]})})]})},Om=wn("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Fm=wn("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Bm=wn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Vm=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)("all"),[u,h]=(0,i.useState)("all"),[p,m]=(0,i.useState)([]),[f,g]=(0,i.useState)(!1),[x,y]=(0,i.useState)(null),[v,_]=(0,i.useState)(null),[b,w]=(0,i.useState)(!1),[j,N]=(0,i.useState)(null),[S,k]=(0,i.useState)({name:"",email:"",phone:"",role:"passenger",status:"active",password:"",address:"",emergencyContact:"",dateOfBirth:"",gender:""});(0,i.useEffect)(()=>{T()},[]),(0,i.useEffect)(()=>{C()},[e,o,c,u]);const T=async()=>{try{a(!0);const e=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const n=await e.json();t(n.users||[])}else console.error("Failed to fetch users")}catch(e){console.error("Error fetching users:",e)}finally{a(!1)}},C=()=>{if(!Array.isArray(e))return void r([]);let t=[...e];o&&(t=t.filter(e=>{var t,n,i;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(o.toLowerCase()))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(o.toLowerCase()))||(null===(i=e.phone)||void 0===i?void 0:i.includes(o))})),"all"!==c&&(t=t.filter(e=>e.role===c)),"all"!==u&&(t=t.filter(e=>e.status===u)),r(t)},E=()=>{k({name:"",email:"",phone:"",role:"passenger",status:"active",password:"",address:"",emergencyContact:"",dateOfBirth:"",gender:""})},A=e=>{const t={admin:{color:"bg-red-100 text-red-800 border-red-200",label:"Admin",icon:An},passenger:{color:"bg-blue-100 text-blue-800 border-blue-200",label:"Passenger",icon:Nn},driver:{color:"bg-green-100 text-green-800 border-green-200",label:"Driver",icon:Sn},conductor:{color:"bg-purple-100 text-purple-800 border-purple-200",label:"Conductor",icon:kn},depot_manager:{color:"bg-orange-100 text-orange-800 border-orange-200",label:"Depot Manager",icon:Cn}}[e]||{color:"bg-gray-100 text-gray-800 border-gray-200",label:e,icon:Nn},n=t.icon;return(0,ze.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(t.color," flex items-center gap-1"),children:[(0,ze.jsx)(n,{className:"w-3 h-3"}),t.label]})},M=e=>{const t={active:{color:"bg-green-100 text-green-800 border-green-200",label:"Active",icon:xd},inactive:{color:"bg-gray-100 text-gray-800 border-gray-200",label:"Inactive",icon:Om},suspended:{color:"bg-red-100 text-red-800 border-red-200",label:"Suspended",icon:Fm},pending:{color:"bg-yellow-100 text-yellow-800 border-yellow-200",label:"Pending",icon:td}}[e]||{color:"bg-gray-100 text-gray-800 border-gray-200",label:e,icon:gd},n=t.icon;return(0,ze.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(t.color," flex items-center gap-1"),children:[(0,ze.jsx)(n,{className:"w-3 h-3"}),t.label]})};return s?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"text-center lg:text-left",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Yatrik User Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage all users and their roles in the system"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:()=>{const e=[["Name","Email","Phone","Role","Status","Address","Created Date"].join(","),...n.map(e=>[e.name,e.email,e.phone,e.role,e.status,e.address,new Date(e.createdAt).toLocaleDateString()].join(","))].join("\n"),t=new Blob([e],{type:"text/csv"}),i=window.URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download="users_".concat((new Date).toISOString().split("T")[0],".csv"),r.click(),window.URL.revokeObjectURL(i),alert("Users exported successfully")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Export"})]}),(0,ze.jsxs)("button",{onClick:()=>g(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mh,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Add User"})]})]})]}),(0,ze.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:(0,ze.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,ze.jsx)("div",{className:"flex-1",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search users by name, email, phone, or address...",value:o,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,ze.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Roles"}),(0,ze.jsx)("option",{value:"admin",children:"Admin"}),(0,ze.jsx)("option",{value:"passenger",children:"Passenger"}),(0,ze.jsx)("option",{value:"driver",children:"Driver"}),(0,ze.jsx)("option",{value:"conductor",children:"Conductor"}),(0,ze.jsx)("option",{value:"depot_manager",children:"Depot Manager"})]}),(0,ze.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"}),(0,ze.jsx)("option",{value:"pending",children:"Pending"})]}),(0,ze.jsxs)("button",{onClick:T,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]})]})}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsx)("div",{className:"overflow-x-auto",children:(0,ze.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,ze.jsx)("thead",{className:"bg-gray-50",children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,ze.jsx)("input",{type:"checkbox",checked:Array.isArray(n)&&p.length===n.length&&n.length>0,onChange:e=>{e.target.checked&&Array.isArray(n)?m(n.map(e=>e._id)):m([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,ze.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Array.isArray(n)&&n.map(e=>{var t,n;return(0,ze.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsx)("input",{type:"checkbox",checked:p.includes(e._id),onChange:t=>{t.target.checked?m([...p,e._id]):m(p.filter(t=>t!==e._id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-semibold text-lg",children:(null===(t=e.name)||void 0===t||null===(n=t.charAt(0))||void 0===n?void 0:n.toUpperCase())||"U"})}),(0,ze.jsxs)("div",{className:"ml-4",children:[(0,ze.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:e.name}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e._id.slice(-8)]}),e.address&&(0,ze.jsxs)("div",{className:"text-xs text-gray-400 flex items-center mt-1",children:[(0,ze.jsx)(id,{className:"w-3 h-3 mr-1"}),e.address]})]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:A(e.role)}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:M(e.status)}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"space-y-1",children:[(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-900",children:[(0,ze.jsx)(Bm,{className:"w-4 h-4 mr-2 text-gray-400"}),e.email]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(rd,{className:"w-4 h-4 mr-2 text-gray-400"}),e.phone]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)(Tn,{className:"w-4 h-4 mr-2 text-gray-400"}),new Date(e.createdAt).toLocaleDateString()]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>(e=>{_(e)})(e),className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-50 transition-colors",title:"View Details",children:(0,ze.jsx)(xh,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(e=>{y(e),k({name:e.name||"",email:e.email||"",phone:e.phone||"",role:e.role||"passenger",status:e.status||"active",password:"",address:e.address||"",emergencyContact:e.emergencyContact||"",dateOfBirth:e.dateOfBirth||"",gender:e.gender||""})})(e),className:"text-green-600 hover:text-green-900 p-2 rounded-lg hover:bg-green-50 transition-colors",title:"Edit User",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(e=>{N(e),w(!0)})(e),className:"text-red-600 hover:text-red-900 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Delete User",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})})]})})]},e._id)})})]})}),(!Array.isArray(n)||0===n.length)&&(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(Nn,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:Array.isArray(n)?"No users found":"Loading users..."}),(0,ze.jsx)("p",{className:"text-gray-500 mb-6",children:Array.isArray(n)?o||"all"!==c||"all"!==u?"Try adjusting your filters or search terms.":"Get started by creating your first user.":"Please wait while we fetch user data..."}),Array.isArray(n)&&0===n.length&&(0,ze.jsxs)("button",{onClick:()=>g(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,ze.jsx)(mh,{className:"w-4 h-4 inline mr-2"}),"Add First User"]})]})]}),(f||x)&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,ze.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:x?"Edit User":"Create New User"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-2",children:x?"Update user information and permissions":"Add a new user to the system"})]}),(0,ze.jsxs)("form",{onSubmit:x?async e=>{e.preventDefault();try{const e=await fetch("/api/admin/users/".concat(x._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(S)});if(e.ok)alert("User updated successfully"),y(null),E(),T();else{const t=await e.json();alert(t.error||"Failed to update user")}}catch(t){console.error("Error updating user:",t),alert("Error updating user")}}:async e=>{e.preventDefault();try{const e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(S)});if(e.ok)alert("User created successfully"),g(!1),E(),l(""),d("all"),h("all"),T();else{const t=await e.json();alert(t.error||"Failed to create user")}}catch(t){console.error("Error creating user:",t),alert("Error creating user")}},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:S.name,onChange:e=>k(t=>Le(Le({},t),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter full name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,ze.jsx)("input",{type:"email",required:!0,value:S.email,onChange:e=>k(t=>Le(Le({},t),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email address"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),(0,ze.jsx)("input",{type:"tel",required:!0,value:S.phone,onChange:e=>k(t=>Le(Le({},t),{},{phone:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter phone number"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),(0,ze.jsxs)("select",{required:!0,value:S.role,onChange:e=>k(t=>Le(Le({},t),{},{role:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"passenger",children:"Passenger"}),(0,ze.jsx)("option",{value:"driver",children:"Driver"}),(0,ze.jsx)("option",{value:"conductor",children:"Conductor"}),(0,ze.jsx)("option",{value:"depot_manager",children:"Depot Manager"}),(0,ze.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,ze.jsxs)("select",{value:S.status,onChange:e=>k(t=>Le(Le({},t),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"}),(0,ze.jsx)("option",{value:"pending",children:"Pending"})]})]}),!x&&(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,ze.jsx)("input",{type:"password",required:!0,value:S.password,onChange:e=>k(t=>Le(Le({},t),{},{password:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter password"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>{g(!1),y(null),E()},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:x?"Update User":"Create User"})]})]})]})}),b&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(gd,{className:"w-6 h-6 text-red-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete User"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"This action cannot be undone."})]})]}),(0,ze.jsxs)("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to delete ",(0,ze.jsx)("strong",{children:null===j||void 0===j?void 0:j.name}),"? This will permanently remove their account and all associated data."]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{onClick:async()=>{if(j)try{const e=await fetch("/api/admin/users/".concat(j._id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok)alert("User deleted successfully"),w(!1),N(null),T();else{const t=await e.json();alert(t.error||"Failed to delete user")}}catch(e){console.error("Error deleting user:",e),alert("Error deleting user")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete User"})]})]})})})]})},Um=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")},Hm=(e,t)=>{const n=Um(e)||Um(t)||"depot";return"depot-".concat(n,"@yatrik.com")},qm=()=>{var e,t,n,r,s,a,o,l,c,d,u,h,p;const m=te(),[f,g]=(0,i.useState)([]),[x,y]=(0,i.useState)([]),[v,_]=(0,i.useState)(!0),[b,w]=(0,i.useState)(null),[j,N]=(0,i.useState)(!1),[S,k]=(0,i.useState)(!1),[T,C]=(0,i.useState)(!1),[E,A]=(0,i.useState)(null),[M,D]=(0,i.useState)(!1),[I,P]=(0,i.useState)(null),[R,L]=(0,i.useState)(!1),[z,O]=(0,i.useState)(""),[F,B]=(0,i.useState)("all"),[V,U]=(0,i.useState)({code:"",name:"",address:{street:"",city:"",state:"",pincode:""},contact:{phone:"",email:""},manager:"",capacity:{buses:0,staff:0},status:"active",createLogin:!1,login:{email:"",password:""}});(0,i.useEffect)(()=>{if(!V.createLogin)return;const e=Hm(V.code,V.name);U(t=>Le(Le({},t),{},{login:Le(Le({},t.login),{},{email:e})}))},[V.createLogin,V.name,V.code]),(0,i.useEffect)(()=>{H()},[R]),(0,i.useEffect)(()=>{const e=setInterval(()=>{H(!0)},3e4);return()=>clearInterval(e)},[R]);const H=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{_(!0),e||sh();const i=Date.now(),[r,s]=await Promise.all([rh("/api/admin/depots?showAll=".concat(R,"&_=").concat(i)),rh("/api/admin/users?_=".concat(i))]);if(null!==r&&void 0!==r&&r.ok){var t;const e=r.data||{},n=(e.depots||(null===(t=e.data)||void 0===t?void 0:t.depots)||[]||[]).map(e=>({_id:e._id||e.id,code:e.code||e.depotCode||"",name:e.name||e.depotName||e.code||"Depot",address:e.address||e.location||{},contact:e.contact||{},manager:e.manager||e.createdBy||null,capacity:e.capacity||{buses:0,staff:0},status:e.status||"active",createdAt:e.createdAt}));g(n)}else g([]);if(null!==s&&void 0!==s&&s.ok){var n;const e=s.data||{},t=(e.users||(null===(n=e.data)||void 0===n?void 0:n.users)||[]||[]).map(e=>{var t;return{_id:e._id||e.id,name:e.name||e.fullName||"Unnamed",email:e.email||"",phone:e.phone||"",role:e.role||"user",depotId:e.depotId||("object"===typeof e.depot?null===(t=e.depot)||void 0===t?void 0:t._id:e.depot)||null,status:e.status||"active"}});y(t)}else y([])}catch(i){console.error("\u274c Error fetching data:",i),alert("Network error while fetching data. Please check your connection.")}finally{_(!1)}},q=e=>{var t,n;w(e),U({code:e.depotCode||e.code||"",name:e.depotName||e.name||"",address:e.location||e.address||{street:"",city:"",state:"",pincode:""},contact:e.contact||{phone:"",email:""},manager:(null===(t=e.contact)||void 0===t||null===(n=t.manager)||void 0===n?void 0:n.name)||e.manager||"",capacity:e.capacity||{buses:0,staff:0},status:e.status||"active",createLogin:!1,login:{email:"",password:""}})},W=()=>{U({code:"",name:"",address:{street:"",city:"",state:"",pincode:""},contact:{phone:"",email:""},manager:"",capacity:{buses:0,staff:0},status:"active",createLogin:!1,login:{email:"",password:""}})},G=e=>x.filter(t=>t.depotId===e&&["conductor","driver","depot_manager"].includes(t.role)),Y=e=>{const t={active:{color:"bg-green-100 text-green-800 border-green-200",icon:xd},inactive:{color:"bg-red-100 text-red-800 border-red-200",icon:Fm}}[e]||{color:"bg-gray-100 text-gray-800 border-gray-200",icon:gd},n=t.icon;return(0,ze.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(t.color," flex items-center gap-1"),children:[(0,ze.jsx)(n,{className:"w-3 h-3"}),e]})},Z=e=>{const t={conductor:{color:"bg-purple-100 text-purple-800 border-purple-200",label:"Conductor"},driver:{color:"bg-green-100 text-green-800 border-green-200",label:"Driver"},depot_manager:{color:"bg-orange-100 text-orange-800 border-orange-200",label:"Depot Manager"}}[e]||{color:"bg-gray-100 text-gray-800 border-gray-200",label:e};return(0,ze.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(t.color),children:t.label})};return v?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Depot Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage bus depots and provision depot manager login"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:H,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",title:"Refresh data",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]}),(0,ze.jsxs)("button",{onClick:()=>{const e=[["Depot Code","Depot Name","Address","Phone","Email","Manager","Capacity","Status","Conductors","Drivers","Depot Managers"].join(","),...f.map(e=>{var t,n,i,r,s,a,o;const l=G(e._id),c=l.filter(e=>"conductor"===e.role).length,d=l.filter(e=>"driver"===e.role).length,u=l.filter(e=>"depot_manager"===e.role).length,h=null!==(t=e.address)&&void 0!==t&&t.street?"".concat(e.address.street,", ").concat(e.address.city,", ").concat(e.address.state," - ").concat(e.address.pincode):"Address not available";return[e.depotCode||e.code,e.depotName||e.name,h,(null===(n=e.contact)||void 0===n?void 0:n.phone)||"N/A",(null===(i=e.contact)||void 0===i?void 0:i.email)||"N/A",(null===(r=e.contact)||void 0===r||null===(s=r.manager)||void 0===s?void 0:s.name)||e.manager||"N/A",null!==(a=e.capacity)&&void 0!==a&&a.totalBuses||null!==(o=e.capacity)&&void 0!==o&&o.buses?"".concat(e.capacity.totalBuses||e.capacity.buses," buses"):"N/A",e.status,c,d,u].join(",")})].join("\n"),t=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download="depots_".concat((new Date).toISOString().split("T")[0],".csv"),i.click(),window.URL.revokeObjectURL(n),alert("Depot data exported successfully")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",title:"Export depot data",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Export"})]}),(0,ze.jsxs)("button",{onClick:()=>m("/admin/depot-management"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mh,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Add Depot"})]})]})]}),(0,ze.jsx)("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:(0,ze.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,ze.jsx)("div",{className:"flex-1",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search depots by name, code, or address...",value:z,onChange:e=>O(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,ze.jsxs)("select",{value:F,onChange:e=>B(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Roles"}),(0,ze.jsx)("option",{value:"conductor",children:"Conductors"}),(0,ze.jsx)("option",{value:"driver",children:"Drivers"}),(0,ze.jsx)("option",{value:"depot_manager",children:"Depot Managers"})]}),(0,ze.jsxs)("select",{value:V.status,onChange:e=>U(t=>Le(Le({},t),{},{status:e.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,ze.jsxs)("button",{onClick:()=>L(!R),className:"px-4 py-2 border rounded-lg transition-colors flex items-center space-x-2 ".concat(R?"bg-gray-800 text-white border-gray-800 hover:bg-gray-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),title:R?"Hide inactive depots":"Show inactive depots",children:[(0,ze.jsx)(xh,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:R?"Hide Inactive":"Show Inactive"})]}),(0,ze.jsxs)("button",{onClick:H,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]})]})}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("div",{className:"flex items-center justify-end",children:(0,ze.jsxs)("button",{onClick:()=>{H()},className:"px-3 py-2 text-sm bg-gray-100 rounded hover:bg-gray-200 flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]})}),f.filter(e=>{var t,n,i,r,s,a,o,l;return!z||(e.depotName||e.name||"").toLowerCase().includes(z.toLowerCase())||(e.depotCode||e.code||"").toLowerCase().includes(z.toLowerCase())||((null===(t=e.location)||void 0===t?void 0:t.address)||(null===(n=e.address)||void 0===n?void 0:n.street)||"").toLowerCase().includes(z.toLowerCase())||((null===(i=e.location)||void 0===i?void 0:i.city)||(null===(r=e.address)||void 0===r?void 0:r.city)||"").toLowerCase().includes(z.toLowerCase())||((null===(s=e.location)||void 0===s?void 0:s.state)||(null===(a=e.address)||void 0===a?void 0:a.state)||"").toLowerCase().includes(z.toLowerCase())||((null===(o=e.location)||void 0===o?void 0:o.pincode)||(null===(l=e.address)||void 0===l?void 0:l.pincode)||"").toLowerCase().includes(z.toLowerCase())}).map(e=>{var t,n,i,r,s,a,o,l,c,d,u,h,p;const m=G(e._id),f="all"===F?m:m.filter(e=>e.role===F);return(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:(0,ze.jsx)(Cn,{className:"w-6 h-6 text-white"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,ze.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:e.depotName||e.name}),Y(e.status)]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,ze.jsxs)("span",{className:"font-medium",children:["Code: ",e.depotCode||e.code]}),(0,ze.jsxs)("span",{className:"flex items-center",children:[(0,ze.jsx)(id,{className:"w-4 h-4 mr-1"}),null!==(t=e.location)&&void 0!==t&&t.address||null!==(n=e.address)&&void 0!==n&&n.street?"".concat((null===(i=e.location)||void 0===i?void 0:i.address)||(null===(r=e.address)||void 0===r?void 0:r.street),", ").concat((null===(s=e.location)||void 0===s?void 0:s.city)||(null===(a=e.address)||void 0===a?void 0:a.city),", ").concat((null===(o=e.location)||void 0===o?void 0:o.state)||(null===(l=e.address)||void 0===l?void 0:l.state)," - ").concat((null===(c=e.location)||void 0===c?void 0:c.pincode)||(null===(d=e.address)||void 0===d?void 0:d.pincode)):"Address not available"]}),(null===(u=e.contact)||void 0===u?void 0:u.phone)&&(0,ze.jsxs)("span",{className:"flex items-center",children:[(0,ze.jsx)(rd,{className:"w-4 h-4 mr-1"}),e.contact.phone]})]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:"Capacity"}),(0,ze.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:null!==(h=e.capacity)&&void 0!==h&&h.totalBuses||null!==(p=e.capacity)&&void 0!==p&&p.buses?"".concat(e.capacity.totalBuses||e.capacity.buses," buses"):"N/A"})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:"Staff"}),(0,ze.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:m.length})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>q(e),className:"text-green-600 hover:text-green-900 p-2 rounded-lg hover:bg-green-50 transition-colors",title:"Edit Depot",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(e=>{A(e),C(!0)})(e),className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-50 transition-colors",title:"View Depot",children:(0,ze.jsx)(xh,{className:"w-4 h-4"})}),"active"===e.status?(0,ze.jsx)("button",{onClick:()=>(e=>{P(e),D(!0)})(e),className:"text-red-600 hover:text-red-900 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Depot",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})}):(0,ze.jsx)("button",{onClick:()=>(async e=>{try{const t=await fetch("/api/admin/depots/".concat(e._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(Le(Le({},e),{},{status:"active"}))});if(t.ok)g(t=>t.map(t=>t._id===e._id?Le(Le({},t),{},{status:"active"}):t)),alert("Depot restored successfully");else{const e=await t.json();alert(e.error||"Failed to restore depot")}}catch(t){console.error("Error restoring depot:",t),alert("Error restoring depot")}})(e),className:"text-green-600 hover:text-green-900 p-2 rounded-lg hover:bg-green-50 transition-colors",title:"Restore Depot",children:(0,ze.jsx)(xd,{className:"w-4 h-4"})})]})]})]})}),f.length>0?(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Assigned Staff"}),(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(e=>{var t,n;return(0,ze.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[(0,ze.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-semibold text-sm",children:(null===(t=e.name)||void 0===t||null===(n=t.charAt(0))||void 0===n?void 0:n.toUpperCase())||"U"})}),(0,ze.jsx)("div",{children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,ze.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.email,")"]})]})})]})}),(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[Z(e.role),Y(e.status)]}),(0,ze.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)(rd,{className:"w-3 h-3 mr-1"}),e.phone]})})]},e._id)})})]}):(0,ze.jsxs)("div",{className:"p-6 text-center",children:[(0,ze.jsx)(Nn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"all"===F?"No staff assigned to this depot":"No ".concat(F,"s assigned to this depot")}),(0,ze.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Assign staff members to get started"})]})]},e._id)})]}),0===f.length&&(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(Cn,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No depots found"}),(0,ze.jsx)("p",{className:"text-gray-500 mb-6",children:"Get started by creating your first depot"}),(0,ze.jsxs)("button",{onClick:()=>m("/admin/depot-management"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,ze.jsx)(mh,{className:"w-4 h-4 inline mr-2"}),"Add First Depot"]})]}),(j||b)&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,ze.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:b?"Edit Depot":"Create New Depot"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-2",children:b?"Update depot information":"Add a new depot to the system"})]}),(0,ze.jsxs)("form",{onSubmit:b?async e=>{if(e.preventDefault(),V.code&&V.name&&V.contact.phone)try{const e={depotCode:V.code,depotName:V.name,location:{address:V.address.street||"Address not provided",city:V.address.city||"City not provided",state:V.address.state||"State not provided",pincode:V.address.pincode||"000000"},contact:{phone:V.contact.phone,email:V.contact.email||"".concat(V.code.toLowerCase(),"@yatrik.com"),manager:{name:V.manager||""}},capacity:{totalBuses:parseInt(V.capacity.buses)||25,availableBuses:parseInt(V.capacity.buses)||25,maintenanceBuses:0},operatingHours:{openTime:"06:00",closeTime:"22:00",workingDays:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]},facilities:[],status:V.status},t=await fetch("/api/admin/depots/".concat(b._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(e)});if(t.ok){const e=await t.json();g(t=>t.map(t=>t._id===b._id?e.depot:t)),alert("Depot updated successfully"),w(null),W()}else{const e=await t.json();alert(e.error||"Failed to update depot")}}catch(t){console.error("Error updating depot:",t),alert("Error updating depot")}else alert("Please fill in all required fields (Code, Name, and Phone)")}:async e=>{if(e.preventDefault(),V.code&&V.name&&V.contact.phone)try{const e={depotCode:V.code,depotName:V.name,location:{address:V.address.street||"Address not provided",city:V.address.city||"City not provided",state:V.address.state||"State not provided",pincode:V.address.pincode||"000000"},contact:{phone:V.contact.phone,email:V.contact.email||"".concat(V.code.toLowerCase(),"@yatrik.com"),manager:{name:V.manager||""}},capacity:{totalBuses:parseInt(V.capacity.buses)||25,availableBuses:parseInt(V.capacity.buses)||25,maintenanceBuses:0},operatingHours:{openTime:"06:00",closeTime:"22:00",workingDays:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]},facilities:[],createUserAccount:V.createLogin,userAccount:V.createLogin?{username:V.code.toLowerCase(),email:V.login.email||"".concat(V.code.toLowerCase(),"@yatrik.com"),password:V.login.password,role:"depot_manager",permissions:["manage_buses","view_buses","manage_routes","view_routes"]}:null},r=await fetch("/api/admin/depots",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(e)});if(r.ok){var t;const e=await r.json(),i=(null===e||void 0===e?void 0:e.depot)||(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.depot)||(null===e||void 0===e?void 0:e.data)||e,s=(null===i||void 0===i?void 0:i._id)||(null===i||void 0===i?void 0:i.id);if(g(e=>[i,...e]),V.createLogin){const t=V.login.email||Hm(V.code,V.name),i=V.login.password;if(!i||i.length<8)alert("Please set a temporary password (min 8 chars) for the depot login.");else if(s)try{const e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({name:V.manager||"".concat(V.name," Manager"),email:t,password:i,role:"depot_manager",depotId:s,status:"active"})});if(e.ok)alert("Depot created and login provisioned: ".concat(t));else{let t={};try{t=await e.json()}catch(n){}console.error("Failed to create depot login:",t),alert(t.error||t.message||"Depot created, but failed to create login. Check email uniqueness and password policy.")}}catch(BS){console.error("Network error creating depot login:",BS),alert("Depot created, but network error while creating login.")}else console.error("Could not resolve depotId from create response:",e),alert("Depot created, but could not create login because depotId was missing in the response.")}else alert("Depot created successfully");N(!1),W()}else{let e={};try{e=await r.json()}catch(i){}console.error("Error response creating depot:",e),alert(e.error||e.message||"Failed to create depot")}}catch(r){console.error("Error creating depot:",r),alert("Error creating depot")}else alert("Please fill in all required fields (Code, Name, and Phone)")},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot Code *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:V.code,onChange:e=>U(t=>Le(Le({},t),{},{code:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., TVM, BLR"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot Name *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:V.name,onChange:e=>U(t=>Le(Le({},t),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Trivandrum Depot"})]}),(0,ze.jsxs)("div",{className:"md:col-span-2",children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street Address *"}),(0,ze.jsx)("textarea",{required:!0,value:V.address.street,onChange:e=>U(t=>Le(Le({},t),{},{address:Le(Le({},t.address),{},{street:e.target.value})})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter street address"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:V.address.city,onChange:e=>U(t=>Le(Le({},t),{},{address:Le(Le({},t.address),{},{city:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter city name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:V.address.state,onChange:e=>U(t=>Le(Le({},t),{},{address:Le(Le({},t.address),{},{state:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter state name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pincode *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:V.address.pincode,onChange:e=>U(t=>Le(Le({},t),{},{address:Le(Le({},t.address),{},{pincode:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter pincode",pattern:"[1-9][0-9]{5}",title:"Please enter a valid 6-digit pincode"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),(0,ze.jsx)("input",{type:"tel",required:!0,value:V.contact.phone,onChange:e=>U(t=>Le(Le({},t),{},{contact:Le(Le({},t.contact),{},{phone:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter phone number",pattern:"[6-9][0-9]{9}",title:"Please enter a valid 10-digit phone number starting with 6-9"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,ze.jsx)("input",{type:"email",value:V.login.email,onChange:e=>U(t=>Le(Le({},t),{},{login:Le(Le({},t.login),{},{email:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email address",readOnly:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager"}),(0,ze.jsx)("input",{type:"text",value:V.manager,onChange:e=>U(t=>Le(Le({},t),{},{manager:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter manager name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bus Capacity"}),(0,ze.jsx)("input",{type:"number",min:"0",value:V.capacity.buses,onChange:e=>U(t=>Le(Le({},t),{},{capacity:Le(Le({},t.capacity),{},{buses:parseInt(e.target.value)||0})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter bus capacity"})]})]}),(0,ze.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4 bg-gray-50",children:[(0,ze.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,ze.jsx)("input",{type:"checkbox",className:"rounded",checked:V.createLogin,onChange:e=>U(t=>Le(Le({},t),{},{createLogin:e.target.checked}))}),"Create Depot Manager login now"]}),V.createLogin&&(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Depot Login Email *"}),(0,ze.jsx)("input",{type:"email",required:!0,value:V.login.email,onChange:e=>U(t=>Le(Le({},t),{},{login:Le(Le({},t.login),{},{email:e.target.value})})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"manager@depot.com"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temporary Password *"}),(0,ze.jsx)("input",{type:"password",required:!0,value:V.login.password,onChange:e=>U(t=>Le(Le({},t),{},{login:Le(Le({},t.login),{},{password:e.target.value})})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Set temp password"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Share these credentials with the depot. On first login, they\u2019ll be redirected to the Depot Dashboard."})]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>{N(!1),w(null),W()},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:b?"Update Depot":"Create Depot"})]})]})]})}),T&&E&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Depot Details"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-2",children:"View complete depot information"})]}),(0,ze.jsx)("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600",children:(0,ze.jsx)(Fm,{className:"w-6 h-6"})})]})}),(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Basic Information"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Depot Code"}),(0,ze.jsx)("p",{className:"text-lg text-gray-900 font-mono bg-gray-50 px-3 py-2 rounded-lg",children:E.depotCode||E.code})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Depot Name"}),(0,ze.jsx)("p",{className:"text-lg text-gray-900",children:E.depotName||E.name})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,ze.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("active"===E.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:E.status})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Manager"}),(0,ze.jsx)("p",{className:"text-gray-900",children:E.manager||"Not assigned"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Address"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Street"}),(0,ze.jsx)("p",{className:"text-gray-900",children:(null===(e=E.location)||void 0===e?void 0:e.address)||(null===(t=E.address)||void 0===t?void 0:t.street)||"Not specified"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"City"}),(0,ze.jsx)("p",{className:"text-gray-900",children:(null===(n=E.location)||void 0===n?void 0:n.city)||(null===(r=E.address)||void 0===r?void 0:r.city)||"Not specified"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"State"}),(0,ze.jsx)("p",{className:"text-gray-900",children:(null===(s=E.location)||void 0===s?void 0:s.state)||(null===(a=E.address)||void 0===a?void 0:a.state)||"Not specified"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Pincode"}),(0,ze.jsx)("p",{className:"text-gray-900",children:(null===(o=E.location)||void 0===o?void 0:o.pincode)||(null===(l=E.address)||void 0===l?void 0:l.pincode)||"Not specified"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Contact"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,ze.jsx)("p",{className:"text-gray-900",children:(null===(c=E.contact)||void 0===c?void 0:c.phone)||"Not specified"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,ze.jsx)("p",{className:"text-gray-900",children:(null===(d=E.contact)||void 0===d?void 0:d.email)||"Not specified"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Capacity"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Bus Capacity"}),(0,ze.jsxs)("p",{className:"text-gray-900",children:[(null===(u=E.capacity)||void 0===u?void 0:u.totalBuses)||(null===(h=E.capacity)||void 0===h?void 0:h.buses)||0," buses"]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Available Buses"}),(0,ze.jsxs)("p",{className:"text-gray-900",children:[(null===(p=E.capacity)||void 0===p?void 0:p.availableBuses)||0," buses"]})]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("button",{onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"}),(0,ze.jsx)("button",{onClick:()=>{C(!1),q(E)},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Edit Depot"})]})]})]})}),M&&I&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsx)("h3",{className:"text-xl font-bold text-red-900 mb-4",children:"Confirm Deletion"}),(0,ze.jsxs)("p",{className:"text-gray-700 mb-6",children:['Are you sure you want to delete depot "',I.depotName||I.name,'"? This action cannot be undone.']}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>D(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{onClick:async()=>{if(!I)return;const e=I._id;g(t=>t.filter(t=>t._id!==e)),D(!1),P(null);try{const t=await fetch("/api/admin/depots/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok)console.log("Depot deleted successfully from backend");else{const e=await t.json();console.error("Failed to delete depot:",e.error),g(e=>[...e,I]),alert("Failed to delete depot: ".concat(e.error||"Unknown error"))}}catch(t){console.error("Error deleting depot:",t),g(e=>[...e,I]),alert("Network error while deleting depot. Please try again.")}},className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Depot"})]})]})})})]})},Wm=()=>{const e=te();return(0,i.useEffect)(()=>{const t=setTimeout(()=>{e("/admin/routes-management")},3e3);return()=>clearTimeout(t)},[e]),(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,ze.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,ze.jsxs)($c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,ze.jsx)(kn,{className:"w-8 h-8 text-green-600"}),(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Route Management"})]}),(0,ze.jsx)("p",{className:"text-gray-600 mb-6",children:"Manage bus routes, stops, and route configurations"}),(0,ze.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6",children:(0,ze.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,ze.jsx)(xd,{className:"w-8 h-8 text-green-600 mt-1"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"\ud83c\udf89 Route Management System is Now Live!"}),(0,ze.jsx)("p",{className:"text-green-700 mb-4",children:"Your comprehensive route management system is ready with depot scheduling, starting/ending points, intermediate stops, and full CRUD operations."}),(0,ze.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-4",children:[(0,ze.jsx)("h4",{className:"font-semibold text-green-800 mb-2",children:"\u2728 New Features:"}),(0,ze.jsxs)("ul",{className:"text-green-700 text-sm space-y-1",children:[(0,ze.jsx)("li",{children:"\u2022 Complete route creation with starting/ending points"}),(0,ze.jsx)("li",{children:"\u2022 Depot integration and scheduling"}),(0,ze.jsx)("li",{children:"\u2022 Intermediate stops management"}),(0,ze.jsx)("li",{children:"\u2022 Advanced filtering and search"}),(0,ze.jsx)("li",{children:"\u2022 Beautiful admin interface"}),(0,ze.jsx)("li",{children:"\u2022 Real-time statistics and analytics"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("button",{onClick:()=>e("/admin/routes-management"),className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center",children:["Go to Routes Management",(0,ze.jsx)(ed,{className:"w-4 h-4 ml-2"})]}),(0,ze.jsx)("span",{className:"text-green-600 text-sm",children:"Auto-redirecting in 3 seconds..."})]})]})]})}),(0,ze.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[(0,ze.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"\ud83d\ude8c Routes Management"}),(0,ze.jsx)("p",{className:"text-blue-700 text-sm mb-3",children:"Access the full routes management system with depot scheduling capabilities."}),(0,ze.jsxs)("button",{onClick:()=>e("/admin/routes-management"),className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center",children:["Open Routes Management ",(0,ze.jsx)(ed,{className:"w-3 h-3 ml-1"})]})]}),(0,ze.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-4",children:[(0,ze.jsx)("h4",{className:"font-semibold text-purple-800 mb-2",children:"\ud83c\udfe2 Depot Management"}),(0,ze.jsx)("p",{className:"text-purple-700 text-sm mb-3",children:"Manage bus depots, capacity, facilities, and operating hours."}),(0,ze.jsxs)("button",{onClick:()=>e("/admin/depot-management"),className:"text-purple-600 hover:text-purple-700 text-sm font-medium flex items-center",children:["Open Depot Management ",(0,ze.jsx)(ed,{className:"w-3 h-3 ml-1"})]})]})]})]})})})},Gm=wn("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),Ym=wn("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Zm=e=>{let{children:t,className:n="",hoverEffect:r=!0,gradient:s=!1,glow:a=!1,delay:o=0,onClick:l=null}=e;const[c,d]=(0,i.useState)(!1),u="\n    relative overflow-hidden rounded-2xl border border-gray-100 \n    bg-white shadow-sm transition-all duration-300 ease-out\n    ".concat(s?"bg-gradient-to-br from-white to-gray-50":"","\n    ").concat(a?"ring-1 ring-blue-100":"","\n    ").concat(l?"cursor-pointer":"","\n    ").concat(n,"\n  ");return(0,ze.jsxs)($c.div,{variants:{initial:{scale:1,y:0,rotateX:0,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},hover:{scale:1.02,y:-8,rotateX:2,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},tap:{scale:.98,y:-4}},initial:"initial",whileHover:r?"hover":"initial",whileTap:l?"tap":"initial",transition:{duration:.3,ease:"easeOut",delay:.1*o},onHoverStart:()=>d(!0),onHoverEnd:()=>d(!1),onClick:l,className:u,children:[s&&(0,ze.jsx)($c.div,{className:"absolute inset-0 bg-gradient-to-br from-blue-50/50 via-transparent to-purple-50/50",initial:{opacity:0},animate:{opacity:c?1:0},transition:{duration:.3}}),a&&(0,ze.jsx)($c.div,{variants:{initial:{opacity:0,scale:.8},hover:{opacity:1,scale:1.2}},className:"absolute -inset-1 bg-gradient-to-r from-blue-400 to-purple-400 rounded-2xl blur opacity-20",initial:"initial",animate:c?"hover":"initial"}),(0,ze.jsx)("div",{className:"relative z-10",children:t}),r&&(0,ze.jsx)($c.div,{className:"absolute inset-0 rounded-2xl border-2 border-transparent",initial:{opacity:0},animate:{opacity:c?1:0,borderColor:c?"rgba(59, 130, 246, 0.3)":"transparent"},transition:{duration:.3}})]})},Xm=e=>{let{children:t,className:n="",hoverEffect:i=!0,blur:r="backdrop-blur-md",transparency:s="bg-white/20",border:a="border-white/30",shadow:o="shadow-2xl"}=e;const l="\n    relative overflow-hidden rounded-2xl \n    ".concat(s," ").concat(a," ").concat(o,"\n    transition-all duration-300 ease-out\n    ").concat(n,"\n  ");return(0,ze.jsxs)($c.div,{variants:{initial:{scale:1,y:0,rotateX:0},hover:{scale:1.02,y:-5,rotateX:1},tap:{scale:.98,y:-2}},initial:"initial",whileHover:i?"hover":"initial",whileTap:"tap",transition:{duration:.3,ease:"easeOut"},className:l,children:[(0,ze.jsx)("div",{className:"absolute inset-0 ".concat(r," bg-white/10")}),(0,ze.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 via-transparent to-white/10"}),(0,ze.jsx)("div",{className:"relative z-10",children:t}),(0,ze.jsx)("div",{className:"absolute inset-0 rounded-2xl border border-white/20"})]})},Km=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(null),[p,m]=(0,i.useState)({fromCity:"",toCity:"",depotId:"",status:""}),[f,g]=(0,i.useState)(""),[x,y]=(0,i.useState)("grid"),[v,_]=(0,i.useState)({routeNumber:"",routeName:"",startingCity:"",startingLocation:"",endingCity:"",endingLocation:"",totalDistance:"",estimatedDuration:"",baseFare:"",depotId:"",features:[],departureTime:"",arrivalTime:"",frequency:""}),[b,w]=(0,i.useState)({departureTime:"",arrivalTime:"",frequency:""}),[j,N]=(0,i.useState)(null),[S,k]=(0,i.useState)(!1),[T,C]=(0,i.useState)("add"),[E,A]=(0,i.useState)("single"),[M,D]=(0,i.useState)({frequency:"daily",interval:1,daysOfWeek:[],endDate:"",maxOccurrences:10}),[I,P]=(0,i.useState)({pattern:"custom",customPattern:[],timeSlots:[]});(0,i.useEffect)(()=>{(async()=>{try{var e,n,i,s,o,l;a(!0),sh();const[c,d]=await Promise.all([rh("/api/admin/routes?limit=500&_="+Date.now()),rh("/api/admin/depots?showAll=true&_="+Date.now())]),u=((null===c||void 0===c||null===(e=c.data)||void 0===e?void 0:e.routes)||(null===c||void 0===c||null===(n=c.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.routes)||(null===c||void 0===c?void 0:c.data)||[]||[]).map(e=>{var t,n,i,r;const s=e.depotId||e.depot||null,a=s&&"object"===typeof s?s._id||s.depotId||s.id:s||"",o=s&&"object"===typeof s?s.name||s.depotName||s.code||"Depot":"",l=s&&"object"===typeof s&&((null===(t=s.location)||void 0===t?void 0:t.city)||s.city)||"",c=e.startingPoint,d=e.endingPoint,u="object"===typeof c?{city:c.city||c.location||c.name||"",location:c.location||""}:{city:c||"",location:""},h="object"===typeof d?{city:d.city||d.location||d.name||"",location:d.location||""}:{city:d||"",location:""},p=Array.isArray(e.schedules)?e.schedules.map((e,t)=>({scheduleId:e.scheduleId||e._id||"SCH".concat(t),departureTime:e.departureTime||e.departure||e.startTime||"",arrivalTime:e.arrivalTime||e.arrival||e.endTime||"",frequency:e.frequency||e.recurrence||"daily"})):[];return{id:e._id||e.id,routeNumber:e.routeNumber||e.code||"",routeName:e.routeName||e.name||"",startingPoint:u,endingPoint:h,totalDistance:Number(null!==(n=e.totalDistance)&&void 0!==n?n:0),estimatedDuration:Number(null!==(i=e.estimatedDuration)&&void 0!==i?i:0),baseFare:Number(null!==(r=e.baseFare)&&void 0!==r?r:0),depot:{depotId:a,depotName:o,depotLocation:l},status:e.status||"active",schedules:p,features:Array.isArray(e.features)?e.features:[]}});t(u);const h=((null===d||void 0===d||null===(s=d.data)||void 0===s?void 0:s.depots)||(null===d||void 0===d||null===(o=d.data)||void 0===o||null===(l=o.data)||void 0===l?void 0:l.depots)||(null===d||void 0===d?void 0:d.data)||[]||[]).map(e=>{var t,n;return{id:e._id||e.id,depotCode:e.code||e.depotCode||"",depotName:e.name||e.depotName||e.code||"Depot",location:{city:(null===(t=e.location)||void 0===t?void 0:t.city)||(null===(n=e.address)||void 0===n?void 0:n.city)||""},capacity:e.capacity||{totalBuses:0,availableBuses:0,maintenanceBuses:0},status:e.status||"active"}});r(h)}catch(wd){console.error("Failed to load routes/depots",wd),t([]),r([])}finally{a(!1)}})()},[]);const R=e=>{const{name:t,value:n}=e.target;_(e=>Le(Le({},e),{},{[t]:n}))},L=e=>{const{value:t,checked:n}=e.target;_(e=>Le(Le({},e),{},{features:n?[...e.features,t]:e.features.filter(e=>e!==t)}))},z=e=>{const{name:t,value:n}=e.target,i=t.replace("new","").toLowerCase();w(e=>Le(Le({},e),{},{[i]:n}))},O=e=>{const{name:t,value:n}=e.target;N(e=>Le(Le({},e),{},{[t]:n}))},F=()=>{N(null),k(!1),C("add"),w({departureTime:"",arrivalTime:"",frequency:""}),A("single"),D({frequency:"daily",interval:1,daysOfWeek:[],endDate:"",maxOccurrences:10}),P({pattern:"custom",customPattern:[],timeSlots:[]})},B=e=>{if(!e)return"";const[t,n]=e.split(":"),i=parseInt(t),r=i>=12?"PM":"AM";return"".concat(0===i?12:i>12?i-12:i,":").concat(n," ").concat(r)},V=e.filter(e=>{const t=e.routeName.toLowerCase().includes(f.toLowerCase())||e.routeNumber.toLowerCase().includes(f.toLowerCase()),n=(!p.fromCity||e.startingPoint.city.toLowerCase().includes(p.fromCity.toLowerCase()))&&(!p.toCity||e.endingPoint.city.toLowerCase().includes(p.toCity.toLowerCase()))&&(!p.depotId||e.depot.depotId.toString()===p.depotId)&&(!p.status||e.status===p.status);return t&&n}),U=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"maintenance":return"bg-yellow-100 text-yellow-800";case"suspended":return"bg-red-100 text-red-800"}},H=e=>{switch(e){case"active":return"\ud83d\udfe2";case"inactive":default:return"\u26aa";case"maintenance":return"\ud83d\udfe1";case"suspended":return"\ud83d\udd34"}};return s?(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),(0,ze.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading routes..."})]})}):(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,ze.jsx)("div",{className:"mb-8",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Routes Management"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage bus routes and depot scheduling"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("button",{onClick:()=>l(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center hover:bg-blue-700 transition-colors",children:[(0,ze.jsx)(mh,{className:"w-5 h-5 mr-2"}),"Create Route"]}),(0,ze.jsx)("button",{onClick:()=>y("grid"===x?"list":"grid"),className:"bg-gray-100 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-200 transition-colors",children:"grid"===x?"List View":"Grid View"})]})]})}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,ze.jsx)(Zm,{className:"p-6",delay:0,children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg mr-4",children:(0,ze.jsx)(kn,{className:"w-8 h-8 text-blue-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Total Routes"}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,ze.jsx)(Zm,{className:"p-6",delay:1,children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"p-3 bg-green-100 rounded-lg mr-4",children:(0,ze.jsx)(Gm,{className:"w-8 h-8 text-green-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Active Depots"}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(e=>"active"===e.status).length})]})]})}),(0,ze.jsx)(Zm,{className:"p-6",delay:2,children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg mr-4",children:(0,ze.jsx)(td,{className:"w-8 h-8 text-purple-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Total Schedules"}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.reduce((e,t)=>e+t.schedules.length,0)})]})]})}),(0,ze.jsx)(Zm,{className:"p-6",delay:3,children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"p-3 bg-orange-100 rounded-lg mr-4",children:(0,ze.jsx)(Sn,{className:"w-8 h-8 text-orange-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Available Buses"}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:n.reduce((e,t)=>e+t.capacity.availableBuses,0)})]})]})})]}),(0,ze.jsx)(Xm,{className:"p-6 mb-8",children:(0,ze.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,ze.jsx)("div",{className:"flex-1",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search routes by name or number...",value:f,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,ze.jsxs)("div",{className:"flex gap-4",children:[(0,ze.jsxs)("select",{value:p.fromCity,onChange:e=>m(Le(Le({},p),{},{fromCity:e.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"From City"}),(0,ze.jsx)("option",{value:"Kochi",children:"Kochi"}),(0,ze.jsx)("option",{value:"Thiruvananthapuram",children:"Thiruvananthapuram"}),(0,ze.jsx)("option",{value:"Kozhikode",children:"Kozhikode"}),(0,ze.jsx)("option",{value:"Alappuzha",children:"Alappuzha"}),(0,ze.jsx)("option",{value:"Kollam",children:"Kollam"}),(0,ze.jsx)("option",{value:"Thrissur",children:"Thrissur"}),(0,ze.jsx)("option",{value:"Kottayam",children:"Kottayam"}),(0,ze.jsx)("option",{value:"Palakkad",children:"Palakkad"})]}),(0,ze.jsxs)("select",{value:p.toCity,onChange:e=>m(Le(Le({},p),{},{toCity:e.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"To City"}),(0,ze.jsx)("option",{value:"Kochi",children:"Kochi"}),(0,ze.jsx)("option",{value:"Thiruvananthapuram",children:"Thiruvananthapuram"}),(0,ze.jsx)("option",{value:"Kozhikode",children:"Kozhikode"}),(0,ze.jsx)("option",{value:"Alappuzha",children:"Alappuzha"}),(0,ze.jsx)("option",{value:"Kollam",children:"Kollam"}),(0,ze.jsx)("option",{value:"Thrissur",children:"Thrissur"}),(0,ze.jsx)("option",{value:"Kottayam",children:"Kottayam"}),(0,ze.jsx)("option",{value:"Palakkad",children:"Palakkad"})]}),(0,ze.jsxs)("select",{value:p.depotId,onChange:e=>m(Le(Le({},p),{},{depotId:e.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"All Depots"}),n.map(e=>(0,ze.jsx)("option",{value:e.id,children:e.depotName},e.id))]}),(0,ze.jsxs)("select",{value:p.status,onChange:e=>m(Le(Le({},p),{},{status:e.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]})]})]})}),(0,ze.jsx)("div",{className:"space-y-6",children:"grid"===x?(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:V.map((e,t)=>(0,ze.jsxs)(Zm,{delay:t,className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.routeName}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:e.routeNumber})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(U(e.status)),children:[H(e.status)," ",e.status]}),(0,ze.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded",children:(0,ze.jsx)(Ym,{className:"w-4 h-4 text-gray-500"})})]})]}),(0,ze.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(id,{className:"w-4 h-4 mr-2"}),(0,ze.jsxs)("span",{children:[e.startingPoint.city," \u2192 ",e.endingPoint.city]})]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(kn,{className:"w-4 h-4 mr-2"}),(0,ze.jsxs)("span",{children:[e.totalDistance," km \u2022 ",Math.floor(e.estimatedDuration/60),"h ",e.estimatedDuration%60,"m"]})]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(Gm,{className:"w-4 h-4 mr-2"}),(0,ze.jsx)("span",{children:e.depot.depotName})]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(td,{className:"w-4 h-4 mr-2"}),(0,ze.jsxs)("span",{children:[e.schedules.length," schedules"]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["\u20b9",e.baseFare]}),(0,ze.jsxs)("div",{className:"flex space-x-1",children:[e.features.slice(0,3).map((e,t)=>(0,ze.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:e},t)),e.features.length>3&&(0,ze.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:["+",e.features.length-3]})]})]}),(0,ze.jsxs)("div",{className:"flex space-x-2",children:[(0,ze.jsxs)("button",{onClick:()=>{h(e),d(!0)},className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[(0,ze.jsx)(Tn,{className:"w-4 h-4 mr-1 inline"}),"Schedule"]}),(0,ze.jsxs)("button",{className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors text-sm",children:[(0,ze.jsx)(Rm,{className:"w-4 h-4 mr-1 inline"}),"Edit"]})]})]},e.id))}):(0,ze.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,ze.jsx)("div",{className:"overflow-x-auto",children:(0,ze.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,ze.jsx)("thead",{className:"bg-gray-50",children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Route"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"From \u2192 To"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Depot"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Schedules"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,ze.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:V.map(e=>(0,ze.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.routeName}),(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:e.routeNumber})]})}),(0,ze.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,ze.jsxs)("div",{className:"text-sm text-gray-900",children:[e.startingPoint.city," \u2192 ",e.endingPoint.city]}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:[e.totalDistance," km \u2022 ",Math.floor(e.estimatedDuration/60),"h ",e.estimatedDuration%60,"m"]})]}),(0,ze.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,ze.jsx)("div",{className:"text-sm text-gray-900",children:e.depot.depotName}),(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:e.depot.depotLocation})]}),(0,ze.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,ze.jsxs)("div",{className:"text-sm text-gray-900",children:[e.schedules.length," schedules"]}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["\u20b9",e.baseFare]})]}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(U(e.status)),children:[H(e.status)," ",e.status]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,ze.jsxs)("div",{className:"flex space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>{h(e),d(!0)},className:"text-blue-600 hover:text-blue-900",children:"Schedule"}),(0,ze.jsx)("button",{className:"text-gray-600 hover:text-gray-900",children:"Edit"}),(0,ze.jsx)("button",{className:"text-red-600 hover:text-red-900",children:"Delete"})]})})]},e.id))})]})})})}),o&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,ze.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Create New Route"}),(0,ze.jsxs)("form",{onSubmit:i=>{if(i.preventDefault(),!v.routeNumber||!v.routeName||!v.depotId)return void window.alert("Please fill in all required fields");const r=n.find(e=>e.id===parseInt(v.depotId));if(!r)return void window.alert("Please select a valid depot");const s={id:e.length+1,routeNumber:v.routeNumber,routeName:v.routeName,startingPoint:{city:v.startingCity,location:v.startingLocation},endingPoint:{city:v.endingCity,location:v.endingLocation},totalDistance:parseInt(v.totalDistance),estimatedDuration:parseInt(v.estimatedDuration),depot:{depotId:parseInt(v.depotId),depotName:r.depotName,depotLocation:r.location.city},status:"active",schedules:[{scheduleId:"SCH".concat(e.length+1),departureTime:v.departureTime,arrivalTime:v.arrivalTime,frequency:v.frequency}],baseFare:parseInt(v.baseFare),features:v.features};t(e=>[...e,s]),_({routeNumber:"",routeName:"",startingCity:"",startingLocation:"",endingCity:"",endingLocation:"",totalDistance:"",estimatedDuration:"",baseFare:"",depotId:"",features:[],departureTime:"",arrivalTime:"",frequency:""}),l(!1),window.alert("Route created successfully!")},className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route Number *"}),(0,ze.jsx)("input",{type:"text",name:"routeNumber",value:v.routeNumber,onChange:R,placeholder:"e.g., RT009",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route Name *"}),(0,ze.jsx)("input",{type:"text",name:"routeName",value:v.routeName,onChange:R,placeholder:"e.g., Kochi - Goa Express",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting City *"}),(0,ze.jsx)("input",{type:"text",name:"startingCity",value:v.startingCity,onChange:R,placeholder:"e.g., Kochi",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Location *"}),(0,ze.jsx)("input",{type:"text",name:"startingLocation",value:v.startingLocation,onChange:R,placeholder:"e.g., Kochi Central Bus Stand",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ending City *"}),(0,ze.jsx)("input",{type:"text",name:"endingCity",value:v.endingCity,onChange:R,placeholder:"e.g., Goa",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ending Location *"}),(0,ze.jsx)("input",{type:"text",name:"endingLocation",value:v.endingLocation,onChange:R,placeholder:"e.g., Goa Central Bus Station",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Distance (km) *"}),(0,ze.jsx)("input",{type:"number",name:"totalDistance",value:v.totalDistance,onChange:R,placeholder:"e.g., 800",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Duration (minutes) *"}),(0,ze.jsx)("input",{type:"number",name:"estimatedDuration",value:v.estimatedDuration,onChange:R,placeholder:"e.g., 600",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Base Fare (\u20b9) *"}),(0,ze.jsx)("input",{type:"number",name:"baseFare",value:v.baseFare,onChange:R,placeholder:"e.g., 1800",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Depot *"}),(0,ze.jsxs)("select",{name:"depotId",value:v.depotId,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select a depot"}),n.map(e=>(0,ze.jsxs)("option",{value:e.id,children:[e.depotName," - ",e.location.city]},e.id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route Features"}),(0,ze.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["AC","WiFi","USB_Charging","Entertainment","Refreshments","Wheelchair_Accessible"].map(e=>(0,ze.jsxs)("label",{className:"flex items-center",children:[(0,ze.jsx)("input",{type:"checkbox",name:"features",value:e,checked:v.features.includes(e),onChange:L,className:"mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,ze.jsx)("span",{className:"text-sm text-gray-700",children:e.replace("_"," ")})]},e))})]}),(0,ze.jsxs)("div",{className:"border-t pt-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Initial Schedule"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departure Time *"}),(0,ze.jsx)("input",{type:"time",name:"departureTime",value:v.departureTime,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Arrival Time *"}),(0,ze.jsx)("input",{type:"time",name:"arrivalTime",value:v.arrivalTime,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frequency *"}),(0,ze.jsxs)("select",{name:"frequency",value:v.frequency,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select frequency"}),(0,ze.jsx)("option",{value:"daily",children:"Daily"}),(0,ze.jsx)("option",{value:"weekly",children:"Weekly"}),(0,ze.jsx)("option",{value:"monthly",children:"Monthly"})]})]})]})]}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>l(!1),className:"px-6 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Create Route"})]})]})]})}),c&&u&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:["Manage Schedules - ",u.routeName]}),(0,ze.jsx)("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600",children:(0,ze.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,ze.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:(0,ze.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"font-medium text-blue-800",children:"Route:"}),(0,ze.jsxs)("p",{className:"text-blue-700",children:[u.routeNumber," - ",u.routeName]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"font-medium text-blue-800",children:"From:"}),(0,ze.jsx)("p",{className:"text-blue-700",children:u.startingPoint.city})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"font-medium text-blue-800",children:"To:"}),(0,ze.jsx)("p",{className:"text-blue-700",children:u.endingPoint.city})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"font-medium text-blue-800",children:"Total Schedules:"}),(0,ze.jsx)("p",{className:"text-blue-700",children:u.schedules.length})]})]})}),(0,ze.jsxs)("div",{className:"mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Current Schedules"}),(0,ze.jsxs)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:[u.schedules.length," schedule",1!==u.schedules.length?"s":""]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>{const t=e.find(e=>e.id===u.id);t&&h(t)},className:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center",title:"Refresh schedules",children:(0,ze.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,ze.jsxs)("button",{onClick:()=>{k(!0),C("add"),w({departureTime:"",arrivalTime:"",frequency:""})},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",children:[(0,ze.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New Schedule"]})]})]}),0===u.schedules.length?(0,ze.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[(0,ze.jsx)("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,ze.jsx)("p",{className:"text-gray-500",children:"No schedules found"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400",children:"Add your first schedule to get started"})]}):(0,ze.jsx)("div",{className:"grid gap-4",children:u.schedules.map((e,n)=>(0,ze.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:n+1}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:"Schedule"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Departure"}),(0,ze.jsx)("div",{className:"text-lg font-bold text-gray-900",children:e.departureTime})]}),(0,ze.jsx)("div",{className:"text-gray-400",children:(0,ze.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Arrival"}),(0,ze.jsx)("div",{className:"text-lg font-bold text-gray-900",children:e.arrivalTime})]})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Frequency"}),(0,ze.jsx)("div",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium capitalize",children:e.frequency})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>(e=>{N(Le({},e)),C("edit"),k(!0)})(e),className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Schedule",children:(0,ze.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,ze.jsx)("button",{onClick:()=>((e,n)=>{if(window.confirm("Are you sure you want to delete this schedule?")){const i=Le(Le({},u),{},{schedules:u.schedules.filter(e=>e.scheduleId!==n)});t(t=>t.map(t=>t.id===e?i:t)),h(i),window.alert("Schedule deleted successfully!")}})(u.id,e.scheduleId),className:"p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Schedule",children:(0,ze.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.scheduleId))})]}),S&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:(0,ze.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-5xl max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"add"===T?"Add New Schedule":"Edit Schedule"}),(0,ze.jsx)("button",{onClick:F,className:"text-gray-400 hover:text-gray-600",children:(0,ze.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,ze.jsxs)("form",{onSubmit:"add"===T?e=>{if(e.preventDefault(),!b.departureTime||!b.arrivalTime||!b.frequency)return void window.alert("Please fill in all schedule fields");if(b.departureTime>=b.arrivalTime)return void window.alert("Arrival time must be after departure time");const n={scheduleId:"SCH".concat(Date.now()),departureTime:b.departureTime,arrivalTime:b.arrivalTime,frequency:b.frequency},i=Le(Le({},u),{},{schedules:[...u.schedules,n]});t(e=>e.map(e=>e.id===u.id?i:e)),h(i),w({departureTime:"",arrivalTime:"",frequency:""}),k(!1),window.alert("Schedule added successfully!")}:e=>{if(e.preventDefault(),!j.departureTime||!j.arrivalTime||!j.frequency)return void window.alert("Please fill in all schedule fields");if(j.departureTime>=j.arrivalTime)return void window.alert("Arrival time must be after departure time");const n=Le(Le({},u),{},{schedules:u.schedules.map(e=>e.scheduleId===j.scheduleId?Le({},j):e)});t(e=>e.map(e=>e.id===u.id?n:e)),h(n),N(null),k(!1),C("add"),window.alert("Schedule updated successfully!")},className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Schedule Type"}),(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[{value:"single",label:"Single Schedule",description:"One-time schedule"},{value:"recurring",label:"Recurring Schedule",description:"Repeats at intervals"},{value:"pattern",label:"Pattern Schedule",description:"Custom time patterns"}].map(e=>(0,ze.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-white cursor-pointer",children:[(0,ze.jsx)("input",{type:"radio",value:e.value,checked:E===e.value,onChange:e=>A(e.target.value),className:"mr-3 mt-1 text-blue-600 focus:ring-blue-500"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"font-medium text-gray-900",children:e.label}),(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]},e.value))})]}),(0,ze.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-medium text-blue-900 mb-4",children:"Time Selection"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-3",children:"Departure Time *"}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsx)("input",{type:"time",name:"departureTime",value:"add"===T?b.departureTime:(null===j||void 0===j?void 0:j.departureTime)||"",onChange:"add"===T?z:O,className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,ze.jsx)("div",{className:"grid grid-cols-4 gap-2",children:["06:00","08:00","10:00","12:00","14:00","16:00","18:00","20:00"].map(e=>(0,ze.jsx)("button",{type:"button",onClick:()=>(e=>{"add"===T?w(t=>Le(Le({},t),{},{departureTime:e})):N(t=>Le(Le({},t),{},{departureTime:e}))})(e),className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:B(e)},e))})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-3",children:"Arrival Time *"}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsx)("input",{type:"time",name:"arrivalTime",value:"add"===T?b.arrivalTime:(null===j||void 0===j?void 0:j.arrivalTime)||"",onChange:"add"===T?z:O,className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,ze.jsx)("div",{className:"grid grid-cols-4 gap-2",children:["10:00","12:00","14:00","16:00","18:00","20:00","22:00","02:00"].map(e=>(0,ze.jsx)("button",{type:"button",onClick:()=>(e=>{"add"===T?w(t=>Le(Le({},t),{},{arrivalTime:e})):N(t=>Le(Le({},t),{},{arrivalTime:e}))})(e),className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors",children:B(e)},e))})]})]})]}),(0,ze.jsx)("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Departure"}),(0,ze.jsx)("div",{className:"text-lg font-bold text-blue-600",children:B("add"===T?b.departureTime:null===j||void 0===j?void 0:j.departureTime)})]}),(0,ze.jsx)("div",{className:"text-gray-400",children:(0,ze.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Arrival"}),(0,ze.jsx)("div",{className:"text-lg font-bold text-green-600",children:B("add"===T?b.arrivalTime:null===j||void 0===j?void 0:j.arrivalTime)})]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Duration"}),(0,ze.jsx)("div",{className:"text-lg font-bold text-purple-600",children:(()=>{const e="add"===T?b.departureTime:null===j||void 0===j?void 0:j.departureTime,t="add"===T?b.arrivalTime:null===j||void 0===j?void 0:j.arrivalTime;if(!e||!t)return"--";const[n,i]=e.split(":").map(Number),[r,s]=t.split(":").map(Number);let a=60*n+i,o=60*r+s;o<=a&&(o+=1440);const l=o-a,c=Math.floor(l/60),d=l%60;return"".concat(c,"h ").concat(d,"m")})()})]})]})})]}),"recurring"===E&&(0,ze.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-medium text-green-900 mb-4",children:"Recurring Schedule Options"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-green-700 mb-2",children:"Frequency"}),(0,ze.jsxs)("select",{value:M.frequency,onChange:e=>D(t=>Le(Le({},t),{},{frequency:e.target.value})),className:"w-full px-3 py-2 border border-green-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[(0,ze.jsx)("option",{value:"daily",children:"Daily"}),(0,ze.jsx)("option",{value:"weekly",children:"Weekly"}),(0,ze.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-green-700 mb-2",children:"Interval"}),(0,ze.jsx)("input",{type:"number",min:"1",max:"30",value:M.interval,onChange:e=>D(t=>Le(Le({},t),{},{interval:parseInt(e.target.value)})),className:"w-full px-3 py-2 border border-green-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-green-700 mb-2",children:"Max Occurrences"}),(0,ze.jsx)("input",{type:"number",min:"1",max:"100",value:M.maxOccurrences,onChange:e=>D(t=>Le(Le({},t),{},{maxOccurrences:parseInt(e.target.value)})),className:"w-full px-3 py-2 border border-green-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"})]})]}),"weekly"===M.frequency&&(0,ze.jsxs)("div",{className:"mt-4",children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-green-700 mb-2",children:"Days of Week"}),(0,ze.jsx)("div",{className:"grid grid-cols-7 gap-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((e,t)=>(0,ze.jsxs)("label",{className:"flex items-center justify-center p-2 border border-green-200 rounded hover:bg-green-100 cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:M.daysOfWeek.includes(t),onChange:e=>{e.target.checked?D(e=>Le(Le({},e),{},{daysOfWeek:[...e.daysOfWeek,t]})):D(e=>Le(Le({},e),{},{daysOfWeek:e.daysOfWeek.filter(e=>e!==t)}))},className:"mr-1 text-green-600 focus:ring-green-500"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-green-800",children:e})]},e))})]})]}),"pattern"===E&&(0,ze.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-medium text-purple-900 mb-4",children:"Pattern Schedule Options"}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"Pattern Type"}),(0,ze.jsxs)("select",{value:I.pattern,onChange:e=>P(t=>Le(Le({},t),{},{pattern:e.target.value})),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[(0,ze.jsx)("option",{value:"custom",children:"Custom Pattern"}),(0,ze.jsx)("option",{value:"peak_hours",children:"Peak Hours (6 AM - 9 AM, 5 PM - 8 PM)"}),(0,ze.jsx)("option",{value:"off_peak",children:"Off-Peak Hours (10 AM - 4 PM)"}),(0,ze.jsx)("option",{value:"night",children:"Night Service (10 PM - 6 AM)"})]})]}),"custom"===I.pattern&&(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"Custom Time Slots"}),(0,ze.jsx)("div",{className:"grid grid-cols-4 gap-2",children:(()=>{const e=[];for(let t=0;t<24;t++)for(let n=0;n<60;n+=15){const i="".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"));e.push(i)}return e})().slice(0,48).map(e=>(0,ze.jsx)("button",{type:"button",onClick:()=>{I.timeSlots.includes(e)?P(t=>Le(Le({},t),{},{timeSlots:t.timeSlots.filter(t=>t!==e)})):P(t=>Le(Le({},t),{},{timeSlots:[...t.timeSlots,e]}))},className:"px-2 py-1 text-xs rounded transition-colors ".concat(I.timeSlots.includes(e)?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"),children:B(e)},e))})]})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Basic Frequency *"}),(0,ze.jsxs)("select",{name:"frequency",value:"add"===T?b.frequency:(null===j||void 0===j?void 0:j.frequency)||"",onChange:"add"===T?z:O,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select frequency"}),(0,ze.jsx)("option",{value:"daily",children:"Daily"}),(0,ze.jsx)("option",{value:"weekly",children:"Weekly"}),(0,ze.jsx)("option",{value:"monthly",children:"Monthly"}),(0,ze.jsx)("option",{value:"weekdays",children:"Weekdays Only"}),(0,ze.jsx)("option",{value:"weekends",children:"Weekends Only"}),(0,ze.jsx)("option",{value:"custom",children:"Custom Pattern"})]})]}),(0,ze.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,ze.jsxs)("div",{className:"flex items-start",children:[(0,ze.jsx)("svg",{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ze.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,ze.jsxs)("div",{className:"text-sm text-yellow-800",children:[(0,ze.jsx)("strong",{children:"Time Validation:"}),(()=>{const e="add"===T?b.departureTime:null===j||void 0===j?void 0:j.departureTime,t="add"===T?b.arrivalTime:null===j||void 0===j?void 0:j.arrivalTime;return e&&t?((e,t)=>{if(!e||!t)return!1;const[n,i]=e.split(":").map(Number),[r,s]=t.split(":").map(Number),a=60*n+i;let o=60*r+s;return o<=a&&(o+=1440),o>a})(e,t)?" Time validation passed. Schedule is valid.":" Invalid time combination. Arrival time must be after departure time.":" Please select both departure and arrival times."})()]})]})}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[(0,ze.jsx)("button",{type:"button",onClick:F,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"px-6 py-2 text-white rounded-lg focus:outline-none focus:ring-2 ".concat("add"===T?"bg-green-600 hover:bg-green-700 focus:ring-green-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"),children:"add"===T?"Add Schedule":"Update Schedule"})]})]})]})}),(0,ze.jsx)("div",{className:"flex justify-end space-x-4 mt-6 pt-6 border-t",children:(0,ze.jsx)("button",{onClick:()=>d(!1),className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Close Schedule Manager"})})]})})]})},Qm=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[s,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)({}),u=te(),[h,p]=(0,i.useState)(!0),[m,f]=(0,i.useState)(!0),[g,x]=(0,i.useState)(""),[y,v]=(0,i.useState)(!1),[_,b]=(0,i.useState)({depotCode:"",depotName:"",location:{address:"",city:"",state:"",pincode:""},contact:{phone:"",email:"",managerName:""},capacity:{totalBuses:""},facilities:[],status:"active"}),w=_.depotCode?"".concat(_.depotCode.trim().toLowerCase(),"-depot@yatrik.com"):"",j=_.depotCode?"".concat(_.depotCode.trim().toLowerCase(),"-depot"):"",N=(e,t)=>{b(n=>Le(Le({},n),{},{[e]:t}))},S=(e,t,n)=>{b(i=>Le(Le({},i),{},{[e]:Le(Le({},i[e]),{},{[t]:n})}))},k=(e=>{let t=0;return e?(e.length>=8&&t++,e.length>=12&&t++,/[A-Z]/.test(e)&&t++,/[a-z]/.test(e)&&t++,/[0-9]/.test(e)&&t++,/[^A-Za-z0-9]/.test(e)&&t++,Math.min(t,5)):0})(g),T=k<=2?"Weak":k<=4?"Medium":"Strong",C=k<=2?"bg-red-500":k<=4?"bg-amber-500":"bg-emerald-600",E=k<=2?"text-red-600":k<=4?"text-amber-600":"text-emerald-600";(0,i.useEffect)(()=>{(async()=>{try{r(!0);const e=await fetch("/api/admin/depots",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const n=await e.json();t(n.depots||n.data||[])}}catch(BS){console.error(BS),t([])}finally{r(!1)}})()},[]);const A=e=>c[e]&&(0,ze.jsx)("p",{className:"text-xs text-red-600 mt-1",children:c[e]});return(0,ze.jsxs)("div",{className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold",children:"Depots"}),(0,ze.jsxs)("button",{type:"button",onClick:()=>a(!0),className:"px-4 py-2 bg-green-600 text-white rounded flex items-center gap-2",children:[(0,ze.jsx)(mh,{className:"w-4 h-4"})," Create New Depot"]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full border",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Create New Depot"}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=(()=>{const e={};return _.depotCode&&_.depotCode.trim()?/^[A-Z0-9]{3,10}$/.test(_.depotCode.trim().toUpperCase())||(e.depotCode="Depot Code must be 3-10 letters/numbers (uppercase)"):e.depotCode="Depot Code is required",_.depotName&&_.depotName.trim()||(e.depotName="Depot Name is required"),_.location.address&&_.location.address.trim()||(e["location.address"]="Street Address is required"),_.location.city&&_.location.city.trim()||(e["location.city"]="City is required"),_.location.state&&_.location.state.trim()||(e["location.state"]="State is required"),_.location.pincode&&/^[0-9]{6}$/.test(_.location.pincode.trim())||(e["location.pincode"]="Pincode must be exactly 6 digits"),_.contact.phone&&/^[0-9]{10}$/.test(_.contact.phone.trim())||(e["contact.phone"]="Phone must be 10 digits"),h||!_.contact.email||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(_.contact.email.trim())||(e["contact.email"]="Invalid email address"),m&&(!g||g.length<8)&&(e["account.password"]="Password must be at least 8 characters"),(!_.capacity.totalBuses||Number(_.capacity.totalBuses)<=0)&&(e["capacity.totalBuses"]="Total Buses must be greater than 0"),e})();if(d(t),!(Object.keys(t).length>0))try{var n,i;l(!0);const e={depotCode:_.depotCode.trim().toUpperCase(),depotName:_.depotName.trim(),location:{address:_.location.address.trim(),city:_.location.city.trim(),state:_.location.state.trim(),pincode:_.location.pincode.trim()},contact:{phone:_.contact.phone.trim(),email:h?w:(null===(n=_.contact.email)||void 0===n?void 0:n.trim().toLowerCase())||w,manager:_.contact.managerName?{name:_.contact.managerName.trim()}:void 0},capacity:{totalBuses:parseInt(_.capacity.totalBuses,10),availableBuses:parseInt(_.capacity.totalBuses,10),maintenanceBuses:0},operatingHours:{openTime:"06:00",closeTime:"22:00",workingDays:["monday","tuesday","wednesday","thursday","friday","saturday"]},facilities:_.facilities,status:(_.status||"active").toLowerCase(),createUserAccount:!!m,userAccount:m?{username:j,email:h?w:(null===(i=_.contact.email)||void 0===i?void 0:i.trim().toLowerCase())||w,password:g,role:"depot_manager",permissions:["view_depot_info","view_buses","manage_buses","view_routes","view_schedules","view_reports"]}:void 0},t=await fetch("/api/admin/depots",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw new Error(r.error||"Server error");return ou.success("Depot created successfully"),void u("/admin/depots")}catch(BS){console.error("\u274c Error:",BS),ou.error(BS.message||"Failed to create depot"),l(!1)}},className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Depot Code *"}),(0,ze.jsx)("input",{placeholder:"e.g., TVM, BLR",value:_.depotCode,onChange:e=>N("depotCode",e.target.value),className:"border p-2 w-full"}),A("depotCode")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Depot Name *"}),(0,ze.jsx)("input",{placeholder:"e.g., Trivandrum Depot",value:_.depotName,onChange:e=>N("depotName",e.target.value),className:"border p-2 w-full"}),A("depotName")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Street Address *"}),(0,ze.jsx)("input",{placeholder:"Enter street address",value:_.location.address,onChange:e=>S("location","address",e.target.value),className:"border p-2 w-full"}),A("location.address")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"City *"}),(0,ze.jsx)("input",{placeholder:"Enter city name",value:_.location.city,onChange:e=>S("location","city",e.target.value),className:"border p-2 w-full"}),A("location.city")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"State *"}),(0,ze.jsx)("input",{placeholder:"Enter state name",value:_.location.state,onChange:e=>S("location","state",e.target.value),className:"border p-2 w-full"}),A("location.state")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Pincode *"}),(0,ze.jsx)("input",{placeholder:"Enter 6-digit pincode",value:_.location.pincode,onChange:e=>S("location","pincode",e.target.value),className:"border p-2 w-full"}),A("location.pincode")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Phone *"}),(0,ze.jsx)("input",{placeholder:"Enter phone number",value:_.contact.phone,onChange:e=>S("contact","phone",e.target.value),className:"border p-2 w-full"}),A("contact.phone")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("label",{children:"Email (auto) "}),(0,ze.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,ze.jsx)("input",{type:"checkbox",checked:h,onChange:e=>p(e.target.checked)}),"Use auto email"]})]}),(0,ze.jsx)("input",{placeholder:"Enter email address",value:h?w:_.contact.email,onChange:e=>!h&&S("contact","email",e.target.value),disabled:h,className:"border p-2 w-full disabled:bg-gray-100"}),A("contact.email")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Manager"}),(0,ze.jsx)("input",{placeholder:"Enter manager name",value:_.contact.managerName,onChange:e=>S("contact","managerName",e.target.value),className:"border p-2 w-full"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Bus Capacity *"}),(0,ze.jsx)("input",{placeholder:"Enter total number of buses",type:"number",value:_.capacity.totalBuses,onChange:e=>S("capacity","totalBuses",e.target.value),className:"border p-2 w-full"}),A("capacity.totalBuses")]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Facilities"}),(0,ze.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:["Fuel_Station","Maintenance_Bay","Washing_Bay","Parking_Lot","Driver_Rest_Room","Canteen","Security_Office","Admin_Office","Training_Room","Spare_Parts_Store"].map(e=>(0,ze.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("input",{type:"checkbox",checked:_.facilities.includes(e),onChange:t=>{b(n=>Le(Le({},n),{},{facilities:t.target.checked?[...n.facilities,e]:n.facilities.filter(t=>t!==e)}))}}),(0,ze.jsx)("span",{className:"text-sm",children:e.replaceAll("_"," ")})]},e))})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Status"}),(0,ze.jsxs)("select",{className:"border p-2 w-full",value:_.status,onChange:e=>N("status",e.target.value),children:[(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"closed",children:"Closed"})]})]}),(0,ze.jsxs)("div",{className:"border-t pt-4",children:[(0,ze.jsxs)("label",{className:"flex items-center gap-2 mb-2",children:[(0,ze.jsx)("input",{type:"checkbox",checked:m,onChange:e=>f(e.target.checked)}),"Create Depot Manager login now"]}),m&&(0,ze.jsxs)("div",{className:"space-y-2",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{children:"Password *"}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("input",{type:y?"text":"password",placeholder:"Enter password (min 6 chars)",value:g,onChange:e=>x(e.target.value),className:"border p-2 w-full pr-10"}),(0,ze.jsx)("button",{type:"button",onClick:()=>v(e=>!e),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:y?(0,ze.jsx)(gh,{className:"w-5 h-5"}):(0,ze.jsx)(xh,{className:"w-5 h-5"})})]}),c["account.password"]&&(0,ze.jsx)("p",{className:"text-xs text-red-600 mt-1",children:c["account.password"]})]}),(0,ze.jsxs)("div",{className:"space-y-1",children:[(0,ze.jsx)("div",{className:"flex gap-1",children:[0,1,2,3,4].map(e=>(0,ze.jsx)("div",{className:"h-2 flex-1 rounded ".concat(e<k?C:"bg-gray-200")},e))}),(0,ze.jsxs)("div",{className:"text-xs ".concat(E),children:["Strength: ",T]})]})]})]}),(0,ze.jsx)("div",{className:"flex justify-end space-x-4",children:(0,ze.jsx)("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded",children:o?"Creating...":"Create Depot"})})]})]})]})},Jm=()=>(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,ze.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,ze.jsxs)($c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,ze.jsx)(id,{className:"w-8 h-8 text-accent"}),(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Stop Management"})]}),(0,ze.jsx)("p",{className:"text-gray-600 mb-6",children:"Manage bus stops, locations, and stop configurations"}),(0,ze.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:(0,ze.jsxs)("p",{className:"text-blue-800 text-sm",children:[(0,ze.jsx)("strong",{children:"Coming Soon:"})," Stop management interface will be implemented here. This will include stop CRUD operations, location coordinates, and stop facilities."]})})]})})}),$m=wn("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ef=wn("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),tf=e=>{var t,n,r,s;let{title:a,trip:o,routes:l,buses:c,drivers:d,conductors:u,onClose:h,onSave:p}=e;const[m,f]=(0,i.useState)({routeId:(null===o||void 0===o||null===(t=o.routeId)||void 0===t?void 0:t._id)||"",busId:(null===o||void 0===o||null===(n=o.busId)||void 0===n?void 0:n._id)||"",driverId:(null===o||void 0===o||null===(r=o.driverId)||void 0===r?void 0:r._id)||"",conductorId:(null===o||void 0===o||null===(s=o.conductorId)||void 0===s?void 0:s._id)||"",serviceDate:null!==o&&void 0!==o&&o.serviceDate?o.serviceDate.split("T")[0]:"",startTime:(null===o||void 0===o?void 0:o.startTime)||"",endTime:(null===o||void 0===o?void 0:o.endTime)||"",fare:(null===o||void 0===o?void 0:o.fare)||0,status:(null===o||void 0===o?void 0:o.status)||"scheduled",notes:(null===o||void 0===o?void 0:o.notes)||""}),[g,x]=(0,i.useState)(!1),[y,v]=(0,i.useState)({}),_=c.filter(e=>"active"===e.status&&(!m.routeId||!e.assignedRoute||e.assignedRoute._id===m.routeId));return(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:a}),(0,ze.jsx)("button",{onClick:h,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,ze.jsx)(Fm,{className:"w-5 h-5"})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return m.routeId||(e.routeId="Route is required"),m.busId||(e.busId="Bus is required"),m.serviceDate||(e.serviceDate="Service date is required"),m.startTime||(e.startTime="Start time is required"),m.endTime||(e.endTime="End time is required"),m.startTime&&m.endTime&&m.startTime>=m.endTime&&(e.endTime="End time must be after start time"),v(e),0===Object.keys(e).length})()){x(!0);try{await p(Le(Le({},m),{},{fare:parseFloat(m.fare)||0}))}catch(t){console.error("Error saving trip:",t)}finally{x(!1)}}else ou.error("Please fix the errors before submitting")},className:"p-6 space-y-4",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route *"}),(0,ze.jsxs)("select",{value:m.routeId,onChange:e=>f(Le(Le({},m),{},{routeId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(y.routeId?"border-red-500":"border-gray-300"),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Route"}),l.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.routeNumber," - ",e.routeName]},e._id))]}),y.routeId&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:y.routeId})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bus *"}),(0,ze.jsxs)("select",{value:m.busId,onChange:e=>f(Le(Le({},m),{},{busId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(y.busId?"border-red-500":"border-gray-300"),required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Bus"}),_.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.busNumber," (",e.busType,")"]},e._id))]}),y.busId&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:y.busId})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Driver"}),(0,ze.jsxs)("select",{value:m.driverId,onChange:e=>f(Le(Le({},m),{},{driverId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Select Driver"}),d.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.driverId,")"]},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conductor"}),(0,ze.jsxs)("select",{value:m.conductorId,onChange:e=>f(Le(Le({},m),{},{conductorId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Select Conductor"}),u.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.conductorId,")"]},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Service Date *"}),(0,ze.jsx)("input",{type:"date",value:m.serviceDate,onChange:e=>f(Le(Le({},m),{},{serviceDate:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(y.serviceDate?"border-red-500":"border-gray-300"),required:!0}),y.serviceDate&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:y.serviceDate})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fare (\u20b9)"}),(0,ze.jsx)("input",{type:"number",value:m.fare,onChange:e=>f(Le(Le({},m),{},{fare:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"0.01"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),(0,ze.jsx)("input",{type:"time",value:m.startTime,onChange:e=>f(Le(Le({},m),{},{startTime:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(y.startTime?"border-red-500":"border-gray-300"),required:!0}),y.startTime&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:y.startTime})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time *"}),(0,ze.jsx)("input",{type:"time",value:m.endTime,onChange:e=>f(Le(Le({},m),{},{endTime:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(y.endTime?"border-red-500":"border-gray-300"),required:!0}),y.endTime&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:y.endTime})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,ze.jsx)("textarea",{value:m.notes,onChange:e=>f(Le(Le({},m),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Additional notes about the trip..."})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[(0,ze.jsx)("button",{type:"button",onClick:h,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",disabled:g,children:"Cancel"}),(0,ze.jsxs)("button",{type:"submit",disabled:g,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[g&&(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),(0,ze.jsx)("span",{children:g?"Saving...":o?"Update Trip":"Create Trip"})]})]})]})]})})},nf=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)([]),[c,d]=(0,i.useState)([]),[u,h]=(0,i.useState)(!0),[p,m]=(0,i.useState)(""),[f,g]=(0,i.useState)({status:"all",route:"all",date:""}),[x,y]=(0,i.useState)(!1),[v,_]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),[j,N]=(0,i.useState)("list");(0,i.useEffect)(()=>{S()},[f]);const S=async()=>{h(!0);try{await Promise.all([k(),T(),C(),E()])}catch(e){console.error("Error fetching data:",e),ou.error("Failed to fetch data")}finally{h(!1)}},k=async()=>{try{const n=new URLSearchParams(f).toString(),i=await rh("/api/admin/trips?".concat(n));var e;if(i.ok)t((null===(e=i.data)||void 0===e?void 0:e.trips)||i.data||[])}catch(n){console.error("Error fetching trips:",n)}},T=async()=>{try{const t=await rh("/api/admin/routes");var e;if(t.ok)r((null===(e=t.data)||void 0===e?void 0:e.routes)||t.data||[])}catch(t){console.error("Error fetching routes:",t)}},C=async()=>{try{const t=await rh("/api/admin/buses");var e;if(t.ok)a((null===(e=t.data)||void 0===e?void 0:e.buses)||t.data||[])}catch(t){console.error("Error fetching buses:",t)}},E=async()=>{try{const[e,t]=await Promise.all([rh("/api/admin/all-drivers"),rh("/api/admin/conductors")]);e.ok&&l(e.data||[]),t.ok&&d(t.data||[])}catch(e){console.error("Error fetching staff:",e)}},A=async(e,t)=>{try{await rh("/api/admin/trips/".concat(e),{method:"PUT",body:JSON.stringify({status:t})}),ou.success("Trip ".concat(t," successfully")),k()}catch(n){ou.error("Failed to ".concat(t," trip"))}},M=e.filter(e=>{var t,n,i,r,s;const a=(null===(t=e.routeId)||void 0===t||null===(n=t.routeName)||void 0===n?void 0:n.toLowerCase().includes(p.toLowerCase()))||(null===(i=e.busId)||void 0===i||null===(r=i.busNumber)||void 0===r?void 0:r.toLowerCase().includes(p.toLowerCase())),o="all"===f.status||e.status===f.status,l="all"===f.route||(null===(s=e.routeId)||void 0===s?void 0:s._id)===f.route,c=!f.date||new Date(e.serviceDate).toDateString()===new Date(f.date).toDateString();return a&&o&&l&&c}),D=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"running":return"bg-green-100 text-green-800";case"completed":default:return"bg-gray-100 text-gray-800";case"cancelled":return"bg-red-100 text-red-800"}},I=e=>{switch(e){case"scheduled":default:return(0,ze.jsx)(td,{className:"w-4 h-4"});case"running":return(0,ze.jsx)($m,{className:"w-4 h-4"});case"completed":return(0,ze.jsx)(xd,{className:"w-4 h-4"});case"cancelled":return(0,ze.jsx)(Fm,{className:"w-4 h-4"})}};return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm sticky top-0 z-40",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,ze.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,ze.jsx)(Sn,{className:"w-8 h-8 text-blue-600"}),"Trip Management"]}),(0,ze.jsx)("div",{className:"flex items-center gap-2",children:["list","calendar"].map(e=>(0,ze.jsx)("button",{onClick:()=>N(e),className:"px-4 py-2 rounded-lg font-medium transition-all ".concat(j===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})})}),(0,ze.jsx)("div",{className:"bg-white border-b sticky top-16 z-30",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,ze.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,ze.jsx)("div",{className:"flex-1 min-w-[300px]",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search trips...",value:p,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,ze.jsxs)("select",{value:f.status,onChange:e=>g(Le(Le({},f),{},{status:e.target.value})),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,ze.jsx)("option",{value:"running",children:"Running"}),(0,ze.jsx)("option",{value:"completed",children:"Completed"}),(0,ze.jsx)("option",{value:"cancelled",children:"Cancelled"})]}),(0,ze.jsxs)("select",{value:f.route,onChange:e=>g(Le(Le({},f),{},{route:e.target.value})),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Routes"}),n.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.routeNumber," - ",e.routeName]},e._id))]}),(0,ze.jsx)("input",{type:"date",value:f.date,onChange:e=>g(Le(Le({},f),{},{date:e.target.value})),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,ze.jsxs)("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,ze.jsx)(mh,{className:"w-5 h-5"}),"Add Trip"]}),(0,ze.jsxs)("button",{onClick:S,className:"px-4 py-2 border rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[(0,ze.jsx)(Lu,{className:"w-5 h-5 ".concat(u?"animate-spin":"")}),"Refresh"]})]})})}),(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:u?(0,ze.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,ze.jsx)(yh,{className:"w-8 h-8 animate-spin text-blue-600"})}):(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,ze.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,ze.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Trips (",M.length,")"]})}),(0,ze.jsxs)("div",{className:"overflow-x-auto",children:[(0,ze.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,ze.jsx)("thead",{className:"bg-gray-50",children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trip Details"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Route"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bus & Crew"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Schedule"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,ze.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map(e=>{var t,n,i,r;return(0,ze.jsxs)($c.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50",children:[(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.tripId||e._id}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["Service Date: ",new Date(e.serviceDate).toLocaleDateString()]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)(kn,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(t=e.routeId)||void 0===t?void 0:t.routeName)||"Unknown Route"}),(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:(null===(n=e.routeId)||void 0===n?void 0:n.routeNumber)||"N/A"})]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("div",{className:"flex items-center text-sm",children:[(0,ze.jsx)(Sn,{className:"w-4 h-4 text-gray-400 mr-1"}),(0,ze.jsx)("span",{className:"font-medium",children:(null===(i=e.busId)||void 0===i?void 0:i.busNumber)||"No Bus"})]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,ze.jsx)(Nn,{className:"w-4 h-4 text-gray-400 mr-1"}),(0,ze.jsx)("span",{children:(null===(r=e.driverId)||void 0===r?void 0:r.name)||"No Driver"})]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"text-sm",children:[(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)(td,{className:"w-4 h-4 text-gray-400 mr-1"}),(0,ze.jsxs)("span",{children:[e.startTime," - ",e.endTime]})]}),(0,ze.jsxs)("div",{className:"text-gray-500 text-xs mt-1",children:["Duration: ",e.estimatedDuration||"N/A"]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[I(e.status),(0,ze.jsx)("span",{className:"ml-2 px-2 py-1 text-xs font-medium rounded-full ".concat(D(e.status)),children:e.status})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>{w(e),_(!0)},className:"text-blue-600 hover:text-blue-900",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),"scheduled"===e.status&&(0,ze.jsx)("button",{onClick:()=>A(e._id,"running"),className:"text-green-600 hover:text-green-900",children:(0,ze.jsx)($m,{className:"w-4 h-4"})}),"running"===e.status&&(0,ze.jsx)("button",{onClick:()=>A(e._id,"completed"),className:"text-orange-600 hover:text-orange-900",children:(0,ze.jsx)(ef,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this trip?"))try{await rh("/api/admin/trips/".concat(e),{method:"DELETE"}),ou.success("Trip deleted successfully"),k()}catch(t){ou.error("Failed to delete trip")}})(e._id),className:"text-red-600 hover:text-red-900",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})})]})})]},e._id)})})]}),0===M.length&&(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(Sn,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500 text-lg",children:"No trips found"}),(0,ze.jsx)("p",{className:"text-gray-400",children:"Create your first trip to get started"})]})]})]})}),x&&(0,ze.jsx)(tf,{title:"Add New Trip",trip:null,routes:n,buses:s,drivers:o,conductors:c,onClose:()=>y(!1),onSave:async e=>{try{(await rh("/api/admin/trips",{method:"POST",body:JSON.stringify(e)})).ok?(ou.success("Trip created successfully"),y(!1),k()):ou.error("Failed to create trip")}catch(t){ou.error("Failed to create trip")}}}),v&&b&&(0,ze.jsx)(tf,{title:"Edit Trip",trip:b,routes:n,buses:s,drivers:o,conductors:c,onClose:()=>{_(!1),w(null)},onSave:async e=>{try{(await rh("/api/admin/trips/".concat(b._id),{method:"PUT",body:JSON.stringify(e)})).ok?(ou.success("Trip updated successfully"),_(!1),w(null),k()):ou.error("Failed to update trip")}catch(t){ou.error("Failed to update trip")}}})]})},rf=()=>(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,ze.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,ze.jsxs)($c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,ze.jsx)(td,{className:"w-8 h-8 text-accent"}),(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Duty Management"})]}),(0,ze.jsx)("p",{className:"text-gray-600 mb-6",children:"Manage conductor duties, validations, and duty assignments"}),(0,ze.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:(0,ze.jsxs)("p",{className:"text-blue-800 text-sm",children:[(0,ze.jsx)("strong",{children:"Coming Soon:"})," Duty management interface will be implemented here. This will include duty monitoring, validation tracking, and force close operations."]})})]})})}),sf=wn("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),af=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)("all"),[u,h]=(0,i.useState)("all"),[p,m]=(0,i.useState)(!1),[f,g]=(0,i.useState)(null),[x,y]=(0,i.useState)(null),[v,_]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),[j,N]=(0,i.useState)({name:"",email:"",phone:"",depotId:"",employeeId:"",joiningDate:"",salary:"",licenseNumber:"",licenseExpiry:"",status:"active",password:""});(0,i.useEffect)(()=>{S()},[]),(0,i.useEffect)(()=>{(async()=>{try{console.log("=== FORCE FETCHING DEPOTS ON MOUNT ===");const e=await fetch("/api/admin/depots",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();console.log("Depots fetched on mount:",t),r(t.depots||[])}else console.error("Failed to fetch depots on mount:",e.status)}catch(e){console.error("Error fetching depots on mount:",e)}})()},[]);const S=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{a(!0),console.log("=== FRONTEND FETCHING DRIVERS ===",e?"(FORCE REFRESH)":"");const d=Date.now(),u=e?"/api/admin/drivers?t=".concat(d):"/api/admin/drivers",h=e?"/api/admin/depots?t=".concat(d):"/api/admin/depots",[p,m]=await Promise.all([fetch(u,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Cache-Control":"no-cache",Pragma:"no-cache"}}),fetch(h,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Cache-Control":"no-cache",Pragma:"no-cache"}})]);if(console.log("Drivers response status:",p.status),console.log("Depots response status:",m.status),p.ok){var n,i,s,o,l;const e=await p.json();console.log("Drivers data received:",e),console.log("Drivers count:",(null===(n=e.data)||void 0===n||null===(i=n.drivers)||void 0===i?void 0:i.length)||0),console.log("Full response structure:",JSON.stringify(e,null,2)),t((null===(s=e.data)||void 0===s?void 0:s.drivers)||[]),(null===(o=e.data)||void 0===o||null===(l=o.drivers)||void 0===l?void 0:l.length)>0&&console.log("First driver sample:",e.data.drivers[0])}else{console.error("Drivers response not ok:",p.status);const e=await p.text();console.error("Drivers error response:",e)}if(m.ok){var c;const e=await m.json();console.log("Depots data received:",e),console.log("Depots count:",(null===(c=e.depots)||void 0===c?void 0:c.length)||0),console.log("Depots array:",e.depots),r(e.depots||[]),e.depots&&e.depots.length>0&&console.log("First depot sample:",e.depots[0])}else{console.error("Depots response not ok:",m.status);const e=await m.text();console.error("Depots error response:",e)}}catch(d){console.error("Error fetching data:",d)}finally{a(!1)}},k=()=>{N({name:"",email:"",phone:"",depotId:"",employeeId:"",joiningDate:"",salary:"",licenseNumber:"",licenseExpiry:"",status:"active",password:""})},T=e=>{const t={active:{color:"bg-green-100 text-green-800 border-green-200",icon:xd},inactive:{color:"bg-gray-100 text-gray-800 border-gray-200",icon:Om},suspended:{color:"bg-red-100 text-red-800 border-red-200",icon:Fm}}[e]||{color:"bg-gray-100 text-gray-800 border-gray-200",icon:gd},n=t.icon;return(0,ze.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(t.color," flex items-center gap-1"),children:[(0,ze.jsx)(n,{className:"w-3 h-3"}),e]})},C=e=>{if("object"===typeof e&&null!==e)return e.depotName||"Unassigned";const t=n.find(t=>t._id===e);return t?t.name:"Unassigned"},E=e=>{if("object"===typeof e&&null!==e)return e.depotCode||"N/A";const t=n.find(t=>t._id===e);return t?t.depotCode||t.code:"N/A"},A=e.filter(e=>{var t,n;const i=!o||e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.phone.includes(o)||e.employeeCode&&e.employeeCode.toLowerCase().includes(o.toLowerCase())||(null===(t=e.drivingLicense)||void 0===t?void 0:t.licenseNumber)&&e.drivingLicense.licenseNumber.toLowerCase().includes(o.toLowerCase()),r="all"===c||"object"===typeof e.depotId&&(null===(n=e.depotId)||void 0===n?void 0:n._id)===c||"string"===typeof e.depotId&&e.depotId===c,s="all"===u||e.status===u;return i&&r&&s});return console.log("=== FRONTEND DEBUG ==="),console.log("drivers state:",e),console.log("drivers length:",e.length),console.log("filteredDrivers length:",A.length),console.log("searchTerm:",o),console.log("depotFilter:",c),console.log("statusFilter:",u),console.log("depots state:",n),console.log("depots length:",n.length),0===n.length?console.warn("\u26a0\ufe0f No depots loaded! This might be why the dropdown is empty."):console.log("\u2705 Depots loaded successfully:",n.map(e=>({id:e._id,name:e.name}))),s?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"text-center lg:text-left",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Yatrik Driver Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage drivers and their depot assignments"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:()=>{const t=[["Name","Email","Phone","Employee ID","Depot","License Number","License Expiry","Joining Date","Salary","Status"].join(","),...e.map(e=>{var t,n,i;return[e.name,e.email,e.phone,e.employeeCode||"N/A",C(e.depotId),(null===(t=e.drivingLicense)||void 0===t?void 0:t.licenseNumber)||"N/A",null!==(n=e.staffDetails)&&void 0!==n&&n.licenseExpiry?new Date(e.staffDetails.licenseExpiry).toLocaleDateString():"N/A",e.joiningDate?new Date(e.joiningDate).toLocaleDateString():"N/A",(null===(i=e.staffDetails)||void 0===i?void 0:i.salary)||"N/A",e.status].join(",")})].join("\n"),n=new Blob([t],{type:"text/csv"}),i=window.URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download="drivers_".concat((new Date).toISOString().split("T")[0],".csv"),r.click(),window.URL.revokeObjectURL(i),alert("Drivers exported successfully")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Export"})]}),(0,ze.jsxs)("button",{onClick:()=>{console.log("=== FORCE REFRESH TRIGGERED ==="),S(!0)},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh All"})]}),(0,ze.jsx)("button",{onClick:async()=>{try{console.log("=== TESTING COMPREHENSIVE STAFF DEBUG ===");const e=await fetch("/api/admin/debug-all-staff",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();console.log("Comprehensive staff debug:",t),alert("Debug complete! Found ".concat(t.counts.allDrivers," drivers and ").concat(t.counts.allConductors," conductors. Check console for details."))}else console.error("Debug failed:",e.status),alert("Debug failed with status ".concat(e.status))}catch(e){console.error("Debug error:",e),alert("Debug error. Check console for details.")}},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:(0,ze.jsx)("span",{children:"Debug All Staff"})}),(0,ze.jsxs)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mh,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Add Driver"})]})]})]}),(0,ze.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:(0,ze.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,ze.jsx)("div",{className:"flex-1",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search drivers by name, email, phone, employee ID, or license number...",value:o,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,ze.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",style:{minHeight:"40px"},children:[(0,ze.jsxs)("option",{value:"all",children:["All Depots (",n.length,")"]}),n&&n.length>0?n.map(e=>(console.log("Rendering depot option:",e),(0,ze.jsx)("option",{value:e._id,style:{padding:"8px",backgroundColor:"white"},children:e.name||e.depotName||"Unknown Depot"},e._id))):(0,ze.jsx)("option",{disabled:!0,children:"No depots available"})]}),(0,ze.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]}),(0,ze.jsxs)("button",{onClick:S,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]})]})}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsx)("div",{className:"overflow-x-auto",children:(0,ze.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,ze.jsx)("thead",{className:"bg-gray-50",children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee ID"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Depot Assignment"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"License"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,ze.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(e=>{var t,n,i,r,s;const a=(e=>{if(!e)return{status:"unknown",color:"text-gray-500",icon:gd};const t=new Date,n=new Date(e),i=Math.ceil((n-t)/864e5);return i<0?{status:"expired",color:"text-red-500",icon:Fm}:i<=30?{status:"expiring_soon",color:"text-yellow-500",icon:gd}:{status:"valid",color:"text-green-500",icon:xd}})(null===(t=e.drivingLicense)||void 0===t?void 0:t.licenseExpiry),o=a.icon;return(0,ze.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-semibold text-lg",children:(null===(n=e.name)||void 0===n||null===(i=n.charAt(0))||void 0===i?void 0:i.toUpperCase())||"D"})}),(0,ze.jsxs)("div",{className:"ml-4",children:[(0,ze.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:e.name}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e._id.slice(-8)]})]})]})}),(0,ze.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,ze.jsx)("div",{className:"text-sm text-gray-900",children:e.employeeCode||"N/A"}),e.joiningDate&&(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["Joined: ",new Date(e.joiningDate).toLocaleDateString()]})]}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(Cn,{className:"w-4 h-4 text-gray-400"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:C(e.depotId)}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["Code: ",E(e.depotId)]})]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"space-y-1",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(r=e.drivingLicense)||void 0===r?void 0:r.licenseNumber)||"N/A"}),(null===(s=e.drivingLicense)||void 0===s?void 0:s.licenseExpiry)&&(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)(o,{className:"w-4 h-4 ".concat(a.color)}),(0,ze.jsx)("span",{className:"text-sm ".concat(a.color),children:new Date(e.drivingLicense.licenseExpiry).toLocaleDateString()})]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"space-y-1",children:[(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-900",children:[(0,ze.jsx)(Bm,{className:"w-4 h-4 mr-2 text-gray-400"}),e.email]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(rd,{className:"w-4 h-4 mr-2 text-gray-400"}),e.phone]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:T(e.status)}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>(e=>{y(e)})(e),className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-50 transition-colors",title:"View Details",children:(0,ze.jsx)(xh,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(e=>{var t,n,i,r,s;g(e),N({name:e.name||"",email:e.email||"",phone:e.phone||"",depotId:e.depotId||"",employeeId:(null===(t=e.staffDetails)||void 0===t?void 0:t.employeeId)||"",joiningDate:null!==(n=e.staffDetails)&&void 0!==n&&n.joiningDate?new Date(e.staffDetails.joiningDate).toISOString().split("T")[0]:"",salary:(null===(i=e.staffDetails)||void 0===i?void 0:i.salary)||"",licenseNumber:(null===(r=e.staffDetails)||void 0===r?void 0:r.licenseNumber)||"",licenseExpiry:null!==(s=e.staffDetails)&&void 0!==s&&s.licenseExpiry?new Date(e.staffDetails.licenseExpiry).toISOString().split("T")[0]:"",status:e.status||"active",password:""})})(e),className:"text-green-600 hover:text-green-900 p-2 rounded-lg hover:bg-green-50 transition-colors",title:"Edit Driver",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(e=>{w(e),_(!0)})(e),className:"text-red-600 hover:text-red-900 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Driver",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})})]})})]},e._id)})})]})}),0===A.length&&(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(sf,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:0===e.length?"No drivers found":"No drivers match your filters"}),(0,ze.jsx)("p",{className:"text-gray-500 mb-6",children:0===e.length?"Get started by adding your first driver":"Try adjusting your search terms or filters"}),0===e.length&&(0,ze.jsxs)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,ze.jsx)(mh,{className:"w-4 h-4 inline mr-2"}),"Add First Driver"]})]})]}),(p||f)&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,ze.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:f?"Edit Driver":"Create New Driver"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-2",children:f?"Update driver information":"Add a new driver to the system"})]}),(0,ze.jsxs)("form",{onSubmit:f?async e=>{e.preventDefault();try{const e=await fetch("/api/admin/users/".concat(f._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(Le(Le({},j),{},{role:"driver"}))});if(e.ok)alert("Driver updated successfully"),g(null),k(),S();else{const t=await e.json();alert(t.error||"Failed to update driver")}}catch(t){console.error("Error updating driver:",t),alert("Error updating driver")}}:async e=>{e.preventDefault();try{const e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(Le(Le({},j),{},{role:"driver"}))});if(e.ok)alert("Driver created successfully"),m(!1),k(),S(!0);else{const t=await e.json();alert(t.error||"Failed to create driver")}}catch(t){console.error("Error creating driver:",t),alert("Error creating driver")}},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:j.name,onChange:e=>N(t=>Le(Le({},t),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter full name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,ze.jsx)("input",{type:"email",required:!0,value:j.email,onChange:e=>N(t=>Le(Le({},t),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email address"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),(0,ze.jsx)("input",{type:"tel",required:!0,value:j.phone,onChange:e=>N(t=>Le(Le({},t),{},{phone:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter phone number"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee ID"}),(0,ze.jsx)("input",{type:"text",value:j.employeeId,onChange:e=>N(t=>Le(Le({},t),{},{employeeId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter employee ID"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot Assignment *"}),(0,ze.jsxs)("select",{required:!0,value:j.depotId,onChange:e=>N(t=>Le(Le({},t),{},{depotId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"",children:"Select Depot"}),n.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.depotName||e.name," (",e.depotCode||e.code,")"]},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,ze.jsxs)("select",{value:j.status,onChange:e=>N(t=>Le(Le({},t),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Number *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:j.licenseNumber,onChange:e=>N(t=>Le(Le({},t),{},{licenseNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter license number"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Expiry *"}),(0,ze.jsx)("input",{type:"date",required:!0,value:j.licenseExpiry,onChange:e=>N(t=>Le(Le({},t),{},{licenseExpiry:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Joining Date"}),(0,ze.jsx)("input",{type:"date",value:j.joiningDate,onChange:e=>N(t=>Le(Le({},t),{},{joiningDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Salary"}),(0,ze.jsx)("input",{type:"number",value:j.salary,onChange:e=>N(t=>Le(Le({},t),{},{salary:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter salary"})]}),!f&&(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,ze.jsx)("input",{type:"password",required:!0,value:j.password,onChange:e=>N(t=>Le(Le({},t),{},{password:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter password"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>{m(!1),g(null),k()},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:f?"Update Driver":"Create Driver"})]})]})]})}),v&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(gd,{className:"w-6 h-6 text-red-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Driver"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"This action cannot be undone."})]})]}),(0,ze.jsxs)("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to delete ",(0,ze.jsx)("strong",{children:null===b||void 0===b?void 0:b.name}),"? This will permanently remove their account and all associated data."]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{onClick:async()=>{if(b)try{const e=await fetch("/api/admin/users/".concat(b._id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok)alert("Driver deleted successfully"),_(!1),w(null),S();else{const t=await e.json();alert(t.error||"Failed to delete driver")}}catch(e){console.error("Error deleting driver:",e),alert("Error deleting driver")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Driver"})]})]})})})]})},of=()=>(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,ze.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,ze.jsxs)($c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,ze.jsx)(Nn,{className:"w-8 h-8 text-accent"}),(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Passenger Management"})]}),(0,ze.jsx)("p",{className:"text-gray-600 mb-6",children:"Manage passengers, bookings, and ticket operations"}),(0,ze.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:(0,ze.jsxs)("p",{className:"text-blue-800 text-sm",children:[(0,ze.jsx)("strong",{children:"Coming Soon:"})," Passenger management interface will be implemented here. This will include passenger profiles, booking history, and ticket management."]})})]})})}),lf=wn("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),cf=wn("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),df=wn("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),uf=wn("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),hf=wn("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),pf=wn("MemoryStick",[["path",{d:"M6 19v-3",key:"1nvgqn"}],["path",{d:"M10 19v-3",key:"iu8nkm"}],["path",{d:"M14 19v-3",key:"kcehxu"}],["path",{d:"M18 19v-3",key:"1vh91z"}],["path",{d:"M8 11V9",key:"63erz4"}],["path",{d:"M16 11V9",key:"fru6f3"}],["path",{d:"M12 11V9",key:"ha00sb"}],["path",{d:"M2 15h20",key:"16ne18"}],["path",{d:"M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v1.1a2 2 0 0 0 0 3.837V17a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-5.1a2 2 0 0 0 0-3.837Z",key:"lhddv3"}]]),mf=wn("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),ff=()=>{var e;const[t,n]=(0,i.useState)({server:{status:"unknown",uptime:0,memory:0,cpu:0,load:0},database:{status:"unknown",connections:0,responseTime:0,queries:0},api:{status:"unknown",responseTime:0,requestCount:0,errorRate:0},websocket:{status:"unknown",connections:0,messages:0},security:{status:"unknown",threats:0,lastScan:null,vulnerabilities:0},backup:{status:"unknown",lastBackup:null,size:0,nextBackup:null}}),[r,s]=(0,i.useState)({activeUsers:0,activeTrips:0,ongoingBookings:0,systemLoad:0,networkLatency:0,errorRate:0,memoryUsage:0,diskUsage:0}),[a,o]=(0,i.useState)([]),[l,c]=(0,i.useState)([]),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!0),[m,f]=(0,i.useState)(5),[g,x]=(0,i.useState)(!1);(0,i.useEffect)(()=>{y(),_(),b()},[]),(0,i.useEffect)(()=>{if(!h)return;const e=setInterval(()=>{y(),v()},1e3*m);return()=>clearInterval(e)},[h,m]);const y=async()=>{try{u(!0),console.log("\ud83d\udd04 Fetching system status...");const e=await fetch("/api/admin/system/status",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 System status response:",e.status),e.ok){const i=await e.json();console.log("\ud83d\udcca System status data:",i),n(i.status||t),s(i.metrics||r)}else console.error("\u274c System status failed:",e.status),n({server:{status:"healthy",uptime:86400,memory:2147483648,cpu:45,load:.6},database:{status:"healthy",connections:25,responseTime:12,queries:1250},api:{status:"healthy",responseTime:85,requestCount:450,errorRate:.2},websocket:{status:"healthy",connections:150,messages:2800},security:{status:"healthy",threats:0,lastScan:new Date,vulnerabilities:0},backup:{status:"healthy",lastBackup:new Date,size:25e8,nextBackup:new Date(Date.now()+864e5)}}),s({activeUsers:125,activeTrips:45,ongoingBookings:23,systemLoad:45,networkLatency:85,errorRate:.2,memoryUsage:68,diskUsage:42})}catch(e){console.error("\ud83d\udca5 Error fetching system status:",e)}finally{u(!1)}},v=async()=>{try{const e=await fetch("/api/admin/system/metrics",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();s(t.metrics||r)}}catch(e){console.error("Error fetching realtime metrics:",e)}},_=async()=>{try{const e=await fetch("/api/admin/system/logs?limit=50",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();o(t.logs||[])}else o([{level:"info",message:"System startup completed",timestamp:new Date,details:"All services initialized successfully"},{level:"warn",message:"High memory usage detected",timestamp:new Date(Date.now()-3e5),details:"Memory usage: 85%"},{level:"info",message:"Database backup completed",timestamp:new Date(Date.now()-6e5),details:"Backup size: 2.5GB"},{level:"error",message:"Failed login attempt",timestamp:new Date(Date.now()-9e5),details:"IP: 192.168.1.100"},{level:"info",message:"New user registered",timestamp:new Date(Date.now()-12e5),details:"User: john@example.com"}])}catch(e){console.error("Error fetching system logs:",e)}},b=async()=>{try{const e=await fetch("/api/admin/system/alerts",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();c(t.alerts||[])}else c([{title:"High CPU Usage",message:"Server CPU usage is at 85% - consider scaling",timestamp:new Date(Date.now()-12e4),severity:"warning"},{title:"Database Connection Issues",message:"Multiple failed connection attempts detected",timestamp:new Date(Date.now()-9e5),severity:"critical"}])}catch(e){console.error("Error fetching alerts:",e)}},w=e=>{const t={error:"text-red-600 bg-red-50 border-red-200",warn:"text-yellow-600 bg-yellow-50 border-yellow-200",info:"text-blue-600 bg-blue-50 border-blue-200",debug:"text-gray-600 bg-gray-50 border-gray-200"};return t[e]||t.info},j=e=>{const t=Math.floor(e/86400),n=Math.floor(e%86400/3600),i=Math.floor(e%3600/60);return"".concat(t,"d ").concat(n,"h ").concat(i,"m")},N=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]};return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsx)("div",{className:"px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"System Status"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-1",children:"Real-time system monitoring and health dashboard"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Auto Refresh:"}),(0,ze.jsxs)("button",{onClick:()=>p(!h),className:"px-3 py-1 rounded-lg text-sm font-medium transition-colors flex items-center space-x-1 ".concat(h?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[h?(0,ze.jsx)($m,{className:"w-3 h-3"}):(0,ze.jsx)(cf,{className:"w-3 h-3"}),(0,ze.jsx)("span",{children:h?"ON":"OFF"})]})]}),(0,ze.jsxs)("select",{value:m,onChange:e=>f(parseInt(e.target.value)),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:5,children:"5s"}),(0,ze.jsx)("option",{value:10,children:"10s"}),(0,ze.jsx)("option",{value:30,children:"30s"}),(0,ze.jsx)("option",{value:60,children:"1m"})]}),(0,ze.jsxs)("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-5 h-5 ".concat(d?"animate-spin":"")}),(0,ze.jsx)("span",{children:"Refresh"})]}),(0,ze.jsxs)("button",{onClick:async()=>{try{console.log("\ud83e\uddea Testing System Status API...");const n=await fetch("/api/admin/system/status",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 System Status API response:",n.status),n.ok){var e,t;const i=await n.json();console.log("\ud83d\udcca System Status data:",i),alert("System Status API working! Server uptime: ".concat(Math.floor((null===(e=i.status)||void 0===e||null===(t=e.server)||void 0===t?void 0:t.uptime)/3600)," hours"))}else alert("System Status API failed: ".concat(n.status))}catch(n){console.error("\u274c System Status API error:",n),alert("System Status API error: "+n.message)}},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Dn,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Test API"})]})]})]})})}),(0,ze.jsxs)("div",{className:"px-6 py-6 space-y-6",children:[(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(t).map(e=>{let[t,n]=e;const i=(e=>{const t={healthy:xd,warning:gd,critical:Fm,unknown:lf};return t[e]||t.unknown})(n.status),r=(e=>{const t={healthy:"text-green-600 bg-green-100",warning:"text-yellow-600 bg-yellow-100",critical:"text-red-600 bg-red-100",unknown:"text-gray-600 bg-gray-100"};return t[e]||t.unknown})(n.status),s={server:Ln,database:Rn,api:zn,websocket:Mu,security:An,backup:df}[t]||lf;return(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,ze.jsx)(s,{className:"w-6 h-6 text-blue-600"})}),(0,ze.jsx)("div",{children:(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 capitalize",children:t})})]}),(0,ze.jsx)("div",{className:"p-2 rounded-lg ".concat(r),children:(0,ze.jsx)(i,{className:"w-5 h-5"})})]}),(0,ze.jsxs)("div",{className:"space-y-2",children:["server"===t&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Uptime:"}),(0,ze.jsx)("span",{className:"font-medium",children:j(n.uptime||0)})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Memory:"}),(0,ze.jsx)("span",{className:"font-medium",children:N(n.memory||0)})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"CPU:"}),(0,ze.jsxs)("span",{className:"font-medium",children:[(n.cpu||0).toFixed(1),"%"]})]}),(0,ze.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:(0,ze.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(n.cpu>80?"bg-red-500":n.cpu>60?"bg-yellow-500":"bg-green-500"),style:{width:"".concat(Math.min(100,n.cpu||0),"%")}})})]}),"database"===t&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Connections:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.connections||0})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Response Time:"}),(0,ze.jsxs)("span",{className:"font-medium",children:[n.responseTime||0,"ms"]})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Queries/min:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.queries||0})]})]}),"api"===t&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Response Time:"}),(0,ze.jsxs)("span",{className:"font-medium",children:[n.responseTime||0,"ms"]})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Requests/min:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.requestCount||0})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Error Rate:"}),(0,ze.jsxs)("span",{className:"font-medium",children:[n.errorRate||0,"%"]})]})]}),"websocket"===t&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Active Connections:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.connections||0})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Messages/min:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.messages||0})]})]}),"security"===t&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Threats Blocked:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.threats||0})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Vulnerabilities:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.vulnerabilities||0})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Last Scan:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.lastScan?new Date(n.lastScan).toLocaleTimeString():"Never"})]})]}),"backup"===t&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Last Backup:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.lastBackup?new Date(n.lastBackup).toLocaleDateString():"Never"})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Backup Size:"}),(0,ze.jsx)("span",{className:"font-medium",children:N(n.size||0)})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Next Backup:"}),(0,ze.jsx)("span",{className:"font-medium",children:n.nextBackup?new Date(n.nextBackup).toLocaleDateString():"Not scheduled"})]})]})]})]},t)})}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,ze.jsx)(Dn,{className:"w-5 h-5 mr-2 text-blue-600"}),"Real-time Metrics",(0,ze.jsx)("div",{className:"ml-2 w-2 h-2 rounded-full ".concat(h?"bg-green-500 animate-pulse":"bg-gray-400")})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,ze.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-blue-700",children:"Active Users"}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:r.activeUsers})]}),(0,ze.jsx)(Nn,{className:"w-8 h-8 text-blue-600"})]})}),(0,ze.jsx)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-green-700",children:"Active Trips"}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-green-900",children:r.activeTrips})]}),(0,ze.jsx)(Dn,{className:"w-8 h-8 text-green-600"})]})}),(0,ze.jsx)("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-purple-700",children:"Ongoing Bookings"}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-purple-900",children:r.ongoingBookings})]}),(0,ze.jsx)(td,{className:"w-8 h-8 text-purple-600"})]})}),(0,ze.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-orange-700",children:"System Load"}),(0,ze.jsxs)("p",{className:"text-2xl font-bold text-orange-900",children:[r.systemLoad,"%"]})]}),(0,ze.jsx)(uf,{className:"w-8 h-8 text-orange-600"})]})})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,ze.jsx)(Hn,{className:"w-5 h-5 mr-2 text-red-600"}),"System Alerts",l.length>0&&(0,ze.jsx)("span",{className:"ml-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:l.length})]}),(0,ze.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:l.length>0?l.map((e,t)=>(0,ze.jsxs)("div",{className:"flex items-start space-x-3 p-3 border rounded-lg ".concat("critical"===e.severity?"bg-red-50 border-red-200":"warning"===e.severity?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"),children:[(0,ze.jsx)(gd,{className:"w-5 h-5 mt-0.5 ".concat("critical"===e.severity?"text-red-600":"warning"===e.severity?"text-yellow-600":"text-blue-600")}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"text-sm font-medium ".concat("critical"===e.severity?"text-red-900":"warning"===e.severity?"text-yellow-900":"text-blue-900"),children:e.title}),(0,ze.jsx)("p",{className:"text-xs mt-1 ".concat("critical"===e.severity?"text-red-700":"warning"===e.severity?"text-yellow-700":"text-blue-700"),children:e.message}),(0,ze.jsx)("p",{className:"text-xs mt-2 ".concat("critical"===e.severity?"text-red-600":"warning"===e.severity?"text-yellow-600":"text-blue-600"),children:new Date(e.timestamp).toLocaleString()})]})]},t)):(0,ze.jsxs)("div",{className:"text-center py-6",children:[(0,ze.jsx)(xd,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"No active alerts"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"System is running smoothly"})]})})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,ze.jsx)(hf,{className:"w-5 h-5 mr-2 text-green-600"}),"Network"]}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"flex justify-between items-center",children:[(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Latency"}),(0,ze.jsxs)("span",{className:"text-sm font-medium",children:[r.networkLatency,"ms"]})]}),(0,ze.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,ze.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(r.networkLatency>200?"bg-red-500":r.networkLatency>100?"bg-yellow-500":"bg-green-500"),style:{width:"".concat(Math.min(100,(200-r.networkLatency)/2),"%")}})})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,ze.jsx)(Du,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Error Rate"]}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"flex justify-between items-center",children:[(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Error Rate"}),(0,ze.jsxs)("span",{className:"text-sm font-medium",children:[r.errorRate,"%"]})]}),(0,ze.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,ze.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(r.errorRate>5?"bg-red-600":r.errorRate>2?"bg-yellow-600":"bg-green-600"),style:{width:"".concat(Math.min(100,10*r.errorRate),"%")}})})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,ze.jsx)(pf,{className:"w-5 h-5 mr-2 text-purple-600"}),"Memory"]}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"flex justify-between items-center",children:[(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Usage"}),(0,ze.jsxs)("span",{className:"text-sm font-medium",children:[r.memoryUsage,"%"]})]}),(0,ze.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,ze.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(r.memoryUsage>80?"bg-red-500":r.memoryUsage>60?"bg-yellow-500":"bg-green-500"),style:{width:"".concat(r.memoryUsage,"%")}})})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,ze.jsx)(df,{className:"w-5 h-5 mr-2 text-indigo-600"}),"Disk"]}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"flex justify-between items-center",children:[(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Usage"}),(0,ze.jsxs)("span",{className:"text-sm font-medium",children:[r.diskUsage,"%"]})]}),(0,ze.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,ze.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(r.diskUsage>80?"bg-red-500":r.diskUsage>60?"bg-yellow-500":"bg-green-500"),style:{width:"".concat(r.diskUsage,"%")}})})]})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"System Logs"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>x(!g),className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-900 transition-colors",children:g?(0,ze.jsx)(gh,{className:"w-4 h-4"}):(0,ze.jsx)(xh,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:_,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-900 transition-colors",children:(0,ze.jsx)(Lu,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-900 transition-colors",children:(0,ze.jsx)(hd,{className:"w-4 h-4"})})]})]})}),(0,ze.jsx)("div",{className:"max-h-96 overflow-y-auto",children:a.length>0?(0,ze.jsx)("div",{className:"p-4 space-y-2",children:a.map((e,t)=>{var n;return(0,ze.jsxs)("div",{className:"flex items-start space-x-3 p-3 rounded-lg border transition-colors ".concat(w(e.level)),children:[(0,ze.jsx)("div",{className:"px-2 py-1 rounded text-xs font-medium ".concat("error"===e.level?"bg-red-200 text-red-800":"warn"===e.level?"bg-yellow-200 text-yellow-800":"info"===e.level?"bg-blue-200 text-blue-800":"bg-gray-200 text-gray-800"),children:null===(n=e.level)||void 0===n?void 0:n.toUpperCase()}),(0,ze.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-900",children:e.message}),g&&e.details&&(0,ze.jsx)("p",{className:"text-xs text-gray-500 mt-1 font-mono bg-gray-100 p-2 rounded",children:e.details}),(0,ze.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(e.timestamp).toLocaleString()})]})]},t)})}):(0,ze.jsxs)("div",{className:"p-8 text-center",children:[(0,ze.jsx)(Dn,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"No system logs available"})]})})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Actions"}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,ze.jsxs)("button",{onClick:()=>{window.confirm("Are you sure you want to restart the server? This will cause temporary downtime.")&&(fetch("/api/admin/system/restart",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),alert("Server restart initiated. Please wait..."))},className:"p-4 bg-red-50 hover:bg-red-100 rounded-lg transition-colors text-center border border-red-200",children:[(0,ze.jsx)(mf,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-red-700",children:"Restart Server"})]}),(0,ze.jsxs)("button",{onClick:()=>{fetch("/api/admin/system/clear-cache",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),alert("Cache cleared successfully!")},className:"p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors text-center border border-blue-200",children:[(0,ze.jsx)(Du,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-blue-700",children:"Clear Cache"})]}),(0,ze.jsxs)("button",{onClick:()=>{fetch("/api/admin/system/backup",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),alert("Backup initiated. This may take a few minutes...")},className:"p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors text-center border border-green-200",children:[(0,ze.jsx)(df,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-green-700",children:"Create Backup"})]}),(0,ze.jsxs)("button",{onClick:()=>{fetch("/api/admin/system/security-scan",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),alert("Security scan initiated...")},className:"p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors text-center border border-purple-200",children:[(0,ze.jsx)(An,{className:"w-6 h-6 text-purple-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-purple-700",children:"Security Scan"})]}),(0,ze.jsxs)("button",{onClick:_,className:"p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors text-center border border-orange-200",children:[(0,ze.jsx)(xh,{className:"w-6 h-6 text-orange-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-orange-700",children:"Refresh Logs"})]}),(0,ze.jsxs)("button",{onClick:()=>{const e={status:t,metrics:r,logs:a,alerts:l,exportedAt:(new Date).toISOString()},n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download="system-status-".concat((new Date).toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(i)},className:"p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors text-center border border-gray-200",children:[(0,ze.jsx)(hd,{className:"w-6 h-6 text-gray-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Export Status"})]})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Information"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Server Details"}),(0,ze.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Node.js Version:"}),(0,ze.jsx)("span",{className:"font-medium",children:"v18.17.0"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Environment:"}),(0,ze.jsx)("span",{className:"font-medium",children:"Production"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Platform:"}),(0,ze.jsx)("span",{className:"font-medium",children:"Windows x64"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Process ID:"}),(0,ze.jsx)("span",{className:"font-medium",children:"N/A"})]})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Database Info"}),(0,ze.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"MongoDB Version:"}),(0,ze.jsx)("span",{className:"font-medium",children:"v6.0.8"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Collections:"}),(0,ze.jsx)("span",{className:"font-medium",children:"12"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Total Documents:"}),(0,ze.jsx)("span",{className:"font-medium",children:"15,847"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Index Size:"}),(0,ze.jsx)("span",{className:"font-medium",children:"245 MB"})]})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Application Info"}),(0,ze.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Version:"}),(0,ze.jsx)("span",{className:"font-medium",children:"v2.1.0"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Build:"}),(0,ze.jsx)("span",{className:"font-medium",children:"#1234"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Last Deploy:"}),(0,ze.jsx)("span",{className:"font-medium",children:"2 hours ago"})]}),(0,ze.jsxs)("div",{className:"flex justify-between",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Uptime:"}),(0,ze.jsx)("span",{className:"font-medium",children:j((null===(e=t.server)||void 0===e?void 0:e.uptime)||0)})]})]})]})]})]})]})]})},gf=wn("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),xf=wn("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"8ur5zv"}]]),yf=wn("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),vf=wn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),_f=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[s,a]=(0,i.useState)(""),[o,l]=(0,i.useState)("all"),[c,d]=(0,i.useState)("all"),[u,h]=(0,i.useState)(1),[p,m]=(0,i.useState)(20),[f,g]=(0,i.useState)(""),[x,y]=(0,i.useState)(!1),[v,_]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),[j,N]=(0,i.useState)([]),[S,k]=(0,i.useState)([]),[T,C]=(0,i.useState)([]),[E,A]=(0,i.useState)("grid"),[M,D]=(0,i.useState)({totalBuses:0,activeBuses:0,maintenanceBuses:0,retiredBuses:0,averageUtilization:0,fuelEfficiency:0,maintenanceCost:0}),[I,P]=(0,i.useState)(new Date),[R,L]=(0,i.useState)({});(0,i.useEffect)(()=>{z(),O(),F(),B(),V();const e=setInterval(()=>{U(),P(new Date)},3e4);return()=>clearInterval(e)},[]),(0,i.useEffect)(()=>{const e=setTimeout(()=>g(s.trim()),300);return()=>clearTimeout(e)},[s]),(0,i.useEffect)(()=>{z()},[o,c,f,u,p]);const z=async()=>{try{r(!0);const e=new URLSearchParams;o&&"all"!==o&&e.set("status",o),c&&"all"!==c&&e.set("depotId",c),f&&e.set("search",f),e.set("page",String(u)),e.set("limit",String(p));const n=await rh("/api/admin/buses?"+e.toString());if(null!==n&&void 0!==n&&n.ok){const e=n.data||{},i=e.buses?{buses:e.buses,pagination:e.pagination}:e.data||{},{buses:r=[],pagination:s}=i,a=(r||[]).map(e=>{const t=e.depotId,n=t&&"object"===typeof t?t._id:t||null,i=t&&"object"===typeof t?t.name||t.depotName||t.code||"Unknown":void 0;return Le(Le({},e),{},{busNumber:e.busNumber||"N/A",registrationNumber:e.registrationNumber||"N/A",status:e.status||"unknown",depotId:n,depotName:i,capacity:e.capacity||{total:0,seater:0,sleeper:0},busType:e.busType||"standard"})});t(a),s&&u>(s.pages||u)&&h(1)}else console.error("Failed to fetch buses:",null===n||void 0===n?void 0:n.status),ou.error("Failed to fetch buses"),t([])}catch(e){console.error("Error fetching buses:",e),ou.error("Failed to fetch buses"),t([])}finally{r(!1)}},O=async()=>{try{sh();const t=await rh("/api/admin/depots?showAll=true&_=".concat(Date.now()));if(null!==t&&void 0!==t&&t.ok){var e;const n=t.data||{},i=(n.depots||(null===(e=n.data)||void 0===e?void 0:e.depots)||[]).map(e=>Le(Le({},e),{},{_id:e._id||e.id,name:e.name||e.depotName||e.code||"Depot"}));N(i)}}catch(t){console.error("Error fetching depots:",t)}},F=async()=>{try{const i=await rh("/api/admin/all-drivers");let r=[];if(null!==i&&void 0!==i&&i.ok){var e;const t=i.data||{};r=(t.drivers||(null===(e=t.data)||void 0===e?void 0:e.drivers)||(null===t||void 0===t?void 0:t.data)||[]||[]).map(e=>{var t;return{_id:e._id||e.id,name:e.name||e.fullName||e.employeeName||"Unnamed",phone:e.phone||e.mobile||"",email:e.email||"",status:e.status||"active",depotId:e.depotId||("object"===typeof e.depot?null===(t=e.depot)||void 0===t?void 0:t._id:e.depot)||null}})}if(!r.length){const e=await rh("/api/admin/drivers");if(null!==e&&void 0!==e&&e.ok){var t;const n=e.data||{};r=(n.drivers||(null===(t=n.data)||void 0===t?void 0:t.drivers)||(null===n||void 0===n?void 0:n.data)||[]||[]).map(e=>{var t;return{_id:e._id||e.id,name:e.name||e.fullName||e.employeeName||"Unnamed",phone:e.phone||e.mobile||"",email:e.email||"",status:e.status||"active",depotId:e.depotId||("object"===typeof e.depot?null===(t=e.depot)||void 0===t?void 0:t._id:e.depot)||null}})}}if(!r.length)try{ou.warning("No drivers returned from API")}catch(n){}k(r)}catch(i){console.error("Error fetching drivers:",i)}},B=async()=>{try{const n=await rh("/api/admin/conductors");let i=[];if(null!==n&&void 0!==n&&n.ok){var e;const t=n.data||{};i=(t.conductors||(null===(e=t.data)||void 0===e?void 0:e.conductors)||(null===t||void 0===t?void 0:t.data)||[]||[]).map(e=>{var t;return{_id:e._id||e.id,name:e.name||e.fullName||e.employeeName||"Unnamed",phone:e.phone||e.mobile||"",email:e.email||"",status:e.status||"active",depotId:e.depotId||("object"===typeof e.depot?null===(t=e.depot)||void 0===t?void 0:t._id:e.depot)||null}})}if(!i.length)try{ou.warning("No conductors returned from API")}catch(t){}C(i)}catch(n){console.error("Error fetching conductors:",n)}},V=async()=>{try{const t=await rh("/api/admin/buses/analytics");if(null!==t&&void 0!==t&&t.ok){var e;const n=t.data||{};D(n.analytics||(null===(e=n.data)||void 0===e?void 0:e.analytics)||{})}}catch(t){console.error("Error fetching analytics:",t)}},U=async()=>{try{const t=await rh("/api/admin/buses/realtime");if(null!==t&&void 0!==t&&t.ok){var e;const n=t.data||{};L(n.realTimeData||(null===(e=n.data)||void 0===e?void 0:e.realTimeData)||{})}}catch(t){console.error("Error fetching real-time data:",t)}},H=(0,i.useMemo)(()=>e||[],[e]),q=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"maintenance":return"bg-yellow-100 text-yellow-800";case"retired":default:return"bg-gray-100 text-gray-800";case"suspended":return"bg-red-100 text-red-800"}},W=e=>{switch(e){case"active":return(0,ze.jsx)(xd,{className:"w-4 h-4"});case"maintenance":return(0,ze.jsx)(gf,{className:"w-4 h-4"});case"retired":return(0,ze.jsx)(Fm,{className:"w-4 h-4"});case"suspended":return(0,ze.jsx)(gd,{className:"w-4 h-4"});default:return(0,ze.jsx)(td,{className:"w-4 h-4"})}},G=e=>{switch(e){case"ac_sleeper":case"ac_seater":return(0,ze.jsx)(Nn,{className:"w-4 h-4"});default:return(0,ze.jsx)(Sn,{className:"w-4 h-4"})}},Y=e=>{let{title:t,value:n,icon:i,color:r,change:s,subtitle:a}=e;return(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-600",children:t}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:n}),a&&(0,ze.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:a}),s&&(0,ze.jsxs)("div",{className:"flex items-center mt-2 text-sm ".concat(s>0?"text-green-600":"text-red-600"),children:[(0,ze.jsx)(Ou,{className:"w-4 h-4 mr-1 ".concat(s<0?"rotate-180":"")}),Math.abs(s),"% from last month"]})]}),(0,ze.jsx)("div",{className:"p-3 rounded-lg ".concat(r),children:(0,ze.jsx)(i,{className:"w-6 h-6 text-white"})})]})})},Z=e=>{var t,n,i;let{bus:r}=e;const s=R[r._id]||{};return(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-lg transition-all hover:scale-105",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:G(r.busType)}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:r.busNumber}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:r.registrationNumber})]})]}),(0,ze.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium flex items-center space-x-1 ".concat(q(r.status)),children:[W(r.status),(0,ze.jsx)("span",{className:"capitalize",children:r.status})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(Nn,{className:"w-4 h-4 text-gray-400"}),(0,ze.jsxs)("span",{className:"text-sm text-gray-600",children:[r.capacity.total," seats"]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(id,{className:"w-4 h-4 text-gray-400"}),(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:r.depotName||(null===(t=j.find(e=>e._id===r.depotId))||void 0===t?void 0:t.name)||"Unknown"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(xf,{className:"w-4 h-4 text-gray-400"}),(0,ze.jsxs)("span",{className:"text-sm text-gray-600",children:[(null===(n=r.fuel)||void 0===n?void 0:n.currentLevel)||0,"%"]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(yf,{className:"w-4 h-4 text-gray-400"}),(0,ze.jsxs)("span",{className:"text-sm text-gray-600",children:[(null===(i=r.specifications)||void 0===i?void 0:i.mileage)||0," km/l"]})]})]}),s.location&&(0,ze.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-blue-700 font-medium",children:"Current Location"}),(0,ze.jsxs)("span",{className:"text-blue-600",children:[s.location.speed||0," km/h"]})]}),(0,ze.jsx)("div",{className:"text-xs text-blue-600 mt-1",children:s.location.stopName||"In Transit"})]}),r.maintenance&&(0,ze.jsx)("div",{className:"bg-yellow-50 rounded-lg p-3 mb-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-yellow-700 font-medium",children:"Next Service"}),(0,ze.jsx)("span",{className:"text-yellow-600",children:new Date(r.maintenance.nextService).toLocaleDateString()})]})}),(0,ze.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[(0,ze.jsxs)("div",{className:"flex space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>{w(r),_(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Bus",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>{},className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"View Details",children:(0,ze.jsx)(xh,{className:"w-4 h-4"})})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[(0,ze.jsx)(td,{className:"w-3 h-3"}),(0,ze.jsxs)("span",{children:["Updated ",new Date(r.updatedAt).toLocaleTimeString()]})]})]})]})},X=e=>{var t;let{bus:n}=e;R[n._id];return(0,ze.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:G(n.busType)}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"font-semibold text-gray-900",children:n.busNumber}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:n.registrationNumber})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Capacity"}),(0,ze.jsx)("p",{className:"font-medium",children:n.capacity.total})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Fuel"}),(0,ze.jsxs)("p",{className:"font-medium",children:[(null===(t=n.fuel)||void 0===t?void 0:t.currentLevel)||0,"%"]})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Status"}),(0,ze.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(q(n.status)),children:n.status})]}),(0,ze.jsxs)("div",{className:"flex space-x-2",children:[(0,ze.jsx)("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{className:"p-2 text-green-600 hover:bg-green-50 rounded-lg",children:(0,ze.jsx)(xh,{className:"w-4 h-4"})})]})]})]})})};return n?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Bus Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage all buses in the fleet with real-time monitoring"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:z,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]}),(0,ze.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-sm text-gray-500",children:[(0,ze.jsx)("span",{children:"Page"}),(0,ze.jsx)("button",{onClick:()=>h(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded",children:"-"}),(0,ze.jsx)("span",{className:"min-w-[2ch] text-center",children:u}),(0,ze.jsx)("button",{onClick:()=>h(e=>e+1),className:"px-2 py-1 border rounded",children:"+"}),(0,ze.jsx)("span",{children:"Rows"}),(0,ze.jsx)("select",{value:p,onChange:e=>m(parseInt(e.target.value)||20),className:"border rounded px-2 py-1",children:[10,20,50,100].map(e=>(0,ze.jsx)("option",{value:e,children:e},e))})]}),(0,ze.jsxs)("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mh,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Add Bus"})]})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,ze.jsx)(Y,{title:"Total Buses",value:M.totalBuses,icon:Sn,color:"bg-blue-500",subtitle:"Fleet size"}),(0,ze.jsx)(Y,{title:"Active Buses",value:M.activeBuses,icon:xd,color:"bg-green-500",subtitle:"In service"}),(0,ze.jsx)(Y,{title:"Maintenance",value:M.maintenanceBuses,icon:gf,color:"bg-yellow-500",subtitle:"Under repair"}),(0,ze.jsx)(Y,{title:"Utilization",value:"".concat(M.averageUtilization,"%"),icon:Dn,color:"bg-purple-500",subtitle:"Average capacity"})]}),(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,ze.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[(0,ze.jsx)("div",{className:"flex-1 max-w-md",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search buses by number or registration...",value:s,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"retired",children:"Retired"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]}),(0,ze.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Depots"}),j.map(e=>(0,ze.jsx)("option",{value:e._id,children:e.name},e._id))]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[(0,ze.jsx)("button",{onClick:()=>A("grid"),className:"p-2 rounded-md transition-colors ".concat("grid"===E?"bg-white shadow-sm":"text-gray-500"),children:(0,ze.jsx)(jn,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>A("list"),className:"p-2 rounded-md transition-colors ".concat("list"===E?"bg-white shadow-sm":"text-gray-500"),children:(0,ze.jsx)(Dn,{className:"w-4 h-4"})})]})]})]})}),(0,ze.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)(Dn,{className:"w-5 h-5 text-blue-600"}),(0,ze.jsx)("span",{className:"text-blue-900 font-medium",children:"Real-time Monitoring Active"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-blue-700",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,ze.jsx)("span",{children:"GPS Tracking"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,ze.jsx)("span",{children:"Fuel Monitoring"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,ze.jsx)("span",{children:"Maintenance Alerts"})]}),(0,ze.jsxs)("span",{children:["Last updated: ",I.toLocaleTimeString()]})]})]})}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Fleet Overview (",H.length," buses)"]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 flex items-center space-x-2",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Export"})]}),(0,ze.jsxs)("button",{className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 flex items-center space-x-2",children:[(0,ze.jsx)(vf,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Import"})]}),(0,ze.jsxs)("button",{className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 flex items-center space-x-2",children:[(0,ze.jsx)(Pn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Settings"})]})]})]}),0===H.length?(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(Sn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500 text-lg",children:"No buses found"}),(0,ze.jsx)("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]}):(0,ze.jsx)("div",{className:"grid"===E?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:H.map(e=>"grid"===E?(0,ze.jsx)(Z,{bus:e},e._id):(0,ze.jsx)(X,{bus:e},e._id))})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",children:[(0,ze.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg w-fit mb-4",children:(0,ze.jsx)(kn,{className:"w-6 h-6 text-blue-600"})}),(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Route Assignment"}),(0,ze.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Assign buses to specific routes and schedules"}),(0,ze.jsxs)("button",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center",children:["Manage Routes ",(0,ze.jsx)(mh,{className:"w-4 h-4 ml-1"})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",children:[(0,ze.jsx)("div",{className:"p-3 bg-yellow-100 rounded-lg w-fit mb-4",children:(0,ze.jsx)(gf,{className:"w-6 h-6 text-yellow-600"})}),(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Maintenance"}),(0,ze.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Schedule and track bus maintenance"}),(0,ze.jsxs)("button",{className:"text-yellow-600 hover:text-yellow-700 font-medium text-sm flex items-center",children:["View Schedule ",(0,ze.jsx)(Tn,{className:"w-4 h-4 ml-1"})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",children:[(0,ze.jsx)("div",{className:"p-3 bg-green-100 rounded-lg w-fit mb-4",children:(0,ze.jsx)(Em,{className:"w-6 h-6 text-green-600"})}),(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Staff Assignment"}),(0,ze.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Assign drivers and conductors to buses"}),(0,ze.jsxs)("button",{className:"text-green-600 hover:text-green-700 font-medium text-sm flex items-center",children:["Manage Staff ",(0,ze.jsx)(Nn,{className:"w-4 h-4 ml-1"})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",children:[(0,ze.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg w-fit mb-4",children:(0,ze.jsx)(jn,{className:"w-6 h-6 text-purple-600"})}),(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Analytics"}),(0,ze.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"View detailed fleet performance reports"}),(0,ze.jsxs)("button",{className:"text-purple-600 hover:text-purple-700 font-medium text-sm flex items-center",children:["View Reports ",(0,ze.jsx)(jn,{className:"w-4 h-4 ml-1"})]})]})]}),x&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl mx-4",children:[(0,ze.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Add New Bus"}),(0,ze.jsx)("p",{className:"text-gray-600 mb-4",children:"Bus creation form will be implemented here"}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,ze.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Bus"})]})]})}),v&&b&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl mx-4",children:[(0,ze.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Edit Bus: ",b.busNumber]}),(0,ze.jsx)("p",{className:"text-gray-600 mb-4",children:"Bus editing form will be implemented here"}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,ze.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save Changes"})]})]})})]})};function bf(){const e=(0,i.useRef)(!1);return Xn(()=>(e.current=!0,()=>{e.current=!1}),[]),e}class wf extends i.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function jf(e){let{children:t,isPresent:n}=e;const r=(0,i.useId)(),s=(0,i.useRef)(null),a=(0,i.useRef)({width:0,height:0,top:0,left:0});return(0,i.useInsertionEffect)(()=>{const{width:e,height:t,top:i,left:o}=a.current;if(n||!s.current||!e||!t)return;s.current.dataset.motionPopId=r;const l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule('\n          [data-motion-pop-id="'.concat(r,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(i,"px !important;\n            left: ").concat(o,"px !important;\n          }\n        ")),()=>{document.head.removeChild(l)}},[n]),i.createElement(wf,{isPresent:n,childRef:s,sizeRef:a},i.cloneElement(t,{ref:s}))}const Nf=e=>{let{children:t,initial:n,isPresent:r,onExitComplete:s,custom:a,presenceAffectsLayout:o,mode:l}=e;const c=xr(Sf),d=(0,i.useId)(),u=(0,i.useMemo)(()=>({id:d,initial:n,isPresent:r,custom:a,onExitComplete:e=>{c.set(e,!0);for(const t of c.values())if(!t)return;s&&s()},register:e=>(c.set(e,!1),()=>c.delete(e))}),o?void 0:[r]);return(0,i.useMemo)(()=>{c.forEach((e,t)=>c.set(t,!1))},[r]),i.useEffect(()=>{!r&&!c.size&&s&&s()},[r]),"popLayout"===l&&(t=i.createElement(jf,{isPresent:r},t)),i.createElement(Yn.Provider,{value:u},t)};function Sf(){return new Map}const kf=e=>e.key||"";const Tf=e=>{let{children:t,custom:n,initial:r=!0,onExitComplete:s,exitBeforeEnter:a,presenceAffectsLayout:o=!0,mode:l="sync"}=e;ss(!a,"Replace exitBeforeEnter with mode='wait'");const c=(0,i.useContext)(di).forceRender||function(){const e=bf(),[t,n]=(0,i.useState)(0),r=(0,i.useCallback)(()=>{e.current&&n(t+1)},[t]);return[(0,i.useCallback)(()=>Tr.postRender(r),[r]),t]}()[0],d=bf(),u=function(e){const t=[];return i.Children.forEach(e,e=>{(0,i.isValidElement)(e)&&t.push(e)}),t}(t);let h=u;const p=(0,i.useRef)(new Map).current,m=(0,i.useRef)(h),f=(0,i.useRef)(new Map).current,g=(0,i.useRef)(!0);if(Xn(()=>{g.current=!1,function(e,t){e.forEach(e=>{const n=kf(e);t.set(n,e)})}(u,f),m.current=h}),function(e){(0,i.useEffect)(()=>()=>e(),[])}(()=>{g.current=!0,f.clear(),p.clear()}),g.current)return i.createElement(i.Fragment,null,h.map(e=>i.createElement(Nf,{key:kf(e),isPresent:!0,initial:!!r&&void 0,presenceAffectsLayout:o,mode:l},e)));h=[...h];const x=m.current.map(kf),y=u.map(kf),v=x.length;for(let i=0;i<v;i++){const e=x[i];-1!==y.indexOf(e)||p.has(e)||p.set(e,void 0)}return"wait"===l&&p.size&&(h=[]),p.forEach((e,t)=>{if(-1!==y.indexOf(t))return;const r=f.get(t);if(!r)return;const a=x.indexOf(t);let g=e;if(!g){const e=()=>{p.delete(t);const e=Array.from(f.keys()).filter(e=>!y.includes(e));if(e.forEach(e=>f.delete(e)),m.current=u.filter(n=>{const i=kf(n);return i===t||e.includes(i)}),!p.size){if(!1===d.current)return;c(),s&&s()}};g=i.createElement(Nf,{key:kf(r),isPresent:!1,onExitComplete:e,custom:n,presenceAffectsLayout:o,mode:l},r),p.set(t,g)}h.splice(a,0,g)}),h=h.map(e=>{const t=e.key;return p.has(t)?e:i.createElement(Nf,{key:kf(e),isPresent:!0,presenceAffectsLayout:o,mode:l},e)}),i.createElement(i.Fragment,null,p.size?h:h.map(e=>(0,i.cloneElement)(e)))},Cf=wn("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);var Ef,Af,Mf,Df,If,Pf,Rf,Lf,zf,Of,Ff,Bf,Vf,Uf,Hf,qf=(Ef=new WeakMap,Af=new WeakMap,Mf=new WeakMap,Df=new WeakMap,If=new WeakMap,Pf=new WeakMap,Rf=new WeakMap,Lf=new WeakMap,zf=new WeakMap,Of=new WeakMap,Ff=new WeakMap,Bf=new WeakMap,Vf=new WeakMap,Uf=new WeakMap,Hf=new WeakSet,class extends xt{constructor(e,t){super(),ct(this,Hf),Ue(this,Ef,void 0),Ue(this,Af,void 0),Ue(this,Mf,void 0),Ue(this,Df,void 0),Ue(this,If,void 0),Ue(this,Pf,void 0),Ue(this,Rf,void 0),Ue(this,Lf,void 0),Ue(this,zf,void 0),Ue(this,Of,void 0),Ue(this,Ff,void 0),Ue(this,Bf,void 0),Ue(this,Vf,void 0),Ue(this,Uf,void 0),We(Af,this,void 0),We(Mf,this,void 0),We(Df,this,void 0),We(Uf,this,new Set),We(Ef,this,e),this.options=t,We(Rf,this,null),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(qe(Af,this).addObserver(this),eg(qe(Af,this),this.options)?He(Hf,this,Wf).call(this):this.updateResult(),He(Hf,this,Xf).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return tg(qe(Af,this),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return tg(qe(Af,this),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,He(Hf,this,Kf).call(this),He(Hf,this,Qf).call(this),qe(Af,this).removeObserver(this)}setOptions(e,t){const n=this.options,i=qe(Af,this);if(this.options=qe(Ef,this).defaultQueryOptions(e),nt(n,this.options)||qe(Ef,this).getQueryCache().notify({type:"observerOptionsUpdated",query:qe(Af,this),observer:this}),"undefined"!==typeof this.options.enabled&&"boolean"!==typeof this.options.enabled)throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=n.queryKey),He(Hf,this,Jf).call(this);const r=this.hasListeners();r&&ng(qe(Af,this),i,this.options,n)&&He(Hf,this,Wf).call(this),this.updateResult(t),!r||qe(Af,this)===i&&this.options.enabled===n.enabled&&this.options.staleTime===n.staleTime||He(Hf,this,Gf).call(this);const s=He(Hf,this,Yf).call(this);!r||qe(Af,this)===i&&this.options.enabled===n.enabled&&s===qe(Vf,this)||He(Hf,this,Zf).call(this,s)}getOptimisticResult(e){const t=qe(Ef,this).getQueryCache().build(qe(Ef,this),e),n=this.createResult(t,e);return function(e,t){if(!nt(e.getCurrentResult(),t))return!0;return!1}(this,n)&&(We(Df,this,n),We(Pf,this,this.options),We(If,this,qe(Af,this).state)),n}getCurrentResult(){return qe(Df,this)}trackResult(e){const t={};return Object.keys(e).forEach(n=>{Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:()=>(qe(Uf,this).add(n),e[n])})}),t}getCurrentQuery(){return qe(Af,this)}refetch(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},(wc(e),e));return this.fetch(Le({},t))}fetchOptimistic(e){const t=qe(Ef,this).defaultQueryOptions(e),n=qe(Ef,this).getQueryCache().build(qe(Ef,this),t);return n.isFetchingOptimistic=!0,n.fetch().then(()=>this.createResult(n,t))}fetch(e){var t;return He(Hf,this,Wf).call(this,Le(Le({},e),{},{cancelRefetch:null===(t=e.cancelRefetch)||void 0===t||t})).then(()=>(this.updateResult(),qe(Df,this)))}createResult(e,t){const n=qe(Af,this),i=this.options,r=qe(Df,this),s=qe(If,this),a=qe(Pf,this),o=e!==n?e.state:qe(Mf,this),{state:l}=e;let c,{error:d,errorUpdatedAt:u,fetchStatus:h,status:p}=l,m=!1;if(t._optimisticResults){const r=this.hasListeners(),s=!r&&eg(e,t),a=r&&ng(e,n,t,i);(s||a)&&(h=bt(e.options.networkMode)?"fetching":"paused",l.dataUpdatedAt||(p="pending")),"isRestoring"===t._optimisticResults&&(h="idle")}if(t.select&&"undefined"!==typeof l.data)if(r&&l.data===(null===s||void 0===s?void 0:s.data)&&t.select===qe(Lf,this))c=qe(zf,this);else try{We(Lf,this,t.select),c=t.select(l.data),c=at(null===r||void 0===r?void 0:r.data,c,t),We(zf,this,c),We(Rf,this,null)}catch(_){We(Rf,this,_)}else c=l.data;if("undefined"!==typeof t.placeholderData&&"undefined"===typeof c&&"pending"===p){let e;var f;if(null!==r&&void 0!==r&&r.isPlaceholderData&&t.placeholderData===(null===a||void 0===a?void 0:a.placeholderData))e=r.data;else if(e="function"===typeof t.placeholderData?t.placeholderData(null===(f=qe(Of,this))||void 0===f?void 0:f.state.data,qe(Of,this)):t.placeholderData,t.select&&"undefined"!==typeof e)try{e=t.select(e),We(Rf,this,null)}catch(_){We(Rf,this,_)}"undefined"!==typeof e&&(p="success",c=at(null===r||void 0===r?void 0:r.data,e,t),m=!0)}qe(Rf,this)&&(d=qe(Rf,this),c=qe(zf,this),u=Date.now(),p="error");const g="fetching"===h,x="pending"===p,y="error"===p,v=x&&g;return{status:p,fetchStatus:h,isPending:x,isSuccess:"success"===p,isError:y,isInitialLoading:v,isLoading:v,data:c,dataUpdatedAt:l.dataUpdatedAt,error:d,errorUpdatedAt:u,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>o.dataUpdateCount||l.errorUpdateCount>o.errorUpdateCount,isFetching:g,isRefetching:g&&!x,isLoadingError:y&&0===l.dataUpdatedAt,isPaused:"paused"===h,isPlaceholderData:m,isRefetchError:y&&0!==l.dataUpdatedAt,isStale:ig(e,t),refetch:this.refetch}}updateResult(e){const t=qe(Df,this),n=this.createResult(qe(Af,this),this.options);if(We(If,this,qe(Af,this).state),We(Pf,this,this.options),void 0!==qe(If,this).data&&We(Of,this,qe(Af,this)),nt(n,t))return;We(Df,this,n);const i={};!1!==(null===e||void 0===e?void 0:e.listeners)&&(()=>{if(!t)return!0;const{notifyOnChangeProps:e}=this.options,n="function"===typeof e?e():e;if("all"===n||!n&&!qe(Uf,this).size)return!0;const i=new Set(null!==n&&void 0!==n?n:qe(Uf,this));return this.options.throwOnError&&i.add("error"),Object.keys(qe(Df,this)).some(e=>{const n=e;return qe(Df,this)[n]!==t[n]&&i.has(n)})})()&&(i.listeners=!0),He(Hf,this,$f).call(this,Le(Le({},i),e))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&He(Hf,this,Xf).call(this)}});function Wf(e){He(Hf,this,Jf).call(this);let t=qe(Af,this).fetch(this.options,e);return null!==e&&void 0!==e&&e.throwOnError||(t=t.catch(Ye)),t}function Gf(){if(He(Hf,this,Kf).call(this),Ge||qe(Df,this).isStale||!Ze(this.options.staleTime))return;const e=Xe(qe(Df,this).dataUpdatedAt,this.options.staleTime);We(Ff,this,setTimeout(()=>{qe(Df,this).isStale||this.updateResult()},e+1))}function Yf(){var e;return null!==(e="function"===typeof this.options.refetchInterval?this.options.refetchInterval(qe(Af,this)):this.options.refetchInterval)&&void 0!==e&&e}function Zf(e){He(Hf,this,Qf).call(this),We(Vf,this,e),!Ge&&!1!==this.options.enabled&&Ze(qe(Vf,this))&&0!==qe(Vf,this)&&We(Bf,this,setInterval(()=>{(this.options.refetchIntervalInBackground||yt.isFocused())&&He(Hf,this,Wf).call(this)},qe(Vf,this)))}function Xf(){He(Hf,this,Gf).call(this),He(Hf,this,Zf).call(this,He(Hf,this,Yf).call(this))}function Kf(){qe(Ff,this)&&(clearTimeout(qe(Ff,this)),We(Ff,this,void 0))}function Qf(){qe(Bf,this)&&(clearInterval(qe(Bf,this)),We(Bf,this,void 0))}function Jf(){const e=qe(Ef,this).getQueryCache().build(qe(Ef,this),this.options);if(e===qe(Af,this))return;const t=qe(Af,this);We(Af,this,e),We(Mf,this,e.state),this.hasListeners()&&(null===t||void 0===t||t.removeObserver(this),e.addObserver(this))}function $f(e){gt.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(qe(Df,this))}),qe(Ef,this).getQueryCache().notify({query:qe(Af,this),type:"observerResultsUpdated"})})}function eg(e,t){return function(e,t){return!1!==t.enabled&&!e.state.dataUpdatedAt&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||e.state.dataUpdatedAt>0&&tg(e,t,t.refetchOnMount)}function tg(e,t,n){if(!1!==t.enabled){const i="function"===typeof n?n(e):n;return"always"===i||!1!==i&&ig(e,t)}return!1}function ng(e,t,n,i){return!1!==n.enabled&&(e!==t||!1===i.enabled)&&(!n.suspense||"error"!==e.state.status)&&ig(e,n)}function ig(e,t){return e.isStaleByTime(t.staleTime)}function rg(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var sg=i.createContext(rg()),ag=i.createContext(!1);ag.Provider;function og(e,t){return"function"===typeof e?e(...t):!!e}var lg,cg,dg,ug,hg;function pg(e,t,n){const r=hn(n),s=i.useContext(ag),a=i.useContext(sg),o=r.defaultQueryOptions(e);o._optimisticResults=s?"isRestoring":"optimistic",(e=>{e.suspense&&"number"!==typeof e.staleTime&&(e.staleTime=1e3)})(o),((e,t)=>{(e.suspense||e.throwOnError)&&(t.isReset()||(e.retryOnMount=!1))})(o,a),(e=>{i.useEffect(()=>{e.clearReset()},[e])})(a);const[l]=i.useState(()=>new t(r,o)),c=l.getOptimisticResult(o);if(i.useSyncExternalStore(i.useCallback(e=>{const t=s?()=>{}:l.subscribe(gt.batchCalls(e));return l.updateResult(),t},[l,s]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),i.useEffect(()=>{l.setOptions(o,{listeners:!1})},[o,l]),((e,t)=>(null===e||void 0===e?void 0:e.suspense)&&t.isPending)(o,c))throw((e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()}))(o,l,a);if((e=>{let{result:t,errorResetBoundary:n,throwOnError:i,query:r}=e;return t.isError&&!n.isReset()&&!t.isFetching&&r&&og(i,[t.error,r])})({result:c,errorResetBoundary:a,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash)}))throw c.error;return o.notifyOnChangeProps?c:l.trackResult(c)}var mg=(lg=new WeakMap,cg=new WeakMap,dg=new WeakMap,ug=new WeakMap,hg=new WeakSet,class extends xt{constructor(e,t){super(),ct(this,hg),Ue(this,lg,void 0),Ue(this,cg,void 0),Ue(this,dg,void 0),Ue(this,ug,void 0),We(cg,this,void 0),We(lg,this,e),this.setOptions(t),this.bindMethods(),He(hg,this,fg).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var t;const n=this.options;this.options=qe(lg,this).defaultMutationOptions(e),nt(n,this.options)||qe(lg,this).getMutationCache().notify({type:"observerOptionsUpdated",mutation:qe(dg,this),observer:this}),null===(t=qe(dg,this))||void 0===t||t.setOptions(this.options),null!==n&&void 0!==n&&n.mutationKey&&this.options.mutationKey&&$e(n.mutationKey)!==$e(this.options.mutationKey)&&this.reset()}onUnsubscribe(){var e;this.hasListeners()||(null===(e=qe(dg,this))||void 0===e||e.removeObserver(this))}onMutationUpdate(e){He(hg,this,fg).call(this),He(hg,this,gg).call(this,e)}getCurrentResult(){return qe(cg,this)}reset(){var e;null===(e=qe(dg,this))||void 0===e||e.removeObserver(this),We(dg,this,void 0),He(hg,this,fg).call(this),He(hg,this,gg).call(this)}mutate(e,t){var n;return We(ug,this,t),null===(n=qe(dg,this))||void 0===n||n.removeObserver(this),We(dg,this,qe(lg,this).getMutationCache().build(qe(lg,this),this.options)),qe(dg,this).addObserver(this),qe(dg,this).execute(e)}});function fg(){var e,t;const n=null!==(e=null===(t=qe(dg,this))||void 0===t?void 0:t.state)&&void 0!==e?e:{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};We(cg,this,Le(Le({},n),{},{isPending:"pending"===n.status,isSuccess:"success"===n.status,isError:"error"===n.status,isIdle:"idle"===n.status,mutate:this.mutate,reset:this.reset}))}function gg(e){gt.batch(()=>{if(qe(ug,this)&&this.hasListeners()){const c=qe(cg,this).variables,d=qe(cg,this).context;var t,n,i,r;if("success"===(null===e||void 0===e?void 0:e.type))null===(t=(n=qe(ug,this)).onSuccess)||void 0===t||t.call(n,e.data,c,d),null===(i=(r=qe(ug,this)).onSettled)||void 0===i||i.call(r,e.data,null,c,d);else if("error"===(null===e||void 0===e?void 0:e.type)){var s,a,o,l;null===(s=(a=qe(ug,this)).onError)||void 0===s||s.call(a,e.error,c,d),null===(o=(l=qe(ug,this)).onSettled)||void 0===o||o.call(l,void 0,e.error,c,d)}}this.listeners.forEach(e=>{e(qe(cg,this))})})}function xg(e,t){const n=hn(t),[r]=i.useState(()=>new mg(n,e));i.useEffect(()=>{r.setOptions(e)},[r,e]);const s=i.useSyncExternalStore(i.useCallback(e=>r.subscribe(gt.batchCalls(e)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),a=i.useCallback((e,t)=>{r.mutate(e,t).catch(yg)},[r]);if(s.error&&og(r.options.throwOnError,[s.error]))throw s.error;return Le(Le({},s),{},{mutate:a,mutateAsync:s.mutate})}function yg(){}const vg=()=>{const e=hn(),[t,n]=(0,i.useState)({}),{data:r,isLoading:s,error:a,refetch:o}=function(e,t){return pg(e,qf,t)}({queryKey:["buses"],queryFn:async()=>{console.log("useBusManagement: Fetching buses...");try{const e=await rh("/api/admin/buses");return console.log("useBusManagement: Buses fetched successfully:",e),Array.isArray(e)?e:e&&Array.isArray(e.data)?e.data:e&&Array.isArray(e.buses)?e.buses:(console.warn("useBusManagement: Unexpected data format, returning empty array"),[])}catch(a){throw console.error("useBusManagement: Error fetching buses:",a),a}},staleTime:3e4,refetchInterval:6e4,retry:3}),l=xg({mutationFn:async e=>await rh("/api/admin/buses",{method:"POST",body:JSON.stringify(e)}),onSuccess:t=>{e.setQueryData(["buses"],e=>e?[...e,t]:[t])},onError:e=>{ku.error("Failed to create bus: ".concat(e.message))}}),c=xg({mutationFn:async e=>{let{id:t,data:n}=e;return await rh("/api/admin/buses/".concat(t),{method:"PUT",body:JSON.stringify(n)})},onSuccess:t=>{e.setQueryData(["buses"],e=>e?e.map(e=>e._id===t._id?t:e):[t])},onError:e=>{ku.error("Failed to update bus: ".concat(e.message))}}),d=xg({mutationFn:async e=>(await rh("/api/admin/buses/".concat(e),{method:"DELETE"}),e),onSuccess:(t,n)=>{e.setQueryData(["buses"],e=>e?e.filter(e=>e._id!==n):[])},onError:e=>{ku.error("Failed to delete bus: ".concat(e.message))}}),u=xg({mutationFn:async e=>{let{busIds:t,action:n,data:i}=e;return await rh("/api/admin/buses/bulk",{method:"POST",body:JSON.stringify({busIds:t,action:n,data:i})})},onSuccess:()=>{e.invalidateQueries(["buses"])},onError:e=>{ku.error("Bulk operation failed: ".concat(e.message))}}),h=(0,i.useCallback)(async e=>{if(t[e])return t[e];try{const t=await rh("/api/admin/buses/".concat(e,"/insights"));return n(n=>Le(Le({},n),{},{[e]:t})),t}catch(a){return console.error("Failed to fetch bus insights:",a),null}},[t]),p=(0,i.useCallback)(e=>{let t=80;"active"===e.status&&(t+=10),"maintenance"===e.status&&(t-=20),"inactive"===e.status&&(t-=30),e.odometerReading&&(e.odometerReading>1e5&&(t-=10),e.odometerReading<5e4&&(t+=5)),t=Math.max(0,Math.min(100,t));const n={performanceScore:t,efficiencyTrend:Math.random()>.5?1:-1,recommendations:[],rating:Math.ceil(t/20)};return t<60&&n.recommendations.push("Consider scheduling maintenance"),e.fuelLevel&&e.fuelLevel<20&&n.recommendations.push("Low fuel level - consider refueling"),e.nextMaintenance&&new Date(e.nextMaintenance)<new Date(Date.now()+6048e5)&&n.recommendations.push("Service due soon"),n},[]),m=(0,i.useMemo)(()=>{if(!r||!Array.isArray(r))return{};const e={};return r.forEach(t=>{e[t._id]=p(t)}),e},[r,p]),f=(0,i.useCallback)(async e=>l.mutateAsync(e),[l]),g=(0,i.useCallback)(async(e,t)=>c.mutateAsync({id:e,data:t}),[c]),x=(0,i.useCallback)(async e=>d.mutateAsync(e),[d]),y=(0,i.useCallback)(async(e,t,n)=>u.mutateAsync({busIds:e,action:t,data:n}),[u]);return{buses:r,isLoading:s,error:a,refetch:o,createBus:f,updateBus:g,deleteBus:x,bulkUpdateBuses:y,getBusInsights:h,busInsights:m,isCreating:l.isPending,isUpdating:c.isPending,isDeleting:d.isPending,isBulkUpdating:u.isPending}},_g=e=>{const[t,n]=(0,i.useState)(!1),[r,s]=(0,i.useState)(null),a=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(e){try{a.current=hm(e,{transports:["websocket"],auth:{token:localStorage.getItem("token")}}),a.current.on("connect",()=>{console.log("WebSocket connected"),n(!0)}),a.current.on("disconnect",()=>{console.log("WebSocket disconnected"),n(!1)}),a.current.on("error",e=>{console.error("WebSocket error:",e)}),a.current.on("message",e=>{s(e)})}catch(t){console.error("WebSocket initialization error:",t)}return()=>{a.current&&a.current.disconnect()}}},[e]);return{socket:a.current,isConnected:t,lastMessage:r,sendMessage:(e,n)=>{a.current&&t&&a.current.emit(e,n)},on:(e,t)=>{a.current&&a.current.on(e,t)},off:(e,t)=>{a.current&&a.current.off(e,t)},emit:(e,n)=>{a.current&&t&&a.current.emit(e,n)}}},bg=wn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),wg=e=>{let{filters:t,onFiltersChange:n,depots:r=[],savedFilters:s=[],onSaveFilter:a,onLoadFilter:o,onDeleteFilter:l}=e;const[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[p,m]=(0,i.useState)(""),f=(e,i)=>{n(Le(Le({},t),{},{[e]:i}))},g=Object.values(t).filter(e=>e&&"all"!==e&&""!==e).length;return(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0 mb-4",children:[(0,ze.jsx)("div",{className:"flex-1 max-w-md",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search by bus number, registration, or driver...",value:t.search||"",onChange:e=>f("search",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[s.length>0&&(0,ze.jsx)("div",{className:"relative",children:(0,ze.jsxs)("select",{onChange:e=>e.target.value&&(null===o||void 0===o?void 0:o(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",defaultValue:"",children:[(0,ze.jsx)("option",{value:"",children:"Saved Filters"}),s.map((e,t)=>(0,ze.jsx)("option",{value:t,children:e.name},t))]})}),(0,ze.jsxs)("button",{onClick:()=>d(!c),className:"px-4 py-2 rounded-lg border transition-all flex items-center space-x-2 ".concat(c?"bg-blue-50 border-blue-300 text-blue-700":"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100"),children:[(0,ze.jsx)(Bu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Advanced"}),g>0&&(0,ze.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full px-2 py-1 min-w-[20px]",children:g}),(0,ze.jsx)(bg,{className:"w-4 h-4 transition-transform ".concat(c?"rotate-180":"")})]}),g>0&&(0,ze.jsxs)("button",{onClick:()=>{n({search:"",status:"all",depotId:"all",busType:"all",fuelLevel:"all",maintenanceStatus:"all",performanceScore:"all",dateRange:"all"})},className:"px-3 py-2 text-gray-600 hover:text-gray-800 rounded-lg hover:bg-gray-100 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mf,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Reset"})]})]})]}),(0,ze.jsx)(Tf,{children:c&&(0,ze.jsx)($c.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:(0,ze.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,ze.jsxs)("select",{value:t.status||"all",onChange:e=>f("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"retired",children:"Retired"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot"}),(0,ze.jsxs)("select",{value:t.depotId||"all",onChange:e=>f("depotId",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All Depots"}),r.map(e=>(0,ze.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bus Type"}),(0,ze.jsxs)("select",{value:t.busType||"all",onChange:e=>f("busType",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All Types"}),(0,ze.jsx)("option",{value:"ac_sleeper",children:"AC Sleeper"}),(0,ze.jsx)("option",{value:"ac_seater",children:"AC Seater"}),(0,ze.jsx)("option",{value:"non_ac_sleeper",children:"Non-AC Sleeper"}),(0,ze.jsx)("option",{value:"non_ac_seater",children:"Non-AC Seater"}),(0,ze.jsx)("option",{value:"volvo",children:"Volvo"}),(0,ze.jsx)("option",{value:"mini",children:"Mini Bus"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Level"}),(0,ze.jsxs)("select",{value:t.fuelLevel||"all",onChange:e=>f("fuelLevel",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All Levels"}),(0,ze.jsx)("option",{value:"high",children:"High (80%+)"}),(0,ze.jsx)("option",{value:"medium",children:"Medium (40-79%)"}),(0,ze.jsx)("option",{value:"low",children:"Low (20-39%)"}),(0,ze.jsx)("option",{value:"critical",children:"Critical (<20%)"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Performance"}),(0,ze.jsxs)("select",{value:t.performanceScore||"all",onChange:e=>f("performanceScore",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All Scores"}),(0,ze.jsx)("option",{value:"excellent",children:"Excellent (90%+)"}),(0,ze.jsx)("option",{value:"good",children:"Good (70-89%)"}),(0,ze.jsx)("option",{value:"average",children:"Average (50-69%)"}),(0,ze.jsx)("option",{value:"poor",children:"Poor (<50%)"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maintenance"}),(0,ze.jsxs)("select",{value:t.maintenanceStatus||"all",onChange:e=>f("maintenanceStatus",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All"}),(0,ze.jsx)("option",{value:"overdue",children:"Overdue"}),(0,ze.jsx)("option",{value:"due_soon",children:"Due Soon (7 days)"}),(0,ze.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,ze.jsx)("option",{value:"up_to_date",children:"Up to Date"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Added"}),(0,ze.jsxs)("select",{value:t.dateRange||"all",onChange:e=>f("dateRange",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All Time"}),(0,ze.jsx)("option",{value:"today",children:"Today"}),(0,ze.jsx)("option",{value:"week",children:"This Week"}),(0,ze.jsx)("option",{value:"month",children:"This Month"}),(0,ze.jsx)("option",{value:"quarter",children:"This Quarter"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Capacity"}),(0,ze.jsxs)("select",{value:t.capacityRange||"all",onChange:e=>f("capacityRange",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,ze.jsx)("option",{value:"all",children:"All Sizes"}),(0,ze.jsx)("option",{value:"small",children:"Small (1-20)"}),(0,ze.jsx)("option",{value:"medium",children:"Medium (21-40)"}),(0,ze.jsx)("option",{value:"large",children:"Large (41-60)"}),(0,ze.jsx)("option",{value:"extra_large",children:"Extra Large (60+)"})]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,ze.jsx)("div",{className:"text-sm text-gray-600",children:g>0&&"".concat(g," filter").concat(g>1?"s":""," applied")}),(0,ze.jsx)("div",{className:"flex items-center space-x-2",children:(0,ze.jsxs)("button",{onClick:()=>h(!0),disabled:0===g,className:"px-3 py-2 text-sm text-blue-600 hover:text-blue-700 disabled:text-gray-400 flex items-center space-x-2",children:[(0,ze.jsx)(Im,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Save Filter"})]})})]})]})})}),(0,ze.jsx)(Tf,{children:u&&(0,ze.jsx)($c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)($c.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Save Filter Preset"}),(0,ze.jsx)("input",{type:"text",placeholder:"Enter filter name...",value:p,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-4",autoFocus:!0}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,ze.jsx)("button",{onClick:()=>{p.trim()&&(null===a||void 0===a||a(p,t),m(""),h(!1))},disabled:!p.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Save Filter"})]})]})})})]})},jg=wn("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),Ng=e=>{let{selectedBuses:t=[],totalBuses:n=0,onSelectAll:r,onDeselectAll:s,onBulkUpdate:a,onBulkDelete:o,onBulkAssign:l,onBulkExport:c,isLoading:d=!1,depots:u=[],drivers:h=[],conductors:p=[]}=e;const[m,f]=(0,i.useState)(!1),[g,x]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),[_,b]=(0,i.useState)(!1),[w,j]=(0,i.useState)({depotId:"",driverId:"",conductorId:"",status:""}),[N,S]=(0,i.useState)({status:"",depotId:"",maintenanceDate:"",notes:""}),k=t.length===n&&n>0,T=t.length>0&&t.length<n;return 0===t.length?null:(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)($c.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-white rounded-xl shadow-lg border border-gray-200 p-4 z-40",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>{k?s():r()},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:k?(0,ze.jsx)(jg,{className:"w-5 h-5 text-blue-600"}):T?(0,ze.jsx)("div",{className:"w-5 h-5 bg-blue-600 rounded border-2 border-blue-600 flex items-center justify-center",children:(0,ze.jsx)("div",{className:"w-2 h-2 bg-white rounded"})}):(0,ze.jsx)(ef,{className:"w-5 h-5 text-gray-400"})}),(0,ze.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[t.length," selected"]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsxs)("button",{onClick:()=>x(!0),className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2 text-sm",children:[(0,ze.jsx)(Nn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Assign"})]}),(0,ze.jsxs)("button",{onClick:()=>v(!0),className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2 text-sm",children:[(0,ze.jsx)(Pn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Update"})]}),(0,ze.jsxs)("button",{onClick:()=>c(t),className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2 text-sm",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Export"})]}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("button",{onClick:()=>f(!m),className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:(0,ze.jsx)(bg,{className:"w-4 h-4"})}),(0,ze.jsx)(Tf,{children:m&&(0,ze.jsx)($c.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"absolute bottom-full mb-2 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-[160px]",children:(0,ze.jsxs)("button",{onClick:()=>{b(!0),f(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2",children:[(0,ze.jsx)(Lm,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Delete Selected"})]})})})]}),(0,ze.jsx)("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,ze.jsx)(Fn,{className:"w-4 h-4"})})]})]})}),(0,ze.jsx)(Tf,{children:g&&(0,ze.jsx)($c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)($c.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Bulk Assign (",t.length," buses)"]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot"}),(0,ze.jsxs)("select",{value:w.depotId,onChange:e=>j(t=>Le(Le({},t),{},{depotId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Keep current depot"}),u.map(e=>(0,ze.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Driver"}),(0,ze.jsxs)("select",{value:w.driverId,onChange:e=>j(t=>Le(Le({},t),{},{driverId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Keep current driver"}),h.map(e=>(0,ze.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conductor"}),(0,ze.jsxs)("select",{value:w.conductorId,onChange:e=>j(t=>Le(Le({},t),{},{conductorId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Keep current conductor"}),p.map(e=>(0,ze.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,ze.jsxs)("select",{value:w.status,onChange:e=>j(t=>Le(Le({},t),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Keep current status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"retired",children:"Retired"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]})]})]}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,ze.jsx)("button",{onClick:()=>x(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,ze.jsxs)("button",{onClick:()=>{if(!w.depotId&&!w.driverId&&!w.conductorId)return;const e={};w.depotId&&(e.depotId=w.depotId),w.driverId&&(e.assignedDriver=w.driverId),w.conductorId&&(e.assignedConductor=w.conductorId),w.status&&(e.status=w.status),l(t,e),x(!1),j({depotId:"",driverId:"",conductorId:"",status:""})},disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center space-x-2",children:[d&&(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),(0,ze.jsx)("span",{children:"Assign"})]})]})]})})}),(0,ze.jsx)(Tf,{children:y&&(0,ze.jsx)($c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)($c.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Bulk Update (",t.length," buses)"]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,ze.jsxs)("select",{value:N.status,onChange:e=>S(t=>Le(Le({},t),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"No change"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"retired",children:"Retired"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer to Depot"}),(0,ze.jsxs)("select",{value:N.depotId,onChange:e=>S(t=>Le(Le({},t),{},{depotId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"No change"}),u.map(e=>(0,ze.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule Maintenance"}),(0,ze.jsx)("input",{type:"date",value:N.maintenanceDate,onChange:e=>S(t=>Le(Le({},t),{},{maintenanceDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,ze.jsx)("textarea",{value:N.notes,onChange:e=>S(t=>Le(Le({},t),{},{notes:e.target.value})),placeholder:"Add bulk update notes...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,ze.jsx)("button",{onClick:()=>v(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,ze.jsxs)("button",{onClick:()=>{const e={};N.status&&(e.status=N.status),N.depotId&&(e.depotId=N.depotId),N.maintenanceDate&&(e.nextMaintenanceDate=N.maintenanceDate),N.notes&&(e.notes=N.notes),a(t,e),v(!1),S({status:"",depotId:"",maintenanceDate:"",notes:""})},disabled:d,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center space-x-2",children:[d&&(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),(0,ze.jsx)("span",{children:"Update"})]})]})]})})}),(0,ze.jsx)(Tf,{children:_&&(0,ze.jsx)($c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)($c.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,ze.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,ze.jsx)(gd,{className:"w-6 h-6 text-red-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Buses"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),(0,ze.jsxs)("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to delete ",t.length," selected bus",t.length>1?"es":"","?"]}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>b(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,ze.jsxs)("button",{onClick:()=>{o(t),b(!1)},disabled:d,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center space-x-2",children:[d&&(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),(0,ze.jsx)("span",{children:"Delete"})]})]})]})})})]})};var Sg=n(8190),kg=n.n(Sg),Tg=n(1159),Cg=n.n(Tg),Eg=n(7823),Ag=n.n(Eg);const Mg=()=>{const[e,t]=(0,i.useState)({search:"",status:"all",depotId:"all",busType:"all",fuelLevel:"all",maintenanceStatus:"all",performanceScore:"all",dateRange:"all"}),[n,r]=(0,i.useState)("grid"),[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)([]),{isConnected:u,connectionError:h}=_g("/admin"),{buses:p,analytics:m,realTime:f,insights:g,maintenancePredictions:x,isLoading:y,isRealTimeLoading:v,isInsightsLoading:_,createBus:b,updateBus:w,bulkUpdate:j,deleteBus:N,refetch:S,isCreating:k,isUpdating:T,isBulkUpdating:C,isDeleting:E}=vg(),A=(0,i.useMemo)(()=>p?p.filter(t=>{if(e.search){var n,i,r,s,a,o;const l=e.search.toLowerCase();if(!((null===(n=t.busNumber)||void 0===n?void 0:n.toLowerCase().includes(l))||(null===(i=t.registrationNumber)||void 0===i?void 0:i.toLowerCase().includes(l))||(null===(r=t.assignedDriver)||void 0===r||null===(s=r.name)||void 0===s?void 0:s.toLowerCase().includes(l))||(null===(a=t.assignedConductor)||void 0===a||null===(o=a.name)||void 0===o?void 0:o.toLowerCase().includes(l))))return!1}if("all"!==e.status&&t.status!==e.status)return!1;if("all"!==e.depotId&&t.depotId!==e.depotId)return!1;if("all"!==e.busType&&t.busType!==e.busType)return!1;if("all"!==e.fuelLevel){var l;const n=(null===(l=t.fuel)||void 0===l?void 0:l.currentLevel)||0;switch(e.fuelLevel){case"high":if(n<80)return!1;break;case"medium":if(n<40||n>=80)return!1;break;case"low":if(n<20||n>=40)return!1;break;case"critical":if(n>=20)return!1}}if("all"!==e.performanceScore){var c;const n=(null===(c=g[t._id])||void 0===c?void 0:c.performanceScore)||0;switch(e.performanceScore){case"excellent":if(n<90)return!1;break;case"good":if(n<70||n>=90)return!1;break;case"average":if(n<50||n>=70)return!1;break;case"poor":if(n>=50)return!1}}return!0}):[],[p,e,g]),M=(0,i.useCallback)(e=>{a(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),D=(0,i.useCallback)(()=>{a(A.map(e=>e._id))},[A]),I=(0,i.useCallback)(()=>{a([])},[]),P=(0,i.useCallback)((e,t)=>{const n=e.map(e=>Le({id:e},t));j(n),a([])},[j]),R=(0,i.useCallback)(e=>{e.forEach(e=>N(e)),a([])},[N]),L=(0,i.useCallback)(e=>{const t=p.filter(t=>e.includes(t._id)),n=JSON.stringify(t,null,2),i="data:application/json;charset=utf-8,"+encodeURIComponent(n),r="buses_export_".concat((new Date).toISOString().split("T")[0],".json"),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",r),s.click(),ou.success("Exported ".concat(e.length," buses"))},[p]),z=(0,i.useCallback)((e,t)=>{const n={name:e,filters:t,createdAt:new Date};d(e=>[...e,n]),ou.success("Filter saved successfully")},[]),O=(0,i.useCallback)(e=>{const n=c[e];n&&(t(n.filters),ou.success("Loaded filter: ".concat(n.name)))},[c]),F=(0,i.useCallback)(e=>{d(t=>t.filter((t,n)=>n!==e)),ou.success("Filter deleted successfully")},[]),B=e=>{let{title:t,value:n,icon:i,color:r,trend:s,subtitle:a,onClick:o}=e;return(0,ze.jsxs)($c.div,{whileHover:{y:-2,scale:1.02},whileTap:{scale:.98},className:"bg-gradient-to-br ".concat(r," rounded-xl p-6 text-white cursor-pointer shadow-lg hover:shadow-xl transition-all"),onClick:o,children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsx)("div",{className:"p-3 bg-white bg-opacity-20 rounded-xl",children:(0,ze.jsx)(i,{className:"w-6 h-6"})}),s&&(0,ze.jsxs)("div",{className:"flex items-center space-x-1 text-sm ".concat(s>0?"text-green-200":"text-red-200"),children:[(0,ze.jsx)(Ou,{className:"w-4 h-4 ".concat(s<0?"rotate-180":"")}),(0,ze.jsxs)("span",{children:[Math.abs(s),"%"]})]})]}),(0,ze.jsx)("h3",{className:"text-sm font-medium opacity-90 mb-1",children:t}),(0,ze.jsx)("p",{className:"text-3xl font-bold mb-2",children:n}),a&&(0,ze.jsx)("p",{className:"text-sm opacity-75",children:a})]})};return y?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)($c.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"rounded-full h-32 w-32 border-4 border-blue-600 border-t-transparent"})}):(0,ze.jsxs)("div",{className:"space-y-6 pb-20",children:[(0,ze.jsxs)($c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Enhanced Bus Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"AI-powered fleet management with real-time insights"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:S,disabled:y,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4 ".concat(y?"animate-spin":"")}),(0,ze.jsx)("span",{children:"Refresh"})]}),(0,ze.jsxs)("button",{onClick:()=>l(!o),className:"px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 ".concat(o?"bg-purple-100 text-purple-700 border border-purple-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,ze.jsx)(Cf,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"AI Insights"})]}),(0,ze.jsxs)("button",{onClick:()=>console.log("Add new bus"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mh,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Add Bus"})]})]})]}),(0,ze.jsx)(Tf,{children:o&&(0,ze.jsx)($c.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,ze.jsx)(kg(),{insights:g,maintenancePredictions:x,isLoading:_})})}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,ze.jsx)(B,{title:"Total Fleet",value:m.totalBuses||0,icon:Sn,color:"from-blue-500 to-blue-600",trend:m.fleetGrowth,subtitle:"Active buses",onClick:()=>t(e=>Le(Le({},e),{},{status:"all"}))}),(0,ze.jsx)(B,{title:"Active Buses",value:m.activeBuses||0,icon:xd,color:"from-green-500 to-green-600",trend:m.activeGrowth,subtitle:"In service",onClick:()=>t(e=>Le(Le({},e),{},{status:"active"}))}),(0,ze.jsx)(B,{title:"Maintenance",value:m.maintenanceBuses||0,icon:gf,color:"from-yellow-500 to-orange-500",trend:m.maintenanceTrend,subtitle:"Under repair",onClick:()=>t(e=>Le(Le({},e),{},{status:"maintenance"}))}),(0,ze.jsx)(B,{title:"Efficiency",value:"".concat(m.averageUtilization||0,"%"),icon:Dn,color:"from-purple-500 to-purple-600",trend:m.efficiencyTrend,subtitle:"Fleet performance",onClick:()=>r("analytics")})]}),(0,ze.jsx)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,ze.jsx)(wg,{filters:e,onFiltersChange:t,depots:[],savedFilters:c,onSaveFilter:z,onLoadFilter:O,onDeleteFilter:F})}),(0,ze.jsx)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"View Mode:"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:[(0,ze.jsxs)("button",{onClick:()=>r("grid"),className:"p-2 rounded-md transition-colors flex items-center space-x-2 ".concat("grid"===n?"bg-white shadow-sm text-blue-600":"text-gray-500 hover:text-gray-700"),children:[(0,ze.jsx)(Pu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"text-sm",children:"Grid"})]}),(0,ze.jsxs)("button",{onClick:()=>r("list"),className:"p-2 rounded-md transition-colors flex items-center space-x-2 ".concat("list"===n?"bg-white shadow-sm text-blue-600":"text-gray-500 hover:text-gray-700"),children:[(0,ze.jsx)(Ru,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"text-sm",children:"List"})]}),(0,ze.jsxs)("button",{onClick:()=>r("performance"),className:"p-2 rounded-md transition-colors flex items-center space-x-2 ".concat("performance"===n?"bg-white shadow-sm text-blue-600":"text-gray-500 hover:text-gray-700"),children:[(0,ze.jsx)(jn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"text-sm",children:"Performance"})]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-600",children:[(0,ze.jsxs)("span",{children:[A.length," of ",p.length," buses"]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-1 ".concat(u?"text-green-600":h?"text-red-600":"text-yellow-600"),children:[(0,ze.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(u?"bg-green-500 animate-pulse":h?"bg-red-500":"bg-yellow-500 animate-pulse")}),(0,ze.jsx)("span",{children:u?"Live":h?"Offline":"Connecting..."})]})]})]})}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Fleet Overview"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:()=>L(p.map(e=>e._id)),className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 flex items-center space-x-2 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Export All"})]}),(0,ze.jsxs)("button",{className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 flex items-center space-x-2 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,ze.jsx)(vf,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Import"})]}),(0,ze.jsxs)("button",{className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 flex items-center space-x-2 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,ze.jsx)(Pn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Settings"})]})]})]}),"performance"===n?(0,ze.jsx)(Cg(),{buses:A,analytics:m,realTimeData:f,timeRange:"7d"}):(0,ze.jsx)(Ag(),{buses:A,realTimeData:f,insights:g,selectedBuses:s,onSelectBus:M,onEdit:e=>console.log("Edit bus:",e),onView:e=>console.log("View bus:",e),onAssign:e=>console.log("Assign staff:",e)})]}),(0,ze.jsx)(Tf,{children:s.length>0&&(0,ze.jsx)(Ng,{selectedBuses:s,totalBuses:A.length,onSelectAll:D,onDeselectAll:I,onBulkUpdate:P,onBulkDelete:R,onBulkAssign:P,onBulkExport:L,isLoading:C||E,depots:[],drivers:[],conductors:[]})})]})},Dg=wn("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),Ig=wn("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]),Pg=wn("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),Rg=wn("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),Lg=wn("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),zg=wn("Satellite",[["path",{d:"M13 7 9 3 5 7l4 4",key:"vyckw6"}],["path",{d:"m17 11 4 4-4 4-4-4",key:"rchckc"}],["path",{d:"m8 12 4 4 6-6-4-4Z",key:"1sshf7"}],["path",{d:"m16 8 3-3",key:"x428zp"}],["path",{d:"M9 21a6 6 0 0 0-6-6",key:"1iajcf"}]]);var Og=n(879);Og.accessToken={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"http://localhost:5000"}.REACT_APP_MAPBOX_TOKEN||"YOUR_MAPBOX_TOKEN";const Fg=e=>{let{buses:t=[],tracking:n={},selectedBus:r,onBusSelect:s,fullscreen:a=!1}=e;const o=(0,i.useRef)(null),l=(0,i.useRef)(null),c=(0,i.useRef)({}),[d,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!l.current&&o.current)return l.current=new Og.Map({container:o.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.9629,20.5937],zoom:5}),l.current.on("load",()=>{u(!0),l.current.addControl(new Og.NavigationControl,"top-right"),a&&l.current.addControl(new Og.FullscreenControl,"top-right"),l.current.addControl(new Og.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"top-right"),l.current.addSource("routes",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l.current.addLayer({id:"routes",type:"line",source:"routes",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#1976d2","line-width":4,"line-opacity":.7}})}),()=>{var e;null===(e=l.current)||void 0===e||e.remove(),l.current=null}},[a]),(0,i.useEffect)(()=>{d&&l.current&&(t.forEach(e=>{const t=n[e._id],i=(null===t||void 0===t?void 0:t.location)||e.lastKnownLocation;if(null===i||void 0===i||!i.lat||null===i||void 0===i||!i.lng)return;const a="bus-".concat(e._id);if(c.current[a]){const{marker:n,element:r}=c.current[a];n.setLngLat([i.lng,i.lat]),r.innerHTML=h(e,t);const s=n.getPopup();s&&s.setHTML(m(e,t))}else{const n=document.createElement("div");n.className="bus-marker",n.innerHTML=h(e,t);const r=new Og.Marker(n).setLngLat([i.lng,i.lat]).setPopup(p(e,t)).addTo(l.current);n.addEventListener("click",()=>{s&&s(e)}),c.current[a]={marker:r,element:n,bus:e}}const{element:o}=c.current[a];o.className="bus-marker ".concat(e.status," ").concat((null===r||void 0===r?void 0:r._id)===e._id?"selected":"")}),Object.keys(c.current).forEach(e=>{const n=e.replace("bus-","");t.find(e=>e._id===n)||(c.current[e].marker.remove(),delete c.current[e])}))},[t,n,r,d,s]),(0,i.useEffect)(()=>{if(!r||!l.current)return;const e=n[r._id],t=(null===e||void 0===e?void 0:e.location)||r.lastKnownLocation;null!==t&&void 0!==t&&t.lat&&null!==t&&void 0!==t&&t.lng&&l.current.flyTo({center:[t.lng,t.lat],zoom:15,duration:1e3})},[r,n]);const h=(e,t)=>{const n=(null===t||void 0===t?void 0:t.speed)||0,i=n>5,r=(null===t||void 0===t?void 0:t.heading)||0;return'\n      <div class="bus-marker-icon '.concat(i?"moving":"",'" style="transform: rotate(').concat(r,'deg)">\n        <svg width="40" height="40" viewBox="0 0 40 40">\n          <circle cx="20" cy="20" r="18" fill="').concat(f(e.status),'" opacity="0.8"/>\n          <text x="20" y="25" text-anchor="middle" fill="white" font-size="12" font-weight="bold">\n            ').concat(e.busNumber.slice(0,4),"\n          </text>\n        </svg>\n        ").concat(i?'<div class="speed-indicator">'+n+" km/h</div>":"","\n      </div>\n    ")},p=(e,t)=>new Og.Popup({offset:25}).setHTML(m(e,t)),m=(e,t)=>{var n,i;return'\n      <div class="bus-popup">\n        <h3 class="font-bold text-lg mb-2">'.concat(e.busNumber,'</h3>\n        <div class="space-y-1 text-sm">\n          <p><strong>Registration:</strong> ').concat(e.registrationNumber,'</p>\n          <p><strong>Status:</strong> <span class="status-badge ').concat(e.status,'">').concat(e.status,"</span></p>\n          <p><strong>Driver:</strong> ").concat((null===(n=e.driver)||void 0===n?void 0:n.name)||"Not assigned","</p>\n          <p><strong>Route:</strong> ").concat((null===(i=e.currentRoute)||void 0===i?void 0:i.name)||"Not on route","</p>\n          ").concat(t?"\n            <p><strong>Speed:</strong> ".concat(t.speed||0," km/h</p>\n            <p><strong>Last Update:</strong> ").concat(new Date(t.timestamp).toLocaleTimeString(),"</p>\n          "):"","\n          <p><strong>Fuel Level:</strong> ").concat(e.fuelLevel||0,"%</p>\n          <p><strong>Occupancy:</strong> ").concat(e.occupancy||0,"/").concat(e.capacity,"</p>\n        </div>\n      </div>\n    ")},f=e=>{switch(e){case"active":return"#10b981";case"maintenance":return"#f59e0b";case"inactive":return"#ef4444";default:return"#6b7280"}};return(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)("style",{children:"\n          .bus-marker {\n            cursor: pointer;\n            transition: all 0.3s ease;\n          }\n          \n          .bus-marker:hover {\n            transform: scale(1.1);\n          }\n          \n          .bus-marker.selected {\n            transform: scale(1.2);\n            z-index: 10;\n          }\n          \n          .bus-marker-icon {\n            position: relative;\n            transition: transform 0.3s ease;\n          }\n          \n          .bus-marker-icon.moving {\n            animation: pulse 2s infinite;\n          }\n          \n          @keyframes pulse {\n            0% { opacity: 1; }\n            50% { opacity: 0.7; }\n            100% { opacity: 1; }\n          }\n          \n          .speed-indicator {\n            position: absolute;\n            top: -20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: rgba(0, 0, 0, 0.7);\n            color: white;\n            padding: 2px 6px;\n            border-radius: 4px;\n            font-size: 10px;\n            white-space: nowrap;\n          }\n          \n          .bus-popup {\n            padding: 10px;\n            min-width: 200px;\n          }\n          \n          .status-badge {\n            padding: 2px 8px;\n            border-radius: 4px;\n            font-size: 12px;\n            font-weight: 500;\n          }\n          \n          .status-badge.active {\n            background: #d1fae5;\n            color: #065f46;\n          }\n          \n          .status-badge.maintenance {\n            background: #fef3c7;\n            color: #92400e;\n          }\n          \n          .status-badge.inactive {\n            background: #fee2e2;\n            color: #991b1b;\n          }\n        "}),(0,ze.jsx)("div",{ref:o,className:"w-full ".concat(a?"h-full":"h-96"," rounded-lg")}),!d&&(0,ze.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(id,{className:"w-8 h-8 text-gray-400 mx-auto mb-2 animate-bounce"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Loading map..."})]})})]})};function Bg(e){return e+.5|0}const Vg=(e,t,n)=>Math.max(Math.min(e,n),t);function Ug(e){return Vg(Bg(2.55*e),0,255)}function Hg(e){return Vg(Bg(255*e),0,255)}function qg(e){return Vg(Bg(e/2.55)/100,0,1)}function Wg(e){return Vg(Bg(100*e),0,100)}const Gg={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Yg=[..."0123456789ABCDEF"],Zg=e=>Yg[15&e],Xg=e=>Yg[(240&e)>>4]+Yg[15&e],Kg=e=>(240&e)>>4===(15&e);function Qg(e){var t=(e=>Kg(e.r)&&Kg(e.g)&&Kg(e.b)&&Kg(e.a))(e)?Zg:Xg;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}const Jg=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function $g(e,t,n){const i=t*Math.min(n,1-n),r=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t+e/30)%12;return n-i*Math.max(Math.min(r-3,9-r,1),-1)};return[r(0),r(8),r(4)]}function ex(e,t,n){const i=function(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(i+e/60)%6;return n-n*t*Math.max(Math.min(r,4-r,1),0)};return[i(5),i(3),i(1)]}function tx(e,t,n){const i=$g(e,1,.5);let r;for(t+n>1&&(r=1/(t+n),t*=r,n*=r),r=0;r<3;r++)i[r]*=1-t-n,i[r]+=t;return i}function nx(e){const t=e.r/255,n=e.g/255,i=e.b/255,r=Math.max(t,n,i),s=Math.min(t,n,i),a=(r+s)/2;let o,l,c;return r!==s&&(c=r-s,l=a>.5?c/(2-r-s):c/(r+s),o=function(e,t,n,i,r){return e===r?(t-n)/i+(t<n?6:0):t===r?(n-e)/i+2:(e-t)/i+4}(t,n,i,c,r),o=60*o+.5),[0|o,l||0,a]}function ix(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(Hg)}function rx(e,t,n){return ix($g,e,t,n)}function sx(e){return(e%360+360)%360}function ax(e){const t=Jg.exec(e);let n,i=255;if(!t)return;t[5]!==n&&(i=t[6]?Ug(+t[5]):Hg(+t[5]));const r=sx(+t[2]),s=+t[3]/100,a=+t[4]/100;return n="hwb"===t[1]?function(e,t,n){return ix(tx,e,t,n)}(r,s,a):"hsv"===t[1]?function(e,t,n){return ix(ex,e,t,n)}(r,s,a):rx(r,s,a),{r:n[0],g:n[1],b:n[2],a:i}}const ox={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},lx={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let cx;function dx(e){cx||(cx=function(){const e={},t=Object.keys(lx),n=Object.keys(ox);let i,r,s,a,o;for(i=0;i<t.length;i++){for(a=o=t[i],r=0;r<n.length;r++)s=n[r],o=o.replace(s,ox[s]);s=parseInt(lx[a],16),e[o]=[s>>16&255,s>>8&255,255&s]}return e}(),cx.transparent=[0,0,0,0]);const t=cx[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}const ux=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const hx=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,px=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function mx(e,t,n){if(e){let i=nx(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,0===t?360:1)),i=rx(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function fx(e,t){return e?Object.assign(t||{},e):e}function gx(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Hg(e[3]))):(t=fx(e,{r:0,g:0,b:0,a:1})).a=Hg(t.a),t}function xx(e){return"r"===e.charAt(0)?function(e){const t=ux.exec(e);let n,i,r,s=255;if(t){if(t[7]!==n){const e=+t[7];s=t[8]?Ug(e):Vg(255*e,0,255)}return n=+t[1],i=+t[3],r=+t[5],n=255&(t[2]?Ug(n):Vg(n,0,255)),i=255&(t[4]?Ug(i):Vg(i,0,255)),r=255&(t[6]?Ug(r):Vg(r,0,255)),{r:n,g:i,b:r,a:s}}}(e):ax(e)}class yx{constructor(e){if(e instanceof yx)return e;const t=typeof e;let n;"object"===t?n=gx(e):"string"===t&&(n=function(e){var t,n=e.length;return"#"===e[0]&&(4===n||5===n?t={r:255&17*Gg[e[1]],g:255&17*Gg[e[2]],b:255&17*Gg[e[3]],a:5===n?17*Gg[e[4]]:255}:7!==n&&9!==n||(t={r:Gg[e[1]]<<4|Gg[e[2]],g:Gg[e[3]]<<4|Gg[e[4]],b:Gg[e[5]]<<4|Gg[e[6]],a:9===n?Gg[e[7]]<<4|Gg[e[8]]:255})),t}(e)||dx(e)||xx(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=fx(this._rgb);return e&&(e.a=qg(e.a)),e}set rgb(e){this._rgb=gx(e)}rgbString(){return this._valid?(e=this._rgb)&&(e.a<255?"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(qg(e.a),")"):"rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")")):void 0;var e}hexString(){return this._valid?Qg(this._rgb):void 0}hslString(){return this._valid?function(e){if(!e)return;const t=nx(e),n=t[0],i=Wg(t[1]),r=Wg(t[2]);return e.a<255?"hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(qg(e.a),")"):"hsl(".concat(n,", ").concat(i,"%, ").concat(r,"%)")}(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,i=e.rgb;let r;const s=t===r?.5:t,a=2*s-1,o=n.a-i.a,l=((a*o===-1?a:(a+o)/(1+a*o))+1)/2;r=1-l,n.r=255&l*n.r+r*i.r+.5,n.g=255&l*n.g+r*i.g+.5,n.b=255&l*n.b+r*i.b+.5,n.a=s*n.a+(1-s)*i.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,n){const i=px(qg(e.r)),r=px(qg(e.g)),s=px(qg(e.b));return{r:Hg(hx(i+n*(px(qg(t.r))-i))),g:Hg(hx(r+n*(px(qg(t.g))-r))),b:Hg(hx(s+n*(px(qg(t.b))-s))),a:e.a+n*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new yx(this.rgb)}alpha(e){return this._rgb.a=Hg(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=Bg(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return mx(this._rgb,2,e),this}darken(e){return mx(this._rgb,2,-e),this}saturate(e){return mx(this._rgb,1,e),this}desaturate(e){return mx(this._rgb,1,-e),this}rotate(e){return function(e,t){var n=nx(e);n[0]=sx(n[0]+t),n=rx(n),e.r=n[0],e.g=n[1],e.b=n[2]}(this._rgb,e),this}}function vx(){}const _x=(()=>{let e=0;return()=>e++})();function bx(e){return null===e||"undefined"===typeof e}function wx(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function jx(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function Nx(e){return("number"===typeof e||e instanceof Number)&&isFinite(+e)}function Sx(e,t){return Nx(e)?e:t}function kx(e,t){return"undefined"===typeof e?t:e}const Tx=(e,t)=>"string"===typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Cx(e,t,n){if(e&&"function"===typeof e.call)return e.apply(n,t)}function Ex(e,t,n,i){let r,s,a;if(wx(e))if(s=e.length,i)for(r=s-1;r>=0;r--)t.call(n,e[r],r);else for(r=0;r<s;r++)t.call(n,e[r],r);else if(jx(e))for(a=Object.keys(e),s=a.length,r=0;r<s;r++)t.call(n,e[a[r]],a[r])}function Ax(e,t){let n,i,r,s;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(r=e[n],s=t[n],r.datasetIndex!==s.datasetIndex||r.index!==s.index)return!1;return!0}function Mx(e){if(wx(e))return e.map(Mx);if(jx(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let r=0;for(;r<i;++r)t[n[r]]=Mx(e[n[r]]);return t}return e}function Dx(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function Ix(e,t,n,i){if(!Dx(e))return;const r=t[e],s=n[e];jx(r)&&jx(s)?Px(r,s,i):t[e]=Mx(s)}function Px(e,t,n){const i=wx(t)?t:[t],r=i.length;if(!jx(e))return e;const s=(n=n||{}).merger||Ix;let a;for(let o=0;o<r;++o){if(a=i[o],!jx(a))continue;const t=Object.keys(a);for(let i=0,r=t.length;i<r;++i)s(t[i],e,a,n)}return e}function Rx(e,t){return Px(e,t,{merger:Lx})}function Lx(e,t,n){if(!Dx(e))return;const i=t[e],r=n[e];jx(i)&&jx(r)?Rx(i,r):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Mx(r))}const zx={"":e=>e,x:e=>e.x,y:e=>e.y};function Ox(e,t){const n=zx[t]||(zx[t]=function(e){const t=function(e){const t=e.split("."),n=[];let i="";for(const r of t)i+=r,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}(e);return e=>{for(const n of t){if(""===n)break;e=e&&e[n]}return e}}(t));return n(e)}function Fx(e){return e.charAt(0).toUpperCase()+e.slice(1)}const Bx=e=>"undefined"!==typeof e,Vx=e=>"function"===typeof e,Ux=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};const Hx=Math.PI,qx=2*Hx,Wx=qx+Hx,Gx=Number.POSITIVE_INFINITY,Yx=Hx/180,Zx=Hx/2,Xx=Hx/4,Kx=2*Hx/3,Qx=Math.log10,Jx=Math.sign;function $x(e,t,n){return Math.abs(e-t)<n}function ey(e){const t=Math.round(e);e=$x(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(Qx(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function ty(e){return!isNaN(parseFloat(e))&&isFinite(e)}function ny(e,t,n){let i,r,s;for(i=0,r=e.length;i<r;i++)s=e[i][n],isNaN(s)||(t.min=Math.min(t.min,s),t.max=Math.max(t.max,s))}function iy(e){return e*(Hx/180)}function ry(e){return e*(180/Hx)}function sy(e){if(!Nx(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function ay(e,t){const n=t.x-e.x,i=t.y-e.y,r=Math.sqrt(n*n+i*i);let s=Math.atan2(i,n);return s<-.5*Hx&&(s+=qx),{angle:s,distance:r}}function oy(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ly(e,t){return(e-t+Wx)%qx-Hx}function cy(e){return(e%qx+qx)%qx}function dy(e,t,n,i){const r=cy(e),s=cy(t),a=cy(n),o=cy(s-r),l=cy(a-r),c=cy(r-s),d=cy(r-a);return r===s||r===a||i&&s===a||o>l&&c<d}function uy(e,t,n){return Math.max(t,Math.min(n,e))}function hy(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function py(e,t,n){n=n||(n=>e[n]<t);let i,r=e.length-1,s=0;for(;r-s>1;)i=s+r>>1,n(i)?s=i:r=i;return{lo:s,hi:r}}const my=(e,t,n,i)=>py(e,n,i?i=>{const r=e[i][t];return r<n||r===n&&e[i+1][t]===n}:i=>e[i][t]<n),fy=(e,t,n)=>py(e,n,i=>e[i][t]>=n);const gy=["push","pop","shift","splice","unshift"];function xy(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,r=i.indexOf(t);-1!==r&&i.splice(r,1),i.length>0||(gy.forEach(t=>{delete e[t]}),delete e._chartjs)}function yy(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const vy="undefined"===typeof window?function(e){return e()}:window.requestAnimationFrame;function _y(e,t){let n=[],i=!1;return function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];n=s,i||(i=!0,vy.call(window,()=>{i=!1,e.apply(t,n)}))}}const by=e=>"start"===e?"left":"end"===e?"right":"center",wy=(e,t,n)=>"start"===e?t:"end"===e?n:(t+n)/2;function jy(e,t,n){const i=t.length;let r=0,s=i;if(e._sorted){const{iScale:a,_parsed:o}=e,l=a.axis,{min:c,max:d,minDefined:u,maxDefined:h}=a.getUserBounds();u&&(r=uy(Math.min(my(o,l,c).lo,n?i:my(t,l,a.getPixelForValue(c)).lo),0,i-1)),s=h?uy(Math.max(my(o,a.axis,d,!0).hi+1,n?0:my(t,l,a.getPixelForValue(d),!0).hi+1),r,i)-r:i-r}return{start:r,count:s}}function Ny(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,r={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=r,!0;const s=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,r),s}const Sy=e=>0===e||1===e,ky=(e,t,n)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*qx/n),Ty=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*qx/n)+1,Cy={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*Zx),easeOutSine:e=>Math.sin(e*Zx),easeInOutSine:e=>-.5*(Math.cos(Hx*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>Sy(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>Sy(e)?e:ky(e,.075,.3),easeOutElastic:e=>Sy(e)?e:Ty(e,.075,.3),easeInOutElastic(e){const t=.1125;return Sy(e)?e:e<.5?.5*ky(2*e,t,.45):.5+.5*Ty(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-Cy.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},easeInOutBounce:e=>e<.5?.5*Cy.easeInBounce(2*e):.5*Cy.easeOutBounce(2*e-1)+.5};function Ey(e){if(e&&"object"===typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function Ay(e){return Ey(e)?e:new yx(e)}function My(e){return Ey(e)?e:new yx(e).saturate(.5).darken(.1).hexString()}const Dy=["x","y","borderWidth","radius","tension"],Iy=["color","borderColor","backgroundColor"];const Py=new Map;function Ry(e,t,n){return function(e,t){t=t||{};const n=e+JSON.stringify(t);let i=Py.get(n);return i||(i=new Intl.NumberFormat(e,t),Py.set(n,i)),i}(t,n).format(e)}const Ly={values:e=>wx(e)?e:""+e,numeric(e,t,n){if(0===e)return"0";const i=this.chart.options.locale;let r,s=e;if(n.length>1){const t=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(t<1e-4||t>1e15)&&(r="scientific"),s=function(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e));return n}(e,n)}const a=Qx(Math.abs(s)),o=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:r,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),Ry(e,i,l)},logarithmic(e,t,n){if(0===e)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(Qx(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?Ly.numeric.call(this,e,t,n):""}};var zy={formatters:Ly};const Oy=Object.create(null),Fy=Object.create(null);function By(e,t){if(!t)return e;const n=t.split(".");for(let i=0,r=n.length;i<r;++i){const t=n[i];e=e[t]||(e[t]=Object.create(null))}return e}function Vy(e,t,n){return"string"===typeof t?Px(By(e,t),n):Px(By(e,""),t)}class Uy{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>My(t.backgroundColor),this.hoverBorderColor=(e,t)=>My(t.borderColor),this.hoverColor=(e,t)=>My(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return Vy(this,e,t)}get(e){return By(this,e)}describe(e,t){return Vy(Fy,e,t)}override(e,t){return Vy(Oy,e,t)}route(e,t,n,i){const r=By(this,e),s=By(this,n),a="_"+t;Object.defineProperties(r,{[a]:{value:r[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[a],t=s[i];return jx(e)?Object.assign({},t,e):kx(e,t)},set(e){this[a]=e}}})}apply(e){e.forEach(e=>e(this))}}var Hy=new Uy({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),e.set("animations",{colors:{type:"color",properties:Iy},numbers:{type:"number",properties:Dy}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}})},function(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:zy.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e&&"dash"!==e}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e})}]);function qy(e,t,n,i,r){let s=t[r];return s||(s=t[r]=e.measureText(r).width,n.push(r)),s>i&&(i=s),i}function Wy(e,t,n,i){let r=(i=i||{}).data=i.data||{},s=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(r=i.data={},s=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let a=0;const o=n.length;let l,c,d,u,h;for(l=0;l<o;l++)if(u=n[l],void 0===u||null===u||wx(u)){if(wx(u))for(c=0,d=u.length;c<d;c++)h=u[c],void 0===h||null===h||wx(h)||(a=qy(e,r,s,a,h))}else a=qy(e,r,s,a,u);e.restore();const p=s.length/2;if(p>n.length){for(l=0;l<p;l++)delete r[s[l]];s.splice(0,p)}return a}function Gy(e,t,n){const i=e.currentDevicePixelRatio,r=0!==n?Math.max(n/2,.5):0;return Math.round((t-r)*i)/i+r}function Yy(e,t){(t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore()}function Zy(e,t,n,i){Xy(e,t,n,i,null)}function Xy(e,t,n,i,r){let s,a,o,l,c,d,u,h;const p=t.pointStyle,m=t.rotation,f=t.radius;let g=(m||0)*Yx;if(p&&"object"===typeof p&&(s=p.toString(),"[object HTMLImageElement]"===s||"[object HTMLCanvasElement]"===s))return e.save(),e.translate(n,i),e.rotate(g),e.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void e.restore();if(!(isNaN(f)||f<=0)){switch(e.beginPath(),p){default:r?e.ellipse(n,i,r/2,f,0,0,qx):e.arc(n,i,f,0,qx),e.closePath();break;case"triangle":d=r?r/2:f,e.moveTo(n+Math.sin(g)*d,i-Math.cos(g)*f),g+=Kx,e.lineTo(n+Math.sin(g)*d,i-Math.cos(g)*f),g+=Kx,e.lineTo(n+Math.sin(g)*d,i-Math.cos(g)*f),e.closePath();break;case"rectRounded":c=.516*f,l=f-c,a=Math.cos(g+Xx)*l,u=Math.cos(g+Xx)*(r?r/2-c:l),o=Math.sin(g+Xx)*l,h=Math.sin(g+Xx)*(r?r/2-c:l),e.arc(n-u,i-o,c,g-Hx,g-Zx),e.arc(n+h,i-a,c,g-Zx,g),e.arc(n+u,i+o,c,g,g+Zx),e.arc(n-h,i+a,c,g+Zx,g+Hx),e.closePath();break;case"rect":if(!m){l=Math.SQRT1_2*f,d=r?r/2:l,e.rect(n-d,i-l,2*d,2*l);break}g+=Xx;case"rectRot":u=Math.cos(g)*(r?r/2:f),a=Math.cos(g)*f,o=Math.sin(g)*f,h=Math.sin(g)*(r?r/2:f),e.moveTo(n-u,i-o),e.lineTo(n+h,i-a),e.lineTo(n+u,i+o),e.lineTo(n-h,i+a),e.closePath();break;case"crossRot":g+=Xx;case"cross":u=Math.cos(g)*(r?r/2:f),a=Math.cos(g)*f,o=Math.sin(g)*f,h=Math.sin(g)*(r?r/2:f),e.moveTo(n-u,i-o),e.lineTo(n+u,i+o),e.moveTo(n+h,i-a),e.lineTo(n-h,i+a);break;case"star":u=Math.cos(g)*(r?r/2:f),a=Math.cos(g)*f,o=Math.sin(g)*f,h=Math.sin(g)*(r?r/2:f),e.moveTo(n-u,i-o),e.lineTo(n+u,i+o),e.moveTo(n+h,i-a),e.lineTo(n-h,i+a),g+=Xx,u=Math.cos(g)*(r?r/2:f),a=Math.cos(g)*f,o=Math.sin(g)*f,h=Math.sin(g)*(r?r/2:f),e.moveTo(n-u,i-o),e.lineTo(n+u,i+o),e.moveTo(n+h,i-a),e.lineTo(n-h,i+a);break;case"line":a=r?r/2:Math.cos(g)*f,o=Math.sin(g)*f,e.moveTo(n-a,i-o),e.lineTo(n+a,i+o);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(g)*(r?r/2:f),i+Math.sin(g)*f);break;case!1:e.closePath()}e.fill(),t.borderWidth>0&&e.stroke()}}function Ky(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function Qy(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function Jy(e){e.restore()}function $y(e,t,n,i,r){if(!t)return e.lineTo(n.x,n.y);if("middle"===r){const i=(t.x+n.x)/2;e.lineTo(i,t.y),e.lineTo(i,n.y)}else"after"===r!==!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function ev(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function tv(e,t,n,i,r){if(r.strikethrough||r.underline){const s=e.measureText(i),a=t-s.actualBoundingBoxLeft,o=t+s.actualBoundingBoxRight,l=n-s.actualBoundingBoxAscent,c=n+s.actualBoundingBoxDescent,d=r.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=r.decorationWidth||2,e.moveTo(a,d),e.lineTo(o,d),e.stroke()}}function nv(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function iv(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=wx(t)?t:[t],o=s.strokeWidth>0&&""!==s.strokeColor;let l,c;for(e.save(),e.font=r.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),bx(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,s),l=0;l<a.length;++l)c=a[l],s.backdrop&&nv(e,s.backdrop),o&&(s.strokeColor&&(e.strokeStyle=s.strokeColor),bx(s.strokeWidth)||(e.lineWidth=s.strokeWidth),e.strokeText(c,n,i,s.maxWidth)),e.fillText(c,n,i,s.maxWidth),tv(e,n,i,c,s),i+=Number(r.lineHeight);e.restore()}function rv(e,t){const{x:n,y:i,w:r,h:s,radius:a}=t;e.arc(n+a.topLeft,i+a.topLeft,a.topLeft,1.5*Hx,Hx,!0),e.lineTo(n,i+s-a.bottomLeft),e.arc(n+a.bottomLeft,i+s-a.bottomLeft,a.bottomLeft,Hx,Zx,!0),e.lineTo(n+r-a.bottomRight,i+s),e.arc(n+r-a.bottomRight,i+s-a.bottomRight,a.bottomRight,Zx,0,!0),e.lineTo(n+r,i+a.topRight),e.arc(n+r-a.topRight,i+a.topRight,a.topRight,0,-Zx,!0),e.lineTo(n+a.topLeft,i)}const sv=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,av=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function ov(e,t){const n=(""+e).match(sv);if(!n||"normal"===n[1])return 1.2*t;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100}return t*e}const lv=e=>+e||0;function cv(e,t){const n={},i=jx(t),r=i?Object.keys(t):t,s=jx(e)?i?n=>kx(e[n],e[t[n]]):t=>e[t]:()=>e;for(const a of r)n[a]=lv(s(a));return n}function dv(e){return cv(e,{top:"y",right:"x",bottom:"y",left:"x"})}function uv(e){return cv(e,["topLeft","topRight","bottomLeft","bottomRight"])}function hv(e){const t=dv(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function pv(e,t){e=e||{},t=t||Hy.font;let n=kx(e.size,t.size);"string"===typeof n&&(n=parseInt(n,10));let i=kx(e.style,t.style);i&&!(""+i).match(av)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const r={family:kx(e.family,t.family),lineHeight:ov(kx(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:kx(e.weight,t.weight),string:""};return r.string=function(e){return!e||bx(e.size)||bx(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(r),r}function mv(e,t,n,i){let r,s,a,o=!0;for(r=0,s=e.length;r<s;++r)if(a=e[r],void 0!==a&&(void 0!==t&&"function"===typeof a&&(a=a(t),o=!1),void 0!==n&&wx(a)&&(a=a[n%a.length],o=!1),void 0!==a))return i&&!o&&(i.cacheable=!1),a}function fv(e,t){return Object.assign(Object.create(e),t)}function gv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>e[0];const r=(arguments.length>2?arguments[2]:void 0)||e;"undefined"===typeof n&&(n=Tv("_fallback",e));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:r,_fallback:n,_getTarget:i,override:i=>gv([i,...e],t,r,n)};return new Proxy(s,{deleteProperty:(t,n)=>(delete t[n],delete t._keys,delete e[0][n],!0),get:(n,i)=>bv(n,i,()=>function(e,t,n,i){let r;for(const s of t)if(r=Tv(vv(s,e),n),"undefined"!==typeof r)return _v(e,r)?Sv(n,i,e,r):r}(i,t,e,n)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>Cv(e).includes(t),ownKeys:e=>Cv(e),set(e,t,n){const r=e._storage||(e._storage=i());return e[t]=r[t]=n,delete e._keys,!0}})}function xv(e,t,n,i){const r={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:yv(e,i),setContext:t=>xv(e,t,n,i),override:r=>xv(e.override(r),t,n,i)};return new Proxy(r,{deleteProperty:(t,n)=>(delete t[n],delete e[n],!0),get:(e,t,n)=>bv(e,t,()=>function(e,t,n){const{_proxy:i,_context:r,_subProxy:s,_descriptors:a}=e;let o=i[t];Vx(o)&&a.isScriptable(t)&&(o=function(e,t,n,i){const{_proxy:r,_context:s,_subProxy:a,_stack:o}=n;if(o.has(e))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+e);o.add(e);let l=t(s,a||i);o.delete(e),_v(e,l)&&(l=Sv(r._scopes,r,e,l));return l}(t,o,e,n));wx(o)&&o.length&&(o=function(e,t,n,i){const{_proxy:r,_context:s,_subProxy:a,_descriptors:o}=n;if("undefined"!==typeof s.index&&i(e))return t[s.index%t.length];if(jx(t[0])){const n=t,i=r._scopes.filter(e=>e!==n);t=[];for(const l of n){const n=Sv(i,r,e,l);t.push(xv(n,s,a&&a[e],o))}}return t}(t,o,e,a.isIndexable));_v(t,o)&&(o=xv(o,r,s&&s[t],a));return o}(e,t,n)),getOwnPropertyDescriptor:(t,n)=>t._descriptors.allKeys?Reflect.has(e,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,n),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,n)=>Reflect.has(e,n),ownKeys:()=>Reflect.ownKeys(e),set:(t,n,i)=>(e[n]=i,delete t[n],!0)})}function yv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:r=t.allKeys}=e;return{allKeys:r,scriptable:n,indexable:i,isScriptable:Vx(n)?n:()=>n,isIndexable:Vx(i)?i:()=>i}}const vv=(e,t)=>e?e+Fx(t):t,_v=(e,t)=>jx(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function bv(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];const i=n();return e[t]=i,i}function wv(e,t,n){return Vx(e)?e(t,n):e}const jv=(e,t)=>!0===e?t:"string"===typeof e?Ox(t,e):void 0;function Nv(e,t,n,i,r){for(const s of t){const t=jv(n,s);if(t){e.add(t);const s=wv(t._fallback,n,r);if("undefined"!==typeof s&&s!==n&&s!==i)return s}else if(!1===t&&"undefined"!==typeof i&&n!==i)return null}return!1}function Sv(e,t,n,i){const r=t._rootScopes,s=wv(t._fallback,n,i),a=[...e,...r],o=new Set;o.add(i);let l=kv(o,a,n,s||n,i);return null!==l&&(("undefined"===typeof s||s===n||(l=kv(o,a,s,l,i),null!==l))&&gv(Array.from(o),[""],r,s,()=>function(e,t,n){const i=e._getTarget();t in i||(i[t]={});const r=i[t];if(wx(r)&&jx(n))return n;return r||{}}(t,n,i)))}function kv(e,t,n,i,r){for(;n;)n=Nv(e,t,n,i,r);return n}function Tv(e,t){for(const n of t){if(!n)continue;const t=n[e];if("undefined"!==typeof t)return t}}function Cv(e){let t=e._keys;return t||(t=e._keys=function(e){const t=new Set;for(const n of e)for(const e of Object.keys(n).filter(e=>!e.startsWith("_")))t.add(e);return Array.from(t)}(e._scopes)),t}function Ev(e,t,n,i){const{iScale:r}=e,{key:s="r"}=this._parsing,a=new Array(i);let o,l,c,d;for(o=0,l=i;o<l;++o)c=o+n,d=t[c],a[o]={r:r.parse(Ox(d,s),c)};return a}const Av=Number.EPSILON||1e-14,Mv=(e,t)=>t<e.length&&!e[t].skip&&e[t],Dv=e=>"x"===e?"y":"x";function Iv(e,t,n,i){const r=e.skip?t:e,s=t,a=n.skip?t:n,o=oy(s,r),l=oy(a,s);let c=o/(o+l),d=l/(o+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:s.x-u*(a.x-r.x),y:s.y-u*(a.y-r.y)},next:{x:s.x+h*(a.x-r.x),y:s.y+h*(a.y-r.y)}}}function Pv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const n=Dv(t),i=e.length,r=Array(i).fill(0),s=Array(i);let a,o,l,c=Mv(e,0);for(a=0;a<i;++a)if(o=l,l=c,c=Mv(e,a+1),l){if(c){const e=c[t]-l[t];r[a]=0!==e?(c[n]-l[n])/e:0}s[a]=o?c?Jx(r[a-1])!==Jx(r[a])?0:(r[a-1]+r[a])/2:r[a-1]:r[a]}!function(e,t,n){const i=e.length;let r,s,a,o,l,c=Mv(e,0);for(let d=0;d<i-1;++d)l=c,c=Mv(e,d+1),l&&c&&($x(t[d],0,Av)?n[d]=n[d+1]=0:(r=n[d]/t[d],s=n[d+1]/t[d],o=Math.pow(r,2)+Math.pow(s,2),o<=9||(a=3/Math.sqrt(o),n[d]=r*a*t[d],n[d+1]=s*a*t[d])))}(e,r,s),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const i=Dv(n),r=e.length;let s,a,o,l=Mv(e,0);for(let c=0;c<r;++c){if(a=o,o=l,l=Mv(e,c+1),!o)continue;const r=o[n],d=o[i];a&&(s=(r-a[n])/3,o["cp1".concat(n)]=r-s,o["cp1".concat(i)]=d-s*t[c]),l&&(s=(l[n]-r)/3,o["cp2".concat(n)]=r+s,o["cp2".concat(i)]=d+s*t[c])}}(e,s,t)}function Rv(e,t,n){return Math.max(Math.min(e,n),t)}function Lv(e,t,n,i,r){let s,a,o,l;if(t.spanGaps&&(e=e.filter(e=>!e.skip)),"monotone"===t.cubicInterpolationMode)Pv(e,r);else{let n=i?e[e.length-1]:e[0];for(s=0,a=e.length;s<a;++s)o=e[s],l=Iv(n,o,e[Math.min(s+1,a-(i?0:1))%a],t.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,n=o}t.capBezierPoints&&function(e,t){let n,i,r,s,a,o=Ky(e[0],t);for(n=0,i=e.length;n<i;++n)a=s,s=o,o=n<i-1&&Ky(e[n+1],t),s&&(r=e[n],a&&(r.cp1x=Rv(r.cp1x,t.left,t.right),r.cp1y=Rv(r.cp1y,t.top,t.bottom)),o&&(r.cp2x=Rv(r.cp2x,t.left,t.right),r.cp2y=Rv(r.cp2y,t.top,t.bottom)))}(e,n)}function zv(){return"undefined"!==typeof window&&"undefined"!==typeof document}function Ov(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function Fv(e,t,n){let i;return"string"===typeof e?(i=parseInt(e,10),-1!==e.indexOf("%")&&(i=i/100*t.parentNode[n])):i=e,i}const Bv=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);const Vv=["top","right","bottom","left"];function Uv(e,t,n){const i={};n=n?"-"+n:"";for(let r=0;r<4;r++){const s=Vv[r];i[s]=parseFloat(e[t+"-"+s+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function Hv(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,r=Bv(n),s="border-box"===r.boxSizing,a=Uv(r,"padding"),o=Uv(r,"border","width"),{x:l,y:c,box:d}=function(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:r,offsetY:s}=i;let a,o,l=!1;if(((e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot))(r,s,e.target))a=r,o=s;else{const e=t.getBoundingClientRect();a=i.clientX-e.left,o=i.clientY-e.top,l=!0}return{x:a,y:o,box:l}}(e,n),u=a.left+(d&&o.left),h=a.top+(d&&o.top);let{width:p,height:m}=t;return s&&(p-=a.width+o.width,m-=a.height+o.height),{x:Math.round((l-u)/p*n.width/i),y:Math.round((c-h)/m*n.height/i)}}const qv=e=>Math.round(10*e)/10;function Wv(e,t,n,i){const r=Bv(e),s=Uv(r,"margin"),a=Fv(r.maxWidth,e,"clientWidth")||Gx,o=Fv(r.maxHeight,e,"clientHeight")||Gx,l=function(e,t,n){let i,r;if(void 0===t||void 0===n){const s=Ov(e);if(s){const e=s.getBoundingClientRect(),a=Bv(s),o=Uv(a,"border","width"),l=Uv(a,"padding");t=e.width-l.width-o.width,n=e.height-l.height-o.height,i=Fv(a.maxWidth,s,"clientWidth"),r=Fv(a.maxHeight,s,"clientHeight")}else t=e.clientWidth,n=e.clientHeight}return{width:t,height:n,maxWidth:i||Gx,maxHeight:r||Gx}}(e,t,n);let{width:c,height:d}=l;if("content-box"===r.boxSizing){const e=Uv(r,"border","width"),t=Uv(r,"padding");c-=t.width+e.width,d-=t.height+e.height}c=Math.max(0,c-s.width),d=Math.max(0,i?c/i:d-s.height),c=qv(Math.min(c,a,l.maxWidth)),d=qv(Math.min(d,o,l.maxHeight)),c&&!d&&(d=qv(c/2));return(void 0!==t||void 0!==n)&&i&&l.height&&d>l.height&&(d=l.height,c=qv(Math.floor(d*i))),{width:c,height:d}}function Gv(e,t,n){const i=t||1,r=Math.floor(e.height*i),s=Math.floor(e.width*i);e.height=Math.floor(e.height),e.width=Math.floor(e.width);const a=e.canvas;return a.style&&(n||!a.style.height&&!a.style.width)&&(a.style.height="".concat(e.height,"px"),a.style.width="".concat(e.width,"px")),(e.currentDevicePixelRatio!==i||a.height!==r||a.width!==s)&&(e.currentDevicePixelRatio=i,a.height=r,a.width=s,e.ctx.setTransform(i,0,0,i,0,0),!0)}const Yv=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};zv()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(wd){}return e}();function Zv(e,t){const n=function(e,t){return Bv(e).getPropertyValue(t)}(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Xv(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function Kv(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:"middle"===i?n<.5?e.y:t.y:"after"===i?n<1?e.y:t.y:n>0?t.y:e.y}}function Qv(e,t,n,i){const r={x:e.cp2x,y:e.cp2y},s={x:t.cp1x,y:t.cp1y},a=Xv(e,r,n),o=Xv(r,s,n),l=Xv(s,t,n),c=Xv(a,o,n),d=Xv(o,l,n);return Xv(c,d,n)}function Jv(e,t,n){return e?function(e,t){return{x:n=>e+e+t-n,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,n):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function $v(e,t){let n,i;"ltr"!==t&&"rtl"!==t||(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function e_(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function t_(e){return"angle"===e?{between:dy,compare:ly,normalize:cy}:{between:hy,compare:(e,t)=>e-t,normalize:e=>e}}function n_(e){let{start:t,end:n,count:i,loop:r,style:s}=e;return{start:t%i,end:n%i,loop:r&&(n-t+1)%i===0,style:s}}function i_(e,t,n){if(!n)return[e];const{property:i,start:r,end:s}=n,a=t.length,{compare:o,between:l,normalize:c}=t_(i),{start:d,end:u,loop:h,style:p}=function(e,t,n){const{property:i,start:r,end:s}=n,{between:a,normalize:o}=t_(i),l=t.length;let c,d,{start:u,end:h,loop:p}=e;if(p){for(u+=l,h+=l,c=0,d=l;c<d&&a(o(t[u%l][i]),r,s);++c)u--,h--;u%=l,h%=l}return h<u&&(h+=l),{start:u,end:h,loop:p,style:e.style}}(e,t,n),m=[];let f,g,x,y=!1,v=null;const _=()=>y||l(r,x,f)&&0!==o(r,x),b=()=>!y||0===o(s,f)||l(s,x,f);for(let w=d,j=d;w<=u;++w)g=t[w%a],g.skip||(f=c(g[i]),f!==x&&(y=l(f,r,s),null===v&&_()&&(v=0===o(f,r)?w:j),null!==v&&b()&&(m.push(n_({start:v,end:w,loop:h,count:a,style:p})),v=null),j=w,x=f));return null!==v&&m.push(n_({start:v,end:u,loop:h,count:a,style:p})),m}function r_(e,t){const n=[],i=e.segments;for(let r=0;r<i.length;r++){const s=i_(i[r],e.points,t);s.length&&n.push(...s)}return n}function s_(e,t,n,i){return i&&i.setContext&&n?function(e,t,n,i){const r=e._chart.getContext(),s=a_(e.options),{_datasetIndex:a,options:{spanGaps:o}}=e,l=n.length,c=[];let d=s,u=t[0].start,h=u;function p(e,t,i,r){const s=o?-1:1;if(e!==t){for(e+=l;n[e%l].skip;)e-=s;for(;n[t%l].skip;)t+=s;e%l!==t%l&&(c.push({start:e%l,end:t%l,loop:i,style:r}),d=r,u=t%l)}}for(const m of t){u=o?u:m.start;let e,t=n[u%l];for(h=u+1;h<=m.end;h++){const s=n[h%l];e=a_(i.setContext(fv(r,{type:"segment",p0:t,p1:s,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:a}))),o_(e,d)&&p(u,h-1,m.loop,d),t=s,d=e}u<h-1&&p(u,h-1,m.loop,d)}return c}(e,t,n,i):t}function a_(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function o_(e,t){if(!t)return!1;const n=[],i=function(e,t){return Ey(t)?(n.includes(t)||n.push(t),n.indexOf(t)):t};return JSON.stringify(e,i)!==JSON.stringify(t,i)}class l_{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,i){const r=t.listeners[i],s=t.duration;r.forEach(i=>i({chart:e,initial:t.initial,numSteps:s,currentStep:Math.min(n-t.start,s)}))}_refresh(){this._request||(this._running=!0,this._request=vy.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=0;this._charts.forEach((n,i)=>{if(!n.running||!n.items.length)return;const r=n.items;let s,a=r.length-1,o=!1;for(;a>=0;--a)s=r[a],s._active?(s._total>n.duration&&(n.duration=s._total),s.tick(e),o=!0):(r[a]=r[r.length-1],r.pop());o&&(i.draw(),this._notify(i,n,e,"progress")),r.length||(n.running=!1,this._notify(i,n,e,"complete"),n.initial=!1),t+=r.length}),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((e,t)=>Math.max(e,t._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let i=n.length-1;for(;i>=0;--i)n[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var c_=new l_;const d_="transparent",u_={boolean:(e,t,n)=>n>.5?t:e,color(e,t,n){const i=Ay(e||d_),r=i.valid&&Ay(t||d_);return r&&r.valid?r.mix(i,n).hexString():t},number:(e,t,n)=>e+(t-e)*n};class h_{constructor(e,t,n,i){const r=t[n];i=mv([e.to,i,r,e.from]);const s=mv([e.from,r,i]);this._active=!0,this._fn=e.fn||u_[e.type||typeof s],this._easing=Cy[e.easing]||Cy.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=s,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const i=this._target[this._prop],r=n-this._start,s=this._duration-r;this._start=n,this._duration=Math.floor(Math.max(s,e.duration)),this._total+=r,this._loop=!!e.loop,this._to=mv([e.to,t,i,e.from]),this._from=mv([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,i=this._prop,r=this._from,s=this._loop,a=this._to;let o;if(this._active=r!==a&&(s||t<n),!this._active)return this._target[i]=a,void this._notify(!0);t<0?this._target[i]=r:(o=t/n%2,o=s&&o>1?2-o:o,o=this._easing(Math.min(1,Math.max(0,o))),this._target[i]=this._fn(r,a,o))}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let i=0;i<n.length;i++)n[i][t]()}}class p_{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!jx(e))return;const t=Object.keys(Hy.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const r=e[i];if(!jx(r))return;const s={};for(const e of t)s[e]=r[e];(wx(r.properties)&&r.properties||[i]).forEach(e=>{e!==i&&n.has(e)||n.set(e,s)})})}_animateOptions(e,t){const n=t.options,i=function(e,t){if(!t)return;let n=e.options;if(!n)return void(e.options=t);n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(e,n);if(!i)return[];const r=this._createAnimations(i,n);return n.$shared&&function(e,t){const n=[],i=Object.keys(t);for(let r=0;r<i.length;r++){const t=e[i[r]];t&&t.active()&&n.push(t.wait())}return Promise.all(n)}(e.options.$animations,n).then(()=>{e.options=n},()=>{}),r}_createAnimations(e,t){const n=this._properties,i=[],r=e.$animations||(e.$animations={}),s=Object.keys(t),a=Date.now();let o;for(o=s.length-1;o>=0;--o){const l=s[o];if("$"===l.charAt(0))continue;if("options"===l){i.push(...this._animateOptions(e,t));continue}const c=t[l];let d=r[l];const u=n.get(l);if(d){if(u&&d.active()){d.update(u,c,a);continue}d.cancel()}u&&u.duration?(r[l]=d=new h_(u,e,l,c),i.push(d)):e[l]=c}return i}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const n=this._createAnimations(e,t);return n.length?(c_.add(this._chart,n),!0):void 0}}function m_(e,t){const n=e&&e.options||{},i=n.reverse,r=void 0===n.min?t:0,s=void 0===n.max?t:0;return{start:i?s:r,end:i?r:s}}function f_(e,t){const n=[],i=e._getSortedDatasetMetas(t);let r,s;for(r=0,s=i.length;r<s;++r)n.push(i[r].index);return n}function g_(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=e.keys,s="single"===i.mode;let a,o,l,c;if(null!==t){for(a=0,o=r.length;a<o;++a){if(l=+r[a],l===n){if(i.all)continue;break}c=e.values[l],Nx(c)&&(s||0===t||Jx(t)===Jx(c))&&(t+=c)}return t}}function x_(e,t){const n=e&&e.options.stacked;return n||void 0===n&&void 0!==t.stack}function y_(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function v_(e,t,n,i){for(const r of t.getMatchingVisibleMetas(i).reverse()){const t=e[r.index];if(n&&t>0||!n&&t<0)return r.index}return null}function __(e,t){const{chart:n,_cachedMeta:i}=e,r=n._stacks||(n._stacks={}),{iScale:s,vScale:a,index:o}=i,l=s.axis,c=a.axis,d=function(e,t,n){return"".concat(e.id,".").concat(t.id,".").concat(n.stack||n.type)}(s,a,i),u=t.length;let h;for(let p=0;p<u;++p){const e=t[p],{[l]:n,[c]:s}=e;h=(e._stacks||(e._stacks={}))[c]=y_(r,d,n),h[o]=s,h._top=v_(h,a,!0,i.type),h._bottom=v_(h,a,!1,i.type);(h._visualValues||(h._visualValues={}))[o]=s}}function b_(e,t){const n=e.scales;return Object.keys(n).filter(e=>n[e].axis===t).shift()}function w_(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[i]||void 0===t[i][n])return;delete t[i][n],void 0!==t[i]._visualValues&&void 0!==t[i]._visualValues[n]&&delete t[i]._visualValues[n]}}}const j_=e=>"reset"===e||"none"===e,N_=(e,t)=>t?e:Object.assign({},e);class S_{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=x_(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&w_(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),i=(e,t,n,i)=>"x"===e?t:"r"===e?i:n,r=t.xAxisID=kx(n.xAxisID,b_(e,"x")),s=t.yAxisID=kx(n.yAxisID,b_(e,"y")),a=t.rAxisID=kx(n.rAxisID,b_(e,"r")),o=t.indexAxis,l=t.iAxisID=i(o,r,s,a),c=t.vAxisID=i(o,s,r,a);t.xScale=this.getScaleForId(r),t.yScale=this.getScaleForId(s),t.rScale=this.getScaleForId(a),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&xy(this._data,this),e._stacked&&w_(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(jx(t))this._data=function(e){const t=Object.keys(e),n=new Array(t.length);let i,r,s;for(i=0,r=t.length;i<r;++i)s=t[i],n[i]={x:s,y:e[s]};return n}(t);else if(n!==t){if(n){xy(n,this);const e=this._cachedMeta;w_(e),e._parsed=[]}t&&Object.isExtensible(t)&&(r=this,(i=t)._chartjs?i._chartjs.listeners.push(r):(Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),gy.forEach(e=>{const t="_onData"+Fx(e),n=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const a=n.apply(this,r);return i._chartjs.listeners.forEach(e=>{"function"===typeof e[t]&&e[t](...r)}),a}})}))),this._syncList=[],this._data=t}var i,r}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let i=!1;this._dataCheck();const r=t._stacked;t._stacked=x_(t.vScale,t),t.stack!==n.stack&&(i=!0,w_(t),t.stack=n.stack),this._resyncElements(e),(i||r!==t._stacked)&&__(this,t._parsed)}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:i}=this,{iScale:r,_stacked:s}=n,a=r.axis;let o,l,c,d=0===e&&t===i.length||n._sorted,u=e>0&&n._parsed[e-1];if(!1===this._parsing)n._parsed=i,n._sorted=!0,c=i;else{c=wx(i[e])?this.parseArrayData(n,i,e,t):jx(i[e])?this.parseObjectData(n,i,e,t):this.parsePrimitiveData(n,i,e,t);const r=()=>null===l[a]||u&&l[a]<u[a];for(o=0;o<t;++o)n._parsed[o+e]=l=c[o],d&&(r()&&(d=!1),u=l);n._sorted=d}s&&__(this,c)}parsePrimitiveData(e,t,n,i){const{iScale:r,vScale:s}=e,a=r.axis,o=s.axis,l=r.getLabels(),c=r===s,d=new Array(i);let u,h,p;for(u=0,h=i;u<h;++u)p=u+n,d[u]={[a]:c||r.parse(l[p],p),[o]:s.parse(t[p],p)};return d}parseArrayData(e,t,n,i){const{xScale:r,yScale:s}=e,a=new Array(i);let o,l,c,d;for(o=0,l=i;o<l;++o)c=o+n,d=t[c],a[o]={x:r.parse(d[0],c),y:s.parse(d[1],c)};return a}parseObjectData(e,t,n,i){const{xScale:r,yScale:s}=e,{xAxisKey:a="x",yAxisKey:o="y"}=this._parsing,l=new Array(i);let c,d,u,h;for(c=0,d=i;c<d;++c)u=c+n,h=t[u],l[c]={x:r.parse(Ox(h,a),u),y:s.parse(Ox(h,o),u)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const i=this.chart,r=this._cachedMeta,s=t[e.axis];return g_({keys:f_(i,!0),values:t._stacks[e.axis]._visualValues},s,r.index,{mode:n})}updateRangeFromParsed(e,t,n,i){const r=n[t.axis];let s=null===r?NaN:r;const a=i&&n._stacks[t.axis];i&&a&&(i.values=a,s=g_(i,r,this._cachedMeta.index)),e.min=Math.min(e.min,s),e.max=Math.max(e.max,s)}getMinMax(e,t){const n=this._cachedMeta,i=n._parsed,r=n._sorted&&e===n.iScale,s=i.length,a=this._getOtherScale(e),o=((e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:f_(n,!0),values:null})(t,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:d}=function(e){const{min:t,max:n,minDefined:i,maxDefined:r}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:r?n:Number.POSITIVE_INFINITY}}(a);let u,h;function p(){h=i[u];const t=h[a.axis];return!Nx(h[e.axis])||c>t||d<t}for(u=0;u<s&&(p()||(this.updateRangeFromParsed(l,e,h,o),!r));++u);if(r)for(u=s-1;u>=0;--u)if(!p()){this.updateRangeFromParsed(l,e,h,o);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let i,r,s;for(i=0,r=t.length;i<r;++i)s=t[i][e.axis],Nx(s)&&n.push(s);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,i=t.vScale,r=this.getParsed(e);return{label:n?""+n.getLabelForValue(r[n.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,n,i,r;return jx(e)?(t=e.top,n=e.right,i=e.bottom,r=e.left):t=n=i=r=e,{top:t,right:n,bottom:i,left:r,disabled:!1===e}}(kx(this.options.clip,function(e,t,n){if(!1===n)return!1;const i=m_(e,n),r=m_(t,n);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,i=n.data||[],r=t.chartArea,s=[],a=this._drawStart||0,o=this._drawCount||i.length-a,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(e,r,a,o),c=a;c<a+o;++c){const t=i[c];t.hidden||(t.active&&l?s.push(t):t.draw(e,r))}for(c=0;c<s.length;++c)s[c].draw(e,r)}getStyle(e,t){const n=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const i=this.getDataset();let r;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];r=t.$context||(t.$context=function(e,t,n){return fv(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),r.parsed=this.getParsed(e),r.raw=i.data[e],r.index=r.dataIndex=e}else r=this.$context||(this.$context=function(e,t){return fv(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!t,r.mode=n,r}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=arguments.length>2?arguments[2]:void 0;const i="active"===t,r=this._cachedDataOpts,s=e+"-"+t,a=r[s],o=this.enableOptionSharing&&Bx(n);if(a)return N_(a,o);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),d=i?["".concat(e,"Hover"),"hover",e,""]:[e,""],u=l.getOptionScopes(this.getDataset(),c),h=Object.keys(Hy.elements[e]),p=l.resolveNamedOptions(u,h,()=>this.getContext(n,i,t),d);return p.$shared&&(p.$shared=o,r[s]=Object.freeze(N_(p,o))),p}_resolveAnimations(e,t,n){const i=this.chart,r=this._cachedDataOpts,s="animation-".concat(t),a=r[s];if(a)return a;let o;if(!1!==i.options.animation){const i=this.chart.config,r=i.datasetAnimationScopeKeys(this._type,t),s=i.getOptionScopes(this.getDataset(),r);o=i.createResolver(s,this.getContext(e,n,t))}const l=new p_(i,o&&o.animations);return o&&o._cacheable&&(r[s]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||j_(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),i=this._sharedOptions,r=this.getSharedOptions(n),s=this.includeOptions(t,r)||r!==i;return this.updateSharedOptions(r,t,n),{sharedOptions:r,includeOptions:s}}updateElement(e,t,n,i){j_(i)?Object.assign(e,n):this._resolveAnimations(t,i).update(e,n)}updateSharedOptions(e,t,n){e&&!j_(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,i){e.active=i;const r=this.getStyle(t,i);this._resolveAnimations(t,n,i).update(e,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[a,o,l]of this._syncList)this[a](o,l);this._syncList=[];const i=n.length,r=t.length,s=Math.min(r,i);s&&this.parse(0,s),r>i?this._insertElements(i,r-i,e):r<i&&this._removeElements(r,i-r)}_insertElements(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this._cachedMeta,r=i.data,s=e+t;let a;const o=e=>{for(e.length+=t,a=e.length-1;a>=s;a--)e[a]=e[a-t]};for(o(r),a=e;a<s;++a)r[a]=new this.dataElementType;this._parsing&&o(i._parsed),this.parse(e,t),n&&this.updateElements(r,e,t,"reset")}updateElements(e,t,n,i){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const i=n._parsed.splice(e,t);n._stacked&&w_(n,i)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,i]=e;this[t](n,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function k_(e){const t=e.iScale,n=function(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let t=0,r=n.length;t<r;t++)i=i.concat(n[t].controller.getAllParsedValues(e));e._cache.$bar=yy(i.sort((e,t)=>e-t))}return e._cache.$bar}(t,e.type);let i,r,s,a,o=t._length;const l=()=>{32767!==s&&-32768!==s&&(Bx(a)&&(o=Math.min(o,Math.abs(s-a)||o)),a=s)};for(i=0,r=n.length;i<r;++i)s=t.getPixelForValue(n[i]),l();for(a=void 0,i=0,r=t.ticks.length;i<r;++i)s=t.getPixelForTick(i),l();return o}function T_(e,t,n,i){return wx(e)?function(e,t,n,i){const r=n.parse(e[0],i),s=n.parse(e[1],i),a=Math.min(r,s),o=Math.max(r,s);let l=a,c=o;Math.abs(a)>Math.abs(o)&&(l=o,c=a),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:r,end:s,min:a,max:o}}(e,t,n,i):t[n.axis]=n.parse(e,i),t}function C_(e,t,n,i){const r=e.iScale,s=e.vScale,a=r.getLabels(),o=r===s,l=[];let c,d,u,h;for(c=n,d=n+i;c<d;++c)h=t[c],u={},u[r.axis]=o||r.parse(a[c],c),l.push(T_(h,u,s,c));return l}function E_(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function A_(e,t,n,i){let r=t.borderSkipped;const s={};if(!r)return void(e.borderSkipped=s);if(!0===r)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:a,end:o,reverse:l,top:c,bottom:d}=function(e){let t,n,i,r,s;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(r="end",s="start"):(r="start",s="end"),{start:n,end:i,reverse:t,top:r,bottom:s}}(e);"middle"===r&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?r=c:(n._bottom||0)===i?r=d:(s[M_(d,a,o,l)]=!0,r=c)),s[M_(r,a,o,l)]=!0,e.borderSkipped=s}function M_(e,t,n,i){var r,s,a;return i?(a=n,e=D_(e=(r=e)===(s=t)?a:r===a?s:r,n,t)):e=D_(e,t,n),e}function D_(e,t,n){return"start"===e?t:"end"===e?n:e}function I_(e,t,n){let{inflateAmount:i}=t;e.inflateAmount="auto"===i?1===n?.33:0:i}(0,Pe.A)(S_,"defaults",{}),(0,Pe.A)(S_,"datasetElementType",null),(0,Pe.A)(S_,"dataElementType",null);class P_ extends S_{parsePrimitiveData(e,t,n,i){return C_(e,t,n,i)}parseArrayData(e,t,n,i){return C_(e,t,n,i)}parseObjectData(e,t,n,i){const{iScale:r,vScale:s}=e,{xAxisKey:a="x",yAxisKey:o="y"}=this._parsing,l="x"===r.axis?a:o,c="x"===s.axis?a:o,d=[];let u,h,p,m;for(u=n,h=n+i;u<h;++u)m=t[u],p={},p[r.axis]=r.parse(Ox(m,l),u),d.push(T_(Ox(m,c),p,s,u));return d}updateRangeFromParsed(e,t,n,i){super.updateRangeFromParsed(e,t,n,i);const r=n._custom;r&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,r.min),e.max=Math.max(e.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:i}=t,r=this.getParsed(e),s=r._custom,a=E_(s)?"["+s.start+", "+s.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+n.getLabelForValue(r[n.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,i){const r="reset"===i,{index:s,_cachedMeta:{vScale:a}}=this,o=a.getBasePixel(),l=a.isHorizontal(),c=this._getRuler(),{sharedOptions:d,includeOptions:u}=this._getSharedOptions(t,i);for(let h=t;h<t+n;h++){const t=this.getParsed(h),n=r||bx(t[a.axis])?{base:o,head:o}:this._calculateBarValuePixels(h),p=this._calculateBarIndexPixels(h,c),m=(t._stacks||{})[a.axis],f={horizontal:l,base:n.base,enableBorderRadius:!m||E_(t._custom)||s===m._top||s===m._bottom,x:l?n.head:p.center,y:l?p.center:n.head,height:l?p.size:Math.abs(n.size),width:l?Math.abs(n.size):p.size};u&&(f.options=d||this.resolveDataElementOptions(h,e[h].active?"active":i));const g=f.options||e[h].options;A_(f,g,m,s),I_(f,g,c.ratio),this.updateElement(e[h],h,f,i)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,i=n.getMatchingVisibleMetas(this._type).filter(e=>e.controller.options.grouped),r=n.options.stacked,s=[],a=e=>{const n=e.controller.getParsed(t),i=n&&n[e.vScale.axis];if(bx(i)||isNaN(i))return!0};for(const o of i)if((void 0===t||!a(o))&&((!1===r||-1===s.indexOf(o.stack)||void 0===r&&void 0===o.stack)&&s.push(o.stack),o.index===e))break;return s.length||s.push(void 0),s}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,n){const i=this._getStacks(e,n),r=void 0!==t?i.indexOf(t):-1;return-1===r?i.length-1:r}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,i=[];let r,s;for(r=0,s=t.data.length;r<s;++r)i.push(n.getPixelForValue(this.getParsed(r)[n.axis],r));const a=e.barThickness;return{min:a||k_(t),pixels:i,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:a?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n,index:i},options:{base:r,minBarLength:s}}=this,a=r||0,o=this.getParsed(e),l=o._custom,c=E_(l);let d,u,h=o[t.axis],p=0,m=n?this.applyStack(t,o,n):h;m!==h&&(p=m-h,m=h),c&&(h=l.barStart,m=l.barEnd-l.barStart,0!==h&&Jx(h)!==Jx(l.barEnd)&&(p=0),p+=h);const f=bx(r)||c?p:r;let g=t.getPixelForValue(f);if(d=this.chart.getDataVisibility(e)?t.getPixelForValue(p+m):g,u=d-g,Math.abs(u)<s){u=function(e,t,n){return 0!==e?Jx(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}(u,t,a)*s,h===a&&(g-=u/2);const e=t.getPixelForDecimal(0),r=t.getPixelForDecimal(1),l=Math.min(e,r),p=Math.max(e,r);g=Math.max(Math.min(g,p),l),d=g+u,n&&!c&&(o._stacks[t.axis]._visualValues[i]=t.getValueForPixel(d)-t.getValueForPixel(g))}if(g===t.getPixelForValue(a)){const e=Jx(u)*t.getLineWidthForValue(a)/2;g+=e,u-=e}return{size:u,base:g,head:d,center:d+u/2}}_calculateBarIndexPixels(e,t){const n=t.scale,i=this.options,r=i.skipNull,s=kx(i.maxBarThickness,1/0);let a,o;if(t.grouped){const n=r?this._getStackCount(e):t.stackCount,l="flex"===i.barThickness?function(e,t,n,i){const r=t.pixels,s=r[e];let a=e>0?r[e-1]:null,o=e<r.length-1?r[e+1]:null;const l=n.categoryPercentage;null===a&&(a=s-(null===o?t.end-t.start:o-s)),null===o&&(o=s+s-a);const c=s-(s-Math.min(a,o))/2*l;return{chunk:Math.abs(o-a)/2*l/i,ratio:n.barPercentage,start:c}}(e,t,i,n):function(e,t,n,i){const r=n.barThickness;let s,a;return bx(r)?(s=t.min*n.categoryPercentage,a=n.barPercentage):(s=r*i,a=1),{chunk:s/i,ratio:a,start:t.pixels[e]-s/2}}(e,t,i,n),c=this._getStackIndex(this.index,this._cachedMeta.stack,r?e:void 0);a=l.start+l.chunk*c+l.chunk/2,o=Math.min(s,l.chunk*l.ratio)}else a=n.getPixelForValue(this.getParsed(e)[n.axis],e),o=Math.min(s,t.min*t.ratio);return{base:a-o/2,head:a+o/2,center:a,size:o}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,i=n.length;let r=0;for(;r<i;++r)null!==this.getParsed(r)[t.axis]&&n[r].draw(this._ctx)}}(0,Pe.A)(P_,"id","bar"),(0,Pe.A)(P_,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),(0,Pe.A)(P_,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class R_ extends S_{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,n,i){const r=super.parsePrimitiveData(e,t,n,i);for(let s=0;s<r.length;s++)r[s]._custom=this.resolveDataElementOptions(s+n).radius;return r}parseArrayData(e,t,n,i){const r=super.parseArrayData(e,t,n,i);for(let s=0;s<r.length;s++){const e=t[n+s];r[s]._custom=kx(e[2],this.resolveDataElementOptions(s+n).radius)}return r}parseObjectData(e,t,n,i){const r=super.parseObjectData(e,t,n,i);for(let s=0;s<r.length;s++){const e=t[n+s];r[s]._custom=kx(e&&e.r&&+e.r,this.resolveDataElementOptions(s+n).radius)}return r}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:r}=t,s=this.getParsed(e),a=i.getLabelForValue(s.x),o=r.getLabelForValue(s.y),l=s._custom;return{label:n[e]||"",value:"("+a+", "+o+(l?", "+l:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,n,i){const r="reset"===i,{iScale:s,vScale:a}=this._cachedMeta,{sharedOptions:o,includeOptions:l}=this._getSharedOptions(t,i),c=s.axis,d=a.axis;for(let u=t;u<t+n;u++){const t=e[u],n=!r&&this.getParsed(u),h={},p=h[c]=r?s.getPixelForDecimal(.5):s.getPixelForValue(n[c]),m=h[d]=r?a.getBasePixel():a.getPixelForValue(n[d]);h.skip=isNaN(p)||isNaN(m),l&&(h.options=o||this.resolveDataElementOptions(u,t.active?"active":i),r&&(h.options.radius=0)),this.updateElement(t,u,h,i)}}resolveDataElementOptions(e,t){const n=this.getParsed(e);let i=super.resolveDataElementOptions(e,t);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return"active"!==t&&(i.radius=0),i.radius+=kx(n&&n._custom,r),i}}(0,Pe.A)(R_,"id","bubble"),(0,Pe.A)(R_,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),(0,Pe.A)(R_,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});class L_ extends S_{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const n=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=n;else{let r,s,a=e=>+n[e];if(jx(n[e])){const{key:e="value"}=this._parsing;a=t=>+Ox(n[t],e)}for(r=e,s=e+t;r<s;++r)i._parsed[r]=a(r)}}_getRotation(){return iy(this.options.rotation-90)}_getCircumference(){return iy(this.options.circumference)}_getRotationExtents(){let e=qx,t=-qx;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const i=this.chart.getDatasetMeta(n).controller,r=i._getRotation(),s=i._getCircumference();e=Math.min(e,r),t=Math.max(t,r+s)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:n}=t,i=this._cachedMeta,r=i.data,s=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(n.width,n.height)-s)/2,0),o=Math.min(((e,t)=>"string"===typeof e&&e.endsWith("%")?parseFloat(e)/100:+e/t)(this.options.cutout,a),1),l=this._getRingWeight(this.index),{circumference:c,rotation:d}=this._getRotationExtents(),{ratioX:u,ratioY:h,offsetX:p,offsetY:m}=function(e,t,n){let i=1,r=1,s=0,a=0;if(t<qx){const o=e,l=o+t,c=Math.cos(o),d=Math.sin(o),u=Math.cos(l),h=Math.sin(l),p=(e,t,i)=>dy(e,o,l,!0)?1:Math.max(t,t*n,i,i*n),m=(e,t,i)=>dy(e,o,l,!0)?-1:Math.min(t,t*n,i,i*n),f=p(0,c,u),g=p(Zx,d,h),x=m(Hx,c,u),y=m(Hx+Zx,d,h);i=(f-x)/2,r=(g-y)/2,s=-(f+x)/2,a=-(g+y)/2}return{ratioX:i,ratioY:r,offsetX:s,offsetY:a}}(d,c,o),f=(n.width-s)/u,g=(n.height-s)/h,x=Math.max(Math.min(f,g)/2,0),y=Tx(this.options.radius,x),v=(y-Math.max(y*o,0))/this._getVisibleDatasetWeightTotal();this.offsetX=p*y,this.offsetY=m*y,i.total=this.calculateTotal(),this.outerRadius=y-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*l,0),this.updateElements(r,0,r.length,e)}_circumference(e,t){const n=this.options,i=this._cachedMeta,r=this._getCircumference();return t&&n.animation.animateRotate||!this.chart.getDataVisibility(e)||null===i._parsed[e]||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*r/qx)}updateElements(e,t,n,i){const r="reset"===i,s=this.chart,a=s.chartArea,o=s.options.animation,l=(a.left+a.right)/2,c=(a.top+a.bottom)/2,d=r&&o.animateScale,u=d?0:this.innerRadius,h=d?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(t,i);let f,g=this._getRotation();for(f=0;f<t;++f)g+=this._circumference(f,r);for(f=t;f<t+n;++f){const t=this._circumference(f,r),n=e[f],s={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+t,circumference:t,outerRadius:h,innerRadius:u};m&&(s.options=p||this.resolveDataElementOptions(f,n.active?"active":i)),g+=t,this.updateElement(n,f,s,i)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let n,i=0;for(n=0;n<t.length;n++){const r=e._parsed[n];null===r||isNaN(r)||!this.chart.getDataVisibility(n)||t[n].hidden||(i+=Math.abs(r))}return i}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?qx*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=Ry(t._parsed[e],n.options.locale);return{label:i[e]||"",value:r}}getMaxBorderWidth(e){let t=0;const n=this.chart;let i,r,s,a,o;if(!e)for(i=0,r=n.data.datasets.length;i<r;++i)if(n.isDatasetVisible(i)){s=n.getDatasetMeta(i),e=s.data,a=s.controller;break}if(!e)return 0;for(i=0,r=e.length;i<r;++i)o=a.resolveDataElementOptions(i),"inner"!==o.borderAlign&&(t=Math.max(t,o.borderWidth||0,o.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let n=0,i=e.length;n<i;++n){const e=this.resolveDataElementOptions(n);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let n=0;n<e;++n)this.chart.isDatasetVisible(n)&&(t+=this._getRingWeight(n));return t}_getRingWeight(e){return Math.max(kx(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}(0,Pe.A)(L_,"id","doughnut"),(0,Pe.A)(L_,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),(0,Pe.A)(L_,"descriptors",{_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),(0,Pe.A)(L_,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:i}}=e.legend.options;return t.labels.map((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:i,lineWidth:s.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}}});class z_ extends S_{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:i=[],_dataset:r}=t,s=this.chart._animationsDisabled;let{start:a,count:o}=jy(t,i,s);this._drawStart=a,this._drawCount=o,Ny(t)&&(a=0,o=i.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!r._decimated,n.points=i;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!s,options:l},e),this.updateElements(i,a,o,e)}updateElements(e,t,n,i){const r="reset"===i,{iScale:s,vScale:a,_stacked:o,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:d}=this._getSharedOptions(t,i),u=s.axis,h=a.axis,{spanGaps:p,segment:m}=this.options,f=ty(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||"none"===i,x=t+n,y=e.length;let v=t>0&&this.getParsed(t-1);for(let _=0;_<y;++_){const n=e[_],p=g?n:{};if(_<t||_>=x){p.skip=!0;continue}const y=this.getParsed(_),b=bx(y[h]),w=p[u]=s.getPixelForValue(y[u],_),j=p[h]=r||b?a.getBasePixel():a.getPixelForValue(o?this.applyStack(a,y,o):y[h],_);p.skip=isNaN(w)||isNaN(j)||b,p.stop=_>0&&Math.abs(y[u]-v[u])>f,m&&(p.parsed=y,p.raw=l.data[_]),d&&(p.options=c||this.resolveDataElementOptions(_,n.active?"active":i)),g||this.updateElement(n,_,p,i),v=y}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,i=e.data||[];if(!i.length)return n;const r=i[0].size(this.resolveDataElementOptions(0)),s=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,r,s)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}(0,Pe.A)(z_,"id","line"),(0,Pe.A)(z_,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),(0,Pe.A)(z_,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class O_ extends S_{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=Ry(t._parsed[e].r,n.options.locale);return{label:i[e]||"",value:r}}parseObjectData(e,t,n,i){return Ev.bind(this)(e,t,n,i)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((e,n)=>{const i=this.getParsed(n).r;!isNaN(i)&&this.chart.getDataVisibility(n)&&(i<t.min&&(t.min=i),i>t.max&&(t.max=i))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,n=e.options,i=Math.min(t.right-t.left,t.bottom-t.top),r=Math.max(i/2,0),s=(r-Math.max(n.cutoutPercentage?r/100*n.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=r-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(e,t,n,i){const r="reset"===i,s=this.chart,a=s.options.animation,o=this._cachedMeta.rScale,l=o.xCenter,c=o.yCenter,d=o.getIndexAngle(0)-.5*Hx;let u,h=d;const p=360/this.countVisibleElements();for(u=0;u<t;++u)h+=this._computeAngle(u,i,p);for(u=t;u<t+n;u++){const t=e[u];let n=h,m=h+this._computeAngle(u,i,p),f=s.getDataVisibility(u)?o.getDistanceFromCenterForValue(this.getParsed(u).r):0;h=m,r&&(a.animateScale&&(f=0),a.animateRotate&&(n=m=d));const g={x:l,y:c,innerRadius:0,outerRadius:f,startAngle:n,endAngle:m,options:this.resolveDataElementOptions(u,t.active?"active":i)};this.updateElement(t,u,g,i)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((e,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&t++}),t}_computeAngle(e,t,n){return this.chart.getDataVisibility(e)?iy(this.resolveDataElementOptions(e,t).angle||n):0}}(0,Pe.A)(O_,"id","polarArea"),(0,Pe.A)(O_,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),(0,Pe.A)(O_,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:i}}=e.legend.options;return t.labels.map((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:i,lineWidth:s.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class F_ extends L_{}(0,Pe.A)(F_,"id","pie"),(0,Pe.A)(F_,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class B_ extends S_{getLabelAndValue(e){const t=this._cachedMeta.vScale,n=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(n[t.axis])}}parseObjectData(e,t,n,i){return Ev.bind(this)(e,t,n,i)}update(e){const t=this._cachedMeta,n=t.dataset,i=t.data||[],r=t.iScale.getLabels();if(n.points=i,"resize"!==e){const t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);const s={_loop:!0,_fullLoop:r.length===i.length,options:t};this.updateElement(n,void 0,s,e)}this.updateElements(i,0,i.length,e)}updateElements(e,t,n,i){const r=this._cachedMeta.rScale,s="reset"===i;for(let a=t;a<t+n;a++){const t=e[a],n=this.resolveDataElementOptions(a,t.active?"active":i),o=r.getPointPositionForValue(a,this.getParsed(a).r),l=s?r.xCenter:o.x,c=s?r.yCenter:o.y,d={x:l,y:c,angle:o.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(t,a,d,i)}}}(0,Pe.A)(B_,"id","radar"),(0,Pe.A)(B_,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),(0,Pe.A)(B_,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class V_ extends S_{getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:r}=t,s=this.getParsed(e),a=i.getLabelForValue(s.x),o=r.getLabelForValue(s.y);return{label:n[e]||"",value:"("+a+", "+o+")"}}update(e){const t=this._cachedMeta,{data:n=[]}=t,i=this.chart._animationsDisabled;let{start:r,count:s}=jy(t,n,i);if(this._drawStart=r,this._drawCount=s,Ny(t)&&(r=0,s=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:s}=t;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!s._decimated,r.points=n;const a=this.resolveDatasetElementOptions(e);a.segment=this.options.segment,this.updateElement(r,void 0,{animated:!i,options:a},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(n,r,s,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,n,i){const r="reset"===i,{iScale:s,vScale:a,_stacked:o,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,i),d=this.getSharedOptions(c),u=this.includeOptions(i,d),h=s.axis,p=a.axis,{spanGaps:m,segment:f}=this.options,g=ty(m)?m:Number.POSITIVE_INFINITY,x=this.chart._animationsDisabled||r||"none"===i;let y=t>0&&this.getParsed(t-1);for(let v=t;v<t+n;++v){const t=e[v],n=this.getParsed(v),c=x?t:{},m=bx(n[p]),_=c[h]=s.getPixelForValue(n[h],v),b=c[p]=r||m?a.getBasePixel():a.getPixelForValue(o?this.applyStack(a,n,o):n[p],v);c.skip=isNaN(_)||isNaN(b)||m,c.stop=v>0&&Math.abs(n[h]-y[h])>g,f&&(c.parsed=n,c.raw=l.data[v]),u&&(c.options=d||this.resolveDataElementOptions(v,t.active?"active":i)),x||this.updateElement(t,v,c,i),y=n}this.updateSharedOptions(d,i,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}const n=e.dataset,i=n.options&&n.options.borderWidth||0;if(!t.length)return i;const r=t[0].size(this.resolveDataElementOptions(0)),s=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(i,r,s)/2}}(0,Pe.A)(V_,"id","scatter"),(0,Pe.A)(V_,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),(0,Pe.A)(V_,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var U_=Object.freeze({__proto__:null,BarController:P_,BubbleController:R_,DoughnutController:L_,LineController:z_,PieController:F_,PolarAreaController:O_,RadarController:B_,ScatterController:V_});function H_(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class q_{static override(e){Object.assign(q_.prototype,e)}constructor(e){(0,Pe.A)(this,"options",void 0),this.options=e||{}}init(){}formats(){return H_()}parse(){return H_()}format(){return H_()}add(){return H_()}diff(){return H_()}startOf(){return H_()}endOf(){return H_()}}var W_=q_;function G_(e,t,n,i){const{controller:r,data:s,_sorted:a}=e,o=r._cachedMeta.iScale;if(o&&t===o.axis&&"r"!==t&&a&&s.length){const e=o._reversePixels?fy:my;if(!i)return e(s,t,n);if(r._sharedOptions){const i=s[0],r="function"===typeof i.getRange&&i.getRange(t);if(r){const i=e(s,t,n-r),a=e(s,t,n+r);return{lo:i.lo,hi:a.hi}}}}return{lo:0,hi:s.length-1}}function Y_(e,t,n,i,r){const s=e.getSortedVisibleDatasetMetas(),a=n[t];for(let o=0,l=s.length;o<l;++o){const{index:e,data:n}=s[o],{lo:l,hi:c}=G_(s[o],t,a,r);for(let t=l;t<=c;++t){const r=n[t];r.skip||i(r,e,t)}}}function Z_(e,t,n,i,r){const s=[];if(!r&&!e.isPointInArea(t))return s;return Y_(e,n,t,function(n,a,o){(r||Ky(n,e.chartArea,0))&&n.inRange(t.x,t.y,i)&&s.push({element:n,datasetIndex:a,index:o})},!0),s}function X_(e,t,n,i,r,s){let a=[];const o=function(e){const t=-1!==e.indexOf("x"),n=-1!==e.indexOf("y");return function(e,i){const r=t?Math.abs(e.x-i.x):0,s=n?Math.abs(e.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(s,2))}}(n);let l=Number.POSITIVE_INFINITY;return Y_(e,n,t,function(n,c,d){const u=n.inRange(t.x,t.y,r);if(i&&!u)return;const h=n.getCenterPoint(r);if(!(!!s||e.isPointInArea(h))&&!u)return;const p=o(t,h);p<l?(a=[{element:n,datasetIndex:c,index:d}],l=p):p===l&&a.push({element:n,datasetIndex:c,index:d})}),a}function K_(e,t,n,i,r,s){return s||e.isPointInArea(t)?"r"!==n||i?X_(e,t,n,i,r,s):function(e,t,n,i){let r=[];return Y_(e,n,t,function(e,n,s){const{startAngle:a,endAngle:o}=e.getProps(["startAngle","endAngle"],i),{angle:l}=ay(e,{x:t.x,y:t.y});dy(l,a,o)&&r.push({element:e,datasetIndex:n,index:s})}),r}(e,t,n,r):[]}function Q_(e,t,n,i,r){const s=[],a="x"===n?"inXRange":"inYRange";let o=!1;return Y_(e,n,t,(e,i,l)=>{e[a](t[n],r)&&(s.push({element:e,datasetIndex:i,index:l}),o=o||e.inRange(t.x,t.y,r))}),i&&!o?[]:s}var J_={evaluateInteractionItems:Y_,modes:{index(e,t,n,i){const r=Hv(t,e),s=n.axis||"x",a=n.includeInvisible||!1,o=n.intersect?Z_(e,r,s,i,a):K_(e,r,s,!1,i,a),l=[];return o.length?(e.getSortedVisibleDatasetMetas().forEach(e=>{const t=o[0].index,n=e.data[t];n&&!n.skip&&l.push({element:n,datasetIndex:e.index,index:t})}),l):[]},dataset(e,t,n,i){const r=Hv(t,e),s=n.axis||"xy",a=n.includeInvisible||!1;let o=n.intersect?Z_(e,r,s,i,a):K_(e,r,s,!1,i,a);if(o.length>0){const t=o[0].datasetIndex,n=e.getDatasetMeta(t).data;o=[];for(let e=0;e<n.length;++e)o.push({element:n[e],datasetIndex:t,index:e})}return o},point:(e,t,n,i)=>Z_(e,Hv(t,e),n.axis||"xy",i,n.includeInvisible||!1),nearest(e,t,n,i){const r=Hv(t,e),s=n.axis||"xy",a=n.includeInvisible||!1;return K_(e,r,s,n.intersect,i,a)},x:(e,t,n,i)=>Q_(e,Hv(t,e),"x",n.intersect,i),y:(e,t,n,i)=>Q_(e,Hv(t,e),"y",n.intersect,i)}};const $_=["left","top","right","bottom"];function eb(e,t){return e.filter(e=>e.pos===t)}function tb(e,t){return e.filter(e=>-1===$_.indexOf(e.pos)&&e.box.axis===t)}function nb(e,t){return e.sort((e,n)=>{const i=t?n:e,r=t?e:n;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function ib(e,t){const n=function(e){const t={};for(const n of e){const{stack:e,pos:i,stackWeight:r}=n;if(!e||!$_.includes(i))continue;const s=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=r}return t}(e),{vBoxMaxWidth:i,hBoxMaxHeight:r}=t;let s,a,o;for(s=0,a=e.length;s<a;++s){o=e[s];const{fullSize:a}=o.box,l=n[o.stack],c=l&&o.stackWeight/l.weight;o.horizontal?(o.width=c?c*i:a&&t.availableWidth,o.height=r):(o.width=i,o.height=c?c*r:a&&t.availableHeight)}return n}function rb(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function sb(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function ab(e,t,n,i){const{pos:r,box:s}=n,a=e.maxPadding;if(!jx(r)){n.size&&(e[r]-=n.size);const t=i[n.stack]||{size:0,count:1};t.size=Math.max(t.size,n.horizontal?s.height:s.width),n.size=t.size/t.count,e[r]+=n.size}s.getPadding&&sb(a,s.getPadding());const o=Math.max(0,t.outerWidth-rb(a,e,"left","right")),l=Math.max(0,t.outerHeight-rb(a,e,"top","bottom")),c=o!==e.w,d=l!==e.h;return e.w=o,e.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function ob(e,t){const n=t.maxPadding;function i(e){const i={left:0,top:0,right:0,bottom:0};return e.forEach(e=>{i[e]=Math.max(t[e],n[e])}),i}return i(e?["left","right"]:["top","bottom"])}function lb(e,t,n,i){const r=[];let s,a,o,l,c,d;for(s=0,a=e.length,c=0;s<a;++s){o=e[s],l=o.box,l.update(o.width||t.w,o.height||t.h,ob(o.horizontal,t));const{same:a,other:u}=ab(t,n,o,i);c|=a&&r.length,d=d||u,l.fullSize||r.push(o)}return c&&lb(r,t,n,i)||d}function cb(e,t,n,i,r){e.top=n,e.left=t,e.right=t+i,e.bottom=n+r,e.width=i,e.height=r}function db(e,t,n,i){const r=n.padding;let{x:s,y:a}=t;for(const o of e){const e=o.box,l=i[o.stack]||{count:1,placed:0,weight:1},c=o.stackWeight/l.weight||1;if(o.horizontal){const i=t.w*c,s=l.size||e.height;Bx(l.start)&&(a=l.start),e.fullSize?cb(e,r.left,a,n.outerWidth-r.right-r.left,s):cb(e,t.left+l.placed,a,i,s),l.start=a,l.placed+=i,a=e.bottom}else{const i=t.h*c,a=l.size||e.width;Bx(l.start)&&(s=l.start),e.fullSize?cb(e,s,r.top,a,n.outerHeight-r.bottom-r.top):cb(e,s,t.top+l.placed,a,i),l.start=s,l.placed+=i,s=e.right}}t.x=s,t.y=a}var ub={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;-1!==n&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const r=hv(e.options.layout.padding),s=Math.max(t-r.width,0),a=Math.max(n-r.height,0),o=function(e){const t=function(e){const t=[];let n,i,r,s,a,o;for(n=0,i=(e||[]).length;n<i;++n)r=e[n],({position:s,options:{stack:a,stackWeight:o=1}}=r),t.push({index:n,box:r,pos:s,horizontal:r.isHorizontal(),weight:r.weight,stack:a&&s+a,stackWeight:o});return t}(e),n=nb(t.filter(e=>e.box.fullSize),!0),i=nb(eb(t,"left"),!0),r=nb(eb(t,"right")),s=nb(eb(t,"top"),!0),a=nb(eb(t,"bottom")),o=tb(t,"x"),l=tb(t,"y");return{fullSize:n,leftAndTop:i.concat(s),rightAndBottom:r.concat(l).concat(a).concat(o),chartArea:eb(t,"chartArea"),vertical:i.concat(r).concat(l),horizontal:s.concat(a).concat(o)}}(e.boxes),l=o.vertical,c=o.horizontal;Ex(e.boxes,e=>{"function"===typeof e.beforeLayout&&e.beforeLayout()});const d=l.reduce((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:n,padding:r,availableWidth:s,availableHeight:a,vBoxMaxWidth:s/2/d,hBoxMaxHeight:a/2}),h=Object.assign({},r);sb(h,hv(i));const p=Object.assign({maxPadding:h,w:s,h:a,x:r.left,y:r.top},r),m=ib(l.concat(c),u);lb(o.fullSize,p,u,m),lb(l,p,u,m),lb(c,p,u,m)&&lb(l,p,u,m),function(e){const t=e.maxPadding;function n(n){const i=Math.max(t[n]-e[n],0);return e[n]+=i,i}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}(p),db(o.leftAndTop,p,u,m),p.x+=p.w,p.y+=p.h,db(o.rightAndBottom,p,u,m),e.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},Ex(o.chartArea,t=>{const n=t.box;Object.assign(n,e.chartArea),n.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class hb{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,i){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):n)}}isAttached(e){return!0}updateConfig(e){}}class pb extends hb{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const mb="$chartjs",fb={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},gb=e=>null===e||""===e;const xb=!!Yv&&{passive:!0};function yb(e,t,n){e.canvas.removeEventListener(t,n,xb)}function vb(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function _b(e,t,n){const i=e.canvas,r=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||vb(n.addedNodes,i),t=t&&!vb(n.removedNodes,i);t&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}function bb(e,t,n){const i=e.canvas,r=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||vb(n.removedNodes,i),t=t&&!vb(n.addedNodes,i);t&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}const wb=new Map;let jb=0;function Nb(){const e=window.devicePixelRatio;e!==jb&&(jb=e,wb.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function Sb(e,t,n){const i=e.canvas,r=i&&Ov(i);if(!r)return;const s=_y((e,t)=>{const i=r.clientWidth;n(e,t),i<r.clientWidth&&n()},window),a=new ResizeObserver(e=>{const t=e[0],n=t.contentRect.width,i=t.contentRect.height;0===n&&0===i||s(n,i)});return a.observe(r),function(e,t){wb.size||window.addEventListener("resize",Nb),wb.set(e,t)}(e,s),a}function kb(e,t,n){n&&n.disconnect(),"resize"===t&&function(e){wb.delete(e),wb.size||window.removeEventListener("resize",Nb)}(e)}function Tb(e,t,n){const i=e.canvas,r=_y(t=>{null!==e.ctx&&n(function(e,t){const n=fb[e.type]||e.type,{x:i,y:r}=Hv(e,t);return{type:n,chart:t,native:e,x:void 0!==i?i:null,y:void 0!==r?r:null}}(t,e))},e);return function(e,t,n){e.addEventListener(t,n,xb)}(i,t,r),r}class Cb extends hb{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(function(e,t){const n=e.style,i=e.getAttribute("height"),r=e.getAttribute("width");if(e[mb]={initial:{height:i,width:r,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",gb(r)){const t=Zv(e,"width");void 0!==t&&(e.width=t)}if(gb(i))if(""===e.style.height)e.height=e.width/(t||2);else{const t=Zv(e,"height");void 0!==t&&(e.height=t)}}(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[mb])return!1;const n=t[mb].initial;["height","width"].forEach(e=>{const i=n[e];bx(i)?t.removeAttribute(e):t.setAttribute(e,i)});const i=n.style||{};return Object.keys(i).forEach(e=>{t.style[e]=i[e]}),t.width=t.width,delete t[mb],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const i=e.$proxies||(e.$proxies={}),r={attach:_b,detach:bb,resize:Sb}[t]||Tb;i[t]=r(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),i=n[t];if(!i)return;({attach:kb,detach:kb,resize:kb}[t]||yb)(e,t,i),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,i){return Wv(e,t,n,i)}isAttached(e){const t=Ov(e);return!(!t||!t.isConnected)}}class Eb{constructor(){(0,Pe.A)(this,"x",void 0),(0,Pe.A)(this,"y",void 0),(0,Pe.A)(this,"active",!1),(0,Pe.A)(this,"options",void 0),(0,Pe.A)(this,"$animations",void 0)}tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return ty(this.x)&&ty(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const i={};return e.forEach(e=>{i[e]=n[e]&&n[e].active()?n[e]._to:this[e]}),i}}function Ab(e,t){const n=e.options.ticks,i=function(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),r=e._maxLength/n;return Math.floor(Math.min(i,r))}(e),r=Math.min(n.maxTicksLimit||i,i),s=n.major.enabled?function(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}(t):[],a=s.length,o=s[0],l=s[a-1],c=[];if(a>r)return function(e,t,n,i){let r,s=0,a=n[0];for(i=Math.ceil(i),r=0;r<e.length;r++)r===a&&(t.push(e[r]),s++,a=n[s*i])}(t,c,s,a/r),c;const d=function(e,t,n){const i=function(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}(e),r=t.length/n;if(!i)return Math.max(r,1);const s=function(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(0|n)&&t.push(n),t.sort((e,t)=>e-t).pop(),t}(i);for(let a=0,o=s.length-1;a<o;a++){const e=s[a];if(e>r)return e}return Math.max(r,1)}(s,t,r);if(a>0){let e,n;const i=a>1?Math.round((l-o)/(a-1)):null;for(Mb(t,c,d,bx(i)?0:o-i,o),e=0,n=a-1;e<n;e++)Mb(t,c,d,s[e],s[e+1]);return Mb(t,c,d,l,bx(i)?t.length:l+i),c}return Mb(t,c,d),c}function Mb(e,t,n,i,r){const s=kx(i,0),a=Math.min(kx(r,e.length),e.length);let o,l,c,d=0;for(n=Math.ceil(n),r&&(o=r-i,n=o/Math.floor(o/n)),c=s;c<0;)d++,c=Math.round(s+d*n);for(l=Math.max(s,0);l<a;l++)l===c&&(t.push(e[l]),d++,c=Math.round(s+d*n))}(0,Pe.A)(Eb,"defaults",{}),(0,Pe.A)(Eb,"defaultRoutes",void 0);const Db=(e,t,n)=>"top"===t||"left"===t?e[t]+n:e[t]-n,Ib=(e,t)=>Math.min(t||e,e);function Pb(e,t){const n=[],i=e.length/t,r=e.length;let s=0;for(;s<r;s+=i)n.push(e[Math.floor(s)]);return n}function Rb(e,t,n){const i=e.ticks.length,r=Math.min(t,i-1),s=e._startPixel,a=e._endPixel,o=1e-6;let l,c=e.getPixelForTick(r);if(!(n&&(l=1===i?Math.max(c-s,a-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(r-1))/2,c+=r<t?l:-l,c<s-o||c>a+o)))return c}function Lb(e){return e.drawTicks?e.tickLength:0}function zb(e,t){if(!e.display)return 0;const n=pv(e.font,t),i=hv(e.padding);return(wx(e.text)?e.text.length:1)*n.lineHeight+i.height}function Ob(e,t,n){let i=by(e);return(n&&"right"!==t||!n&&"right"===t)&&(i=(e=>"left"===e?"right":"right"===e?"left":e)(i)),i}class Fb extends Eb{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:i}=this;return e=Sx(e,Number.POSITIVE_INFINITY),t=Sx(t,Number.NEGATIVE_INFINITY),n=Sx(n,Number.POSITIVE_INFINITY),i=Sx(i,Number.NEGATIVE_INFINITY),{min:Sx(e,n),max:Sx(t,i),minDefined:Nx(e),maxDefined:Nx(t)}}getMinMax(e){let t,{min:n,max:i,minDefined:r,maxDefined:s}=this.getUserBounds();if(r&&s)return{min:n,max:i};const a=this.getMatchingVisibleMetas();for(let o=0,l=a.length;o<l;++o)t=a[o].controller.getMinMax(this,e),r||(n=Math.min(n,t.min)),s||(i=Math.max(i,t.max));return n=s&&n>i?i:n,i=r&&n>i?n:i,{min:Sx(n,Sx(i,n)),max:Sx(i,Sx(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.chartArea;return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Cx(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:i,grace:r,ticks:s}=this.options,a=s.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,n){const{min:i,max:r}=e,s=Tx(t,(r-i)/2),a=(e,t)=>n&&0===e?0:e+t;return{min:a(i,-Math.abs(s)),max:a(r,s)}}(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const o=a<this.ticks.length;this._convertTicksToLabels(o?Pb(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||"auto"===s.source)&&(this.ticks=Ab(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),o&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,n=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,n=!n),this._startPixel=e,this._endPixel=t,this._reversePixels=n,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Cx(this.options.afterUpdate,[this])}beforeSetDimensions(){Cx(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Cx(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Cx(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Cx(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,i,r;for(n=0,i=e.length;n<i;n++)r=e[n],r.label=Cx(t.callback,[r.value,n,e],this)}afterTickToLabelConversion(){Cx(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Cx(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=Ib(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,r=t.maxRotation;let s,a,o,l=i;if(!this._isVisible()||!t.display||i>=r||n<=1||!this.isHorizontal())return void(this.labelRotation=i);const c=this._getLabelSizes(),d=c.widest.width,u=c.highest.height,h=uy(this.chart.width-d,0,this.maxWidth);s=e.offset?this.maxWidth/n:h/(n-1),d+6>s&&(s=h/(n-(e.offset?.5:1)),a=this.maxHeight-Lb(e.grid)-t.padding-zb(e.title,this.chart.options.font),o=Math.sqrt(d*d+u*u),l=ry(Math.min(Math.asin(uy((c.highest.height+6)/s,-1,1)),Math.asin(uy(a/o,-1,1))-Math.asin(uy(u/o,-1,1)))),l=Math.max(i,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){Cx(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Cx(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:i,grid:r}}=this,s=this._isVisible(),a=this.isHorizontal();if(s){const s=zb(i,t.options.font);if(a?(e.width=this.maxWidth,e.height=Lb(r)+s):(e.height=this.maxHeight,e.width=Lb(r)+s),n.display&&this.ticks.length){const{first:t,last:i,widest:r,highest:s}=this._getLabelSizes(),o=2*n.padding,l=iy(this.labelRotation),c=Math.cos(l),d=Math.sin(l);if(a){const t=n.mirror?0:d*r.width+c*s.height;e.height=Math.min(this.maxHeight,e.height+t+o)}else{const t=n.mirror?0:c*r.width+d*s.height;e.width=Math.min(this.maxWidth,e.width+t+o)}this._calculatePadding(t,i,d,c)}}this._handleMargins(),a?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,i){const{ticks:{align:r,padding:s},position:a}=this.options,o=0!==this.labelRotation,l="top"!==a&&"x"===this.axis;if(this.isHorizontal()){const a=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,u=0;o?l?(d=i*e.width,u=n*t.height):(d=n*e.height,u=i*t.width):"start"===r?u=t.width:"end"===r?d=e.width:"inner"!==r&&(d=e.width/2,u=t.width/2),this.paddingLeft=Math.max((d-a+s)*this.width/(this.width-a),0),this.paddingRight=Math.max((u-c+s)*this.width/(this.width-c),0)}else{let n=t.height/2,i=e.height/2;"start"===r?(n=0,i=e.height):"end"===r&&(n=t.height,i=0),this.paddingTop=n+s,this.paddingBottom=i+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Cx(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,n=e.length;t<n;t++)bx(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=Pb(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:i,_longestTextCache:r}=this,s=[],a=[],o=Math.floor(t/Ib(t,n));let l,c,d,u,h,p,m,f,g,x,y,v=0,_=0;for(l=0;l<t;l+=o){if(u=e[l].label,h=this._resolveTickFontOptions(l),i.font=p=h.string,m=r[p]=r[p]||{data:{},gc:[]},f=h.lineHeight,g=x=0,bx(u)||wx(u)){if(wx(u))for(c=0,d=u.length;c<d;++c)y=u[c],bx(y)||wx(y)||(g=qy(i,m.data,m.gc,g,y),x+=f)}else g=qy(i,m.data,m.gc,g,u),x=f;s.push(g),a.push(x),v=Math.max(g,v),_=Math.max(x,_)}!function(e,t){Ex(e,e=>{const n=e.gc,i=n.length/2;let r;if(i>t){for(r=0;r<i;++r)delete e.data[n[r]];n.splice(0,i)}})}(r,t);const b=s.indexOf(v),w=a.indexOf(_),j=e=>({width:s[e]||0,height:a[e]||0});return{first:j(0),last:j(t-1),widest:j(b),highest:j(w),widths:s,heights:a}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return function(e){return uy(e,-32768,32767)}(this._alignToPixels?Gy(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=function(e,t,n){return fv(e,{tick:n,index:t,type:"tick"})}(this.getContext(),e,n))}return this.$context||(this.$context=function(e,t){return fv(e,{scale:t,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=iy(this.labelRotation),n=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),r=this._getLabelSizes(),s=e.autoSkipPadding||0,a=r?r.widest.width+s:0,o=r?r.highest.height+s:0;return this.isHorizontal()?o*n>a*i?a/n:o/i:o*i<a*n?o/n:a/i}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,i=this.options,{grid:r,position:s,border:a}=i,o=r.offset,l=this.isHorizontal(),c=this.ticks.length+(o?1:0),d=Lb(r),u=[],h=a.setContext(this.getContext()),p=h.display?h.width:0,m=p/2,f=function(e){return Gy(n,e,p)};let g,x,y,v,_,b,w,j,N,S,k,T;if("top"===s)g=f(this.bottom),b=this.bottom-d,j=g-m,S=f(e.top)+m,T=e.bottom;else if("bottom"===s)g=f(this.top),S=e.top,T=f(e.bottom)-m,b=g+m,j=this.top+d;else if("left"===s)g=f(this.right),_=this.right-d,w=g-m,N=f(e.left)+m,k=e.right;else if("right"===s)g=f(this.left),N=e.left,k=f(e.right)-m,_=g+m,w=this.left+d;else if("x"===t){if("center"===s)g=f((e.top+e.bottom)/2+.5);else if(jx(s)){const e=Object.keys(s)[0],t=s[e];g=f(this.chart.scales[e].getPixelForValue(t))}S=e.top,T=e.bottom,b=g+m,j=b+d}else if("y"===t){if("center"===s)g=f((e.left+e.right)/2);else if(jx(s)){const e=Object.keys(s)[0],t=s[e];g=f(this.chart.scales[e].getPixelForValue(t))}_=g-m,w=_-d,N=e.left,k=e.right}const C=kx(i.ticks.maxTicksLimit,c),E=Math.max(1,Math.ceil(c/C));for(x=0;x<c;x+=E){const e=this.getContext(x),t=r.setContext(e),i=a.setContext(e),s=t.lineWidth,c=t.color,d=i.dash||[],h=i.dashOffset,p=t.tickWidth,m=t.tickColor,f=t.tickBorderDash||[],g=t.tickBorderDashOffset;y=Rb(this,x,o),void 0!==y&&(v=Gy(n,y,s),l?_=w=N=k=v:b=j=S=T=v,u.push({tx1:_,ty1:b,tx2:w,ty2:j,x1:N,y1:S,x2:k,y2:T,width:s,color:c,borderDash:d,borderDashOffset:h,tickWidth:p,tickColor:m,tickBorderDash:f,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,u}_computeLabelItems(e){const t=this.axis,n=this.options,{position:i,ticks:r}=n,s=this.isHorizontal(),a=this.ticks,{align:o,crossAlign:l,padding:c,mirror:d}=r,u=Lb(n.grid),h=u+c,p=d?-c:h,m=-iy(this.labelRotation),f=[];let g,x,y,v,_,b,w,j,N,S,k,T,C="middle";if("top"===i)b=this.bottom-p,w=this._getXAxisLabelAlignment();else if("bottom"===i)b=this.top+p,w=this._getXAxisLabelAlignment();else if("left"===i){const e=this._getYAxisLabelAlignment(u);w=e.textAlign,_=e.x}else if("right"===i){const e=this._getYAxisLabelAlignment(u);w=e.textAlign,_=e.x}else if("x"===t){if("center"===i)b=(e.top+e.bottom)/2+h;else if(jx(i)){const e=Object.keys(i)[0],t=i[e];b=this.chart.scales[e].getPixelForValue(t)+h}w=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===i)_=(e.left+e.right)/2-h;else if(jx(i)){const e=Object.keys(i)[0],t=i[e];_=this.chart.scales[e].getPixelForValue(t)}w=this._getYAxisLabelAlignment(u).textAlign}"y"===t&&("start"===o?C="top":"end"===o&&(C="bottom"));const E=this._getLabelSizes();for(g=0,x=a.length;g<x;++g){y=a[g],v=y.label;const e=r.setContext(this.getContext(g));j=this.getPixelForTick(g)+r.labelOffset,N=this._resolveTickFontOptions(g),S=N.lineHeight,k=wx(v)?v.length:1;const t=k/2,n=e.color,o=e.textStrokeColor,c=e.textStrokeWidth;let u,h=w;if(s?(_=j,"inner"===w&&(h=g===x-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),T="top"===i?"near"===l||0!==m?-k*S+S/2:"center"===l?-E.highest.height/2-t*S+S:-E.highest.height+S/2:"near"===l||0!==m?S/2:"center"===l?E.highest.height/2-t*S:E.highest.height-k*S,d&&(T*=-1),0===m||e.showLabelBackdrop||(_+=S/2*Math.sin(m))):(b=j,T=(1-k)*S/2),e.showLabelBackdrop){const t=hv(e.backdropPadding),n=E.heights[g],i=E.widths[g];let r=T-t.top,s=0-t.left;switch(C){case"middle":r-=n/2;break;case"bottom":r-=n}switch(w){case"center":s-=i/2;break;case"right":s-=i;break;case"inner":g===x-1?s-=i:g>0&&(s-=i/2)}u={left:s,top:r,width:i+t.width,height:n+t.height,color:e.backdropColor}}f.push({label:v,font:N,textOffset:T,options:{rotation:m,color:n,strokeColor:o,strokeWidth:c,textAlign:h,textBaseline:C,translation:[_,b],backdrop:u}})}return f}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-iy(this.labelRotation))return"top"===e?"left":"right";let n="center";return"start"===t.align?n="left":"end"===t.align?n="right":"inner"===t.align&&(n="inner"),n}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:i,padding:r}}=this.options,s=e+r,a=this._getLabelSizes().widest.width;let o,l;return"left"===t?i?(l=this.right+r,"near"===n?o="left":"center"===n?(o="center",l+=a/2):(o="right",l+=a)):(l=this.right-s,"near"===n?o="right":"center"===n?(o="center",l-=a/2):(o="left",l=this.left)):"right"===t?i?(l=this.left+r,"near"===n?o="right":"center"===n?(o="center",l-=a/2):(o="left",l-=a)):(l=this.left+s,"near"===n?o="left":"center"===n?(o="center",l+=a/2):(o="right",l=this.right)):o="right",{textAlign:o,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:i,width:r,height:s}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,i,r,s),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const n=this.ticks.findIndex(t=>t.value===e);if(n>=0){return t.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(e){const t=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let r,s;const a=(e,t,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.stroke(),n.restore())};if(t.display)for(r=0,s=i.length;r<s;++r){const e=i[r];t.drawOnChartArea&&a({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&a({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:i}}=this,r=n.setContext(this.getContext()),s=n.display?r.width:0;if(!s)return;const a=i.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let l,c,d,u;this.isHorizontal()?(l=Gy(e,this.left,s)-s/2,c=Gy(e,this.right,a)+a/2,d=u=o):(d=Gy(e,this.top,s)-s/2,u=Gy(e,this.bottom,a)+a/2,l=c=o),t.save(),t.lineWidth=r.width,t.strokeStyle=r.color,t.beginPath(),t.moveTo(l,d),t.lineTo(c,u),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,n=this._computeLabelArea();n&&Qy(t,n);const i=this.getLabelItems(e);for(const r of i){const e=r.options,n=r.font;iv(t,r.label,0,r.textOffset,n,e)}n&&Jy(t)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:i}}=this;if(!n.display)return;const r=pv(n.font),s=hv(n.padding),a=n.align;let o=r.lineHeight/2;"bottom"===t||"center"===t||jx(t)?(o+=s.bottom,wx(n.text)&&(o+=r.lineHeight*(n.text.length-1))):o+=s.top;const{titleX:l,titleY:c,maxWidth:d,rotation:u}=function(e,t,n,i){const{top:r,left:s,bottom:a,right:o,chart:l}=e,{chartArea:c,scales:d}=l;let u,h,p,m=0;const f=a-r,g=o-s;if(e.isHorizontal()){if(h=wy(i,s,o),jx(n)){const e=Object.keys(n)[0],i=n[e];p=d[e].getPixelForValue(i)+f-t}else p="center"===n?(c.bottom+c.top)/2+f-t:Db(e,n,t);u=o-s}else{if(jx(n)){const e=Object.keys(n)[0],i=n[e];h=d[e].getPixelForValue(i)-g+t}else h="center"===n?(c.left+c.right)/2-g+t:Db(e,n,t);p=wy(i,a,r),m="left"===n?-Zx:Zx}return{titleX:h,titleY:p,maxWidth:u,rotation:m}}(this,o,t,a);iv(e,n.text,0,0,r,{color:n.color,maxWidth:d,rotation:u,textAlign:Ob(a,t,i),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=kx(e.grid&&e.grid.z,-1),i=kx(e.border&&e.border.z,0);return this._isVisible()&&this.draw===Fb.prototype.draw?[{z:n,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[];let r,s;for(r=0,s=t.length;r<s;++r){const s=t[r];s[n]!==this.id||e&&s.type!==e||i.push(s)}return i}_resolveTickFontOptions(e){return pv(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Bb{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;(function(e){return"id"in e&&"defaults"in e})(t)&&(n=this.register(t));const i=this.items,r=e.id,s=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+e);return r in i||(i[r]=e,function(e,t,n){const i=Px(Object.create(null),[n?Hy.get(n):{},Hy.get(t),e.defaults]);Hy.set(t,i),e.defaultRoutes&&function(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),r=i.pop(),s=[e].concat(i).join("."),a=t[n].split("."),o=a.pop(),l=a.join(".");Hy.route(s,r,l,o)})}(t,e.defaultRoutes);e.descriptors&&Hy.describe(t,e.descriptors)}(e,s,n),this.override&&Hy.override(e.id,e.overrides)),s}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,i=this.scope;n in t&&delete t[n],i&&n in Hy[i]&&(delete Hy[i][n],this.override&&delete Oy[n])}}class Vb{constructor(){this.controllers=new Bb(S_,"datasets",!0),this.elements=new Bb(Eb,"elements"),this.plugins=new Bb(Object,"plugins"),this.scales=new Bb(Fb,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t)}remove(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t)}addControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.controllers)}addElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.elements)}addPlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.plugins)}addScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.controllers)}removeElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.elements)}removePlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.plugins)}removeScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.scales)}_each(e,t,n){[...t].forEach(t=>{const i=n||this._getRegistryForType(t);n||i.isForType(t)||i===this.plugins&&t.id?this._exec(e,i,t):Ex(t,t=>{const i=n||this._getRegistryForType(t);this._exec(e,i,t)})})}_exec(e,t,n){const i=Fx(e);Cx(n["before"+i],[],n),t[e](n),Cx(n["after"+i],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const i=t.get(e);if(void 0===i)throw new Error('"'+e+'" is not a registered '+n+".");return i}}var Ub=new Vb;class Hb{constructor(){this._init=[]}notify(e,t,n,i){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const r=i?this._descriptors(e).filter(i):this._descriptors(e),s=this._notify(r,e,t,n);return"afterDestroy"===t&&(this._notify(r,e,"stop"),this._notify(this._init,e,"uninstall")),s}_notify(e,t,n,i){i=i||{};for(const r of e){const e=r.plugin;if(!1===Cx(e[n],[t,i,r.options],e)&&i.cancelable)return!1}return!0}invalidate(){bx(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,i=kx(n.options&&n.options.plugins,{}),r=function(e){const t={},n=[],i=Object.keys(Ub.plugins.items);for(let s=0;s<i.length;s++)n.push(Ub.getPlugin(i[s]));const r=e.plugins||[];for(let s=0;s<r.length;s++){const e=r[s];-1===n.indexOf(e)&&(n.push(e),t[e.id]=!0)}return{plugins:n,localIds:t}}(n);return!1!==i||t?function(e,t,n,i){let{plugins:r,localIds:s}=t;const a=[],o=e.getContext();for(const l of r){const t=l.id,r=qb(n[t],i);null!==r&&a.push({plugin:l,options:Wb(e.config,{plugin:l,local:s[t]},r,o)})}return a}(e,r,i,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,i=(e,t)=>e.filter(e=>!t.some(t=>e.plugin.id===t.plugin.id));this._notify(i(t,n),e,"stop"),this._notify(i(n,t),e,"start")}}function qb(e,t){return t||!1!==e?!0===e?{}:e:null}function Wb(e,t,n,i){let{plugin:r,local:s}=t;const a=e.pluginScopeKeys(r),o=e.getOptionScopes(n,a);return s&&r.defaults&&o.push(r.defaults),e.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Gb(e,t){const n=Hy.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function Yb(e){if("x"===e||"y"===e||"r"===e)return e}function Zb(e){return"top"===e||"bottom"===e?"x":"left"===e||"right"===e?"y":void 0}function Xb(e){if(Yb(e))return e;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n){const t=r.axis||Zb(r.position)||e.length>1&&Yb(e[0].toLowerCase());if(t)return t}throw new Error("Cannot determine type of '".concat(e,"' axis. Please provide 'axis' or 'position' option."))}function Kb(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function Qb(e,t){const n=Oy[e.type]||{scales:{}},i=t.scales||{},r=Gb(e.type,t),s=Object.create(null);return Object.keys(i).forEach(t=>{const a=i[t];if(!jx(a))return console.error("Invalid scale configuration for scale: ".concat(t));if(a._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(t));const o=Xb(t,a,function(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(t=>t.xAxisID===e||t.yAxisID===e);if(n.length)return Kb(e,"x",n[0])||Kb(e,"y",n[0])}return{}}(t,e),Hy.scales[a.type]),l=function(e,t){return e===t?"_index_":"_value_"}(o,r),c=n.scales||{};s[t]=Rx(Object.create(null),[{axis:o},a,c[o],c[l]])}),e.data.datasets.forEach(n=>{const r=n.type||e.type,a=n.indexAxis||Gb(r,t),o=(Oy[r]||{}).scales||{};Object.keys(o).forEach(e=>{const t=function(e,t){let n=e;return"_index_"===e?n=t:"_value_"===e&&(n="x"===t?"y":"x"),n}(e,a),r=n[t+"AxisID"]||t;s[r]=s[r]||Object.create(null),Rx(s[r],[{axis:t},i[r],o[e]])})}),Object.keys(s).forEach(e=>{const t=s[e];Rx(t,[Hy.scales[t.type],Hy.scale])}),s}function Jb(e){const t=e.options||(e.options={});t.plugins=kx(t.plugins,{}),t.scales=Qb(e,t)}function $b(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const ew=new Map,tw=new Set;function nw(e,t){let n=ew.get(e);return n||(n=t(),ew.set(e,n),tw.add(n)),n}const iw=(e,t,n)=>{const i=Ox(t,n);void 0!==i&&e.add(i)};class rw{constructor(e){this._config=function(e){return(e=e||{}).data=$b(e.data),Jb(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=$b(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),Jb(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return nw(e,()=>[["datasets.".concat(e),""]])}datasetAnimationScopeKeys(e,t){return nw("".concat(e,".transition.").concat(t),()=>[["datasets.".concat(e,".transitions.").concat(t),"transitions.".concat(t)],["datasets.".concat(e),""]])}datasetElementScopeKeys(e,t){return nw("".concat(e,"-").concat(t),()=>[["datasets.".concat(e,".elements.").concat(t),"datasets.".concat(e),"elements.".concat(t),""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return nw("".concat(n,"-plugin-").concat(t),()=>[["plugins.".concat(t),...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let i=n.get(e);return i&&!t||(i=new Map,n.set(e,i)),i}getOptionScopes(e,t,n){const{options:i,type:r}=this,s=this._cachedScopes(e,n),a=s.get(t);if(a)return a;const o=new Set;t.forEach(t=>{e&&(o.add(e),t.forEach(t=>iw(o,e,t))),t.forEach(e=>iw(o,i,e)),t.forEach(e=>iw(o,Oy[r]||{},e)),t.forEach(e=>iw(o,Hy,e)),t.forEach(e=>iw(o,Fy,e))});const l=Array.from(o);return 0===l.length&&l.push(Object.create(null)),tw.has(t)&&s.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,Oy[t]||{},Hy.datasets[t]||{},{type:t},Hy,Fy]}resolveNamedOptions(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const r={$shared:!0},{resolver:s,subPrefixes:a}=sw(this._resolverCache,e,i);let o=s;if(function(e,t){const{isScriptable:n,isIndexable:i}=yv(e);for(const r of t){const t=n(r),s=i(r),a=(s||t)&&e[r];if(t&&(Vx(a)||aw(a))||s&&wx(a))return!0}return!1}(s,t)){r.$shared=!1;o=xv(s,n=Vx(n)?n():n,this.createResolver(e,n,a))}for(const l of t)r[l]=o[l];return r}createResolver(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],i=arguments.length>3?arguments[3]:void 0;const{resolver:r}=sw(this._resolverCache,e,n);return jx(t)?xv(r,t,void 0,i):r}}function sw(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const r=n.join();let s=i.get(r);if(!s){s={resolver:gv(t,n),subPrefixes:n.filter(e=>!e.toLowerCase().includes("hover"))},i.set(r,s)}return s}const aw=e=>jx(e)&&Object.getOwnPropertyNames(e).some(t=>Vx(e[t]));const ow=["top","bottom","left","right","chartArea"];function lw(e,t){return"top"===e||"bottom"===e||-1===ow.indexOf(e)&&"x"===t}function cw(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function dw(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Cx(n&&n.onComplete,[e],t)}function uw(e){const t=e.chart,n=t.options.animation;Cx(n&&n.onProgress,[e],t)}function hw(e){return zv()&&"string"===typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const pw={},mw=e=>{const t=hw(e);return Object.values(pw).filter(e=>e.canvas===t).pop()};function fw(e,t,n){const i=Object.keys(e);for(const r of i){const i=+r;if(i>=t){const s=e[r];delete e[r],(n>0||i>t)&&(e[i+n]=s)}}}function gw(e,t,n){return e.options.clip?e[n]:t[n]}class xw{static register(){Ub.add(...arguments),yw()}static unregister(){Ub.remove(...arguments),yw()}constructor(e,t){const n=this.config=new rw(t),i=hw(e),r=mw(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const s=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(e){return!zv()||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?pb:Cb}(i)),this.platform.updateConfig(n);const a=this.platform.acquireContext(i,s.aspectRatio),o=a&&a.canvas,l=o&&o.height,c=o&&o.width;this.id=_x(),this.ctx=a,this.canvas=o,this.width=c,this.height=l,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Hb,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let n;return function(){for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return t?(clearTimeout(n),n=setTimeout(e,t,r)):e.apply(this,r),t}}(e=>this.update(e),s.resizeDelay||0),this._dataChanges=[],pw[this.id]=this,a&&o?(c_.listen(this,"complete",dw),c_.listen(this,"progress",uw),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:i,_aspectRatio:r}=this;return bx(e)?t&&r?r:i?n/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Ub}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Gv(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Yy(this.canvas,this.ctx),this}stop(){return c_.stop(this),this}resize(e,t){c_.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,i=this.canvas,r=n.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(i,e,t,r),a=n.devicePixelRatio||this.platform.getDevicePixelRatio(),o=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,Gv(this,a,!0)&&(this.notifyPlugins("resize",{size:s}),Cx(n.onResize,[this,s],this),this.attached&&this._doResize(o)&&this.render())}ensureScalesHaveIDs(){Ex(this.options.scales||{},(e,t)=>{e.id=t})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,i=Object.keys(n).reduce((e,t)=>(e[t]=!1,e),{});let r=[];t&&(r=r.concat(Object.keys(t).map(e=>{const n=t[e],i=Xb(e,n),r="r"===i,s="x"===i;return{options:n,dposition:r?"chartArea":s?"bottom":"left",dtype:r?"radialLinear":s?"category":"linear"}}))),Ex(r,t=>{const r=t.options,s=r.id,a=Xb(s,r),o=kx(r.type,t.dtype);void 0!==r.position&&lw(r.position,a)===lw(t.dposition)||(r.position=t.dposition),i[s]=!0;let l=null;if(s in n&&n[s].type===o)l=n[s];else{l=new(Ub.getScale(o))({id:s,type:o,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(r,e)}),Ex(i,(e,t)=>{e||delete n[t]}),Ex(n,e=>{ub.configure(this,e,e.options),ub.addBox(this,e)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((e,t)=>e.index-t.index),n>t){for(let e=t;e<n;++e)this._destroyDatasetMeta(e);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(cw("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((e,n)=>{0===t.filter(t=>t===e._dataset).length&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,i;for(this._removeUnreferencedMetasets(),n=0,i=t.length;n<i;n++){const i=t[n];let r=this.getDatasetMeta(n);const s=i.type||this.config.type;if(r.type&&r.type!==s&&(this._destroyDatasetMeta(n),r=this.getDatasetMeta(n)),r.type=s,r.indexAxis=i.indexAxis||Gb(s,this.options),r.order=i.order||0,r.index=n,r.label=""+i.label,r.visible=this.isDatasetVisible(n),r.controller)r.controller.updateIndex(n),r.controller.linkScales();else{const t=Ub.getController(s),{datasetElementType:i,dataElementType:a}=Hy.datasets[s];Object.assign(t,{dataElementType:Ub.getElement(a),datasetElementType:i&&Ub.getElement(i)}),r.controller=new t(this,n),e.push(r.controller)}}return this._updateMetasets(),e}_resetElements(){Ex(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:e}=this.getDatasetMeta(l),t=!i&&-1===r.indexOf(e);e.buildOrUpdateElements(t),s=Math.max(+e.getMaxOverflow(),s)}s=this._minPadding=n.layout.autoPadding?s:0,this._updateLayout(s),i||Ex(r,e=>{e.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(cw("z","_idx"));const{_active:a,_lastEvent:o}=this;o?this._eventHandler(o,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){Ex(this.scales,e=>{ub.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);Ux(t,n)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:i,count:r}of t){fw(e,i,"_removeElements"===n?-r:r)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=t=>new Set(e.filter(e=>e[0]===t).map((e,t)=>t+","+e.splice(1).join(","))),i=n(0);for(let r=1;r<t;r++)if(!Ux(i,n(r)))return;return Array.from(i).map(e=>e.split(",")).map(e=>({method:e[1],start:+e[2],count:+e[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;ub.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],Ex(this.boxes,e=>{n&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))},this),this._layers.forEach((e,t)=>{e._idx=t}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,Vx(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),i={meta:n,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(c_.has(this)?this.attached&&!c_.running(this)&&c_.start(this):(this.draw(),dw({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resize(e,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let i,r;for(i=0,r=t.length;i<r;++i){const r=t[i];e&&!r.visible||n.push(r)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n=e._clip,i=!n.disabled,r=function(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:gw(n,t,"left"),right:gw(n,t,"right"),top:gw(i,t,"top"),bottom:gw(i,t,"bottom")}:t}(e,this.chartArea),s={meta:e,index:e.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",s)&&(i&&Qy(t,{left:!1===n.left?0:r.left-n.left,right:!1===n.right?this.width:r.right+n.right,top:!1===n.top?0:r.top-n.top,bottom:!1===n.bottom?this.height:r.bottom+n.bottom}),e.controller.draw(),i&&Jy(t),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(e){return Ky(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,i){const r=J_.modes[t];return"function"===typeof r?r(this,e,n,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let i=n.filter(e=>e&&e._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(i)),i}getContext(){return this.$context||(this.$context=fv(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return"boolean"===typeof n.hidden?!n.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const i=n?"show":"hide",r=this.getDatasetMeta(e),s=r.controller._resolveAnimations(void 0,i);Bx(t)?(r.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),s.update(r,{visible:n}),this.update(t=>t.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),c_.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),Yy(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete pw[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(n,i)=>{t.addEventListener(this,n,i),e[n]=i},i=(e,t,n)=>{e.offsetX=t,e.offsetY=n,this._eventHandler(e)};Ex(this.options.events,e=>n(e,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(n,i)=>{t.addEventListener(this,n,i),e[n]=i},i=(n,i)=>{e[n]&&(t.removeEventListener(this,n,i),delete e[n])},r=(e,t)=>{this.canvas&&this.resize(e,t)};let s;const a=()=>{i("attach",a),this.attached=!0,this.resize(),n("resize",r),n("detach",s)};s=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),n("attach",a)},t.isAttached(this.canvas)?a():s()}unbindEvents(){Ex(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Ex(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const i=n?"set":"remove";let r,s,a,o;for("dataset"===t&&(r=this.getDatasetMeta(e[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),a=0,o=e.length;a<o;++a){s=e[a];const t=s&&this.getDatasetMeta(s.datasetIndex).controller;t&&t[i+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(e=>{let{datasetIndex:t,index:n}=e;const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[n],index:n}});!Ax(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return 1===this._plugins._cache.filter(t=>t.plugin.id===e).length}_updateHoverStyles(e,t,n){const i=this.options.hover,r=(e,t)=>e.filter(e=>!t.some(t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)),s=r(t,e),a=n?e:r(e,t);s.length&&this.updateHoverStyle(s,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},i=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",n,i))return;const r=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,i),(r||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:i=[],options:r}=this,s=t,a=this._getActiveElements(e,i,n,s),o=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,n,i){return n&&"mouseout"!==e.type?i?t:e:null}(e,this._lastEvent,n,o);n&&(this._lastEvent=null,Cx(r.onHover,[e,a,this],this),o&&Cx(r.onClick,[e,a,this],this));const c=!Ax(a,i);return(c||t)&&(this._active=a,this._updateHoverStyles(a,i,t)),this._lastEvent=l,c}_getActiveElements(e,t,n,i){if("mouseout"===e.type)return[];if(!n)return t;const r=this.options.hover;return this.getElementsAtEventForMode(e,r.mode,r,i)}}function yw(){return Ex(xw.instances,e=>e._plugins.invalidate())}function vw(e,t,n,i){const r=function(e){return cv(e,["outerStart","outerEnd","innerStart","innerEnd"])}(e.options.borderRadius),s=(n-t)/2,a=Math.min(s,i*t/2),o=e=>{const t=(n-Math.min(s,e))*i/2;return uy(e,0,Math.min(s,t))};return{outerStart:o(r.outerStart),outerEnd:o(r.outerEnd),innerStart:uy(r.innerStart,0,a),innerEnd:uy(r.innerEnd,0,a)}}function _w(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function bw(e,t,n,i,r,s){const{x:a,y:o,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+n-c,0),h=d>0?d+i+n+c:0;let p=0;const m=r-l;if(i){const e=((d>0?d-i:0)+(u>0?u-i:0))/2;p=(m-(0!==e?m*e/(e+i):m))/2}const f=(m-Math.max(.001,m*u-n/Hx)/u)/2,g=l+f+p,x=r-f-p,{outerStart:y,outerEnd:v,innerStart:_,innerEnd:b}=vw(t,h,u,x-g),w=u-y,j=u-v,N=g+y/w,S=x-v/j,k=h+_,T=h+b,C=g+_/k,E=x-b/T;if(e.beginPath(),s){const t=(N+S)/2;if(e.arc(a,o,u,N,t),e.arc(a,o,u,t,S),v>0){const t=_w(j,S,a,o);e.arc(t.x,t.y,v,S,x+Zx)}const n=_w(T,x,a,o);if(e.lineTo(n.x,n.y),b>0){const t=_w(T,E,a,o);e.arc(t.x,t.y,b,x+Zx,E+Math.PI)}const i=(x-b/h+(g+_/h))/2;if(e.arc(a,o,h,x-b/h,i,!0),e.arc(a,o,h,i,g+_/h,!0),_>0){const t=_w(k,C,a,o);e.arc(t.x,t.y,_,C+Math.PI,g-Zx)}const r=_w(w,g,a,o);if(e.lineTo(r.x,r.y),y>0){const t=_w(w,N,a,o);e.arc(t.x,t.y,y,g-Zx,N)}}else{e.moveTo(a,o);const t=Math.cos(N)*u+a,n=Math.sin(N)*u+o;e.lineTo(t,n);const i=Math.cos(S)*u+a,r=Math.sin(S)*u+o;e.lineTo(i,r)}e.closePath()}function ww(e,t,n,i,r){const{fullCircles:s,startAngle:a,circumference:o,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h}=l,p="inner"===l.borderAlign;if(!c)return;e.setLineDash(u||[]),e.lineDashOffset=h,p?(e.lineWidth=2*c,e.lineJoin=d||"round"):(e.lineWidth=c,e.lineJoin=d||"bevel");let m=t.endAngle;if(s){bw(e,t,n,i,m,r);for(let t=0;t<s;++t)e.stroke();isNaN(o)||(m=a+(o%qx||qx))}p&&function(e,t,n){const{startAngle:i,pixelMargin:r,x:s,y:a,outerRadius:o,innerRadius:l}=t;let c=r/o;e.beginPath(),e.arc(s,a,o,i-c,n+c),l>r?(c=r/l,e.arc(s,a,l,n+c,i-c,!0)):e.arc(s,a,r,n+Zx,i-Zx),e.closePath(),e.clip()}(e,t,m),s||(bw(e,t,n,i,m,r),e.stroke())}(0,Pe.A)(xw,"defaults",Hy),(0,Pe.A)(xw,"instances",pw),(0,Pe.A)(xw,"overrides",Oy),(0,Pe.A)(xw,"registry",Ub),(0,Pe.A)(xw,"version","4.4.1"),(0,Pe.A)(xw,"getChart",mw);class jw extends Eb{constructor(e){super(),(0,Pe.A)(this,"circumference",void 0),(0,Pe.A)(this,"endAngle",void 0),(0,Pe.A)(this,"fullCircles",void 0),(0,Pe.A)(this,"innerRadius",void 0),(0,Pe.A)(this,"outerRadius",void 0),(0,Pe.A)(this,"pixelMargin",void 0),(0,Pe.A)(this,"startAngle",void 0),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,n){const i=this.getProps(["x","y"],n),{angle:r,distance:s}=ay(i,{x:e,y:t}),{startAngle:a,endAngle:o,innerRadius:l,outerRadius:c,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),u=(this.options.spacing+this.options.borderWidth)/2,h=kx(d,o-a)>=qx||dy(r,a,o),p=hy(s,l+u,c+u);return h&&p}getCenterPoint(e){const{x:t,y:n,startAngle:i,endAngle:r,innerRadius:s,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:o,spacing:l}=this.options,c=(i+r)/2,d=(s+a+l+o)/2;return{x:t+Math.cos(c)*d,y:n+Math.sin(c)*d}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:n}=this,i=(t.offset||0)/4,r=(t.spacing||0)/2,s=t.circular;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=n>qx?Math.floor(n/qx):0,0===n||this.innerRadius<0||this.outerRadius<0)return;e.save();const a=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(a)*i,Math.sin(a)*i);const o=i*(1-Math.sin(Math.min(Hx,n||0)));e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,function(e,t,n,i,r){const{fullCircles:s,startAngle:a,circumference:o}=t;let l=t.endAngle;if(s){bw(e,t,n,i,l,r);for(let t=0;t<s;++t)e.fill();isNaN(o)||(l=a+(o%qx||qx))}bw(e,t,n,i,l,r),e.fill()}(e,this,o,r,s),ww(e,this,o,r,s),e.restore()}}function Nw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;e.lineCap=kx(n.borderCapStyle,t.borderCapStyle),e.setLineDash(kx(n.borderDash,t.borderDash)),e.lineDashOffset=kx(n.borderDashOffset,t.borderDashOffset),e.lineJoin=kx(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=kx(n.borderWidth,t.borderWidth),e.strokeStyle=kx(n.borderColor,t.borderColor)}function Sw(e,t,n){e.lineTo(n.x,n.y)}function kw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.length,{start:r=0,end:s=i-1}=n,{start:a,end:o}=t,l=Math.max(r,a),c=Math.min(s,o),d=r<a&&s<a||r>o&&s>o;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function Tw(e,t,n,i){const{points:r,options:s}=t,{count:a,start:o,loop:l,ilen:c}=kw(r,n,i),d=function(e){return e.stepped?$y:e.tension||"monotone"===e.cubicInterpolationMode?ev:Sw}(s);let u,h,p,{move:m=!0,reverse:f}=i||{};for(u=0;u<=c;++u)h=r[(o+(f?c-u:u))%a],h.skip||(m?(e.moveTo(h.x,h.y),m=!1):d(e,p,h,f,s.stepped),p=h);return l&&(h=r[(o+(f?c:0))%a],d(e,p,h,f,s.stepped)),!!l}function Cw(e,t,n,i){const r=t.points,{count:s,start:a,ilen:o}=kw(r,n,i),{move:l=!0,reverse:c}=i||{};let d,u,h,p,m,f,g=0,x=0;const y=e=>(a+(c?o-e:e))%s,v=()=>{p!==m&&(e.lineTo(g,m),e.lineTo(g,p),e.lineTo(g,f))};for(l&&(u=r[y(0)],e.moveTo(u.x,u.y)),d=0;d<=o;++d){if(u=r[y(d)],u.skip)continue;const t=u.x,n=u.y,i=0|t;i===h?(n<p?p=n:n>m&&(m=n),g=(x*g+t)/++x):(v(),e.lineTo(t,n),h=i,x=0,p=m=n),f=n}v()}function Ew(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&"monotone"!==t.cubicInterpolationMode&&!t.stepped&&!n?Cw:Tw}(0,Pe.A)(jw,"id","arc"),(0,Pe.A)(jw,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),(0,Pe.A)(jw,"defaultRoutes",{backgroundColor:"backgroundColor"}),(0,Pe.A)(jw,"descriptors",{_scriptable:!0,_indexable:e=>"borderDash"!==e});const Aw="function"===typeof Path2D;function Mw(e,t,n,i){Aw&&!t.options.segment?function(e,t,n,i){let r=t._path;r||(r=t._path=new Path2D,t.path(r,n,i)&&r.closePath()),Nw(e,t.options),e.stroke(r)}(e,t,n,i):function(e,t,n,i){const{segments:r,options:s}=t,a=Ew(t);for(const o of r)Nw(e,s,o.style),e.beginPath(),a(e,t,o,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}(e,t,n,i)}class Dw extends Eb{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const i=n.spanGaps?this._loop:this._fullLoop;Lv(this._points,n,e,i,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const n=e.points,i=e.options.spanGaps,r=n.length;if(!r)return[];const s=!!e._loop,{start:a,end:o}=function(e,t,n,i){let r=0,s=t-1;if(n&&!i)for(;r<t&&!e[r].skip;)r++;for(;r<t&&e[r].skip;)r++;for(r%=t,n&&(s+=r);s>r&&e[s%t].skip;)s--;return s%=t,{start:r,end:s}}(n,r,s,i);return s_(e,!0===i?[{start:a,end:o,loop:s}]:function(e,t,n,i){const r=e.length,s=[];let a,o=t,l=e[t];for(a=t+1;a<=n;++a){const n=e[a%r];n.skip||n.stop?l.skip||(i=!1,s.push({start:t%r,end:(a-1)%r,loop:i}),t=o=n.stop?a:null):(o=a,l.skip&&(t=a)),l=n}return null!==o&&s.push({start:t%r,end:o%r,loop:i}),s}(n,a,o<a?o+r:o,!!e._fullLoop&&0===a&&o===r-1),n,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,i=e[t],r=this.points,s=r_(this,{property:t,start:i,end:i});if(!s.length)return;const a=[],o=function(e){return e.stepped?Kv:e.tension||"monotone"===e.cubicInterpolationMode?Qv:Xv}(n);let l,c;for(l=0,c=s.length;l<c;++l){const{start:c,end:d}=s[l],u=r[c],h=r[d];if(u===h){a.push(u);continue}const p=o(u,h,Math.abs((i-u[t])/(h[t]-u[t])),n.stepped);p[t]=e[t],a.push(p)}return 1===a.length?a[0]:a}pathSegment(e,t,n){return Ew(this)(e,this,t,n)}path(e,t,n){const i=this.segments,r=Ew(this);let s=this._loop;t=t||0,n=n||this.points.length-t;for(const a of i)s&=r(e,this,a,{start:t,end:t+n-1});return!!s}draw(e,t,n,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(e.save(),Mw(e,this,n,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Iw(e,t,n,i){const r=e.options,{[n]:s}=e.getProps([n],i);return Math.abs(t-s)<r.radius+r.hitRadius}(0,Pe.A)(Dw,"id","line"),(0,Pe.A)(Dw,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),(0,Pe.A)(Dw,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),(0,Pe.A)(Dw,"descriptors",{_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e});class Pw extends Eb{constructor(e){super(),(0,Pe.A)(this,"parsed",void 0),(0,Pe.A)(this,"skip",void 0),(0,Pe.A)(this,"stop",void 0),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,n){const i=this.options,{x:r,y:s}=this.getProps(["x","y"],n);return Math.pow(e-r,2)+Math.pow(t-s,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,t){return Iw(this,e,"x",t)}inYRange(e,t){return Iw(this,e,"y",t)}getCenterPoint(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}size(e){let t=(e=e||this.options||{}).radius||0;t=Math.max(t,t&&e.hoverRadius||0);return 2*(t+(t&&e.borderWidth||0))}draw(e,t){const n=this.options;this.skip||n.radius<.1||!Ky(this,t,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,Zy(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function Rw(e,t){const{x:n,y:i,base:r,width:s,height:a}=e.getProps(["x","y","base","width","height"],t);let o,l,c,d,u;return e.horizontal?(u=a/2,o=Math.min(n,r),l=Math.max(n,r),c=i-u,d=i+u):(u=s/2,o=n-u,l=n+u,c=Math.min(i,r),d=Math.max(i,r)),{left:o,top:c,right:l,bottom:d}}function Lw(e,t,n,i){return e?0:uy(t,n,i)}function zw(e){const t=Rw(e),n=t.right-t.left,i=t.bottom-t.top,r=function(e,t,n){const i=e.options.borderWidth,r=e.borderSkipped,s=dv(i);return{t:Lw(r.top,s.top,0,n),r:Lw(r.right,s.right,0,t),b:Lw(r.bottom,s.bottom,0,n),l:Lw(r.left,s.left,0,t)}}(e,n/2,i/2),s=function(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),r=e.options.borderRadius,s=uv(r),a=Math.min(t,n),o=e.borderSkipped,l=i||jx(r);return{topLeft:Lw(!l||o.top||o.left,s.topLeft,0,a),topRight:Lw(!l||o.top||o.right,s.topRight,0,a),bottomLeft:Lw(!l||o.bottom||o.left,s.bottomLeft,0,a),bottomRight:Lw(!l||o.bottom||o.right,s.bottomRight,0,a)}}(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:s},inner:{x:t.left+r.l,y:t.top+r.t,w:n-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,s.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(r.b,r.r))}}}}function Ow(e,t,n,i){const r=null===t,s=null===n,a=e&&!(r&&s)&&Rw(e,i);return a&&(r||hy(t,a.left,a.right))&&(s||hy(n,a.top,a.bottom))}function Fw(e,t){e.rect(t.x,t.y,t.w,t.h)}function Bw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.x!==n.x?-t:0,r=e.y!==n.y?-t:0,s=(e.x+e.w!==n.x+n.w?t:0)-i,a=(e.y+e.h!==n.y+n.h?t:0)-r;return{x:e.x+i,y:e.y+r,w:e.w+s,h:e.h+a,radius:e.radius}}(0,Pe.A)(Pw,"id","point"),(0,Pe.A)(Pw,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),(0,Pe.A)(Pw,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});class Vw extends Eb{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:i}}=this,{inner:r,outer:s}=zw(this),a=(o=s.radius).topLeft||o.topRight||o.bottomLeft||o.bottomRight?rv:Fw;var o;e.save(),s.w===r.w&&s.h===r.h||(e.beginPath(),a(e,Bw(s,t,r)),e.clip(),a(e,Bw(r,-t,s)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),a(e,Bw(r,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,n){return Ow(this,e,t,n)}inXRange(e,t){return Ow(this,e,null,t)}inYRange(e,t){return Ow(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],e);return{x:r?(t+i)/2:t,y:r?n:(n+i)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}(0,Pe.A)(Vw,"id","bar"),(0,Pe.A)(Vw,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),(0,Pe.A)(Vw,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Uw=Object.freeze({__proto__:null,ArcElement:jw,BarElement:Vw,LineElement:Dw,PointElement:Pw});const Hw=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],qw=Hw.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function Ww(e){return Hw[e%Hw.length]}function Gw(e){return qw[e%qw.length]}function Yw(e){let t=0;return(n,i)=>{const r=e.getDatasetMeta(i).controller;r instanceof L_?t=function(e,t){return e.backgroundColor=e.data.map(()=>Ww(t++)),t}(n,t):r instanceof O_?t=function(e,t){return e.backgroundColor=e.data.map(()=>Gw(t++)),t}(n,t):r&&(t=function(e,t){return e.borderColor=Ww(t),e.backgroundColor=Gw(t),++t}(n,t))}}function Zw(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}var Xw={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,n){if(!n.enabled)return;const{data:{datasets:i},options:r}=e.config,{elements:s}=r;if(!n.forceOverride&&(Zw(i)||(a=r)&&(a.borderColor||a.backgroundColor)||s&&Zw(s)))return;var a;const o=Yw(e);i.forEach(o)}};function Kw(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Qw(e){e.data.datasets.forEach(e=>{Kw(e)})}var Jw={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled)return void Qw(e);const i=e.width;e.data.datasets.forEach((t,r)=>{const{_data:s,indexAxis:a}=t,o=e.getDatasetMeta(r),l=s||t.data;if("y"===mv([a,e.options.indexAxis]))return;if(!o.controller.supportsDecimation)return;const c=e.scales[o.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(e.options.parsing)return;let{start:d,count:u}=function(e,t){const n=t.length;let i,r=0;const{iScale:s}=e,{min:a,max:o,minDefined:l,maxDefined:c}=s.getUserBounds();return l&&(r=uy(my(t,s.axis,a).lo,0,n-1)),i=c?uy(my(t,s.axis,o).hi+1,r,n)-r:n-r,{start:r,count:i}}(o,l);if(u<=(n.threshold||4*i))return void Kw(t);let h;switch(bx(s)&&(t._data=l,delete t.data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(e){this._data=e}})),n.algorithm){case"lttb":h=function(e,t,n,i,r){const s=r.samples||i;if(s>=n)return e.slice(t,t+n);const a=[],o=(n-2)/(s-2);let l=0;const c=t+n-1;let d,u,h,p,m,f=t;for(a[l++]=e[f],d=0;d<s-2;d++){let i,r=0,s=0;const c=Math.floor((d+1)*o)+1+t,g=Math.min(Math.floor((d+2)*o)+1,n)+t,x=g-c;for(i=c;i<g;i++)r+=e[i].x,s+=e[i].y;r/=x,s/=x;const y=Math.floor(d*o)+1+t,v=Math.min(Math.floor((d+1)*o)+1,n)+t,{x:_,y:b}=e[f];for(h=p=-1,i=y;i<v;i++)p=.5*Math.abs((_-r)*(e[i].y-b)-(_-e[i].x)*(s-b)),p>h&&(h=p,u=e[i],m=i);a[l++]=u,f=m}return a[l++]=e[c],a}(l,d,u,i,n);break;case"min-max":h=function(e,t,n,i){let r,s,a,o,l,c,d,u,h,p,m=0,f=0;const g=[],x=t+n-1,y=e[t].x,v=e[x].x-y;for(r=t;r<t+n;++r){s=e[r],a=(s.x-y)/v*i,o=s.y;const t=0|a;if(t===l)o<h?(h=o,c=r):o>p&&(p=o,d=r),m=(f*m+s.x)/++f;else{const n=r-1;if(!bx(c)&&!bx(d)){const t=Math.min(c,d),i=Math.max(c,d);t!==u&&t!==n&&g.push(Le(Le({},e[t]),{},{x:m})),i!==u&&i!==n&&g.push(Le(Le({},e[i]),{},{x:m}))}r>0&&n!==u&&g.push(e[n]),g.push(s),l=t,f=0,h=p=o,c=d=u=r}}return g}(l,d,u,i);break;default:throw new Error("Unsupported decimation algorithm '".concat(n.algorithm,"'"))}t._decimated=h})},destroy(e){Qw(e)}};function $w(e,t,n,i){if(i)return;let r=t[e],s=n[e];return"angle"===e&&(r=cy(r),s=cy(s)),{property:e,start:r,end:s}}function ej(e,t,n){for(;t>e;t--){const e=n[t];if(!isNaN(e.x)&&!isNaN(e.y))break}return t}function tj(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function nj(e,t){let n=[],i=!1;return wx(e)?(i=!0,n=e):n=function(e,t){const{x:n=null,y:i=null}=e||{},r=t.points,s=[];return t.segments.forEach(e=>{let{start:t,end:a}=e;a=ej(t,a,r);const o=r[t],l=r[a];null!==i?(s.push({x:o.x,y:i}),s.push({x:l.x,y:i})):null!==n&&(s.push({x:n,y:o.y}),s.push({x:n,y:l.y}))}),s}(e,t),n.length?new Dw({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function ij(e){return e&&!1!==e.fill}function rj(e,t,n){let i=e[t].fill;const r=[t];let s;if(!n)return i;for(;!1!==i&&-1===r.indexOf(i);){if(!Nx(i))return i;if(s=e[i],!s)return!1;if(s.visible)return i;r.push(i),i=s.fill}return!1}function sj(e,t,n){const i=function(e){const t=e.options,n=t.fill;let i=kx(n&&n.target,n);void 0===i&&(i=!!t.backgroundColor);if(!1===i||null===i)return!1;if(!0===i)return"origin";return i}(e);if(jx(i))return!isNaN(i.value)&&i;let r=parseFloat(i);return Nx(r)&&Math.floor(r)===r?function(e,t,n,i){"-"!==e&&"+"!==e||(n=t+n);if(n===t||n<0||n>=i)return!1;return n}(i[0],t,r,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function aj(e,t,n){const i=[];for(let r=0;r<n.length;r++){const s=n[r],{first:a,last:o,point:l}=oj(s,t,"x");if(!(!l||a&&o))if(a)i.unshift(l);else if(e.push(l),!o)break}e.push(...i)}function oj(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const r=i[n],s=e.segments,a=e.points;let o=!1,l=!1;for(let c=0;c<s.length;c++){const e=s[c],t=a[e.start][n],i=a[e.end][n];if(hy(r,t,i)){o=r===t,l=r===i;break}}return{first:o,last:l,point:i}}class lj{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){const{x:i,y:r,radius:s}=this;return t=t||{start:0,end:qx},e.arc(i,r,s,t.end,t.start,!0),!n.bounds}interpolate(e){const{x:t,y:n,radius:i}=this,r=e.angle;return{x:t+Math.cos(r)*i,y:n+Math.sin(r)*i,angle:r}}}function cj(e){const{chart:t,fill:n,line:i}=e;if(Nx(n))return function(e,t){const n=e.getDatasetMeta(t),i=n&&e.isDatasetVisible(t);return i?n.dataset:null}(t,n);if("stack"===n)return function(e){const{scale:t,index:n,line:i}=e,r=[],s=i.segments,a=i.points,o=function(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let r=0;r<i.length;r++){const e=i[r];if(e.index===t)break;e.hidden||n.unshift(e.dataset)}return n}(t,n);o.push(nj({x:null,y:t.bottom},i));for(let l=0;l<s.length;l++){const e=s[l];for(let t=e.start;t<=e.end;t++)aj(r,a[t],o)}return new Dw({points:r,options:{}})}(e);if("shape"===n)return!0;const r=function(e){const t=e.scale||{};if(t.getPointPositionForValue)return function(e){const{scale:t,fill:n}=e,i=t.options,r=t.getLabels().length,s=i.reverse?t.max:t.min,a=function(e,t,n){let i;return i="start"===e?n:"end"===e?t.options.reverse?t.min:t.max:jx(e)?e.value:t.getBaseValue(),i}(n,t,s),o=[];if(i.grid.circular){const e=t.getPointPositionForValue(0,s);return new lj({x:e.x,y:e.y,radius:t.getDistanceFromCenterForValue(a)})}for(let l=0;l<r;++l)o.push(t.getPointPositionForValue(l,a));return o}(e);return function(e){const{scale:t={},fill:n}=e,i=function(e,t){let n=null;return"start"===e?n=t.bottom:"end"===e?n=t.top:jx(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}(n,t);if(Nx(i)){const e=t.isHorizontal();return{x:e?i:null,y:e?null:i}}return null}(e)}(e);return r instanceof lj?r:nj(r,i)}function dj(e,t,n){const i=cj(t),{line:r,scale:s,axis:a}=t,o=r.options,l=o.fill,c=o.backgroundColor,{above:d=c,below:u=c}=l||{};i&&r.points.length&&(Qy(e,n),function(e,t){const{line:n,target:i,above:r,below:s,area:a,scale:o}=t,l=n._loop?"angle":t.axis;e.save(),"x"===l&&s!==r&&(uj(e,i,a.top),hj(e,{line:n,target:i,color:r,scale:o,property:l}),e.restore(),e.save(),uj(e,i,a.bottom));hj(e,{line:n,target:i,color:s,scale:o,property:l}),e.restore()}(e,{line:r,target:i,above:d,below:u,area:n,scale:s,axis:a}),Jy(e))}function uj(e,t,n){const{segments:i,points:r}=t;let s=!0,a=!1;e.beginPath();for(const o of i){const{start:i,end:l}=o,c=r[i],d=r[ej(i,l,r)];s?(e.moveTo(c.x,c.y),s=!1):(e.lineTo(c.x,n),e.lineTo(c.x,c.y)),a=!!t.pathSegment(e,o,{move:a}),a?e.closePath():e.lineTo(d.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function hj(e,t){const{line:n,target:i,property:r,color:s,scale:a}=t,o=function(e,t,n){const i=e.segments,r=e.points,s=t.points,a=[];for(const o of i){let{start:e,end:i}=o;i=ej(e,i,r);const l=$w(n,r[e],r[i],o.loop);if(!t.segments){a.push({source:o,target:l,start:r[e],end:r[i]});continue}const c=r_(t,l);for(const t of c){const e=$w(n,s[t.start],s[t.end],t.loop),i=i_(o,r,e);for(const r of i)a.push({source:r,target:t,start:{[n]:tj(l,e,"start",Math.max)},end:{[n]:tj(l,e,"end",Math.min)}})}}return a}(n,i,r);for(const{source:l,target:c,start:d,end:u}of o){const{style:{backgroundColor:t=s}={}}=l,o=!0!==i;e.save(),e.fillStyle=t,pj(e,a,o&&$w(r,d,u)),e.beginPath();const h=!!n.pathSegment(e,l);let p;if(o){h?e.closePath():mj(e,i,u,r);const t=!!i.pathSegment(e,c,{move:h,reverse:!0});p=h&&t,p||mj(e,i,d,r)}e.closePath(),e.fill(p?"evenodd":"nonzero"),e.restore()}}function pj(e,t,n){const{top:i,bottom:r}=t.chart.chartArea,{property:s,start:a,end:o}=n||{};"x"===s&&(e.beginPath(),e.rect(a,i,o-a,r-i),e.clip())}function mj(e,t,n,i){const r=t.interpolate(n,i);r&&e.lineTo(r.x,r.y)}var fj={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,r=[];let s,a,o,l;for(a=0;a<i;++a)s=e.getDatasetMeta(a),o=s.dataset,l=null,o&&o.options&&o instanceof Dw&&(l={visible:e.isDatasetVisible(a),index:a,fill:sj(o,a,i),chart:e,axis:s.controller.options.indexAxis,scale:s.vScale,line:o}),s.$filler=l,r.push(l);for(a=0;a<i;++a)l=r[a],l&&!1!==l.fill&&(l.fill=rj(r,a,n.propagate))},beforeDraw(e,t,n){const i="beforeDraw"===n.drawTime,r=e.getSortedVisibleDatasetMetas(),s=e.chartArea;for(let a=r.length-1;a>=0;--a){const t=r[a].$filler;t&&(t.line.updateControlPoints(s,t.axis),i&&t.fill&&dj(e.ctx,t,s))}},beforeDatasetsDraw(e,t,n){if("beforeDatasetsDraw"!==n.drawTime)return;const i=e.getSortedVisibleDatasetMetas();for(let r=i.length-1;r>=0;--r){const t=i[r].$filler;ij(t)&&dj(e.ctx,t,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;ij(i)&&"beforeDatasetDraw"===n.drawTime&&dj(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const gj=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}};class xj extends Eb{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=Cx(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(t=>e.filter(t,this.chart.data))),e.sort&&(t=t.sort((t,n)=>e.sort(t,n,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const n=e.labels,i=pv(n.font),r=i.size,s=this._computeTitleHeight(),{boxWidth:a,itemHeight:o}=gj(n,r);let l,c;t.font=i.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(s,r,a,o)+10):(c=this.maxHeight,l=this._fitCols(s,i,a,o)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,i){const{ctx:r,maxWidth:s,options:{labels:{padding:a}}}=this,o=this.legendHitBoxes=[],l=this.lineWidths=[0],c=i+a;let d=e;r.textAlign="left",r.textBaseline="middle";let u=-1,h=-c;return this.legendItems.forEach((e,p)=>{const m=n+t/2+r.measureText(e.text).width;(0===p||l[l.length-1]+m+2*a>s)&&(d+=c,l[l.length-(p>0?0:1)]=0,h+=c,u++),o[p]={left:0,top:h,row:u,width:m,height:i},l[l.length-1]+=m+a}),d}_fitCols(e,t,n,i){const{ctx:r,maxHeight:s,options:{labels:{padding:a}}}=this,o=this.legendHitBoxes=[],l=this.columnSizes=[],c=s-e;let d=a,u=0,h=0,p=0,m=0;return this.legendItems.forEach((e,s)=>{const{itemWidth:f,itemHeight:g}=function(e,t,n,i,r){const s=function(e,t,n,i){let r=e.text;r&&"string"!==typeof r&&(r=r.reduce((e,t)=>e.length>t.length?e:t));return t+n.size/2+i.measureText(r).width}(i,e,t,n),a=function(e,t,n){let i=e;"string"!==typeof t.text&&(i=yj(t,n));return i}(r,i,t.lineHeight);return{itemWidth:s,itemHeight:a}}(n,t,r,e,i);s>0&&h+g+2*a>c&&(d+=u+a,l.push({width:u,height:h}),p+=u+a,m++,u=h=0),o[s]={left:p,top:h,col:m,width:f,height:g},u=Math.max(u,f),h+=g+a}),d+=u,l.push({width:u,height:h}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:i},rtl:r}}=this,s=Jv(r,this.left,this.width);if(this.isHorizontal()){let r=0,a=wy(n,this.left+i,this.right-this.lineWidths[r]);for(const o of t)r!==o.row&&(r=o.row,a=wy(n,this.left+i,this.right-this.lineWidths[r])),o.top+=this.top+e+i,o.left=s.leftForLtr(s.x(a),o.width),a+=o.width+i}else{let r=0,a=wy(n,this.top+e+i,this.bottom-this.columnSizes[r].height);for(const o of t)o.col!==r&&(r=o.col,a=wy(n,this.top+e+i,this.bottom-this.columnSizes[r].height)),o.top=a,o.left+=this.left+i,o.left=s.leftForLtr(s.x(o.left),o.width),a+=o.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;Qy(e,this),this._draw(),Jy(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:i}=this,{align:r,labels:s}=e,a=Hy.color,o=Jv(e.rtl,this.left,this.width),l=pv(s.font),{padding:c}=s,d=l.size,u=d/2;let h;this.drawTitle(),i.textAlign=o.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:p,boxHeight:m,itemHeight:f}=gj(s,d),g=this.isHorizontal(),x=this._computeTitleHeight();h=g?{x:wy(r,this.left+c,this.right-n[0]),y:this.top+c+x,line:0}:{x:this.left+c,y:wy(r,this.top+x+c,this.bottom-t[0].height),line:0},$v(this.ctx,e.textDirection);const y=f+c;this.legendItems.forEach((v,_)=>{i.strokeStyle=v.fontColor,i.fillStyle=v.fontColor;const b=i.measureText(v.text).width,w=o.textAlign(v.textAlign||(v.textAlign=s.textAlign)),j=p+u+b;let N=h.x,S=h.y;o.setWidth(this.width),g?_>0&&N+j+c>this.right&&(S=h.y+=y,h.line++,N=h.x=wy(r,this.left+c,this.right-n[h.line])):_>0&&S+y>this.bottom&&(N=h.x=N+t[h.line].width+c,h.line++,S=h.y=wy(r,this.top+x+c,this.bottom-t[h.line].height));if(function(e,t,n){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;i.save();const r=kx(n.lineWidth,1);if(i.fillStyle=kx(n.fillStyle,a),i.lineCap=kx(n.lineCap,"butt"),i.lineDashOffset=kx(n.lineDashOffset,0),i.lineJoin=kx(n.lineJoin,"miter"),i.lineWidth=r,i.strokeStyle=kx(n.strokeStyle,a),i.setLineDash(kx(n.lineDash,[])),s.usePointStyle){const a={radius:m*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:r},l=o.xPlus(e,p/2);Xy(i,a,l,t+u,s.pointStyleWidth&&p)}else{const s=t+Math.max((d-m)/2,0),a=o.leftForLtr(e,p),l=uv(n.borderRadius);i.beginPath(),Object.values(l).some(e=>0!==e)?rv(i,{x:a,y:s,w:p,h:m,radius:l}):i.rect(a,s,p,m),i.fill(),0!==r&&i.stroke()}i.restore()}(o.x(N),S,v),N=((e,t,n,i)=>e===(i?"left":"right")?n:"center"===e?(t+n)/2:t)(w,N+p+u,g?N+j:this.right,e.rtl),function(e,t,n){iv(i,n.text,e,t+f/2,l,{strikethrough:n.hidden,textAlign:o.textAlign(n.textAlign)})}(o.x(N),S,v),g)h.x+=j+c;else if("string"!==typeof v.text){const e=l.lineHeight;h.y+=yj(v,e)+c}else h.y+=y}),e_(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=pv(t.font),i=hv(t.padding);if(!t.display)return;const r=Jv(e.rtl,this.left,this.width),s=this.ctx,a=t.position,o=n.size/2,l=i.top+o;let c,d=this.left,u=this.width;if(this.isHorizontal())u=Math.max(...this.lineWidths),c=this.top+l,d=wy(e.align,d,this.right-u);else{const t=this.columnSizes.reduce((e,t)=>Math.max(e,t.height),0);c=l+wy(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const h=wy(a,d,d+u);s.textAlign=r.textAlign(by(a)),s.textBaseline="middle",s.strokeStyle=t.color,s.fillStyle=t.color,s.font=n.string,iv(s,t.text,h,c,n)}_computeTitleHeight(){const e=this.options.title,t=pv(e.font),n=hv(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,i,r;if(hy(e,this.left,this.right)&&hy(t,this.top,this.bottom))for(r=this.legendHitBoxes,n=0;n<r.length;++n)if(i=r[n],hy(e,i.left,i.left+i.width)&&hy(t,i.top,i.top+i.height))return this.legendItems[n];return null}handleEvent(e){const t=this.options;if(!function(e,t){if(("mousemove"===e||"mouseout"===e)&&(t.onHover||t.onLeave))return!0;if(t.onClick&&("click"===e||"mouseup"===e))return!0;return!1}(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const i=this._hoveredItem,r=((e,t)=>null!==e&&null!==t&&e.datasetIndex===t.datasetIndex&&e.index===t.index)(i,n);i&&!r&&Cx(t.onLeave,[e,i,this],this),this._hoveredItem=n,n&&!r&&Cx(t.onHover,[e,n,this],this)}else n&&Cx(t.onClick,[e,n,this],this)}}function yj(e,t){return t*(e.text?e.text.length:0)}var vj={id:"legend",_element:xj,start(e,t,n){const i=e.legend=new xj({ctx:e.ctx,options:n,chart:e});ub.configure(e,i,n),ub.addBox(e,i)},stop(e){ub.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;ub.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,r=n.chart;r.isDatasetVisible(i)?(r.hide(i),t.hidden=!0):(r.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:r,color:s,useBorderRadius:a,borderRadius:o}}=e.legend.options;return e._getSortedDatasetMetas().map(e=>{const l=e.controller.getStyle(n?0:void 0),c=hv(l.borderWidth);return{text:t[e.index].label,fillStyle:l.backgroundColor,fontColor:s,hidden:!e.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:r||l.textAlign,borderRadius:a&&(o||l.borderRadius),datasetIndex:e.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class _j extends Eb{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const i=wx(n.text)?n.text.length:1;this._padding=hv(n.padding);const r=i*pv(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:n,bottom:i,right:r,options:s}=this,a=s.align;let o,l,c,d=0;return this.isHorizontal()?(l=wy(a,n,r),c=t+e,o=r-n):("left"===s.position?(l=n+e,c=wy(a,i,t),d=-.5*Hx):(l=r-e,c=wy(a,t,i),d=.5*Hx),o=i-t),{titleX:l,titleY:c,maxWidth:o,rotation:d}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=pv(t.font),i=n.lineHeight/2+this._padding.top,{titleX:r,titleY:s,maxWidth:a,rotation:o}=this._drawArgs(i);iv(e,t.text,0,0,n,{color:t.color,maxWidth:a,rotation:o,textAlign:by(t.align),textBaseline:"middle",translation:[r,s]})}}var bj={id:"title",_element:_j,start(e,t,n){!function(e,t){const n=new _j({ctx:e.ctx,options:t,chart:e});ub.configure(e,n,t),ub.addBox(e,n),e.titleBlock=n}(e,n)},stop(e){const t=e.titleBlock;ub.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;ub.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const wj=new WeakMap;var jj={id:"subtitle",start(e,t,n){const i=new _j({ctx:e.ctx,options:n,chart:e});ub.configure(e,i,n),ub.addBox(e,i),wj.set(e,i)},stop(e){ub.removeBox(e,wj.get(e)),wj.delete(e)},beforeUpdate(e,t,n){const i=wj.get(e);ub.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Nj={average(e){if(!e.length)return!1;let t,n,i=0,r=0,s=0;for(t=0,n=e.length;t<n;++t){const n=e[t].element;if(n&&n.hasValue()){const e=n.tooltipPosition();i+=e.x,r+=e.y,++s}}return{x:i/s,y:r/s}},nearest(e,t){if(!e.length)return!1;let n,i,r,s=t.x,a=t.y,o=Number.POSITIVE_INFINITY;for(n=0,i=e.length;n<i;++n){const i=e[n].element;if(i&&i.hasValue()){const e=oy(t,i.getCenterPoint());e<o&&(o=e,r=i)}}if(r){const e=r.tooltipPosition();s=e.x,a=e.y}return{x:s,y:a}}};function Sj(e,t){return t&&(wx(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function kj(e){return("string"===typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function Tj(e,t){const{element:n,datasetIndex:i,index:r}=t,s=e.getDatasetMeta(i).controller,{label:a,value:o}=s.getLabelAndValue(r);return{chart:e,label:a,parsed:s.getParsed(r),raw:e.data.datasets[i].data[r],formattedValue:o,dataset:s.getDataset(),dataIndex:r,datasetIndex:i,element:n}}function Cj(e,t){const n=e.chart.ctx,{body:i,footer:r,title:s}=e,{boxWidth:a,boxHeight:o}=t,l=pv(t.bodyFont),c=pv(t.titleFont),d=pv(t.footerFont),u=s.length,h=r.length,p=i.length,m=hv(t.padding);let f=m.height,g=0,x=i.reduce((e,t)=>e+t.before.length+t.lines.length+t.after.length,0);if(x+=e.beforeBody.length+e.afterBody.length,u&&(f+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),x){f+=p*(t.displayColors?Math.max(o,l.lineHeight):l.lineHeight)+(x-p)*l.lineHeight+(x-1)*t.bodySpacing}h&&(f+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const v=function(e){g=Math.max(g,n.measureText(e).width+y)};return n.save(),n.font=c.string,Ex(e.title,v),n.font=l.string,Ex(e.beforeBody.concat(e.afterBody),v),y=t.displayColors?a+2+t.boxPadding:0,Ex(i,e=>{Ex(e.before,v),Ex(e.lines,v),Ex(e.after,v)}),y=0,n.font=d.string,Ex(e.footer,v),n.restore(),g+=m.width,{width:g,height:f}}function Ej(e,t,n,i){const{x:r,width:s}=n,{width:a,chartArea:{left:o,right:l}}=e;let c="center";return"center"===i?c=r<=(o+l)/2?"left":"right":r<=s/2?c="left":r>=a-s/2&&(c="right"),function(e,t,n,i){const{x:r,width:s}=i,a=n.caretSize+n.caretPadding;return"left"===e&&r+s+a>t.width||"right"===e&&r-s-a<0||void 0}(c,e,t,n)&&(c="center"),c}function Aj(e,t,n){const i=n.yAlign||t.yAlign||function(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}(e,n);return{xAlign:n.xAlign||t.xAlign||Ej(e,t,n,i),yAlign:i}}function Mj(e,t,n,i){const{caretSize:r,caretPadding:s,cornerRadius:a}=e,{xAlign:o,yAlign:l}=n,c=r+s,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:p}=uv(a);let m=function(e,t){let{x:n,width:i}=e;return"right"===t?n-=i:"center"===t&&(n-=i/2),n}(t,o);const f=function(e,t,n){let{y:i,height:r}=e;return"top"===t?i+=n:i-="bottom"===t?r+n:r/2,i}(t,l,c);return"center"===l?"left"===o?m+=c:"right"===o&&(m-=c):"left"===o?m-=Math.max(d,h)+r:"right"===o&&(m+=Math.max(u,p)+r),{x:uy(m,0,i.width-t.width),y:uy(f,0,i.height-t.height)}}function Dj(e,t,n){const i=hv(n.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-i.right:e.x+i.left}function Ij(e){return Sj([],kj(e))}function Pj(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const Rj={beforeTitle:vx,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:vx,beforeBody:vx,beforeLabel:vx,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return bx(n)||(t+=n),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:vx,afterBody:vx,beforeFooter:vx,footer:vx,afterFooter:vx};function Lj(e,t,n,i){const r=e[t].call(n,i);return"undefined"===typeof r?Rj[t].call(n,i):r}class zj extends Eb{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),i=n.enabled&&t.options.animation&&n.animations,r=new p_(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=function(e,t,n){return fv(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:n}=t,i=Lj(n,"beforeTitle",this,e),r=Lj(n,"title",this,e),s=Lj(n,"afterTitle",this,e);let a=[];return a=Sj(a,kj(i)),a=Sj(a,kj(r)),a=Sj(a,kj(s)),a}getBeforeBody(e,t){return Ij(Lj(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,i=[];return Ex(e,e=>{const t={before:[],lines:[],after:[]},r=Pj(n,e);Sj(t.before,kj(Lj(r,"beforeLabel",this,e))),Sj(t.lines,Lj(r,"label",this,e)),Sj(t.after,kj(Lj(r,"afterLabel",this,e))),i.push(t)}),i}getAfterBody(e,t){return Ij(Lj(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,i=Lj(n,"beforeFooter",this,e),r=Lj(n,"footer",this,e),s=Lj(n,"afterFooter",this,e);let a=[];return a=Sj(a,kj(i)),a=Sj(a,kj(r)),a=Sj(a,kj(s)),a}_createItems(e){const t=this._active,n=this.chart.data,i=[],r=[],s=[];let a,o,l=[];for(a=0,o=t.length;a<o;++a)l.push(Tj(this.chart,t[a]));return e.filter&&(l=l.filter((t,i,r)=>e.filter(t,i,r,n))),e.itemSort&&(l=l.sort((t,i)=>e.itemSort(t,i,n))),Ex(l,t=>{const n=Pj(e.callbacks,t);i.push(Lj(n,"labelColor",this,t)),r.push(Lj(n,"labelPointStyle",this,t)),s.push(Lj(n,"labelTextColor",this,t))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=s,this.dataPoints=l,l}update(e,t){const n=this.options.setContext(this.getContext()),i=this._active;let r,s=[];if(i.length){const e=Nj[n.position].call(this,i,this._eventPosition);s=this._createItems(n),this.title=this.getTitle(s,n),this.beforeBody=this.getBeforeBody(s,n),this.body=this.getBody(s,n),this.afterBody=this.getAfterBody(s,n),this.footer=this.getFooter(s,n);const t=this._size=Cj(this,n),a=Object.assign({},e,t),o=Aj(this.chart,n,a),l=Mj(n,a,o,this.chart);this.xAlign=o.xAlign,this.yAlign=o.yAlign,r={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=s,this.$context=void 0,r&&this._resolveAnimations().update(this,r),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,i){const r=this.getCaretPosition(e,n,i);t.lineTo(r.x1,r.y1),t.lineTo(r.x2,r.y2),t.lineTo(r.x3,r.y3)}getCaretPosition(e,t,n){const{xAlign:i,yAlign:r}=this,{caretSize:s,cornerRadius:a}=n,{topLeft:o,topRight:l,bottomLeft:c,bottomRight:d}=uv(a),{x:u,y:h}=e,{width:p,height:m}=t;let f,g,x,y,v,_;return"center"===r?(v=h+m/2,"left"===i?(f=u,g=f-s,y=v+s,_=v-s):(f=u+p,g=f+s,y=v-s,_=v+s),x=f):(g="left"===i?u+Math.max(o,c)+s:"right"===i?u+p-Math.max(l,d)-s:this.caretX,"top"===r?(y=h,v=y-s,f=g-s,x=g+s):(y=h+m,v=y+s,f=g+s,x=g-s),_=y),{x1:f,x2:g,x3:x,y1:y,y2:v,y3:_}}drawTitle(e,t,n){const i=this.title,r=i.length;let s,a,o;if(r){const l=Jv(n.rtl,this.x,this.width);for(e.x=Dj(this,n.titleAlign,n),t.textAlign=l.textAlign(n.titleAlign),t.textBaseline="middle",s=pv(n.titleFont),a=n.titleSpacing,t.fillStyle=n.titleColor,t.font=s.string,o=0;o<r;++o)t.fillText(i[o],l.x(e.x),e.y+s.lineHeight/2),e.y+=s.lineHeight+a,o+1===r&&(e.y+=n.titleMarginBottom-a)}}_drawColorBox(e,t,n,i,r){const s=this.labelColors[n],a=this.labelPointStyles[n],{boxHeight:o,boxWidth:l}=r,c=pv(r.bodyFont),d=Dj(this,"left",r),u=i.x(d),h=o<c.lineHeight?(c.lineHeight-o)/2:0,p=t.y+h;if(r.usePointStyle){const t={radius:Math.min(l,o)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},n=i.leftForLtr(u,l)+l/2,c=p+o/2;e.strokeStyle=r.multiKeyBackground,e.fillStyle=r.multiKeyBackground,Zy(e,t,n,c),e.strokeStyle=s.borderColor,e.fillStyle=s.backgroundColor,Zy(e,t,n,c)}else{e.lineWidth=jx(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,e.strokeStyle=s.borderColor,e.setLineDash(s.borderDash||[]),e.lineDashOffset=s.borderDashOffset||0;const t=i.leftForLtr(u,l),n=i.leftForLtr(i.xPlus(u,1),l-2),a=uv(s.borderRadius);Object.values(a).some(e=>0!==e)?(e.beginPath(),e.fillStyle=r.multiKeyBackground,rv(e,{x:t,y:p,w:l,h:o,radius:a}),e.fill(),e.stroke(),e.fillStyle=s.backgroundColor,e.beginPath(),rv(e,{x:n,y:p+1,w:l-2,h:o-2,radius:a}),e.fill()):(e.fillStyle=r.multiKeyBackground,e.fillRect(t,p,l,o),e.strokeRect(t,p,l,o),e.fillStyle=s.backgroundColor,e.fillRect(n,p+1,l-2,o-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:i}=this,{bodySpacing:r,bodyAlign:s,displayColors:a,boxHeight:o,boxWidth:l,boxPadding:c}=n,d=pv(n.bodyFont);let u=d.lineHeight,h=0;const p=Jv(n.rtl,this.x,this.width),m=function(n){t.fillText(n,p.x(e.x+h),e.y+u/2),e.y+=u+r},f=p.textAlign(s);let g,x,y,v,_,b,w;for(t.textAlign=s,t.textBaseline="middle",t.font=d.string,e.x=Dj(this,f,n),t.fillStyle=n.bodyColor,Ex(this.beforeBody,m),h=a&&"right"!==f?"center"===s?l/2+c:l+2+c:0,v=0,b=i.length;v<b;++v){for(g=i[v],x=this.labelTextColors[v],t.fillStyle=x,Ex(g.before,m),y=g.lines,a&&y.length&&(this._drawColorBox(t,e,v,p,n),u=Math.max(d.lineHeight,o)),_=0,w=y.length;_<w;++_)m(y[_]),u=d.lineHeight;Ex(g.after,m)}h=0,u=d.lineHeight,Ex(this.afterBody,m),e.y-=r}drawFooter(e,t,n){const i=this.footer,r=i.length;let s,a;if(r){const o=Jv(n.rtl,this.x,this.width);for(e.x=Dj(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=o.textAlign(n.footerAlign),t.textBaseline="middle",s=pv(n.footerFont),t.fillStyle=n.footerColor,t.font=s.string,a=0;a<r;++a)t.fillText(i[a],o.x(e.x),e.y+s.lineHeight/2),e.y+=s.lineHeight+n.footerSpacing}}drawBackground(e,t,n,i){const{xAlign:r,yAlign:s}=this,{x:a,y:o}=e,{width:l,height:c}=n,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:p}=uv(i.cornerRadius);t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.beginPath(),t.moveTo(a+d,o),"top"===s&&this.drawCaret(e,t,n,i),t.lineTo(a+l-u,o),t.quadraticCurveTo(a+l,o,a+l,o+u),"center"===s&&"right"===r&&this.drawCaret(e,t,n,i),t.lineTo(a+l,o+c-p),t.quadraticCurveTo(a+l,o+c,a+l-p,o+c),"bottom"===s&&this.drawCaret(e,t,n,i),t.lineTo(a+h,o+c),t.quadraticCurveTo(a,o+c,a,o+c-h),"center"===s&&"left"===r&&this.drawCaret(e,t,n,i),t.lineTo(a,o+d),t.quadraticCurveTo(a,o,a+d,o),t.closePath(),t.fill(),i.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,i=n&&n.x,r=n&&n.y;if(i||r){const n=Nj[e.position].call(this,this._active,this._eventPosition);if(!n)return;const s=this._size=Cj(this,e),a=Object.assign({},n,this._size),o=Aj(t,e,a),l=Mj(e,a,o,t);i._to===l.x&&r._to===l.y||(this.xAlign=o.xAlign,this.yAlign=o.yAlign,this.width=s.width,this.height=s.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const s=hv(t.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&a&&(e.save(),e.globalAlpha=n,this.drawBackground(r,e,i,t),$v(e,t.textDirection),r.y+=s.top,this.drawTitle(r,e,t),this.drawBody(r,e,t),this.drawFooter(r,e,t),e_(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,i=e.map(e=>{let{datasetIndex:t,index:n}=e;const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[n],index:n}}),r=!Ax(n,i),s=this._positionChanged(i,t);(r||s)&&(this._active=i,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],s=this._getActiveElements(e,r,t,n),a=this._positionChanged(s,e),o=t||!Ax(s,r)||a;return o&&(this._active=s,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),o}_getActiveElements(e,t,n,i){const r=this.options;if("mouseout"===e.type)return[];if(!i)return t.filter(e=>this.chart.data.datasets[e.datasetIndex]&&void 0!==this.chart.getDatasetMeta(e.datasetIndex).controller.getParsed(e.index));const s=this.chart.getElementsAtEventForMode(e,r.mode,r,n);return r.reverse&&s.reverse(),s}_positionChanged(e,t){const{caretX:n,caretY:i,options:r}=this,s=Nj[r.position].call(this,e,t);return!1!==s&&(n!==s.x||i!==s.y)}}(0,Pe.A)(zj,"positioners",Nj);var Oj={id:"tooltip",_element:zj,positioners:Nj,afterInit(e,t,n){n&&(e.tooltip=new zj({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",Le(Le({},n),{},{cancelable:!0})))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Rj},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Fj=Object.freeze({__proto__:null,Colors:Xw,Decimation:Jw,Filler:fj,Legend:vj,SubTitle:jj,Title:bj,Tooltip:Oj});function Bj(e,t,n,i){const r=e.indexOf(t);if(-1===r)return((e,t,n,i)=>("string"===typeof t?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n))(e,t,n,i);return r!==e.lastIndexOf(t)?n:r}function Vj(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class Uj extends Fb{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:n,label:i}of t)e[n]===i&&e.splice(n,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(bx(e))return null;const n=this.getLabels();return((e,t)=>null===e?null:uy(Math.round(e),0,t))(t=isFinite(t)&&n[t]===e?t:Bj(n,e,kx(t,e),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(n=0),t||(i=this.getLabels().length-1)),this.min=n,this.max=i}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,i=[];let r=this.getLabels();r=0===e&&t===r.length-1?r:r.slice(e,t+1),this._valueRange=Math.max(r.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let s=e;s<=t;s++)i.push({value:s});return i}getLabelForValue(e){return Vj.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!==typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function Hj(e,t){const n=[],{bounds:i,step:r,min:s,max:a,precision:o,count:l,maxTicks:c,maxDigits:d,includeBounds:u}=e,h=r||1,p=c-1,{min:m,max:f}=t,g=!bx(s),x=!bx(a),y=!bx(l),v=(f-m)/(d+1);let _,b,w,j,N=ey((f-m)/p/h)*h;if(N<1e-14&&!g&&!x)return[{value:m},{value:f}];j=Math.ceil(f/N)-Math.floor(m/N),j>p&&(N=ey(j*N/p/h)*h),bx(o)||(_=Math.pow(10,o),N=Math.ceil(N*_)/_),"ticks"===i?(b=Math.floor(m/N)*N,w=Math.ceil(f/N)*N):(b=m,w=f),g&&x&&r&&function(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}((a-s)/r,N/1e3)?(j=Math.round(Math.min((a-s)/N,c)),N=(a-s)/j,b=s,w=a):y?(b=g?s:b,w=x?a:w,j=l-1,N=(w-b)/j):(j=(w-b)/N,j=$x(j,Math.round(j),N/1e3)?Math.round(j):Math.ceil(j));const S=Math.max(sy(N),sy(b));_=Math.pow(10,bx(o)?S:o),b=Math.round(b*_)/_,w=Math.round(w*_)/_;let k=0;for(g&&(u&&b!==s?(n.push({value:s}),b<s&&k++,$x(Math.round((b+k*N)*_)/_,s,qj(s,v,e))&&k++):b<s&&k++);k<j;++k){const e=Math.round((b+k*N)*_)/_;if(x&&e>a)break;n.push({value:e})}return x&&u&&w!==a?n.length&&$x(n[n.length-1].value,a,qj(a,v,e))?n[n.length-1].value=a:n.push({value:a}):x&&w!==a||n.push({value:w}),n}function qj(e,t,n){let{horizontal:i,minRotation:r}=n;const s=iy(r),a=(i?Math.sin(s):Math.cos(s))||.001,o=.75*t*(""+e).length;return Math.min(t/a,o)}(0,Pe.A)(Uj,"id","category"),(0,Pe.A)(Uj,"defaults",{ticks:{callback:Vj}});class Wj extends Fb{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return bx(e)||("number"===typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:r}=this;const s=e=>i=t?i:e,a=e=>r=n?r:e;if(e){const e=Jx(i),t=Jx(r);e<0&&t<0?a(0):e>0&&t>0&&s(0)}if(i===r){let t=0===r?1:Math.abs(.05*r);a(r+t),e||s(i-t)}this.min=i,this.max=r}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:n,stepSize:i}=e;return i?(t=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,t>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(i," would result generating up to ").concat(t," ticks. Limiting to 1000.")),t=1e3)):(t=this.computeTickLimit(),n=n||11),n&&(t=Math.min(n,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const i=Hj({maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&ny(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const i=(n-t)/Math.max(e.length-1,1)/2;t-=i,n+=i}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return Ry(e,this.chart.options.locale,this.options.ticks.format)}}class Gj extends Wj{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Nx(e)?e:0,this.max=Nx(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=iy(this.options.ticks.minRotation),i=(e?Math.sin(n):Math.cos(n))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,r.lineHeight/i))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}(0,Pe.A)(Gj,"id","linear"),(0,Pe.A)(Gj,"defaults",{ticks:{callback:zy.formatters.numeric}});const Yj=e=>Math.floor(Qx(e)),Zj=(e,t)=>Math.pow(10,Yj(e)+t);function Xj(e){return 1===e/Math.pow(10,Yj(e))}function Kj(e,t,n){const i=Math.pow(10,n),r=Math.floor(e/i);return Math.ceil(t/i)-r}function Qj(e,t){let{min:n,max:i}=t;n=Sx(e.min,n);const r=[],s=Yj(n);let a=function(e,t){let n=Yj(t-e);for(;Kj(e,t,n)>10;)n++;for(;Kj(e,t,n)<10;)n--;return Math.min(n,Yj(e))}(n,i),o=a<0?Math.pow(10,Math.abs(a)):1;const l=Math.pow(10,a),c=s>a?Math.pow(10,s):0,d=Math.round((n-c)*o)/o,u=Math.floor((n-c)/l/10)*l*10;let h=Math.floor((d-u)/Math.pow(10,a)),p=Sx(e.min,Math.round((c+u+h*Math.pow(10,a))*o)/o);for(;p<i;)r.push({value:p,major:Xj(p),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(a++,h=2,o=a>=0?1:o),p=Math.round((c+u+h*Math.pow(10,a))*o)/o;const m=Sx(e.max,p);return r.push({value:m,major:Xj(m),significand:h}),r}class Jj extends Fb{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const n=Wj.prototype.parse.apply(this,[e,t]);if(0!==n)return Nx(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Nx(e)?Math.max(0,e):null,this.max=Nx(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Nx(this._userMin)&&(this.min=e===Zj(this.min,0)?Zj(this.min,-1):Zj(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let n=this.min,i=this.max;const r=t=>n=e?n:t,s=e=>i=t?i:e;n===i&&(n<=0?(r(1),s(10)):(r(Zj(n,-1)),s(Zj(i,1)))),n<=0&&r(Zj(i,-1)),i<=0&&s(Zj(n,1)),this.min=n,this.max=i}buildTicks(){const e=this.options,t=Qj({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&ny(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":Ry(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=Qx(e),this._valueRange=Qx(this.max)-Qx(e)}getPixelForValue(e){return void 0!==e&&0!==e||(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Qx(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function $j(e){const t=e.ticks;if(t.display&&e.display){const e=hv(t.backdropPadding);return kx(t.font&&t.font.size,Hy.font.size)+e.height}return 0}function eN(e,t,n){return n=wx(n)?n:[n],{w:Wy(e,t.string,n),h:n.length*t.lineHeight}}function tN(e,t,n,i,r){return e===i||e===r?{start:t-n/2,end:t+n/2}:e<i||e>r?{start:t-n,end:t}:{start:t,end:t+n}}function nN(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],r=[],s=e._pointLabels.length,a=e.options.pointLabels,o=a.centerPointLabels?Hx/s:0;for(let l=0;l<s;l++){const s=a.setContext(e.getPointLabelContext(l));r[l]=s.padding;const c=e.getPointPosition(l,e.drawingArea+r[l],o),d=pv(s.font),u=eN(e.ctx,d,e._pointLabels[l]);i[l]=u;const h=cy(e.getIndexAngle(l)+o),p=Math.round(ry(h));iN(n,t,h,tN(p,c.x,u.w,0,180),tN(p,c.y,u.h,90,270))}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=function(e,t,n){const i=[],r=e._pointLabels.length,s=e.options,{centerPointLabels:a,display:o}=s.pointLabels,l={extra:$j(s)/2,additionalAngle:a?Hx/r:0};let c;for(let d=0;d<r;d++){l.padding=n[d],l.size=t[d];const r=rN(e,d,l);i.push(r),"auto"===o&&(r.visible=sN(r,c),r.visible&&(c=r))}return i}(e,i,r)}function iN(e,t,n,i,r){const s=Math.abs(Math.sin(n)),a=Math.abs(Math.cos(n));let o=0,l=0;i.start<t.l?(o=(t.l-i.start)/s,e.l=Math.min(e.l,t.l-o)):i.end>t.r&&(o=(i.end-t.r)/s,e.r=Math.max(e.r,t.r+o)),r.start<t.t?(l=(t.t-r.start)/a,e.t=Math.min(e.t,t.t-l)):r.end>t.b&&(l=(r.end-t.b)/a,e.b=Math.max(e.b,t.b+l))}function rN(e,t,n){const i=e.drawingArea,{extra:r,additionalAngle:s,padding:a,size:o}=n,l=e.getPointPosition(t,i+r+a,s),c=Math.round(ry(cy(l.angle+Zx))),d=function(e,t,n){90===n||270===n?e-=t/2:(n>270||n<90)&&(e-=t);return e}(l.y,o.h,c),u=function(e){if(0===e||180===e)return"center";if(e<180)return"left";return"right"}(c),h=function(e,t,n){"right"===n?e-=t:"center"===n&&(e-=t/2);return e}(l.x,o.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+o.w,bottom:d+o.h}}function sN(e,t){if(!t)return!0;const{left:n,top:i,right:r,bottom:s}=e;return!(Ky({x:n,y:i},t)||Ky({x:n,y:s},t)||Ky({x:r,y:i},t)||Ky({x:r,y:s},t))}function aN(e,t,n){const{left:i,top:r,right:s,bottom:a}=n,{backdropColor:o}=t;if(!bx(o)){const n=uv(t.borderRadius),l=hv(t.backdropPadding);e.fillStyle=o;const c=i-l.left,d=r-l.top,u=s-i+l.width,h=a-r+l.height;Object.values(n).some(e=>0!==e)?(e.beginPath(),rv(e,{x:c,y:d,w:u,h:h,radius:n}),e.fill()):e.fillRect(c,d,u,h)}}function oN(e,t,n,i){const{ctx:r}=e;if(n)r.arc(e.xCenter,e.yCenter,t,0,qx);else{let n=e.getPointPosition(0,t);r.moveTo(n.x,n.y);for(let s=1;s<i;s++)n=e.getPointPosition(s,t),r.lineTo(n.x,n.y)}}(0,Pe.A)(Jj,"id","logarithmic"),(0,Pe.A)(Jj,"defaults",{ticks:{callback:zy.formatters.logarithmic,major:{enabled:!0}}});class lN extends Wj{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=hv($j(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=Nx(e)&&!isNaN(e)?e:0,this.max=Nx(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/$j(this.options))}generateTickLabels(e){Wj.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((e,t)=>{const n=Cx(this.options.pointLabels.callback,[e,t],this);return n||0===n?n:""}).filter((e,t)=>this.chart.getDataVisibility(t))}fit(){const e=this.options;e.display&&e.pointLabels.display?nN(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,i){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,i))}getIndexAngle(e){return cy(e*(qx/(this._pointLabels.length||1))+iy(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(bx(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(bx(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const n=t[e];return function(e,t,n){return fv(e,{label:n,index:t,type:"pointLabel"})}(this.getContext(),e,n)}}getPointPosition(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.getIndexAngle(e)-Zx+n;return{x:Math.cos(i)*t+this.xCenter,y:Math.sin(i)*t+this.yCenter,angle:i}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:n,right:i,bottom:r}=this._pointLabelItems[e];return{left:t,top:n,right:i,bottom:r}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const n=this.ctx;n.save(),n.beginPath(),oN(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:n,grid:i,border:r}=t,s=this._pointLabels.length;let a,o,l;if(t.pointLabels.display&&function(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let r=t-1;r>=0;r--){const t=e._pointLabelItems[r];if(!t.visible)continue;const s=i.setContext(e.getPointLabelContext(r));aN(n,s,t);const a=pv(s.font),{x:o,y:l,textAlign:c}=t;iv(n,e._pointLabels[r],o,l+a.lineHeight/2,a,{color:s.color,textAlign:c,textBaseline:"middle"})}}(this,s),i.display&&this.ticks.forEach((e,t)=>{if(0!==t){o=this.getDistanceFromCenterForValue(e.value);const n=this.getContext(t),a=i.setContext(n),l=r.setContext(n);!function(e,t,n,i,r){const s=e.ctx,a=t.circular,{color:o,lineWidth:l}=t;!a&&!i||!o||!l||n<0||(s.save(),s.strokeStyle=o,s.lineWidth=l,s.setLineDash(r.dash),s.lineDashOffset=r.dashOffset,s.beginPath(),oN(e,n,a,i),s.closePath(),s.stroke(),s.restore())}(this,a,o,s,l)}}),n.display){for(e.save(),a=s-1;a>=0;a--){const i=n.setContext(this.getPointLabelContext(a)),{color:r,lineWidth:s}=i;s&&r&&(e.lineWidth=s,e.strokeStyle=r,e.setLineDash(i.borderDash),e.lineDashOffset=i.borderDashOffset,o=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),l=this.getPointPosition(a,o),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(l.x,l.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;const i=this.getIndexAngle(0);let r,s;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((i,a)=>{if(0===a&&!t.reverse)return;const o=n.setContext(this.getContext(a)),l=pv(o.font);if(r=this.getDistanceFromCenterForValue(this.ticks[a].value),o.showLabelBackdrop){e.font=l.string,s=e.measureText(i.label).width,e.fillStyle=o.backdropColor;const t=hv(o.backdropPadding);e.fillRect(-s/2-t.left,-r-l.size/2-t.top,s+t.width,l.size+t.height)}iv(e,i.label,0,-r,l,{color:o.color,strokeColor:o.textStrokeColor,strokeWidth:o.textStrokeWidth})}),e.restore()}drawTitle(){}}(0,Pe.A)(lN,"id","radialLinear"),(0,Pe.A)(lN,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:zy.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}}),(0,Pe.A)(lN,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),(0,Pe.A)(lN,"descriptors",{angleLines:{_fallback:"grid"}});const cN={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},dN=Object.keys(cN);function uN(e,t){return e-t}function hN(e,t){if(bx(t))return null;const n=e._adapter,{parser:i,round:r,isoWeekday:s}=e._parseOpts;let a=t;return"function"===typeof i&&(a=i(a)),Nx(a)||(a="string"===typeof i?n.parse(a,i):n.parse(a)),null===a?null:(r&&(a="week"!==r||!ty(s)&&!0!==s?n.startOf(a,r):n.startOf(a,"isoWeek",s)),+a)}function pN(e,t,n,i){const r=dN.length;for(let s=dN.indexOf(e);s<r-1;++s){const e=cN[dN[s]],r=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((n-t)/(r*e.size))<=i)return dN[s]}return dN[r-1]}function mN(e,t,n){if(n){if(n.length){const{lo:i,hi:r}=py(n,t);e[n[i]>=t?n[i]:n[r]]=!0}}else e[t]=!0}function fN(e,t,n){const i=[],r={},s=t.length;let a,o;for(a=0;a<s;++a)o=t[a],r[o]=a,i.push({value:o,major:!1});return 0!==s&&n?function(e,t,n,i){const r=e._adapter,s=+r.startOf(t[0].value,i),a=t[t.length-1].value;let o,l;for(o=s;o<=a;o=+r.add(o,1,i))l=n[o],l>=0&&(t[l].major=!0);return t}(e,i,r,n):i}class gN extends Fb{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.time||(e.time={}),i=this._adapter=new W_(e.adapters.date);i.init(t),Rx(n.displayFormats,i.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:hN(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:i,max:r,minDefined:s,maxDefined:a}=this.getUserBounds();function o(e){s||isNaN(e.min)||(i=Math.min(i,e.min)),a||isNaN(e.max)||(r=Math.max(r,e.max))}s&&a||(o(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||o(this.getMinMax(!1))),i=Nx(i)&&!isNaN(i)?i:+t.startOf(Date.now(),n),r=Nx(r)&&!isNaN(r)?r:+t.endOf(Date.now(),n)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,s=function(e,t,n){let i=0,r=e.length;for(;i<r&&e[i]<t;)i++;for(;r>i&&e[r-1]>n;)r--;return i>0||r<e.length?e.slice(i,r):e}(i,r,this.max);return this._unit=t.unit||(n.autoSkip?pN(t.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(e,t,n,i,r){for(let s=dN.length-1;s>=dN.indexOf(n);s--){const n=dN[s];if(cN[n].common&&e._adapter.diff(r,i,n)>=t-1)return n}return dN[n?dN.indexOf(n):0]}(this,s.length,t.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(e){for(let t=dN.indexOf(e)+1,n=dN.length;t<n;++t)if(cN[dN[t]].common)return dN[t]}(this._unit):void 0,this.initOffsets(i),e.reverse&&s.reverse(),fN(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=0,r=0;this.options.offset&&n.length&&(e=this.getDecimalForValue(n[0]),i=1===n.length?1-e:(this.getDecimalForValue(n[1])-e)/2,t=this.getDecimalForValue(n[n.length-1]),r=1===n.length?t:(t-this.getDecimalForValue(n[n.length-2]))/2);const s=n.length<3?.5:.25;i=uy(i,0,s),r=uy(r,0,s),this._offsets={start:i,end:r,factor:1/(i+1+r)}}_generate(){const e=this._adapter,t=this.min,n=this.max,i=this.options,r=i.time,s=r.unit||pN(r.minUnit,t,n,this._getLabelCapacity(t)),a=kx(i.ticks.stepSize,1),o="week"===s&&r.isoWeekday,l=ty(o)||!0===o,c={};let d,u,h=t;if(l&&(h=+e.startOf(h,"isoWeek",o)),h=+e.startOf(h,l?"day":s),e.diff(n,t,s)>1e5*a)throw new Error(t+" and "+n+" are too far apart with stepSize of "+a+" "+s);const p="data"===i.ticks.source&&this.getDataTimestamps();for(d=h,u=0;d<n;d=+e.add(d,a,s),u++)mN(c,d,p);return d!==n&&"ticks"!==i.bounds&&1!==u||mN(c,d,p),Object.keys(c).sort(uN).map(e=>+e)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const n=this.options.time.displayFormats,i=this._unit,r=t||n[i];return this._adapter.format(e,r)}_tickFormatFunction(e,t,n,i){const r=this.options,s=r.ticks.callback;if(s)return Cx(s,[e,t,n],this);const a=r.time.displayFormats,o=this._unit,l=this._majorUnit,c=o&&a[o],d=l&&a[l],u=n[t],h=l&&d&&u&&u.major;return this._adapter.format(e,i||(h?d:c))}generateTickLabels(e){let t,n,i;for(t=0,n=e.length;t<n;++t)i=e[t],i.label=this._tickFormatFunction(i.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,i=iy(this.isHorizontal()?t.maxRotation:t.minRotation),r=Math.cos(i),s=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:n*r+a*s,h:n*s+a*r}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,i=n[t.unit]||n.millisecond,r=this._tickFormatFunction(e,0,fN(this,[e],this._majorUnit),i),s=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return a>0?a:1}getDataTimestamps(){let e,t,n=this._cache.data||[];if(n.length)return n;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(e=0,t=i.length;e<t;++e)n=n.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const i=this.getLabels();for(t=0,n=i.length;t<n;++t)e.push(hN(this,i[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return yy(e.sort(uN))}}function xN(e,t,n){let i,r,s,a,o=0,l=e.length-1;n?(t>=e[o].pos&&t<=e[l].pos&&({lo:o,hi:l}=my(e,"pos",t)),({pos:i,time:s}=e[o]),({pos:r,time:a}=e[l])):(t>=e[o].time&&t<=e[l].time&&({lo:o,hi:l}=my(e,"time",t)),({time:i,pos:s}=e[o]),({time:r,pos:a}=e[l]));const c=r-i;return c?s+(a-s)*(t-i)/c:s}(0,Pe.A)(gN,"id","time"),(0,Pe.A)(gN,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});class yN extends gN{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=xN(t,this.min),this._tableRange=xN(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,i=[],r=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;++s)l=e[s],l>=t&&l<=n&&i.push(l);if(i.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(s=0,a=i.length;s<a;++s)c=i[s+1],o=i[s-1],l=i[s],Math.round((c+o)/2)!==l&&r.push({time:l,pos:s/(a-1)});return r}_generate(){const e=this.min,t=this.max;let n=super.getDataTimestamps();return n.includes(e)&&n.length||n.splice(0,0,e),n.includes(t)&&1!==n.length||n.push(t),n.sort((e,t)=>e-t)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return e=t.length&&n.length?this.normalize(t.concat(n)):t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(xN(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return xN(this._table,n*this._tableRange+this._minPos,!0)}}(0,Pe.A)(yN,"id","timeseries"),(0,Pe.A)(yN,"defaults",gN.defaults);const vN=[U_,Uw,Fj,Object.freeze({__proto__:null,CategoryScale:Uj,LinearScale:Gj,LogarithmicScale:Jj,RadialLinearScale:lN,TimeScale:gN,TimeSeriesScale:yN})],_N=["height","width","redraw","datasetIdKey","type","data","options","plugins","fallbackContent","updateMode"],bN="label";function wN(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function jN(e,t){e.labels=t}function NN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bN;const i=[];e.datasets=t.map(t=>{const r=e.datasets.find(e=>e[n]===t[n]);return r&&t.data&&!i.includes(r)?(i.push(r),Object.assign(r,t),r):Le({},t)})}function SN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bN;const n={labels:[],datasets:[]};return jN(n,e.labels),NN(n,e.datasets,t),n}function kN(e,t){const{height:n=150,width:r=300,redraw:s=!1,datasetIdKey:a,type:o,data:l,options:c,plugins:d=[],fallbackContent:u,updateMode:h}=e,p=vn(e,_N),m=(0,i.useRef)(null),f=(0,i.useRef)(),g=()=>{m.current&&(f.current=new xw(m.current,{type:o,data:SN(l,a),options:c&&Le({},c),plugins:d}),wN(t,f.current))},x=()=>{wN(t,null),f.current&&(f.current.destroy(),f.current=null)};return(0,i.useEffect)(()=>{!s&&f.current&&c&&function(e,t){const n=e.options;n&&t&&Object.assign(n,t)}(f.current,c)},[s,c]),(0,i.useEffect)(()=>{!s&&f.current&&jN(f.current.config.data,l.labels)},[s,l.labels]),(0,i.useEffect)(()=>{!s&&f.current&&l.datasets&&NN(f.current.config.data,l.datasets,a)},[s,l.datasets]),(0,i.useEffect)(()=>{f.current&&(s?(x(),setTimeout(g)):f.current.update(h))},[s,c,l.labels,l.datasets,h]),(0,i.useEffect)(()=>{f.current&&(x(),setTimeout(g))},[o]),(0,i.useEffect)(()=>(g(),()=>x()),[]),i.createElement("canvas",Object.assign({ref:m,role:"img",height:n,width:r},p),u)}const TN=(0,i.forwardRef)(kN);function CN(e,t){return xw.register(t),(0,i.forwardRef)((t,n)=>i.createElement(TN,Object.assign({},t,{ref:n,type:e})))}const EN=CN("line",z_),AN=CN("bar",P_),MN=CN("radar",B_),DN=CN("doughnut",L_);xw.register(...vN);const IN=e=>{let{data:t={}}=e;const n={utilization:(0,i.useRef)(null),fuel:(0,i.useRef)(null),maintenance:(0,i.useRef)(null),performance:(0,i.useRef)(null)},r={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",padding:12,cornerRadius:8,displayColors:!0,mode:"index",intersect:!1}},scales:{x:{grid:{display:!1},ticks:{font:{size:11}}},y:{grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{font:{size:11}}}}},s={labels:t.utilizationLabels||["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Fleet Utilization %",data:t.utilizationData||[85,88,82,90,87,75,70],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6},{label:"Target %",data:t.utilizationTarget||[85,85,85,85,85,80,75],borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderDash:[5,5],tension:.4,fill:!1,pointRadius:0}]},a={labels:t.fuelLabels||["Week 1","Week 2","Week 3","Week 4"],datasets:[{label:"Diesel (L)",data:t.dieselData||[2800,2700,2900,2750],backgroundColor:"rgba(59, 130, 246, 0.8)",borderColor:"rgb(59, 130, 246)",borderWidth:1},{label:"CNG (kg)",data:t.cngData||[400,380,420,390],backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgb(16, 185, 129)",borderWidth:1},{label:"Electric (kWh)",data:t.electricData||[500,520,480,510],backgroundColor:"rgba(251, 146, 60, 0.8)",borderColor:"rgb(251, 146, 60)",borderWidth:1}]},o={labels:["Scheduled","Completed","Overdue","In Progress"],datasets:[{data:t.maintenanceStatus||[12,8,3,2],backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(239, 68, 68, 0.8)","rgba(251, 146, 60, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(239, 68, 68)","rgb(251, 146, 60)"],borderWidth:1}]},l={labels:["Speed Compliance","Fuel Efficiency","Punctuality","Safety Score","Passenger Comfort"],datasets:[{label:"Current Performance",data:t.currentPerformance||[85,78,92,95,88],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.2)",pointBackgroundColor:"rgb(59, 130, 246)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(59, 130, 246)"},{label:"Target Performance",data:t.targetPerformance||[90,85,95,98,90],borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",pointBackgroundColor:"rgb(239, 68, 68)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(239, 68, 68)",borderDash:[5,5]}]},c=Le(Le({},r),{},{plugins:Le(Le({},r.plugins),{},{legend:{position:"bottom"}})}),d=Le(Le({},r),{},{scales:{r:{beginAtZero:!0,max:100,ticks:{stepSize:20}}}});return(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Fleet Utilization Trend"}),(0,ze.jsx)("div",{className:"h-64",children:(0,ze.jsx)(EN,{ref:n.utilization,data:s,options:r})}),(0,ze.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-gray-600",children:"Average"}),(0,ze.jsxs)("p",{className:"text-xl font-bold text-blue-600",children:[t.avgUtilization||"84.3","%"]})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-gray-600",children:"Peak"}),(0,ze.jsxs)("p",{className:"text-xl font-bold text-green-600",children:[t.peakUtilization||"90","%"]})]}),(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-gray-600",children:"Low"}),(0,ze.jsxs)("p",{className:"text-xl font-bold text-red-600",children:[t.lowUtilization||"70","%"]})]})]})]}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Fuel Consumption by Type"}),(0,ze.jsx)("div",{className:"h-64",children:(0,ze.jsx)(AN,{ref:n.fuel,data:a,options:r})}),(0,ze.jsxs)("div",{className:"mt-4 flex items-center justify-between text-sm",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-gray-600",children:"Total Cost"}),(0,ze.jsxs)("p",{className:"text-xl font-bold text-gray-800",children:["$",t.totalFuelCost||"45,320"]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("p",{className:"text-gray-600",children:"Efficiency"}),(0,ze.jsxs)("p",{className:"text-xl font-bold text-green-600",children:[t.fuelEfficiency||"5.2"," km/L"]})]})]})]}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Maintenance Status"}),(0,ze.jsx)("div",{className:"h-64",children:(0,ze.jsx)(DN,{ref:n.maintenance,data:o,options:c})}),(0,ze.jsxs)("div",{className:"mt-4 text-center",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Compliance Rate"}),(0,ze.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[t.maintenanceCompliance||"88.5","%"]})]})]}),(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Performance Metrics"}),(0,ze.jsx)("div",{className:"h-64",children:(0,ze.jsx)(MN,{ref:n.performance,data:l,options:d})}),(0,ze.jsxs)("div",{className:"mt-4 text-center",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:"Overall Score"}),(0,ze.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[t.overallScore||"87.6","/100"]})]})]})]})},PN=e=>{let{buses:t=[]}=e;const n=[...t].sort((e,t)=>new Date(e.nextMaintenance||e.lastMaintenance)-new Date(t.nextMaintenance||t.lastMaintenance)),i=e=>{switch(e){case"overdue":return"bg-red-100 text-red-800 border-red-200";case"urgent":return"bg-orange-100 text-orange-800 border-orange-200";case"upcoming":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"scheduled":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},r=e=>{switch(e){case"overdue":return(0,ze.jsx)(gd,{className:"w-4 h-4"});case"urgent":return(0,ze.jsx)(td,{className:"w-4 h-4"});case"upcoming":return(0,ze.jsx)(Tn,{className:"w-4 h-4"});case"scheduled":return(0,ze.jsx)(xd,{className:"w-4 h-4"});default:return(0,ze.jsx)(Lg,{className:"w-4 h-4"})}},s=e=>e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Not scheduled",a=e=>{switch(e){case"Major Service":return"$2,500 - $3,500";case"Intermediate Service":return"$800 - $1,200";case"Regular Service":return"$300 - $500";default:return"TBD"}};return(0,ze.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:0===n.length?(0,ze.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,ze.jsx)(gf,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,ze.jsx)("p",{children:"No maintenance schedules available"})]}):(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"}),n.slice(0,10).map((e,t)=>{const n=(e=>{if(!e.nextMaintenance)return"unknown";const t=new Date(e.nextMaintenance),n=new Date,i=Math.ceil((t-n)/864e5);return i<0?"overdue":i<=7?"urgent":i<=30?"upcoming":"scheduled"})(e),o=(e=>{const t=e.odometerReading||0,n=new Date(e.lastMaintenance),i=Math.floor((new Date-n)/864e5);return t>1e5||i>365?"Major Service":t>5e4||i>180?"Intermediate Service":"Regular Service"})(e),l=(e=>{if(!e)return null;const t=new Date(e),n=new Date;return Math.ceil((t-n)/864e5)})(e.nextMaintenance);return(0,ze.jsxs)($c.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"relative flex items-start gap-4 group",children:[(0,ze.jsx)("div",{className:"relative z-10 flex items-center justify-center w-8 h-8 rounded-full ".concat(i(n)," border-2"),children:r(n)}),(0,ze.jsx)("div",{className:"flex-1 pb-6",children:(0,ze.jsxs)("div",{className:"p-4 rounded-lg border ".concat(i(n)," hover:shadow-md transition-shadow"),children:[(0,ze.jsxs)("div",{className:"flex items-start justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("h5",{className:"font-semibold text-gray-800",children:[e.busNumber," - ",e.registrationNumber]}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:o})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("p",{className:"text-sm font-medium",children:s(e.nextMaintenance)}),null!==l&&(0,ze.jsx)("p",{className:"text-xs mt-1 ".concat(l<0?"text-red-600 font-bold":l<=7?"text-orange-600":"text-gray-500"),children:l<0?"".concat(Math.abs(l)," days overdue"):0===l?"Today":"In ".concat(l," days")})]})]}),(0,ze.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 flex items-center justify-between text-xs",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-4",children:[(0,ze.jsxs)("span",{className:"flex items-center gap-1 text-gray-600",children:[(0,ze.jsx)(td,{className:"w-3 h-3"}),"Last: ",s(e.lastMaintenance)]}),(0,ze.jsxs)("span",{className:"flex items-center gap-1 text-gray-600",children:[(0,ze.jsx)(Mn,{className:"w-3 h-3"}),"Est: ",a(o)]})]}),e.odometerReading&&(0,ze.jsxs)("span",{className:"text-gray-500",children:[e.odometerReading.toLocaleString()," km"]})]})]})})]},e._id)}),n.length>10&&(0,ze.jsx)("div",{className:"text-center py-2",children:(0,ze.jsxs)("p",{className:"text-sm text-gray-500",children:["+",n.length-10," more scheduled"]})})]})})},RN=wn("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);class LN{constructor(e,t,n,i,r){this._legacyCanvasSize=LN.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),n&&"object"===typeof n?this._onDecode=t:(n||i||r?console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future"):console.warn("Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t="object"===typeof n?n:{},this._onDecodeError=t.onDecodeError||("function"===typeof n?n:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||("function"===typeof i?i:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||r||this._preferredCamera,this._legacyCanvasSize="number"===typeof n?n:"number"===typeof i?i:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let s=!1;if(e.hidden&&(e.hidden=!1,s=!0),document.body.contains(e)||(document.body.appendChild(e),s=!0),n=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(i=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),(r=this.$overlay.style).position="absolute",r.display="none",r.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!i&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch(a){}n.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let t=window.getComputedStyle(e);"none"===t.display&&(e.style.setProperty("display","block","important"),s=!0),"visible"!==t.visibility&&(e.style.setProperty("visibility","visible","important"),s=!0),s&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=LN.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await LN.listCameras(!1)).length}catch(Sd){return!1}}static async listCameras(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!navigator.mediaDevices)return[];let t,n=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);try{e&&(await n()).every(e=>!e.label)&&(t=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch(Dd){}try{return(await n()).map((e,t)=>({id:e.deviceId,label:e.label||(0===t?"Default Camera":"Camera ".concat(t+1))}))}finally{t&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),LN._stopVideoStream(t))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch(t){return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),LN._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(Sd){throw this._flashOn=!1,Sd}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),LN._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&("https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?LN._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(Sd){if(!this._paused)throw this._active=!1,Sd}}stop(){this.pause(),this._active=!1}async pause(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(LN._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(e=>setTimeout(e,300)),!!this._paused&&(t(),!0))}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,n,i){let r,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(r=t.scanRegion,n=t.qrEngine,i=t.canvas,s=t.disallowCanvasResizing||!1,a=t.alsoTryWithoutScanRegion||!1,o=!0):t||n||i||s||a?console.warn("You're using a deprecated api for scanImage which will be removed in the future."):console.warn("Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!n;try{let l,c,d;if([n,l]=await Promise.all([n||LN.createQrEngine(),LN._loadImage(e)]),[i,c]=LN._drawToCanvas(l,r,i,s),n instanceof Worker){let e=n;t||LN._postWorkerMessageSync(e,"inversionMode","both"),d=await new Promise((t,n)=>{let s,a,o,l=-1;a=i=>{i.data.id===l&&(e.removeEventListener("message",a),e.removeEventListener("error",o),clearTimeout(s),null!==i.data.data?t({data:i.data.data,cornerPoints:LN._convertPoints(i.data.cornerPoints,r)}):n(LN.NO_QR_CODE_FOUND))},o=t=>{e.removeEventListener("message",a),e.removeEventListener("error",o),clearTimeout(s),n("Scanner error: "+(t?t.message||t:"Unknown Error"))},e.addEventListener("message",a),e.addEventListener("error",o),s=setTimeout(()=>o("timeout"),1e4);let d=c.getImageData(0,0,i.width,i.height);l=LN._postWorkerMessageSync(e,"decode",d,[d.data.buffer])})}else d=await Promise.race([new Promise((e,t)=>window.setTimeout(()=>t("Scanner error: timeout"),1e4)),(async()=>{try{var[t]=await n.detect(i);if(!t)throw LN.NO_QR_CODE_FOUND;return{data:t.rawValue,cornerPoints:LN._convertPoints(t.cornerPoints,r)}}catch(Nd){if(t=Nd.message||Nd,/not implemented|service unavailable/.test(t))return LN._disableBarcodeDetector=!0,LN.scanImage(e,{scanRegion:r,canvas:i,disallowCanvasResizing:s,alsoTryWithoutScanRegion:a});throw"Scanner error: ".concat(t)}})()]);return o?d:d.data}catch(l){if(!r||!a)throw l;let t=await LN.scanImage(e,{qrEngine:n,canvas:i,disallowCanvasResizing:s});return o?t:t.data}finally{t||LN._postWorkerMessage(n,"close")}}setGrayscaleWeights(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];LN._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:n,useIntegerApproximation:i})}setInversionMode(e){LN._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>n.e(451).then(n.bind(n,9451)).then(e=>e.createWorker()),LN._disableBarcodeDetector||!("BarcodeDetector"in window)||!BarcodeDetector.getSupportedFormats||!(await BarcodeDetector.getSupportedFormats()).includes("qr_code"))return e();let t=navigator.userAgentData;return t&&t.brands.some(e=>{let{brand:t}=e;return/Chromium/i.test(t)})&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(e=>{let{architecture:t,platformVersion:n}=e;return/arm/i.test(t||"arm")&&13<=parseInt(n||"13")}).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(2/3*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,n=e.videoHeight,i=e.offsetWidth,r=e.offsetHeight,s=e.offsetLeft,a=e.offsetTop,o=window.getComputedStyle(e),l=o.objectFit,c=t/n,d=i/r;switch(l){case"none":var u=t,h=n;break;case"fill":u=i,h=r;break;default:("cover"===l?c>d:c<d)?u=(h=r)*c:h=(u=i)/c,"scale-down"===l&&(u=Math.min(u,t),h=Math.min(h,n))}var[p,m]=o.objectPosition.split(" ").map((e,t)=>{const n=parseFloat(e);return e.endsWith("%")?(t?r-h:i-u)*n/100:n});o=this._scanRegion.width||t,d=this._scanRegion.height||n,l=this._scanRegion.x||0;var f=this._scanRegion.y||0;(c=this.$overlay.style).width="".concat(o/t*u,"px"),c.height="".concat(d/n*h,"px"),c.top="".concat(a+m+f/n*h,"px"),n=/scaleX\(-1\)/.test(e.style.transform),c.left="".concat(s+(n?i-p-u:p)+(n?t-l-o:l)/t*u,"px"),c.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let n=t.x||0,i=t.y||0,r=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let s of e)s.x=s.x*r+n,s.y=s.y*t+i;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(n=>setTimeout(n,t-e)),this._lastScanTimestamp=Date.now();try{var n=await LN.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(Dd){if(!this._active)return;this._onDecodeError(Dd)}!LN._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=LN.createQrEngine()),n?(this._onDecode?this._onDecode(n):this._legacyOnDecode&&this._legacyOnDecode(n.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox","".concat(this._scanRegion.x||0," ")+"".concat(this._scanRegion.y||0," ")+"".concat(this._scanRegion.width||this.$video.videoWidth," ")+"".concat(this._scanRegion.height||this.$video.videoHeight)),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",n.cornerPoints.map(e=>{let{x:t,y:n}=e;return"".concat(t,",").concat(n)}).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==LN.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],n=t.map(t=>Object.assign({},t,{[e]:{exact:this._preferredCamera}}));for(let i of[...n,...t])try{let e=await navigator.mediaDevices.getUserMedia({video:i,audio:!1});return{stream:e,facingMode:this._getFacingMode(e)||(i.facingMode?this._preferredCamera:"environment"===this._preferredCamera?"user":"environment")}}catch(Id){}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+("user"===e?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n=n||document.createElement("canvas");let r=t&&t.x?t.x:0,s=t&&t.y?t.y:0,a=t&&t.width?t.width:e.videoWidth||e.width,o=t&&t.height?t.height:e.videoHeight||e.height;return i||(i=t&&t.downScaledWidth?t.downScaledWidth:a,t=t&&t.downScaledHeight?t.downScaledHeight:o,n.width!==i&&(n.width=i),n.height!==t&&(n.height=t)),(t=n.getContext("2d",{alpha:!1})).imageSmoothingEnabled=!1,t.drawImage(e,r,s,a,o,0,0,n.width,n.height),[n,t]}static async _loadImage(e){if(e instanceof Image)return await LN._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(!(e instanceof File||e instanceof Blob||e instanceof URL||"string"===typeof e))throw"Unsupported image type.";{let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await LN._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}}static async _awaitImageLoad(e){e.complete&&0!==e.naturalWidth||await new Promise((t,n)=>{let i=r=>{e.removeEventListener("load",i),e.removeEventListener("error",i),r instanceof ErrorEvent?n("Image load error"):t()};e.addEventListener("load",i),e.addEventListener("error",i)})}static async _postWorkerMessage(e,t,n,i){return LN._postWorkerMessageSync(await e,t,n,i)}static _postWorkerMessageSync(e,t,n,i){if(!(e instanceof Worker))return-1;let r=LN._workerMessageId++;return e.postMessage({id:r,type:t,data:n},i),r}}LN.DEFAULT_CANVAS_SIZE=400,LN.NO_QR_CODE_FOUND="No QR code found",LN._disableBarcodeDetector=!1,LN._workerMessageId=0;const zN=LN,ON=e=>{let{onScan:t,onClose:n}=e;const[r,s]=(0,i.useState)(!1),[a,o]=(0,i.useState)(null),[l,c]=(0,i.useState)(null),[d,u]=(0,i.useState)("camera"),h=(0,i.useRef)(null),p=(0,i.useRef)(null),m=(0,i.useRef)(null);(0,i.useEffect)(()=>("camera"===d&&h.current&&!p.current&&f(),()=>{p.current&&(p.current.destroy(),p.current=null)}),[d]);const f=async()=>{try{s(!0),c(null);const e=new zN(h.current,e=>g(e),{onDecodeError:e=>{console.error("Decode error:",e)},highlightScanRegion:!0,highlightCodeOutline:!0,maxScansPerSecond:5});await e.start(),p.current=e}catch(BS){console.error("Scanner initialization error:",BS),c("Failed to access camera. Please check permissions."),s(!1)}},g=e=>{if(null!==e&&void 0!==e&&e.data){o(e.data),s(!1),p.current&&p.current.stop();try{const n=JSON.parse(e.data);t(n)}catch(wd){t({raw:e.data})}}},x=()=>{o(null),c(null),"camera"===d&&f()};return(0,ze.jsx)(Tf,{children:(0,ze.jsx)($c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,ze.jsxs)($c.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[(0,ze.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,ze.jsx)(Pg,{className:"w-6 h-6"}),"QR Code Scanner"]}),(0,ze.jsx)("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:(0,ze.jsx)(Fn,{className:"w-5 h-5"})})]}),(0,ze.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,ze.jsxs)("button",{onClick:()=>u("camera"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-all ".concat("camera"===d?"bg-white text-blue-600":"bg-white/20 text-white hover:bg-white/30"),children:[(0,ze.jsx)(RN,{className:"w-4 h-4 inline mr-2"}),"Camera"]}),(0,ze.jsxs)("button",{onClick:()=>u("upload"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-all ".concat("upload"===d?"bg-white text-blue-600":"bg-white/20 text-white hover:bg-white/30"),children:[(0,ze.jsx)(vf,{className:"w-4 h-4 inline mr-2"}),"Upload"]})]})]}),(0,ze.jsxs)("div",{className:"p-6",children:["camera"===d?(0,ze.jsx)("div",{className:"space-y-4",children:!a&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsxs)("div",{className:"relative rounded-lg overflow-hidden bg-black aspect-square",children:[(0,ze.jsx)("video",{ref:h,className:"w-full h-full object-cover"}),r&&(0,ze.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,ze.jsx)("div",{className:"w-48 h-48 border-2 border-white rounded-lg animate-pulse"})})]}),(0,ze.jsx)("p",{className:"text-center text-sm text-gray-600",children:"Position the QR code within the frame to scan"})]})}):(0,ze.jsx)("div",{className:"space-y-4",children:(0,ze.jsxs)("div",{onClick:()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-blue-500 transition-colors",children:[(0,ze.jsx)(vf,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Click to upload QR code image"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"PNG, JPG up to 10MB"}),(0,ze.jsx)("input",{ref:m,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(t)try{c(null);const e=await zN.scanImage(t,{returnDetailedScanResult:!0});g(e)}catch(BS){console.error("File scan error:",BS),c("Failed to scan QR code from image")}},className:"hidden"})]})}),a&&(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,ze.jsxs)("div",{className:"flex items-start gap-3",children:[(0,ze.jsx)(xd,{className:"w-5 h-5 text-green-600 mt-0.5"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("h4",{className:"font-semibold text-green-800",children:"QR Code Scanned Successfully!"}),(0,ze.jsx)("p",{className:"text-sm text-green-700 mt-1 font-mono break-all",children:a})]})]}),(0,ze.jsx)("button",{onClick:x,className:"mt-3 text-sm text-green-600 hover:text-green-700 font-medium",children:"Scan another code"})]}),l&&(0,ze.jsxs)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,ze.jsxs)("div",{className:"flex items-start gap-3",children:[(0,ze.jsx)(yd,{className:"w-5 h-5 text-red-600 mt-0.5"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("h4",{className:"font-semibold text-red-800",children:"Scan Error"}),(0,ze.jsx)("p",{className:"text-sm text-red-700 mt-1",children:l})]})]}),(0,ze.jsx)("button",{onClick:x,className:"mt-3 text-sm text-red-600 hover:text-red-700 font-medium",children:"Try again"})]})]}),(0,ze.jsx)("div",{className:"bg-gray-50 px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,ze.jsx)("span",{children:"Powered by advanced QR technology"}),(0,ze.jsx)("span",{className:"flex items-center gap-1",children:r&&(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Scanning..."]})})]})})]})})})},FN=wn("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),BN=wn("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),VN=wn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),UN=e=>{let{insights:t={}}=e;const{recommendations:n=[],predictions:i=[],anomalies:r=[]}=t,s=e=>{switch(e){case"optimization":return(0,ze.jsx)(FN,{className:"w-5 h-5"});case"maintenance":return(0,ze.jsx)(An,{className:"w-5 h-5"});case"cost":return(0,ze.jsx)(Mn,{className:"w-5 h-5"});case"efficiency":return(0,ze.jsx)(Du,{className:"w-5 h-5"});case"safety":return(0,ze.jsx)(yd,{className:"w-5 h-5"});default:return(0,ze.jsx)(BN,{className:"w-5 h-5"})}},a=e=>{switch(e){case"high":return"text-red-600 bg-red-50";case"medium":return"text-yellow-600 bg-yellow-50";case"low":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};return(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,ze.jsx)(BN,{className:"w-4 h-4"}),"AI Recommendations"]}),(0,ze.jsx)("div",{className:"space-y-2",children:(0,ze.jsx)(Tf,{children:n.slice(0,3).map((e,t)=>(0,ze.jsx)($c.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.1*t},className:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:(0,ze.jsxs)("div",{className:"flex items-start gap-3",children:[(0,ze.jsx)("div",{className:"p-2 rounded-lg ".concat(a(e.priority)),children:s(e.type)}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-800",children:e.title}),(0,ze.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.description}),e.impact&&(0,ze.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs",children:[(0,ze.jsxs)("span",{className:"text-green-600 font-medium",children:["Impact: ",e.impact]}),e.savings&&(0,ze.jsxs)("span",{className:"text-blue-600",children:["Savings: $",e.savings]})]})]}),(0,ze.jsx)(VN,{className:"w-4 h-4 text-gray-400"})]})},e.id||t))})})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,ze.jsx)(Ou,{className:"w-4 h-4"}),"Predictive Analytics"]}),(0,ze.jsx)("div",{className:"space-y-2",children:i.slice(0,2).map((e,t)=>(0,ze.jsxs)("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.metric}),(0,ze.jsxs)("span",{className:"text-xs font-bold ".concat("up"===e.trend?"text-green-600":"text-red-600"),children:["up"===e.trend?"\u2191":"\u2193"," ",e.change,"%"]})]}),(0,ze.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,ze.jsx)("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-500",style:{width:"".concat(e.confidence,"%")}})}),(0,ze.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:[e.prediction," (Confidence: ",e.confidence,"%)"]})]},e.id||t))})]}),r.length>0&&(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,ze.jsx)(yd,{className:"w-4 h-4"}),"Anomaly Detection"]}),(0,ze.jsx)("div",{className:"space-y-2",children:r.slice(0,2).map((e,t)=>(0,ze.jsx)("div",{className:"p-3 bg-gradient-to-r from-red-50 to-orange-50 rounded-lg border border-red-200",children:(0,ze.jsxs)("div",{className:"flex items-start gap-2",children:[(0,ze.jsx)(fd,{className:"w-4 h-4 text-red-500 mt-0.5"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-800",children:e.title}),(0,ze.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.description}),(0,ze.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,ze.jsxs)("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded",children:["Severity: ",e.severity]}),(0,ze.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.detected).toLocaleTimeString()})]})]})]})},e.id||t))})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[(0,ze.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded-lg",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)(td,{className:"w-4 h-4 text-blue-600"}),(0,ze.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:"Next Update"})]}),(0,ze.jsx)("p",{className:"text-lg font-bold text-blue-800 mt-1",children:"5 min"})]}),(0,ze.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-3 rounded-lg",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)(Cf,{className:"w-4 h-4 text-green-600"}),(0,ze.jsx)("span",{className:"text-xs text-green-600 font-medium",children:"AI Accuracy"})]}),(0,ze.jsx)("p",{className:"text-lg font-bold text-green-800 mt-1",children:"94.5%"})]})]})]})};xw.register(...vN);const HN=e=>{let{title:t,value:n,icon:i,trend:r,color:s}=e;return(0,ze.jsx)($c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl shadow-lg p-6",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:t}),(0,ze.jsx)("p",{className:"text-2xl font-bold mt-1",children:n}),(0,ze.jsxs)("div",{className:"flex items-center mt-2",children:[r>0?(0,ze.jsx)(Rg,{className:"w-4 h-4 text-green-500"}):(0,ze.jsx)(hh,{className:"w-4 h-4 text-red-500"}),(0,ze.jsxs)("span",{className:"text-sm ".concat(r>0?"text-green-500":"text-red-500"),children:[Math.abs(r),"%"]})]})]}),(0,ze.jsx)("div",{className:"p-3 rounded-lg ".concat({blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",purple:"bg-purple-100 text-purple-600",orange:"bg-orange-100 text-orange-600"}[s]),children:i})]})})},qN=e=>{var t;let{bus:n,liveData:i,onEdit:r,onDelete:s,onView:a,onSelect:o,isSelected:l,onAssignRoute:c,onRemoveRoute:d,onScheduleMaintenance:u,onCompleteMaintenance:h,onViewMaintenance:p}=e;return(0,ze.jsx)($c.div,{whileHover:{scale:1.02},className:"bg-white rounded-xl shadow-lg overflow-hidden border-2 ".concat(l?"border-blue-500":"border-transparent"),children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("input",{type:"checkbox",checked:l,onChange:o,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,ze.jsx)("h3",{className:"text-lg font-semibold",children:(null===n||void 0===n?void 0:n.busNumber)||"Unknown"})]}),(0,ze.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat({active:"bg-green-100 text-green-800",maintenance:"bg-yellow-100 text-yellow-800",inactive:"bg-red-100 text-red-800"}[null===n||void 0===n?void 0:n.status]||"bg-gray-100 text-gray-800"),children:(null===n||void 0===n?void 0:n.status)||"Unknown"})]}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(id,{className:"w-4 h-4 mr-2"}),null!==i&&void 0!==i&&i.location?"".concat(i.location.lat,", ").concat(i.location.lng):"Location unavailable"]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(xf,{className:"w-4 h-4 mr-2"}),"Fuel: ",(null===n||void 0===n?void 0:n.fuelLevel)||0,"%"]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(Nn,{className:"w-4 h-4 mr-2"}),"Capacity: ",(null===n||void 0===n?void 0:n.occupancy)||0,"/",(null===n||void 0===n||null===(t=n.capacity)||void 0===t?void 0:t.total)||0]}),(null===i||void 0===i?void 0:i.speed)&&(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(yf,{className:"w-4 h-4 mr-2"}),"Speed: ",i.speed," km/h"]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(kn,{className:"w-4 h-4 mr-2"}),null!==n&&void 0!==n&&n.assignedRoute?(0,ze.jsx)("span",{className:"text-blue-600",children:n.assignedRoute.routeName||n.assignedRoute.routeNumber||"Route Assigned"}):(0,ze.jsx)("span",{className:"text-gray-400",children:"No route assigned"})]})]}),(0,ze.jsxs)("div",{className:"space-y-2 mt-4 pt-4 border-t",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsxs)("button",{onClick:a,className:"flex-1 px-3 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 flex items-center justify-center gap-1",children:[(0,ze.jsx)(xh,{className:"w-4 h-4"}),"View"]}),(0,ze.jsxs)("button",{onClick:r,className:"flex-1 px-3 py-2 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100 flex items-center justify-center gap-1",children:[(0,ze.jsx)(Rm,{className:"w-4 h-4"}),"Edit"]}),(0,ze.jsx)("button",{onClick:s,className:"p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})})]}),(0,ze.jsx)("div",{className:"flex items-center gap-2",children:null!==n&&void 0!==n&&n.assignedRoute?(0,ze.jsxs)("button",{onClick:d,className:"flex-1 px-3 py-1 bg-orange-50 text-orange-600 rounded text-sm hover:bg-orange-100 flex items-center justify-center gap-1",children:[(0,ze.jsx)(Fm,{className:"w-3 h-3"}),"Unassign Route"]}):(0,ze.jsxs)("button",{onClick:c,className:"flex-1 px-3 py-1 bg-green-50 text-green-600 rounded text-sm hover:bg-green-100 flex items-center justify-center gap-1",children:[(0,ze.jsx)(kn,{className:"w-3 h-3"}),"Assign Route"]})}),(0,ze.jsxs)("div",{className:"flex items-center gap-1 mt-2",children:["maintenance"===(null===n||void 0===n?void 0:n.status)?(0,ze.jsxs)("button",{onClick:h,className:"flex-1 px-2 py-1 bg-green-50 text-green-600 rounded text-xs hover:bg-green-100 flex items-center justify-center gap-1",children:[(0,ze.jsx)(xd,{className:"w-3 h-3"}),"Complete"]}):(0,ze.jsxs)("button",{onClick:u,className:"flex-1 px-2 py-1 bg-yellow-50 text-yellow-600 rounded text-xs hover:bg-yellow-100 flex items-center justify-center gap-1",children:[(0,ze.jsx)(gf,{className:"w-3 h-3"}),"Schedule"]}),(0,ze.jsxs)("button",{onClick:p,className:"flex-1 px-2 py-1 bg-gray-50 text-gray-600 rounded text-xs hover:bg-gray-100 flex items-center justify-center gap-1",children:[(0,ze.jsx)(Lg,{className:"w-3 h-3"}),"History"]})]})]})]})})},WN=e=>{let{alert:t}=e;return(0,ze.jsx)($c.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"p-4 rounded-lg border ".concat({critical:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",info:"bg-blue-50 border-blue-200 text-blue-800"}[t.type]),children:(0,ze.jsxs)("div",{className:"flex items-start gap-3",children:[(0,ze.jsx)(gd,{className:"w-5 h-5 mt-0.5"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("p",{className:"font-medium",children:t.title}),(0,ze.jsx)("p",{className:"text-sm mt-1",children:t.message}),(0,ze.jsx)("p",{className:"text-xs mt-2 opacity-75",children:new Date(t.timestamp).toLocaleString()})]})]})})},GN=e=>{let{onClose:t,onSave:n}=e;const[r,s]=(0,i.useState)({busNumber:"",registrationNumber:"",busType:"ac_seater",capacity:{total:0,seater:0,sleeper:0,ladies:0,disabled:0},depotId:"",assignedDriverId:"",assignedConductorId:"",status:"active",fuelType:"diesel",manufacturingYear:(new Date).getFullYear(),manufacturer:"",model:"",chassisNumber:"",engineNumber:"",insuranceDetails:{policyNumber:"",expiryDate:"",provider:""},lastMaintenance:"",nextMaintenance:"",odometerReading:0,notes:""}),[a,o]=(0,i.useState)([]),[l,c]=(0,i.useState)([]),[d,u]=(0,i.useState)([]),[h,p]=(0,i.useState)(!1),[m,f]=(0,i.useState)(!1),[g,x]=(0,i.useState)({}),[y,v]=(0,i.useState)(null),[_,b]=(0,i.useState)(null);(0,i.useEffect)(()=>{w()},[]);const w=async()=>{f(!0);try{const[t,n,i]=await Promise.all([rh("/api/admin/all-drivers"),rh("/api/admin/conductors"),rh("/api/admin/depots")]);var e;if(t.ok&&o(t.data||[]),n.ok&&c(n.data||[]),i.ok)u((null===(e=i.data)||void 0===e?void 0:e.depots)||i.data||[])}catch(t){console.error("Error fetching staff and depots:",t),ou.error("Failed to load staff and depot data")}finally{f(!1)}};return(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New Bus"}),(0,ze.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,ze.jsx)(Fm,{className:"w-5 h-5"})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};r.busNumber.trim()||(e.busNumber="Bus number is required"),r.registrationNumber.trim()||(e.registrationNumber="Registration number is required"),r.depotId||(e.depotId="Depot selection is required"),(!r.capacity.total||r.capacity.total<=0)&&(e.capacityTotal="Total capacity must be greater than 0"),(!r.manufacturingYear||r.manufacturingYear<1900)&&(e.manufacturingYear="Valid manufacturing year is required");const{total:t,seater:n,sleeper:i,ladies:s,disabled:a}=r.capacity;return n+i>t&&(e.capacityBreakdown="Seater + Sleeper cannot exceed total capacity"),x(e),0===Object.keys(e).length})()){p(!0);try{const e=Le(Le({},r),{},{capacity:Le(Le({},r.capacity),{},{total:parseInt(r.capacity.total),seater:parseInt(r.capacity.seater)||0,sleeper:parseInt(r.capacity.sleeper)||0,ladies:parseInt(r.capacity.ladies)||0,disabled:parseInt(r.capacity.disabled)||0}),manufacturingYear:parseInt(r.manufacturingYear),odometerReading:parseInt(r.odometerReading)||0});await n(e)}catch(t){console.error("Error saving bus:",t),ou.error("Failed to save bus")}finally{p(!1)}}else ou.error("Please fix the errors before submitting")},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bus Number *"}),(0,ze.jsx)("input",{type:"text",value:r.busNumber,onChange:e=>s(Le(Le({},r),{},{busNumber:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(g.busNumber?"border-red-500":"border-gray-300"),placeholder:"e.g., KA01AB1234"}),g.busNumber&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.busNumber})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Registration Number *"}),(0,ze.jsx)("input",{type:"text",value:r.registrationNumber,onChange:e=>s(Le(Le({},r),{},{registrationNumber:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(g.registrationNumber?"border-red-500":"border-gray-300"),placeholder:"e.g., KA01AB1234"}),g.registrationNumber&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.registrationNumber})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bus Type *"}),(0,ze.jsx)("select",{value:r.busType,onChange:e=>s(Le(Le({},r),{},{busType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{value:"ac_sleeper",label:"AC Sleeper"},{value:"ac_seater",label:"AC Seater"},{value:"non_ac_sleeper",label:"Non-AC Sleeper"},{value:"non_ac_seater",label:"Non-AC Seater"},{value:"volvo",label:"Volvo"},{value:"mini",label:"Mini Bus"}].map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot *"}),(0,ze.jsxs)("select",{value:r.depotId,onChange:e=>s(Le(Le({},r),{},{depotId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(g.depotId?"border-red-500":"border-gray-300"),disabled:m,children:[(0,ze.jsx)("option",{value:"",children:"Select Depot"}),d.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.depotName," (",e.depotCode,")"]},e._id))]}),g.depotId&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.depotId})]})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Capacity Information"}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Capacity *"}),(0,ze.jsx)("input",{type:"number",value:r.capacity.total,onChange:e=>s(Le(Le({},r),{},{capacity:Le(Le({},r.capacity),{},{total:e.target.value})})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(g.capacityTotal?"border-red-500":"border-gray-300"),min:"1"}),g.capacityTotal&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.capacityTotal})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seater"}),(0,ze.jsx)("input",{type:"number",value:r.capacity.seater,onChange:e=>s(Le(Le({},r),{},{capacity:Le(Le({},r.capacity),{},{seater:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sleeper"}),(0,ze.jsx)("input",{type:"number",value:r.capacity.sleeper,onChange:e=>s(Le(Le({},r),{},{capacity:Le(Le({},r.capacity),{},{sleeper:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ladies"}),(0,ze.jsx)("input",{type:"number",value:r.capacity.ladies,onChange:e=>s(Le(Le({},r),{},{capacity:Le(Le({},r.capacity),{},{ladies:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Disabled"}),(0,ze.jsx)("input",{type:"number",value:r.capacity.disabled,onChange:e=>s(Le(Le({},r),{},{capacity:Le(Le({},r.capacity),{},{disabled:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]})]}),g.capacityBreakdown&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-2",children:g.capacityBreakdown})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Staff Assignment"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Driver"}),(0,ze.jsxs)("select",{value:r.assignedDriverId,onChange:e=>s(Le(Le({},r),{},{assignedDriverId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m,children:[(0,ze.jsx)("option",{value:"",children:"Select Driver"}),a.map(e=>{var t;return(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.driverId,") - ",(null===(t=e.drivingLicense)||void 0===t?void 0:t.licenseType)||"N/A"]},e._id)})]}),m&&(0,ze.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Loading drivers..."})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Conductor"}),(0,ze.jsxs)("select",{value:r.assignedConductorId,onChange:e=>s(Le(Le({},r),{},{assignedConductorId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m,children:[(0,ze.jsx)("option",{value:"",children:"Select Conductor"}),l.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.conductorId,") - ",e.badgeNumber||"N/A"]},e._id))]}),m&&(0,ze.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Loading conductors..."})]})]})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Vehicle Details"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manufacturer"}),(0,ze.jsx)("input",{type:"text",value:r.manufacturer,onChange:e=>s(Le(Le({},r),{},{manufacturer:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Tata, Ashok Leyland"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model"}),(0,ze.jsx)("input",{type:"text",value:r.model,onChange:e=>s(Le(Le({},r),{},{model:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Starbus, Ultra"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manufacturing Year *"}),(0,ze.jsx)("input",{type:"number",value:r.manufacturingYear,onChange:e=>s(Le(Le({},r),{},{manufacturingYear:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(g.manufacturingYear?"border-red-500":"border-gray-300"),min:"1900",max:(new Date).getFullYear()+1}),g.manufacturingYear&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.manufacturingYear})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Type"}),(0,ze.jsx)("select",{value:r.fuelType,onChange:e=>s(Le(Le({},r),{},{fuelType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{value:"diesel",label:"Diesel"},{value:"petrol",label:"Petrol"},{value:"cng",label:"CNG"},{value:"electric",label:"Electric"},{value:"hybrid",label:"Hybrid"}].map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chassis Number"}),(0,ze.jsx)("input",{type:"text",value:r.chassisNumber,onChange:e=>s(Le(Le({},r),{},{chassisNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Engine Number"}),(0,ze.jsx)("input",{type:"text",value:r.engineNumber,onChange:e=>s(Le(Le({},r),{},{engineNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Bus Image"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsx)("div",{className:"flex-1",children:(0,ze.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){v(t);const e=new FileReader;e.onloadend=()=>{b(e.result)},e.readAsDataURL(t)}},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),_&&(0,ze.jsx)("div",{className:"w-20 h-20 rounded-lg overflow-hidden border",children:(0,ze.jsx)("img",{src:_,alt:"Preview",className:"w-full h-full object-cover"})})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,ze.jsx)("textarea",{value:r.notes,onChange:e=>s(Le(Le({},r),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Additional notes about the bus..."})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t",children:[(0,ze.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",disabled:h,children:"Cancel"}),(0,ze.jsxs)("button",{type:"submit",disabled:h||m,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[h&&(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),(0,ze.jsx)("span",{children:h?"Adding...":"Add Bus"})]})]})]})]})})},YN=e=>{var t,n,r,s,a,o,l,c,d,u,h;let{bus:p,onClose:m,onSave:f}=e;const[g,x]=(0,i.useState)({busNumber:p.busNumber||"",registrationNumber:p.registrationNumber||"",busType:p.busType||"ac_seater",capacity:{total:(null===(t=p.capacity)||void 0===t?void 0:t.total)||0,seater:(null===(n=p.capacity)||void 0===n?void 0:n.seater)||0,sleeper:(null===(r=p.capacity)||void 0===r?void 0:r.sleeper)||0,ladies:(null===(s=p.capacity)||void 0===s?void 0:s.ladies)||0,disabled:(null===(a=p.capacity)||void 0===a?void 0:a.disabled)||0},depotId:(null===(o=p.depotId)||void 0===o?void 0:o._id)||p.depotId||"",assignedDriverId:(null===(l=p.assignedDriverId)||void 0===l?void 0:l._id)||p.assignedDriverId||"",assignedConductorId:(null===(c=p.assignedConductorId)||void 0===c?void 0:c._id)||p.assignedConductorId||"",status:p.status||"active",fuelType:p.fuelType||"diesel",manufacturingYear:p.manufacturingYear||(new Date).getFullYear(),manufacturer:p.manufacturer||"",model:p.model||"",chassisNumber:p.chassisNumber||"",engineNumber:p.engineNumber||"",insuranceDetails:{policyNumber:(null===(d=p.insuranceDetails)||void 0===d?void 0:d.policyNumber)||"",expiryDate:(null===(u=p.insuranceDetails)||void 0===u?void 0:u.expiryDate)||"",provider:(null===(h=p.insuranceDetails)||void 0===h?void 0:h.provider)||""},lastMaintenance:p.lastMaintenance||"",nextMaintenance:p.nextMaintenance||"",odometerReading:p.odometerReading||0,notes:p.notes||""}),[y,v]=(0,i.useState)([]),[_,b]=(0,i.useState)([]),[w,j]=(0,i.useState)([]),[N,S]=(0,i.useState)(!1),[k,T]=(0,i.useState)(!1),[C,E]=(0,i.useState)({}),[A,M]=(0,i.useState)(null),[D,I]=(0,i.useState)(p.imageUrl||null);(0,i.useEffect)(()=>{P()},[]);const P=async()=>{T(!0);try{const[t,n,i]=await Promise.all([rh("/api/admin/all-drivers"),rh("/api/admin/conductors"),rh("/api/admin/depots")]);var e;if(t.ok&&v(t.data||[]),n.ok&&b(n.data||[]),i.ok)j((null===(e=i.data)||void 0===e?void 0:e.depots)||i.data||[])}catch(t){console.error("Error fetching staff and depots:",t),ou.error("Failed to load staff and depot data")}finally{T(!1)}};return(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[(0,ze.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Edit Bus - ",p.busNumber]}),(0,ze.jsx)("button",{onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,ze.jsx)(Fm,{className:"w-5 h-5"})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};g.busNumber.trim()||(e.busNumber="Bus number is required"),g.registrationNumber.trim()||(e.registrationNumber="Registration number is required"),g.depotId||(e.depotId="Depot selection is required"),(!g.capacity.total||g.capacity.total<=0)&&(e.capacityTotal="Total capacity must be greater than 0"),(!g.manufacturingYear||g.manufacturingYear<1900)&&(e.manufacturingYear="Valid manufacturing year is required");const{total:t,seater:n,sleeper:i,ladies:r,disabled:s}=g.capacity;return n+i>t&&(e.capacityBreakdown="Seater + Sleeper cannot exceed total capacity"),E(e),0===Object.keys(e).length})()){S(!0);try{const e=Le(Le({},g),{},{capacity:Le(Le({},g.capacity),{},{total:parseInt(g.capacity.total),seater:parseInt(g.capacity.seater)||0,sleeper:parseInt(g.capacity.sleeper)||0,ladies:parseInt(g.capacity.ladies)||0,disabled:parseInt(g.capacity.disabled)||0}),manufacturingYear:parseInt(g.manufacturingYear),odometerReading:parseInt(g.odometerReading)||0});await f(e)}catch(t){console.error("Error saving bus:",t),ou.error("Failed to save bus")}finally{S(!1)}}else ou.error("Please fix the errors before submitting")},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bus Number *"}),(0,ze.jsx)("input",{type:"text",value:g.busNumber,onChange:e=>x(Le(Le({},g),{},{busNumber:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(C.busNumber?"border-red-500":"border-gray-300"),placeholder:"e.g., KA01AB1234"}),C.busNumber&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:C.busNumber})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Registration Number *"}),(0,ze.jsx)("input",{type:"text",value:g.registrationNumber,onChange:e=>x(Le(Le({},g),{},{registrationNumber:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(C.registrationNumber?"border-red-500":"border-gray-300"),placeholder:"e.g., KA01AB1234"}),C.registrationNumber&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:C.registrationNumber})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bus Type *"}),(0,ze.jsx)("select",{value:g.busType,onChange:e=>x(Le(Le({},g),{},{busType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{value:"ac_sleeper",label:"AC Sleeper"},{value:"ac_seater",label:"AC Seater"},{value:"non_ac_sleeper",label:"Non-AC Sleeper"},{value:"non_ac_seater",label:"Non-AC Seater"},{value:"volvo",label:"Volvo"},{value:"mini",label:"Mini Bus"}].map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),(0,ze.jsx)("select",{value:g.status,onChange:e=>x(Le(Le({},g),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{value:"active",label:"Active"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"retired",label:"Retired"}].map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot *"}),(0,ze.jsxs)("select",{value:g.depotId,onChange:e=>x(Le(Le({},g),{},{depotId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(C.depotId?"border-red-500":"border-gray-300"),disabled:k,children:[(0,ze.jsx)("option",{value:"",children:"Select Depot"}),w.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.depotName," (",e.depotCode,")"]},e._id))]}),C.depotId&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:C.depotId})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Capacity Information"}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Capacity *"}),(0,ze.jsx)("input",{type:"number",value:g.capacity.total,onChange:e=>x(Le(Le({},g),{},{capacity:Le(Le({},g.capacity),{},{total:e.target.value})})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(C.capacityTotal?"border-red-500":"border-gray-300"),min:"1"}),C.capacityTotal&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:C.capacityTotal})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seater"}),(0,ze.jsx)("input",{type:"number",value:g.capacity.seater,onChange:e=>x(Le(Le({},g),{},{capacity:Le(Le({},g.capacity),{},{seater:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sleeper"}),(0,ze.jsx)("input",{type:"number",value:g.capacity.sleeper,onChange:e=>x(Le(Le({},g),{},{capacity:Le(Le({},g.capacity),{},{sleeper:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ladies"}),(0,ze.jsx)("input",{type:"number",value:g.capacity.ladies,onChange:e=>x(Le(Le({},g),{},{capacity:Le(Le({},g.capacity),{},{ladies:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Disabled"}),(0,ze.jsx)("input",{type:"number",value:g.capacity.disabled,onChange:e=>x(Le(Le({},g),{},{capacity:Le(Le({},g.capacity),{},{disabled:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]})]}),C.capacityBreakdown&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-2",children:C.capacityBreakdown})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Staff Assignment"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Driver"}),(0,ze.jsxs)("select",{value:g.assignedDriverId,onChange:e=>x(Le(Le({},g),{},{assignedDriverId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:k,children:[(0,ze.jsx)("option",{value:"",children:"Select Driver"}),y.map(e=>{var t;return(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.driverId,") - ",(null===(t=e.drivingLicense)||void 0===t?void 0:t.licenseType)||"N/A"]},e._id)})]}),k&&(0,ze.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Loading drivers..."})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Conductor"}),(0,ze.jsxs)("select",{value:g.assignedConductorId,onChange:e=>x(Le(Le({},g),{},{assignedConductorId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:k,children:[(0,ze.jsx)("option",{value:"",children:"Select Conductor"}),_.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.name," (",e.conductorId,") - ",e.badgeNumber||"N/A"]},e._id))]}),k&&(0,ze.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Loading conductors..."})]})]})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Vehicle Details"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manufacturer"}),(0,ze.jsx)("input",{type:"text",value:g.manufacturer,onChange:e=>x(Le(Le({},g),{},{manufacturer:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Tata, Ashok Leyland"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model"}),(0,ze.jsx)("input",{type:"text",value:g.model,onChange:e=>x(Le(Le({},g),{},{model:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Starbus, Ultra"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manufacturing Year *"}),(0,ze.jsx)("input",{type:"number",value:g.manufacturingYear,onChange:e=>x(Le(Le({},g),{},{manufacturingYear:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(C.manufacturingYear?"border-red-500":"border-gray-300"),min:"1900",max:(new Date).getFullYear()+1}),C.manufacturingYear&&(0,ze.jsx)("p",{className:"text-red-500 text-xs mt-1",children:C.manufacturingYear})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Type"}),(0,ze.jsx)("select",{value:g.fuelType,onChange:e=>x(Le(Le({},g),{},{fuelType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{value:"diesel",label:"Diesel"},{value:"petrol",label:"Petrol"},{value:"cng",label:"CNG"},{value:"electric",label:"Electric"},{value:"hybrid",label:"Hybrid"}].map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Odometer Reading"}),(0,ze.jsx)("input",{type:"number",value:g.odometerReading,onChange:e=>x(Le(Le({},g),{},{odometerReading:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]}),(0,ze.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Bus Image"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsx)("div",{className:"flex-1",children:(0,ze.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){M(t);const e=new FileReader;e.onloadend=()=>{I(e.result)},e.readAsDataURL(t)}},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),D&&(0,ze.jsx)("div",{className:"w-20 h-20 rounded-lg overflow-hidden border",children:(0,ze.jsx)("img",{src:D,alt:"Preview",className:"w-full h-full object-cover"})})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,ze.jsx)("textarea",{value:g.notes,onChange:e=>x(Le(Le({},g),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Additional notes about the bus..."})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t",children:[(0,ze.jsx)("button",{type:"button",onClick:m,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",disabled:N,children:"Cancel"}),(0,ze.jsxs)("button",{type:"submit",disabled:N||k,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[N&&(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),(0,ze.jsx)("span",{children:N?"Updating...":"Update Bus"})]})]})]})]})})},ZN=e=>{var t,n,r,s,a,o,l,c;let{buses:d,tracking:u,selectedBus:h,onBusSelect:p,routes:m}=e;const[f,g]=(0,i.useState)([19.076,72.8777]),[x,y]=(0,i.useState)(10),[v,_]=(0,i.useState)("all"),[b,w]=(0,i.useState)(""),[j,N]=(0,i.useState)(5e3),S=e=>{const t={active:"#10B981",maintenance:"#F59E0B",inactive:"#EF4444",retired:"#6B7280"};return t[e.status]||t.active},k=(()=>{switch(v){case"selected":return h?[h]:[];case"route":return b?d.filter(e=>{var t;return(null===(t=e.assignedRoute)||void 0===t?void 0:t._id)===b}):[];default:return d}})();return(0,ze.jsxs)("div",{className:"h-full flex flex-col",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4 p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(zg,{className:"w-5 h-5 text-blue-600"}),(0,ze.jsx)("span",{className:"font-medium text-gray-900",children:"Live Tracking"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,ze.jsx)("span",{className:"text-sm text-green-600",children:"Live"})]})]}),(0,ze.jsxs)("select",{value:v,onChange:e=>_(e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"Track All Buses"}),(0,ze.jsx)("option",{value:"selected",children:"Track Selected Bus"}),(0,ze.jsx)("option",{value:"route",children:"Track Route Buses"})]}),"route"===v&&(0,ze.jsxs)("select",{value:b,onChange:e=>w(e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Select Route"}),m.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.routeNumber," - ",e.routeName]},e._id))]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Refresh:"}),(0,ze.jsxs)("select",{value:j,onChange:e=>N(Number(e.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:2e3,children:"2s"}),(0,ze.jsx)("option",{value:5e3,children:"5s"}),(0,ze.jsx)("option",{value:1e4,children:"10s"}),(0,ze.jsx)("option",{value:3e4,children:"30s"})]}),(0,ze.jsxs)("span",{className:"text-sm text-gray-500",children:["Tracking ",k.length," buses"]})]})]}),(0,ze.jsxs)("div",{className:"flex-1 relative bg-gray-100 rounded-lg overflow-hidden",children:[(0,ze.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(Dg,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500 text-lg font-medium mb-2",children:"Interactive Map"}),(0,ze.jsx)("p",{className:"text-gray-400 text-sm",children:"Real-time bus tracking would be displayed here"}),(0,ze.jsxs)("div",{className:"mt-4 text-sm text-gray-500",children:["Center: [",f[0].toFixed(4),", ",f[1].toFixed(4),"] | Zoom: ",x]})]})}),(0,ze.jsxs)("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-lg p-4 max-w-sm",children:[(0,ze.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Bus Status"}),(0,ze.jsxs)("div",{className:"space-y-2",children:[k.slice(0,5).map(e=>{var t,n;return(0,ze.jsxs)("div",{className:"flex items-center justify-between p-2 rounded cursor-pointer transition-colors ".concat((null===h||void 0===h?void 0:h._id)===e._id?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"),onClick:()=>p(e),children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:S(e)}}),(0,ze.jsx)("span",{className:"text-sm font-medium",children:e.busNumber})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsxs)("div",{className:"text-xs text-gray-500",children:[(null===(t=u[e._id])||void 0===t?void 0:t.speed)||0," km/h"]}),(0,ze.jsx)("div",{className:"text-xs text-gray-400",children:null!==(n=u[e._id])&&void 0!==n&&n.lastUpdate?new Date(u[e._id].lastUpdate).toLocaleTimeString():"No data"})]})]},e._id)}),k.length>5&&(0,ze.jsxs)("div",{className:"text-xs text-gray-500 text-center pt-2",children:["+",k.length-5," more buses"]})]})]}),(0,ze.jsxs)("div",{className:"absolute bottom-4 right-4 bg-white rounded-lg shadow-lg p-4",children:[(0,ze.jsx)("h4",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Status Legend"}),(0,ze.jsxs)("div",{className:"space-y-1",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,ze.jsx)("span",{children:"Active"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),(0,ze.jsx)("span",{children:"Maintenance"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),(0,ze.jsx)("span",{children:"Inactive"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-gray-500 rounded-full"}),(0,ze.jsx)("span",{children:"Retired"})]})]})]})]}),h&&(0,ze.jsxs)("div",{className:"mt-4 bg-white border rounded-lg p-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,ze.jsxs)("h4",{className:"font-medium text-gray-900",children:["Bus Details - ",h.busNumber]}),(0,ze.jsx)("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-gray-600",children:(0,ze.jsx)(Fm,{className:"w-5 h-5"})})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Status:"}),(0,ze.jsx)("div",{className:"font-medium capitalize",children:h.status})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Route:"}),(0,ze.jsx)("div",{className:"font-medium",children:(null===(t=h.assignedRoute)||void 0===t?void 0:t.routeName)||"Not assigned"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Speed:"}),(0,ze.jsxs)("div",{className:"font-medium",children:[(null===(n=u[h._id])||void 0===n?void 0:n.speed)||0," km/h"]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Fuel:"}),(0,ze.jsxs)("div",{className:"font-medium",children:[(null===(r=u[h._id])||void 0===r?void 0:r.fuelLevel)||0,"%"]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Occupancy:"}),(0,ze.jsxs)("div",{className:"font-medium",children:[(null===(s=u[h._id])||void 0===s?void 0:s.occupancy)||0,"/",(null===(a=h.capacity)||void 0===a?void 0:a.total)||0]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Driver:"}),(0,ze.jsx)("div",{className:"font-medium",children:(null===(o=h.assignedDriver)||void 0===o?void 0:o.name)||"Not assigned"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Conductor:"}),(0,ze.jsx)("div",{className:"font-medium",children:(null===(l=h.assignedConductor)||void 0===l?void 0:l.name)||"Not assigned"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("span",{className:"text-gray-500",children:"Last Update:"}),(0,ze.jsx)("div",{className:"font-medium text-xs",children:null!==(c=u[h._id])&&void 0!==c&&c.lastUpdate?new Date(u[h._id].lastUpdate).toLocaleTimeString():"No data"})]})]})]})]})},XN=e=>{let{bus:t,onClose:n,onSave:r}=e;const[s,a]=(0,i.useState)({issueType:"",description:"",priority:"medium",scheduledDate:"",estimatedCost:0,assignedTechnician:"",notes:""}),[o,l]=(0,i.useState)(!1);return(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[(0,ze.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Schedule Maintenance - ",t.busNumber]}),(0,ze.jsx)("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,ze.jsx)(Fm,{className:"w-5 h-5"})})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),l(!0);try{await r(Le(Le({},s),{},{estimatedCost:parseFloat(s.estimatedCost)||0}))}catch(t){console.error("Error scheduling maintenance:",t)}finally{l(!1)}},className:"p-6 space-y-4",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Issue Type *"}),(0,ze.jsxs)("select",{value:s.issueType,onChange:e=>a(Le(Le({},s),{},{issueType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,ze.jsx)("option",{value:"",children:"Select Issue Type"}),["Engine Service","Brake System","Transmission","Electrical","Air Conditioning","Tyre Replacement","Body Work","Fuel System","Suspension","General Service"].map(e=>(0,ze.jsx)("option",{value:e,children:e},e))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority *"}),(0,ze.jsx)("select",{value:s.priority,onChange:e=>a(Le(Le({},s),{},{priority:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[{value:"low",label:"Low",color:"text-green-600"},{value:"medium",label:"Medium",color:"text-yellow-600"},{value:"high",label:"High",color:"text-red-600"},{value:"critical",label:"Critical",color:"text-red-800"}].map(e=>(0,ze.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Date *"}),(0,ze.jsx)("input",{type:"datetime-local",value:s.scheduledDate,onChange:e=>a(Le(Le({},s),{},{scheduledDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Cost (\u20b9)"}),(0,ze.jsx)("input",{type:"number",value:s.estimatedCost,onChange:e=>a(Le(Le({},s),{},{estimatedCost:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"0.01"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,ze.jsx)("textarea",{value:s.description,onChange:e=>a(Le(Le({},s),{},{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Describe the maintenance issue or service required...",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Technician"}),(0,ze.jsx)("input",{type:"text",value:s.assignedTechnician,onChange:e=>a(Le(Le({},s),{},{assignedTechnician:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Technician name or ID"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,ze.jsx)("textarea",{value:s.notes,onChange:e=>a(Le(Le({},s),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Additional notes or instructions..."})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[(0,ze.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",disabled:o,children:"Cancel"}),(0,ze.jsxs)("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[o&&(0,ze.jsx)(yh,{className:"w-4 h-4 animate-spin"}),(0,ze.jsx)("span",{children:o?"Scheduling...":"Schedule Maintenance"})]})]})]})]})})},KN=e=>{let{logs:t,onClose:n}=e;return(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Maintenance History"}),(0,ze.jsx)("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,ze.jsx)(Fm,{className:"w-5 h-5"})})]}),(0,ze.jsx)("div",{className:"p-6",children:0===t.length?(0,ze.jsxs)("div",{className:"text-center py-8",children:[(0,ze.jsx)(gf,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"No maintenance records found"})]}):(0,ze.jsx)("div",{className:"space-y-4",children:t.map((e,t)=>{var n;return(0,ze.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,ze.jsxs)("div",{className:"flex items-start justify-between",children:[(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,ze.jsx)("h4",{className:"font-medium text-gray-900",children:e.issueType}),(0,ze.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("completed"===e.status?"bg-green-100 text-green-800":"in-progress"===e.status?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:e.status}),(0,ze.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("critical"===e.priority?"bg-red-100 text-red-800":"high"===e.priority?"bg-orange-100 text-orange-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority})]}),(0,ze.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.description}),(0,ze.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,ze.jsxs)("span",{children:["Reported: ",new Date(e.reportedAt).toLocaleDateString()]}),e.resolvedAt&&(0,ze.jsxs)("span",{children:["Resolved: ",new Date(e.resolvedAt).toLocaleDateString()]}),e.assignedTechnician&&(0,ze.jsxs)("span",{children:["Technician: ",e.assignedTechnician]})]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsxs)("div",{className:"text-lg font-semibold text-gray-900",children:["\u20b9",(null===(n=e.cost)||void 0===n?void 0:n.toLocaleString())||0]}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:"Cost"})]})]})},t)})})})]})})},QN=()=>(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,ze.jsx)("div",{className:"lg:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((e,t)=>(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 animate-pulse",children:[(0,ze.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,ze.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2 mb-2"}),(0,ze.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]},t))}),(0,ze.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-lg p-6 animate-pulse",children:[(0,ze.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),(0,ze.jsx)("div",{className:"h-96 bg-gray-200 rounded"})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 animate-pulse",children:[(0,ze.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-4"}),(0,ze.jsx)("div",{className:"space-y-3",children:[...Array(5)].map((e,t)=>(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("div",{className:"h-3 bg-gray-200 rounded w-3/4 mb-1"}),(0,ze.jsx)("div",{className:"h-2 bg-gray-200 rounded w-1/2"})]})]},t))})]})]}),JN=()=>(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((e,t)=>(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-4 animate-pulse",children:[(0,ze.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-3"}),(0,ze.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-2"}),(0,ze.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]},t))}),$N=()=>(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 animate-pulse",children:[(0,ze.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),(0,ze.jsx)("div",{className:"h-96 bg-gray-200 rounded"})]}),eS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((e,t)=>(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 animate-pulse",children:[(0,ze.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,ze.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2 mb-2"}),(0,ze.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]},t))}),(0,ze.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(4)].map((e,t)=>(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 animate-pulse",children:[(0,ze.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),(0,ze.jsx)("div",{className:"h-64 bg-gray-200 rounded"})]},t))})]}),tS=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[s,a]=(0,i.useState)(""),[o,l]=(0,i.useState)({status:"all",depot:"all",busType:"all",fuelType:"all",page:1,limit:20,sortBy:"busNumber",sortOrder:"asc"}),[c,d]=(0,i.useState)(0),[u,h]=(0,i.useState)({page:1,limit:20,total:0,pages:0}),[p,m]=(0,i.useState)("dashboard"),[f,g]=(0,i.useState)(null),[x,y]=(0,i.useState)(!1),[v,_]=(0,i.useState)(!1),[b,w]=(0,i.useState)(!1),[j,N]=(0,i.useState)([]),[S,k]=(0,i.useState)(!1),[T,C]=(0,i.useState)(!1),[E,A]=(0,i.useState)(null),[M,D]=(0,i.useState)(!1),[I,P]=(0,i.useState)([]),[R,L]=(0,i.useState)(""),[z,O]=(0,i.useState)(null),[F,B]=(0,i.useState)(!1),[V,U]=(0,i.useState)(null),[H,q]=(0,i.useState)([]),[W,G]=(0,i.useState)(!1),{location:Y,error:Z}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,n]=(0,i.useState)({loaded:!1,coordinates:{lat:null,lng:null},error:null}),r=e=>{n({loaded:!0,coordinates:{lat:e.coords.latitude,lng:e.coords.longitude},error:null})},s=e=>{n({loaded:!0,coordinates:{lat:null,lng:null},error:e})};return(0,i.useEffect)(()=>{if(!("geolocation"in navigator))return void s({code:0,message:"Geolocation not supported"});const t=navigator.geolocation.watchPosition(r,s,Le({enableHighAccuracy:!0,timeout:5e3,maximumAge:0},e));return()=>{navigator.geolocation.clearWatch(t)}},[e]),t}(),{subscribe:X,sendNotification:K}=(()=>{const[e,t]=(0,i.useState)(Notification.permission),[n,r]=(0,i.useState)([]);(0,i.useEffect)(()=>{"Notification"in window&&"default"===e&&Notification.requestPermission().then(t)},[e]);const s=(0,i.useCallback)(t=>{if("Notification"in window){if("granted"===e){const e=new Notification(t.title||"Bus Management Alert",{body:t.message||"",icon:t.icon||"/bus-icon.png",badge:t.badge||"/badge-icon.png",tag:t.tag||"bus-alert",requireInteraction:t.requireInteraction||!1,silent:t.silent||!1,vibrate:t.vibrate||[200,100,200],data:t.data||{}});return e.onclick=n=>{n.preventDefault(),window.focus(),t.onClick&&t.onClick(n),e.close()},r(t=>[...t,{notification:e,timestamp:new Date}]),t.requireInteraction||setTimeout(()=>e.close(),5e3),e}}else console.log("This browser does not support notifications")},[e]),a=(0,i.useCallback)(async()=>{if("Notification"in window&&"granted"!==e){const e=await Notification.requestPermission();return t(e),"granted"===e}return"granted"===e},[e]),o=(0,i.useCallback)(()=>{n.forEach(e=>{let{notification:t}=e;return t.close()}),r([])},[n]);return{permission:e,notifications:n,sendNotification:s,subscribe:a,clearNotifications:o}})(),Q=_g("http://localhost:5000"),[J,$]=(0,i.useState)({totalBuses:0,activeBuses:0,maintenanceBuses:0,fuelEfficiency:0,utilizationRate:0,predictiveMaintenance:[],routeOptimization:[]}),[ee,te]=(0,i.useState)({}),[ne,ie]=(0,i.useState)([]),[re,se]=(0,i.useState)({recommendations:[],predictions:[],anomalies:[]});(0,i.useEffect)(()=>(Q&&(Q.on("bus-update",e=>{he(e)}),Q.on("alert",e=>{ie(t=>[e,...t].slice(0,10)),K(e)}),Q.on("tracking-update",e=>{te(t=>Le(Le({},t),{},{[e.busId]:e}))})),()=>{Q&&(Q.off("bus-update"),Q.off("alert"),Q.off("tracking-update"))}),[Q]),(0,i.useEffect)(()=>{ae();const e=setInterval(ae,3e4);return()=>clearInterval(e)},[o]);const ae=async()=>{r(!0);try{await Promise.all([le(),ce(),de(),oe()])}catch(e){console.error("Error fetching data:",e),ou.error("Failed to fetch data")}finally{r(!1)}},oe=async()=>{try{const t=await rh("/api/admin/routes");var e;if(t.ok)P((null===(e=t.data)||void 0===e?void 0:e.routes)||t.data||[])}catch(t){console.error("Error fetching routes:",t)}},le=async()=>{try{const e=new URLSearchParams(Le(Le({},o),{},{search:s})).toString(),n=await rh("/api/admin/buses?".concat(e));if(n.ok){const e=n.data||{};t(ue(e)),e.pagination?(h(e.pagination),d(e.pagination.total)):d(Array.isArray(e.buses)?e.buses.length:Array.isArray(e)?e.length:0)}}catch(e){console.error("Error fetching buses:",e)}},ce=async()=>{try{const e=await rh("/api/admin/buses/analytics");$(e)}catch(e){console.error("Error fetching analytics:",e)}},de=async()=>{try{const e=await rh("/api/admin/buses/ai-insights");se(e)}catch(e){console.error("Error fetching AI insights:",e)}},ue=e=>{var t;return null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.buses?e.data.buses:null!==e&&void 0!==e&&e.buses?e.buses:Array.isArray(e)?e:[]},he=e=>{t(t=>t.map(t=>t._id===e._id?Le(Le({},t),e):t))},pe=(0,i.useMemo)(()=>Array.isArray(e)?e.filter(e=>{var t,n;if(!e||"object"!==typeof e)return!1;const i=(null===(t=e.busNumber)||void 0===t?void 0:t.toLowerCase().includes(s.toLowerCase()))||(null===(n=e.registrationNumber)||void 0===n?void 0:n.toLowerCase().includes(s.toLowerCase()))||!1,r="all"===o.status||e.status===o.status,a="all"===o.depot||e.depotId===o.depot,l="all"===o.busType||e.busType===o.busType;return i&&r&&a&&l}):[],[e,s,o]),me=e=>{g(e),_(!0)},fe=e=>{A(e),C(!0)},ge=e=>{N(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},xe=e=>{var t;O(e),L((null===(t=e.assignedRoute)||void 0===t?void 0:t._id)||""),D(!0)},ye=async e=>{try{await rh("/api/admin/buses/".concat(e._id),{method:"PUT",body:JSON.stringify({assignedRoute:null})}),ou.success("Bus unassigned from route"),ae()}catch(t){ou.error("Failed to unassign bus from route")}},ve=e=>{U(e),B(!0)},_e=async e=>{try{const t=await rh("/api/admin/buses/".concat(e,"/maintenance"));t.ok&&(q(t.data||[]),G(!0))}catch(t){ou.error("Failed to fetch maintenance history")}},be=async e=>{try{await rh("/api/admin/buses/".concat(e._id),{method:"PUT",body:JSON.stringify({status:"active",lastMaintenance:(new Date).toISOString()})}),ou.success("Maintenance completed"),ae()}catch(t){ou.error("Failed to complete maintenance")}},we=async e=>{try{const t=await rh("/api/admin/buses/export/".concat(e));if(t.ok){const n=new Blob([t.data],{type:"pdf"===e?"application/pdf":"application/vnd.ms-excel"}),i=window.URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download="bus-report-".concat((new Date).toISOString().split("T")[0],".").concat(e),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r),ou.success("".concat(e.toUpperCase()," report exported successfully"))}}catch(t){ou.error("Failed to export report")}};return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm sticky top-0 z-40",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,ze.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,ze.jsx)(Sn,{className:"w-8 h-8 text-blue-600"}),"Modern Bus Management"]}),(0,ze.jsx)("div",{className:"flex items-center gap-2",children:["dashboard","grid","map","analytics"].map(e=>(0,ze.jsx)("button",{onClick:()=>m(e),className:"px-4 py-2 rounded-lg font-medium transition-all ".concat(p===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})})}),(0,ze.jsx)("div",{className:"bg-white border-b sticky top-16 z-30",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,ze.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:["grid"===p&&(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("input",{type:"checkbox",checked:j.length===pe.length&&pe.length>0,onChange:()=>{j.length===pe.length?N([]):N(pe.map(e=>e._id))},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Select All"})]}),(0,ze.jsx)("div",{className:"flex-1 min-w-[300px]",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search buses...",value:s,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,ze.jsxs)("select",{value:o.status,onChange:e=>l(Le(Le({},o),{},{status:e.target.value,page:1})),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"retired",children:"Retired"})]}),(0,ze.jsxs)("select",{value:o.busType,onChange:e=>l(Le(Le({},o),{},{busType:e.target.value,page:1})),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Types"}),(0,ze.jsx)("option",{value:"ac_sleeper",children:"AC Sleeper"}),(0,ze.jsx)("option",{value:"ac_seater",children:"AC Seater"}),(0,ze.jsx)("option",{value:"non_ac_sleeper",children:"Non-AC Sleeper"}),(0,ze.jsx)("option",{value:"non_ac_seater",children:"Non-AC Seater"}),(0,ze.jsx)("option",{value:"volvo",children:"Volvo"}),(0,ze.jsx)("option",{value:"mini",children:"Mini Bus"})]}),(0,ze.jsxs)("select",{value:o.sortBy,onChange:e=>l(Le(Le({},o),{},{sortBy:e.target.value,page:1})),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"busNumber",children:"Bus Number"}),(0,ze.jsx)("option",{value:"status",children:"Status"}),(0,ze.jsx)("option",{value:"busType",children:"Type"}),(0,ze.jsx)("option",{value:"createdAt",children:"Created Date"})]}),(0,ze.jsxs)("button",{onClick:()=>l(Le(Le({},o),{},{sortOrder:"asc"===o.sortOrder?"desc":"asc",page:1})),className:"px-3 py-2 border rounded-lg hover:bg-gray-50 flex items-center gap-1",children:[(0,ze.jsx)(Bu,{className:"w-4 h-4"}),"asc"===o.sortOrder?"\u2191":"\u2193"]}),j.length>0&&(0,ze.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-lg border",children:[(0,ze.jsxs)("span",{className:"text-sm text-blue-700 font-medium",children:[j.length," selected"]}),(0,ze.jsx)("button",{onClick:async()=>{if(0!==j.length&&window.confirm("Are you sure you want to delete ".concat(j.length," buses?")))try{await Promise.all(j.map(e=>rh("/api/admin/buses/".concat(e),{method:"DELETE"}))),ou.success("".concat(j.length," buses deleted successfully")),N([]),ae()}catch(e){ou.error("Failed to delete some buses")}},className:"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700",children:"Delete"}),(0,ze.jsxs)("select",{onChange:e=>{e.target.value&&((async e=>{if(0!==j.length)try{await Promise.all(j.map(t=>rh("/api/admin/buses/".concat(t),{method:"PUT",body:JSON.stringify({status:e})}))),ou.success("".concat(j.length," buses status updated to ").concat(e)),N([]),ae()}catch(t){ou.error("Failed to update bus status")}})(e.target.value),e.target.value="")},className:"px-2 py-1 border rounded text-sm",children:[(0,ze.jsx)("option",{value:"",children:"Change Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"retired",children:"Retired"})]}),(0,ze.jsx)("button",{onClick:()=>N([]),className:"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600",children:"Clear"})]}),(0,ze.jsxs)("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,ze.jsx)(mh,{className:"w-5 h-5"}),"Add Bus"]}),(0,ze.jsxs)("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[(0,ze.jsx)(Pg,{className:"w-5 h-5"}),"Scan QR"]}),(0,ze.jsxs)("button",{onClick:ae,className:"px-4 py-2 border rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[(0,ze.jsx)(Lu,{className:"w-5 h-5 ".concat(n?"animate-spin":"")}),"Refresh"]})]})})}),(0,ze.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[n?(0,ze.jsxs)("div",{className:"space-y-6",children:["dashboard"===p&&(0,ze.jsx)(QN,{}),"grid"===p&&(0,ze.jsx)(JN,{}),"map"===p&&(0,ze.jsx)($N,{}),"analytics"===p&&(0,ze.jsx)(eS,{})]}):(0,ze.jsxs)(ze.Fragment,{children:["dashboard"===p&&(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,ze.jsxs)("div",{className:"lg:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,ze.jsx)(HN,{title:"Total Fleet",value:J.totalBuses,icon:(0,ze.jsx)(Sn,{className:"w-6 h-6"}),trend:5.2,color:"blue"}),(0,ze.jsx)(HN,{title:"Active Buses",value:J.activeBuses,icon:(0,ze.jsx)(Dn,{className:"w-6 h-6"}),trend:2.1,color:"green"}),(0,ze.jsx)(HN,{title:"Utilization Rate",value:"".concat(J.utilizationRate,"%"),icon:(0,ze.jsx)(Ou,{className:"w-6 h-6"}),trend:3.5,color:"purple"}),(0,ze.jsx)(HN,{title:"Fuel Efficiency",value:"".concat(J.fuelEfficiency," km/l"),icon:(0,ze.jsx)(xf,{className:"w-6 h-6"}),trend:-1.2,color:"orange"})]}),(0,ze.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-lg p-6",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,ze.jsx)(Dg,{className:"w-5 h-5"})," Live Fleet Tracking"]}),(0,ze.jsx)("div",{className:"h-96 rounded-lg overflow-hidden",children:(0,ze.jsx)(Fg,{buses:pe,tracking:ee})})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,ze.jsx)(Cf,{className:"w-5 h-5"})," AI Insights"]}),(0,ze.jsx)(UN,{insights:re})]}),(0,ze.jsxs)("div",{className:"lg:col-span-3 bg-white rounded-xl shadow-lg p-6",children:[(0,ze.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,ze.jsx)(Ig,{className:"w-5 h-5"})," Real-time Alerts"]}),(0,ze.jsx)("div",{className:"space-y-3",children:ne.map((e,t)=>(0,ze.jsx)(WN,{alert:e},t))})]}),(0,ze.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-lg p-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Fleet Performance"}),(0,ze.jsx)(IN,{data:J})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Upcoming Maintenance"}),(0,ze.jsx)(PN,{buses:e.filter(e=>e.nextMaintenance)})]})]}),"grid"===p&&(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:(0,ze.jsx)(Tf,{children:pe.map(e=>(0,ze.jsx)($c.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},children:(0,ze.jsx)(qN,{bus:e,liveData:ee[e._id],onEdit:()=>me(e),onDelete:()=>fe(e),onView:()=>g(e),onSelect:()=>ge(e._id),isSelected:j.includes(e._id),onAssignRoute:()=>xe(e),onRemoveRoute:()=>ye(e),onScheduleMaintenance:()=>ve(e),onCompleteMaintenance:()=>be(e),onViewMaintenance:()=>_e(e._id)})},e._id))})}),"map"===p&&(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-6 h-[calc(100vh-250px)]",children:(0,ze.jsx)(ZN,{buses:pe,tracking:ee,selectedBus:f,onBusSelect:g,routes:I})}),"analytics"===p&&(0,ze.jsx)(IN,{buses:e,analytics:J,onExport:we})]}),"grid"===p&&u.pages>1&&(0,ze.jsxs)("div",{className:"flex items-center justify-between mt-8 p-4 bg-white rounded-lg shadow",children:[(0,ze.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",(u.page-1)*u.limit+1," to ",Math.min(u.page*u.limit,u.total)," of ",u.total," buses"]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>l(Le(Le({},o),{},{page:Math.max(1,u.page-1)})),disabled:u.page<=1,className:"px-3 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[Array.from({length:Math.min(5,u.pages)},(e,t)=>{const n=t+1;return(0,ze.jsx)("button",{onClick:()=>l(Le(Le({},o),{},{page:n})),className:"px-3 py-2 rounded-lg ".concat(u.page===n?"bg-blue-600 text-white":"border hover:bg-gray-50"),children:n},n)}),u.pages>5&&(0,ze.jsxs)(ze.Fragment,{children:[u.pages>6&&(0,ze.jsx)("span",{className:"px-2",children:"..."}),(0,ze.jsx)("button",{onClick:()=>l(Le(Le({},o),{},{page:u.pages})),className:"px-3 py-2 rounded-lg ".concat(u.page===u.pages?"bg-blue-600 text-white":"border hover:bg-gray-50"),children:u.pages})]})]}),(0,ze.jsx)("button",{onClick:()=>l(Le(Le({},o),{},{page:Math.min(u.pages,u.page+1)})),disabled:u.page>=u.pages,className:"px-3 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),(0,ze.jsxs)("select",{value:o.limit,onChange:e=>l(Le(Le({},o),{},{limit:parseInt(e.target.value),page:1})),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:10,children:"10 per page"}),(0,ze.jsx)("option",{value:20,children:"20 per page"}),(0,ze.jsx)("option",{value:50,children:"50 per page"}),(0,ze.jsx)("option",{value:100,children:"100 per page"})]})]})]}),x&&(0,ze.jsx)(GN,{onClose:()=>y(!1),onSave:async e=>{try{const t=await rh("/api/admin/buses",{method:"POST",body:JSON.stringify(e)});t.ok?(ou.success("Bus added successfully"),y(!1),ae()):ou.error("Failed to add bus: "+(t.message||"Unknown error"))}catch(t){console.error("Error adding bus:",t),ou.error("Failed to add bus")}}}),v&&f&&(0,ze.jsx)(YN,{bus:f,onClose:()=>{_(!1),g(null)},onSave:async e=>{try{const t=await rh("/api/admin/buses/".concat(f._id),{method:"PUT",body:JSON.stringify(e)});t.ok?(ou.success("Bus updated successfully"),_(!1),g(null),ae()):ou.error("Failed to update bus: "+(t.message||"Unknown error"))}catch(t){console.error("Error updating bus:",t),ou.error("Failed to update bus")}}}),T&&E&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[(0,ze.jsxs)("div",{className:"flex items-center mb-4",children:[(0,ze.jsx)(gd,{className:"w-6 h-6 text-red-500 mr-3"}),(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Delete"})]}),(0,ze.jsxs)("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete bus ",(0,ze.jsx)("strong",{children:E.busNumber}),"? This action cannot be undone."]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>{C(!1),A(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Cancel"}),(0,ze.jsx)("button",{onClick:async()=>{if(E)try{await rh("/api/admin/buses/".concat(E._id),{method:"DELETE"}),ou.success("Bus deleted successfully"),C(!1),A(null),ae()}catch(e){ou.error("Failed to delete bus")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium",children:"Delete Bus"})]})]})}),M&&z&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[(0,ze.jsxs)("div",{className:"flex items-center mb-4",children:[(0,ze.jsx)(kn,{className:"w-6 h-6 text-blue-500 mr-3"}),(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Assign Route"})]}),(0,ze.jsxs)("p",{className:"text-gray-600 mb-4",children:["Select a route for bus ",(0,ze.jsx)("strong",{children:z.busNumber})]}),(0,ze.jsxs)("div",{className:"mb-6",children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Routes"}),(0,ze.jsxs)("select",{value:R,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"",children:"Select a route"}),I.map(e=>{var t,n;return(0,ze.jsxs)("option",{value:e._id,children:[e.routeNumber," - ",e.routeName,"(",(null===(t=e.startingPoint)||void 0===t?void 0:t.city)||e.startingPoint," to ",(null===(n=e.endingPoint)||void 0===n?void 0:n.city)||e.endingPoint,")"]},e._id)})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>{D(!1),O(null),L("")},className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Cancel"}),(0,ze.jsx)("button",{onClick:async()=>{if(z&&R)try{await rh("/api/admin/buses/".concat(z._id),{method:"PUT",body:JSON.stringify({assignedRoute:R})}),ou.success("Bus assigned to route successfully"),D(!1),O(null),L(""),ae()}catch(e){ou.error("Failed to assign bus to route")}},disabled:!R,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Assign Route"})]})]})}),F&&V&&(0,ze.jsx)(XN,{bus:V,onClose:()=>{B(!1),U(null)},onSave:async e=>{try{await rh("/api/admin/maintenance",{method:"POST",body:JSON.stringify(Le(Le({},e),{},{busId:V._id}))}),await rh("/api/admin/buses/".concat(V._id),{method:"PUT",body:JSON.stringify({status:"maintenance"})}),ou.success("Maintenance scheduled successfully"),B(!1),U(null),ae()}catch(t){ou.error("Failed to schedule maintenance")}}}),W&&(0,ze.jsx)(KN,{logs:H,onClose:()=>{G(!1),q([])}}),b&&(0,ze.jsx)(ON,{onScan:e=>{console.log("QR Code scanned:",e)},onClose:()=>w(!1)})]})},nS=()=>(0,ze.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,ze.jsx)(tS,{})}),iS=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)("all"),[u,h]=(0,i.useState)("all"),[p,m]=(0,i.useState)(!1),[f,g]=(0,i.useState)(null),[x,y]=(0,i.useState)(null),[v,_]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),[j,N]=(0,i.useState)({name:"",email:"",phone:"",depotId:"",employeeId:"",joiningDate:"",salary:"",status:"active",password:""});(0,i.useEffect)(()=>{S()},[]),(0,i.useEffect)(()=>{(async()=>{try{console.log("=== FORCE FETCHING DEPOTS ON MOUNT ===");const e=await fetch("/api/admin/depots",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();console.log("Depots fetched on mount:",t),r(t.depots||[])}else console.error("Failed to fetch depots on mount:",e.status)}catch(e){console.error("Error fetching depots on mount:",e)}})()},[]);const S=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{a(!0),console.log("=== FRONTEND FETCHING CONDUCTORS ===",e?"(FORCE REFRESH)":"");const l=Date.now(),c=e?"/api/admin/conductors?t=".concat(l):"/api/admin/conductors",d=e?"/api/admin/depots?t=".concat(l):"/api/admin/depots",[u,h]=await Promise.all([fetch(c,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Cache-Control":"no-cache",Pragma:"no-cache"}}),fetch(d,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Cache-Control":"no-cache",Pragma:"no-cache"}})]);if(console.log("Conductors response status:",u.status),console.log("Depots response status:",h.status),u.ok){var n,i,s;const e=await u.json();console.log("Conductors data received:",e),console.log("Conductors count:",(null===(n=e.data)||void 0===n||null===(i=n.conductors)||void 0===i?void 0:i.length)||0),t((null===(s=e.data)||void 0===s?void 0:s.conductors)||[])}else{console.error("Conductors response not ok:",u.status);const e=await u.text();console.error("Conductors error response:",e)}if(h.ok){var o;const e=await h.json();console.log("Depots data received:",e),console.log("Depots count:",(null===(o=e.depots)||void 0===o?void 0:o.length)||0),console.log("Depots array:",e.depots),r(e.depots||[]),e.depots&&e.depots.length>0&&console.log("First depot sample:",e.depots[0])}else{console.error("Depots response not ok:",h.status);const e=await h.text();console.error("Depots error response:",e)}}catch(l){console.error("Error fetching data:",l)}finally{a(!1)}},k=()=>{N({name:"",email:"",phone:"",depotId:"",employeeId:"",joiningDate:"",salary:"",status:"active",password:""})},T=e=>{const t={active:{color:"bg-green-100 text-green-800 border-green-200",icon:xd},inactive:{color:"bg-gray-100 text-gray-800 border-gray-200",icon:Om},suspended:{color:"bg-red-100 text-red-800 border-red-200",icon:Fm}}[e]||{color:"bg-gray-100 text-gray-800 border-gray-200",icon:gd},n=t.icon;return(0,ze.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(t.color," flex items-center gap-1"),children:[(0,ze.jsx)(n,{className:"w-3 h-3"}),e]})},C=e=>{if("object"===typeof e&&null!==e)return e.depotName||"Unassigned";const t=n.find(t=>t._id===e);return t?t.name:"Unassigned"},E=e=>{if("object"===typeof e&&null!==e)return e.depotCode||"N/A";const t=n.find(t=>t._id===e);return t?t.depotCode||t.code:"N/A"},A=e.filter(e=>{var t;const n=!o||e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.phone.includes(o)||e.employeeCode&&e.employeeCode.toLowerCase().includes(o.toLowerCase()),i="all"===c||"object"===typeof e.depotId&&(null===(t=e.depotId)||void 0===t?void 0:t._id)===c||"string"===typeof e.depotId&&e.depotId===c,r="all"===u||e.status===u;return n&&i&&r});return console.log("=== CONDUCTORS FRONTEND DEBUG ==="),console.log("conductors state:",e),console.log("conductors length:",e.length),console.log("filteredConductors length:",A.length),console.log("searchTerm:",o),console.log("depotFilter:",c),console.log("statusFilter:",u),console.log("depots state:",n),console.log("depots length:",n.length),0===n.length?console.warn("\u26a0\ufe0f No depots loaded! This might be why the dropdown is empty."):console.log("\u2705 Depots loaded successfully:",n.map(e=>({id:e._id,name:e.name}))),s?(0,ze.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,ze.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"text-center lg:text-left",children:[(0,ze.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Yatrik Conductor Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage conductors and their depot assignments"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsxs)("button",{onClick:()=>{const t=[["Name","Email","Phone","Employee ID","Depot","Joining Date","Status","Source"].join(","),...e.map(e=>[e.name,e.email,e.phone,e.employeeCode||"N/A",C(e.depotId),e.joiningDate?new Date(e.joiningDate).toLocaleDateString():"N/A",e.status,e.source||"unknown"].join(","))].join("\n"),n=new Blob([t],{type:"text/csv"}),i=window.URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download="conductors_".concat((new Date).toISOString().split("T")[0],".csv"),r.click(),window.URL.revokeObjectURL(i),alert("Conductors exported successfully")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Export"})]}),(0,ze.jsxs)("button",{onClick:()=>{console.log("=== FORCE REFRESH TRIGGERED ==="),S(!0)},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh All"})]}),(0,ze.jsx)("button",{onClick:async()=>{try{console.log("=== TESTING COMPREHENSIVE STAFF DEBUG ===");const e=await fetch("/api/admin/debug-all-staff",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();console.log("Comprehensive staff debug:",t),alert("Debug complete! Found ".concat(t.counts.allDrivers," drivers and ").concat(t.counts.allConductors," conductors. Check console for details."))}else console.error("Debug failed:",e.status),alert("Debug failed with status ".concat(e.status))}catch(e){console.error("Debug error:",e),alert("Debug error. Check console for details.")}},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:(0,ze.jsx)("span",{children:"Debug All Staff"})}),(0,ze.jsxs)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(mh,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Add Conductor"})]})]})]}),(0,ze.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:(0,ze.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,ze.jsx)("div",{className:"flex-1",children:(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search conductors by name, email, phone, or employee ID...",value:o,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,ze.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",style:{minHeight:"40px"},children:[(0,ze.jsxs)("option",{value:"all",children:["All Depots (",n.length,")"]}),n&&n.length>0?n.map(e=>(console.log("Rendering depot option:",e),(0,ze.jsx)("option",{value:e._id,style:{padding:"8px",backgroundColor:"white"},children:e.name||e.depotName||"Unknown Depot"},e._id))):(0,ze.jsx)("option",{disabled:!0,children:"No depots available"})]}),(0,ze.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]}),(0,ze.jsxs)("button",{onClick:S,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Lu,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Refresh"})]})]})}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsx)("div",{className:"overflow-x-auto",children:(0,ze.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,ze.jsx)("thead",{className:"bg-gray-50",children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Conductor"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee ID"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Depot Assignment"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,ze.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,ze.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(e=>{var t,n;return(0,ze.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"flex items-center",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-semibold text-lg",children:(null===(t=e.name)||void 0===t||null===(n=t.charAt(0))||void 0===n?void 0:n.toUpperCase())||"C"})}),(0,ze.jsxs)("div",{className:"ml-4",children:[(0,ze.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:e.name}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e._id.slice(-8)]})]})]})}),(0,ze.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,ze.jsx)("div",{className:"text-sm text-gray-900",children:e.employeeCode||"N/A"}),e.joiningDate&&(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["Joined: ",new Date(e.joiningDate).toLocaleDateString()]}),e.source&&(0,ze.jsxs)("div",{className:"text-xs text-blue-600",children:["Source: ",e.source]})]}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)(Cn,{className:"w-4 h-4 text-gray-400"}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:C(e.depotId)}),(0,ze.jsxs)("div",{className:"text-sm text-gray-500",children:["Code: ",E(e.depotId)]})]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,ze.jsxs)("div",{className:"space-y-1",children:[(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-900",children:[(0,ze.jsx)(Bm,{className:"w-4 h-4 mr-2 text-gray-400"}),e.email]}),(0,ze.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,ze.jsx)(rd,{className:"w-4 h-4 mr-2 text-gray-400"}),e.phone]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:T(e.status)}),(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>(e=>{y(e)})(e),className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-50 transition-colors",title:"View Details",children:(0,ze.jsx)(xh,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(e=>{var t,n,i;g(e),N({name:e.name||"",email:e.email||"",phone:e.phone||"",depotId:e.depotId||"",employeeId:(null===(t=e.staffDetails)||void 0===t?void 0:t.employeeId)||"",joiningDate:null!==(n=e.staffDetails)&&void 0!==n&&n.joiningDate?new Date(e.staffDetails.joiningDate).toISOString().split("T")[0]:"",salary:(null===(i=e.staffDetails)||void 0===i?void 0:i.salary)||"",status:e.status||"active",password:""})})(e),className:"text-green-600 hover:text-green-900 p-2 rounded-lg hover:bg-green-50 transition-colors",title:"Edit Conductor",children:(0,ze.jsx)(Rm,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(e=>{w(e),_(!0)})(e),className:"text-red-600 hover:text-red-900 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Conductor",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})})]})})]},e._id)})})]})}),0===A.length&&(0,ze.jsxs)("div",{className:"text-center py-12",children:[(0,ze.jsx)(Nn,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:0===e.length?"No conductors found":"No conductors match your filters"}),(0,ze.jsx)("p",{className:"text-gray-500 mb-6",children:0===e.length?"Get started by adding your first conductor":"Try adjusting your search terms or filters"}),0===e.length&&(0,ze.jsxs)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,ze.jsx)(mh,{className:"w-4 h-4 inline mr-2"}),"Add First Conductor"]})]})]}),(p||f)&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,ze.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:f?"Edit Conductor":"Create New Conductor"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-2",children:f?"Update conductor information":"Add a new conductor to the system"})]}),(0,ze.jsxs)("form",{onSubmit:f?async e=>{e.preventDefault();try{const e=await fetch("/api/admin/users/".concat(f._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(Le(Le({},j),{},{role:"conductor"}))});if(e.ok)alert("Conductor updated successfully"),g(null),k(),S();else{const t=await e.json();alert(t.error||"Failed to update conductor")}}catch(t){console.error("Error updating conductor:",t),alert("Error updating conductor")}}:async e=>{e.preventDefault();try{const e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(Le(Le({},j),{},{role:"conductor"}))});if(e.ok)alert("Conductor created successfully"),m(!1),k(),S(!0);else{const t=await e.json();alert(t.error||"Failed to create conductor")}}catch(t){console.error("Error creating conductor:",t),alert("Error creating conductor")}},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,ze.jsx)("input",{type:"text",required:!0,value:j.name,onChange:e=>N(t=>Le(Le({},t),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter full name"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,ze.jsx)("input",{type:"email",required:!0,value:j.email,onChange:e=>N(t=>Le(Le({},t),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email address"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),(0,ze.jsx)("input",{type:"tel",required:!0,value:j.phone,onChange:e=>N(t=>Le(Le({},t),{},{phone:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter phone number"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee ID"}),(0,ze.jsx)("input",{type:"text",value:j.employeeId,onChange:e=>N(t=>Le(Le({},t),{},{employeeId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter employee ID"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot Assignment *"}),(0,ze.jsxs)("select",{required:!0,value:j.depotId,onChange:e=>N(t=>Le(Le({},t),{},{depotId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"",children:"Select Depot"}),n.map(e=>(0,ze.jsxs)("option",{value:e._id,children:[e.depotName||e.name," (",e.depotCode||e.code,")"]},e._id))]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,ze.jsxs)("select",{value:j.status,onChange:e=>N(t=>Le(Le({},t),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"active",children:"Active"}),(0,ze.jsx)("option",{value:"inactive",children:"Inactive"}),(0,ze.jsx)("option",{value:"suspended",children:"Suspended"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Joining Date"}),(0,ze.jsx)("input",{type:"date",value:j.joiningDate,onChange:e=>N(t=>Le(Le({},t),{},{joiningDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Salary"}),(0,ze.jsx)("input",{type:"number",value:j.salary,onChange:e=>N(t=>Le(Le({},t),{},{salary:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter salary"})]}),!f&&(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,ze.jsx)("input",{type:"password",required:!0,value:j.password,onChange:e=>N(t=>Le(Le({},t),{},{password:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter password"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>{m(!1),g(null),k()},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:f?"Update Conductor":"Create Conductor"})]})]})]})}),v&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(gd,{className:"w-6 h-6 text-red-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Conductor"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"This action cannot be undone."})]})]}),(0,ze.jsxs)("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to delete ",(0,ze.jsx)("strong",{children:null===b||void 0===b?void 0:b.name}),"? This will permanently remove their account and all associated data."]}),(0,ze.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,ze.jsx)("button",{onClick:async()=>{if(b)try{const e=await fetch("/api/admin/users/".concat(b._id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok)alert("Conductor deleted successfully"),_(!1),w(null),S();else{const t=await e.json();alert(t.error||"Failed to delete conductor")}}catch(e){console.error("Error deleting conductor:",e),alert("Error deleting conductor")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Conductor"})]})]})})})]})},rS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Depot Manager Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage all depot managers in the system"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Depot manager management functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"Add/Edit/Delete depot managers"}),(0,ze.jsx)("li",{children:"Assign depot managers to depots"}),(0,ze.jsx)("li",{children:"Track depot operations"}),(0,ze.jsx)("li",{children:"Manage depot resources"})]})]})]}),sS=wn("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),aS=wn("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),oS=wn("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),lS=wn("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),cS=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[p,m]=(0,i.useState)(null),[f,g]=(0,i.useState)(""),[x,y]=(0,i.useState)("roles"),[v,_]=(0,i.useState)({name:"",description:"",permissions:[],isActive:!0,priority:1}),b={dashboard:{name:"Dashboard & Analytics",icon:jn,color:"bg-blue-100 text-blue-800",permissions:[{key:"dashboard.view",name:"View Dashboard",description:"Access main dashboard"},{key:"dashboard.analytics",name:"View Analytics",description:"Access detailed analytics"},{key:"dashboard.export",name:"Export Data",description:"Export dashboard data"},{key:"dashboard.realtime",name:"Real-time Data",description:"Access live data feeds"}]},users:{name:"User Management",icon:Nn,color:"bg-green-100 text-green-800",permissions:[{key:"users.view",name:"View Users",description:"View user listings"},{key:"users.create",name:"Create Users",description:"Add new users"},{key:"users.edit",name:"Edit Users",description:"Modify user details"},{key:"users.delete",name:"Delete Users",description:"Remove users"},{key:"users.roles",name:"Manage Roles",description:"Assign/change user roles"},{key:"users.permissions",name:"Manage Permissions",description:"Grant/revoke permissions"}]},fleet:{name:"Fleet Management",icon:Sn,color:"bg-purple-100 text-purple-800",permissions:[{key:"buses.view",name:"View Buses",description:"View bus listings"},{key:"buses.create",name:"Add Buses",description:"Add new buses"},{key:"buses.edit",name:"Edit Buses",description:"Modify bus details"},{key:"buses.delete",name:"Delete Buses",description:"Remove buses"},{key:"buses.assign",name:"Assign Crew",description:"Assign drivers/conductors"},{key:"buses.maintenance",name:"Maintenance",description:"Schedule maintenance"}]},routes:{name:"Route Management",icon:kn,color:"bg-orange-100 text-orange-800",permissions:[{key:"routes.view",name:"View Routes",description:"View route listings"},{key:"routes.create",name:"Create Routes",description:"Add new routes"},{key:"routes.edit",name:"Edit Routes",description:"Modify route details"},{key:"routes.delete",name:"Delete Routes",description:"Remove routes"},{key:"routes.stops",name:"Manage Stops",description:"Add/edit route stops"},{key:"routes.schedule",name:"Manage Schedules",description:"Set route schedules"}]},trips:{name:"Trip Management",icon:Tn,color:"bg-indigo-100 text-indigo-800",permissions:[{key:"trips.view",name:"View Trips",description:"View trip listings"},{key:"trips.create",name:"Create Trips",description:"Schedule new trips"},{key:"trips.edit",name:"Edit Trips",description:"Modify trip details"},{key:"trips.cancel",name:"Cancel Trips",description:"Cancel scheduled trips"},{key:"trips.track",name:"Track Trips",description:"Real-time trip tracking"},{key:"trips.reports",name:"Trip Reports",description:"Generate trip reports"}]},depots:{name:"Depot Management",icon:id,color:"bg-teal-100 text-teal-800",permissions:[{key:"depots.view",name:"View Depots",description:"View depot listings"},{key:"depots.create",name:"Create Depots",description:"Add new depots"},{key:"depots.edit",name:"Edit Depots",description:"Modify depot details"},{key:"depots.delete",name:"Delete Depots",description:"Remove depots"},{key:"depots.staff",name:"Manage Staff",description:"Assign depot staff"},{key:"depots.facilities",name:"Manage Facilities",description:"Manage depot facilities"}]},finance:{name:"Financial Management",icon:Mn,color:"bg-green-100 text-green-800",permissions:[{key:"finance.view",name:"View Finances",description:"View financial data"},{key:"finance.fares",name:"Manage Fares",description:"Set fare policies"},{key:"finance.payments",name:"Process Payments",description:"Handle payment processing"},{key:"finance.refunds",name:"Process Refunds",description:"Handle refund requests"},{key:"finance.reports",name:"Financial Reports",description:"Generate financial reports"},{key:"finance.audit",name:"Audit Trail",description:"View financial audit logs"}]},reports:{name:"Reports & Analytics",icon:Lg,color:"bg-yellow-100 text-yellow-800",permissions:[{key:"reports.view",name:"View Reports",description:"Access reports section"},{key:"reports.create",name:"Create Reports",description:"Generate custom reports"},{key:"reports.export",name:"Export Reports",description:"Export report data"},{key:"reports.schedule",name:"Schedule Reports",description:"Set automated reports"},{key:"reports.analytics",name:"Advanced Analytics",description:"Access advanced analytics"}]},system:{name:"System Administration",icon:Pn,color:"bg-red-100 text-red-800",permissions:[{key:"system.view",name:"View System Status",description:"Monitor system health"},{key:"system.config",name:"System Config",description:"Modify system settings"},{key:"system.backup",name:"Backup Management",description:"Manage system backups"},{key:"system.logs",name:"View Logs",description:"Access system logs"},{key:"system.maintenance",name:"Maintenance Mode",description:"Enable maintenance mode"},{key:"system.security",name:"Security Settings",description:"Manage security settings"}]}};(0,i.useEffect)(()=>{w(),j(),N()},[]);const w=async()=>{try{l(!0);const e=await fetch("/api/admin/rbac/roles",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const n=await e.json();t(n.roles||[])}}catch(e){console.error("Error fetching roles:",e)}finally{l(!1)}},j=async()=>{try{const e=await fetch("/api/admin/rbac/permissions",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();r(t.permissions||[])}}catch(e){console.error("Error fetching permissions:",e)}},N=async()=>{try{const e=await fetch("/api/admin/users?limit=100",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();a(t.users||[])}}catch(e){console.error("Error fetching users:",e)}},S=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const t=p.permissions||[],n=t.includes(e);m(Le(Le({},p),{},{permissions:n?t.filter(t=>t!==e):[...t,e]}))}else{const t=v.permissions||[],n=t.includes(e);_(Le(Le({},v),{},{permissions:n?t.filter(t=>t!==e):[...t,e]}))}},k=e=>({admin:sS,depot_manager:nd,driver:Em,conductor:Em,passenger:Nn,support:aS}[e.toLowerCase()]||An),T=e.filter(e=>{var t,n;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(f.toLowerCase()))||(null===(n=e.description)||void 0===n?void 0:n.toLowerCase().includes(f.toLowerCase()))});return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsx)("div",{className:"px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"RBAC Management"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-1",children:"Role-Based Access Control with granular permissions"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("button",{onClick:()=>{w(),j(),N()},className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:(0,ze.jsx)(Lu,{className:"w-5 h-5"})}),(0,ze.jsxs)("button",{onClick:()=>d(!0),className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-2 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 flex items-center space-x-2 shadow-lg",children:[(0,ze.jsx)(mh,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Create Role"})]})]})]})})}),(0,ze.jsxs)("div",{className:"px-6 py-6",children:[(0,ze.jsx)("div",{className:"mb-6",children:(0,ze.jsx)("div",{className:"border-b border-gray-200",children:(0,ze.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{key:"roles",label:"Roles & Permissions",icon:An},{key:"users",label:"User Assignments",icon:Nn},{key:"permissions",label:"Permission Matrix",icon:oS},{key:"audit",label:"Audit Logs",icon:Lg}].map(e=>{const t=e.icon;return(0,ze.jsxs)("button",{onClick:()=>y(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ".concat(x===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,ze.jsx)(t,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:e.label})]},e.key)})})})}),"roles"===x&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,ze.jsx)("div",{className:"flex items-center space-x-4",children:(0,ze.jsxs)("div",{className:"relative flex-1",children:[(0,ze.jsx)(Un,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",placeholder:"Search roles...",value:f,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})})}),(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(e=>{var t;const n=k(e.name),i=(e=>{const t={1:{label:"Highest",color:"bg-red-100 text-red-800"},2:{label:"High",color:"bg-orange-100 text-orange-800"},3:{label:"Medium",color:"bg-yellow-100 text-yellow-800"},4:{label:"Low",color:"bg-green-100 text-green-800"},5:{label:"Lowest",color:"bg-gray-100 text-gray-800"}};return t[e]||t[3]})(e.priority);return(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-all",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,ze.jsx)(n,{className:"w-6 h-6 text-blue-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,ze.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(i.color),children:[i.label," Priority"]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{onClick:()=>{m(e),h(!0)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",children:(0,ze.jsx)(lS,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this role?"))try{(await fetch("/api/admin/rbac/roles/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).ok&&w()}catch(t){console.error("Error deleting role:",t)}})(e._id),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:(0,ze.jsx)(Lm,{className:"w-4 h-4"})})]})]}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),(0,ze.jsxs)("div",{className:"space-y-2",children:[(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Permissions:"}),(0,ze.jsx)("span",{className:"font-medium",children:(null===(t=e.permissions)||void 0===t?void 0:t.length)||0})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Users:"}),(0,ze.jsx)("span",{className:"font-medium",children:s.filter(t=>t.role===e.name).length})]}),(0,ze.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,ze.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,ze.jsx)("span",{className:"font-medium ".concat(e.isActive?"text-green-600":"text-red-600"),children:e.isActive?"Active":"Inactive"})]})]})]},e._id)})})]}),"permissions"===x&&(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Permission Matrix"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Comprehensive view of all permissions across roles"})]}),(0,ze.jsx)("div",{className:"p-6 space-y-8",children:Object.entries(b).map(t=>{let[n,i]=t;const r=i.icon;return(0,ze.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,ze.jsxs)("div",{className:"px-4 py-3 ".concat(i.color," flex items-center space-x-2"),children:[(0,ze.jsx)(r,{className:"w-5 h-5"}),(0,ze.jsx)("span",{className:"font-semibold",children:i.name})]}),(0,ze.jsx)("div",{className:"p-4",children:(0,ze.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.permissions.map(t=>(0,ze.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,ze.jsx)("h5",{className:"font-medium text-gray-900",children:t.name}),(0,ze.jsx)("div",{className:"flex items-center space-x-2",children:e.map(e=>{var n;return(0,ze.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,ze.jsx)("span",{className:"text-xs text-gray-500",children:e.name}),null!==(n=e.permissions)&&void 0!==n&&n.includes(t.key)?(0,ze.jsx)(xd,{className:"w-4 h-4 text-green-600"}):(0,ze.jsx)(Fm,{className:"w-4 h-4 text-red-400"})]},e._id)})})]}),(0,ze.jsx)("p",{className:"text-sm text-gray-600",children:t.description})]},t.key))})})]},n)})})]}),"users"===x&&(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"User Role Assignments"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage user roles and permissions"})]}),(0,ze.jsx)("div",{className:"overflow-x-auto",children:(0,ze.jsxs)("table",{className:"w-full",children:[(0,ze.jsx)("thead",{className:"bg-gray-50",children:(0,ze.jsxs)("tr",{children:[(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Role"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Permissions"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,ze.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice(0,20).map(t=>{var n,i,r;const s=e.find(e=>e.name===t.role),a=k(t.role||"user");return(0,ze.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,ze.jsx)("td",{className:"px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,ze.jsx)(a,{className:"w-5 h-5 text-gray-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:t.name}),(0,ze.jsx)("div",{className:"text-sm text-gray-500",children:t.email})]})]})}),(0,ze.jsx)("td",{className:"px-6 py-4",children:(0,ze.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.role||"No Role"})}),(0,ze.jsxs)("td",{className:"px-6 py-4",children:[(0,ze.jsxs)("div",{className:"text-sm text-gray-900",children:[(null===s||void 0===s||null===(n=s.permissions)||void 0===n?void 0:n.length)||0," permissions"]}),(0,ze.jsxs)("div",{className:"text-xs text-gray-500",children:[null===s||void 0===s||null===(i=s.permissions)||void 0===i?void 0:i.slice(0,3).join(", "),(null===s||void 0===s||null===(r=s.permissions)||void 0===r?void 0:r.length)>3&&"..."]})]}),(0,ze.jsx)("td",{className:"px-6 py-4",children:(0,ze.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("active"===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===t.status?"Active":"Inactive"})}),(0,ze.jsx)("td",{className:"px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsx)("button",{className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",children:(0,ze.jsx)(lS,{className:"w-4 h-4"})}),(0,ze.jsx)("button",{className:"p-2 text-gray-400 hover:text-green-600 transition-colors",children:(0,ze.jsx)(xh,{className:"w-4 h-4"})})]})})]},t._id)})})]})})]})]}),c&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,ze.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Role"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Define role permissions with granular control"})]}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch("/api/admin/rbac/roles",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(v)})).ok&&(d(!1),_({name:"",description:"",permissions:[],isActive:!0,priority:1}),w())}catch(t){console.error("Error creating role:",t)}},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role Name"}),(0,ze.jsx)("input",{type:"text",value:v.name,onChange:e=>_(Le(Le({},v),{},{name:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter role name",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority Level"}),(0,ze.jsxs)("select",{value:v.priority,onChange:e=>_(Le(Le({},v),{},{priority:parseInt(e.target.value)})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:1,children:"Highest (1)"}),(0,ze.jsx)("option",{value:2,children:"High (2)"}),(0,ze.jsx)("option",{value:3,children:"Medium (3)"}),(0,ze.jsx)("option",{value:4,children:"Low (4)"}),(0,ze.jsx)("option",{value:5,children:"Lowest (5)"})]})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,ze.jsx)("textarea",{value:v.description,onChange:e=>_(Le(Le({},v),{},{description:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",placeholder:"Describe the role and its responsibilities"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Permissions"}),(0,ze.jsx)("div",{className:"space-y-6",children:Object.entries(b).map(e=>{let[t,n]=e;const i=n.icon;return(0,ze.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,ze.jsxs)("div",{className:"px-4 py-3 ".concat(n.color," flex items-center space-x-2"),children:[(0,ze.jsx)(i,{className:"w-5 h-5"}),(0,ze.jsx)("span",{className:"font-semibold",children:n.name})]}),(0,ze.jsx)("div",{className:"p-4",children:(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.permissions.map(e=>(0,ze.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:v.permissions.includes(e.key),onChange:()=>S(e.key),className:"mt-1 rounded focus:ring-2 focus:ring-blue-500"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]})]},e.key))})})]},t)})})]}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>{d(!1),_({name:"",description:"",permissions:[],isActive:!0,priority:1})},className:"px-6 py-3 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,ze.jsxs)("button",{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Im,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Create Role"})]})]})]})]})}),u&&p&&(0,ze.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,ze.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,ze.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Edit Role: ",p.name]})}),(0,ze.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch("/api/admin/rbac/roles/".concat(p._id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(p)})).ok&&(h(!1),m(null),w())}catch(t){console.error("Error updating role:",t)}},className:"p-6 space-y-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role Name"}),(0,ze.jsx)("input",{type:"text",value:p.name||"",onChange:e=>m(Le(Le({},p),{},{name:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority Level"}),(0,ze.jsxs)("select",{value:p.priority||3,onChange:e=>m(Le(Le({},p),{},{priority:parseInt(e.target.value)})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:1,children:"Highest (1)"}),(0,ze.jsx)("option",{value:2,children:"High (2)"}),(0,ze.jsx)("option",{value:3,children:"Medium (3)"}),(0,ze.jsx)("option",{value:4,children:"Low (4)"}),(0,ze.jsx)("option",{value:5,children:"Lowest (5)"})]})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,ze.jsx)("textarea",{value:p.description||"",onChange:e=>m(Le(Le({},p),{},{description:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Permissions"}),(0,ze.jsx)("div",{className:"space-y-6",children:Object.entries(b).map(e=>{let[t,n]=e;const i=n.icon;return(0,ze.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,ze.jsxs)("div",{className:"px-4 py-3 ".concat(n.color," flex items-center space-x-2"),children:[(0,ze.jsx)(i,{className:"w-5 h-5"}),(0,ze.jsx)("span",{className:"font-semibold",children:n.name})]}),(0,ze.jsx)("div",{className:"p-4",children:(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.permissions.map(e=>(0,ze.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,ze.jsx)("input",{type:"checkbox",checked:(p.permissions||[]).includes(e.key),onChange:()=>S(e.key,!0),className:"mt-1 rounded focus:ring-2 focus:ring-blue-500"}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]})]},e.key))})})]},t)})})]}),(0,ze.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("button",{type:"button",onClick:()=>{h(!1),m(null)},className:"px-6 py-3 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,ze.jsxs)("button",{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Im,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Update Role"})]})]})]})]})})]})},dS=wn("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),uS=()=>{var e,t,n,r;const[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(null),[u,h]=(0,i.useState)({startDate:new Date(Date.now()-2592e6).toISOString().split("T")[0],endDate:(new Date).toISOString().split("T")[0]}),[p,m]=(0,i.useState)(null),[f,g]=(0,i.useState)({depot:"all",route:"all",status:"all"}),x=[{id:"revenue_analysis",name:"Revenue Analysis",description:"Comprehensive revenue breakdown by routes, depots, and time periods",icon:Mn,color:"bg-green-100 text-green-800",category:"Financial",fields:["total_revenue","average_fare","booking_count","refund_amount"]},{id:"trip_performance",name:"Trip Performance",description:"Trip completion rates, delays, and operational efficiency metrics",icon:Sn,color:"bg-blue-100 text-blue-800",category:"Operations",fields:["completed_trips","cancelled_trips","average_delay","occupancy_rate"]},{id:"user_analytics",name:"User Analytics",description:"User registration, activity patterns, and engagement metrics",icon:Nn,color:"bg-purple-100 text-purple-800",category:"Users",fields:["new_registrations","active_users","booking_frequency","user_retention"]},{id:"route_efficiency",name:"Route Efficiency",description:"Route performance, popular destinations, and optimization insights",icon:kn,color:"bg-orange-100 text-orange-800",category:"Routes",fields:["route_popularity","average_journey_time","fuel_efficiency","passenger_load"]},{id:"depot_performance",name:"Depot Performance",description:"Depot-wise operations, staff performance, and resource utilization",icon:id,color:"bg-teal-100 text-teal-800",category:"Depots",fields:["fleet_utilization","staff_efficiency","maintenance_cost","operational_hours"]},{id:"financial_summary",name:"Financial Summary",description:"Complete financial overview with profit/loss and expense analysis",icon:jn,color:"bg-indigo-100 text-indigo-800",category:"Financial",fields:["gross_revenue","operational_cost","net_profit","expense_breakdown"]},{id:"real_time_dashboard",name:"Real-time Dashboard",description:"Live operational metrics and system performance indicators",icon:Dn,color:"bg-red-100 text-red-800",category:"Operations",fields:["active_trips","live_bookings","system_load","alert_count"]},{id:"predictive_analytics",name:"Predictive Analytics",description:"AI-powered insights for demand forecasting and optimization",icon:FN,color:"bg-yellow-100 text-yellow-800",category:"Analytics",fields:["demand_forecast","peak_hours","seasonal_trends","optimization_suggestions"]}];(0,i.useEffect)(()=>{y()},[]);const y=async()=>{try{l(!0);const e=await fetch("/api/admin/reports",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();a(t.reports||[])}}catch(e){console.error("Error fetching reports:",e)}finally{l(!1)}},v=async e=>{try{l(!0),d(e),console.log("\ud83d\udcca Generating report:",e),console.log("\ud83d\udcc5 Date range:",u),console.log("\ud83d\udd0d Filters:",f);const t=new URLSearchParams({startDate:u.startDate,endDate:u.endDate,depot:f.depot,route:f.route,status:f.status});console.log("\ud83c\udf10 API URL:","/api/admin/reports/".concat(e,"?").concat(t));const n=await fetch("/api/admin/reports/".concat(e,"?").concat(t),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 Report response status:",n.status),n.ok){const e=await n.json();console.log("\ud83d\udcc8 Report data received:",e),m(e)}else{console.error("\u274c Report generation failed:",n.status);const e=await n.text();console.error("Error response:",e),alert("Failed to generate report: ".concat(n.status))}}catch(t){console.error("\ud83d\udca5 Error generating report:",t),alert("Error generating report. Check console for details.")}finally{l(!1)}},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pdf";try{const t=new URLSearchParams({startDate:u.startDate,endDate:u.endDate,format:e}),n=await fetch("/api/admin/reports/".concat(c,"/export?").concat(t),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(n.ok){const t=await n.blob(),i=window.URL.createObjectURL(t),r=document.createElement("a");r.style.display="none",r.href=i,r.download="report-".concat(c,"-").concat((new Date).toISOString().split("T")[0],".").concat(e),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i)}}catch(t){console.error("Error exporting report:",t)}};return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsx)("div",{className:"px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Reports & Analytics"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-1",children:"Comprehensive business intelligence and performance analytics"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("button",{onClick:y,className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:(0,ze.jsx)(Lu,{className:"w-5 h-5"})}),(0,ze.jsxs)("button",{onClick:async()=>{try{console.log("\ud83e\uddea Testing Reports API...");const t=await fetch("/api/admin/test-reports",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 Test Reports API status:",t.status),t.ok){const n=await t.json();console.log("\u2705 Test Reports API data:",n);const i=await fetch("/api/admin/reports",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(console.log("\ud83d\udce1 Reports API status:",i.status),i.ok){var e;const t=await i.json();console.log("\ud83d\udcca Reports API data:",t),alert("Reports API working! Found ".concat((null===(e=t.reports)||void 0===e?void 0:e.length)||0," report templates."))}else alert("Main Reports API failed: ".concat(i.status))}else alert("Test Reports API failed: ".concat(t.status))}catch(t){console.error("Reports API test error:",t),alert("Reports API test failed. Check console.")}},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(Dn,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Test API"})]}),(0,ze.jsxs)("button",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-2 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 flex items-center space-x-2 shadow-lg",children:[(0,ze.jsx)(hd,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:"Export All"})]})]})]})})}),(0,ze.jsxs)("div",{className:"px-6 py-6",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,ze.jsx)("div",{className:"lg:col-span-1",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 sticky top-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Report Templates"}),(0,ze.jsx)("div",{className:"space-y-3",children:x.map(e=>{const t=e.icon;return(0,ze.jsxs)("button",{onClick:()=>v(e.id),className:"w-full text-left p-4 rounded-lg border transition-all ".concat(c===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"p-2 rounded-lg ".concat(e.color),children:(0,ze.jsx)(t,{className:"w-5 h-5"})}),(0,ze.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,ze.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,ze.jsx)("div",{className:"text-xs text-gray-500",children:e.category})]})]}),(0,ze.jsx)("p",{className:"text-xs text-gray-600 mt-2",children:e.description})]},e.id)})}),(0,ze.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,ze.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Filters"}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Date Range"}),(0,ze.jsxs)("div",{className:"space-y-2",children:[(0,ze.jsx)("input",{type:"date",value:u.startDate,onChange:e=>h(Le(Le({},u),{},{startDate:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,ze.jsx)("input",{type:"date",value:u.endDate,onChange:e=>h(Le(Le({},u),{},{endDate:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Depot"}),(0,ze.jsxs)("select",{value:f.depot,onChange:e=>g(Le(Le({},f),{},{depot:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Depots"}),(0,ze.jsx)("option",{value:"depot1",children:"Central Depot"}),(0,ze.jsx)("option",{value:"depot2",children:"North Depot"}),(0,ze.jsx)("option",{value:"depot3",children:"South Depot"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Status"}),(0,ze.jsxs)("select",{value:f.status,onChange:e=>g(Le(Le({},f),{},{status:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,ze.jsx)("option",{value:"all",children:"All Status"}),(0,ze.jsx)("option",{value:"completed",children:"Completed"}),(0,ze.jsx)("option",{value:"running",children:"Running"}),(0,ze.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})]})]})]})}),(0,ze.jsx)("div",{className:"lg:col-span-3 space-y-6",children:c?(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:i.createElement((e=>{const t=x.find(t=>t.id===e);return(null===t||void 0===t?void 0:t.icon)||jn})(c),{className:"w-6 h-6 text-blue-600"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:null===(e=x.find(e=>e.id===c))||void 0===e?void 0:e.name}),(0,ze.jsxs)("p",{className:"text-sm text-gray-600",children:[u.startDate," to ",u.endDate]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,ze.jsxs)("button",{onClick:()=>_("pdf"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"PDF"})]}),(0,ze.jsxs)("button",{onClick:()=>_("excel"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:"Excel"})]}),(0,ze.jsx)("button",{onClick:()=>{d(null),m(null)},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"})]})]})}),o?(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[(0,ze.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Generating report..."})]}):p?(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:null===(t=p.metrics)||void 0===t?void 0:t.map((e,t)=>(0,ze.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.label}),(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value}),e.change&&(0,ze.jsxs)("div",{className:"flex items-center mt-2 text-sm ".concat(e.change>0?"text-green-600":"text-red-600"),children:[e.change>0?(0,ze.jsx)(Ou,{className:"w-4 h-4 mr-1"}):(0,ze.jsx)(dS,{className:"w-4 h-4 mr-1"}),Math.abs(e.change),"%"]})]}),(0,ze.jsx)("div",{className:"p-3 rounded-lg ".concat(e.color||"bg-blue-100"),children:i.createElement(e.icon||jn,{className:"w-6 h-6 ".concat(e.iconColor||"text-blue-600")})})]})},t))}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Trend Analysis"}),(0,ze.jsx)("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(Mm,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"Chart visualization"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400",children:"Integration with chart library required"})]})})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribution"}),(0,ze.jsx)("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)(In,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"Pie chart visualization"}),(0,ze.jsx)("p",{className:"text-sm text-gray-400",children:"Integration with chart library required"})]})})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,ze.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,ze.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Detailed Data"})}),(0,ze.jsx)("div",{className:"overflow-x-auto",children:(0,ze.jsxs)("table",{className:"w-full",children:[(0,ze.jsx)("thead",{className:"bg-gray-50",children:(0,ze.jsx)("tr",{children:null===(n=p.columns)||void 0===n?void 0:n.map((e,t)=>(0,ze.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e},t))})}),(0,ze.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:null===(r=p.rows)||void 0===r?void 0:r.map((e,t)=>(0,ze.jsx)("tr",{className:"hover:bg-gray-50",children:e.map((e,t)=>(0,ze.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e},t))},t))})]})})]})]}):(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[(0,ze.jsx)(gd,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,ze.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Data Available"}),(0,ze.jsx)("p",{className:"text-gray-500",children:"Unable to generate report with current filters"})]})]}):(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[(0,ze.jsx)(jn,{className:"w-16 h-16 text-gray-300 mx-auto mb-6"}),(0,ze.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Report Template"}),(0,ze.jsx)("p",{className:"text-gray-600 mb-6",children:"Choose from the available report templates to generate comprehensive analytics"}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-w-md mx-auto",children:[(0,ze.jsxs)("button",{onClick:()=>v("revenue_analysis"),className:"p-4 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors",children:[(0,ze.jsx)(Mn,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-green-800",children:"Revenue Report"})]}),(0,ze.jsxs)("button",{onClick:()=>v("trip_performance"),className:"p-4 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:[(0,ze.jsx)(Sn,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Trip Performance"})]})]})]})})]}),!c&&(0,ze.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Reports"}),(0,ze.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:"24"})]}),(0,ze.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,ze.jsx)(Lg,{className:"w-6 h-6 text-blue-600"})})]}),(0,ze.jsxs)("div",{className:"mt-4 flex items-center text-sm text-green-600",children:[(0,ze.jsx)(Ou,{className:"w-4 h-4 mr-1"}),(0,ze.jsx)("span",{children:"+3 this month"})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Data Sources"}),(0,ze.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:"8"})]}),(0,ze.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,ze.jsx)(Dn,{className:"w-6 h-6 text-green-600"})})]}),(0,ze.jsxs)("div",{className:"mt-4 flex items-center text-sm text-gray-500",children:[(0,ze.jsx)(xd,{className:"w-4 h-4 mr-1"}),(0,ze.jsx)("span",{children:"All connected"})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Last Export"}),(0,ze.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:"2h"})]}),(0,ze.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg",children:(0,ze.jsx)(hd,{className:"w-6 h-6 text-purple-600"})})]}),(0,ze.jsxs)("div",{className:"mt-4 flex items-center text-sm text-gray-500",children:[(0,ze.jsx)(td,{className:"w-4 h-4 mr-1"}),(0,ze.jsx)("span",{children:"ago"})]})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Scheduled Reports"}),(0,ze.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:"5"})]}),(0,ze.jsx)("div",{className:"p-3 bg-orange-100 rounded-lg",children:(0,ze.jsx)(Tn,{className:"w-6 h-6 text-orange-600"})})]}),(0,ze.jsxs)("div",{className:"mt-4 flex items-center text-sm text-blue-600",children:[(0,ze.jsx)(Du,{className:"w-4 h-4 mr-1"}),(0,ze.jsx)("span",{children:"Auto-generated"})]})]})]})]})]})},hS=()=>{const[e,t]=(0,i.useState)("general"),[n,r]=(0,i.useState)({general:{siteName:"Yatrik ERP",siteDescription:"Advanced Bus Management System",timezone:"Asia/Kolkata",language:"en",currency:"INR",dateFormat:"DD/MM/YYYY",timeFormat:"24h"},security:{passwordMinLength:8,passwordRequireSpecial:!0,sessionTimeout:30,twoFactorEnabled:!1,loginAttempts:5,lockoutDuration:15,ipWhitelist:[],encryptionLevel:"AES-256"},notifications:{emailEnabled:!0,smsEnabled:!1,pushEnabled:!0,adminAlerts:!0,systemAlerts:!0,bookingAlerts:!0,maintenanceAlerts:!0},api:{rateLimit:1e3,corsEnabled:!0,allowedOrigins:["http://localhost:3000"],apiVersion:"v1",debugMode:!1,logLevel:"info"},database:{connectionPool:10,queryTimeout:30,backupEnabled:!0,backupFrequency:"daily",retentionDays:30,compressionEnabled:!0},payment:{gatewayEnabled:!0,testMode:!1,merchantId:"",secretKey:"",webhookUrl:"",autoRefund:!1,refundWindow:24}}),[s,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),u=[{key:"general",label:"General",icon:Pn},{key:"security",label:"Security",icon:An},{key:"notifications",label:"Notifications",icon:Hn},{key:"api",label:"API Settings",icon:zn},{key:"database",label:"Database",icon:Rn},{key:"payment",label:"Payments",icon:Mn}];(0,i.useEffect)(()=>{h()},[]);const h=async()=>{try{a(!0);const e=await fetch("/api/admin/settings",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();r(t.settings||n)}}catch(e){console.error("Error fetching settings:",e)}finally{a(!1)}},p=async()=>{try{l(!0);(await fetch("/api/admin/settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(n)})).ok&&alert("Settings saved successfully!")}catch(e){console.error("Error saving settings:",e),alert("Failed to save settings. Please try again.")}finally{l(!1)}},m=(e,t,n)=>{r(i=>Le(Le({},i),{},{[e]:Le(Le({},i[e]),{},{[t]:n})}))},f=async e=>{try{(await fetch("/api/admin/test/".concat(e),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).ok?alert("".concat(e," connection test successful!")):alert("".concat(e," connection test failed!"))}catch(t){alert("".concat(e," connection test error: ").concat(t.message))}};return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,ze.jsx)("div",{className:"px-6 py-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"System Settings"}),(0,ze.jsx)("p",{className:"text-gray-600 mt-1",children:"Configure system-wide settings and preferences"})]}),(0,ze.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,ze.jsx)("button",{onClick:h,className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:(0,ze.jsx)(Lu,{className:"w-5 h-5"})}),(0,ze.jsxs)("button",{onClick:p,disabled:o,className:"bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-2 rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-200 flex items-center space-x-2 shadow-lg disabled:opacity-50",children:[(0,ze.jsx)(Im,{className:"w-5 h-5"}),(0,ze.jsx)("span",{children:o?"Saving...":"Save Changes"})]})]})]})})}),(0,ze.jsx)("div",{className:"px-6 py-6",children:(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,ze.jsx)("div",{className:"lg:col-span-1",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 sticky top-6",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Settings Categories"}),(0,ze.jsx)("nav",{className:"space-y-2",children:u.map(n=>{const i=n.icon;return(0,ze.jsxs)("button",{onClick:()=>t(n.key),className:"w-full text-left px-4 py-3 rounded-lg transition-all flex items-center space-x-3 ".concat(e===n.key?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-100"),children:[(0,ze.jsx)(i,{className:"w-5 h-5"}),(0,ze.jsx)("span",{className:"font-medium",children:n.label})]},n.key)})})]})}),(0,ze.jsx)("div",{className:"lg:col-span-3",children:(0,ze.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:["general"===e&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"General Settings"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Basic system configuration and preferences"})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Site Name"}),(0,ze.jsx)("input",{type:"text",value:n.general.siteName,onChange:e=>m("general","siteName",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),(0,ze.jsxs)("select",{value:n.general.timezone,onChange:e=>m("general","timezone",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),(0,ze.jsx)("option",{value:"UTC",children:"UTC"}),(0,ze.jsx)("option",{value:"America/New_York",children:"America/New_York (EST)"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Currency"}),(0,ze.jsxs)("select",{value:n.general.currency,onChange:e=>m("general","currency",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"INR",children:"INR (\u20b9)"}),(0,ze.jsx)("option",{value:"USD",children:"USD ($)"}),(0,ze.jsx)("option",{value:"EUR",children:"EUR (\u20ac)"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Format"}),(0,ze.jsxs)("select",{value:n.general.dateFormat,onChange:e=>m("general","dateFormat",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),(0,ze.jsx)("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),(0,ze.jsx)("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Site Description"}),(0,ze.jsx)("textarea",{value:n.general.siteDescription,onChange:e=>m("general","siteDescription",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3"})]})]}),"security"===e&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Security Settings"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Configure authentication and security policies"})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password Minimum Length"}),(0,ze.jsx)("input",{type:"number",value:n.security.passwordMinLength,onChange:e=>m("security","passwordMinLength",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"6",max:"20"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Timeout (minutes)"}),(0,ze.jsx)("input",{type:"number",value:n.security.sessionTimeout,onChange:e=>m("security","sessionTimeout",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"5",max:"480"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Login Attempts"}),(0,ze.jsx)("input",{type:"number",value:n.security.loginAttempts,onChange:e=>m("security","loginAttempts",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"3",max:"10"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lockout Duration (minutes)"}),(0,ze.jsx)("input",{type:"number",value:n.security.lockoutDuration,onChange:e=>m("security","lockoutDuration",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"60"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Require Special Characters"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Passwords must include special characters"})]}),(0,ze.jsx)("button",{onClick:()=>m("security","passwordRequireSpecial",!n.security.passwordRequireSpecial),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.security.passwordRequireSpecial?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.security.passwordRequireSpecial?"translate-x-6":"translate-x-1")})})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Two-Factor Authentication"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Enable 2FA for all admin users"})]}),(0,ze.jsx)("button",{onClick:()=>m("security","twoFactorEnabled",!n.security.twoFactorEnabled),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.security.twoFactorEnabled?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.security.twoFactorEnabled?"translate-x-6":"translate-x-1")})})]})]})]}),"notifications"===e&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Notification Settings"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Configure system notifications and alerts"})]}),(0,ze.jsx)("div",{className:"space-y-4",children:[{key:"emailEnabled",label:"Email Notifications",description:"Send notifications via email"},{key:"smsEnabled",label:"SMS Notifications",description:"Send notifications via SMS"},{key:"pushEnabled",label:"Push Notifications",description:"Send browser push notifications"},{key:"adminAlerts",label:"Admin Alerts",description:"Receive administrative alerts"},{key:"systemAlerts",label:"System Alerts",description:"Receive system health alerts"},{key:"bookingAlerts",label:"Booking Alerts",description:"Receive booking-related alerts"},{key:"maintenanceAlerts",label:"Maintenance Alerts",description:"Receive maintenance notifications"}].map(e=>(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.label}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]}),(0,ze.jsx)("button",{onClick:()=>m("notifications",e.key,!n.notifications[e.key]),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.notifications[e.key]?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.notifications[e.key]?"translate-x-6":"translate-x-1")})})]},e.key))})]}),"api"===e&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"API Configuration"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Configure API settings and security"})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate Limit (requests/hour)"}),(0,ze.jsx)("input",{type:"number",value:n.api.rateLimit,onChange:e=>m("api","rateLimit",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Log Level"}),(0,ze.jsxs)("select",{value:n.api.logLevel,onChange:e=>m("api","logLevel",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"error",children:"Error"}),(0,ze.jsx)("option",{value:"warn",children:"Warning"}),(0,ze.jsx)("option",{value:"info",children:"Info"}),(0,ze.jsx)("option",{value:"debug",children:"Debug"})]})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"CORS Enabled"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Allow cross-origin requests"})]}),(0,ze.jsx)("button",{onClick:()=>m("api","corsEnabled",!n.api.corsEnabled),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.api.corsEnabled?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.api.corsEnabled?"translate-x-6":"translate-x-1")})})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Debug Mode"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Enable detailed API logging"})]}),(0,ze.jsx)("button",{onClick:()=>m("api","debugMode",!n.api.debugMode),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.api.debugMode?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.api.debugMode?"translate-x-6":"translate-x-1")})})]})]}),(0,ze.jsx)("div",{className:"mt-6",children:(0,ze.jsx)("button",{onClick:()=>f("api"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Test API Connection"})})]}),"database"===e&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Database Configuration"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Database connection and backup settings"})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Connection Pool Size"}),(0,ze.jsx)("input",{type:"number",value:n.database.connectionPool,onChange:e=>m("database","connectionPool",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"50"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Query Timeout (seconds)"}),(0,ze.jsx)("input",{type:"number",value:n.database.queryTimeout,onChange:e=>m("database","queryTimeout",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"5",max:"120"})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Frequency"}),(0,ze.jsxs)("select",{value:n.database.backupFrequency,onChange:e=>m("database","backupFrequency",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,ze.jsx)("option",{value:"hourly",children:"Hourly"}),(0,ze.jsx)("option",{value:"daily",children:"Daily"}),(0,ze.jsx)("option",{value:"weekly",children:"Weekly"}),(0,ze.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Retention Days"}),(0,ze.jsx)("input",{type:"number",value:n.database.retentionDays,onChange:e=>m("database","retentionDays",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"7",max:"365"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Backup Enabled"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Automatic database backups"})]}),(0,ze.jsx)("button",{onClick:()=>m("database","backupEnabled",!n.database.backupEnabled),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.database.backupEnabled?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.database.backupEnabled?"translate-x-6":"translate-x-1")})})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Compression"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Enable backup compression"})]}),(0,ze.jsx)("button",{onClick:()=>m("database","compressionEnabled",!n.database.compressionEnabled),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.database.compressionEnabled?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.database.compressionEnabled?"translate-x-6":"translate-x-1")})})]})]}),(0,ze.jsxs)("div",{className:"flex space-x-4",children:[(0,ze.jsx)("button",{onClick:()=>f("database"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Test Connection"}),(0,ze.jsx)("button",{onClick:()=>f("backup"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Test Backup"})]})]}),"payment"===e&&(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,ze.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Gateway Settings"}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Configure payment processing and gateway settings"})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Merchant ID"}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("input",{type:c?"text":"password",value:n.payment.merchantId,onChange:e=>m("payment","merchantId",e.target.value),className:"w-full px-4 py-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter merchant ID"}),(0,ze.jsx)("button",{type:"button",onClick:()=>d(!c),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:c?(0,ze.jsx)(gh,{className:"w-5 h-5 text-gray-400"}):(0,ze.jsx)(xh,{className:"w-5 h-5 text-gray-400"})})]})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Window (hours)"}),(0,ze.jsx)("input",{type:"number",value:n.payment.refundWindow,onChange:e=>m("payment","refundWindow",parseInt(e.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"168"})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Gateway Enabled"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:"Enable payment processing"})]}),(0,ze.jsx)("button",{onClick:()=>m("payment","gatewayEnabled",!n.payment.gatewayEnabled),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.payment.gatewayEnabled?"bg-blue-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.payment.gatewayEnabled?"translate-x-6":"translate-x-1")})})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h4",{className:"text-sm font-medium text-yellow-800",children:"Test Mode"}),(0,ze.jsx)("p",{className:"text-xs text-yellow-600",children:"Use sandbox environment for testing"})]}),(0,ze.jsx)("button",{onClick:()=>m("payment","testMode",!n.payment.testMode),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n.payment.testMode?"bg-yellow-600":"bg-gray-200"),children:(0,ze.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n.payment.testMode?"translate-x-6":"translate-x-1")})})]})]}),(0,ze.jsx)("div",{className:"mt-6",children:(0,ze.jsx)("button",{onClick:()=>f("payment"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Test Payment Gateway"})})]}),(0,ze.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-between",children:[(0,ze.jsx)("button",{onClick:()=>{return t=e,void(window.confirm("Reset ".concat(t," settings to default values?"))&&alert("".concat(t," settings reset to defaults")));var t},className:"px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors",children:"Reset to Defaults"}),(0,ze.jsxs)("div",{className:"flex space-x-3",children:[(0,ze.jsx)("button",{onClick:h,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Discard Changes"}),(0,ze.jsx)("button",{onClick:p,disabled:o,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?"Saving...":"Save Settings"})]})]})]})})]})})]})},pS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Time Table Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage bus schedules and timetables"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Time table management functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"Create and manage bus schedules"}),(0,ze.jsx)("li",{children:"Set departure and arrival times"}),(0,ze.jsx)("li",{children:"Handle route timing"}),(0,ze.jsx)("li",{children:"Manage seasonal schedules"})]})]})]}),mS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Reservation Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Manage all bus reservations and bookings"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Reservation management functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"View all reservations"}),(0,ze.jsx)("li",{children:"Handle booking confirmations"}),(0,ze.jsx)("li",{children:"Manage cancellations"}),(0,ze.jsx)("li",{children:"Track reservation status"})]})]})]}),fS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Complaint Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Handle customer complaints and feedback"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Complaint management functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"View customer complaints"}),(0,ze.jsx)("li",{children:"Assign complaints to staff"}),(0,ze.jsx)("li",{children:"Track resolution status"}),(0,ze.jsx)("li",{children:"Generate complaint reports"})]})]})]}),gS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Driver Conflict Management"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Resolve driver scheduling conflicts"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Driver conflict management functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"Identify scheduling conflicts"}),(0,ze.jsx)("li",{children:"Resolve overlapping duties"}),(0,ze.jsx)("li",{children:"Manage driver availability"}),(0,ze.jsx)("li",{children:"Optimize driver assignments"})]})]})]}),xS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Upcoming Payments"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Track and manage upcoming payment obligations"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Upcoming payments management functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"View pending payments"}),(0,ze.jsx)("li",{children:"Track payment due dates"}),(0,ze.jsx)("li",{children:"Manage payment reminders"}),(0,ze.jsx)("li",{children:"Generate payment reports"})]})]})]}),yS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Payment History"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"View and analyze completed payment transactions"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Payment history management functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"View completed payments"}),(0,ze.jsx)("li",{children:"Search payment records"}),(0,ze.jsx)("li",{children:"Generate payment reports"}),(0,ze.jsx)("li",{children:"Track payment trends"})]})]})]}),vS=()=>(0,ze.jsxs)("div",{className:"space-y-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Revenue Reports"}),(0,ze.jsx)("p",{className:"text-gray-600",children:"Analyze revenue and financial performance"})]}),(0,ze.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,ze.jsx)("p",{className:"text-gray-500",children:"Revenue reporting functionality will be implemented here."}),(0,ze.jsx)("p",{className:"text-gray-500 mt-2",children:"This will include:"}),(0,ze.jsxs)("ul",{className:"list-disc list-inside text-gray-500 mt-2 ml-4",children:[(0,ze.jsx)("li",{children:"Revenue analytics dashboard"}),(0,ze.jsx)("li",{children:"Profit and loss statements"}),(0,ze.jsx)("li",{children:"Revenue trend analysis"}),(0,ze.jsx)("li",{children:"Financial performance metrics"})]})]})]});function _S(){const e=te(),{user:t,loading:n}=Fe();return(0,i.useEffect)(()=>{if(!n)if(t)try{const n=(t.role||"").toLowerCase().trim(),i=(t.email||"").toLowerCase();console.log("RedirectDashboard - User data:",{role:n,email:i,userId:t._id,userName:t.name});const r=/^[a-z0-9]+-depot@yatrik\.com$/;let s="/pax";"admin"===n||"administrator"===n?(s="/admin",console.log("Redirecting admin user to:",s)):"depot_manager"===n||"depot-manager"===n||"depotmanager"===n?(s="/depot",console.log("Redirecting depot manager to:",s)):"conductor"===n?(s="/conductor",console.log("Redirecting conductor to:",s)):"driver"===n?(s="/driver",console.log("Redirecting driver to:",s)):r.test(i)?(s="/depot",console.log("Redirecting depot user by email pattern to:",s)):(s="/pax",console.log("Redirecting passenger to:",s)),console.log("Final destination: ".concat(s," for role: ").concat(n)),e(s,{replace:!0})}catch(i){console.error("Redirect error:",i),console.error("User data that caused error:",t),e("/pax",{replace:!0})}else e("/login",{replace:!0})},[e,t,n]),n?(0,ze.jsx)(gn,{fullScreen:!0,text:"Loading..."}):null}const bS=e=>{let{onSearch:t}=e;const[n,r]=(0,i.useState)(""),[s,a]=(0,i.useState)(""),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)([]),[u,h]=(0,i.useState)(!1),p=["Mumbai","Delhi","Bangalore","Chennai","Kolkata","Hyderabad","Pune","Ahmedabad","Jaipur","Lucknow"],m=(e,t)=>{"from"===t?r(e):a(e),h(!1)},f=(e,t)=>e?p.filter(t=>t.toLowerCase().includes(e.toLowerCase())):p;return(0,ze.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,ze.jsxs)("div",{className:"text-center mb-8",children:[(0,ze.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Plan Your Trip"}),(0,ze.jsx)("p",{className:"text-lg text-gray-600",children:"Search for the best routes and book your journey"})]}),(0,ze.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From"}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",value:n,onChange:e=>{r(e.target.value),h(!0)},onFocus:()=>h(!0),placeholder:"Departure city",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"})]}),u&&n&&(0,ze.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-48 overflow-y-auto",children:f(n).map((e,t)=>(0,ze.jsx)("div",{onClick:()=>m(e,"from"),className:"px-4 py-2 hover:bg-gray-50 cursor-pointer text-gray-700 hover:text-blue-600 transition-colors",children:e},t))})]}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To"}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"text",value:s,onChange:e=>{a(e.target.value),h(!0)},onFocus:()=>h(!0),placeholder:"Destination city",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"})]}),u&&s&&(0,ze.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-48 overflow-y-auto",children:f(s).map((e,t)=>(0,ze.jsx)("div",{onClick:()=>m(e,"to"),className:"px-4 py-2 hover:bg-gray-50 cursor-pointer text-gray-700 hover:text-blue-600 transition-colors",children:e},t))})]}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsx)(Tn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,ze.jsx)("input",{type:"date",value:o,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"})]})]}),(0,ze.jsx)("div",{children:(0,ze.jsxs)("button",{onClick:()=>{n&&s&&o&&t({fromCity:n,toCity:s,date:o})},disabled:!n||!s||!o,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",children:[(0,ze.jsx)(Un,{className:"w-5 h-5"}),"Search"]})})]}),(0,ze.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-500 mb-3",children:"Popular routes:"}),(0,ze.jsx)("div",{className:"flex flex-wrap gap-2",children:p.slice(0,6).map((e,t)=>(0,ze.jsxs)("button",{onClick:()=>{r(e),a(p[(t+1)%p.length])},className:"px-3 py-1 text-sm bg-gray-100 hover:bg-blue-100 text-gray-600 hover:text-blue-600 rounded-full transition-all duration-200 hover:scale-105",children:[e," \u2192 ",p[(t+1)%p.length]]},t))})]})]})]})},wS=wn("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),jS=e=>{let{nextTrip:t,onViewTicket:n,onTrackBus:i}=e;if(!t)return(0,ze.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-8 text-center border border-blue-100",children:[(0,ze.jsx)("div",{className:"w-24 h-24 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(Sn,{className:"w-12 h-12 text-blue-600"})}),(0,ze.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Upcoming Trips"}),(0,ze.jsx)("p",{className:"text-gray-600 mb-6",children:"Book your first trip to get started with your journey"}),(0,ze.jsx)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg",children:"Book Your First Trip"})]});return(0,ze.jsxs)("div",{className:"bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 rounded-2xl p-8 text-white shadow-2xl transform hover:scale-105 transition-all duration-300",children:[(0,ze.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"Next Trip"}),(0,ze.jsx)("p",{className:"text-blue-100",children:"Your upcoming journey"})]}),(e=>{const t={"on-time":{color:"bg-green-100 text-green-800",icon:"\ud83d\udfe2"},delayed:{color:"bg-yellow-100 text-yellow-800",icon:"\ud83d\udfe1"},cancelled:{color:"bg-red-100 text-red-800",icon:"\ud83d\udd34"},boarding:{color:"bg-blue-100 text-blue-800",icon:"\ud83d\udd35"}},n=t[e]||t["on-time"];return(0,ze.jsxs)("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ".concat(n.color),children:[n.icon," ",e.charAt(0).toUpperCase()+e.slice(1)]})})(t.status)]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:(0,ze.jsx)(Sn,{className:"w-5 h-5"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-blue-100 text-sm",children:"Bus Number"}),(0,ze.jsx)("p",{className:"font-semibold text-lg",children:t.busNumber||"KL-07-AB-1234"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:(0,ze.jsx)(id,{className:"w-5 h-5"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-blue-100 text-sm",children:"Route"}),(0,ze.jsx)("p",{className:"font-semibold text-lg",children:t.route||"Mumbai \u2192 Delhi"})]})]})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:(0,ze.jsx)(td,{className:"w-5 h-5"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-blue-100 text-sm",children:"Departure"}),(0,ze.jsx)("p",{className:"font-semibold text-lg",children:t.departureTime||"14:30"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:(0,ze.jsx)(Tn,{className:"w-5 h-5"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-blue-100 text-sm",children:"Date"}),(0,ze.jsx)("p",{className:"font-semibold text-lg",children:t.date||"Dec 15, 2024"})]})]})]})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("p",{className:"text-blue-100 text-sm mb-1",children:"Seat Number"}),(0,ze.jsx)("p",{className:"text-3xl font-bold",children:t.seatNo||"18"})]}),(0,ze.jsxs)("div",{className:"flex gap-3",children:[(0,ze.jsxs)("button",{onClick:n,className:"bg-white/20 hover:bg-white/30 text-white font-semibold px-6 py-3 rounded-xl transition-all duration-200 transform hover:scale-105 flex items-center gap-2 border border-white/30",children:[(0,ze.jsx)(Pg,{className:"w-5 h-5"}),"View Ticket"]}),(0,ze.jsxs)("button",{onClick:i,className:"bg-white text-blue-700 hover:bg-gray-100 font-semibold px-6 py-3 rounded-xl transition-all duration-200 transform hover:scale-105 flex items-center gap-2",children:[(0,ze.jsx)(wS,{className:"w-5 h-5"}),"Track Bus"]})]})]})]})},NS=wn("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),SS=e=>{let{walletData:t,onAddMoney:n,onShowQRPass:i}=e;const r=t||{balance:1250,currency:"\u20b9",activePasses:2,totalSpent:3450,concessions:150};return(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:(0,ze.jsx)(NS,{className:"w-6 h-6 text-white"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Wallet & Passes"}),(0,ze.jsx)("p",{className:"text-gray-500 text-sm",children:"Manage your balance & passes"})]})]}),(0,ze.jsx)("button",{onClick:n,className:"w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-xl flex items-center justify-center transition-colors duration-200",children:(0,ze.jsx)(mh,{className:"w-5 h-5 text-gray-600"})})]}),(0,ze.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 mb-6 border border-green-100",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Available Balance"}),(0,ze.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:[r.currency,r.balance.toFixed(2)]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Spent"}),(0,ze.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[r.currency,r.totalSpent.toFixed(2)]})]})]})}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,ze.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,ze.jsx)(ph,{className:"w-4 h-4 text-blue-600"}),(0,ze.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:"Active Passes"})]}),(0,ze.jsx)("p",{className:"text-xl font-bold text-blue-900",children:r.activePasses})]}),(0,ze.jsxs)("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,ze.jsx)(Ou,{className:"w-4 h-4 text-orange-600"}),(0,ze.jsx)("span",{className:"text-xs text-orange-600 font-medium",children:"Concessions"})]}),(0,ze.jsxs)("p",{className:"text-xl font-bold text-orange-900",children:[r.currency,r.concessions.toFixed(2)]})]})]}),(0,ze.jsxs)("button",{onClick:i,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[(0,ze.jsx)(Pg,{className:"w-5 h-5"}),"Show Digital Pass"]}),(0,ze.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,ze.jsx)("button",{className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200",children:"Add Money"}),(0,ze.jsx)("button",{className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200",children:"View History"})]})]})})},kS=e=>{let{refundData:t,onViewDetails:n}=e;const i=t||[{id:1,amount:450,status:"pending",reason:"Trip cancelled due to weather",requestedDate:"2024-12-10",estimatedDate:"2024-12-17"},{id:2,amount:1200,status:"completed",reason:"Bus breakdown",requestedDate:"2024-12-05",completedDate:"2024-12-08"}],r=i.filter(e=>"pending"===e.status),s=i.filter(e=>"completed"===e.status),a=e=>{const t={pending:{color:"bg-yellow-100 text-yellow-800",icon:td,text:"Pending"},completed:{color:"bg-green-100 text-green-800",icon:xd,text:"Completed"},rejected:{color:"bg-red-100 text-red-800",icon:yd,text:"Rejected"}};return t[e]||t.pending};return 0===i.length?(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6 text-center",children:[(0,ze.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(mf,{className:"w-10 h-10 text-gray-400"})}),(0,ze.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No Refunds"}),(0,ze.jsx)("p",{className:"text-gray-500 text-sm mb-4",children:"You haven't requested any refunds yet"}),(0,ze.jsx)("div",{className:"w-16 h-1 bg-gray-200 rounded-full mx-auto"})]})}):(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center",children:(0,ze.jsx)(mf,{className:"w-6 h-6 text-white"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Refund Status"}),(0,ze.jsx)("p",{className:"text-gray-500 text-sm",children:"Track your refund requests"})]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20b9",r.reduce((e,t)=>e+t.amount,0).toFixed(2)]}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Pending"})]})]}),r.length>0&&(0,ze.jsxs)("div",{className:"mb-6",children:[(0,ze.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pending Refunds"}),(0,ze.jsx)("div",{className:"space-y-3",children:r.map(e=>{const t=a(e.status),n=t.icon;return(0,ze.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-3 border border-yellow-100",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsx)(n,{className:"w-4 h-4 text-yellow-600"}),(0,ze.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(t.color),children:t.text})]}),(0,ze.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:["\u20b9",e.amount.toFixed(2)]})]}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.reason}),(0,ze.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,ze.jsxs)("span",{children:["Requested: ",e.requestedDate]}),(0,ze.jsxs)("span",{children:["Est. completion: ",e.estimatedDate]})]})]},e.id)})})]}),s.length>0&&(0,ze.jsxs)("div",{className:"mb-6",children:[(0,ze.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Completed Refunds"}),(0,ze.jsx)("div",{className:"space-y-3",children:s.slice(0,2).map(e=>{const t=a(e.status),n=t.icon;return(0,ze.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 border border-green-100",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsx)(n,{className:"w-4 h-4 text-green-600"}),(0,ze.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(t.color),children:t.text})]}),(0,ze.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:["\u20b9",e.amount.toFixed(2)]})]}),(0,ze.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.reason}),(0,ze.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,ze.jsxs)("span",{children:["Requested: ",e.requestedDate]}),(0,ze.jsxs)("span",{children:["Completed: ",e.completedDate]})]})]},e.id)})})]}),(0,ze.jsxs)("button",{onClick:n,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:["View All Refunds",(0,ze.jsx)(ed,{className:"w-4 h-4"})]})]})})},TS=wn("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),CS=e=>{let{ticketsData:t,onViewTicket:n,onDownloadTicket:i,onShowQR:r}=e;const s=t||[{id:1,tripId:"TRP001",route:"Mumbai \u2192 Delhi",busNumber:"KL-07-AB-1234",seatNo:"18",departureTime:"14:30",date:"Dec 15, 2024",status:"confirmed",qrCode:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="},{id:2,tripId:"TRP002",route:"Delhi \u2192 Bangalore",busNumber:"DL-01-CD-5678",seatNo:"22",departureTime:"09:15",date:"Dec 20, 2024",status:"upcoming",qrCode:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="},{id:3,tripId:"TRP003",route:"Bangalore \u2192 Chennai",busNumber:"BL-02-EF-9012",seatNo:"15",departureTime:"16:45",date:"Dec 25, 2024",status:"upcoming",qrCode:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="}],a=s.slice(0,3);return 0===s.length?(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6 text-center",children:[(0,ze.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(TS,{className:"w-10 h-10 text-gray-400"})}),(0,ze.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No Tickets"}),(0,ze.jsx)("p",{className:"text-gray-500 text-sm mb-4",children:"You haven't booked any trips yet"}),(0,ze.jsx)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-xl transition-all duration-200",children:"Book Your First Trip"})]})}):(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:(0,ze.jsx)(TS,{className:"w-6 h-6 text-white"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"My Tickets"}),(0,ze.jsx)("p",{className:"text-gray-500 text-sm",children:"Recent bookings & tickets"})]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s.length}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Total"})]})]}),(0,ze.jsx)("div",{className:"space-y-4 mb-6",children:a.map(e=>{const t=(e=>{const t={confirmed:{color:"bg-green-100 text-green-800",text:"Confirmed"},upcoming:{color:"bg-blue-100 text-blue-800",text:"Upcoming"},completed:{color:"bg-gray-100 text-gray-800",text:"Completed"},cancelled:{color:"bg-red-100 text-red-800",text:"Cancelled"}};return t[e]||t.confirmed})(e.status);return(0,ze.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100 hover:bg-gray-100 transition-colors duration-200",children:[(0,ze.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,ze.jsxs)("span",{className:"text-xs font-medium text-gray-500",children:["#",e.tripId]}),(0,ze.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(t.color),children:t.text})]}),(0,ze.jsx)("h4",{className:"font-semibold text-gray-900 mb-1",children:e.route}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-600",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-1",children:[(0,ze.jsx)(Sn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:e.busNumber})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-1",children:[(0,ze.jsx)(td,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:e.departureTime})]})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-600",children:[(0,ze.jsx)(id,{className:"w-4 h-4"}),(0,ze.jsx)("span",{children:e.date}),(0,ze.jsx)("span",{className:"text-gray-400",children:"\u2022"}),(0,ze.jsxs)("span",{children:["Seat ",e.seatNo]})]})]})}),(0,ze.jsxs)("div",{className:"flex gap-2",children:[(0,ze.jsxs)("button",{onClick:()=>n(e),className:"flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center gap-1",children:[(0,ze.jsx)(xh,{className:"w-4 h-4"}),"View"]}),(0,ze.jsxs)("button",{onClick:()=>r(e),className:"flex-1 bg-green-100 hover:bg-green-200 text-green-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center gap-1",children:[(0,ze.jsx)(Pg,{className:"w-4 h-4"}),"QR"]}),(0,ze.jsxs)("button",{onClick:()=>i(e),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center gap-1",children:[(0,ze.jsx)(hd,{className:"w-4 h-4"}),"Download"]})]})]},e.id)})}),s.length>3&&(0,ze.jsxs)("button",{className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-xl transition-all duration-200",children:["View All ",s.length," Tickets"]})]})})},ES=e=>{let{tripsData:t,onViewTrip:n,onCancelTrip:i,onTrackTrip:r,onViewTicket:s}=e;const a=t||[{id:1,tripId:"TRP001",route:"Mumbai \u2192 Delhi",busNumber:"KL-07-AB-1234",seatNo:"18",departureTime:"14:30",arrivalTime:"06:30",date:"Dec 15, 2024",status:"on-time",price:1200,boardingPoint:"Mumbai Central",destinationPoint:"Delhi ISBT"},{id:2,tripId:"TRP002",route:"Delhi \u2192 Bangalore",busNumber:"DL-01-CD-5678",seatNo:"22",departureTime:"09:15",arrivalTime:"08:45",date:"Dec 20, 2024",status:"delayed",price:1800,boardingPoint:"Delhi ISBT",destinationPoint:"Bangalore Majestic"},{id:3,tripId:"TRP003",route:"Bangalore \u2192 Chennai",busNumber:"BL-02-EF-9012",seatNo:"15",departureTime:"16:45",arrivalTime:"06:30",date:"Dec 25, 2024",status:"on-time",price:950,boardingPoint:"Bangalore Majestic",destinationPoint:"Chennai Central"}];return 0===a.length?(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-8 text-center",children:[(0,ze.jsx)("div",{className:"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(Sn,{className:"w-12 h-12 text-gray-400"})}),(0,ze.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Upcoming Trips"}),(0,ze.jsx)("p",{className:"text-gray-600 mb-6",children:"You don't have any upcoming trips scheduled"}),(0,ze.jsx)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg",children:"Search for Trips"})]})}):(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center",children:(0,ze.jsx)(Tn,{className:"w-6 h-6 text-white"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Upcoming Trips"}),(0,ze.jsx)("p",{className:"text-gray-500 text-sm",children:"Your scheduled journeys"})]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.length}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Trips"})]})]}),(0,ze.jsx)("div",{className:"space-y-4",children:a.map((e,t)=>{const a=(e=>{const t={"on-time":{color:"bg-green-100 text-green-800",icon:"\ud83d\udfe2",text:"On Time"},delayed:{color:"bg-yellow-100 text-yellow-800",icon:"\ud83d\udfe1",text:"Delayed"},cancelled:{color:"bg-red-100 text-red-800",icon:"\ud83d\udd34",text:"Cancelled"},boarding:{color:"bg-blue-100 text-blue-800",icon:"\ud83d\udd35",text:"Boarding"}};return t[e]||t["on-time"]})(e.status);return(0,ze.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100 hover:bg-gray-100 transition-all duration-200 hover:shadow-md",children:[(0,ze.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-bold text-blue-600",children:t+1}),(0,ze.jsxs)("div",{children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,ze.jsxs)("span",{className:"text-xs font-medium text-gray-500",children:["#",e.tripId]}),(0,ze.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(a.color),children:[a.icon," ",a.text]})]}),(0,ze.jsx)("h4",{className:"font-bold text-lg text-gray-900",children:e.route})]})]}),(0,ze.jsxs)("div",{className:"text-right",children:[(0,ze.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20b9",e.price]}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Total Fare"})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,ze.jsx)(Sn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"font-medium",children:"Bus:"}),(0,ze.jsx)("span",{children:e.busNumber})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,ze.jsx)(TS,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"font-medium",children:"Seat:"}),(0,ze.jsx)("span",{className:"font-semibold",children:e.seatNo})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,ze.jsx)(id,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"font-medium",children:"From:"}),(0,ze.jsx)("span",{children:e.boardingPoint})]})]}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,ze.jsx)(td,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"font-medium",children:"Departure:"}),(0,ze.jsx)("span",{className:"font-semibold",children:e.departureTime})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,ze.jsx)(td,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"font-medium",children:"Arrival:"}),(0,ze.jsx)("span",{className:"font-semibold",children:e.arrivalTime})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,ze.jsx)(id,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"font-medium",children:"To:"}),(0,ze.jsx)("span",{children:e.destinationPoint})]})]})]}),(0,ze.jsx)("div",{className:"mb-4 p-3 bg-white rounded-lg border border-gray-200",children:(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,ze.jsx)(Tn,{className:"w-4 h-4"}),(0,ze.jsx)("span",{className:"font-medium",children:"Travel Date:"}),(0,ze.jsx)("span",{className:"font-semibold text-gray-900",children:e.date})]})}),(0,ze.jsxs)("div",{className:"flex gap-2",children:[(0,ze.jsxs)("button",{onClick:()=>n(e),className:"flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center gap-1",children:[(0,ze.jsx)(xh,{className:"w-4 h-4"}),"View Details"]}),(0,ze.jsxs)("button",{onClick:()=>s(e),className:"flex-1 bg-green-100 hover:bg-green-200 text-green-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center gap-1",children:[(0,ze.jsx)(TS,{className:"w-4 h-4"}),"View Ticket"]}),(0,ze.jsxs)("button",{onClick:()=>r(e),className:"flex-1 bg-purple-100 hover:bg-purple-200 text-purple-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center gap-1",children:[(0,ze.jsx)(wS,{className:"w-4 h-4"}),"Track"]}),(0,ze.jsxs)("button",{onClick:()=>i(e),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 font-medium py-2 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center gap-1",children:[(0,ze.jsx)(Fn,{className:"w-4 h-4"}),"Cancel"]})]})]},e.id)})})]})})},AS=wn("Signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]),MS=wn("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]),DS=e=>{let{trackingData:t,onTrackBus:n}=e;const[r,s]=(0,i.useState)(!1),a=t||{busNumber:"KL-07-AB-1234",route:"Kochi \u2192 Thiruvananthapuram",currentLocation:"Alappuzha, Kerala",destination:"Thiruvananthapuram, Kerala",estimatedArrival:"06:30",currentSpeed:"65 km/h",status:"on-route",lastUpdate:"2 minutes ago",coordinates:{lat:18.5204,lng:73.8567}},o=e=>{const t={"on-route":{color:"bg-green-100 text-green-800",icon:"\ud83d\udfe2",text:"On Route"},delayed:{color:"bg-yellow-100 text-yellow-800",icon:"\ud83d\udfe1",text:"Delayed"},arrived:{color:"bg-blue-100 text-blue-800",icon:"\ud83d\udd35",text:"Arrived"},breakdown:{color:"bg-red-100 text-red-800",icon:"\ud83d\udd34",text:"Breakdown"}};return t[e]||t["on-route"]};return(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:(0,ze.jsx)(wS,{className:"w-6 h-6 text-white"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Live Tracking"}),(0,ze.jsx)("p",{className:"text-gray-500 text-sm",children:"Track your bus in real-time"})]})]}),(0,ze.jsx)("div",{className:"text-right",children:(0,ze.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(o(a.status).color),children:[o(a.status).icon," ",o(a.status).text]})})]}),(0,ze.jsxs)("div",{className:"relative mb-6",children:[(0,ze.jsx)("div",{className:"w-full h-64 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border-2 border-dashed border-blue-200 flex items-center justify-center",children:(0,ze.jsxs)("div",{className:"text-center",children:[(0,ze.jsx)("div",{className:"w-16 h-16 mx-auto mb-3 bg-blue-100 rounded-full flex items-center justify-center",children:(0,ze.jsx)(id,{className:"w-8 h-8 text-blue-600"})}),(0,ze.jsx)("p",{className:"text-gray-600 font-medium",children:"Google Maps Integration"}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Live bus tracking will be displayed here"})]})}),(0,ze.jsx)("div",{className:"absolute top-4 left-4 bg-white rounded-lg p-3 shadow-lg border border-gray-200",children:(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),(0,ze.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Live Location"})]})}),(0,ze.jsx)("button",{onClick:()=>{s(!0),n&&n(a),setTimeout(()=>s(!1),2e3)},disabled:r,className:"absolute top-4 right-4 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold px-4 py-2 rounded-lg transition-all duration-200 transform hover:scale-105 disabled:transform-none flex items-center gap-2",children:r?(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Tracking..."]}):(0,ze.jsxs)(ze.Fragment,{children:[(0,ze.jsx)(wS,{className:"w-4 h-4"}),"Track Bus"]})})]}),(0,ze.jsxs)("div",{className:"space-y-4",children:[(0,ze.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,ze.jsx)("h4",{className:"font-semibold text-gray-900",children:"Current Route"}),(0,ze.jsx)("span",{className:"text-sm text-gray-500",children:a.lastUpdate})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1",children:[(0,ze.jsx)(id,{className:"w-4 h-4 text-blue-600"}),(0,ze.jsx)("span",{className:"font-medium",children:"Current Location:"})]}),(0,ze.jsx)("p",{className:"font-semibold text-gray-900",children:a.currentLocation})]}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1",children:[(0,ze.jsx)(id,{className:"w-4 h-4 text-green-600"}),(0,ze.jsx)("span",{className:"font-medium",children:"Destination:"})]}),(0,ze.jsx)("p",{className:"font-semibold text-gray-900",children:a.destination})]})]})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,ze.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,ze.jsx)(Sn,{className:"w-4 h-4 text-blue-600"}),(0,ze.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:"Bus Number"})]}),(0,ze.jsx)("p",{className:"text-lg font-bold text-blue-900",children:a.busNumber})]}),(0,ze.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 border border-green-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,ze.jsx)(wS,{className:"w-4 h-4 text-green-600"}),(0,ze.jsx)("span",{className:"text-xs text-green-600 font-medium",children:"Speed"})]}),(0,ze.jsx)("p",{className:"text-lg font-bold text-green-900",children:a.currentSpeed})]})]}),(0,ze.jsxs)("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,ze.jsx)(td,{className:"w-4 h-4 text-orange-600"}),(0,ze.jsx)("span",{className:"text-xs text-orange-600 font-medium",children:"Estimated Arrival"})]}),(0,ze.jsx)("p",{className:"text-lg font-bold text-orange-900",children:a.estimatedArrival})]}),(0,ze.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-3 border border-gray-100",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-4",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsx)(Mu,{className:"w-4 h-4 text-green-600"}),(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"GPS Active"})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsx)(AS,{className:"w-4 h-4 text-green-600"}),(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"Signal Strong"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsx)(MS,{className:"w-4 h-4 text-green-600"}),(0,ze.jsx)("span",{className:"text-sm text-gray-600",children:"100%"})]})]})]})]})})},IS=e=>{let{notificationsData:t,onDismiss:n,onMarkAsRead:r}=e;const[s,a]=(0,i.useState)(!1),o=t||[{id:1,type:"urgent",title:"Bus Delayed",message:"Your bus KL-07-AB-1234 is delayed by 15 minutes due to traffic.",timestamp:"2 minutes ago",isRead:!1,icon:Sn,color:"bg-red-100 text-red-800"},{id:2,type:"info",title:"Boarding Started",message:"Boarding has started for your Kochi \u2192 Thiruvananthapuram trip. Please reach the platform.",timestamp:"10 minutes ago",isRead:!1,icon:id,color:"bg-blue-100 text-blue-800"},{id:3,type:"success",title:"Payment Successful",message:"Your payment of \u20b91200 for trip TRP001 has been processed successfully.",timestamp:"1 hour ago",isRead:!0,icon:xd,color:"bg-green-100 text-green-800"},{id:4,type:"warning",title:"Route Change",message:"Minor route change for your upcoming trip due to road construction.",timestamp:"2 hours ago",isRead:!0,icon:gd,color:"bg-yellow-100 text-yellow-800"},{id:5,type:"info",title:"New Offers",message:"Get 20% off on your next booking. Use code YATRIK20.",timestamp:"1 day ago",isRead:!0,icon:fd,color:"bg-purple-100 text-purple-800"}],l=o.filter(e=>"urgent"===e.type&&!e.isRead),c=o.filter(e=>"urgent"!==e.type||e.isRead),d=o.filter(e=>!e.isRead).length,u=e=>{n&&n(e)};return(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsxs)("button",{onClick:()=>a(!s),className:"relative p-2 text-gray-600 hover:text-gray-900 transition-colors duration-200",children:[(0,ze.jsx)(Hn,{className:"w-6 h-6"}),d>0&&(0,ze.jsx)("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:d>9?"9+":d})]}),s&&(0,ze.jsxs)("div",{className:"absolute right-0 top-12 w-96 bg-white rounded-2xl shadow-2xl border border-gray-100 z-50 max-h-96 overflow-hidden",children:[(0,ze.jsxs)("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Notifications"}),(0,ze.jsx)("button",{onClick:()=>a(!1),className:"w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-lg flex items-center justify-center transition-colors duration-200",children:(0,ze.jsx)(Fn,{className:"w-4 h-4 text-gray-600"})})]}),(0,ze.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[d," unread notification",1!==d?"s":""]})]}),(0,ze.jsxs)("div",{className:"max-h-80 overflow-y-auto",children:[l.length>0&&(0,ze.jsxs)("div",{className:"p-3 bg-red-50 border-b border-red-100",children:[(0,ze.jsxs)("h4",{className:"text-sm font-semibold text-red-800 mb-2 flex items-center gap-2",children:[(0,ze.jsx)(gd,{className:"w-4 h-4"}),"Urgent Alerts"]}),l.map(e=>{const t=e.icon;return(0,ze.jsx)("div",{className:"bg-white rounded-lg p-3 mb-2 border border-red-200",children:(0,ze.jsxs)("div",{className:"flex items-start gap-3",children:[(0,ze.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat(e.color),children:(0,ze.jsx)(t,{className:"w-4 h-4"})}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsx)("h5",{className:"font-semibold text-gray-900 text-sm",children:e.title}),(0,ze.jsx)("p",{className:"text-gray-600 text-sm mt-1",children:e.message}),(0,ze.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,ze.jsxs)("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[(0,ze.jsx)(td,{className:"w-3 h-3"}),e.timestamp]}),(0,ze.jsx)("button",{onClick:()=>u(e.id),className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Dismiss"})]})]})]})},e.id)})]}),(0,ze.jsx)("div",{className:"p-3",children:c.map(e=>{const t=e.icon;return(0,ze.jsx)("div",{className:"rounded-lg p-3 mb-2 border transition-all duration-200 hover:shadow-sm ".concat(e.isRead?"bg-gray-50 border-gray-200":"bg-white border-gray-200 shadow-sm"),children:(0,ze.jsxs)("div",{className:"flex items-start gap-3",children:[(0,ze.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat(e.color),children:(0,ze.jsx)(t,{className:"w-4 h-4"})}),(0,ze.jsxs)("div",{className:"flex-1",children:[(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsx)("h5",{className:"font-semibold text-sm ".concat(e.isRead?"text-gray-600":"text-gray-900"),children:e.title}),!e.isRead&&(0,ze.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]}),(0,ze.jsx)("p",{className:"text-sm mt-1 ".concat(e.isRead?"text-gray-500":"text-gray-700"),children:e.message}),(0,ze.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,ze.jsxs)("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[(0,ze.jsx)(td,{className:"w-3 h-3"}),e.timestamp]}),(0,ze.jsxs)("div",{className:"flex gap-2",children:[!e.isRead&&(0,ze.jsx)("button",{onClick:()=>{return t=e.id,void(r&&r(t));var t},className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Mark as read"}),(0,ze.jsx)("button",{onClick:()=>u(e.id),className:"text-xs text-gray-500 hover:text-gray-700 font-medium",children:"Dismiss"})]})]})]})]})},e.id)})})]}),(0,ze.jsx)("div",{className:"p-3 border-t border-gray-100 bg-gray-50",children:(0,ze.jsx)("button",{className:"w-full text-center text-sm text-blue-600 hover:text-blue-800 font-medium py-2 rounded-lg hover:bg-blue-50 transition-colors duration-200",children:"View All Notifications"})})]})]})},PS=e=>{let{statsData:t}=e;const n=t||{upcomingTrips:3,totalSpent:3450,totalDistance:2847,averageRating:4.8,completedTrips:12,savedRoutes:5},i=[{title:"Upcoming Trips",value:n.upcomingTrips,change:"+2 from last month",icon:Tn,color:"from-blue-500 to-blue-600",bgColor:"bg-blue-50",textColor:"text-blue-700"},{title:"Total Spent",value:"\u20b9".concat(n.totalSpent.toLocaleString()),change:"+\u20b9450 this month",icon:Mn,color:"from-green-500 to-green-600",bgColor:"bg-green-50",textColor:"text-green-700"},{title:"Total Distance",value:"".concat(n.totalDistance," km"),change:"+156 km this month",icon:id,color:"from-purple-500 to-purple-600",bgColor:"bg-purple-50",textColor:"text-purple-700"},{title:"Average Rating",value:n.averageRating,change:"+0.2 from last month",icon:Ou,color:"from-orange-500 to-orange-600",bgColor:"bg-orange-50",textColor:"text-orange-700"}];return(0,ze.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:i.map((e,t)=>{const n=e.icon;return(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-100",children:(0,ze.jsxs)("div",{className:"p-6",children:[(0,ze.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br ".concat(e.color," rounded-xl flex items-center justify-center mb-4"),children:(0,ze.jsx)(n,{className:"w-6 h-6 text-white"})}),(0,ze.jsxs)("div",{className:"mb-2",children:[(0,ze.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:e.value}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:e.title})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ze.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(e.bgColor)}),(0,ze.jsx)("span",{className:"text-sm font-medium ".concat(e.textColor),children:e.change})]})]})},t)})})},RS=()=>{var e;const{user:t,logout:n}=Fe(),[r,s]=(0,i.useState)(!1),[a,o]=(0,i.useState)(null),[l,c]=(0,i.useState)([]);(0,i.useEffect)(()=>{o({id:1,busNumber:"KL-07-AB-1234",route:"Kochi \u2192 Thiruvananthapuram",seatNo:"18",departureTime:"14:30",date:"Dec 15, 2024",status:"on-time"})},[]);const d=e=>{console.log("View ticket for:",e)},u=e=>{console.log("Track bus for:",e)};return(0,ze.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ze.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40",children:(0,ze.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,ze.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ze.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-bold text-xl",children:"Y"})}),(0,ze.jsxs)("div",{children:[(0,ze.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"YATRIK ERP"}),(0,ze.jsx)("p",{className:"text-sm text-gray-500",children:"Passenger Portal"})]})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-4",children:[(0,ze.jsx)(IS,{notificationsData:l,onDismiss:e=>{c(t=>t.filter(t=>t.id!==e))},onMarkAsRead:e=>{c(t=>t.map(t=>t.id===e?Le(Le({},t),{},{isRead:!0}):t))}}),(0,ze.jsxs)("div",{className:"relative",children:[(0,ze.jsxs)("button",{onClick:()=>s(!r),className:"flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:[(0,ze.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center",children:(0,ze.jsx)("span",{className:"text-white font-semibold text-sm",children:(null===t||void 0===t||null===(e=t.name)||void 0===e?void 0:e.charAt(0))||"P"})}),(0,ze.jsx)("span",{className:"hidden md:block text-sm font-medium text-gray-700",children:(null===t||void 0===t?void 0:t.name)||"Passenger"})]}),r&&(0,ze.jsxs)("div",{className:"absolute right-0 top-12 w-48 bg-white rounded-xl shadow-lg border border-gray-200 py-2 z-50",children:[(0,ze.jsxs)("div",{className:"px-4 py-2 border-b border-gray-100",children:[(0,ze.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null===t||void 0===t?void 0:t.name)||"Passenger"}),(0,ze.jsx)("p",{className:"text-xs text-gray-500",children:(null===t||void 0===t?void 0:t.email)||"passenger@example.com"})]}),(0,ze.jsxs)("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,ze.jsx)(En,{className:"w-4 h-4"}),"My Account"]}),(0,ze.jsxs)("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,ze.jsx)(ph,{className:"w-4 h-4"}),"Wallet"]}),(0,ze.jsxs)("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,ze.jsx)(Pn,{className:"w-4 h-4"}),"Settings"]}),(0,ze.jsx)("div",{className:"border-t border-gray-100 my-1"}),(0,ze.jsxs)("button",{onClick:n,className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[(0,ze.jsx)(Bn,{className:"w-4 h-4"}),"Logout"]})]})]})]})]})})}),(0,ze.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,ze.jsx)("div",{className:"mb-12",children:(0,ze.jsx)(bS,{onSearch:e=>{console.log("Search initiated:",e)}})}),(0,ze.jsx)(PS,{}),(0,ze.jsx)("div",{className:"mb-8",children:(0,ze.jsx)(jS,{nextTrip:a,onViewTicket:d,onTrackBus:u})}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[(0,ze.jsx)(SS,{onAddMoney:()=>{console.log("Add money to wallet")},onShowQRPass:()=>{console.log("Show QR pass")}}),(0,ze.jsx)(kS,{onViewDetails:()=>{console.log("View refund details")}}),(0,ze.jsx)(CS,{onViewTicket:e=>{console.log("View ticket details:",e)},onDownloadTicket:e=>{console.log("Download ticket:",e)},onShowQR:e=>{console.log("Show QR for ticket:",e)}})]}),(0,ze.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[(0,ze.jsx)("div",{className:"xl:col-span-2",children:(0,ze.jsx)(ES,{onViewTrip:e=>{console.log("View trip details:",e)},onCancelTrip:e=>{console.log("Cancel trip:",e)},onTrackTrip:u,onViewTicket:d})}),(0,ze.jsx)("div",{className:"xl:col-span-1",children:(0,ze.jsx)(DS,{onTrackBus:u})})]})]})]})},LS=()=>{const{tripId:e}=ne(),t=te(),[n,r]=(0,i.useState)(null),[s,a]=(0,i.useState)(null),[o,l]=(0,i.useState)("board-1"),[c,d]=(0,i.useState)("U11"),[u,h]=(0,i.useState)(1),[p,m]=(0,i.useState)([{name:"",age:"",gender:""}]);return(0,i.useEffect)(()=>{!async function(){const t=await rh("/api/booking",{method:"POST",body:JSON.stringify({tripId:e,stopId:o,seatNo:c})});var n,i;t.ok&&(r((null===(n=t.data.data)||void 0===n?void 0:n.fare)||t.data.fare),a((null===(i=t.data.data)||void 0===i?void 0:i.bookingId)||t.data.bookingId))}()},[]),(0,ze.jsxs)("div",{className:"max-w-5xl mx-auto bg-white rounded-2xl shadow-soft p-6 space-y-4",children:[(0,ze.jsx)("h1",{className:"text-xl font-bold",children:"Booking"}),(0,ze.jsxs)("div",{className:"text-gray-700",children:["Trip: ",e]}),1===u&&(0,ze.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,ze.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,ze.jsx)("div",{className:"mb-2 font-semibold",children:"Select Seat"}),(0,ze.jsx)("div",{className:"grid grid-cols-5 gap-2 text-sm",children:["L01","L02","L03","L04","L05","U11","U12","U13","U14","U15"].map(e=>(0,ze.jsx)("button",{onClick:()=>d(e),className:"px-2 py-1 rounded-md border ".concat(c===e?"border-primary-600 text-primary-700":"border-gray-300"),children:e},e))})]}),(0,ze.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,ze.jsx)("div",{className:"mb-2 font-semibold",children:"Select Pickup and Dropoff point"}),(0,ze.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"w-full border rounded-lg px-3 py-2",children:[(0,ze.jsx)("option",{value:"board-1",children:"Boarding At Central Bus Station"}),(0,ze.jsx)("option",{value:"board-2",children:"Boarding At City Depot"})]}),(0,ze.jsxs)("select",{className:"w-full border rounded-lg px-3 py-2 mt-3",children:[(0,ze.jsx)("option",{children:"Drop At Silk Board"}),(0,ze.jsx)("option",{children:"Drop At City Center"})]}),(0,ze.jsxs)("div",{className:"mt-4 text-sm text-gray-600",children:["Selected: ",c]})]}),(0,ze.jsxs)("div",{className:"lg:col-span-2 flex items-center justify-between",children:[(0,ze.jsxs)("div",{className:"text-primary-700 font-semibold",children:["Fare: ",n?"\u20b9".concat(n):"..."," "]}),(0,ze.jsx)("button",{disabled:!s,onClick:()=>h(2),className:"bg-primary-600 text-white rounded-full px-6 py-2 disabled:opacity-60",children:"Provide Passenger Details"})]})]}),2===u&&(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"font-semibold mb-3",children:"Traveller Details"}),p.map((e,t)=>(0,ze.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-3",children:[(0,ze.jsx)("input",{placeholder:"Name",className:"border rounded-lg px-3 py-2",value:e.name,onChange:e=>{const n=[...p];n[t].name=e.target.value,m(n)}}),(0,ze.jsx)("input",{placeholder:"Age",className:"border rounded-lg px-3 py-2",value:e.age,onChange:e=>{const n=[...p];n[t].age=e.target.value,m(n)}}),(0,ze.jsxs)("select",{className:"border rounded-lg px-3 py-2",value:e.gender,onChange:e=>{const n=[...p];n[t].gender=e.target.value,m(n)},children:[(0,ze.jsx)("option",{value:"",children:"Gender"}),(0,ze.jsx)("option",{children:"Male"}),(0,ze.jsx)("option",{children:"Female"}),(0,ze.jsx)("option",{children:"Others"})]})]},t)),(0,ze.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,ze.jsx)("button",{onClick:()=>h(1),className:"rounded-full px-4 py-2 border",children:"Back"}),(0,ze.jsx)("button",{onClick:()=>h(3),className:"rounded-full px-6 py-2 bg-primary-600 text-white",children:"Proceed to Payee Details"})]})]}),3===u&&(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"font-semibold mb-3",children:"Payment option"}),(0,ze.jsxs)("div",{className:"space-y-3",children:[(0,ze.jsxs)("label",{className:"flex items-center gap-3",children:[(0,ze.jsx)("input",{type:"radio",name:"pay",defaultChecked:!0})," UPI Payments - Typing VPA"]}),(0,ze.jsx)("input",{placeholder:"Enter VPA/UPI ID",className:"border rounded-lg px-3 py-2 w-full"}),(0,ze.jsx)("button",{onClick:async function(){const e=await rh("/api/booking/confirm",{method:"POST",body:JSON.stringify({bookingId:s})});if(e.ok){var n,i,r;const s=(null===(n=e.data.data)||void 0===n||null===(i=n.ticket)||void 0===i?void 0:i.pnr)||(null===(r=e.data.ticket)||void 0===r?void 0:r.pnr);t("/pax/ticket/".concat(s,"?pnr=").concat(s))}},className:"w-full bg-primary-600 text-white rounded-full py-2",children:"Verify & Pay"})]})]})]})},zS=()=>{const e=te(),{user:t}=Fe(),[n]=Ie(),[r,s]=(0,i.useState)([]);return(0,i.useEffect)(()=>{!async function(){var e;const t=n.toString(),i=await rh("/api/trips/search?".concat(t));i.ok&&s((null===(e=i.data.data)||void 0===e?void 0:e.trips)||i.data.trips||[])}()},[n]),(0,ze.jsxs)("div",{className:"max-w-5xl mx-auto space-y-4",children:[(0,ze.jsx)("h1",{className:"text-2xl font-bold",children:"Available Trips"}),r.map(n=>(0,ze.jsx)("div",{className:"bg-white rounded-2xl shadow-soft p-4",children:(0,ze.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ze.jsxs)("div",{children:[(0,ze.jsx)("div",{className:"text-lg font-semibold",children:n.routeName}),(0,ze.jsxs)("div",{className:"text-sm text-gray-600",children:["Start ",n.startTime," \u2022 ",new Date(n.serviceDate).toDateString()]})]}),(0,ze.jsxs)("div",{className:"flex items-center gap-4",children:[(0,ze.jsxs)("div",{className:"bg-green-100 text-green-800 text-sm font-bold px-3 py-1 rounded-full",children:["\u20b9",n.fare]}),(0,ze.jsx)("button",{onClick:()=>{e(t?"/pax/booking/".concat(n._id):"/login?next=/pax/booking/".concat(n._id))},className:"bg-primary-600 text-white rounded-full px-4 py-2",children:"Select Berth"})]})]})},n._id)),0===r.length&&(0,ze.jsx)("div",{className:"text-gray-600",children:"No trips found."})]})};const OS=function(){return(0,ze.jsx)(fn,{children:(0,ze.jsx)(Be,{children:(0,ze.jsx)(Te,{children:(0,ze.jsxs)(_e,{children:[(0,ze.jsx)(ye,{path:"/",element:(0,ze.jsx)(Eu,{})}),(0,ze.jsx)(ye,{path:"/search-results",element:(0,ze.jsx)(Fu,{})}),(0,ze.jsx)(ye,{path:"/trip-search",element:(0,ze.jsx)(Vu,{})}),(0,ze.jsx)(ye,{path:"/login",element:(0,ze.jsx)(ah,{initialMode:"login"})}),(0,ze.jsx)(ye,{path:"/signup",element:(0,ze.jsx)(ah,{initialMode:"signup"})}),(0,ze.jsx)(ye,{path:"/oauth/callback",element:(0,ze.jsx)(oh,{})}),(0,ze.jsx)(ye,{path:"/reset-password",element:(0,ze.jsx)(lh,{})}),(0,ze.jsx)(ye,{path:"/profile",element:(0,ze.jsx)(xn,{children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(ch,{})})})}),(0,ze.jsx)(ye,{path:"/wallet",element:(0,ze.jsx)(xn,{children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(vh,{})})})}),(0,ze.jsx)(ye,{path:"/trip-planner",element:(0,ze.jsx)(xn,{children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(_h,{})})})}),(0,ze.jsx)(ye,{path:"/booking",element:(0,ze.jsx)(xn,{children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(bh,{})})})}),(0,ze.jsx)(ye,{path:"/kerala-routes",element:(0,ze.jsx)(xn,{children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(ym,{})})})}),(0,ze.jsx)(ye,{path:"/ticket",element:(0,ze.jsx)(xn,{children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(mm,{})})})}),(0,ze.jsx)(ye,{path:"/dashboard",element:(0,ze.jsx)(xn,{children:(0,ze.jsx)(_S,{})})}),(0,ze.jsx)(ye,{path:"/conductor",element:(0,ze.jsx)(xn,{roles:["conductor"],children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(vm,{})})})}),(0,ze.jsx)(ye,{path:"/driver",element:(0,ze.jsx)(xn,{roles:["driver"],children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(_m,{})})})}),(0,ze.jsx)(ye,{path:"/depot",element:(0,ze.jsx)(xn,{roles:["depot_manager"],children:(0,ze.jsx)(Cm,{})})}),(0,ze.jsx)(ye,{path:"/depot/dashboard",element:(0,ze.jsx)(xn,{roles:["depot_manager"],children:(0,ze.jsx)(Cm,{})})}),(0,ze.jsx)(ye,{path:"/pax",element:(0,ze.jsx)(xn,{roles:["passenger"],children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(RS,{})})})}),(0,ze.jsx)(ye,{path:"/pax/booking",element:(0,ze.jsx)(xn,{roles:["passenger"],children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(LS,{})})})}),(0,ze.jsx)(ye,{path:"/pax/results",element:(0,ze.jsx)(yn,{children:(0,ze.jsx)(zS,{})})}),(0,ze.jsx)(ye,{path:"/pax/booking/:id",element:(0,ze.jsx)(xn,{roles:["passenger"],children:(0,ze.jsx)(yn,{children:(0,ze.jsx)(LS,{})})})}),(0,ze.jsx)(ye,{path:"/admin",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Dm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/config",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Pm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/fare-policy",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(zm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/users",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Vm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/depots",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(qm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/routes",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Wm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/routes-management",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Km,{})})})}),(0,ze.jsx)(ye,{path:"/admin/depot-management",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Qm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/stops",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Jm,{})})})}),(0,ze.jsx)(ye,{path:"/admin/trips",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(nf,{})})})}),(0,ze.jsx)(ye,{path:"/admin/duties",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(rf,{})})})}),(0,ze.jsx)(ye,{path:"/admin/drivers",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(af,{})})})}),(0,ze.jsx)(ye,{path:"/admin/passengers",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(of,{})})})}),(0,ze.jsx)(ye,{path:"/admin/buses",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(nS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/buses/modern",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(nS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/buses/enhanced",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(Mg,{})})})}),(0,ze.jsx)(ye,{path:"/admin/buses/legacy",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(_f,{})})})}),(0,ze.jsx)(ye,{path:"/admin/conductors",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(iS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/depot-managers",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(rS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/timetable",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(pS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/reservations",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(mS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/complaints",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(fS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/conflicts",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(gS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/upcoming-payments",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(xS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/payment-history",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(yS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/revenue",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(vS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/system-status",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(ff,{})})})}),(0,ze.jsx)(ye,{path:"/admin/rbac",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(cS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/reports",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(uS,{})})})}),(0,ze.jsx)(ye,{path:"/admin/settings",element:(0,ze.jsx)(xn,{roles:["admin"],children:(0,ze.jsx)(qn,{children:(0,ze.jsx)(hS,{})})})})]})})})})};s.createRoot(document.getElementById("root")).render((0,ze.jsx)(i.StrictMode,{children:(0,ze.jsx)(OS,{})}))})()})();
//# sourceMappingURL=main.3ae2ae8f.js.map