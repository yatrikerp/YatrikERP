"use strict";(self.webpackChunkyatrik_erp_frontend=self.webpackChunkyatrik_erp_frontend||[]).push([[21],{3923:()=>{},9021:(e,s,a)=>{a.r(s),a.d(s,{default:()=>b});var i=a(9379),r=a(5043),t=(a(8729),a(3540)),l=a(2104),n=(a(3923),a(7819)),d=a(6533),c=a(2244),o=a(8646),u=a(5088),h=a(5087),m=a(4830),x=a(1360),j=a(9292),v=a(4991),p=a(614),N=a(579);const b=()=>{var e,s,a,b;const[g,A]=(0,r.useState)([]),[T,C]=(0,r.useState)(!0),[S,I]=(0,r.useState)(!1),[f,y]=(0,r.useState)(!1),[k,K]=(0,r.useState)(!1),[_,w]=(0,r.useState)(null),[D,L]=(0,r.useState)(""),[R,z]=(0,r.useState)("all"),[E,B]=(0,r.useState)({routeId:"",busId:"",driverId:"",conductorId:"",serviceDate:"",startTime:"",endTime:"",status:"scheduled"});(0,r.useEffect)(()=>{P()},[]),(0,r.useEffect)(()=>{const e=(0,l.Ay)({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SOCKET_URL||"http://localhost:5000",{auth:{token:localStorage.getItem("depotToken")||localStorage.getItem("token"),userType:"depot_manager"}});return e.on("tripUpdated",e=>{console.log("Trip updated in TripManagement:",e),A(s=>s.map(s=>s._id===e.tripId?(0,i.A)((0,i.A)({},s),e.updates):s))}),e.on("tripAssigned",e=>{console.log("New trip assigned in TripManagement:",e),A(s=>[e.trip,...s])}),()=>{e.close()}},[]);const P=async()=>{try{C(!0);const e=await t.Tt.getTrips();console.log("Trip Management - API response:",e);let s=[];if(e.success&&e.data?s=Array.isArray(e.data)?e.data:e.data.trips||[]:Array.isArray(e)?s=e:e.trips&&(s=e.trips),console.log("Trip Management - Parsed trips:",s),0===s.length){A([{_id:"trip1",tripNumber:"TR-001",routeId:{routeName:"Kochi to Thiruvananthapuram",routeNumber:"KL-001"},busId:{busNumber:"KL-76-AB-5114",registrationNumber:"KL76AB9955"},driverId:{name:"Rajesh Kumar"},conductorId:{name:"Suresh Nair"},serviceDate:"2024-01-15",startTime:"06:00",endTime:"10:30",status:"scheduled",fare:450},{_id:"trip2",tripNumber:"TR-002",routeId:{routeName:"Kochi to Kozhikode",routeNumber:"KL-002"},busId:{busNumber:"KL-76-AB-5115",registrationNumber:"KL76AB9956"},driverId:{name:"Manoj Pillai"},conductorId:{name:"Anil Kumar"},serviceDate:"2024-01-15",startTime:"08:00",endTime:"11:45",status:"running",fare:380},{_id:"trip3",tripNumber:"TR-003",routeId:{routeName:"Thiruvananthapuram to Kozhikode",routeNumber:"KL-003"},busId:{busNumber:"KL-76-AB-5116",registrationNumber:"KL76AB9957"},driverId:{name:"Vijay Menon"},conductorId:{name:"Ravi Nair"},serviceDate:"2024-01-15",startTime:"14:00",endTime:"20:15",status:"completed",fare:650}])}else A(s)}catch(e){console.error("Error fetching trips in TripManagement:",e);A([{_id:"trip1",tripNumber:"TR-001",routeId:{routeName:"Kochi to Thiruvananthapuram",routeNumber:"KL-001"},busId:{busNumber:"KL-76-AB-5114",registrationNumber:"KL76AB9955"},driverId:{name:"Rajesh Kumar"},conductorId:{name:"Suresh Nair"},serviceDate:"2024-01-15",startTime:"06:00",endTime:"10:30",status:"scheduled",fare:450}])}finally{C(!1)}},M=(e,s)=>{const a=g.map(a=>a._id===e._id?(0,i.A)((0,i.A)({},a),{},{status:s}):a);A(a)},O=g.filter(e=>{var s,a,i,r,t,l,n;const d=(null===(s=e.tripNumber)||void 0===s?void 0:s.toLowerCase().includes(D.toLowerCase()))||(null===(a=e.routeId)||void 0===a||null===(i=a.routeName)||void 0===i?void 0:i.toLowerCase().includes(D.toLowerCase()))||(null===(r=e.busId)||void 0===r||null===(t=r.busNumber)||void 0===t?void 0:t.toLowerCase().includes(D.toLowerCase()))||(null===(l=e.driverId)||void 0===l||null===(n=l.name)||void 0===n?void 0:n.toLowerCase().includes(D.toLowerCase())),c="all"===R||e.status===R;return d&&c});return T?(0,N.jsx)("div",{className:"trip-management",children:(0,N.jsxs)("div",{className:"page-header",children:[(0,N.jsx)("h1",{children:"Trip Management"}),(0,N.jsx)("p",{children:"Loading trips..."})]})}):(0,N.jsxs)("div",{className:"trip-management",children:[(0,N.jsx)("div",{className:"page-header",children:(0,N.jsxs)("div",{className:"header-content",children:[(0,N.jsxs)("div",{className:"header-text",children:[(0,N.jsx)("h1",{children:"Trip Management"}),(0,N.jsx)("p",{children:"Manage scheduled trips, trip status, and trip operations"})]}),(0,N.jsxs)("button",{className:"add-trip-btn",onClick:()=>I(!0),children:[(0,N.jsx)(x.A,{size:20}),"Schedule New Trip"]})]})}),(0,N.jsxs)("div",{className:"stats-grid",children:[(0,N.jsxs)("div",{className:"stat-card",children:[(0,N.jsx)("div",{className:"stat-icon blue",children:(0,N.jsx)(o.A,{size:24})}),(0,N.jsxs)("div",{className:"stat-content",children:[(0,N.jsx)("h3",{children:"Total Trips"}),(0,N.jsx)("div",{className:"stat-value",children:g.length})]})]}),(0,N.jsxs)("div",{className:"stat-card",children:[(0,N.jsx)("div",{className:"stat-icon green",children:(0,N.jsx)(m.A,{size:24})}),(0,N.jsxs)("div",{className:"stat-content",children:[(0,N.jsx)("h3",{children:"Running Trips"}),(0,N.jsx)("div",{className:"stat-value",children:g.filter(e=>"running"===e.status).length})]})]}),(0,N.jsxs)("div",{className:"stat-card",children:[(0,N.jsx)("div",{className:"stat-icon yellow",children:(0,N.jsx)(u.A,{size:24})}),(0,N.jsxs)("div",{className:"stat-content",children:[(0,N.jsx)("h3",{children:"Scheduled Trips"}),(0,N.jsx)("div",{className:"stat-value",children:g.filter(e=>"scheduled"===e.status).length})]})]})]}),(0,N.jsx)("div",{className:"search-filter-bar",children:(0,N.jsxs)("div",{className:"search-row",children:[(0,N.jsxs)("div",{className:"search-input-container",children:[(0,N.jsx)(j.A,{size:20,className:"search-icon"}),(0,N.jsx)("input",{type:"text",placeholder:"Search trips, routes, buses, drivers...",value:D,onChange:e=>L(e.target.value),className:"search-input"})]}),(0,N.jsxs)("select",{value:R,onChange:e=>z(e.target.value),className:"filter-select",children:[(0,N.jsx)("option",{value:"all",children:"All Status"}),(0,N.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,N.jsx)("option",{value:"running",children:"Running"}),(0,N.jsx)("option",{value:"completed",children:"Completed"}),(0,N.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})}),(0,N.jsxs)("div",{className:"trips-table-container",children:[(0,N.jsx)("div",{className:"table-header",children:(0,N.jsxs)("h3",{children:["Trips (",O.length,")"]})}),(0,N.jsx)("div",{className:"table-wrapper",children:(0,N.jsxs)("table",{className:"trips-table",children:[(0,N.jsx)("thead",{children:(0,N.jsxs)("tr",{children:[(0,N.jsx)("th",{children:"Trip Number"}),(0,N.jsx)("th",{children:"Route"}),(0,N.jsx)("th",{children:"Bus"}),(0,N.jsx)("th",{children:"Driver"}),(0,N.jsx)("th",{children:"Conductor"}),(0,N.jsx)("th",{children:"Date"}),(0,N.jsx)("th",{children:"Time"}),(0,N.jsx)("th",{children:"Status"}),(0,N.jsx)("th",{children:"Actions"})]})}),(0,N.jsx)("tbody",{children:O.length>0?O.map((e,s)=>{var a,i,r,t,l,n,x;return(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:(0,N.jsx)("div",{className:"trip-id",children:(0,N.jsx)("span",{className:"id",children:e.tripNumber})})}),(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"trip-route",children:[(0,N.jsx)("span",{className:"name",children:null===(a=e.routeId)||void 0===a?void 0:a.routeName}),(0,N.jsx)("span",{className:"route-number",children:null===(i=e.routeId)||void 0===i?void 0:i.routeNumber})]})}),(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"trip-bus",children:[(0,N.jsx)(c.A,{size:16}),(0,N.jsx)("span",{children:null===(r=e.busId)||void 0===r?void 0:r.busNumber})]})}),(0,N.jsx)("td",{children:(0,N.jsx)("div",{className:"trip-driver",children:(0,N.jsx)("span",{children:null===(t=e.driverId)||void 0===t?void 0:t.name})})}),(0,N.jsx)("td",{children:(0,N.jsx)("div",{className:"trip-conductor",children:(0,N.jsx)("span",{children:null===(l=e.conductorId)||void 0===l?void 0:l.name})})}),(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"trip-date",children:[(0,N.jsx)(o.A,{size:16}),(0,N.jsx)("span",{children:new Date(e.serviceDate).toLocaleDateString()})]})}),(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"trip-time",children:[(0,N.jsx)(u.A,{size:16}),(0,N.jsxs)("span",{children:[e.startTime," - ",e.endTime]})]})}),(0,N.jsx)("td",{children:(0,N.jsx)("span",{className:"status-badge ".concat(e.status||"unknown"),children:(null===(n=e.status)||void 0===n?void 0:n.charAt(0).toUpperCase())+(null===(x=e.status)||void 0===x?void 0:x.slice(1))})}),(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"action-buttons",children:[(0,N.jsxs)("button",{className:"action-btn view",onClick:()=>{w(e)},children:[(0,N.jsx)(h.A,{size:16}),"View"]}),(0,N.jsxs)("button",{className:"action-btn edit",onClick:()=>{w(e),y(!0)},children:[(0,N.jsx)(d.A,{size:16}),"Edit"]}),"scheduled"===e.status&&(0,N.jsxs)("button",{className:"action-btn start",onClick:()=>M(e,"running"),children:[(0,N.jsx)(m.A,{size:16}),"Start"]}),"running"===e.status&&(0,N.jsxs)("button",{className:"action-btn complete",onClick:()=>M(e,"completed"),children:[(0,N.jsx)(v.A,{size:16}),"Complete"]})]})})]},e._id||s)}):(0,N.jsx)("tr",{children:(0,N.jsx)("td",{colSpan:"9",className:"no-data",children:(0,N.jsxs)("div",{className:"empty-state",children:[(0,N.jsx)(o.A,{size:48}),(0,N.jsx)("h3",{children:"No trips found"}),(0,N.jsx)("p",{children:"No trips match your search criteria"})]})})})})]})})]}),S&&(0,N.jsx)("div",{className:"modal-overlay",onClick:()=>I(!1),children:(0,N.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsx)("h2",{children:"Schedule New Trip"}),(0,N.jsx)("button",{className:"modal-close",onClick:()=>I(!1),children:(0,N.jsx)(p.A,{size:20})})]}),(0,N.jsxs)("div",{className:"modal-body",children:[(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Route"}),(0,N.jsxs)("select",{value:E.routeId,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{routeId:e.target.value})),children:[(0,N.jsx)("option",{value:"",children:"Select Route"}),(0,N.jsx)("option",{value:"route1",children:"Kochi to Thiruvananthapuram"}),(0,N.jsx)("option",{value:"route2",children:"Kochi to Kozhikode"})]})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Bus"}),(0,N.jsxs)("select",{value:E.busId,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{busId:e.target.value})),children:[(0,N.jsx)("option",{value:"",children:"Select Bus"}),(0,N.jsx)("option",{value:"bus1",children:"KL-76-AB-5114"}),(0,N.jsx)("option",{value:"bus2",children:"KL-76-AB-5115"})]})]}),(0,N.jsxs)("div",{className:"form-row",children:[(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Driver"}),(0,N.jsxs)("select",{value:E.driverId,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{driverId:e.target.value})),children:[(0,N.jsx)("option",{value:"",children:"Select Driver"}),(0,N.jsx)("option",{value:"driver1",children:"Rajesh Kumar"}),(0,N.jsx)("option",{value:"driver2",children:"Manoj Pillai"})]})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Conductor"}),(0,N.jsxs)("select",{value:E.conductorId,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{conductorId:e.target.value})),children:[(0,N.jsx)("option",{value:"",children:"Select Conductor"}),(0,N.jsx)("option",{value:"conductor1",children:"Suresh Nair"}),(0,N.jsx)("option",{value:"conductor2",children:"Anil Kumar"})]})]})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Service Date"}),(0,N.jsx)("input",{type:"date",value:E.serviceDate,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{serviceDate:e.target.value}))})]}),(0,N.jsxs)("div",{className:"form-row",children:[(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Start Time"}),(0,N.jsx)("input",{type:"time",value:E.startTime,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{startTime:e.target.value}))})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"End Time"}),(0,N.jsx)("input",{type:"time",value:E.endTime,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{endTime:e.target.value}))})]})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Status"}),(0,N.jsxs)("select",{value:E.status,onChange:e=>B((0,i.A)((0,i.A)({},E),{},{status:e.target.value})),children:[(0,N.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,N.jsx)("option",{value:"running",children:"Running"}),(0,N.jsx)("option",{value:"completed",children:"Completed"})]})]})]}),(0,N.jsxs)("div",{className:"modal-actions",children:[(0,N.jsx)("button",{className:"btn btn-secondary",onClick:()=>I(!1),children:"Cancel"}),(0,N.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{const e=(0,i.A)((0,i.A)({},E),{},{_id:"trip_".concat(Date.now()),tripNumber:"TR-".concat(String(g.length+1).padStart(3,"0")),fare:450});A([...g,e]),I(!1),B({routeId:"",busId:"",driverId:"",conductorId:"",serviceDate:"",startTime:"",endTime:"",status:"scheduled"})}catch(e){console.error("Error adding trip:",e)}},children:"Schedule Trip"})]})]})}),f&&_&&(0,N.jsx)("div",{className:"modal-overlay",onClick:()=>y(!1),children:(0,N.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsx)("h2",{children:"Edit Trip"}),(0,N.jsx)("button",{className:"modal-close",onClick:()=>y(!1),children:(0,N.jsx)(p.A,{size:20})})]}),(0,N.jsxs)("div",{className:"modal-body",children:[(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Trip Number"}),(0,N.jsx)("input",{type:"text",value:_.tripNumber,onChange:e=>w((0,i.A)((0,i.A)({},_),{},{tripNumber:e.target.value})),disabled:!0})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Route"}),(0,N.jsx)("input",{type:"text",value:null===(e=_.routeId)||void 0===e?void 0:e.routeName,disabled:!0})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Bus"}),(0,N.jsx)("input",{type:"text",value:null===(s=_.busId)||void 0===s?void 0:s.busNumber,disabled:!0})]}),(0,N.jsxs)("div",{className:"form-row",children:[(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Driver"}),(0,N.jsx)("input",{type:"text",value:null===(a=_.driverId)||void 0===a?void 0:a.name,disabled:!0})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Conductor"}),(0,N.jsx)("input",{type:"text",value:null===(b=_.conductorId)||void 0===b?void 0:b.name,disabled:!0})]})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Service Date"}),(0,N.jsx)("input",{type:"date",value:_.serviceDate,onChange:e=>w((0,i.A)((0,i.A)({},_),{},{serviceDate:e.target.value}))})]}),(0,N.jsxs)("div",{className:"form-row",children:[(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Start Time"}),(0,N.jsx)("input",{type:"time",value:_.startTime,onChange:e=>w((0,i.A)((0,i.A)({},_),{},{startTime:e.target.value}))})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"End Time"}),(0,N.jsx)("input",{type:"time",value:_.endTime,onChange:e=>w((0,i.A)((0,i.A)({},_),{},{endTime:e.target.value}))})]})]}),(0,N.jsxs)("div",{className:"form-group",children:[(0,N.jsx)("label",{children:"Status"}),(0,N.jsxs)("select",{value:_.status,onChange:e=>w((0,i.A)((0,i.A)({},_),{},{status:e.target.value})),children:[(0,N.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,N.jsx)("option",{value:"running",children:"Running"}),(0,N.jsx)("option",{value:"completed",children:"Completed"}),(0,N.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})]}),(0,N.jsxs)("div",{className:"modal-actions",children:[(0,N.jsx)("button",{className:"btn btn-secondary",onClick:()=>y(!1),children:"Cancel"}),(0,N.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{const e=g.map(e=>e._id===_._id?(0,i.A)((0,i.A)({},e),_):e);A(e),y(!1),w(null)}catch(e){console.error("Error editing trip:",e)}},children:"Save Changes"})]})]})}),k&&_&&(0,N.jsx)("div",{className:"modal-overlay",onClick:()=>K(!1),children:(0,N.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsx)("h2",{children:"Delete Trip"}),(0,N.jsx)("button",{className:"modal-close",onClick:()=>K(!1),children:(0,N.jsx)(p.A,{size:20})})]}),(0,N.jsx)("div",{className:"modal-body",children:(0,N.jsxs)("div",{className:"delete-confirmation",children:[(0,N.jsx)(n.A,{size:48,className:"warning-icon"}),(0,N.jsx)("h3",{children:"Are you sure?"}),(0,N.jsxs)("p",{children:["You are about to delete the trip ",(0,N.jsx)("strong",{children:_.tripNumber}),". This action cannot be undone."]})]})}),(0,N.jsxs)("div",{className:"modal-actions",children:[(0,N.jsx)("button",{className:"btn btn-secondary",onClick:()=>K(!1),children:"Cancel"}),(0,N.jsx)("button",{className:"btn btn-danger",onClick:async()=>{try{const e=g.filter(e=>e._id!==_._id);A(e),K(!1),w(null)}catch(e){console.error("Error deleting trip:",e)}},children:"Delete Trip"})]})]})})]})}}}]);
//# sourceMappingURL=21.4057af20.chunk.js.map