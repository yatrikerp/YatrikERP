"use strict";(self.webpackChunkyatrik_erp_frontend=self.webpackChunkyatrik_erp_frontend||[]).push([[7],{7:(e,a,s)=>{s.r(a),s.d(a,{default:()=>i});var l=s(9379),t=s(5043),r=s(8729),n=s(579);const i=()=>{const{user:e}=(0,r.A)(),[a,s]=(0,t.useState)([]),[,i]=(0,t.useState)([]),[,o]=(0,t.useState)([]),[c,d]=(0,t.useState)(!0),[u,m]=(0,t.useState)(!1),[v,h]=(0,t.useState)(!1),[x,p]=(0,t.useState)(!1),[j,g]=(0,t.useState)(null),[f,y]=(0,t.useState)(""),[N,b]=(0,t.useState)("all"),[C,A]=(0,t.useState)("all"),[S,w]=(0,t.useState)("drivers"),[D,I]=(0,t.useState)({totalDrivers:0,activeDrivers:0,totalConductors:0,activeConductors:0}),[L,E]=(0,t.useState)({name:"",email:"",phone:"",role:"driver",employeeId:"",licenseNumber:"",licenseExpiry:"",address:"",emergencyContact:"",joiningDate:"",salary:0,status:"active",notes:""}),z=[{value:"driver",label:"Driver"},{value:"conductor",label:"Conductor"}],M=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"suspended",label:"Suspended"},{value:"on_leave",label:"On Leave"}];(0,t.useEffect)(()=>{k()},[]);const k=async()=>{try{var a,t;d(!0);const c=JSON.parse(localStorage.getItem("user")||"{}").role;console.log("User role:",c);const u="/api/driver/all",m="/api/conductor/all";console.log("Using endpoints:",{driverEndpoint:u,conductorEndpoint:m});const[v,h]=await Promise.all([fetch(u,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch(m,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})]);v.ok||console.error("Driver fetch failed:",v.status,await v.text()),h.ok||console.error("Conductor fetch failed:",h.status,await h.text());const x=v.ok?await v.json():{data:[]},p=h.ok?await h.json():{data:[]},j=Array.isArray(x.data)?x.data:(null===(a=x.data)||void 0===a?void 0:a.drivers)||[],g=Array.isArray(p.data)?p.data:(null===(t=p.data)||void 0===t?void 0:t.conductors)||[],f=j.map(e=>{var a,s;return(0,l.A)((0,l.A)({},e),{},{role:"driver",employeeId:e.employeeCode||e.employeeId||e.driverId||"",licenseNumber:(null===(a=e.drivingLicense)||void 0===a?void 0:a.licenseNumber)||e.licenseNumber||"",licenseExpiry:(null===(s=e.drivingLicense)||void 0===s?void 0:s.expiryDate)||e.licenseExpiry||"",joiningDate:e.joiningDate||e.createdAt})}),y=g.map(e=>(0,l.A)((0,l.A)({},e),{},{role:"conductor",employeeId:e.employeeCode||e.employeeId||e.conductorId||"",licenseNumber:e.licenseNumber||"",licenseExpiry:e.licenseExpiry||"",joiningDate:e.joiningDate||e.createdAt}));i(f),o(y);const N=new Date,b=N.getFullYear(),C=String(N.getMonth()+1).padStart(2,"0"),A=String(N.getDate()).padStart(2,"0"),S="".concat(b,"-").concat(C,"-").concat(A);let w=0,D=0;try{const a=new URLSearchParams({date:S}),s=JSON.parse(localStorage.getItem("user")||"{}").depotId||(null===e||void 0===e?void 0:e.depotId);s&&a.append("depotId",s);const l=await fetch("/api/depot/trips?".concat(a.toString()),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(l.ok){var r;const e=await l.json(),a=Array.isArray(null===(r=e.data)||void 0===r?void 0:r.trips)?e.data.trips:Array.isArray(e.data)?e.data:[],s=new Set(["scheduled","running","in-progress","on-break","assigned","started"]),t=new Set(a.filter(e=>s.has(e.status)).map(e=>{const a=e.driverId;return a?"string"===typeof a?a:"object"===typeof a&&(a._id||a.id)||null:null}).filter(Boolean));w=t.size;const n=new Set(a.filter(e=>s.has(e.status)).map(e=>{const a=e.conductorId;return a?"string"===typeof a?a:"object"===typeof a&&(a._id||a.id)||null:null}).filter(Boolean));D=n.size}}catch(n){console.warn("Failed to fetch duties for active drivers calc:",n)}I(e=>(0,l.A)((0,l.A)({},e),{},{totalDrivers:j.length,activeDrivers:w,totalConductors:g.length,activeConductors:D})),s([...f,...y])}catch(c){console.error("Error fetching staff:",c)}finally{d(!1)}},R=()=>{E({name:"",email:"",phone:"",role:"driver",employeeId:"",licenseNumber:"",licenseExpiry:"",address:"",emergencyContact:"",joiningDate:"",salary:0,status:"active",notes:""})},B=a.filter(e=>{var a,s,l,t;const r=(null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes(f.toLowerCase()))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(f.toLowerCase()))||(null===(l=e.employeeId)||void 0===l?void 0:l.toLowerCase().includes(f.toLowerCase()))||(null===(t=e.licenseNumber)||void 0===t?void 0:t.toLowerCase().includes(f.toLowerCase())),n="all"===N||e.status===N,i="all"===C||e.role===C;return r&&n&&i}),O=e=>{switch(e){case"active":return"green";case"inactive":return"red";case"suspended":return"orange";case"on_leave":return"blue";default:return"gray"}},_=e=>{var a;return(null===(a=M.find(a=>a.value===e))||void 0===a?void 0:a.label)||e},T=e=>{var a;return(null===(a=z.find(a=>a.value===e))||void 0===a?void 0:a.label)||e},F=e=>new Date(e).toLocaleDateString("en-IN");return c?(0,n.jsxs)("div",{className:"staff-loading",children:[(0,n.jsx)("div",{className:"loading-spinner"}),(0,n.jsx)("h3",{children:"Loading Staff Management..."})]}):(0,n.jsxs)("div",{className:"staff-management",children:[(0,n.jsxs)("div",{className:"staff-header",children:[(0,n.jsxs)("div",{className:"header-left",children:[(0,n.jsx)("h1",{children:"Staff Management"}),(0,n.jsx)("p",{children:"Manage drivers, conductors, and depot personnel"})]}),(0,n.jsx)("div",{className:"header-right",children:(0,n.jsxs)("button",{className:"add-staff-btn",onClick:()=>m(!0),children:[(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Add Staff"]})})]}),(0,n.jsxs)("div",{className:"staff-stats",children:[(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-icon blue",children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})}),(0,n.jsxs)("div",{className:"stat-content",children:[(0,n.jsx)("h3",{children:D.totalDrivers}),(0,n.jsx)("p",{children:"Total Drivers"})]})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-icon green",children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"stat-content",children:[(0,n.jsx)("h3",{children:D.activeDrivers}),(0,n.jsx)("p",{children:"Active Drivers"})]})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-icon orange",children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})}),(0,n.jsxs)("div",{className:"stat-content",children:[(0,n.jsx)("h3",{children:D.totalConductors}),(0,n.jsx)("p",{children:"Total Conductors"})]})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-icon purple",children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"stat-content",children:[(0,n.jsx)("h3",{children:D.activeConductors}),(0,n.jsx)("p",{children:"Active Conductors"})]})]})]}),(0,n.jsxs)("div",{className:"staff-tabs",children:[(0,n.jsx)("button",{className:"tab-btn ".concat("all"===S?"active":""),onClick:()=>w("all"),children:"All Staff"}),(0,n.jsx)("button",{className:"tab-btn ".concat("drivers"===S?"active":""),onClick:()=>w("drivers"),children:"Drivers"}),(0,n.jsx)("button",{className:"tab-btn ".concat("conductors"===S?"active":""),onClick:()=>w("conductors"),children:"Conductors"})]}),(0,n.jsxs)("div",{className:"staff-controls",children:[(0,n.jsx)("div",{className:"search-section",children:(0,n.jsxs)("div",{className:"search-input-wrapper",children:[(0,n.jsx)("svg",{className:"search-icon",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414L10.89 9.89A6 6 0 012 8z",clipRule:"evenodd"})}),(0,n.jsx)("input",{type:"text",placeholder:"Search staff by name, email, or ID...",value:f,onChange:e=>y(e.target.value),className:"search-input"})]})}),(0,n.jsxs)("div",{className:"filter-section",children:[(0,n.jsxs)("select",{value:N,onChange:e=>b(e.target.value),className:"filter-select",children:[(0,n.jsx)("option",{value:"all",children:"All Status"}),M.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,n.jsxs)("select",{value:C,onChange:e=>A(e.target.value),className:"filter-select",children:[(0,n.jsx)("option",{value:"all",children:"All Roles"}),z.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))]})]})]}),(0,n.jsxs)("div",{className:"staff-table-container",children:[(0,n.jsxs)("table",{className:"staff-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Staff Member"}),(0,n.jsx)("th",{children:"Role"}),(0,n.jsx)("th",{children:"Contact"}),(0,n.jsx)("th",{children:"License/ID"}),(0,n.jsx)("th",{children:"Joining Date"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:B.map(e=>{var a;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"staff-info",children:[(0,n.jsx)("div",{className:"staff-avatar",children:(null===(a=e.name)||void 0===a?void 0:a.charAt(0))||"S"}),(0,n.jsxs)("div",{className:"staff-details",children:[(0,n.jsx)("div",{className:"staff-name",children:e.name}),(0,n.jsxs)("div",{className:"staff-id",children:["ID: ",e.employeeId]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"role-badge ".concat(e.role),children:T(e.role)})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"contact-info",children:[(0,n.jsx)("div",{className:"contact-email",children:e.email}),(0,n.jsx)("div",{className:"contact-phone",children:e.phone})]})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"license-info",children:[(0,n.jsxs)("div",{className:"license-number",children:["driver"===e.role?"License: ":"ID: ",e.licenseNumber||e.employeeId]}),e.licenseExpiry&&(0,n.jsxs)("div",{className:"license-expiry",children:["Expires: ",F(e.licenseExpiry)]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"joining-info",children:e.joiningDate?F(e.joiningDate):"N/A"})}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"status-badge ".concat(O(e.status)),children:_(e.status)})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"action-buttons",children:"admin"===JSON.parse(localStorage.getItem("user")||"{}").role&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"action-btn view",onClick:()=>(e=>{g(e),E({name:e.name||"",email:e.email||"",phone:e.phone||"",role:e.role||"driver",employeeId:e.employeeId||"",licenseNumber:e.licenseNumber||"",licenseExpiry:e.licenseExpiry?new Date(e.licenseExpiry).toISOString().slice(0,10):"",address:e.address||"",emergencyContact:e.emergencyContact||"",joiningDate:e.joiningDate?new Date(e.joiningDate).toISOString().slice(0,10):"",salary:e.salary||0,status:e.status||"active",notes:e.notes||""}),h(!0)})(e),title:"View/Edit",children:(0,n.jsxs)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:[(0,n.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})}),(0,n.jsx)("button",{className:"action-btn delete",onClick:()=>(e=>{g(e),p(!0)})(e),title:"Delete",children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})})]},e._id)})})]}),0===B.length&&(0,n.jsxs)("div",{className:"no-staff",children:[(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}),(0,n.jsx)("h3",{children:"No staff members found"}),(0,n.jsx)("p",{children:"Try adjusting your search or filters"})]})]}),u&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h2",{children:"Add New Staff Member"}),(0,n.jsx)("button",{className:"modal-close",onClick:()=>{m(!1),R()},children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,n.jsxs)("form",{onSubmit:async a=>{a.preventDefault();try{const a="driver"===L.role?"/api/driver":"/api/conductor",t=JSON.parse(localStorage.getItem("user")||"{}").depotId||(null===e||void 0===e?void 0:e.depotId),r=(L.email||L.phone||"".concat(L.name)).toLowerCase().replace(/[^a-z0-9_]/g,"_").slice(0,20),n=L.password&&L.password.length>=8?L.password:"TempPass@123",i=e=>{if(!e||"string"!==typeof e)return;const a=e.match(/([6-9]\d{9})/),s=a?a[1]:"",l=e.replace(/([6-9]\d{9})/g,"").replace(/[,-]/g," ").replace(/\s+/g," ").trim()||"";return l.length>=2&&/^[6-9]\d{9}$/.test(s)?{name:l,phone:s,relationship:""}:void 0},o=(0,l.A)((0,l.A)({name:L.name,phone:String(L.phone||"").replace(/\D/g,""),email:L.email,employeeCode:L.employeeId||L.employeeCode||void 0,username:L.username||r,password:n,depotId:t,address:L.address},"object"===typeof L.emergencyContact&&L.emergencyContact?{emergencyContact:L.emergencyContact}:(()=>{const e=i(L.emergencyContact);return e?{emergencyContact:e}:{}})()),{},{salary:"object"===typeof L.salary?L.salary:{basic:Number(L.salary)||0,allowances:0,bonus:0},status:L.status||"active",notes:L.notes||""}),c="driver"===L.role?(0,l.A)((0,l.A)({},o),{},{drivingLicense:{licenseNumber:L.licenseNumber||"TEMP000000",type:L.licenseType||"LMV",issueDate:L.licenseIssueDate||(new Date).toISOString().slice(0,10),expiryDate:L.licenseExpiry||new Date(Date.now()+31536e6).toISOString().slice(0,10),issuingAuthority:L.issuingAuthority||"RTO"}}):o,d=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(c)});if(d.ok)m(!1),R(),k();else{let e;try{e=await d.json()}catch(s){e={}}const a=Array.isArray(e.errors)?e.errors.map(e=>"".concat(e.path||e.param||"field",": ").concat(e.msg)).join("\n"):"";alert(e.message+(a?"\n".concat(a):"")||"Failed to add staff member")}}catch(t){console.error("Error adding staff:",t),alert("Failed to add staff member")}},className:"staff-form",children:[(0,n.jsxs)("div",{className:"form-grid",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Full Name *"}),(0,n.jsx)("input",{type:"text",value:L.name,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{name:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Email *"}),(0,n.jsx)("input",{type:"email",value:L.email,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{email:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Phone *"}),(0,n.jsx)("input",{type:"tel",value:L.phone,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{phone:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Role *"}),(0,n.jsx)("select",{value:L.role,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{role:e.target.value})),required:!0,children:z.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Employee ID *"}),(0,n.jsx)("input",{type:"text",value:L.employeeId,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{employeeId:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{children:["driver"===L.role?"License Number":"ID Number"," *"]}),(0,n.jsx)("input",{type:"text",value:L.licenseNumber,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{licenseNumber:e.target.value})),required:!0})]}),"driver"===L.role&&(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"License Expiry Date"}),(0,n.jsx)("input",{type:"date",value:L.licenseExpiry,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{licenseExpiry:e.target.value}))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Joining Date"}),(0,n.jsx)("input",{type:"date",value:L.joiningDate,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{joiningDate:e.target.value}))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Salary (\u20b9)"}),(0,n.jsx)("input",{type:"number",value:L.salary,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{salary:parseFloat(e.target.value)})),min:"0",step:"0.01"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Status"}),(0,n.jsx)("select",{value:L.status,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{status:e.target.value})),children:M.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Address"}),(0,n.jsx)("textarea",{value:L.address,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{address:e.target.value})),rows:"3"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Emergency Contact"}),(0,n.jsx)("input",{type:"tel",value:L.emergencyContact,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{emergencyContact:e.target.value}))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Notes"}),(0,n.jsx)("textarea",{value:L.notes,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{notes:e.target.value})),rows:"3"})]}),(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{m(!1),R()},children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"btn-primary",children:"Add Staff Member"})]})]})]})}),v&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsxs)("h2",{children:["Edit Staff Member - ",null===j||void 0===j?void 0:j.name]}),(0,n.jsx)("button",{className:"modal-close",onClick:()=>{h(!1),R()},children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{if("admin"!==JSON.parse(localStorage.getItem("user")||"{}").role)return void alert("Only administrators can edit staff members");const e="driver"===j.role?"/api/driver/".concat(j._id):"/api/conductor/".concat(j._id),a=await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(L)});if(a.ok)h(!1),R(),k();else{const e=await a.json();alert(e.message||"Failed to update staff member")}}catch(a){console.error("Error updating staff:",a),alert("Failed to update staff member")}},className:"staff-form",children:[(0,n.jsxs)("div",{className:"form-grid",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Full Name *"}),(0,n.jsx)("input",{type:"text",value:L.name,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{name:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Email *"}),(0,n.jsx)("input",{type:"email",value:L.email,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{email:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Phone *"}),(0,n.jsx)("input",{type:"tel",value:L.phone,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{phone:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Role *"}),(0,n.jsx)("select",{value:L.role,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{role:e.target.value})),required:!0,children:z.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Employee ID *"}),(0,n.jsx)("input",{type:"text",value:L.employeeId,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{employeeId:e.target.value})),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{children:["driver"===L.role?"License Number":"ID Number"," *"]}),(0,n.jsx)("input",{type:"text",value:L.licenseNumber,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{licenseNumber:e.target.value})),required:!0})]}),"driver"===L.role&&(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"License Expiry Date"}),(0,n.jsx)("input",{type:"date",value:L.licenseExpiry,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{licenseExpiry:e.target.value}))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Joining Date"}),(0,n.jsx)("input",{type:"date",value:L.joiningDate,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{joiningDate:e.target.value}))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Salary (\u20b9)"}),(0,n.jsx)("input",{type:"number",value:L.salary,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{salary:parseFloat(e.target.value)})),min:"0",step:"0.01"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Status"}),(0,n.jsx)("select",{value:L.status,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{status:e.target.value})),children:M.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Address"}),(0,n.jsx)("textarea",{value:L.address,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{address:e.target.value})),rows:"3"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Emergency Contact"}),(0,n.jsx)("input",{type:"tel",value:L.emergencyContact,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{emergencyContact:e.target.value}))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Notes"}),(0,n.jsx)("textarea",{value:L.notes,onChange:e=>E((0,l.A)((0,l.A)({},L),{},{notes:e.target.value})),rows:"3"})]}),(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{h(!1),R()},children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"btn-primary",children:"Update Staff Member"})]})]})]})}),x&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal-content delete-modal",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h2",{children:"Delete Staff Member"}),(0,n.jsx)("button",{className:"modal-close",onClick:()=>p(!1),children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,n.jsxs)("div",{className:"delete-content",children:[(0,n.jsx)("div",{className:"delete-icon",children:(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,n.jsx)("h3",{children:"Are you sure you want to delete this staff member?"}),(0,n.jsxs)("p",{children:['This action cannot be undone. The staff member "',null===j||void 0===j?void 0:j.name,'" will be permanently removed.']}),(0,n.jsxs)("div",{className:"staff-details",children:[(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"label",children:"Name:"}),(0,n.jsx)("span",{className:"value",children:null===j||void 0===j?void 0:j.name})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"label",children:"Role:"}),(0,n.jsx)("span",{className:"value",children:T(null===j||void 0===j?void 0:j.role)})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"label",children:"Employee ID:"}),(0,n.jsx)("span",{className:"value",children:null===j||void 0===j?void 0:j.employeeId})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"label",children:"Status:"}),(0,n.jsx)("span",{className:"value",children:_(null===j||void 0===j?void 0:j.status)})]})]})]}),(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>p(!1),children:"Cancel"}),(0,n.jsx)("button",{type:"button",className:"btn-danger",onClick:async()=>{try{if("admin"!==JSON.parse(localStorage.getItem("user")||"{}").role)return void alert("Only administrators can delete staff members");const e="driver"===j.role?"/api/driver/".concat(j._id):"/api/conductor/".concat(j._id),a=await fetch(e,{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(a.ok)p(!1),g(null),k();else{const e=await a.json();alert(e.message||"Failed to delete staff member")}}catch(e){console.error("Error deleting staff:",e),alert("Failed to delete staff member")}},children:"Delete Staff Member"})]})]})})]})}}}]);
//# sourceMappingURL=7.d495d579.chunk.js.map