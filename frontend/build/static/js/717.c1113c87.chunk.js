"use strict";(self.webpackChunkyatrik_erp_frontend=self.webpackChunkyatrik_erp_frontend||[]).push([[717],{3923:()=>{},4717:(e,s,a)=>{a.r(s),a.d(s,{default:()=>N});var n=a(9379),i=a(5043),t=(a(8729),a(3540)),l=(a(3923),a(7819)),o=a(2054),r=a(6533),d=a(8646),c=a(5087),h=a(8006),u=a(1360),m=a(9292),x=a(5244),j=a(9855),g=a(4459),p=a(614),v=a(579);const N=()=>{var e,s,a;const[N,b]=(0,i.useState)([]),[k,A]=(0,i.useState)(!0),[C,f]=(0,i.useState)(!1),[y,S]=(0,i.useState)(!1),[P,w]=(0,i.useState)(!1),[B,z]=(0,i.useState)(null),[I,_]=(0,i.useState)(""),[T,D]=(0,i.useState)("all");(0,i.useEffect)(()=>{K()},[]);const K=async()=>{try{A(!0);const e=await t.hl.getBookings();console.log("Booking Management - API response:",e);let s=[];if(e.success&&e.data?s=Array.isArray(e.data)?e.data:e.data.bookings||[]:Array.isArray(e)?s=e:e.bookings&&(s=e.bookings),console.log("Booking Management - Parsed bookings:",s),0===s.length){b([{_id:"booking1",bookingNumber:"BK-001",passengerName:"John Doe",passengerPhone:"+91 9876543210",tripId:{routeId:{routeName:"Kochi to Thiruvananthapuram"}},seats:["A1","A2"],fareAmount:900,status:"confirmed",createdAt:"2024-01-15T10:30:00Z",paymentStatus:"paid"},{_id:"booking2",bookingNumber:"BK-002",passengerName:"Jane Smith",passengerPhone:"+91 9876543211",tripId:{routeId:{routeName:"Kochi to Kozhikode"}},seats:["B1"],fareAmount:380,status:"pending",createdAt:"2024-01-15T11:15:00Z",paymentStatus:"pending"},{_id:"booking3",bookingNumber:"BK-003",passengerName:"Mike Johnson",passengerPhone:"+91 9876543212",tripId:{routeId:{routeName:"Thiruvananthapuram to Kozhikode"}},seats:["C1","C2","C3"],fareAmount:1950,status:"confirmed",createdAt:"2024-01-15T12:00:00Z",paymentStatus:"paid"}])}else b(s)}catch(e){console.error("Error fetching bookings in BookingManagement:",e);b([{_id:"booking1",bookingNumber:"BK-001",passengerName:"John Doe",passengerPhone:"+91 9876543210",tripId:{routeId:{routeName:"Kochi to Thiruvananthapuram"}},seats:["A1","A2"],fareAmount:900,status:"confirmed",createdAt:"2024-01-15T10:30:00Z",paymentStatus:"paid"}])}finally{A(!1)}},L=N.filter(e=>{var s,a,n,i,t,l;const o=(null===(s=e.bookingNumber)||void 0===s?void 0:s.toLowerCase().includes(I.toLowerCase()))||(null===(a=e.passengerName)||void 0===a?void 0:a.toLowerCase().includes(I.toLowerCase()))||(null===(n=e.passengerPhone)||void 0===n?void 0:n.includes(I))||(null===(i=e.tripId)||void 0===i||null===(t=i.routeId)||void 0===t||null===(l=t.routeName)||void 0===l?void 0:l.toLowerCase().includes(I.toLowerCase())),r="all"===T||e.status===T;return o&&r});return k?(0,v.jsx)("div",{className:"booking-management",children:(0,v.jsxs)("div",{className:"page-header",children:[(0,v.jsx)("h1",{children:"Booking Management"}),(0,v.jsx)("p",{children:"Loading bookings..."})]})}):(0,v.jsxs)("div",{className:"booking-management",children:[(0,v.jsx)("div",{className:"page-header",children:(0,v.jsxs)("div",{className:"header-content",children:[(0,v.jsxs)("div",{className:"header-text",children:[(0,v.jsx)("h1",{children:"Booking Management"}),(0,v.jsx)("p",{children:"Manage passenger bookings, tickets, and reservations"})]}),(0,v.jsxs)("button",{className:"add-booking-btn",onClick:()=>f(!0),children:[(0,v.jsx)(u.A,{size:20}),"New Booking"]})]})}),(0,v.jsxs)("div",{className:"stats-grid",children:[(0,v.jsxs)("div",{className:"stat-card",children:[(0,v.jsx)("div",{className:"stat-icon blue",children:(0,v.jsx)(x.A,{size:24})}),(0,v.jsxs)("div",{className:"stat-content",children:[(0,v.jsx)("h3",{children:"Total Bookings"}),(0,v.jsx)("div",{className:"stat-value",children:N.length})]})]}),(0,v.jsxs)("div",{className:"stat-card",children:[(0,v.jsx)("div",{className:"stat-icon green",children:(0,v.jsx)(d.A,{size:24})}),(0,v.jsxs)("div",{className:"stat-content",children:[(0,v.jsx)("h3",{children:"Today's Bookings"}),(0,v.jsx)("div",{className:"stat-value",children:N.filter(e=>new Date(e.createdAt).toDateString()===(new Date).toDateString()).length})]})]}),(0,v.jsxs)("div",{className:"stat-card",children:[(0,v.jsx)("div",{className:"stat-icon yellow",children:(0,v.jsx)(o.A,{size:24})}),(0,v.jsxs)("div",{className:"stat-content",children:[(0,v.jsx)("h3",{children:"Confirmed Bookings"}),(0,v.jsx)("div",{className:"stat-value",children:N.filter(e=>"confirmed"===e.status).length})]})]})]}),(0,v.jsx)("div",{className:"search-filter-bar",children:(0,v.jsxs)("div",{className:"search-row",children:[(0,v.jsxs)("div",{className:"search-input-container",children:[(0,v.jsx)(m.A,{size:20,className:"search-icon"}),(0,v.jsx)("input",{type:"text",placeholder:"Search bookings, passengers, trips...",value:I,onChange:e=>_(e.target.value),className:"search-input"})]}),(0,v.jsxs)("select",{value:T,onChange:e=>D(e.target.value),className:"filter-select",children:[(0,v.jsx)("option",{value:"all",children:"All Status"}),(0,v.jsx)("option",{value:"confirmed",children:"Confirmed"}),(0,v.jsx)("option",{value:"pending",children:"Pending"}),(0,v.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})}),(0,v.jsxs)("div",{className:"bookings-table-container",children:[(0,v.jsx)("div",{className:"table-header",children:(0,v.jsxs)("h3",{children:["Bookings (",L.length,")"]})}),(0,v.jsx)("div",{className:"table-wrapper",children:(0,v.jsxs)("table",{className:"bookings-table",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{children:"Booking ID"}),(0,v.jsx)("th",{children:"Passenger"}),(0,v.jsx)("th",{children:"Trip"}),(0,v.jsx)("th",{children:"Seats"}),(0,v.jsx)("th",{children:"Amount"}),(0,v.jsx)("th",{children:"Payment"}),(0,v.jsx)("th",{children:"Status"}),(0,v.jsx)("th",{children:"Date"}),(0,v.jsx)("th",{children:"Actions"})]})}),(0,v.jsx)("tbody",{children:L.length>0?L.map((e,s)=>{var a,n,i,t,l;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)("div",{className:"booking-id",children:(0,v.jsx)("span",{className:"id",children:e.bookingNumber})})}),(0,v.jsx)("td",{children:(0,v.jsxs)("div",{className:"booking-passenger",children:[(0,v.jsx)(g.A,{size:16}),(0,v.jsxs)("div",{className:"passenger-info",children:[(0,v.jsx)("span",{className:"name",children:e.passengerName}),(0,v.jsx)("span",{className:"phone",children:e.passengerPhone})]})]})}),(0,v.jsx)("td",{children:(0,v.jsxs)("div",{className:"booking-trip",children:[(0,v.jsx)(h.A,{size:16}),(0,v.jsx)("span",{children:null===(a=e.tripId)||void 0===a||null===(n=a.routeId)||void 0===n?void 0:n.routeName})]})}),(0,v.jsx)("td",{children:(0,v.jsx)("div",{className:"booking-seats",children:(0,v.jsx)("span",{children:(null===(i=e.seats)||void 0===i?void 0:i.join(", "))||"N/A"})})}),(0,v.jsx)("td",{children:(0,v.jsx)("div",{className:"booking-amount",children:(0,v.jsxs)("span",{children:["\u20b9",e.fareAmount||0]})})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"status-badge ".concat(e.paymentStatus||"unknown"),children:"paid"===e.paymentStatus?"Paid":"Pending"})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"status-badge ".concat(e.status||"unknown"),children:(null===(t=e.status)||void 0===t?void 0:t.charAt(0).toUpperCase())+(null===(l=e.status)||void 0===l?void 0:l.slice(1))})}),(0,v.jsx)("td",{children:(0,v.jsxs)("div",{className:"booking-date",children:[(0,v.jsx)(d.A,{size:16}),(0,v.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()})]})}),(0,v.jsx)("td",{children:(0,v.jsxs)("div",{className:"action-buttons",children:[(0,v.jsxs)("button",{className:"action-btn view",onClick:()=>{z(e)},children:[(0,v.jsx)(c.A,{size:16}),"View"]}),(0,v.jsxs)("button",{className:"action-btn edit",onClick:()=>{z(e),S(!0)},children:[(0,v.jsx)(r.A,{size:16}),"Edit"]}),(0,v.jsxs)("button",{className:"action-btn delete",onClick:()=>{z(e),w(!0)},children:[(0,v.jsx)(j.A,{size:16}),"Cancel"]})]})})]},e._id||s)}):(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"9",className:"no-data",children:(0,v.jsxs)("div",{className:"empty-state",children:[(0,v.jsx)(x.A,{size:48}),(0,v.jsx)("h3",{children:"No bookings found"}),(0,v.jsx)("p",{children:"No bookings match your search criteria"})]})})})})]})})]}),y&&B&&(0,v.jsx)("div",{className:"modal-overlay",onClick:()=>S(!1),children:(0,v.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,v.jsxs)("div",{className:"modal-header",children:[(0,v.jsx)("h2",{children:"Edit Booking"}),(0,v.jsx)("button",{className:"modal-close",onClick:()=>S(!1),children:(0,v.jsx)(p.A,{size:20})})]}),(0,v.jsxs)("div",{className:"modal-body",children:[(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Booking Number"}),(0,v.jsx)("input",{type:"text",value:B.bookingNumber,disabled:!0})]}),(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Passenger Name"}),(0,v.jsx)("input",{type:"text",value:B.passengerName,onChange:e=>z((0,n.A)((0,n.A)({},B),{},{passengerName:e.target.value}))})]}),(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Passenger Phone"}),(0,v.jsx)("input",{type:"text",value:B.passengerPhone,onChange:e=>z((0,n.A)((0,n.A)({},B),{},{passengerPhone:e.target.value}))})]}),(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Trip"}),(0,v.jsx)("input",{type:"text",value:null===(e=B.tripId)||void 0===e||null===(s=e.routeId)||void 0===s?void 0:s.routeName,disabled:!0})]}),(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Seats"}),(0,v.jsx)("input",{type:"text",value:null===(a=B.seats)||void 0===a?void 0:a.join(", "),onChange:e=>z((0,n.A)((0,n.A)({},B),{},{seats:e.target.value.split(", ")}))})]}),(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Fare Amount (\u20b9)"}),(0,v.jsx)("input",{type:"number",value:B.fareAmount,onChange:e=>z((0,n.A)((0,n.A)({},B),{},{fareAmount:parseInt(e.target.value)}))})]}),(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Status"}),(0,v.jsxs)("select",{value:B.status,onChange:e=>z((0,n.A)((0,n.A)({},B),{},{status:e.target.value})),children:[(0,v.jsx)("option",{value:"confirmed",children:"Confirmed"}),(0,v.jsx)("option",{value:"pending",children:"Pending"}),(0,v.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,v.jsxs)("div",{className:"form-group",children:[(0,v.jsx)("label",{children:"Payment Status"}),(0,v.jsxs)("select",{value:B.paymentStatus,onChange:e=>z((0,n.A)((0,n.A)({},B),{},{paymentStatus:e.target.value})),children:[(0,v.jsx)("option",{value:"paid",children:"Paid"}),(0,v.jsx)("option",{value:"pending",children:"Pending"})]})]})]}),(0,v.jsxs)("div",{className:"modal-actions",children:[(0,v.jsx)("button",{className:"btn btn-secondary",onClick:()=>S(!1),children:"Cancel"}),(0,v.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{const e=N.map(e=>e._id===B._id?(0,n.A)((0,n.A)({},e),B):e);b(e),S(!1),z(null)}catch(e){console.error("Error editing booking:",e)}},children:"Save Changes"})]})]})}),P&&B&&(0,v.jsx)("div",{className:"modal-overlay",onClick:()=>w(!1),children:(0,v.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,v.jsxs)("div",{className:"modal-header",children:[(0,v.jsx)("h2",{children:"Cancel Booking"}),(0,v.jsx)("button",{className:"modal-close",onClick:()=>w(!1),children:(0,v.jsx)(p.A,{size:20})})]}),(0,v.jsx)("div",{className:"modal-body",children:(0,v.jsxs)("div",{className:"delete-confirmation",children:[(0,v.jsx)(l.A,{size:48,className:"warning-icon"}),(0,v.jsx)("h3",{children:"Are you sure?"}),(0,v.jsxs)("p",{children:["You are about to cancel the booking ",(0,v.jsx)("strong",{children:B.bookingNumber})," for ",(0,v.jsx)("strong",{children:B.passengerName}),". This action cannot be undone."]})]})}),(0,v.jsxs)("div",{className:"modal-actions",children:[(0,v.jsx)("button",{className:"btn btn-secondary",onClick:()=>w(!1),children:"Cancel"}),(0,v.jsx)("button",{className:"btn btn-danger",onClick:async()=>{try{const e=N.filter(e=>e._id!==B._id);b(e),w(!1),z(null)}catch(e){console.error("Error deleting booking:",e)}},children:"Cancel Booking"})]})]})})]})}}}]);
//# sourceMappingURL=717.c1113c87.chunk.js.map